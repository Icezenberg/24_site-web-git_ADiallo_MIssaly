/*!
 * jQuery JavaScript Library v1.8.3
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2012 jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: Tue Nov 13 2012 08:20:33 GMT-0500 (Eastern Standard Time)
 */
/**
 * @license Portions of this software are copyright Yahoo, Inc, used under the following license:
 * Software License Agreement (BSD License)
 * Copyright (c) 2009, Yahoo! Inc.
 * All rights reserved.
 * Redistribution and use of this software in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
 *
 * Redistributions of source code must retain the above copyright notice, this list of conditions and the
 * following disclaimer.
 * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
 * Neither the name of Yahoo! Inc. nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission of Yahoo! Inc.
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Sources of Intellectual Property Included in the YUI Library
 * Where not otherwise indicated, all YUI content is authored by Yahoo! engineers and consists of Yahoo!-owned intellectual property. YUI is issued by Yahoo! under the BSD license above. In some specific instances, YUI will incorporate work done by developers outside of Yahoo! with their express permission.
*/

/** @license
 * ==========================================================================
 * SproutCore -- JavaScript Application Framework
 * Copyright ©2008-2011 Apple Inc. All rights reserved.
 * Copyright 2006-2011, Strobe Inc. and contributors.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a
 * copy of this software and associated documentation files (the "Software"),
 * to deal in the Software without restriction, including without limitation
 * the rights to use, copy, modify, merge, publish, distribute, sublicense,
 * and/or sell copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
 * DEALINGS IN THE SOFTWARE.
 *
 * SproutCore and the SproutCore logo are trademarks of Strobe Inc.
 *
 * For more information about SproutCore, visit http://www.sproutcore.com
 *
 * ==========================================================================
 */

/*! @license
 * Raphael 1.5.2 - JavaScript Vector Library
 *
 * Copyright (c) 2010 Dmitry Baranovskiy (http://raphaeljs.com)
 * Licensed under the MIT (http://raphaeljs.com/license.html) license.
 */

/*! @license
 * URI.js - Mutating URLs
 *
 * Version: 1.18.1
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Published under the MIT License http://www.opensource.org/licenses/mit-license
 *
 */

/*!
 * @license
 *
 * ]{ UUID - Ultra liteweight, blazing fast JavaScript UUID v4 generator
 * https://bitbucket.org/kodifica/uuid/
 *
 * Copyright 2009-2010 Massimo Lombardo
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/*! @license
  Copyright Mathias Bynens <https://mathiasbynens.be/>
  
  Permission is hereby granted, free of charge, to any person obtaining
  a copy of this software and associated documentation files (the
  "Software"), to deal in the Software without restriction, including
  without limitation the rights to use, copy, modify, merge, publish,
  distribute, sublicense, and/or sell copies of the Software, and to
  permit persons to whom the Software is furnished to do so, subject to
  the following conditions:
  
  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.
  
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
  LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
  OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
  WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/

/*! @license Copyright (c) 2006-2007, Coolite Inc. (http://www.coolite.com/). All rights reserved.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

See also:
	http://www.datejs.com/license/
	http://www.datejs.com/

*/


/*!
Copyright (C) 2007 Google Inc.
  -
  - Licensed under the Apache License, Version 2.0 (the "License");
  - you may not use this file except in compliance with the License.
  - You may obtain a copy of the License at
  -
  -      http://www.apache.org/licenses/LICENSE-2.0
  -
  - Unless required by applicable law or agreed to in writing, software
  - distributed under the License is distributed on an "AS IS" BASIS,
  - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  - See the License for the specific language governing permissions and
  - limitations under the License.
*/


function findClassNames(){if(SC._object_foundObjectClassNames)return;SC._object_foundObjectClassNames=!0;var e=[],t=!1,n=function(r,i,s){var o,u,a;s--;if(e.indexOf(i)>=0)return;e.push(i);for(var f in i){if(f=="__scope__")continue;if(f=="superclass")continue;f=="__SC__"&&(f="SC");if(!f.match(/^[A-Z0-9]/))continue;if(f=="SC"){if(t)continue;t=!0}o=r?[r,f].join("."):f,u=i[f];try{a=SC.typeOf(u)}catch(l){break}switch(a){case SC.T_CLASS:u._object_className||(u._object_className=o),s>=0&&n(o,u,s);break;case SC.T_OBJECT:s>=0&&n(o,u,s);break;case SC.T_HASH:(r||o==="SC")&&s>=0&&n(o,u,s);break;default:}}};window.__SC__=SC,n(null,window,2)}function LZ(e){return(e<0||e>9?"":"0")+e}function main(){CK.Statechart.STATE_CHART_TRACE_ENABLED=YES,SC.Logger.set("logRecordingLevel",SC.LOGGER_LEVEL_DEBUG),SC.buildMode==="production"?SC.Logger.set("logOutputLevel",SC.LOGGER_LEVEL_NONE):SC.Logger.set("logOutputLevel",SC.LOGGER_LEVEL_DEBUG),SC.Logger.set("outputMessagePrefix","Mail:"+SC.buildNumber+":"),CoreMail.initializeStores(),SC.debug("MAIL in main()"),Mail.loadRoutes(),Mail.loadGlobal(),Mail.loadPreferencesContent(),Mail.loadFolderList(),Mail.loadCoreMessageModule(),Mail.loadMessageList(),Mail.loadViewMessage(),Mail.loadActionMenu(),Mail.loadMainToolbar(),Mail.loadMoveToFolder(),Mail.loadFlagMenuModule(),Mail.loadContacts(),CloudOS.applicationIsReady(),this.addEventListener?this.addEventListener("unload",function(){Global.closeAllChildWindows()},NO):this.attachEvent&&this.attachEvent("onunload",function(){Global.closeAllChildWindows()}),Mail.getPath("mainPage.loadingMainPane").append(),Mail.getPath
("mainPage.mainPane").append(),Mail.handleLoadingState()}(function(e,t){function u(e){var t=o[e]={},n,r;e=e.split(/\s+/);for(n=0,r=e.length;n<r;n++)t[e[n]]=!0;return t}function c(e,n,r){if(r===t&&e.nodeType===1){var i="data-"+n.replace(l,"-$1").toLowerCase();r=e.getAttribute(i);if(typeof r=="string"){try{r=r==="true"?!0:r==="false"?!1:r==="null"?null:s.isNumeric(r)?+r:f.test(r)?s.parseJSON(r):r}catch(o){}s.data(e,n,r)}else r=t}return r}function h(e){for(var t in e){if(t==="data"&&s.isEmptyObject(e[t]))continue;if(t!=="toJSON")return!1}return!0}function p(e,t,n){var r=t+"defer",i=t+"queue",o=t+"mark",u=s._data(e,r);u&&(n==="queue"||!s._data(e,i))&&(n==="mark"||!s._data(e,o))&&setTimeout(function(){!s._data(e,i)&&!s._data(e,o)&&(s.removeData(e,r,!0),u.fire())},0)}function H(){return!1}function B(){return!0}function W(e){return!e||!e.parentNode||e.parentNode.nodeType===11}function X(e,t,n){t=t||0;if(s.isFunction(t))return s.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return s.grep(e,function(e,r){return e===t===n});if(typeof t=="string"){var r=s.grep(e,function(e){return e.nodeType===1});if(q.test(t))return s.filter(t,r,!n);t=s.filter(t,r)}return s.grep(e,function(e,r){return s.inArray(e,t)>=0===n})}function V(e){var t=$.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function at(e,t){return s.nodeName(e,"table")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function ft(e,t){if(t.nodeType!==1||!s.hasData(e))return;var n,r,i,o=s._data(e),u=s._data
(t,o),a=o.events;if(a){delete u.handle,u.events={};for(n in a)for(r=0,i=a[n].length;r<i;r++)s.event.add(t,n,a[n][r])}u.data&&(u.data=s.extend({},u.data))}function lt(e,t){var n;if(t.nodeType!==1)return;t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(e),n=t.nodeName.toLowerCase(),n==="object"?t.outerHTML=e.outerHTML:n!=="input"||e.type!=="checkbox"&&e.type!=="radio"?n==="option"?t.selected=e.defaultSelected:n==="input"||n==="textarea"?t.defaultValue=e.defaultValue:n==="script"&&t.text!==e.text&&(t.text=e.text):(e.checked&&(t.defaultChecked=t.checked=e.checked),t.value!==e.value&&(t.value=e.value)),t.removeAttribute(s.expando),t.removeAttribute("_submit_attached"),t.removeAttribute("_change_attached")}function ct(e){return typeof e.getElementsByTagName!="undefined"?e.getElementsByTagName("*"):typeof e.querySelectorAll!="undefined"?e.querySelectorAll("*"):[]}function ht(e){if(e.type==="checkbox"||e.type==="radio")e.defaultChecked=e.checked}function pt(e){var t=(e.nodeName||"").toLowerCase();t==="input"?ht(e):t!=="script"&&typeof e.getElementsByTagName!="undefined"&&s.grep(e.getElementsByTagName("input"),ht)}function dt(e){var t=n.createElement("div");return ut.appendChild(t),t.innerHTML=e.outerHTML,t.firstChild}function kt(e,t,n){var r=t==="width"?e.offsetWidth:e.offsetHeight,i=t==="width"?1:0,o=4;if(r>0){if(n!=="border")for(;i<o;i+=2)n||(r-=parseFloat(s.css(e,"padding"+xt[i]))||0),n==="margin"?r+=parseFloat(s.css(e,n+xt[i]))||0:r-=parseFloat(s.css(e,"border"+xt[i]+"Width"))||0;return r+"px"}r=Tt(e,t);if(r<0||r==null)r=e.style[t];if(bt.test(r))return r
;r=parseFloat(r)||0;if(n)for(;i<o;i+=2)r+=parseFloat(s.css(e,"padding"+xt[i]))||0,n!=="padding"&&(r+=parseFloat(s.css(e,"border"+xt[i]+"Width"))||0),n==="margin"&&(r+=parseFloat(s.css(e,n+xt[i]))||0);return r+"px"}function Bt(){return setTimeout(jt,0),Ht=s.now()}function jt(){Ht=t}function Ft(e,t){var n={};return s.each(Pt.concat.apply([],Pt.slice(0,t)),function(){n[this]=e}),n}function It(e){if(!Lt[e]){var t=n.body,r=s("<"+e+">").appendTo(t),i=r.css("display");r.remove();if(i==="none"||i===""){At||(At=n.createElement("iframe"),At.frameBorder=At.width=At.height=0),t.appendChild(At);if(!Ot||!At.createElement)Ot=(At.contentWindow||At.contentDocument).document,Ot.write((s.support.boxModel?"<!doctype html>":"")+"<html><body>"),Ot.close();r=Ot.createElement(e),Ot.body.appendChild(r),i=s.css(r,"display"),t.removeChild(At)}Lt[e]=i}return Lt[e]}function zt(e){return s.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}var n=e.document,r=e.navigator,i=e.location,s=function(){function H(){if(i.isReady)return;try{n.documentElement.doScroll("left")}catch(e){setTimeout(H,1);return}i.ready()}var i=function(e,t){return new i.fn.init(e,t,u)},s=e.jQuery,o=e.$,u,a=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,f=/\S/,l=/^\s+/,c=/\s+$/,h=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,p=/^[\],:{}\s]*$/,d=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,v=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,m=/(?:^|:|,)(?:\s*\[)+/g,g=/(webkit)[ \/]([\w.]+)/,y=/(opera)(?:.*version)?[ \/]([\w.]+)/,b=/(msie) ([\w.]+)/,w=/(mozilla)(?:.*? rv:([\w.]+))?/,E=/-([a-z]|[0-9])/ig,S=/^-ms-/,x=function(e,t){return(t+""
).toUpperCase()},T=r.userAgent,N,C,k,L=Object.prototype.toString,A=Object.prototype.hasOwnProperty,O=Array.prototype.push,M=Array.prototype.slice,_=String.prototype.trim,D=Array.prototype.indexOf,P={};return i.fn=i.prototype={constructor:i,init:function(e,r,s){var o,u,f,l;if(!e)return this;if(e.nodeType)return this.context=this[0]=e,this.length=1,this;if(e==="body"&&!r&&n.body)return this.context=n,this[0]=n.body,this.selector=e,this.length=1,this;if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?o=[null,e,null]:o=a.exec(e);if(o&&(o[1]||!r)){if(o[1])return r=r instanceof i?r[0]:r,l=r?r.ownerDocument||r:n,f=h.exec(e),f?i.isPlainObject(r)?(e=[n.createElement(f[1])],i.fn.attr.call(e,r,!0)):e=[l.createElement(f[1])]:(f=i.buildFragment([o[1]],[l]),e=(f.cacheable?i.clone(f.fragment):f.fragment).childNodes),i.merge(this,e);u=n.getElementById(o[2]);if(u&&u.parentNode){if(u.id!==o[2])return s.find(e);this.length=1,this[0]=u}return this.context=n,this.selector=e,this}return!r||r.jquery?(r||s).find(e):this.constructor(r).find(e)}return i.isFunction(e)?s.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),i.makeArray(e,this))},selector:"",jquery:"1.7.2",length:0,size:function(){return this.length},toArray:function(){return M.call(this,0)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,n){var r=this.constructor();return i.isArray(e)?O.apply(r,e):i.merge(r,e),r.prevObject=this,r.context=this.context,t==="find"?r.selector=this.selector+(this.selector?" ":"")+n:t&&(r.selector=this.
selector+"."+t+"("+n+")"),r},each:function(e,t){return i.each(this,e,t)},ready:function(e){return i.bindReady(),C.add(e),this},eq:function(e){return e=+e,e===-1?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(M.apply(this,arguments),"slice",M.call(arguments).join(","))},map:function(e){return this.pushStack(i.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:O,sort:[].sort,splice:[].splice},i.fn.init.prototype=i.fn,i.extend=i.fn.extend=function(){var e,n,r,s,o,u,a=arguments[0]||{},f=1,l=arguments.length,c=!1;typeof a=="boolean"&&(c=a,a=arguments[1]||{},f=2),typeof a!="object"&&!i.isFunction(a)&&(a={}),l===f&&(a=this,--f);for(;f<l;f++)if((e=arguments[f])!=null)for(n in e){r=a[n],s=e[n];if(a===s)continue;c&&s&&(i.isPlainObject(s)||(o=i.isArray(s)))?(o?(o=!1,u=r&&i.isArray(r)?r:[]):u=r&&i.isPlainObject(r)?r:{},a[n]=i.extend(c,u,s)):s!==t&&(a[n]=s)}return a},i.extend({noConflict:function(t){return e.$===i&&(e.$=o),t&&e.jQuery===i&&(e.jQuery=s),i},isReady:!1,readyWait:1,holdReady:function(e){e?i.readyWait++:i.ready(!0)},ready:function(e){if(e===!0&&!--i.readyWait||e!==!0&&!i.isReady){if(!n.body)return setTimeout(i.ready,1);i.isReady=!0;if(e!==!0&&--i.readyWait>0)return;C.fireWith(n,[i]),i.fn.trigger&&i(n).trigger("ready").off("ready")}},bindReady:function(){if(C)return;C=i.Callbacks("once memory");if(n.readyState==="complete")return setTimeout(i.ready,1);if(n.addEventListener)n.addEventListener("DOMContentLoaded",k,!1),e
.addEventListener("load",i.ready,!1);else if(n.attachEvent){n.attachEvent("onreadystatechange",k),e.attachEvent("onload",i.ready);var t=!1;try{t=e.frameElement==null}catch(r){}n.documentElement.doScroll&&t&&H()}},isFunction:function(e){return i.type(e)==="function"},isArray:Array.isArray||function(e){return i.type(e)==="array"},isWindow:function(e){return e!=null&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):P[L.call(e)]||"object"},isPlainObject:function(e){if(!e||i.type(e)!=="object"||e.nodeType||i.isWindow(e))return!1;try{if(e.constructor&&!A.call(e,"constructor")&&!A.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var r;for(r in e);return r===t||A.call(e,r)},isEmptyObject:function(e){for(var t in e)return!1;return!0},error:function(e){throw new Error(e)},parseJSON:function(t){if(typeof t!="string"||!t)return null;t=i.trim(t);if(e.JSON&&e.JSON.parse)return e.JSON.parse(t);if(p.test(t.replace(d,"@").replace(v,"]").replace(m,"")))return(new Function("return "+t))();i.error("Invalid JSON: "+t)},parseXML:function(n){if(typeof n!="string"||!n)return null;var r,s;try{e.DOMParser?(s=new DOMParser,r=s.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(o){r=t}return(!r||!r.documentElement||r.getElementsByTagName("parsererror").length)&&i.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&f.test(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(S,"ms-").replace(E,x)}
,nodeName:function(e,t){return e.nodeName&&e.nodeName.toUpperCase()===t.toUpperCase()},each:function(e,n,r){var s,o=0,u=e.length,a=u===t||i.isFunction(e);if(r){if(a){for(s in e)if(n.apply(e[s],r)===!1)break}else for(;o<u;)if(n.apply(e[o++],r)===!1)break}else if(a){for(s in e)if(n.call(e[s],s,e[s])===!1)break}else for(;o<u;)if(n.call(e[o],o,e[o++])===!1)break;return e},trim:_?function(e){return e==null?"":_.call(e)}:function(e){return e==null?"":e.toString().replace(l,"").replace(c,"")},makeArray:function(e,t){var n=t||[];if(e!=null){var r=i.type(e);e.length==null||r==="string"||r==="function"||r==="regexp"||i.isWindow(e)?O.call(n,e):i.merge(n,e)}return n},inArray:function(e,t,n){var r;if(t){if(D)return D.call(t,e,n);r=t.length,n=n?n<0?Math.max(0,r+n):n:0;for(;n<r;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=e.length,i=0;if(typeof n.length=="number")for(var s=n.length;i<s;i++)e[r++]=n[i];else while(n[i]!==t)e[r++]=n[i++];return e.length=r,e},grep:function(e,t,n){var r=[],i;n=!!n;for(var s=0,o=e.length;s<o;s++)i=!!t(e[s],s),n!==i&&r.push(e[s]);return r},map:function(e,n,r){var s,o,u=[],a=0,f=e.length,l=e instanceof i||f!==t&&typeof f=="number"&&(f>0&&e[0]&&e[f-1]||f===0||i.isArray(e));if(l)for(;a<f;a++)s=n(e[a],a,r),s!=null&&(u[u.length]=s);else for(o in e)s=n(e[o],o,r),s!=null&&(u[u.length]=s);return u.concat.apply([],u)},guid:1,proxy:function(e,n){if(typeof n=="string"){var r=e[n];n=e,e=r}if(!i.isFunction(e))return t;var s=M.call(arguments,2),o=function(){return e.apply(n,s.concat(M.call(arguments)))};return o.guid=e.guid=e.guid||o.guid||i.guid++,o},access
:function(e,n,r,s,o,u,a){var f,l=r==null,c=0,h=e.length;if(r&&typeof r=="object"){for(c in r)i.access(e,n,c,r[c],1,u,s);o=1}else if(s!==t){f=a===t&&i.isFunction(s),l&&(f?(f=n,n=function(e,t,n){return f.call(i(e),n)}):(n.call(e,s),n=null));if(n)for(;c<h;c++)n(e[c],r,f?s.call(e[c],c,n(e[c],r)):s,a);o=1}return o?e:l?n.call(e):h?n(e[0],r):u},now:function(){return(new Date).getTime()},uaMatch:function(e){e=e.toLowerCase();var t=g.exec(e)||y.exec(e)||b.exec(e)||e.indexOf("compatible")<0&&w.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},sub:function(){function e(t,n){return new e.fn.init(t,n)}i.extend(!0,e,this),e.superclass=this,e.fn=e.prototype=this(),e.fn.constructor=e,e.sub=this.sub,e.fn.init=function(r,s){return s&&s instanceof i&&!(s instanceof e)&&(s=e(s)),i.fn.init.call(this,r,s,t)},e.fn.init.prototype=e.fn;var t=e(n);return e},browser:{}}),i.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){P["[object "+t+"]"]=t.toLowerCase()}),N=i.uaMatch(T),N.browser&&(i.browser[N.browser]=!0,i.browser.version=N.version),i.browser.webkit&&(i.browser.safari=!0),f.test(" ")&&(l=/^[\s\xA0]+/,c=/[\s\xA0]+$/),u=i(n),n.addEventListener?k=function(){n.removeEventListener("DOMContentLoaded",k,!1),i.ready()}:n.attachEvent&&(k=function(){n.readyState==="complete"&&(n.detachEvent("onreadystatechange",k),i.ready())}),i}(),o={};s.Callbacks=function(e){e=e?o[e]||u(e):{};var n=[],r=[],i,a,f,l,c,h,p=function(t){var r,i,o,u,a;for(r=0,i=t.length;r<i;r++)o=t[r],u=s.type(o),u==="array"?p(o):u==="function"&&(!e.unique||!v.has(o))&&n.push(o)},d=function(t,s){s=s||
[],i=!e.memory||[t,s],a=!0,f=!0,h=l||0,l=0,c=n.length;for(;n&&h<c;h++)if(n[h].apply(t,s)===!1&&e.stopOnFalse){i=!0;break}f=!1,n&&(e.once?i===!0?v.disable():n=[]:r&&r.length&&(i=r.shift(),v.fireWith(i[0],i[1])))},v={add:function(){if(n){var e=n.length;p(arguments),f?c=n.length:i&&i!==!0&&(l=e,d(i[0],i[1]))}return this},remove:function(){if(n){var t=arguments,r=0,i=t.length;for(;r<i;r++)for(var s=0;s<n.length;s++)if(t[r]===n[s]){f&&s<=c&&(c--,s<=h&&h--),n.splice(s--,1);if(e.unique)break}}return this},has:function(e){if(n){var t=0,r=n.length;for(;t<r;t++)if(e===n[t])return!0}return!1},empty:function(){return n=[],this},disable:function(){return n=r=i=t,this},disabled:function(){return!n},lock:function(){return r=t,(!i||i===!0)&&v.disable(),this},locked:function(){return!r},fireWith:function(t,n){return r&&(f?e.once||r.push([t,n]):(!e.once||!i)&&d(t,n)),this},fire:function(){return v.fireWith(this,arguments),this},fired:function(){return!!a}};return v};var a=[].slice;s.extend({Deferred:function(e){var t=s.Callbacks("once memory"),n=s.Callbacks("once memory"),r=s.Callbacks("memory"),i="pending",o={resolve:t,reject:n,notify:r},u={done:t.add,fail:n.add,progress:r.add,state:function(){return i},isResolved:t.fired,isRejected:n.fired,then:function(e,t,n){return a.done(e).fail(t).progress(n),this},always:function(){return a.done.apply(a,arguments).fail.apply(a,arguments),this},pipe:function(e,t,n){return s.Deferred(function(r){s.each({done:[e,"resolve"],fail:[t,"reject"],progress:[n,"notify"]},function(e,t){var n=t[0],i=t[1],o;s.isFunction(n)?a[e](function(){o=n.apply(this,arguments),o&&
s.isFunction(o.promise)?o.promise().then(r.resolve,r.reject,r.notify):r[i+"With"](this===a?r:this,[o])}):a[e](r[i])})}).promise()},promise:function(e){if(e==null)e=u;else for(var t in u)e[t]=u[t];return e}},a=u.promise({}),f;for(f in o)a[f]=o[f].fire,a[f+"With"]=o[f].fireWith;return a.done(function(){i="resolved"},n.disable,r.lock).fail(function(){i="rejected"},t.disable,r.lock),e&&e.call(a,a),a},when:function(e){function c(e){return function(n){t[e]=arguments.length>1?a.call(arguments,0):n,--o||f.resolveWith(f,t)}}function h(e){return function(t){i[e]=arguments.length>1?a.call(arguments,0):t,f.notifyWith(l,i)}}var t=a.call(arguments,0),n=0,r=t.length,i=new Array(r),o=r,u=r,f=r<=1&&e&&s.isFunction(e.promise)?e:s.Deferred(),l=f.promise();if(r>1){for(;n<r;n++)t[n]&&t[n].promise&&s.isFunction(t[n].promise)?t[n].promise().then(c(n),f.reject,h(n)):--o;o||f.resolveWith(f,t)}else f!==e&&f.resolveWith(f,r?[e]:[]);return l}}),s.support=function(){var t,r,i,o,u,a,f,l,c,h,p,d,v=n.createElement("div"),m=n.documentElement;v.setAttribute("className","t"),v.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",r=v.getElementsByTagName("*"),i=v.getElementsByTagName("a")[0];if(!r||!r.length||!i)return{};o=n.createElement("select"),u=o.appendChild(n.createElement("option")),a=v.getElementsByTagName("input")[0],t={leadingWhitespace:v.firstChild.nodeType===3,tbody:!v.getElementsByTagName("tbody").length,htmlSerialize:!!v.getElementsByTagName("link").length,style:/top/.test(i.getAttribute("style")),hrefNormalized:i.getAttribute("href"
)==="/a",opacity:/^0.55/.test(i.style.opacity),cssFloat:!!i.style.cssFloat,checkOn:a.value==="on",optSelected:u.selected,getSetAttribute:v.className!=="t",enctype:!!n.createElement("form").enctype,html5Clone:n.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,pixelMargin:!0},s.boxModel=t.boxModel=n.compatMode==="CSS1Compat",a.checked=!0,t.noCloneChecked=a.cloneNode(!0).checked,o.disabled=!0,t.optDisabled=!u.disabled;try{delete v.test}catch(g){t.deleteExpando=!1}!v.addEventListener&&v.attachEvent&&v.fireEvent&&(v.attachEvent("onclick",function(){t.noCloneEvent=!1}),v.cloneNode(!0).fireEvent("onclick")),a=n.createElement("input"),a.value="t",a.setAttribute("type","radio"),t.radioValue=a.value==="t",a.setAttribute("checked","checked"),a.setAttribute("name","t"),v.appendChild(a),f=n.createDocumentFragment(),f.appendChild(v.lastChild),t.checkClone=f.cloneNode(!0).cloneNode(!0).lastChild.checked,t.appendChecked=a.checked,f.removeChild(a),f.appendChild(v);if(v.attachEvent)for(p in{submit:1,change:1,focusin:1})h="on"+p,d=h in v,d||(v.setAttribute(h,"return;"),d=typeof v[h]=="function"),t[p+"Bubbles"]=d;return f.removeChild(v),f=o=u=v=a=null,s(function(){var r,i,o,u,a,f,c,h,p,m,g,y,b,w=n.getElementsByTagName("body")[0];if(!w)return;h=1,b="padding:0;margin:0;border:",g="position:absolute;top:0;left:0;width:1px;height:1px;",y=b+"0;visibility:hidden;",p="style='"+g+b+"5px solid #000;",m="<div "+p+"display:block;'><div style='"+
b+"0;display:block;overflow:hidden;'></div></div>"+"<table "+p+"' cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>",r=n.createElement("div"),r.style.cssText=y+"width:0;height:0;position:static;top:0;margin-top:"+h+"px",w.insertBefore(r,w.firstChild),v=n.createElement("div"),r.appendChild(v),v.innerHTML="<table><tr><td style='"+b+"0;display:none'></td><td>t</td></tr></table>",l=v.getElementsByTagName("td"),d=l[0].offsetHeight===0,l[0].style.display="",l[1].style.display="none",t.reliableHiddenOffsets=d&&l[0].offsetHeight===0,e.getComputedStyle&&(v.innerHTML="",c=n.createElement("div"),c.style.width="0",c.style.marginRight="0",v.style.width="2px",v.appendChild(c),t.reliableMarginRight=(parseInt((e.getComputedStyle(c,null)||{marginRight:0}).marginRight,10)||0)===0),typeof v.style.zoom!="undefined"&&(v.innerHTML="",v.style.width=v.style.padding="1px",v.style.border=0,v.style.overflow="hidden",v.style.display="inline",v.style.zoom=1,t.inlineBlockNeedsLayout=v.offsetWidth===3,v.style.display="block",v.style.overflow="visible",v.innerHTML="<div style='width:5px;'></div>",t.shrinkWrapBlocks=v.offsetWidth!==3),v.style.cssText=g+y,v.innerHTML=m,i=v.firstChild,o=i.firstChild,a=i.nextSibling.firstChild.firstChild,f={doesNotAddBorder:o.offsetTop!==5,doesAddBorderForTableAndCells:a.offsetTop===5},o.style.position="fixed",o.style.top="20px",f.fixedPosition=o.offsetTop===20||o.offsetTop===15,o.style.position=o.style.top="",i.style.overflow="hidden",i.style.position="relative",f.subtractsBorderForOverflowNotVisible=o.offsetTop===-5,f.doesNotIncludeMarginInBodyOffset=w.offsetTop!==
h,e.getComputedStyle&&(v.style.marginTop="1%",t.pixelMargin=(e.getComputedStyle(v,null)||{marginTop:0}).marginTop!=="1%"),typeof r.style.zoom!="undefined"&&(r.style.zoom=1),w.removeChild(r),c=v=r=null,s.extend(t,f)}),t}();var f=/^(?:\{.*\}|\[.*\])$/,l=/([A-Z])/g;s.extend({cache:{},uuid:0,expando:"jQuery"+(s.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?s.cache[e[s.expando]]:e[s.expando],!!e&&!h(e)},data:function(e,n,r,i){if(!s.acceptData(e))return;var o,u,a,f=s.expando,l=typeof n=="string",c=e.nodeType,h=c?s.cache:e,p=c?e[f]:e[f]&&f,d=n==="events";if((!p||!h[p]||!d&&!i&&!h[p].data)&&l&&r===t)return;p||(c?e[f]=p=++s.uuid:p=f),h[p]||(h[p]={},c||(h[p].toJSON=s.noop));if(typeof n=="object"||typeof n=="function")i?h[p]=s.extend(h[p],n):h[p].data=s.extend(h[p].data,n);return o=u=h[p],i||(u.data||(u.data={}),u=u.data),r!==t&&(u[s.camelCase(n)]=r),d&&!u[n]?o.events:(l?(a=u[n],a==null&&(a=u[s.camelCase(n)])):a=u,a)},removeData:function(e,t,n){if(!s.acceptData(e))return;var r,i,o,u=s.expando,a=e.nodeType,f=a?s.cache:e,l=a?e[u]:u;if(!f[l])return;if(t){r=n?f[l]:f[l].data;if(r){s.isArray(t)||(t in r?t=[t]:(t=s.camelCase(t),t in r?t=[t]:t=t.split(" ")));for(i=0,o=t.length;i<o;i++)delete r[t[i]];if(!(n?h:s.isEmptyObject)(r))return}}if(!n){delete f[l].data;if(!h(f[l]))return}s.support.deleteExpando||!f.setInterval?delete f[l]:f[l]=null,a&&(s.support.deleteExpando?delete e[u]:e.removeAttribute?e.removeAttribute(u):e[u]=null)},_data:function(e,t,n){return s.data(e,t,n,!0)},acceptData
:function(e){if(e.nodeName){var t=s.noData[e.nodeName.toLowerCase()];if(t)return t!==!0&&e.getAttribute("classid")===t}return!0}}),s.fn.extend({data:function(e,n){var r,i,o,u,a,f=this[0],l=0,h=null;if(e===t){if(this.length){h=s.data(f);if(f.nodeType===1&&!s._data(f,"parsedAttrs")){o=f.attributes;for(a=o.length;l<a;l++)u=o[l].name,u.indexOf("data-")===0&&(u=s.camelCase(u.substring(5)),c(f,u,h[u]));s._data(f,"parsedAttrs",!0)}}return h}return typeof e=="object"?this.each(function(){s.data(this,e)}):(r=e.split(".",2),r[1]=r[1]?"."+r[1]:"",i=r[1]+"!",s.access(this,function(n){if(n===t)return h=this.triggerHandler("getData"+i,[r[0]]),h===t&&f&&(h=s.data(f,e),h=c(f,e,h)),h===t&&r[1]?this.data(r[0]):h;r[1]=n,this.each(function(){var t=s(this);t.triggerHandler("setData"+i,r),s.data(this,e,n),t.triggerHandler("changeData"+i,r)})},null,n,arguments.length>1,null,!1))},removeData:function(e){return this.each(function(){s.removeData(this,e)})}}),s.extend({_mark:function(e,t){e&&(t=(t||"fx")+"mark",s._data(e,t,(s._data(e,t)||0)+1))},_unmark:function(e,t,n){e!==!0&&(n=t,t=e,e=!1);if(t){n=n||"fx";var r=n+"mark",i=e?0:(s._data(t,r)||1)-1;i?s._data(t,r,i):(s.removeData(t,r,!0),p(t,n,"mark"))}},queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=s._data(e,t),n&&(!r||s.isArray(n)?r=s._data(e,t,s.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=s.queue(e,t),r=n.shift(),i={};r==="inprogress"&&(r=n.shift()),r&&(t==="fx"&&n.unshift("inprogress"),s._data(e,t+".run",i),r.call(e,function(){s.dequeue(e,t)},i)),n.length||(s.removeData(e,t+"queue "+t+".run",!0),p(e,t,"queue"
))}}),s.fn.extend({queue:function(e,n){var r=2;return typeof e!="string"&&(n=e,e="fx",r--),arguments.length<r?s.queue(this[0],e):n===t?this:this.each(function(){var t=s.queue(this,e,n);e==="fx"&&t[0]!=="inprogress"&&s.dequeue(this,e)})},dequeue:function(e){return this.each(function(){s.dequeue(this,e)})},delay:function(e,t){return e=s.fx?s.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){function h(){--u||r.resolveWith(i,[i])}typeof e!="string"&&(n=e,e=t),e=e||"fx";var r=s.Deferred(),i=this,o=i.length,u=1,a=e+"defer",f=e+"queue",l=e+"mark",c;while(o--)if(c=s.data(i[o],a,t,!0)||(s.data(i[o],f,t,!0)||s.data(i[o],l,t,!0))&&s.data(i[o],a,s.Callbacks("once memory"),!0))u++,c.add(h);return h(),r.promise(n)}});var d=/[\n\t\r]/g,v=/\s+/,m=/\r/g,g=/^(?:button|input)$/i,y=/^(?:button|input|object|select|textarea)$/i,b=/^a(?:rea)?$/i,w=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,E=s.support.getSetAttribute,S,x,T;s.fn.extend({attr:function(e,t){return s.access(this,s.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){s.removeAttr(this,e)})},prop:function(e,t){return s.access(this,s.prop,e,t,arguments.length>1)},removeProp:function(e){return e=s.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,o,u,a;if(s.isFunction(e))return this.each(function(t){s(this).addClass(e.call(this,t,
this.className))});if(e&&typeof e=="string"){t=e.split(v);for(n=0,r=this.length;n<r;n++){i=this[n];if(i.nodeType===1)if(!i.className&&t.length===1)i.className=e;else{o=" "+i.className+" ";for(u=0,a=t.length;u<a;u++)~o.indexOf(" "+t[u]+" ")||(o+=t[u]+" ");i.className=s.trim(o)}}}return this},removeClass:function(e){var n,r,i,o,u,a,f;if(s.isFunction(e))return this.each(function(t){s(this).removeClass(e.call(this,t,this.className))});if(e&&typeof e=="string"||e===t){n=(e||"").split(v);for(r=0,i=this.length;r<i;r++){o=this[r];if(o.nodeType===1&&o.className)if(e){u=(" "+o.className+" ").replace(d," ");for(a=0,f=n.length;a<f;a++)u=u.replace(" "+n[a]+" "," ");o.className=s.trim(u)}else o.className=""}}return this},toggleClass:function(e,t){var n=typeof e,r=typeof t=="boolean";return s.isFunction(e)?this.each(function(n){s(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var i,o=0,u=s(this),a=t,f=e.split(v);while(i=f[o++])a=r?a:!u.hasClass(i),u[a?"addClass":"removeClass"](i)}else if(n==="undefined"||n==="boolean")this.className&&s._data(this,"__className__",this.className),this.className=this.className||e===!1?"":s._data(this,"__className__")||""})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(d," ").indexOf(t)>-1)return!0;return!1},val:function(e){var n,r,i,o=this[0];if(!arguments.length){if(o)return n=s.valHooks[o.type]||s.valHooks[o.nodeName.toLowerCase()],n&&"get"in n&&(r=n.get(o,"value"))!==t?r:(r=o.value,typeof r=="string"?r.replace(m,""):r==null?"":r
);return}return i=s.isFunction(e),this.each(function(r){var o=s(this),u;if(this.nodeType!==1)return;i?u=e.call(this,r,o.val()):u=e,u==null?u="":typeof u=="number"?u+="":s.isArray(u)&&(u=s.map(u,function(e){return e==null?"":e+""})),n=s.valHooks[this.type]||s.valHooks[this.nodeName.toLowerCase()];if(!n||!("set"in n)||n.set(this,u,"value")===t)this.value=u})}}),s.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r,i,o=e.selectedIndex,u=[],a=e.options,f=e.type==="select-one";if(o<0)return null;n=f?o:0,r=f?o+1:a.length;for(;n<r;n++){i=a[n];if(i.selected&&(s.support.optDisabled?!i.disabled:i.getAttribute("disabled")===null)&&(!i.parentNode.disabled||!s.nodeName(i.parentNode,"optgroup"))){t=s(i).val();if(f)return t;u.push(t)}}return f&&!u.length&&a.length?s(a[o]).val():u},set:function(e,t){var n=s.makeArray(t);return s(e).find("option").each(function(){this.selected=s.inArray(s(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(e,n,r,i){var o,u,a,f=e.nodeType;if(!e||f===3||f===8||f===2)return;if(i&&n in s.attrFn)return s(e)[n](r);if(typeof e.getAttribute=="undefined")return s.prop(e,n,r);a=f!==1||!s.isXMLDoc(e),a&&(n=n.toLowerCase(),u=s.attrHooks[n]||(w.test(n)?x:S));if(r!==t){if(r===null){s.removeAttr(e,n);return}return u&&"set"in u&&a&&(o=u.set(e,r,n))!==t?o:(e.setAttribute(n,""+r),r)}return u&&"get"in u&&a&&(o=u.get(e,n))!==null?o:(o=e.getAttribute(n),o===null?t:o)},removeAttr:function(e,t){var n,r
,i,o,u,a=0;if(t&&e.nodeType===1){r=t.toLowerCase().split(v),o=r.length;for(;a<o;a++)i=r[a],i&&(n=s.propFix[i]||i,u=w.test(i),u||s.attr(e,i,""),e.removeAttribute(E?i:n),u&&n in e&&(e[n]=!1))}},attrHooks:{type:{set:function(e,t){if(g.test(e.nodeName)&&e.parentNode)s.error("type property can't be changed");else if(!s.support.radioValue&&t==="radio"&&s.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}},value:{get:function(e,t){return S&&s.nodeName(e,"button")?S.get(e,t):t in e?e.value:null},set:function(e,t,n){if(S&&s.nodeName(e,"button"))return S.set(e,t,n);e.value=t}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,o,u,a=e.nodeType;if(!e||a===3||a===8||a===2)return;return u=a!==1||!s.isXMLDoc(e),u&&(n=s.propFix[n]||n,o=s.propHooks[n]),r!==t?o&&"set"in o&&(i=o.set(e,r,n))!==t?i:e[n]=r:o&&"get"in o&&(i=o.get(e,n))!==null?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):y.test(e.nodeName)||b.test(e.nodeName)&&e.href?0:t}}}}),s.attrHooks.tabindex=s.propHooks.tabIndex,x={get:function(e,n){var r,i=s.prop(e,n);return i===!0||typeof i!="boolean"&&(r=e.getAttributeNode(n))&&r.nodeValue!==!1?n.toLowerCase():t},set:function(e,t,n){var r;return t===!1?s.removeAttr(e,n):(r=s.propFix[n]||n,r in e&&(e[r]=!0),e.setAttribute(n,n.toLowerCase
())),n}},E||(T={name:!0,id:!0,coords:!0},S=s.valHooks.button={get:function(e,n){var r;return r=e.getAttributeNode(n),r&&(T[n]?r.nodeValue!=="":r.specified)?r.nodeValue:t},set:function(e,t,r){var i=e.getAttributeNode(r);return i||(i=n.createAttribute(r),e.setAttributeNode(i)),i.nodeValue=t+""}},s.attrHooks.tabindex.set=S.set,s.each(["width","height"],function(e,t){s.attrHooks[t]=s.extend(s.attrHooks[t],{set:function(e,n){if(n==="")return e.setAttribute(t,"auto"),n}})}),s.attrHooks.contenteditable={get:S.get,set:function(e,t,n){t===""&&(t="false"),S.set(e,t,n)}}),s.support.hrefNormalized||s.each(["href","src","width","height"],function(e,n){s.attrHooks[n]=s.extend(s.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return r===null?t:r}})}),s.support.style||(s.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||t},set:function(e,t){return e.style.cssText=""+t}}),s.support.optSelected||(s.propHooks.selected=s.extend(s.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),s.support.enctype||(s.propFix.enctype="encoding"),s.support.checkOn||s.each(["radio","checkbox"],function(){s.valHooks[this]={get:function(e){return e.getAttribute("value")===null?"on":e.value}}}),s.each(["radio","checkbox"],function(){s.valHooks[this]=s.extend(s.valHooks[this],{set:function(e,t){if(s.isArray(t))return e.checked=s.inArray(s(e).val(),t)>=0}})});var N=/^(?:textarea|input|select)$/i,C=/^([^\.]*)?(?:\.(.+))?$/,k=/(?:^|\s)hover(\.\S+)?\b/,L=/^key/,A=/^(?:mouse|contextmenu)|click/,O=/^(?:focusinfocus|focusoutblur)$/
,M=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,_=function(e){var t=M.exec(e);return t&&(t[1]=(t[1]||"").toLowerCase(),t[3]=t[3]&&new RegExp("(?:^|\\s)"+t[3]+"(?:\\s|$)")),t},D=function(e,t){var n=e.attributes||{};return(!t[1]||e.nodeName.toLowerCase()===t[1])&&(!t[2]||(n.id||{}).value===t[2])&&(!t[3]||t[3].test((n["class"]||{}).value))},P=function(e){return s.event.special.hover?e:e.replace(k,"mouseenter$1 mouseleave$1")};s.event={add:function(e,n,r,i,o){var u,a,f,l,c,h,p,d,v,m,g,y;if(e.nodeType===3||e.nodeType===8||!n||!r||!(u=s._data(e)))return;r.handler&&(v=r,r=v.handler,o=v.selector),r.guid||(r.guid=s.guid++),f=u.events,f||(u.events=f={}),a=u.handle,a||(u.handle=a=function(e){return typeof s=="undefined"||!!e&&s.event.triggered===e.type?t:s.event.dispatch.apply(a.elem,arguments)},a.elem=e),n=s.trim(P(n)).split(" ");for(l=0;l<n.length;l++){c=C.exec(n[l])||[],h=c[1],p=(c[2]||"").split(".").sort(),y=s.event.special[h]||{},h=(o?y.delegateType:y.bindType)||h,y=s.event.special[h]||{},d=s.extend({type:h,origType:c[1],data:i,handler:r,guid:r.guid,selector:o,quick:o&&_(o),namespace:p.join(".")},v),g=f[h];if(!g){g=f[h]=[],g.delegateCount=0;if(!y.setup||y.setup.call(e,i,p,a)===!1)e.addEventListener?e.addEventListener(h,a,!1):e.attachEvent&&e.attachEvent("on"+h,a)}y.add&&(y.add.call(e,d),d.handler.guid||(d.handler.guid=r.guid)),o?g.splice(g.delegateCount++,0,d):g.push(d),s.event.global[h]=!0}e=null},global:{},remove:function(e,t,n,r,i){var o=s.hasData(e)&&s._data(e),u,a,f,l,c,h,p,d,v,m,g,y;if(!o||!(d=o.events))return;t=s.trim(P(t||"")).split(" ");for(u=0;u<t.length;u++){a=C.exec(t[u])||
[],f=l=a[1],c=a[2];if(!f){for(f in d)s.event.remove(e,f+t[u],n,r,!0);continue}v=s.event.special[f]||{},f=(r?v.delegateType:v.bindType)||f,g=d[f]||[],h=g.length,c=c?new RegExp("(^|\\.)"+c.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(p=0;p<g.length;p++)y=g[p],(i||l===y.origType)&&(!n||n.guid===y.guid)&&(!c||c.test(y.namespace))&&(!r||r===y.selector||r==="**"&&y.selector)&&(g.splice(p--,1),y.selector&&g.delegateCount--,v.remove&&v.remove.call(e,y));g.length===0&&h!==g.length&&((!v.teardown||v.teardown.call(e,c)===!1)&&s.removeEvent(e,f,o.handle),delete d[f])}s.isEmptyObject(d)&&(m=o.handle,m&&(m.elem=null),s.removeData(e,["events","handle"],!0))},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(n,r,i,o){if(!i||i.nodeType!==3&&i.nodeType!==8){var u=n.type||n,a=[],f,l,c,h,p,d,v,m,g,y;if(O.test(u+s.event.triggered))return;u.indexOf("!")>=0&&(u=u.slice(0,-1),l=!0),u.indexOf(".")>=0&&(a=u.split("."),u=a.shift(),a.sort());if((!i||s.event.customEvent[u])&&!s.event.global[u])return;n=typeof n=="object"?n[s.expando]?n:new s.Event(u,n):new s.Event(u),n.type=u,n.isTrigger=!0,n.exclusive=l,n.namespace=a.join("."),n.namespace_re=n.namespace?new RegExp("(^|\\.)"+a.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,d=u.indexOf(":")<0?"on"+u:"";if(!i){f=s.cache;for(c in f)f[c].events&&f[c].events[u]&&s.event.trigger(n,r,f[c].handle.elem,!0);return}n.result=t,n.target||(n.target=i),r=r!=null?s.makeArray(r):[],r.unshift(n),v=s.event.special[u]||{};if(v.trigger&&v.trigger.apply(i,r)===!1)return;g=[[i,v.bindType||u]];if(!o&&!v.noBubble&&!s.isWindow(i)){y=v.delegateType||u,h=O.test
(y+u)?i:i.parentNode,p=null;for(;h;h=h.parentNode)g.push([h,y]),p=h;p&&p===i.ownerDocument&&g.push([p.defaultView||p.parentWindow||e,y])}for(c=0;c<g.length&&!n.isPropagationStopped();c++)h=g[c][0],n.type=g[c][1],m=(s._data(h,"events")||{})[n.type]&&s._data(h,"handle"),m&&m.apply(h,r),m=d&&h[d],m&&s.acceptData(h)&&m.apply(h,r)===!1&&n.preventDefault();return n.type=u,!o&&!n.isDefaultPrevented()&&(!v._default||v._default.apply(i.ownerDocument,r)===!1)&&(u!=="click"||!s.nodeName(i,"a"))&&s.acceptData(i)&&d&&i[u]&&(u!=="focus"&&u!=="blur"||n.target.offsetWidth!==0)&&!s.isWindow(i)&&(p=i[d],p&&(i[d]=null),s.event.triggered=u,i[u](),s.event.triggered=t,p&&(i[d]=p)),n.result}return},dispatch:function(n){n=s.event.fix(n||e.event);var r=(s._data(this,"events")||{})[n.type]||[],i=r.delegateCount,o=[].slice.call(arguments,0),u=!n.exclusive&&!n.namespace,a=s.event.special[n.type]||{},f=[],l,c,h,p,d,v,m,g,y,b,w;o[0]=n,n.delegateTarget=this;if(a.preDispatch&&a.preDispatch.call(this,n)===!1)return;if(i&&(!n.button||n.type!=="click")){p=s(this),p.context=this.ownerDocument||this;for(h=n.target;h!=this;h=h.parentNode||this)if(h.disabled!==!0){v={},g=[],p[0]=h;for(l=0;l<i;l++)y=r[l],b=y.selector,v[b]===t&&(v[b]=y.quick?D(h,y.quick):p.is(b)),v[b]&&g.push(y);g.length&&f.push({elem:h,matches:g})}}r.length>i&&f.push({elem:this,matches:r.slice(i)});for(l=0;l<f.length&&!n.isPropagationStopped();l++){m=f[l],n.currentTarget=m.elem;for(c=0;c<m.matches.length&&!n.isImmediatePropagationStopped();c++){y=m.matches[c];if(u||!n.namespace&&!y.namespace||n.namespace_re&&n.namespace_re.test(y.namespace))n.data=
y.data,n.handleObj=y,d=((s.event.special[y.origType]||{}).handle||y.handler).apply(m.elem,o),d!==t&&(n.result=d,d===!1&&(n.preventDefault(),n.stopPropagation()))}}return a.postDispatch&&a.postDispatch.call(this,n),n.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,r){var i,s,o,u=r.button,a=r.fromElement;return e.pageX==null&&r.clientX!=null&&(i=e.target.ownerDocument||n,s=i.documentElement,o=i.body,e.pageX=r.clientX+(s&&s.scrollLeft||o&&o.scrollLeft||0)-(s&&s.clientLeft||o&&o.clientLeft||0),e.pageY=r.clientY+(s&&s.scrollTop||o&&o.scrollTop||0)-(s&&s.clientTop||o&&o.clientTop||0)),!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?r.toElement:a),!e.which&&u!==t&&(e.which=u&1?1:u&2?3:u&4?2:0),e}},fix:function(e){if(e[s.expando])return e;var r,i,o=e,u=s.event.fixHooks[e.type]||{},a=u.props?this.props.concat(u.props):this.props;e=s.Event(o);for(r=a.length;r;)i=a[--r],e[i]=o[i];return e.target||(e.target=o.srcElement||n),e.target.nodeType===3&&(e.target=e.target.parentNode),e.metaKey===t&&(e.metaKey=e.ctrlKey),u.filter?u.filter(e,o):e},special:{ready:{setup:s.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"
},beforeunload:{setup:function(e,t,n){s.isWindow(this)&&(this.onbeforeunload=n)},teardown:function(e,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(e,t,n,r){var i=s.extend(new s.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?s.event.trigger(i,null,t):s.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},s.event.handle=s.event.dispatch,s.removeEvent=n.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){e.detachEvent&&e.detachEvent("on"+t,n)},s.Event=function(e,t){if(!(this instanceof s.Event))return new s.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?B:H):this.type=e,t&&s.extend(this,t),this.timeStamp=e&&e.timeStamp||s.now(),this[s.expando]=!0},s.Event.prototype={preventDefault:function(){this.isDefaultPrevented=B;var e=this.originalEvent;if(!e)return;e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(){this.isPropagationStopped=B;var e=this.originalEvent;if(!e)return;e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=B,this.stopPropagation()},isDefaultPrevented:H,isPropagationStopped:H,isImmediatePropagationStopped:H},s.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){s.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n=this,r=e.relatedTarget,i=e.handleObj,o=i.selector,u;if(!r||r!==n&&!s.contains(n,r))e.type=i.origType
,u=i.handler.apply(this,arguments),e.type=t;return u}}}),s.support.submitBubbles||(s.event.special.submit={setup:function(){if(s.nodeName(this,"form"))return!1;s.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=s.nodeName(n,"input")||s.nodeName(n,"button")?n.form:t;r&&!r._submit_attached&&(s.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),r._submit_attached=!0)})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&s.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){if(s.nodeName(this,"form"))return!1;s.event.remove(this,"._submit")}}),s.support.changeBubbles||(s.event.special.change={setup:function(){if(N.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")s.event.add(this,"propertychange._change",function(e){e.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),s.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1,s.event.simulate("change",this,e,!0))});return!1}s.event.add(this,"beforeactivate._change",function(e){var t=e.target;N.test(t.nodeName)&&!t._change_attached&&(s.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&s.event.simulate("change",this.parentNode,e,!0)}),t._change_attached=!0)})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||t.type!=="radio"&&t.type!=="checkbox")return e.handleObj.handler.apply(this,arguments)},teardown:function(){return s.event.remove(this,"._change"),N.test(this.nodeName)}}),s.support.focusinBubbles||
s.each({focus:"focusin",blur:"focusout"},function(e,t){var r=0,i=function(e){s.event.simulate(t,e.target,s.event.fix(e),!0)};s.event.special[t]={setup:function(){r++===0&&n.addEventListener(e,i,!0)},teardown:function(){--r===0&&n.removeEventListener(e,i,!0)}}}),s.fn.extend({on:function(e,n,r,i,o){var u,a;if(typeof e=="object"){typeof n!="string"&&(r=r||n,n=t);for(a in e)this.on(a,n,r,e[a],o);return this}r==null&&i==null?(i=n,r=n=t):i==null&&(typeof n=="string"?(i=r,r=t):(i=r,r=n,n=t));if(i===!1)i=H;else if(!i)return this;return o===1&&(u=i,i=function(e){return s().off(e),u.apply(this,arguments)},i.guid=u.guid||(u.guid=s.guid++)),this.each(function(){s.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){if(e&&e.preventDefault&&e.handleObj){var i=e.handleObj;return s(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this}if(typeof e=="object"){for(var o in e)this.off(o,n,e[o]);return this}if(n===!1||typeof n=="function")r=n,n=t;return r===!1&&(r=H),this.each(function(){s.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,n){return s(this.context).on(e,this.selector,t,n),this},die:function(e,t){return s(this.context).off(e,this.selector||"**",t),this},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length==1?this.off(e,"**"):this.off(t,e,n)},trigger:function(e,t){return this.each(function(){s.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this
[0])return s.event.trigger(e,t,this[0],!0)},toggle:function(e){var t=arguments,n=e.guid||s.guid++,r=0,i=function(n){var i=(s._data(this,"lastToggle"+e.guid)||0)%r;return s._data(this,"lastToggle"+e.guid,i+1),n.preventDefault(),t[i].apply(this,arguments)||!1};i.guid=n;while(r<t.length)t[r++].guid=n;return this.click(i)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),s.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){s.fn[t]=function(e,n){return n==null&&(n=e,e=null),arguments.length>0?this.on(t,null,e,n):this.trigger(t)},s.attrFn&&(s.attrFn[t]=!0),L.test(t)&&(s.event.fixHooks[t]=s.event.keyHooks),A.test(t)&&(s.event.fixHooks[t]=s.event.mouseHooks)}),function(){function S(e,t,n,i,s,o){for(var u=0,a=i.length;u<a;u++){var f=i[u];if(f){var l=!1;f=f[e];while(f){if(f[r]===n){l=i[f.sizset];break}f.nodeType===1&&!o&&(f[r]=n,f.sizset=u);if(f.nodeName.toLowerCase()===t){l=f;break}f=f[e]}i[u]=l}}}function x(e,t,n,i,s,o){for(var u=0,a=i.length;u<a;u++){var f=i[u];if(f){var l=!1;f=f[e];while(f){if(f[r]===n){l=i[f.sizset];break}if(f.nodeType===1){o||(f[r]=n,f.sizset=u);if(typeof t!="string"){if(f===t){l=!0;break}}else if(h.filter(t,[f]).length>0){l=f;break}}f=f[e]}i[u]=l}}}var e=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,r="sizcache"+(Math.random()+"").replace(".",""),i=0,o=Object.prototype.toString,u=!1
,a=!0,f=/\\/g,l=/\r\n/g,c=/\W/;[0,0].sort(function(){return a=!1,0});var h=function(t,r,i,s){i=i||[],r=r||n;var u=r;if(r.nodeType!==1&&r.nodeType!==9)return[];if(!t||typeof t!="string")return i;var a,f,l,c,p,m,g,b,w=!0,E=h.isXML(r),S=[],x=t;do{e.exec(""),a=e.exec(x);if(a){x=a[3],S.push(a[1]);if(a[2]){c=a[3];break}}}while(a);if(S.length>1&&v.exec(t))if(S.length===2&&d.relative[S[0]])f=T(S[0]+S[1],r,s);else{f=d.relative[S[0]]?[r]:h(S.shift(),r);while(S.length)t=S.shift(),d.relative[t]&&(t+=S.shift()),f=T(t,f,s)}else{!s&&S.length>1&&r.nodeType===9&&!E&&d.match.ID.test(S[0])&&!d.match.ID.test(S[S.length-1])&&(p=h.find(S.shift(),r,E),r=p.expr?h.filter(p.expr,p.set)[0]:p.set[0]);if(r){p=s?{expr:S.pop(),set:y(s)}:h.find(S.pop(),S.length!==1||S[0]!=="~"&&S[0]!=="+"||!r.parentNode?r:r.parentNode,E),f=p.expr?h.filter(p.expr,p.set):p.set,S.length>0?l=y(f):w=!1;while(S.length)m=S.pop(),g=m,d.relative[m]?g=S.pop():m="",g==null&&(g=r),d.relative[m](l,g,E)}else l=S=[]}l||(l=f),l||h.error(m||t);if(o.call(l)==="[object Array]")if(!w)i.push.apply(i,l);else if(r&&r.nodeType===1)for(b=0;l[b]!=null;b++)l[b]&&(l[b]===!0||l[b].nodeType===1&&h.contains(r,l[b]))&&i.push(f[b]);else for(b=0;l[b]!=null;b++)l[b]&&l[b].nodeType===1&&i.push(f[b]);else y(l,i);return c&&(h(c,u,i,s),h.uniqueSort(i)),i};h.uniqueSort=function(e){if(w){u=a,e.sort(w);if(u)for(var t=1;t<e.length;t++)e[t]===e[t-1]&&e.splice(t--,1)}return e},h.matches=function(e,t){return h(e,null,null,t)},h.matchesSelector=function(e,t){return h(t,null,null,[e]).length>0},h.find=function(e,t,n){var r,i,s,o,u,a;if(!e)return[];for(i=0,s=d.order.length
;i<s;i++){u=d.order[i];if(o=d.leftMatch[u].exec(e)){a=o[1],o.splice(1,1);if(a.substr(a.length-1)!=="\\"){o[1]=(o[1]||"").replace(f,""),r=d.find[u](o,t,n);if(r!=null){e=e.replace(d.match[u],"");break}}}}return r||(r=typeof t.getElementsByTagName!="undefined"?t.getElementsByTagName("*"):[]),{set:r,expr:e}},h.filter=function(e,n,r,i){var s,o,u,a,f,l,c,p,v,m=e,g=[],y=n,b=n&&n[0]&&h.isXML(n[0]);while(e&&n.length){for(u in d.filter)if((s=d.leftMatch[u].exec(e))!=null&&s[2]){l=d.filter[u],c=s[1],o=!1,s.splice(1,1);if(c.substr(c.length-1)==="\\")continue;y===g&&(g=[]);if(d.preFilter[u]){s=d.preFilter[u](s,y,r,g,i,b);if(!s)o=a=!0;else if(s===!0)continue}if(s)for(p=0;(f=y[p])!=null;p++)f&&(a=l(f,s,p,y),v=i^a,r&&a!=null?v?o=!0:y[p]=!1:v&&(g.push(f),o=!0));if(a!==t){r||(y=g),e=e.replace(d.match[u],"");if(!o)return[];break}}if(e===m){if(o!=null)break;h.error(e)}m=e}return y},h.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)};var p=h.getText=function(e){var t,n,r=e.nodeType,i="";if(r){if(r===1||r===9||r===11){if(typeof e.textContent=="string")return e.textContent;if(typeof e.innerText=="string")return e.innerText.replace(l,"");for(e=e.firstChild;e;e=e.nextSibling)i+=p(e)}else if(r===3||r===4)return e.nodeValue}else for(t=0;n=e[t];t++)n.nodeType!==8&&(i+=p(n));return i},d=h.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/
,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(e){return e.getAttribute("href")},type:function(e){return e.getAttribute("type")}},relative:{"+":function(e,t){var n=typeof t=="string",r=n&&!c.test(t),i=n&&!r;r&&(t=t.toLowerCase());for(var s=0,o=e.length,u;s<o;s++)if(u=e[s]){while((u=u.previousSibling)&&u.nodeType!==1);e[s]=i||u&&u.nodeName.toLowerCase()===t?u||!1:u===t}i&&h.filter(t,e,!0)},">":function(e,t){var n,r=typeof t=="string",i=0,s=e.length;if(r&&!c.test(t)){t=t.toLowerCase();for(;i<s;i++){n=e[i];if(n){var o=n.parentNode;e[i]=o.nodeName.toLowerCase()===t?o:!1}}}else{for(;i<s;i++)n=e[i],n&&(e[i]=r?n.parentNode:n.parentNode===t);r&&h.filter(t,e,!0)}},"":function(e,t,n){var r,s=i++,o=x;typeof t=="string"&&!c.test(t)&&(t=t.toLowerCase(),r=t,o=S),o("parentNode",t,s,e,r,n)},"~":function(e,t,n){var r,s=i++,o=x;typeof t=="string"&&!c.test(t)&&(t=t.toLowerCase(),r=t,o=S),o("previousSibling",t,s,e,r,n)}},find:{ID:function(e,t,n){if(typeof t.getElementById!="undefined"&&!n){var r=t.getElementById(e[1]);return r&&r.parentNode?[r]:[]}},NAME:function(e,t){if(typeof t.getElementsByName!="undefined"){var n=[],r=t.getElementsByName(e[1]);for(var i=0,s=r.length;i<s;i++)r[i].getAttribute("name")===e[1]&&n.push(r[i]);return n.length===0?null:n}},TAG:function(
e,t){if(typeof t.getElementsByTagName!="undefined")return t.getElementsByTagName(e[1])}},preFilter:{CLASS:function(e,t,n,r,i,s){e=" "+e[1].replace(f,"")+" ";if(s)return e;for(var o=0,u;(u=t[o])!=null;o++)u&&(i^(u.className&&(" "+u.className+" ").replace(/[\t\n\r]/g," ").indexOf(e)>=0)?n||r.push(u):n&&(t[o]=!1));return!1},ID:function(e){return e[1].replace(f,"")},TAG:function(e,t){return e[1].replace(f,"").toLowerCase()},CHILD:function(e){if(e[1]==="nth"){e[2]||h.error(e[0]),e[2]=e[2].replace(/^\+|\s*/g,"");var t=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(e[2]==="even"&&"2n"||e[2]==="odd"&&"2n+1"||!/\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=t[1]+(t[2]||1)-0,e[3]=t[3]-0}else e[2]&&h.error(e[0]);return e[0]=i++,e},ATTR:function(e,t,n,r,i,s){var o=e[1]=e[1].replace(f,"");return!s&&d.attrMap[o]&&(e[1]=d.attrMap[o]),e[4]=(e[4]||e[5]||"").replace(f,""),e[2]==="~="&&(e[4]=" "+e[4]+" "),e},PSEUDO:function(t,n,r,i,s){if(t[1]==="not"){if(!((e.exec(t[3])||"").length>1||/^\w/.test(t[3]))){var o=h.filter(t[3],n,r,!0^s);return r||i.push.apply(i,o),!1}t[3]=h(t[3],null,null,n)}else if(d.match.POS.test(t[0])||d.match.CHILD.test(t[0]))return!0;return t},POS:function(e){return e.unshift(!0),e}},filters:{enabled:function(e){return e.disabled===!1&&e.type!=="hidden"},disabled:function(e){return e.disabled===!0},checked:function(e){return e.checked===!0},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},parent:function(e){return!!e.firstChild},empty:function(e){return!e.firstChild},has:function(e,t,n){return!!h(n[3],e).length},header:function(e){return/h\d/i.test(e.nodeName
)},text:function(e){var t=e.getAttribute("type"),n=e.type;return e.nodeName.toLowerCase()==="input"&&"text"===n&&(t===n||t===null)},radio:function(e){return e.nodeName.toLowerCase()==="input"&&"radio"===e.type},checkbox:function(e){return e.nodeName.toLowerCase()==="input"&&"checkbox"===e.type},file:function(e){return e.nodeName.toLowerCase()==="input"&&"file"===e.type},password:function(e){return e.nodeName.toLowerCase()==="input"&&"password"===e.type},submit:function(e){var t=e.nodeName.toLowerCase();return(t==="input"||t==="button")&&"submit"===e.type},image:function(e){return e.nodeName.toLowerCase()==="input"&&"image"===e.type},reset:function(e){var t=e.nodeName.toLowerCase();return(t==="input"||t==="button")&&"reset"===e.type},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&"button"===e.type||t==="button"},input:function(e){return/input|select|textarea|button/i.test(e.nodeName)},focus:function(e){return e===e.ownerDocument.activeElement}},setFilters:{first:function(e,t){return t===0},last:function(e,t,n,r){return t===r.length-1},even:function(e,t){return t%2===0},odd:function(e,t){return t%2===1},lt:function(e,t,n){return t<n[3]-0},gt:function(e,t,n){return t>n[3]-0},nth:function(e,t,n){return n[3]-0===t},eq:function(e,t,n){return n[3]-0===t}},filter:{PSEUDO:function(e,t,n,r){var i=t[1],s=d.filters[i];if(s)return s(e,n,t,r);if(i==="contains")return(e.textContent||e.innerText||p([e])||"").indexOf(t[3])>=0;if(i==="not"){var o=t[3];for(var u=0,a=o.length;u<a;u++)if(o[u]===e)return!1;return!0}h.error(i)},CHILD:function(e,t){var n,i,s,o,u,a,f,l=t[1],c=
e;switch(l){case"only":case"first":while(c=c.previousSibling)if(c.nodeType===1)return!1;if(l==="first")return!0;c=e;case"last":while(c=c.nextSibling)if(c.nodeType===1)return!1;return!0;case"nth":n=t[2],i=t[3];if(n===1&&i===0)return!0;s=t[0],o=e.parentNode;if(o&&(o[r]!==s||!e.nodeIndex)){a=0;for(c=o.firstChild;c;c=c.nextSibling)c.nodeType===1&&(c.nodeIndex=++a);o[r]=s}return f=e.nodeIndex-i,n===0?f===0:f%n===0&&f/n>=0}},ID:function(e,t){return e.nodeType===1&&e.getAttribute("id")===t},TAG:function(e,t){return t==="*"&&e.nodeType===1||!!e.nodeName&&e.nodeName.toLowerCase()===t},CLASS:function(e,t){return(" "+(e.className||e.getAttribute("class"))+" ").indexOf(t)>-1},ATTR:function(e,t){var n=t[1],r=h.attr?h.attr(e,n):d.attrHandle[n]?d.attrHandle[n](e):e[n]!=null?e[n]:e.getAttribute(n),i=r+"",s=t[2],o=t[4];return r==null?s==="!=":!s&&h.attr?r!=null:s==="="?i===o:s==="*="?i.indexOf(o)>=0:s==="~="?(" "+i+" ").indexOf(o)>=0:o?s==="!="?i!==o:s==="^="?i.indexOf(o)===0:s==="$="?i.substr(i.length-o.length)===o:s==="|="?i===o||i.substr(0,o.length+1)===o+"-":!1:i&&r!==!1},POS:function(e,t,n,r){var i=t[2],s=d.setFilters[i];if(s)return s(e,n,t,r)}}},v=d.match.POS,m=function(e,t){return"\\"+(t-0+1)};for(var g in d.match)d.match[g]=new RegExp(d.match[g].source+/(?![^\[]*\])(?![^\(]*\))/.source),d.leftMatch[g]=new RegExp(/(^(?:.|\r|\n)*?)/.source+d.match[g].source.replace(/\\(\d+)/g,m));d.match.globalPOS=v;var y=function(e,t){return e=Array.prototype.slice.call(e,0),t?(t.push.apply(t,e),t):e};try{Array.prototype.slice.call(n.documentElement.childNodes,0)[0].nodeType}catch(b){y=function(e,t){var n=0
,r=t||[];if(o.call(e)==="[object Array]")Array.prototype.push.apply(r,e);else if(typeof e.length=="number")for(var i=e.length;n<i;n++)r.push(e[n]);else for(;e[n];n++)r.push(e[n]);return r}}var w,E;n.documentElement.compareDocumentPosition?w=function(e,t){return e===t?(u=!0,0):!e.compareDocumentPosition||!t.compareDocumentPosition?e.compareDocumentPosition?-1:1:e.compareDocumentPosition(t)&4?-1:1}:(w=function(e,t){if(e===t)return u=!0,0;if(e.sourceIndex&&t.sourceIndex)return e.sourceIndex-t.sourceIndex;var n,r,i=[],s=[],o=e.parentNode,a=t.parentNode,f=o;if(o===a)return E(e,t);if(!o)return-1;if(!a)return 1;while(f)i.unshift(f),f=f.parentNode;f=a;while(f)s.unshift(f),f=f.parentNode;n=i.length,r=s.length;for(var l=0;l<n&&l<r;l++)if(i[l]!==s[l])return E(i[l],s[l]);return l===n?E(e,s[l],-1):E(i[l],t,1)},E=function(e,t,n){if(e===t)return n;var r=e.nextSibling;while(r){if(r===t)return-1;r=r.nextSibling}return 1}),function(){var e=n.createElement("div"),r="script"+(new Date).getTime(),i=n.documentElement;e.innerHTML="<a name='"+r+"'/>",i.insertBefore(e,i.firstChild),n.getElementById(r)&&(d.find.ID=function(e,n,r){if(typeof n.getElementById!="undefined"&&!r){var i=n.getElementById(e[1]);return i?i.id===e[1]||typeof i.getAttributeNode!="undefined"&&i.getAttributeNode("id").nodeValue===e[1]?[i]:t:[]}},d.filter.ID=function(e,t){var n=typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id");return e.nodeType===1&&n&&n.nodeValue===t}),i.removeChild(e),i=e=null}(),function(){var e=n.createElement("div");e.appendChild(n.createComment("")),e.getElementsByTagName("*").length>0&&(d.find
.TAG=function(e,t){var n=t.getElementsByTagName(e[1]);if(e[1]==="*"){var r=[];for(var i=0;n[i];i++)n[i].nodeType===1&&r.push(n[i]);n=r}return n}),e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!="undefined"&&e.firstChild.getAttribute("href")!=="#"&&(d.attrHandle.href=function(e){return e.getAttribute("href",2)}),e=null}(),n.querySelectorAll&&function(){var e=h,t=n.createElement("div"),r="__sizzle__";t.innerHTML="<p class='TEST'></p>";if(t.querySelectorAll&&t.querySelectorAll(".TEST").length===0)return;h=function(t,i,s,o){i=i||n;if(!o&&!h.isXML(i)){var u=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(t);if(u&&(i.nodeType===1||i.nodeType===9)){if(u[1])return y(i.getElementsByTagName(t),s);if(u[2]&&d.find.CLASS&&i.getElementsByClassName)return y(i.getElementsByClassName(u[2]),s)}if(i.nodeType===9){if(t==="body"&&i.body)return y([i.body],s);if(u&&u[3]){var a=i.getElementById(u[3]);if(!a||!a.parentNode)return y([],s);if(a.id===u[3])return y([a],s)}try{return y(i.querySelectorAll(t),s)}catch(f){}}else if(i.nodeType===1&&i.nodeName.toLowerCase()!=="object"){var l=i,c=i.getAttribute("id"),p=c||r,v=i.parentNode,m=/^\s*[+~]/.test(t);c?p=p.replace(/'/g,"\\$&"):i.setAttribute("id",p),m&&v&&(i=i.parentNode);try{if(!m||v)return y(i.querySelectorAll("[id='"+p+"'] "+t),s)}catch(g){}finally{c||l.removeAttribute("id")}}}return e(t,i,s,o)};for(var i in e)h[i]=e[i];t=null}(),function(){var e=n.documentElement,t=e.matchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.msMatchesSelector;if(t){var r=!t.call(n.createElement("div"),"div"),i=!1;try{t.call(n.documentElement
,"[test!='']:sizzle")}catch(s){i=!0}h.matchesSelector=function(e,n){n=n.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!h.isXML(e))try{if(i||!d.match.PSEUDO.test(n)&&!/!=/.test(n)){var s=t.call(e,n);if(s||!r||e.document&&e.document.nodeType!==11)return s}}catch(o){}return h(n,null,null,[e]).length>0}}}(),function(){var e=n.createElement("div");e.innerHTML="<div class='test e'></div><div class='test'></div>";if(!e.getElementsByClassName||e.getElementsByClassName("e").length===0)return;e.lastChild.className="e";if(e.getElementsByClassName("e").length===1)return;d.order.splice(1,0,"CLASS"),d.find.CLASS=function(e,t,n){if(typeof t.getElementsByClassName!="undefined"&&!n)return t.getElementsByClassName(e[1])},e=null}(),n.documentElement.contains?h.contains=function(e,t){return e!==t&&(e.contains?e.contains(t):!0)}:n.documentElement.compareDocumentPosition?h.contains=function(e,t){return!!(e.compareDocumentPosition(t)&16)}:h.contains=function(){return!1},h.isXML=function(e){var t=(e?e.ownerDocument||e:0).documentElement;return t?t.nodeName!=="HTML":!1};var T=function(e,t,n){var r,i=[],s="",o=t.nodeType?[t]:t;while(r=d.match.PSEUDO.exec(e))s+=r[0],e=e.replace(d.match.PSEUDO,"");e=d.relative[e]?e+"*":e;for(var u=0,a=o.length;u<a;u++)h(e,o[u],i,n);return h.filter(s,i)};h.attr=s.attr,h.selectors.attrMap={},s.find=h,s.expr=h.selectors,s.expr[":"]=s.expr.filters,s.unique=h.uniqueSort,s.text=h.getText,s.isXMLDoc=h.isXML,s.contains=h.contains}();var j=/Until$/,F=/^(?:parents|prevUntil|prevAll)/,I=/,/,q=/^.[^:#\[\.,]*$/,R=Array.prototype.slice,U=s.expr.match.globalPOS,z={children:!0,contents
:!0,next:!0,prev:!0};s.fn.extend({find:function(e){var t=this,n,r;if(typeof e!="string")return s(e).filter(function(){for(n=0,r=t.length;n<r;n++)if(s.contains(t[n],this))return!0});var i=this.pushStack("","find",e),o,u,a;for(n=0,r=this.length;n<r;n++){o=i.length,s.find(e,this[n],i);if(n>0)for(u=o;u<i.length;u++)for(a=0;a<o;a++)if(i[a]===i[u]){i.splice(u--,1);break}}return i},has:function(e){var t=s(e);return this.filter(function(){for(var e=0,n=t.length;e<n;e++)if(s.contains(this,t[e]))return!0})},not:function(e){return this.pushStack(X(this,e,!1),"not",e)},filter:function(e){return this.pushStack(X(this,e,!0),"filter",e)},is:function(e){return!!e&&(typeof e=="string"?U.test(e)?s(e,this.context).index(this[0])>=0:s.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n=[],r,i,o=this[0];if(s.isArray(e)){var u=1;while(o&&o.ownerDocument&&o!==t){for(r=0;r<e.length;r++)s(o).is(e[r])&&n.push({selector:e[r],elem:o,level:u});o=o.parentNode,u++}return n}var a=U.test(e)||typeof e!="string"?s(e,t||this.context):0;for(r=0,i=this.length;r<i;r++){o=this[r];while(o){if(a?a.index(o)>-1:s.find.matchesSelector(o,e)){n.push(o);break}o=o.parentNode;if(!o||!o.ownerDocument||o===t||o.nodeType===11)break}}return n=n.length>1?s.unique(n):n,this.pushStack(n,"closest",e)},index:function(e){return e?typeof e=="string"?s.inArray(this[0],s(e)):s.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(e,t){var n=typeof e=="string"?s(e,t):s.makeArray(e&&e.nodeType?[e]:e),r=s.merge(this.get(),n);return this.pushStack(W(n[0])||W(r[0])?r:s.unique
(r))},andSelf:function(){return this.add(this.prevObject)}}),s.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return s.dir(e,"parentNode")},parentsUntil:function(e,t,n){return s.dir(e,"parentNode",n)},next:function(e){return s.nth(e,2,"nextSibling")},prev:function(e){return s.nth(e,2,"previousSibling")},nextAll:function(e){return s.dir(e,"nextSibling")},prevAll:function(e){return s.dir(e,"previousSibling")},nextUntil:function(e,t,n){return s.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return s.dir(e,"previousSibling",n)},siblings:function(e){return s.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return s.sibling(e.firstChild)},contents:function(e){return s.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:s.makeArray(e.childNodes)}},function(e,t){s.fn[e]=function(n,r){var i=s.map(this,t,n);return j.test(e)||(r=n),r&&typeof r=="string"&&(i=s.filter(r,i)),i=this.length>1&&!z[e]?s.unique(i):i,(this.length>1||I.test(r))&&F.test(e)&&(i=i.reverse()),this.pushStack(i,e,R.call(arguments).join(","))}}),s.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),t.length===1?s.find.matchesSelector(t[0],e)?[t[0]]:[]:s.find.matches(e,t)},dir:function(e,n,r){var i=[],o=e[n];while(o&&o.nodeType!==9&&(r===t||o.nodeType!==1||!s(o).is(r)))o.nodeType===1&&i.push(o),o=o[n];return i},nth:function(e,t,n,r){t=t||1;var i=0;for(;e;e=e[n])if(e.nodeType===1&&++i===t)break;return e},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}});var $="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video"
,J=/ jQuery\d+="(?:\d+|null)"/g,K=/^\s+/,Q=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,G=/<([\w:]+)/,Y=/<tbody/i,Z=/<|&#?\w+;/,et=/<(?:script|style)/i,tt=/<(?:script|object|embed|option|style)/i,nt=new RegExp("<(?:"+$+")[\\s/>]","i"),rt=/checked\s*(?:[^=]|=\s*.checked.)/i,it=/\/(java|ecma)script/i,st=/^\s*<!(?:\[CDATA\[|\-\-)/,ot={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},ut=V(n);ot.optgroup=ot.option,ot.tbody=ot.tfoot=ot.colgroup=ot.caption=ot.thead,ot.th=ot.td,s.support.htmlSerialize||(ot._default=[1,"div<div>","</div>"]),s.fn.extend({text:function(e){return s.access(this,function(e){return e===t?s.text(this):this.empty().append((this[0]&&this[0].ownerDocument||n).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(s.isFunction(e))return this.each(function(t){s(this).wrapAll(e.call(this,t))});if(this[0]){var t=s(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return s.isFunction(e)?this.each(function(t){s(this).wrapInner(e.call(this,t))}):this.each(function(){var t=s(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=s.isFunction(e);return this
.each(function(n){s(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){s.nodeName(this,"body")||s(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){this.nodeType===1&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){this.nodeType===1&&this.insertBefore(e,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this)});if(arguments.length){var e=s.clean(arguments);return e.push.apply(e,this.toArray()),this.pushStack(e,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this.nextSibling)});if(arguments.length){var e=this.pushStack(this,"after",arguments);return e.push.apply(e,s.clean(arguments)),e}},remove:function(e,t){for(var n=0,r;(r=this[n])!=null;n++)if(!e||s.filter(e,[r]).length)!t&&r.nodeType===1&&(s.cleanData(r.getElementsByTagName("*")),s.cleanData([r])),r.parentNode&&r.parentNode.removeChild(r);return this},empty:function(){for(var e=0,t;(t=this[e])!=null;e++){t.nodeType===1&&s.cleanData(t.getElementsByTagName("*"));while(t.firstChild)t.removeChild(t.firstChild)}return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return s.clone(this,e,t)})},html:function(e){return s.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return n.nodeType===1?n.innerHTML.replace(J,""):null;if(typeof e=="string"&&!et.test
(e)&&(s.support.leadingWhitespace||!K.test(e))&&!ot[(G.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(Q,"<$1></$2>");try{for(;r<i;r++)n=this[r]||{},n.nodeType===1&&(s.cleanData(n.getElementsByTagName("*")),n.innerHTML=e);n=0}catch(o){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){return this[0]&&this[0].parentNode?s.isFunction(e)?this.each(function(t){var n=s(this),r=n.html();n.replaceWith(e.call(this,t,r))}):(typeof e!="string"&&(e=s(e).detach()),this.each(function(){var t=this.nextSibling,n=this.parentNode;s(this).remove(),t?s(t).before(e):s(n).append(e)})):this.length?this.pushStack(s(s.isFunction(e)?e():e),"replaceWith",e):this},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){var i,o,u,a,f=e[0],l=[];if(!s.support.checkClone&&arguments.length===3&&typeof f=="string"&&rt.test(f))return this.each(function(){s(this).domManip(e,n,r,!0)});if(s.isFunction(f))return this.each(function(i){var o=s(this);e[0]=f.call(this,i,n?o.html():t),o.domManip(e,n,r)});if(this[0]){a=f&&f.parentNode,s.support.parentNode&&a&&a.nodeType===11&&a.childNodes.length===this.length?i={fragment:a}:i=s.buildFragment(e,this,l),u=i.fragment,u.childNodes.length===1?o=u=u.firstChild:o=u.firstChild;if(o){n=n&&s.nodeName(o,"tr");for(var c=0,h=this.length,p=h-1;c<h;c++)r.call(n?at(this[c],o):this[c],i.cacheable||h>1&&c<p?s.clone(u,!0,!0):u)}l.length&&s.each(l,function(e,t){t.src?s.ajax({type:"GET",global:!1,url:t.src,async:!1,dataType:"script"}):s.globalEval((t.text||t.textContent||t.innerHTML||"").replace(st,"/*$0*/")),t.parentNode&&t.parentNode.removeChild
(t)})}return this}}),s.buildFragment=function(e,t,r){var i,o,u,a,f=e[0];return t&&t[0]&&(a=t[0].ownerDocument||t[0]),a.createDocumentFragment||(a=n),e.length===1&&typeof f=="string"&&f.length<512&&a===n&&f.charAt(0)==="<"&&!tt.test(f)&&(s.support.checkClone||!rt.test(f))&&(s.support.html5Clone||!nt.test(f))&&(o=!0,u=s.fragments[f],u&&u!==1&&(i=u)),i||(i=a.createDocumentFragment(),s.clean(e,a,i,r)),o&&(s.fragments[f]=u?i:1),{fragment:i,cacheable:o}},s.fragments={},s.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){s.fn[e]=function(n){var r=[],i=s(n),o=this.length===1&&this[0].parentNode;if(o&&o.nodeType===11&&o.childNodes.length===1&&i.length===1)return i[t](this[0]),this;for(var u=0,a=i.length;u<a;u++){var f=(u>0?this.clone(!0):this).get();s(i[u])[t](f),r=r.concat(f)}return this.pushStack(r,e,i.selector)}}),s.extend({clone:function(e,t,n){var r,i,o,u=s.support.html5Clone||s.isXMLDoc(e)||!nt.test("<"+e.nodeName+">")?e.cloneNode(!0):dt(e);if((!s.support.noCloneEvent||!s.support.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!s.isXMLDoc(e)){lt(e,u),r=ct(e),i=ct(u);for(o=0;r[o];++o)i[o]&&lt(r[o],i[o])}if(t){ft(e,u);if(n){r=ct(e),i=ct(u);for(o=0;r[o];++o)ft(r[o],i[o])}}return r=i=null,u},clean:function(e,t,r,i){var o,u,a,f=[];t=t||n,typeof t.createElement=="undefined"&&(t=t.ownerDocument||t[0]&&t[0].ownerDocument||n);for(var l=0,c;(c=e[l])!=null;l++){typeof c=="number"&&(c+="");if(!c)continue;if(typeof c=="string")if(!Z.test(c))c=t.createTextNode(c);else{c=c.replace(Q,"<$1></$2>");var h=(G.exec(c)||
["",""])[1].toLowerCase(),p=ot[h]||ot._default,d=p[0],v=t.createElement("div"),m=ut.childNodes,g;t===n?ut.appendChild(v):V(t).appendChild(v),v.innerHTML=p[1]+c+p[2];while(d--)v=v.lastChild;if(!s.support.tbody){var y=Y.test(c),b=h==="table"&&!y?v.firstChild&&v.firstChild.childNodes:p[1]==="<table>"&&!y?v.childNodes:[];for(a=b.length-1;a>=0;--a)s.nodeName(b[a],"tbody")&&!b[a].childNodes.length&&b[a].parentNode.removeChild(b[a])}!s.support.leadingWhitespace&&K.test(c)&&v.insertBefore(t.createTextNode(K.exec(c)[0]),v.firstChild),c=v.childNodes,v&&(v.parentNode.removeChild(v),m.length>0&&(g=m[m.length-1],g&&g.parentNode&&g.parentNode.removeChild(g)))}var w;if(!s.support.appendChecked)if(c[0]&&typeof (w=c.length)=="number")for(a=0;a<w;a++)pt(c[a]);else pt(c);c.nodeType?f.push(c):f=s.merge(f,c)}if(r){o=function(e){return!e.type||it.test(e.type)};for(l=0;f[l];l++){u=f[l];if(i&&s.nodeName(u,"script")&&(!u.type||it.test(u.type)))i.push(u.parentNode?u.parentNode.removeChild(u):u);else{if(u.nodeType===1){var E=s.grep(u.getElementsByTagName("script"),o);f.splice.apply(f,[l+1,0].concat(E))}r.appendChild(u)}}}return f},cleanData:function(e){var t,n,r=s.cache,i=s.event.special,o=s.support.deleteExpando;for(var u=0,a;(a=e[u])!=null;u++){if(a.nodeName&&s.noData[a.nodeName.toLowerCase()])continue;n=a[s.expando];if(n){t=r[n];if(t&&t.events){for(var f in t.events)i[f]?s.event.remove(a,f):s.removeEvent(a,f,t.handle);t.handle&&(t.handle.elem=null)}o?delete a[s.expando]:a.removeAttribute&&a.removeAttribute(s.expando),delete r[n]}}}});var vt=/alpha\([^)]*\)/i,mt=/opacity=([^)]*)/,gt=/([A-Z]|^ms)/g,yt=/^[\-+]?(?:\d*\.)?\d+$/i
,bt=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,wt=/^([\-+])=([\-+.\de]+)/,Et=/^margin/,St={position:"absolute",visibility:"hidden",display:"block"},xt=["Top","Right","Bottom","Left"],Tt,Nt,Ct;s.fn.css=function(e,n){return s.access(this,function(e,n,r){return r!==t?s.style(e,n,r):s.css(e,n)},e,n,arguments.length>1)},s.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Tt(e,"opacity");return n===""?"1":n}return e.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":s.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(!e||e.nodeType===3||e.nodeType===8||!e.style)return;var o,u,a=s.camelCase(n),f=e.style,l=s.cssHooks[a];n=s.cssProps[a]||a;if(r===t)return l&&"get"in l&&(o=l.get(e,!1,i))!==t?o:f[n];u=typeof r,u==="string"&&(o=wt.exec(r))&&(r=+(o[1]+1)*+o[2]+parseFloat(s.css(e,n)),u="number");if(r==null||u==="number"&&isNaN(r))return;u==="number"&&!s.cssNumber[a]&&(r+="px");if(!l||!("set"in l)||(r=l.set(e,r))!==t)try{f[n]=r}catch(c){}},css:function(e,n,r){var i,o;n=s.camelCase(n),o=s.cssHooks[n],n=s.cssProps[n]||n,n==="cssFloat"&&(n="float");if(o&&"get"in o&&(i=o.get(e,!0,r))!==t)return i;if(Tt)return Tt(e,n)},swap:function(e,t,n){var r={},i,s;for(s in t)r[s]=e.style[s],e.style[s]=t[s];i=n.call(e);for(s in t)e.style[s]=r[s];return i}}),s.curCSS=s.css,n.defaultView&&n.defaultView.getComputedStyle&&(Nt=function(e,t){var n,r,i,o,u=e.style;return t=t.replace(gt,"-$1").toLowerCase(),(r=e.ownerDocument.defaultView)&&(i=r.getComputedStyle(e,null))&&(n=i.getPropertyValue(t),n===""&&!s.contains
(e.ownerDocument.documentElement,e)&&(n=s.style(e,t))),!s.support.pixelMargin&&i&&Et.test(t)&&bt.test(n)&&(o=u.width,u.width=n,n=i.width,u.width=o),n}),n.documentElement.currentStyle&&(Ct=function(e,t){var n,r,i,s=e.currentStyle&&e.currentStyle[t],o=e.style;return s==null&&o&&(i=o[t])&&(s=i),bt.test(s)&&(n=o.left,r=e.runtimeStyle&&e.runtimeStyle.left,r&&(e.runtimeStyle.left=e.currentStyle.left),o.left=t==="fontSize"?"1em":s,s=o.pixelLeft+"px",o.left=n,r&&(e.runtimeStyle.left=r)),s===""?"auto":s}),Tt=Nt||Ct,s.each(["height","width"],function(e,t){s.cssHooks[t]={get:function(e,n,r){if(n)return e.offsetWidth!==0?kt(e,t,r):s.swap(e,St,function(){return kt(e,t,r)})},set:function(e,t){return yt.test(t)?t+"px":t}}}),s.support.opacity||(s.cssHooks.opacity={get:function(e,t){return mt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?parseFloat(RegExp.$1)/100+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=s.isNumeric(t)?"alpha(opacity="+t*100+")":"",o=r&&r.filter||n.filter||"";n.zoom=1;if(t>=1&&s.trim(o.replace(vt,""))===""){n.removeAttribute("filter");if(r&&!r.filter)return}n.filter=vt.test(o)?o.replace(vt,i):o+" "+i}}),s(function(){s.support.reliableMarginRight||(s.cssHooks.marginRight={get:function(e,t){return s.swap(e,{display:"inline-block"},function(){return t?Tt(e,"margin-right"):e.style.marginRight})}})}),s.expr&&s.expr.filters&&(s.expr.filters.hidden=function(e){var t=e.offsetWidth,n=e.offsetHeight;return t===0&&n===0||!s.support.reliableHiddenOffsets&&(e.style&&e.style.display||s.css(e,"display"))==="none"},s.expr.filters.visible=function(e
){return!s.expr.filters.hidden(e)}),s.each({margin:"",padding:"",border:"Width"},function(e,t){s.cssHooks[e+t]={expand:function(n){var r,i=typeof n=="string"?n.split(" "):[n],s={};for(r=0;r<4;r++)s[e+xt[r]+t]=i[r]||i[r-2]||i[0];return s}}});var Lt={},At,Ot,Mt=/^(?:toggle|show|hide)$/,_t=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,Dt,Pt=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],Ht;s.fn.extend({show:function(e,t,n){var r,i;if(e||e===0)return this.animate(Ft("show",3),e,t,n);for(var o=0,u=this.length;o<u;o++)r=this[o],r.style&&(i=r.style.display,!s._data(r,"olddisplay")&&i==="none"&&(i=r.style.display=""),(i===""&&s.css(r,"display")==="none"||!s.contains(r.ownerDocument.documentElement,r))&&s._data(r,"olddisplay",It(r.nodeName)));for(o=0;o<u;o++){r=this[o];if(r.style){i=r.style.display;if(i===""||i==="none")r.style.display=s._data(r,"olddisplay")||""}}return this},hide:function(e,t,n){if(e||e===0)return this.animate(Ft("hide",3),e,t,n);var r,i,o=0,u=this.length;for(;o<u;o++)r=this[o],r.style&&(i=s.css(r,"display"),i!=="none"&&!s._data(r,"olddisplay")&&s._data(r,"olddisplay",i));for(o=0;o<u;o++)this[o].style&&(this[o].style.display="none");return this},_toggle:s.fn.toggle,toggle:function(e,t,n){var r=typeof e=="boolean";return s.isFunction(e)&&s.isFunction(t)?this._toggle.apply(this,arguments):e==null||r?this.each(function(){var t=r?e:s(this).is(":hidden");s(this)[t?"show":"hide"]()}):this.animate(Ft("toggle",3),e,t,n),this},fadeTo:function(e,t,n,r){return this.filter(":hidden").css("opacity"
,0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){function o(){i.queue===!1&&s._mark(this);var t=s.extend({},i),n=this.nodeType===1,r=n&&s(this).is(":hidden"),o,u,a,f,l,c,h,p,d,v,m;t.animatedProperties={};for(a in e){o=s.camelCase(a),a!==o&&(e[o]=e[a],delete e[a]);if((l=s.cssHooks[o])&&"expand"in l){c=l.expand(e[o]),delete e[o];for(a in c)a in e||(e[a]=c[a])}}for(o in e){u=e[o],s.isArray(u)?(t.animatedProperties[o]=u[1],u=e[o]=u[0]):t.animatedProperties[o]=t.specialEasing&&t.specialEasing[o]||t.easing||"swing";if(u==="hide"&&r||u==="show"&&!r)return t.complete.call(this);n&&(o==="height"||o==="width")&&(t.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],s.css(this,"display")==="inline"&&s.css(this,"float")==="none"&&(!s.support.inlineBlockNeedsLayout||It(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1))}t.overflow!=null&&(this.style.overflow="hidden");for(a in e)f=new s.fx(this,t,a),u=e[a],Mt.test(u)?(m=s._data(this,"toggle"+a)||(u==="toggle"?r?"show":"hide":0),m?(s._data(this,"toggle"+a,m==="show"?"hide":"show"),f[m]()):f[u]()):(h=_t.exec(u),p=f.cur(),h?(d=parseFloat(h[2]),v=h[3]||(s.cssNumber[a]?"":"px"),v!=="px"&&(s.style(this,a,(d||1)+v),p=(d||1)/f.cur()*p,s.style(this,a,p+v)),h[1]&&(d=(h[1]==="-="?-1:1)*d+p),f.custom(p,d,v)):f.custom(p,u,""));return!0}var i=s.speed(t,n,r);return s.isEmptyObject(e)?this.each(i.complete,[!1]):(e=s.extend({},e),i.queue===!1?this.each(o):this.queue(i.queue,o))},stop:function(e,n,r){return typeof e!="string"&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(
){function u(e,t,n){var i=t[n];s.removeData(e,n,!0),i.stop(r)}var t,n=!1,i=s.timers,o=s._data(this);r||s._unmark(!0,this);if(e==null)for(t in o)o[t]&&o[t].stop&&t.indexOf(".run")===t.length-4&&u(this,o,t);else o[t=e+".run"]&&o[t].stop&&u(this,o,t);for(t=i.length;t--;)i[t].elem===this&&(e==null||i[t].queue===e)&&(r?i[t](!0):i[t].saveState(),n=!0,i.splice(t,1));(!r||!n)&&s.dequeue(this,e)})}}),s.each({slideDown:Ft("show",1),slideUp:Ft("hide",1),slideToggle:Ft("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){s.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),s.extend({speed:function(e,t,n){var r=e&&typeof e=="object"?s.extend({},e):{complete:n||!n&&t||s.isFunction(e)&&e,duration:e,easing:n&&t||t&&!s.isFunction(t)&&t};r.duration=s.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in s.fx.speeds?s.fx.speeds[r.duration]:s.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue="fx";return r.old=r.complete,r.complete=function(e){s.isFunction(r.old)&&r.old.call(this),r.queue?s.dequeue(this,r.queue):e!==!1&&s._unmark(this)},r},easing:{linear:function(e){return e},swing:function(e){return-Math.cos(e*Math.PI)/2+.5}},timers:[],fx:function(e,t,n){this.options=t,this.elem=e,this.prop=n,t.orig=t.orig||{}}}),s.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(s.fx.step[this.prop]||s.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]==null||!!this.elem.style&&this.elem.style[this.prop]!=null){var e,t=s.css(this.elem,this.prop);return isNaN(e=parseFloat(t))?!
t||t==="auto"?0:t:e}return this.elem[this.prop]},custom:function(e,n,r){function u(e){return i.step(e)}var i=this,o=s.fx;this.startTime=Ht||Bt(),this.end=n,this.now=this.start=e,this.pos=this.state=0,this.unit=r||this.unit||(s.cssNumber[this.prop]?"":"px"),u.queue=this.options.queue,u.elem=this.elem,u.saveState=function(){s._data(i.elem,"fxshow"+i.prop)===t&&(i.options.hide?s._data(i.elem,"fxshow"+i.prop,i.start):i.options.show&&s._data(i.elem,"fxshow"+i.prop,i.end))},u()&&s.timers.push(u)&&!Dt&&(Dt=setInterval(o.tick,o.interval))},show:function(){var e=s._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=e||s.style(this.elem,this.prop),this.options.show=!0,e!==t?this.custom(this.cur(),e):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),s(this.elem).show()},hide:function(){this.options.orig[this.prop]=s._data(this.elem,"fxshow"+this.prop)||s.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(e){var t,n,r,i=Ht||Bt(),o=!0,u=this.elem,a=this.options;if(e||i>=a.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),a.animatedProperties[this.prop]=!0;for(t in a.animatedProperties)a.animatedProperties[t]!==!0&&(o=!1);if(o){a.overflow!=null&&!s.support.shrinkWrapBlocks&&s.each(["","X","Y"],function(e,t){u.style["overflow"+t]=a.overflow[e]}),a.hide&&s(u).hide();if(a.hide||a.show)for(t in a.animatedProperties)s.style(u,t,a.orig[t]),s.removeData(u,"fxshow"+t,!0),s.removeData(u,"toggle"+t,!0);r=a.complete,r&&(a.complete=!1,r.call(u))}return!1}return a.duration==Infinity?this.now=i:(n=i-this
.startTime,this.state=n/a.duration,this.pos=s.easing[a.animatedProperties[this.prop]](this.state,n,0,1,a.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update(),!0}},s.extend(s.fx,{tick:function(){var e,t=s.timers,n=0;for(;n<t.length;n++)e=t[n],!e()&&t[n]===e&&t.splice(n--,1);t.length||s.fx.stop()},interval:13,stop:function(){clearInterval(Dt),Dt=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(e){s.style(e.elem,"opacity",e.now)},_default:function(e){e.elem.style&&e.elem.style[e.prop]!=null?e.elem.style[e.prop]=e.now+e.unit:e.elem[e.prop]=e.now}}}),s.each(Pt.concat.apply([],Pt),function(e,t){t.indexOf("margin")&&(s.fx.step[t]=function(e){s.style(e.elem,t,Math.max(0,e.now)+e.unit)})}),s.expr&&s.expr.filters&&(s.expr.filters.animated=function(e){return s.grep(s.timers,function(t){return e===t.elem}).length});var qt,Rt=/^t(?:able|d|h)$/i,Ut=/^(?:body|html)$/i;"getBoundingClientRect"in n.documentElement?qt=function(e,t,n,r){try{r=e.getBoundingClientRect()}catch(i){}if(!r||!s.contains(n,e))return r?{top:r.top,left:r.left}:{top:0,left:0};var o=t.body,u=zt(t),a=n.clientTop||o.clientTop||0,f=n.clientLeft||o.clientLeft||0,l=u.pageYOffset||s.support.boxModel&&n.scrollTop||o.scrollTop,c=u.pageXOffset||s.support.boxModel&&n.scrollLeft||o.scrollLeft,h=r.top+l-a,p=r.left+c-f;return{top:h,left:p}}:qt=function(e,t,n){var r,i=e.offsetParent,o=e,u=t.body,a=t.defaultView,f=a?a.getComputedStyle(e,null):e.currentStyle,l=e.offsetTop,c=e.offsetLeft;while((e=e.parentNode)&&e!==u&&e!==n){if(s.support.fixedPosition&&f.position==="fixed")break;r=a?a.getComputedStyle
(e,null):e.currentStyle,l-=e.scrollTop,c-=e.scrollLeft,e===i&&(l+=e.offsetTop,c+=e.offsetLeft,s.support.doesNotAddBorder&&(!s.support.doesAddBorderForTableAndCells||!Rt.test(e.nodeName))&&(l+=parseFloat(r.borderTopWidth)||0,c+=parseFloat(r.borderLeftWidth)||0),o=i,i=e.offsetParent),s.support.subtractsBorderForOverflowNotVisible&&r.overflow!=="visible"&&(l+=parseFloat(r.borderTopWidth)||0,c+=parseFloat(r.borderLeftWidth)||0),f=r}if(f.position==="relative"||f.position==="static")l+=u.offsetTop,c+=u.offsetLeft;return s.support.fixedPosition&&f.position==="fixed"&&(l+=Math.max(n.scrollTop,u.scrollTop),c+=Math.max(n.scrollLeft,u.scrollLeft)),{top:l,left:c}},s.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){s.offset.setOffset(this,e,t)});var n=this[0],r=n&&n.ownerDocument;return r?n===r.body?s.offset.bodyOffset(n):qt(n,r,r.documentElement):null},s.offset={bodyOffset:function(e){var t=e.offsetTop,n=e.offsetLeft;return s.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(s.css(e,"marginTop"))||0,n+=parseFloat(s.css(e,"marginLeft"))||0),{top:t,left:n}},setOffset:function(e,t,n){var r=s.css(e,"position");r==="static"&&(e.style.position="relative");var i=s(e),o=i.offset(),u=s.css(e,"top"),a=s.css(e,"left"),f=(r==="absolute"||r==="fixed")&&s.inArray("auto",[u,a])>-1,l={},c={},h,p;f?(c=i.position(),h=c.top,p=c.left):(h=parseFloat(u)||0,p=parseFloat(a)||0),s.isFunction(t)&&(t=t.call(e,n,o)),t.top!=null&&(l.top=t.top-o.top+h),t.left!=null&&(l.left=t.left-o.left+p),"using"in t?t.using.call(e,l):i.css(l)}},s.fn.extend({position:function(){if(!this[0])return null
;var e=this[0],t=this.offsetParent(),n=this.offset(),r=Ut.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(s.css(e,"marginTop"))||0,n.left-=parseFloat(s.css(e,"marginLeft"))||0,r.top+=parseFloat(s.css(t[0],"borderTopWidth"))||0,r.left+=parseFloat(s.css(t[0],"borderLeftWidth"))||0,{top:n.top-r.top,left:n.left-r.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||n.body;while(e&&!Ut.test(e.nodeName)&&s.css(e,"position")==="static")e=e.offsetParent;return e})}}),s.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);s.fn[e]=function(i){return s.access(this,function(e,i,o){var u=zt(e);if(o===t)return u?n in u?u[n]:s.support.boxModel&&u.document.documentElement[i]||u.document.body[i]:e[i];u?u.scrollTo(r?s(u).scrollLeft():o,r?o:s(u).scrollTop()):e[i]=o},e,i,arguments.length,null)}}),s.each({Height:"height",Width:"width"},function(e,n){var r="client"+e,i="scroll"+e,o="offset"+e;s.fn["inner"+e]=function(){var e=this[0];return e?e.style?parseFloat(s.css(e,n,"padding")):this[n]():null},s.fn["outer"+e]=function(e){var t=this[0];return t?t.style?parseFloat(s.css(t,n,e?"margin":"border")):this[n]():null},s.fn[n]=function(e){return s.access(this,function(e,n,u){var a,f,l,c;if(s.isWindow(e))return a=e.document,f=a.documentElement[r],s.support.boxModel&&f||a.body&&a.body[r]||f;if(e.nodeType===9)return a=e.documentElement,a[r]>=a[i]?a[r]:Math.max(e.body[i],a[i],e.body[o],a[o]);if(u===t)return l=s.css(e,n),c=parseFloat(l),s.isNumeric(c)?c:l;s(e).css(n,u)},n,e,arguments.length,null)}}),e.jQuery=e.$=s,typeof 
define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return s})})(window),jQuery.Buffer=function(){function t(e){for(var t in e)typeof e[t]=="function"&&(e[t].displayName=t)}var e=function(e){e&&this.assign(e),this._bufferedCommandList=[],this._bufferedCommands={}};return e._buffers=[],e._pool=[],e.bufferForElement=function(e){return e._jquery_buffer?e._jquery_buffer:this.bufferFromPool().assign(e)},e.bufferFromPool=function(){var t=null;return this._pool.length===0?t=new e:t=this._pool.pop(),e._buffers.push(t),this.flushingScheduled||this.scheduleFlushing(),t},e.returnToPool=function(e){e.unassign(),this._pool.push(e)},e.scheduleFlushing=function(){this.flushingScheduled=!0},e.flush=function(){var e=this._buffers,t,n=e.length;for(t=0;t<n;t++)e[t].flush(),this.returnToPool(e[t]);this._buffers=[],this.flushingScheduled=!1},e.prototype.assign=function(e){return this._el&&this.unassign(),this._el=e,this._el._jquery_buffer=this,this},e.prototype.unassign=function(){if(!this._el)return;return this._el._jquery_buffer=undefined,this._el=undefined,this},e.prototype.flush=function(){var e=this._bufferedCommandList,t=e.length,n,r;for(n=0;n<t;n++)r=e[n],this[r](this._bufferedCommands[r]),delete this._bufferedCommands[r];this._bufferedCommandList.length=0,this.unassign()},e.prototype.$=function(e,t){t||(t=this._el);if(e===""||e===undefined)e=t,t=undefined;return jQuery(e,t)},e.prototype.bufferedCommand=function(e){return this._bufferedCommands[e]||(this._bufferedCommands[e]={},this._bufferedCommandList.push(e)),this._bufferedCommands[e]},e.prototype.hasBufferedCommand=
function(e){return!!this._bufferedCommands[e]},e.prototype.html=function(e){var t=this.bufferedCommand("flushContent");if(e===undefined)return t.text||t.html||this.$().html();t.text=undefined,t.html=e},e.prototype.text=function(e){var t=this.bufferedCommand("flushContent");if(e===undefined)return t.text||t.html||this.$().text();t.text=e,t.html=undefined},e.prototype.flushContent=function(e){e.text!==undefined?this.$().text(e.text):e.html!==undefined&&this.$().html(e.html)},e.prototype.attr=function(e,t){if(typeof e=="object"){for(var n in e)this.attr(n,e[n]);return}if(e==="class"){if(t===undefined)return this.setClass().join(" ");if(typeof t=="string"||jQuery.isArray(t)){var r=this.bufferedCommand("flushClassNames");r.classNames=this._hashFromClassNames(t);return}return this.setClass(t)}if(e==="html")return this.html(t);if(e==="text")return this.text(t);if(e==="style")return this.resetStyles(t);var i=this.bufferedCommand("flushAttributes");i.attr||(i.attr={}),i.attr[e]=t},e.prototype.flushAttributes=function(e){var t=e.attr,n=this.$(),r;for(var i in t){if(!t.hasOwnProperty(i))continue;r=t[i],r!==null?n.attr(i,r):n.removeAttr(i)}},e.prototype._STYLE_REGEX=/-?\s*([^:\s]+)\s*:\s*([^;]+)\s*;?/g,e.prototype._camelizeStyleName=function(e){var t=e.match(/^-(webkit|moz|o)-/),n=e.camelize();return t?n.substr(0,1).toUpperCase()+n.substr(1):n},e.prototype._dasherizeStyleName=function(e){var t=SC.String.dasherize(e);return t.match(/^(webkit|moz|ms|o)-/)&&(t="-"+t),t},e.prototype._loadStyles=function(e){e||(e=this.$().attr("style"));if(e&&(e=e.toString()).length>0){SC.browser.msie&&(e=e.
toLowerCase());var t={},n=this._STYLE_REGEX,r;n.lastIndex=0;while(r=n.exec(e))t[this._camelizeStyleName(r[1])]=r[2];return t}return{}},e.prototype.resetStyles=function(e){var t=this.bufferedCommand("flushStyles");t._styles=this._loadStyles(e||" ")},e.prototype.styles=function(){var e=this.bufferedCommand("flushStyles");return e._styles||(e._styles=this._loadStyles()),e._styles},e.prototype.css=function(e,t){if(typeof e=="object"){for(var n in e)this.css(n,e[n]);return}var r=this.bufferedCommand("flushStyles");r._styles||(r._styles=this._loadStyles()),r._styles[e]=t},e.prototype.flushStyles=function(e){var t=e._styles,n="",r,i,s=[],o=0;for(r in t){if(!t.hasOwnProperty(r))continue;i=t[r];if(i===null)continue;typeof i=="number"&&r!=="zIndex"&&r!=="fontWeight"&&r!=="opacity"&&(i+="px"),s[o++]=this._dasherizeStyleName(r)+": "+i}this.$().attr("style",s.join("; "))},e.prototype._hashFromClassNames=function(e){typeof e=="string"&&(e=e.split(" "));var t,n=e.length,r={};for(t=0;t<n;t++)r[e[t]]=!0;return r},e.prototype.setClass=function(e,t){var n=this.bufferedCommand("flushClassNames"),r;if(e===undefined){n.classNames||(n.classNames=this._hashFromClassNames(this._el.className));var i=n.classNames,s=[];for(r in i)r&&i[r]&&s.push(r);return s}if(typeof e=="object"){n.classNames||(n.classNames=this._hashFromClassNames(this._el.className));for(r in e)n.classNames[r]=e[r];return}n.classNames||(n.classNames=this._hashFromClassNames(this._el.className)),n.classNames[e]=t||!1},e.prototype.hasClass=function(e){var t=this.bufferedCommand("flushClassNames");return t.classNames||(t.classNames=this
._hashFromClassNames(this._el.className)),!!t.classNames[e]},e.prototype.addClass=function(e){if(!e)return;var t=this.bufferedCommand("flushClassNames");t.classNames||(t.classNames=this._hashFromClassNames(this._el.className)),typeof e=="string"&&(e=e.split(" "));var n,r=e.length;for(n=0;n<r;n++)t.classNames[jQuery.trim(e[n])]=!0},e.prototype.removeClass=function(e){var t=this.bufferedCommand("flushClassNames");t.classNames||(t.classNames=this._hashFromClassNames(this._el.className)),t.classNames[e]=!1},e.prototype.resetClassNames=function(e){var t=this.bufferedCommand("flushClassNames");t.classNames={}},e.prototype.flushClassNames=function(e){var t=[];if(e.classNames){var n=e.classNames,r;for(r in n)n[r]&&t.push(r)}this.$().attr("class",t.join(" "))},t(e),t(e.prototype),e}(),function(){jQuery.buffer=jQuery.bufferedJQuery=jQuery.sub(),jQuery.bufferedJQuery.fn.extend({html:function(e){if(e===undefined)return this.length<1?undefined:jQuery.Buffer.bufferForElement(this[0]).html();var t=this.length,n,r;for(n=0;n<t;n++)r=jQuery.Buffer.bufferForElement(this[n]),r.html(e);return this},text:function(e){if(e===undefined)return this.length<1?undefined:jQuery.Buffer.bufferForElement(this[0]).text();var t=this.length,n,r;for(n=0;n<t;n++)r=jQuery.Buffer.bufferForElement(this[n]),r.text(e);return this},attr:function(e,t){var n;if(typeof t=="undefined"&&typeof e=="string")return this.length<1?!1:(n=jQuery.Buffer.bufferForElement(this[0]),n.attr(e));var r=this.length,i;for(i=0;i<r;i++)n=jQuery.Buffer.bufferForElement(this[i]),n.attr(e,t);return this},hasClass:function(e){return this.length<1?!1
:jQuery.Buffer.bufferForElement(this[0]).hasClass(e)},setClass:function(e,t){var n=this.length,r,i;for(r=0;r<n;r++)i=jQuery.Buffer.bufferForElement(this[r]),i.setClass(e,t);return this},addClass:function(e){var t=this.length,n,r;for(n=0;n<t;n++)r=jQuery.Buffer.bufferForElement(this[n]),r.addClass(e);return this},removeClass:function(e){var t=this.length,n,r;for(n=0;n<t;n++)r=jQuery.Buffer.bufferForElement(this[n]),r.removeClass(e);return this},resetClassNames:function(){var e=this.length,t,n;for(t=0;t<e;t++)n=jQuery.Buffer.bufferForElement(this[t]),n.resetClassNames();return this},css:function(e,t){var n=this.length,r,i;for(r=0;r<n;r++)i=jQuery.Buffer.bufferForElement(this[r]),i.css(e,t);return this},styles:function(){return this.length<1?null:jQuery.Buffer.bufferForElement(this[0]).styles()},resetStyles:function(){return this.length<1?null:(jQuery.Buffer.bufferForElement(this[0]).resetStyles(),this)}})}(),jQuery.Buffer._flush=function(){jQuery.Buffer.flush()},jQuery.Buffer.scheduleFlushing=function(){SC.RunLoop.currentRunLoop.invokeOnce(jQuery.Buffer._flush),this.flushingScheduled=!0},window.require||(window.require=function(){}),window.sc_require||(window.sc_require=require),window.sc_resource||(window.sc_resource=function(){}),window.YES=!0,window.NO=!1,typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),window.SC=window.SC||{},window.SproutCore=window.SproutCore||SC,SC=window.SC,SC.VERSION="1.6.0",SC._baseMixin=function(e){var t=Array.prototype.slice.call(arguments,1),n,r=t[0]||{},i=1,s=t.length,o,u,a;s===1&&(
r=this||{},i=0);for(;i<s;i++){if(!(o=t[i]))continue;for(a in o){if(!o.hasOwnProperty(a))continue;u=o[a];if(r===u)continue;u!==undefined&&(e||r[a]===undefined)&&(r[a]=u)}o.hasOwnProperty("toString")&&(r.toString=o.toString)}return r},SC.mixin=function(){var e=Array.prototype.slice.call(arguments);return e.unshift(!0),SC._baseMixin.apply(this,e)},SC.supplement=function(){var e=Array.prototype.slice.call(arguments);return e.unshift(!1),SC._baseMixin.apply(this,e)},SC.extend=SC.mixin,SC.mixin({T_ERROR:"error",T_OBJECT:"object",T_NULL:"null",T_CLASS:"class",T_HASH:"hash",T_FUNCTION:"function",T_UNDEFINED:"undefined",T_NUMBER:"number",T_BOOL:"boolean",T_ARRAY:"array",T_STRING:"string",T_DATE:"date",T_REGEXP:"regexp",typeOf:function(e){if(e===undefined)return SC.T_UNDEFINED;if(e===null)return SC.T_NULL;var t=jQuery.type(e);return t==="function"?e.isClass?SC.T_CLASS:SC.T_FUNCTION:t==="object"?SC.Error&&e instanceof SC.Error?SC.T_ERROR:e instanceof SC.Object?SC.T_OBJECT:SC.T_HASH:t},none:function(e){return e==null},empty:function(e){return e===null||e===undefined||e===""},isArray:function(e){return!e||e.setInterval?!1:Array.isArray&&Array.isArray(e)?!0:e.objectAt?!0:e.length!==undefined&&jQuery.type(e)==="object"?!0:!1},makeArray:function(e){return SC.isArray(e)?e:SC.A(e)},A:function(e){if(e===null||e===undefined)return[];if(e.slice instanceof Function)return typeof e=="string"?[e]:e.slice();if(e.toArray)return e.toArray();if(!SC.isArray(e))return[e];var t=[],n=e.length;while(--n>=0)t[n]=e[n];return t},guidKey:"SproutCore"+(SC.VERSION+Math.random()).replace(/\D/g,""),_guidPrefixes:{number
:"nu",string:"st"},_guidCaches:{number:{},string:{}},_numberGuids:[],_stringGuids:{},_keyCache:{},guidFor:function(e){var t,n,r=typeof e;if(e===null)return"(null)";if(r===SC.T_STRING||r===SC.T_NUMBER)return t=this._guidCaches[r],n=t[e],n||(n="st"+jQuery.uuid++,t[e]=n),n;if(e===undefined)return"(undefined)";if(r===SC.T_BOOL)return e?"(true)":"(false)";var i=this.guidKey,s=e[i];return s?s:e===Object?"(Object)":e===Array?"(Array)":SC.generateGuid(e,"sc")},keyFor:function(e,t){var n,r=this._keyCache[e];return r||(r=this._keyCache[e]={}),n=r[t],n||(n=r[t]=e+"_"+t),n},generateGuid:function(e,t){var n=t+jQuery.uuid++;return e&&(e[this.guidKey]=n),n},hashFor:function(){var e=arguments.length,t="",n,r,i;for(i=0;i<e;++i)n=arguments[i],t+=n&&(r=n.hash)&&typeof r===SC.T_FUNCTION?r.call(n):this.guidFor(n);return t===""?null:t},isEqual:function(e,t){return this.hashFor(e)===this.hashFor(t)},compare:function(e,t){if(e===t)return 0;var n=SC.typeOf(e),r=SC.typeOf(t),i=SC.ORDER_DEFINITION_MAPPING;if(!i){var s=SC.ORDER_DEFINITION;i=SC.ORDER_DEFINITION_MAPPING={};var o,u;for(o=0,u=s.length;o<u;++o)i[s[o]]=o;delete SC.ORDER_DEFINITION}var a=i[n],f=i[r];if(a<f)return-1;if(a>f)return 1;switch(n){case SC.T_BOOL:case SC.T_NUMBER:if(e<t)return-1;if(e>t)return 1;return 0;case SC.T_STRING:var l=e.localeCompare(t);if(l<0)return-1;if(l>0)return 1;return 0;case SC.T_ARRAY:var c=e.length,h=t.length,p=Math.min(c,h),d=0,v=0,m=arguments.callee;while(d===0&&v<p)d=m(e[v],t[v]),v++;if(d!==0)return d;if(c<h)return-1;if(c>h)return 1;return 0;case SC.T_OBJECT:if(e.constructor.isComparable===YES)return e.constructor
.compare(e,t);return 0;default:return 0}},K:function(){return this},EMPTY_ARRAY:[],EMPTY_HASH:{},EMPTY_RANGE:{start:0,length:0},beget:function(e){if(e===null||e===undefined)return null;var t=SC.K;t.prototype=e;var n=new t;return t.prototype=null,typeof e.didBeget=="function"&&(n=e.didBeget(n)),n[this.guidKey]=null,n},copy:function(e,t){var n=e,r;if(e){if(e.isCopyable)return e.copy(t);if(e.clone)return e.clone()}switch(jQuery.type(e)){case"array":n=e.slice();if(t){r=n.length;while(r--)n[r]=SC.copy(n[r],!0)}break;case"object":n={};for(var i in e)n[i]=t?SC.copy(e[i],!0):e[i]}return n},merge:function(){var e={},t=arguments.length,n;for(n=0;n<t;n++)SC.mixin(e,arguments[n]);return e},keys:function(e){var t=[];for(var n in e)t.push(n);return t},inspect:function(e){var t,n=[];for(var r in e){t=e[r];if(t==="toString")continue;SC.typeOf(t)===SC.T_FUNCTION&&(t="function() { ... }"),n.push(r+": "+t)}return"{"+n.join(" , ")+"}"},tupleForPropertyPath:function(e,t){if(typeof e=="object"&&e instanceof Array)return e;var n,r=e.indexOf("*");r<0&&(r=e.lastIndexOf(".")),n=r>=0?e.slice(r+1):e;var i=this.objectForPropertyPath(e,t,r);return i&&n?[i,n]:null},objectForPropertyPath:function(e,t,n){var r,i,s,o;t||(t=window);if(typeof e=="string"){n===undefined&&(n=e.length),r=0;while(t&&r<n){i=e.indexOf(".",r);if(i<0||i>n)i=n;s=e.slice(r,i),t=t.get?t.get(s):t[s],r=i+1}r<n&&(t=undefined)}else{r=0,o=e.length,s=null;while(r<o&&t)s=e[r++],s&&(t=t.get?t.get(s):t[s]);r<o&&(t=undefined)}return t},requiredObjectForPropertyPath:function(e,t,n){var r=SC.objectForPropertyPath(e,t,n);if(!r)throw e+" could not be found"
;return r},getCurrentTimeForPerformance:function(){var e=window.performance;return e&&e.now?Math.round(e.now()):Date.now()}}),SC.clone=SC.copy,SC.$A=SC.A,SC.didLoad=SC.K,SC.ORDER_DEFINITION=[SC.T_ERROR,SC.T_UNDEFINED,SC.T_NULL,SC.T_BOOL,SC.T_NUMBER,SC.T_STRING,SC.T_ARRAY,SC.T_HASH,SC.T_OBJECT,SC.T_FUNCTION,SC.T_CLASS],SC.Function={property:function(e,t){e.dependentKeys=SC.$A(t);var n=SC.guidFor(e);return e.cacheKey="__cache__"+n,e.lastSetValueKey="__lastValue__"+n,e.isProperty=!0,e},cacheable:function(e,t){return e.isProperty=!0,e.dependentKeys||(e.dependentKeys=[]),e.isCacheable=t===undefined?!0:t,e},idempotent:function(e,t){return e.isProperty=!0,e.dependentKeys||(this.dependentKeys=[]),e.isVolatile=t===undefined?!0:t,e},enhance:function(e){return e.isEnhancement=!0,e},observes:function(e,t){var n=t.length,r=null,i=null;while(--n>=0){var s=t[n];s.indexOf(".")<0&&s.indexOf("*")<0?(r||(r=e.localPropertyPaths=[]),r.push(s)):(i||(i=e.propertyPaths=[]),i.push(s))}return e}},SC.mixin(Function.prototype,{property:function(){return SC.Function.property(this,arguments)},cacheable:function(e){return SC.Function.cacheable(this,e)},idempotent:function(e){return SC.Function.idempotent(this,e)},enhance:function(){return SC.Function.enhance(this)},observes:function(e){return SC.Function.observes(this,arguments)}}),SC.ObserverSet={add:function(e,t,n){var r=SC.guidFor(e),i=SC.guidFor(t),s=this._members,o=this.members,u=s[r],a,f;u||(u=s[r]={}),a=u[i],a===undefined&&(u[i]=o.length,f=[e,t,n],o.push(f))},remove:function(e,t){var n=SC.guidFor(e),r=SC.guidFor(t),i=this._members[n],s=this.members
;if(!i)return!1;var o=i[r];if(o===undefined)return!1;if(o!==s.length-1){var u=s[o]=s[s.length-1];this._members[SC.guidFor(u[0])][SC.guidFor(u[1])]=o}return s.pop(),delete this._members[n][r],!0},invokeMethods:function(){var e=this.members,t;for(var n=0,r=e.length;n<r;n++)t=e[n],t[1].call(t[0])},clone:function(){var e=SC.ObserverSet.create(),t=this.members;e._members=SC.clone(this._members);var n=e.members;for(var r=0,i=t.length;r<i;r++)n[r]=SC.clone(t[r]),n[r].length=3;return e},create:function(){return new SC.ObserverSet.constructor},getMembers:function(){return this.members.slice(0)},constructor:function(){this._members={},this.members=[]}},SC.ObserverSet.constructor.prototype=SC.ObserverSet,SC.ObserverSet.slice=SC.ObserverSet.clone,SC.ObserverSet.copy=SC.ObserverSet.clone,SC._ChainObserver=function(e,t){this.property=e,this.root=t||this},SC._ChainObserver.createChain=function(e,t,n,r,i){var s=t.split("."),o=new SC._ChainObserver(s[0]),u=o;for(var a=1,f=s.length;a<f;a++)u=u.next=new SC._ChainObserver(s[a],o);var l=o.tails=[u];return o.objectDidChange(e),l.forEach(function(e){e.target=n,e.method=r,e.context=i}),o.tails=null,o},SC._ChainObserver.prototype={isChainObserver:!0,object:null,property:null,next:null,root:null,target:null,method:null,tail:function(){if(this._tail)return this._tail;var e=this;while(e.next)e=e.next;return this._tail=e,e},objectDidChange:function(e){if(e===this.object)return;this.object&&(this.property==="@each"&&this.object._removeContentObserver?this.object._removeContentObserver(this):this.object.removeObserver&&this.object.removeObserver(this.property
,this,this.propertyDidChange)),this.object=e,this.property==="@each"&&this.next?this.object&&this.object._addContentObserver&&this.object._addContentObserver(this):(this.object&&this.object.addObserver&&this.object.addObserver(this.property,this,this.propertyDidChange),this.propertyDidChange())},propertyDidChange:function(){var e=this.object,t=this.property,n=e&&e.get?e.get(t):null;this.next&&this.next.objectDidChange(n);var r=this.target,i=this.method,s=this.context;if(r&&i){var o=e?e.propertyRevision:null;s?i.call(r,e,t,n,s,o):i.call(r,e,t,n,o)}},destroyChain:function(){var e=this.object;return e&&e.removeObserver&&e.removeObserver(this.property,this,this.propertyDidChange),this.next&&this.next.destroyChain(),this.next=this.target=this.method=this.object=this.context=null,null}},SC.LOG_OBSERVERS=NO,SC.OBSERVES_HANDLER_ADD=0,SC.OBSERVES_HANDLER_REMOVE=1,SC.Observable={isObservable:YES,automaticallyNotifiesObserversFor:function(e){return YES},get:function(e){var t=this[e],n;return t===undefined?this.unknownProperty(e):t&&t.isProperty?t.isCacheable?(n=this._kvo_cache,n||(n=this._kvo_cache={}),n[t.cacheKey]!==undefined?n[t.cacheKey]:n[t.cacheKey]=t.call(this,e)):t.call(this,e):t},set:function(e,t){var n=this[e],r=this.automaticallyNotifiesObserversFor(e),i=t,s,o,u,a;if(t===undefined&&SC.typeOf(e)===SC.T_HASH){var f=e;for(e in f){if(!f.hasOwnProperty(e))continue;this.set(e,f[e])}return this}if(!r&&this._kvo_cacheable&&(o=this._kvo_cache)){s=this._kvo_cachedep;if(!s||(s=s[e])===undefined)s=this._kvo_computeCachedDependentsFor(e);if(s){u=s.length;while(--u>=0)a=s[u],o[a.cacheKey]=
o[a.lastSetValueKey]=undefined}}if(n&&n.isProperty){o=this._kvo_cache;if(n.isVolatile||!o||o[n.lastSetValueKey]!==t)o||(o=this._kvo_cache={}),o[n.lastSetValueKey]=t,r&&this.propertyWillChange(e,i),i=n.call(this,e,t),n.isCacheable&&(o[n.cacheKey]=i),r&&this.propertyDidChange(e,i,YES)}else n===undefined?(r&&this.propertyWillChange(e,i),this.unknownProperty(e,t),r&&this.propertyDidChange(e,i)):this[e]!==t&&(r&&this.propertyWillChange(e,i),i=this[e]=t,r&&this.propertyDidChange(e,i));return this},unknownProperty:function(e,t){return t!==undefined&&(this[e]=t),t},beginPropertyChanges:function(){return this._kvo_changeLevel=(this._kvo_changeLevel||0)+1,this},endPropertyChanges:function(){this._kvo_changeLevel=(this._kvo_changeLevel||1)-1;var e=this._kvo_changeLevel,t=this._kvo_changes;return e<=0&&t&&t.length>0&&!SC.Observers.isObservingSuspended&&this._notifyPropertyObservers(),this},propertyWillChange:function(e,t){return this},propertyDidChange:function(e,t,n){this._kvo_revision=(this._kvo_revision||0)+1;var r=this._kvo_changeLevel||0,i,s,o,u,a=SC.LOG_OBSERVERS&&this.LOG_OBSERVING!==NO,f=this._kvo_property_chains;if(f){var l=f[e];l&&(this.beginPropertyChanges(),l=SC.clone(l),l.forEach(function(e){e.notifyPropertyDidChange()}),this.endPropertyChanges())}var c=this._kvo_cache;if(c){n||(u=this[e],u&&u.isProperty&&(c[u.cacheKey]=c[u.lastSetValueKey]=undefined));if(this._kvo_cacheable){i=this._kvo_cachedep;if(!i||(i=i[e])===undefined)i=this._kvo_computeCachedDependentsFor(e);if(i){s=i.length;while(--s>=0)o=i[s],c[o.cacheKey]=c[o.lastSetValueKey]=undefined}}}var h=SC.Observers.isObservingSuspended
;if(r>0||h){var p=this._kvo_changes;p||(p=this._kvo_changes=SC.CoreSet.create()),p.add(e),h&&(a&&SC.Logger.log("%@%@: will not notify observers because observing is suspended".fmt(SC.KVO_SPACES,this)),SC.Observers.objectHasPendingChanges(this))}else this._notifyPropertyObservers(e);return this},registerDependentKey:function(e,t){var n=this._kvo_dependents,r=this._kvo_chain_dependents,i=this[e],s,o,u,a,f;typeof t=="object"&&t instanceof Array?(s=t,u=0):(s=arguments,u=1),o=s.length,n||(this._kvo_dependents=n={});while(--o>=u)a=s[o],a.indexOf(".")>=0?SC._PropertyChain.createChain(a,this,e).activate():(f=n[a],f||(f=n[a]=[]),f.push(e))},registerDependentKeyWithChain:function(e,t){var n=this._chainsFor(e),r;n.add(t)},removeDependentKeyWithChain:function(e,t){var n=this._chainsFor(e),r;n.remove(t),n.get("length")===0&&delete this._kvo_property_chains[e]},_chainsFor:function(e){this._kvo_property_chains=this._kvo_property_chains||{};var t=this._kvo_property_chains[e]||SC.CoreSet.create();return this._kvo_property_chains[e]=t,t},_kvo_addCachedDependents:function(e,t,n){var r=t.length,i,s,o;while(--r>=0)s=t[r],i=this[s],i&&i instanceof Function&&i.isProperty&&(i.isCacheable&&e.push(i),(o=n[s])&&o.length>0&&this._kvo_addCachedDependents(e,o,n))},_kvo_computeCachedDependentsFor:function(e){var t=this._kvo_cachedep,n=this._kvo_dependents,r=n?n[e]:null,i;return t||(t=this._kvo_cachedep={}),!r||r.length===0?t[e]=null:(i=t[e]=[],this._kvo_addCachedDependents(i,r,n),i.length===0&&(i=t[e]=null),i)},_kvo_for:function(e,t){var n=this[e];return this._kvo_cloned||(this._kvo_cloned={}),n?this._kvo_cloned
[e]||(n=this[e]=n.copy(),this._kvo_cloned[e]=YES):(n=this[e]=t===undefined?[]:t.create(),this._kvo_cloned[e]=YES),n},addObserver:function(e,t,n,r){var i,s,o,u;n===undefined&&(n=t,t=this),t||(t=this),typeof n=="string"&&(n=t[n]);if(!n)throw"You must pass a method to addObserver()";return e=e.toString(),e.indexOf(".")>=0?(s=SC._ChainObserver.createChain(this,e,t,n,r),s.masterTarget=t,s.masterMethod=n,this._kvo_for(SC.keyFor("_kvo_chains",e)).push(s)):(this[e]===undefined&&e.indexOf("@")===0&&this.get(e),t===this&&(t=null),i=SC.keyFor("_kvo_observers",e),this._kvo_for(i,SC.ObserverSet).add(t,n,r),this._kvo_for("_kvo_observed_keys",SC.CoreSet).add(e)),this.didAddObserver&&this.didAddObserver(e,t,n),this},removeObserver:function(e,t,n){var r,i,s,o,u;n===undefined&&(n=t,t=this),t||(t=this),typeof n=="string"&&(n=t[n]);if(!n)throw"You must pass a method to removeObserver()";e=e.toString();if(e.indexOf(".")>=0){r=SC.keyFor("_kvo_chains",e);if(i=this[r]){i=this._kvo_for(r),u=i.length;while(--u>=0)s=i[u],s&&s.masterTarget===t&&s.masterMethod===n&&(i[u]=s.destroyChain())}}else{t===this&&(t=null),r=SC.keyFor("_kvo_observers",e);if(o=this[r])o=this._kvo_for(r),o.remove(t,n),o.getMembers().length===0&&this._kvo_for("_kvo_observed_keys",SC.CoreSet).remove(e)}return this.didRemoveObserver&&this.didRemoveObserver(e,t,n),this},hasObserverFor:function(e){SC.Observers.flush(this);var t=this[SC.keyFor("_kvo_observers",e)],n=this[SC.keyFor("_kvo_local",e)],r;return n&&n.length>0?YES:t&&t.getMembers().length>0?YES:NO},initObservable:function(){if(this._observableInited)return;this._observableInited=
YES;var e,t,n,r,i,s,o,u,a,f,l,c,h,p;if(t=this._observers){u=t.length;for(e=0;e<u;e++){n=t[e],i=this[n],s=i.propertyPaths,o=s?s.length:0;for(a=0;a<o;a++)f=s[a],this.addObservesHandler(i,f)}}this.bindings=[];if(t=this._bindings)for(e=0,p=t.length;e<p;e++)n=t[e],r=this[n],h=n.slice(0,-7),this[n]=this.bind(h,r);if(t=this._properties)for(e=0,p=t.length;e<p;e++){n=t[e];if(r=this[n])r.isCacheable&&(this._kvo_cacheable=YES),r.dependentKeys&&r.dependentKeys.length>0&&this.registerDependentKey(n,r.dependentKeys)}},addObservesHandler:function(e,t){return this._configureObservesHandler(SC.OBSERVES_HANDLER_ADD,e,t),this},removeObservesHandler:function(e,t){return this._configureObservesHandler(SC.OBSERVES_HANDLER_REMOVE,e,t),this},_configureObservesHandler:function(e,t,n){var r,i;switch(e){case SC.OBSERVES_HANDLER_ADD:e="addObserver";break;case SC.OBSERVES_HANDLER_REMOVE:e="removeObserver";break;default:throw"invalid action provided: "+e}r=n.indexOf("."),r<0?this[e](n,this,t):n.indexOf("*")===0?this[e](n.slice(1),this,t):(i=null,r===0?(i=this,n=n.slice(1)):r===4&&n.slice(0,5)==="this."?(i=this,n=n.slice(5)):r<0&&n.length===4&&n==="this"?(i=this,n=""):r>0&&n[0]===n.charAt(0).toLowerCase()&&(i=this),SC.Observers[e](n,this,t,i))},observersForKey:function(e){SC.Observers.flush(this);var t=this[SC.keyFor("_kvo_observers",e)];return t?t.getMembers():[]},_notifyPropertyObservers:function(e){this._observableInited||this.initObservable(),SC.Observers.flush(this);var t=SC.LOG_OBSERVERS&&this.LOG_OBSERVING!==NO,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b;t&&(y=SC.KVO_SPACES=(SC.KVO_SPACES||"")+"  ",SC.Logger
.log('%@%@: notifying observers after change to key "%@"'.fmt(y,this,e))),s=this["_kvo_observers_*"],this._kvo_changeLevel=(this._kvo_changeLevel||0)+1;while((r=this._kvo_changes)&&r.length>0||e){a=++this.propertyRevision,r||(r=SC.CoreSet.create()),this._kvo_changes=null,e==="*"?(r.add("*"),r.addEach(this._kvo_for("_kvo_observed_keys",SC.CoreSet))):e&&r.add(e);if(i=this._kvo_dependents)for(o=0;o<r.length;o++){e=r[o],u=i[e];if(u&&(v=u.length)){t&&SC.Logger.log("%@...including dependent keys for %@: %@".fmt(y,e,u)),b=this._kvo_cache,b||(b=this._kvo_cache={});while(--v>=0){r.add(e=u[v]);if(m=this[e])this[m.cacheKey]=undefined,b[m.cacheKey]=b[m.lastSetValueKey]=undefined}}}while(r.length>0){e=r.pop(),n=this[SC.keyFor("_kvo_observers",e)];if(n){f=SC.clone(n.getMembers()),l=f.length;for(h=0;h<l;h++){c=f[h];if(c[3]===a)continue;c[1]||SC.Logger.log(c),p=c[0]||this,d=c[1],g=c[2],c[3]=a,t&&SC.Logger.log('%@...firing observer on %@ for key "%@"'.fmt(y,p,e)),g!==undefined?d.call(p,this,e,null,g,a):d.call(p,this,e,null,a)}}f=this[SC.keyFor("_kvo_local",e)];if(f){l=f.length;for(h=0;h<l;h++)c=f[h],d=this[c],d&&(t&&SC.Logger.log('%@...firing local observer %@.%@ for key "%@"'.fmt(y,this,c,e)),d.call(this,this,e,null,a))}if(s&&e!=="*"){f=SC.clone(s.getMembers()),l=f.length;for(h=0;h<l;h++)c=f[h],p=c[0]||this,d=c[1],g=c[2],t&&SC.Logger.log('%@...firing * observer on %@ for key "%@"'.fmt(y,p,e)),g!==undefined?d.call(p,this,e,null,g,a):d.call(p,this,e,null,a)}this.propertyObserver&&(t&&SC.Logger.log('%@...firing %@.propertyObserver for key "%@"'.fmt(y,this,e)),this.propertyObserver(this,e,null,
a))}r&&r.destroy(),e=null}return this._kvo_changeLevel=(this._kvo_changeLevel||1)-1,t&&(SC.KVO_SPACES=y.slice(0,-2)),YES},bind:function(e,t,n){var r,i;return n!==undefined&&(t=[t,n]),i=typeof t,i==="string"||i==="object"&&t instanceof Array?(r=this[e+"BindingDefault"]||SC.Binding,r=r.beget().from(t)):r=t.beget(),r=r.to(e,this).connect(),this.bindings.push(r),r},didChangeFor:function(e){var t,n,r,i,s,o,u,a,f;e=SC.hashFor(e),t=this._kvo_didChange_valueCache,t||(t=this._kvo_didChange_valueCache={}),n=this._kvo_didChange_revisionCache,n||(n=this._kvo_didChange_revisionCache={}),r=t[e]||{},i=n[e]||{},s=!1,o=this._kvo_revision||0,u=arguments.length;while(--u>=1)a=arguments[u],i[a]!=o&&(f=this.get(a),r[a]!==f&&(s=!0,r[a]=f)),i[a]=o;return t[e]=r,n[e]=i,s},setIfChanged:function(e,t){if(t===undefined&&SC.typeOf(e)===SC.T_HASH){var n=e;for(e in n){if(!n.hasOwnProperty(e))continue;this.setIfChanged(e,n[e])}return this}return this.get(e)!==t?this.set(e,t):this},getPath:function(e){var t=SC.tupleForPropertyPath(e,this);return t===null||t[0]===null?undefined:SC.get(t[0],t[1])},setPath:function(e,t){if(e.indexOf(".")>=0){var n=SC.tupleForPropertyPath(e,this);if(!n||!n[0])return null;n[0].set(n[1],t)}else this.set(e,t);return this},setPathIfChanged:function(e,t){if(e.indexOf(".")>=0){var n=SC.tupleForPropertyPath(e,this);if(!n||!n[0])return null;n[0].get(n[1])!==t&&n[0].set(n[1],t)}else this.setIfChanged(e,t);return this},getEach:function(){var e=SC.A(arguments),t=[],n,r;for(n=0,r=e.length;n<r;n++)t[t.length]=this.getPath(e[n]);return t},incrementProperty:function(e,t){return t||(t=1),this.
set(e,(this.get(e)||0)+t),this.get(e)},decrementProperty:function(e,t){return t||(t=1),this.set(e,(this.get(e)||0)-t),this.get(e)},toggleProperty:function(e,t,n){return t===undefined&&(t=!0),n===undefined&&(n=!1),t=this.get(e)==t?n:t,this.set(e,t),this.get(e)},notifyPropertyChange:function(e,t){return this.propertyWillChange(e,t),this.propertyDidChange(e,t),this},allPropertiesDidChange:function(){return this._kvo_cache=null,this._notifyPropertyObservers("*"),this},addProbe:function(e){this.addObserver(e,SC.logChange)},removeProbe:function(e){this.removeObserver(e,SC.logChange)},logProperty:function(){var e=SC.$A(arguments),t,n,r;for(r=0,n=e.length;r<n;r++)t=e[r],SC.Logger.log("%@:%@: ".fmt(SC.guidFor(this),t),this.get(t))},propertyRevision:1},SC.logChange=function(t,n,r){SC.Logger.log("CHANGE: %@[%@] => %@".fmt(t,n,t.get(n)))},SC.mixin(SC,{get:function(e,t){return e?t===undefined?this[e]:e.get?e.get(t):e[t]:undefined},getPath:function(e,t){return t===undefined&&(t=e,e=window),SC.objectForPropertyPath(t,e)}}),SC.mixin(Array.prototype,SC.Observable),SC.Enumerator=function(e){return this.enumerable=e,this.reset(),this},SC.Enumerator.prototype={nextObject:function(){var e=this._index,t=this._length;if(e>=t)return undefined;var n=this.enumerable.nextObject(e,this._previousObject,this._context);return this._previousObject=n,this._index=e+1,e>=t&&(this._context=SC.Enumerator._pushContext(this._context)),n},reset:function(){var e=this.enumerable;if(!e)throw SC.$error("Enumerator has been destroyed");this._length=e.get?e.get("length"):e.length;var t=this._length;this._index=0,this._previousObject=
null,this._context=t>0?SC.Enumerator._popContext():null},destroy:function(){this.enumerable=this._length=this._index=this._previousObject=this._context=null}},SC.Enumerator.create=function(e){return new SC.Enumerator(e)},SC.Enumerator._popContext=function(){var e=this._contextCache?this._contextCache.pop():null;return e||{}},SC.Enumerator._pushContext=function(e){this._contextCache=this._contextCache||[];var t=this._contextCache;return t.push(e),null},SC.Enumerable={isEnumerable:YES,nextObject:function(e,t,n){return this.objectAt?this.objectAt(e):this[e]},firstObject:function(){if(this.get("length")===0)return undefined;if(this.objectAt)return this.objectAt(0);var e=SC.Enumerator._popContext(),t;return t=this.nextObject(0,null,e),e=SC.Enumerator._pushContext(e),t}.property(),lastObject:function(){var e=this.get("length");if(e===0)return undefined;if(this.objectAt)return this.objectAt(e-1)}.property(),enumerator:function(){return SC.Enumerator.create(this)},forEach:function(e,t){if(typeof e!="function")throw new TypeError;var n=this.get?this.get("length"):this.length;t===undefined&&(t=null);var r=null,i=SC.Enumerator._popContext();for(var s=0;s<n;s++){var o=this.nextObject(s,r,i);e.call(t,o,s,this),r=o}return r=null,i=SC.Enumerator._pushContext(i),this},getEach:function(e){return this.map(function(t){return t?t.get?t.get(e):t[e]:null},this)},setEach:function(e,t){return this.forEach(function(n){n&&(n.set?n.set(e,t):n[e]=t)},this),this},map:function(e,t){if(typeof e!="function")throw new TypeError;t===undefined&&(t=null);var n=this.get?this.get("length"):this.length,r=[],i=null
,s=SC.Enumerator._popContext(),o,u;for(o=0;o<n;o++)u=this.nextObject(o,i,s),r[o]=e.call(t,u,o,this),i=u;return i=null,s=SC.Enumerator._pushContext(s),r},mapProperty:function(e){return this.map(function(t){return t?t.get?t.get(e):t[e]:null})},filter:function(e,t){if(typeof e!="function")throw new TypeError;var n=this.get?this.get("length"):this.length;t===undefined&&(t=null);var r=[],i=null,s=SC.Enumerator._popContext();for(var o=0;o<n;o++){var u=this.nextObject(o,i,s);e.call(t,u,o,this)&&r.push(u),i=u}return i=null,s=SC.Enumerator._pushContext(s),r},sortProperty:function(e){var t=typeof e===SC.T_STRING?arguments:e,n=t.length,r;return this instanceof Array?r=this:(r=[],this.forEach(function(e){r.push(e)})),r?r.sort(function(e,r){var i,s,o,u,a=0;for(i=0;a===0&&i<n;i++)s=t[i],o=e?e.get?e.get(s):e[s]:null,u=r?r.get?r.get(s):r[s]:null,a=SC.compare(o,u);return a}):[]},filterProperty:function(e,t){var n=this.get?this.get("length"):this.length,r=[],i=null,s=SC.Enumerator._popContext();for(var o=0;o<n;o++){var u=this.nextObject(o,i,s),a=u?u.get?u.get(e):u[e]:null,f=t===undefined?!!a:SC.isEqual(a,t);f&&r.push(u),i=u}return i=null,s=SC.Enumerator._pushContext(s),r},find:function(e,t){var n=this.get?this.get("length"):this.length;t===undefined&&(t=null);var r=null,i,s=NO,o=null,u=SC.Enumerator._popContext();for(var a=0;a<n&&!s;a++){i=this.nextObject(a,r,u);if(s=e.call(t,i,a,this))o=i;r=i}return i=r=null,u=SC.Enumerator._pushContext(u),o},findProperty:function(e,t){var n=this.get?this.get("length"):this.length,r=NO,i=null,s=null,o,u,a=SC.Enumerator._popContext();for(var f=0;f<n&&!r;f++)o=
this.nextObject(f,s,a),u=o?o.get?o.get(e):o[e]:null,r=t===undefined?!!u:SC.isEqual(u,t),r&&(i=o),s=o;return s=o=null,a=SC.Enumerator._pushContext(a),i},every:function(e,t){if(typeof e!="function")throw new TypeError;var n=this.get?this.get("length"):this.length;t===undefined&&(t=null);var r=YES,i=null,s=SC.Enumerator._popContext();for(var o=0;r&&o<n;o++){var u=this.nextObject(o,i,s);e.call(t,u,o,this)||(r=NO),i=u}return i=null,s=SC.Enumerator._pushContext(s),r},everyProperty:function(e,t){var n=this.get?this.get("length"):this.length,r=YES,i=null,s=SC.Enumerator._popContext();for(var o=0;r&&o<n;o++){var u=this.nextObject(o,i,s),a=u?u.get?u.get(e):u[e]:null;r=t===undefined?!!a:SC.isEqual(a,t),i=u}return i=null,s=SC.Enumerator._pushContext(s),r},some:function(e,t){if(typeof e!="function")throw new TypeError;var n=this.get?this.get("length"):this.length;t===undefined&&(t=null);var r=NO,i=null,s=SC.Enumerator._popContext();for(var o=0;!r&&o<n;o++){var u=this.nextObject(o,i,s);e.call(t,u,o,this)&&(r=YES),i=u}return i=null,s=SC.Enumerator._pushContext(s),r},someProperty:function(e,t){var n=this.get?this.get("length"):this.length,r=NO,i=null,s=SC.Enumerator._popContext();for(var o=0;!r&&o<n;o++){var u=this.nextObject(o,i,s),a=u?u.get?u.get(e):u[e]:null;r=t===undefined?!!a:SC.isEqual(a,t),i=u}return i=null,s=SC.Enumerator._pushContext(s),r},reduce:function(e,t,n){if(typeof e!="function")throw new TypeError;var r=this.get?this.get("length"):this.length;if(r===0&&t===undefined)throw new TypeError;var i=t,s=null,o=SC.Enumerator._popContext();for(var u=0;u<r;u++){var a=this.nextObject(u
,s,o);a!==null&&(i===undefined?i=a:i=e.call(null,i,a,u,this,n)),s=a}s=null,o=SC.Enumerator._pushContext(o);if(i===undefined)throw new TypeError;return i},invoke:function(e){var t=this.get?this.get("length"):this.length;if(t<=0)return[];var n,r=[],i=arguments.length;if(i>1)for(n=1;n<i;n++)r.push(arguments[n]);var s=[],o=null,u=SC.Enumerator._popContext();for(n=0;n<t;n++){var a=this.nextObject(n,o,u),f=a?a[e]:null;f&&(s[n]=f.apply(a,r)),o=a}return o=null,u=SC.Enumerator._pushContext(u),s},invokeWhile:function(e,t){var n=this.get?this.get("length"):this.length;if(n<=0)return null;var r,i=[],s=arguments.length;if(s>2)for(r=2;r<s;r++)i.push(arguments[r]);var o=e,u=null,a=SC.Enumerator._popContext();for(r=0;o===e&&r<n;r++){var f=this.nextObject(r,u,a),l=f?f[t]:null;l&&(o=l.apply(f,i)),u=f}return u=null,a=SC.Enumerator._pushContext(a),o},toArray:function(){var e=[];return this.forEach(function(t){e.push(t)},this),e},groupBy:function(e){var t=this.get?this.get("length"):this.length,n=[],r=null,i=SC.Enumerator._popContext(),s=[],o=[],u,a,f;for(u=0;u<t;u++)a=this.nextObject(u,r,i),f=a?a.get?a.get(e):a[e]:null,SC.none(s[f])&&(s[f]=[],o.push(f)),s[f].push(a),r=a;r=null,i=SC.Enumerator._pushContext(i);for(u=0,t=o.length;u<t;u++)n.push(s[o[u]]);return n}},SC._buildReducerFor=function(e,t){return function(n,r){var i=this[e];if(SC.typeOf(i)!==SC.T_FUNCTION)return this.unknownProperty?this.unknownProperty(n,r):null;var s=SC.Enumerable.reduce.call(this,i,null,t);return s}.property("[]")},SC.Reducers={"[]":function(e,t){return this}.property(),enumerableContentDidChange:function(e,t,n){this.notifyPropertyChange
("[]")},reducedProperty:function(e,t,n){if(!e||typeof e!==SC.T_STRING||e.charAt(0)!=="@")return undefined;var r=e.match(/^@([^(]*)(\(([^)]*)\))?$/);if(!r||r.length<2)return undefined;var i=r[1],s=r[3];i="reduce"+i.slice(0,1).toUpperCase()+i.slice(1);var o=this[i];if(SC.typeOf(o)!==SC.T_FUNCTION)return undefined;if(n===NO)return SC.Enumerable.reduce.call(this,o,null,s);var u=SC._buildReducerFor(i,s),a=this.constructor.prototype;if(a){a[e]=u;var f=a._properties||[];f.push(e),a._properties=f,this.registerDependentKey(e,"[]")}return SC.Enumerable.reduce.call(this,o,null,s)},reduceMax:function(e,t,n,r,i){return i&&t&&(t=t.get?t.get(i):t[i]),e===null?t:t>e?t:e},reduceMaxObject:function(e,t,n,r,i){var s=e,o=t;return i&&(t&&(o=t.get?t.get(i):t[i]),e&&(s=e.get?e.get(i):e[i])),s===null?t:o>s?t:e},reduceMin:function(e,t,n,r,i){return i&&t&&(t=t.get?t.get(i):t[i]),e===null?t:t<e?t:e},reduceMinObject:function(e,t,n,r,i){var s=e,o=t;return i&&(t&&(o=t.get?t.get(i):t[i]),e&&(s=e.get?e.get(i):e[i])),s===null?t:o<s?t:e},reduceAverage:function(e,t,n,r,i){i&&t&&(t=t.get?t.get(i):t[i]);var s=(e||0)+t,o=r.get?r.get("length"):r.length;return n>=o-1&&(s/=o),s},reduceSum:function(e,t,n,r,i){return i&&t&&(t=t.get?t.get(i):t[i]),e===null?t:e+t}},SC.mixin(SC.Enumerable,SC.Reducers),SC.mixin(Array.prototype,SC.Reducers),Array.prototype.isEnumerable=YES,function(){var e={nextObject:SC.Enumerable.nextObject,enumerator:SC.Enumerable.enumerator,firstObject:SC.Enumerable.firstObject,lastObject:SC.Enumerable.lastObject,sortProperty:SC.Enumerable.sortProperty,mapProperty:function(e){var t=this.length,n=[];for(
var r=0;r<t;r++){var i=this[r];n[r]=i?i.get?i.get(e):i[e]:null}return n},filterProperty:function(e,t){var n=this.length,r=[];for(var i=0;i<n;i++){var s=this[i],o=s?s.get?s.get(e):s[e]:null,u=t===undefined?!!o:SC.isEqual(o,t);u&&r.push(s)}return r},groupBy:function(e){var t=this.length,n=[],r=[],i=[],s,o,u;for(s=0;s<t;s++)o=this[s],u=o?o.get?o.get(e):o[e]:null,SC.none(r[u])&&(r[u]=[],i.push(u)),r[u].push(o);for(s=0,t=i.length;s<t;s++)n.push(r[i[s]]);return n},find:function(e,t){if(typeof e!="function")throw new TypeError;var n=this.length;t===undefined&&(t=null);var r,i=null,s=NO;for(var o=0;o<n&&!s;o++){r=this[o];if(s=e.call(t,r,o,this))i=r}return r=null,i},findProperty:function(e,t){var n=this.length,r,i,s=NO,o=null;for(var u=0;u<n&&!s;u++)i=(r=this[u])?r.get?r.get(e):r[e]:null,s=t===undefined?!!i:SC.isEqual(i,t),s&&(o=r);return r=null,o},everyProperty:function(e,t){var n=this.length,r=YES;for(var i=0;r&&i<n;i++){var s=this[i],o=s?s.get?s.get(e):s[e]:null;r=t===undefined?!!o:SC.isEqual(o,t)}return r},someProperty:function(e,t){var n=this.length,r=NO;for(var i=0;!r&&i<n;i++){var s=this[i],o=s?s.get?s.get(e):s[e]:null;r=t===undefined?!!o:SC.isEqual(o,t)}return r},invoke:function(e){var t=this.length;if(t<=0)return[];var n,r=[],i=arguments.length;if(i>1)for(n=1;n<i;n++)r.push(arguments[n]);var s=[];for(n=0;n<t;n++){var o=this[n],u=o?o[e]:null;u&&(s[n]=u.apply(o,r))}return s},invokeWhile:function(e,t){var n=this.length;if(n<=0)return null;var r,i=[],s=arguments.length;if(s>2)for(r=2;r<s;r++)i.push(arguments[r]);var o=e;for(r=0;o===e&&r<n;r++){var u=this[r],a=u?u[t]:null;a&&(o=a
.apply(u,i))}return o},toArray:function(){var e=this.length;if(e<=0)return[];var t=[];for(var n=0;n<e;n++){var r=this[n];t.push(r)}return t},getEach:function(e){var t=[],n=this.length;for(var r=0;r<n;r++){var i=this[r];t[r]=i?i.get?i.get(e):i[e]:null}return t},setEach:function(e,t){var n=this.length;for(var r=0;r<n;r++){var i=this[r];i&&(i.set?i.set(e,t):i[e]=t)}return this}},t={forEach:function(e,t){if(typeof e!="function")throw new TypeError;t===undefined&&(t=null);for(var n=0,r=this.length;n<r;n++){var i=this[n];e.call(t,i,n,this)}return this},map:function(e,t){if(typeof e!="function")throw new TypeError;t===undefined&&(t=null);var n=[];for(var r=0,i=this.length;r<i;r++){var s=this[r];n[r]=e.call(t,s,r,this)}return n},filter:function(e,t){if(typeof e!="function")throw new TypeError;t===undefined&&(t=null);var n=[];for(var r=0,i=this.length;r<i;r++){var s=this[r];e.call(t,s,r,this)&&n.push(s)}return n},every:function(e,t){if(typeof e!="function")throw new TypeError;var n=this.length;t===undefined&&(t=null);var r=YES;for(var i=0;r&&i<n;i++){var s=this[i];e.call(t,s,i,this)||(r=NO)}return r},some:function(e,t){if(typeof e!="function")throw new TypeError;var n=this.length;t===undefined&&(t=null);var r=NO;for(var i=0;!r&&i<n;i++){var s=this[i];e.call(t,s,i,this)&&(r=YES)}return r},reduce:function(e,t,n){if(typeof e!="function")throw new TypeError;var r=this.length;if(r===0&&t===undefined)throw new TypeError;var i=t;for(var s=0;s<r;s++){var o=this[s];o!==null&&(i===undefined?i=o:i=e.call(null,i,o,s,this,n))}if(i===undefined)throw new TypeError;return i}};for(var n in t){if(!t.hasOwnProperty
(n))continue;if(!Array.prototype[n]||typeof Prototype=="object"&&Prototype.Version.match(/^1\.6/))Array.prototype[n]=t[n]}SC.mixin(Array.prototype,e)}(),SC.RangeObserver={isRangeObserver:YES,toString:function(){var e=this.indexes?this.indexes.toString():"SC.IndexSet<..>";return e.replace("IndexSet","RangeObserver(%@)".fmt(SC.guidFor(this)))},create:function(e,t,n,r,i,s){var o=SC.beget(this);return o.source=e,o.indexes=t?t.frozenCopy():null,o.target=n,o.method=typeof r=="string"?n[r]:r,o.context=i,o.isDeep=s||!1,o.beginObserving(),o},extend:function(e){var t=SC.beget(this),n=arguments;for(var r=0,i=n.length;r<i;r++)SC.mixin(t,n[r]);return t},destroy:function(e){return this.endObserving(),this},update:function(e,t){return this.indexes&&this.indexes.isEqual(t)?this:(this.indexes=t?t.frozenCopy():null,this.endObserving().beginObserving(),this)},beginObserving:function(){if(!this.isDeep)return this;var e=this.observing=this.observing||SC.CoreSet.create(),t=this._beginObservingForEach,n=this.source;return t||(t=this._beginObservingForEach=function(t){var r=n.objectAt(t);r&&r.addObserver&&(e.push(r),r._kvo_needsRangeObserver=!0)}),this.indexes.forEach(t),this.isObserving=!1,SC.Observers.addPendingRangeObserver(this),this},setupPending:function(e){var t=this.observing;if(this.isObserving||!t||t.get("length")===0)return!0;if(t.contains(e)){this.isObserving=!0;var n=this._setupPendingForEach;if(!n){var r=this.source,i=this.objectPropertyDidChange,s=this;n=this._setupPendingForEach=function(e){var n=r.objectAt(e),o=SC.guidFor(n),u;n&&n.addObserver&&(t.push(n),n.addObserver("*",s,i),u=s
[o],u==null?s[o]=e:u.isIndexSet?u.add(e):s[o]=SC.IndexSet.create(u).add(e))}}return this.indexes.forEach(n),!0}return!1},endObserving:function(){if(!this.isDeep)return this;var e=this.observing;if(this.isObserving){var t=this.objectPropertyDidChange,n=this.source,r,i,s;if(e){i=e.length;for(r=0;r<i;r++)s=e[r],s.removeObserver("*",this,t),this[SC.guidFor(s)]=null;e.length=0}this.isObserving=!1}return e&&e.clear(),this},rangeDidChange:function(e){var t=this.indexes;if(!e||!t||t.intersects(e))this.endObserving(),this.method.call(this.target,this.source,null,"[]",e,this.context),this.beginObserving();return this},objectPropertyDidChange:function(e,t,n,r){var i=this.context,s=this.method,o=SC.guidFor(e),u=this[o];u&&!u.isIndexSet&&(u=this[o]=SC.IndexSet.create(u).freeze()),s.call(this.target,this.source,e,t,u,i||r,r)}},SC.OUT_OF_RANGE_EXCEPTION="Index out of range",SC.CoreArray={isSCArray:YES,replace:function(e,t,n){throw"replace() must be implemented to support SC.Array"},indexOf:function(e,t){var n,r=this.get("length");t===undefined?t=0:t=t<0?Math.ceil(t):Math.floor(t),t<0&&(t+=r);for(n=t;n<r;n++)if(this.objectAt(n,YES)===e)return n;return-1},lastIndexOf:function(e,t){var n,r=this.get("length");t===undefined?t=r-1:t=t<0?Math.ceil(t):Math.floor(t),t<0&&(t+=r);for(n=t;n>=0;n--)if(this.objectAt(n)===e)return n;return-1},objectAt:function(e){return e<0?undefined:e>=this.get("length")?undefined:this.get(e)},"[]":function(e,t){return t!==undefined&&this.replace(0,this.get("length"),t),this}.property(),insertAt:function(e,t){if(e>this.get("length"))throw SC.OUT_OF_RANGE_EXCEPTION;return this
.replace(e,0,[t]),this},removeAt:function(e,t){var n=0,r=[];if(typeof e===SC.T_NUMBER){if(e<0||e>=this.get("length"))throw SC.OUT_OF_RANGE_EXCEPTION;if(t===undefined)return this.replace(e,1,r),this;e=SC.IndexSet.create(e,t)}return this.beginPropertyChanges(),e.forEachRange(function(e,t){e-=n,n+=t,this.replace(e,t,r)},this),this.endPropertyChanges(),this},removeObject:function(e){var t=this.get("length")||0;while(--t>=0){var n=this.objectAt(t);n==e&&this.removeAt(t)}return this},removeObjects:function(e){return this.beginPropertyChanges(),e.forEach(function(e){this.removeObject(e)},this),this.endPropertyChanges(),this},slice:function(e,t){var n=[],r=this.get("length");SC.none(e)&&(e=0);if(SC.none(t)||t>r)t=r;while(e<t)n[n.length]=this.objectAt(e++);return n},pushObject:function(e){return this.insertAt(this.get("length"),e),e},pushObjects:function(e){return this.beginPropertyChanges(),e.forEach(function(e){this.pushObject(e)},this),this.endPropertyChanges(),this},popObject:function(){var e=this.get("length");if(e===0)return null;var t=this.objectAt(e-1);return this.removeAt(e-1),t},shiftObject:function(){if(this.get("length")===0)return null;var e=this.objectAt(0);return this.removeAt(0),e},unshiftObject:function(e){return this.insertAt(0,e),e},unshiftObjects:function(e){return this.beginPropertyChanges(),e.forEach(function(e){this.unshiftObject(e)},this),this.endPropertyChanges(),this},isEqual:function(e){if(!e)return!1;if(e==this)return!0;var t=e.get("length");if(t!=this.get("length"))return!1;while(--t>=0)if(!SC.isEqual(e.objectAt(t),this.objectAt(t)))return!1;return!0},compact
:function(){return this.without(null)},without:function(e){if(this.indexOf(e)<0)return this;var t=[];return this.forEach(function(n){n!==e&&(t[t.length]=n)}),t},uniq:function(){var e=[];return this.forEach(function(t){e.indexOf(t)<0&&(e[e.length]=t)}),e},flatten:function(){var e=[];return this.forEach(function(t){t&&t.isEnumerable?e=e.pushObjects(t.flatten()):e.pushObject(t)}),e},max:function(){return Math.max.apply(Math,this)},min:function(){return Math.min.apply(Math,this)},rangeObserverClass:SC.RangeObserver,contains:function(e){return this.indexOf(e)>=0},addRangeObserver:function(e,t,n,r){var i=this._array_rangeObservers;i||(i=this._array_rangeObservers=SC.CoreSet.create()),this._array_oldLength===undefined&&(this._array_oldLength=this.get("length"));var s=this.rangeObserverClass,o=NO,u=s.create(this,e,t,n,r,o);return i.add(u),this._array_isNotifyingRangeObservers||(this._array_isNotifyingRangeObservers=YES,this.addObserver("[]",this,this._array_notifyRangeObservers)),u},updateRangeObserver:function(e,t){return e.update(this,t)},removeRangeObserver:function(e){var t=e.destroy(this),n=this._array_rangeObservers;return n&&n.remove(e),t},addArrayObservers:function(e){this._modifyObserverSet("add",e)},removeArrayObservers:function(e){this._modifyObserverSet("remove",e)},_modifyObserverSet:function(e,t){var n,r,i=t.target||this,s=t.willChange||"arrayWillChange",o=t.didChange||"arrayDidChange",u=t.context;typeof s=="string"&&(s=i[s]),typeof o=="string"&&(o=i[o]),n=this._kvo_for("_kvo_array_will_change",SC.ObserverSet),r=this._kvo_for("_kvo_array_did_change",SC.ObserverSet),n[e
](i,s,u),r[e](i,o,u)},arrayContentWillChange:function(e,t,n){this._teardownContentObservers(e,t);var r,i,s,o,u,a,f=this._kvo_array_will_change;if(f){i=f.members,s=i.length;for(o=0;o<s;o++)r=i[o],u=r[0],a=r[1],a.call(u,e,t,n,this)}},arrayContentDidChange:function(e,t,n){var r=this._array_rangeObservers,i,s,o;this.beginPropertyChanges(),this.notifyPropertyChange("length"),r&&r.length>0&&(o=this._array_rangeChanges,o||(o=this._array_rangeChanges=SC.IndexSet.create()),t===n?s=t:(s=this.get("length")-e,t>n&&(s+=t-n)),o.add(e,s)),this._setupContentObservers(e,n);var u,a,f,l,c,h,p=this._kvo_array_did_change;if(p){e===undefined&&(e=0,t=this.get("length"),n=0),a=p.members,f=a.length;for(l=0;l<f;l++)u=a[l],c=u[0],h=u[1],h.call(c,e,t,n,this)}return this.notifyPropertyChange("[]"),this.endPropertyChanges(),this},_setupContentObservers:function(e,t){var n=this._kvo_for("_kvo_content_observed_keys",SC.CoreSet),r,i;if(n.get("length")>0){r=this.slice(e,e+t);var s=this;n.forEach(function(e){i=SC.keyFor("_kvo_content_observers",e),s._kvo_for(i).forEach(function(e){r.forEach(function(t){s._resumeChainObservingForItemWithChainObserver(t,e)})})})}},_teardownContentObservers:function(e,t){var n=this._kvo_for("_kvo_content_observed_keys",SC.CoreSet),r,i;n.get("length")>0&&(r=this.slice(e,e+t),n.forEach(function(e){i=SC.keyFor("_kvo_content_observers",e),r.forEach(function(e){e._kvo_for(i).forEach(function(e){e.destroyChain()})})}))},teardownEnumerablePropertyChains:function(e){var t=this._kvo_enumerable_property_chains;return t&&t.forEach(function(t){var n,r=e.get("length"),i=SC.guidFor(t),s,o,u="_kvo_enumerable_property_clones"
;t.notifyPropertyDidChange();for(n=0;n<r;n++)o=e.objectAt(n),s=o[u][i],s.deactivate(),delete o[u][i]},this),this},setupEnumerablePropertyChains:function(e){var t=this._kvo_enumerable_property_chains;return t&&t.forEach(function(t){var n,r=e.get("length");t.notifyPropertyDidChange(),r=e.get("length");for(n=0;n<r;n++)this._clonePropertyChainToItem(t,e.objectAt(n))},this),this},registerDependentKeyWithChain:function(e,t){var n="_kvo_enumerable_property_chains",r,i,s,o;r=this._kvo_for(n,SC.CoreSet),r.add(t),this.forEach(function(e){this._clonePropertyChainToItem(t,e)},this)},_clonePropertyChainToItem:function(e,t){var n=SC.clone(e),r="_kvo_enumerable_property_clones",i;n.object=t,i=t[r]=t[r]||{},i[SC.guidFor(e)]=n,n.activate(t)},removeDependentKeyWithChain:function(e,t){var n="_kvo_enumerable_property_chains",r="_kvo_enumerable_property_clones",i,s,o,u;this.forEach(function(n){n.removeDependentKeyWithChain(e,t),u=n[r],o=u[SC.guidFor(t)],o.deactivate(n)},this)},_resumeChainObservingForItemWithChainObserver:function(e,t){var n=SC.clone(t.next),r=n.property;n.object=e,e.addObserver(r,n,n.propertyDidChange),t.root.tails&&t.root.tails.pushObject(n.tail()),n.propertyDidChange(),e._kvo_for(SC.keyFor("_kvo_content_observers",r)).push(n)},_addContentObserver:function(e){var t=e.next.property;this._kvo_for("_kvo_content_observed_keys",SC.CoreSet).push(t);var n=SC.keyFor("_kvo_content_observers",t);this._kvo_for(n).push(e),this._setupContentObservers(0,e.object.get("length"))},_removeContentObserver:function(e){var t,n,r=this._kvo_content_observed_keys,i=e.next.property;r.contains(i)&&(n=SC
.keyFor("_kvo_content_observers",i),t=this._kvo_for(n),t.removeObject(e),this._teardownContentObservers(0,e.object.get("length")),t.length===0&&this._kvo_for("_kvo_content_observed_keys").remove(i))},_array_notifyRangeObservers:function(){var e=this._array_rangeObservers,t=this._array_rangeChanges,n=e?e.length:0,r,i;if(n>0&&t&&t.length>0){for(r=0;r<n;r++)e[r].rangeDidChange(t);t.clear()}}},SC.Array=SC.mixin({},SC.Enumerable,SC.CoreArray),SC.supplement(Array.prototype,SC.CoreArray),SC.mixin(Array.prototype,{replace:function(e,t,n){if(this.isFrozen)throw SC.FROZEN_ERROR;var r,i=n?n.get?n.get("length"):n.length:0;return this.arrayContentWillChange(e,t,i),i===0?this.splice(e,t):(r=[e,t].concat(n),this.splice.apply(this,r)),this.arrayContentDidChange(e,t,i),this.enumerableContentDidChange(e,t,i-t),this},unknownProperty:function(e,t){var n=this.reducedProperty(e,t);return t!==undefined&&n===undefined&&(n=this[e]=t),n}}),Array.prototype.indexOf===SC.CoreArray.indexOf&&(Array.prototype.indexOf=function(e,t){var n,r=this.length;t===undefined?t=0:t=t<0?Math.ceil(t):Math.floor(t),t<0&&(t+=r);for(n=t;n<r;n++)if(this[n]===e)return n;return-1}),Array.prototype.lastIndexOf===SC.CoreArray.lastIndexOf&&(Array.prototype.lastIndexOf=function(e,t){var n,r=this.length;t===undefined?t=r-1:t=t<0?Math.ceil(t):Math.floor(t),t<0&&(t+=r);for(n=t;n>=0;n--)if(this[n]===e)return n;return-1}),Date.now||(Date.now=function(){return(new Date).getTime()}),function(){var e=0,t=["ms","moz","webkit","o"],n;for(var r=0,i=t.length;r<i&&!window.requestAnimationFrame;++r)n=t[r],window.requestAnimationFrame=window[n+"RequestAnimationFrame"
],window.cancelAnimationFrame=window[n+"CancelAnimationFrame"]||window[n+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=SC.getCurrentTimeForPerformance(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),SC.String={_scs_valueForKey:function(e,t,n){var r,i,s,o=e.indexOf(":");o>-1&&(r=e.substr(o+1),e=e.substr(0,o)),i=t[e],s=t[e+"Formatter"];if(s)i=s(i,r);else if(r)throw"String.fmt was given a formatting string, but key `"+e+"` has no formatter! String: "+n;return i},fmt:function(e,t){var n=0,r=undefined,i,s,o;return t&&(r=t[0]),s=e,o=e.replace(/%\{(.*?)\}/g,function(t,n){i=YES;if(!r)throw"Cannot use named parameters with `fmt` without a data hash. String: '"+e+"'";return SC.String._scs_valueForKey(n,r,e)}),s.match(/%@/)&&(o=o.replace(/%@([0-9]+)?/g,function(r,s){if(i)throw"Invalid attempt to use both named parameters and indexed parameters. String: '"+e+"'";return s=s?parseInt(s,10)-1:n++,t[s]})),o},w:function(e){var t=[],n=e.split(" "),r=n.length,i,s=0;for(s=0;s<r;++s)i=n[s],i.length!==0&&t.push(i);return t}},SC.mixin(String.prototype,{fmt:function(){return SC.String.fmt(this,arguments)},w:function(){return SC.String.w(this)}}),SC.Comparable={isComparable:YES,compare:function(e,t){throw"%@.compare() is not implemented".fmt(this.toString())}},SC.Copyable={isCopyable:YES,copy:function(e){var t=SC._object_className(this.constructor);throw"%@.copy() is not implemented".fmt(t)},frozenCopy:function(
){var e=this.get?this.get("isFrozen"):this.isFrozen;if(e===YES)return this;if(e===undefined)throw"%@ does not support freezing".fmt(this);return this.copy().freeze()}},SC.mixin(Array.prototype,SC.Copyable),Array.prototype.copy=function(e){var t=this.slice(),n;if(e){n=t.length;while(n--)t[n]=SC.copy(t[n],!0)}return t},SC.FROZEN_ERROR=new Error("Cannot modify a frozen object"),SC.Freezable={isFreezable:YES,isFrozen:NO,freeze:function(){return this.set?this.set("isFrozen",YES):this.isFrozen=YES,this}},SC.mixin(Array.prototype,SC.Freezable),SC.Set=SC.mixin({},SC.Enumerable,SC.Observable,SC.Freezable,{create:function(e){var t,n,r=SC.Set._pool,i=this.isObservable,s;if(!i&&e===undefined&&r.length>0)return r.pop();t=SC.beget(this),i&&t.initObservable();if(e&&e.isEnumerable&&e.get("length")>0){t.isObservable=NO;if(e.isSCArray){s=e.get("length");for(n=0;n<s;n++)t.add(e.objectAt(n))}else if(e.isSet){s=e.length;for(n=0;n<s;n++)t.add(e[n])}else e.forEach(function(e){t.add(e)},this);t.isObservable=i}return t},isSet:YES,length:0,firstObject:function(){return this.length>0?this[0]:undefined}.property(),clear:function(){if(this.isFrozen)throw SC.FROZEN_ERROR;return this.length=0,this},contains:function(e){if(e===null)return NO;var t=this[SC.hashFor(e)];return!SC.none(t)&&t<this.length&&this[t]===e},isEqual:function(e){if(!e||!e.isSet||e.get("length")!==this.get("length"))return NO;var t=this.get("length");while(--t>=0)if(!e.contains(this[t]))return NO;return YES},addSetObserver:function(e){this.setObservers||(this.setObservers=SC.CoreSet.create()),this.setObservers.add(e)},removeSetObserver:
function(e){if(!this.setObservers)return;this.setObservers.remove(e)},add:function(e){if(this.isFrozen)throw SC.FROZEN_ERROR;if(SC.none(e))return this;var t,n=(t=e.hash)&&typeof t=="function"?t.call(e):SC.guidFor(e),r=this[n],i=this.length;if(r>=i||this[r]!==e)this[i]=e,this[n]=i,this.length=i+1,this.setObservers&&this.didAddItem(e);return this.isObservable&&this.enumerableContentDidChange(),this},addEach:function(e){if(this.isFrozen)throw SC.FROZEN_ERROR;if(!e||!e.isEnumerable)throw"%@.addEach must pass enumerable".fmt(this);var t,n=this.isObservable;n&&this.beginPropertyChanges();if(e.isSCArray){t=e.get("length");while(--t>=0)this.add(e.objectAt(t))}else if(e.isSet){t=e.length;while(--t>=0)this.add(e[t])}else e.forEach(function(e){this.add(e)},this);return n&&this.endPropertyChanges(),this},remove:function(e){if(this.isFrozen)throw SC.FROZEN_ERROR;if(e===null||e===undefined)return this;var t,n=e&&(t=e.hash)&&typeof t===SC.T_FUNCTION?t.call(e):SC.guidFor(e),r=this[n],i=this.length,s;return r===null||r===undefined||r>=i||this[r]!==e?this:(delete this[n],r<i-1&&(s=this[r]=this[i-1],n=s&&(t=s.hash)&&typeof t===SC.T_FUNCTION?t.call(s):SC.guidFor(s),this[n]=r),delete this[i-1],this.length=i-1,this.isObservable&&this.enumerableContentDidChange(),this.setObservers&&this.didRemoveItem(e),this)},pop:function(){if(this.isFrozen)throw SC.FROZEN_ERROR;var e=this.length,t=e>0?this[e-1]:null;return this.remove(t),t},removeEach:function(e){if(this.isFrozen)throw SC.FROZEN_ERROR;if(!e||!e.isEnumerable)throw"%@.addEach must pass enumerable".fmt(this);var t,n=this.isObservable;n&&this.beginPropertyChanges
();if(e.isSCArray){t=e.get("length");while(--t>=0)this.remove(e.objectAt(t))}else if(e.isSet){t=e.length;while(--t>=0)this.remove(e[t])}else e.forEach(function(e){this.remove(e)},this);return n&&this.endPropertyChanges(),this},copy:function(){return this.constructor.create(this)},destroy:function(){return this.isFrozen=NO,this.isObservable||SC.Set._pool.push(this.clear()),this},forEach:function(e,t){var n=this.length;t||(t=this);for(var r=0;r<n;r++)e.call(t,this[r],r,this);return this},toString:function(){var e=this.length,t,n=[];for(t=0;t<e;t++)n[t]=this[t];return"SC.Set<%@>".fmt(n.join(","))},didAddItem:function(e){var t=this.setObservers;if(!t)return;var n=t.length,r;for(r=0;r<n;r++)t[r].didAddItem(this,e)},didRemoveItem:function(e){var t=this.setObservers;if(!t)return;var n=t.length,r;for(r=0;r<n;r++)t[r].didRemoveItem(this,e)},_pool:[],isObservable:YES}),SC.Set.constructor=SC.Set,SC.Set.clone=SC.Set.copy,SC.Set.push=SC.Set.unshift=SC.Set.add,SC.Set.shift=SC.Set.pop,SC.Set.addObject=SC.Set.add,SC.Set.removeObject=SC.Set.remove,SC.Set._pool=[],SC.CoreSet=SC.beget(SC.Set),SC.CoreSet.isObservable=NO,SC.CoreSet.constructor=SC.CoreSet,SC.Observers={queue:[],addObserver:function(e,t,n,r){var i;typeof e=="string"?i=SC.tupleForPropertyPath(e,r):i=e,i&&i[0].addObserver?i[0].addObserver(i[1],t,n):this.queue.push([e,t,n,r])},removeObserver:function(e,t,n,r){var i,s,o,u;o=SC.tupleForPropertyPath(e,r),o&&o[0].removeObserver(o[1],t,n),i=this.queue.length,s=this.queue,newQueue=undefined;while(--i>=0){u=s[i];if(u[0]!==e||u[1]!==t||u[2]!==n||u[3]!==r)newQueue||(newQueue=[]),newQueue.push
(u)}this.queue=newQueue||this.queue},addPendingRangeObserver:function(e){var t=this.rangeObservers;return t||(t=this.rangeObservers=SC.CoreSet.create()),t.add(e),this},_TMP_OUT:[],flush:function(e){var t=this.queue,n,r=t.length;if(t&&r>0){var i=this.queue=[];for(n=0;n<r;n++){var s=t[n];if(!s)continue;var o=SC.tupleForPropertyPath(s[0],s[3]);o&&o[0].addObserver?o[0].addObserver(o[1],s[1],s[2]):i.push(s)}}if(e._kvo_needsRangeObserver){var u=this.rangeObservers,a=u?u.get("length"):0,f=this._TMP_OUT,l;for(n=0;n<a;n++)l=u[n],l.setupPending(e)&&f.push(l);f.length>0&&u.removeEach(f),f.length=0,e._kvo_needsRangeObserver=!1}},isObservingSuspended:0,_pending:SC.CoreSet.create(),objectHasPendingChanges:function(e){this._pending.add(e)},suspendPropertyObserving:function(){this.isObservingSuspended++},resumePropertyObserving:function(){var e;if(--this.isObservingSuspended<=0){e=this._pending,this._pending=SC.CoreSet.create();var t,n=e.length;for(t=0;t<n;t++)e[t]._notifyPropertyObservers();e.clear(),e=null}}},SC.BENCHMARK_OBJECTS=NO,SC._detect_base=function(t,n,r){return function(){var i=n[r],s;if(!i)throw new Error("No '"+r+"' method was found on the superclass");return t.isEnhancement?s=Array.prototype.slice.call(arguments,1):s=arguments,i.apply(this,s)}},SC._object_extend=function(t,n,r){if(!n)throw"SC.Object.extend expects a non-null value.  Did you forget to 'sc_require' something?  Or were you passing a Protocol to extend() as if it were a mixin?";t._kvo_cloned=null;var i,s,o,u,a=t.concatenatedProperties,f=SC.K,l,c;s=a?a.length:0;var h=s>0?{}:null;while(--s>=0)i=a[s],l=t[i],c=n[i],l?
(l instanceof Array||(l=SC.$A(l)),h[i]=c?l.concat(c):c):(c instanceof Array||(c=SC.$A(c)),h[i]=c);var p=t._bindings,d=NO,v=t._observers,m=NO,g=t._properties,y=NO,b,w,E,S,x=t.outlets,T=NO;n.outlets&&(x=(x||SC.EMPTY_ARRAY).concat(n.outlets),T=YES);for(i in n){if(i==="_kvo_cloned")continue;if(!n.hasOwnProperty(i))continue;S=(h.hasOwnProperty(i)?h[i]:null)||n[i];if(i.length>7&&i.slice(-7)==="Binding")d||(p=(p||SC.EMPTY_ARRAY).slice(),d=YES),p===null&&(p=(t._bindings||SC.EMPTY_ARRAY).slice()),p[p.length]=i;else if(S&&S instanceof Function){!S.superclass&&S!==(u=t[i])&&(S.superclass=u||f,S.base=r?SC._detect_base(S,r,i):u||f),S.propertyPaths&&(m||(v=(v||SC.EMPTY_ARRAY).slice(),m=YES),v[v.length]=i);if(b=S.localPropertyPaths){w=b.length;while(--w>=0)E=t._kvo_for(SC.keyFor("_kvo_local",b[w]),SC.CoreSet),E.add(i),t._kvo_for("_kvo_observed_keys",SC.CoreSet).add(b[w])}S.dependentKeys&&(y||(g=(g||SC.EMPTY_ARRAY).slice(),y=YES),g[g.length]=i),S.autoconfiguredOutlet&&(T||(x=(x||SC.EMPTY_ARRAY).slice(),T=YES),x[x.length]=i),S.isEnhancement&&(S=SC._enhance(t[i]||f,S))}t[i]=S}return n.hasOwnProperty("toString")&&(i="toString",S=(h.hasOwnProperty(i)?h[i]:null)||n[i],!S.superclass&&S!==(u=t[i])&&(S.superclass=S.base=u||f),t[i]=S),t._bindings=p||[],t._observers=v||[],t._properties=g||[],t.outlets=x||[],t},SC._enhance=function(e,t){return function(){var n=Array.prototype.slice.call(arguments,0),r=this;return n.unshift(function(){return e.apply(r,arguments)}),t.apply(this,n)}},SC.Object=function(e){return this.__sc_super__=SC.Object.prototype,this._object_init(e)},SC.mixin(SC.Object,{mixin:function(
e){var t=arguments.length,n;for(n=0;n<t;n++)SC.mixin(this,arguments[n]);return this},superclass:null,extend:function(e){var t=SC.BENCHMARK_OBJECTS;t&&SC.Benchmark.start("SC.Object.extend");var n,r=function(e){return this.__sc_super__=r.prototype,this._object_init(e)};for(n in this){if(!this.hasOwnProperty(n))continue;r[n]=this[n]}this.hasOwnProperty("toString")&&(r.toString=this.toString),r.superclass=this,r.__sc_super__=this.prototype,SC.generateGuid(r,"sc"),r.subclasses=SC.Set.create(),this.subclasses.add(r);var i=r.prototype=SC.beget(this.prototype),s,o=arguments.length;for(s=0;s<o;s++)SC._object_extend(i,arguments[s],r.__sc_super__);return i.constructor=r,t&&SC.Benchmark.end("SC.Object.extend"),r},reopen:function(e){return SC._object_extend(this.prototype,e,this.__sc_super__)},create:function(){var e=this,t=new e(arguments);return t},isClass:YES,subclasses:SC.Set.create(),toString:function(){return SC._object_className(this)},subclassOf:function(e){if(this===e)return NO;var t=this;while(t=t.superclass)if(t===e)return YES;return NO},hasSubclass:function(e){return e&&e.subclassOf?e.subclassOf(this):NO},kindOf:function(e){return this===e||this.subclassOf(e)},design:function(){if(this.isDesign)return this;var e=this.extend.apply(this,arguments);return e.isDesign=YES,e}}),SC.Object.prototype={_kvo_enabled:YES,_object_init:function(e){var t,n=e?e.length:0;for(t=0;t<n;t++)SC._object_extend(this,e[t],this.__sc_super__);SC.generateGuid(this,"sc"),this.init();var r=this.initMixin;n=r?r.length:0;for(t=0;t<n;t++)r[t].call(this);return this},mixin:function(){var e,t=arguments.length,
n;for(e=0;e<t;e++)SC.mixin(this,arguments[e]);for(e=0;e<t;e++)n=arguments[e].initMixin,n&&n.call(this);return this},init:function(){return this.initObservable(),this},isDestroyed:NO,destroy:function(){if(this.get("isDestroyed"))return this;this.set("isDestroyed",YES);var e,t=this.destroyMixin,n=t?t.length:0;for(e=0;e<n;e++)t[e].call(this);return this.bindings.invoke("disconnect"),this.bindings=null,this},isObject:!0,respondsTo:function(e){return this[e]instanceof Function},tryToPerform:function(e,t,n){return this.respondsTo(e)&&this[e](t,n)!==NO},superclass:function(e){var t=arguments.callee.caller;if(!t)throw"superclass cannot determine the caller method";return t.superclass?t.superclass.apply(this,arguments):null},instanceOf:function(e){return this.constructor===e},kindOf:function(e){return this.constructor.kindOf(e)},toString:function(){if(!this._object_toString){var e=SC._object_className(this.constructor),t=e+":"+SC.guidFor(this);if(!e)return t;this._object_toString=t}return this._object_toString},awake:function(){var e=this.outlets,t,n,r;for(t=0,n=e.length;t<n;++t)r=e[t],this.get(r);this.bindings.invoke("sync")},invokeOnce:function(e){return SC.RunLoop.currentRunLoop.invokeOnce(this,e),this},invokeLast:function(e){return SC.RunLoop.currentRunLoop.invokeLast(this,e),this},concatenatedProperties:["concatenatedProperties","initMixin","destroyMixin"]},SC.Object.prototype.constructor=SC.Object,SC.mixin(SC.Object.prototype,SC.Observable),SC.instanceOf=function(e,t){return!!e&&e.constructor===t},SC.kindOf=function(e,t){return e&&!e.isClass&&(e=e.constructor),!!(e&&e.kindOf&&e
.kindOf(t))},SC._object_className=function(e){if(SC.isReady===NO)return"";e._object_className||findClassNames();if(e._object_className)return e._object_className;var t=e;while(t&&!t._object_className)t=t.superclass;return t&&t._object_className?t._object_className:"Anonymous"},SC._PropertyChain=SC.Object.extend({object:null,property:null,target:null,toInvalidate:null,nextProperty:null,activate:function(e){var t=this.get("object"),n=this.get("property"),r;return e||(e=this.get("target")),t&&t!==e&&this.deactivate(),this.set("object",e),e&&n!=="@each"&&e.registerDependentKeyWithChain(n,this),this.next&&(r=e?e.get(n):undefined,this.next.activate(r)),this},deactivate:function(){var e=this.get("object"),t=this.get("property");return e&&e.removeDependentKeyWithChain(t,this),this.next&&this.next.deactivate(),this},notifyPropertyDidChange:function(){var e=this.get("target"),t=this.get("toInvalidate"),n,r;e.propertyDidChange(t),this.next&&(n=this.get("object"),r=n.get(this.get("property")),this.next.activate(r))}}),SC._PropertyChain.createChain=function(e,t,n){var r=e.split("."),i=r.length,s=1,o=SC._PropertyChain.create({property:r[0],target:t,toInvalidate:n,nextProperty:r[1]});o.set("length",i);var u=o;while(--i>=1)u=u.next=SC._PropertyChain.create({property:r[s],target:t,toInvalidate:n,nextProperty:r[++s]}),u.set("length",i);return o},SC.LOG_BINDINGS=NO,SC.BENCHMARK_BINDING_NOTIFICATIONS=NO,SC.BENCHMARK_BINDING_SETUP=NO,SC.MULTIPLE_PLACEHOLDER="@@MULT@@",SC.NULL_PLACEHOLDER="@@NULL@@",SC.EMPTY_PLACEHOLDER="@@EMPTY@@",SC.Binding={beget:function(e){var t=SC.beget(this);return t.parentBinding=
this,e!==undefined&&(t=t.from(e)),t},builder:function(){var e=this,t=function(t){return e.beget().from(t)};return t.beget=function(){return e.beget()},t},from:function(e,t){if(!e)return this;var n=this===SC.Binding?this.beget():this;return n._fromPropertyPath=e,n._fromRoot=t,n._fromTuple=null,n},to:function(e,t){var n=this===SC.Binding?this.beget():this;return n._toPropertyPath=e,n._toRoot=t,n._toTuple=null,n},connect:function(){return this.isConnected?this:(this.isConnected=YES,this._connectionPending=YES,this._syncOnConnect=YES,SC.Binding._connectQueue.add(this),SC.RunLoop.isRunLoopInProgress()||this._scheduleSync(),this)},_connect:function(){if(!this._connectionPending)return;this._connectionPending=NO;var e,t,n=SC.BENCHMARK_BINDING_SETUP;e=this._fromPropertyPath,t=this._fromRoot,typeof e=="string"&&(e.indexOf(".")===0?(e=e.slice(1),t||(t=this._toRoot)):e.indexOf("*")===0&&(e=[this._fromRoot||this._toRoot,e.slice(1)],t=null)),this._fromObserverData=[e,this,this.fromPropertyDidChange,t],SC.Observers.addObserver.apply(SC.Observers,this._fromObserverData),this._oneWay||(e=this._toPropertyPath,t=this._toRoot,this._toObserverData=[e,this,this.toPropertyDidChange,t],SC.Observers.addObserver.apply(SC.Observers,this._toObserverData)),this._syncOnConnect&&(this._syncOnConnect=NO,this.sync())},disconnect:function(){return this.isConnected?(this._connectionPending?this._connectionPending=NO:(SC.Observers.removeObserver.apply(SC.Observers,this._fromObserverData),this._oneWay||SC.Observers.removeObserver.apply(SC.Observers,this._toObserverData)),this.isConnected=NO,this):this},fromPropertyDidChange
:function(e,t){var n=e?e.get(t):null;if(n!==this._bindingValue||t==="[]")this._setBindingValue(e,t),this._changePending=YES,SC.Binding._changeQueue.add(this),this._scheduleSync()},toPropertyDidChange:function(e,t){if(this._oneWay)return;var n=e.get(t);n!==this._transformedBindingValue&&(this._setBindingValue(e,t),this._changePending=YES,SC.Binding._changeQueue.add(this),this._scheduleSync())},_scheduleSync:function(){if(SC.RunLoop.isRunLoopInProgress()||SC.Binding._syncScheduled)return;SC.Binding._syncScheduled=YES,setTimeout(function(){SC.run(),SC.Binding._syncScheduled=NO},1)},_setBindingValue:function(e,t){this._bindingSource=e,this._bindingKey=t},_computeBindingValue:function(){var e=this._bindingSource,t=this._bindingKey,n,r;this._bindingValue=n=e?e.getPath(t):null;var i=this._transforms;if(i){var s=i.length,o;for(r=0;r<s;r++)o=i[r],n=o(n,this)}this._noError&&SC.typeOf(n)===SC.T_ERROR&&(n=null),this._transformedBindingValue=n},_connectQueue:SC.CoreSet.create(),_alternateConnectQueue:SC.CoreSet.create(),_changeQueue:SC.CoreSet.create(),_alternateChangeQueue:SC.CoreSet.create(),_changePending:NO,flushPendingChanges:function(){if(this._isFlushing)return NO;this._isFlushing=YES,SC.Observers.suspendPropertyObserving();var e=NO,t=SC.LOG_BINDINGS,n,r;while((n=this._connectQueue).length>0){this._connectQueue=this._alternateConnectQueue,this._alternateConnectQueue=n;while(r=n.pop())r._connect()}while((n=this._changeQueue).length>0){e=YES,this._changeQueue=this._alternateChangeQueue,this._alternateChangeQueue=n;while(r=n.pop())r.applyBindingValue()}return this._isFlushing=NO,SC.Observers
.resumePropertyObserving(),e},applyBindingValue:function(){this._changePending=NO,this._computeBindingTargets(),this._computeBindingValue();var e=this._bindingValue,t=this._transformedBindingValue,n=SC.BENCHMARK_BINDING_NOTIFICATIONS,r=SC.LOG_BINDINGS;!this._oneWay&&this._fromTarget&&this._fromTarget.setPathIfChanged(this._fromPropertyKey,e),this._toTarget&&this._toTarget.setPathIfChanged(this._toPropertyKey,t)},sync:function(){if(!this.isConnected)return this;if(this._connectionPending)this._syncOnConnect=YES;else{this._computeBindingTargets();var e=this._fromTarget,t=this._fromPropertyKey;if(!e||!t)return this;if(!e.isObservable)return SC.Logger.warn("Cannot bind '%@' to property '%@' on non-observable '%@'".fmt(this._toPropertyPath,t,e)),this;var n=e.getPath(t);if(n!==this._bindingValue||t==="[]")this._setBindingValue(e,t),this._changePending=YES,SC.Binding._changeQueue.add(this)}return this},_syncOnConnect:NO,_computeBindingTargets:function(){if(!this._fromTarget){var e,t,n;e=this._fromPropertyPath,t=this._fromRoot,typeof e=="string"&&(e.indexOf(".")===0?(e=e.slice(1),t||(t=this._toRoot)):e.indexOf("*")===0&&(e=[t||this._toRoot,e.slice(1)],t=null)),n=SC.tupleForPropertyPath(e,t),n&&(this._fromTarget=n[0],this._fromPropertyKey=n[1])}this._toTarget||(e=this._toPropertyPath,t=this._toRoot,n=SC.tupleForPropertyPath(e,t),n&&(this._toTarget=n[0],this._toPropertyKey=n[1]))},oneWay:function(e,t){t===undefined&&SC.typeOf(e)===SC.T_BOOL&&(t=e,e=null);var n=this.from(e);return n===SC.Binding&&(n=n.beget()),n._oneWay=t===undefined?YES:t,n},transform:function(e){var t=this===SC.Binding?
this.beget():this,n=t._transforms;return n&&n===t.parentBinding._transforms&&(n=t._transforms=n.slice()),n||(n=t._transforms=[]),n.push(e),t},resetTransforms:function(){var e=this===SC.Binding?this.beget():this;return e._transforms=null,e},noError:function(e,t){t===undefined&&SC.typeOf(e)===SC.T_BOOL&&(t=e,e=null);var n=this.from(e);return n===SC.Binding&&(n=n.beget()),n._noError=t===undefined?YES:t,n},single:function(e,t){return t===undefined&&(t=SC.MULTIPLE_PLACEHOLDER),this.from(e).transform(function(e,n){if(e&&e.isEnumerable){var r=e.get("length");e=r>1?t:r<=0?null:e.firstObject()}return e})},notEmpty:function(e,t){return t===undefined&&(t=SC.EMPTY_PLACEHOLDER),this.from(e).transform(function(e,n){if(SC.none(e)||e===""||SC.isArray(e)&&e.length===0)e=t;return e})},notNull:function(e,t){return t===undefined&&(t=SC.EMPTY_PLACEHOLDER),this.from(e).transform(function(e,n){return SC.none(e)&&(e=t),e})},multiple:function(e){return this.from(e).transform(function(e){return SC.isArray(e)||(e=e==null?[]:[e]),e})},bool:function(e){return this.from(e).transform(function(e){var t=SC.typeOf(e);return t===SC.T_ERROR?e:t==SC.T_ARRAY?e.length>0:e===""?NO:!!e})},and:function(e,t){var n=SC.Object.create({valueABinding:e,valueBBinding:t,and:function(){return this.get("valueA")&&this.get("valueB")}.property("valueA","valueB").cacheable()});return this.from("and",n).oneWay()},or:function(e,t){var n=SC.Object.create({valueABinding:e,valueBBinding:t,or:function(){return this.get("valueA")||this.get("valueB")}.property("valueA","valueB").cacheable()});return this.from("or",n).oneWay()},not:function(
e){return this.from(e).transform(function(e){var t=SC.typeOf(e);return t===SC.T_ERROR?e:!(t==SC.T_ARRAY?e.length>0:e===""?NO:!!e)})},isNull:function(e){return this.from(e).transform(function(e){var t=SC.typeOf(e);return t===SC.T_ERROR?e:SC.none(e)})},toString:function(){var e=this._fromRoot?"<%@>:%@".fmt(this._fromRoot,this._fromPropertyPath):this._fromPropertyPath,t=this._toRoot?"<%@>:%@".fmt(this._toRoot,this._toPropertyPath):this._toPropertyPath,n=this._oneWay?"[oneWay]":"";return"SC.Binding%@(%@ -> %@)%@".fmt(SC.guidFor(this),e,t,n)}},SC.binding=function(e,t){return SC.Binding.from(e,t)},SC.Error=SC.Object.extend({code:-1,message:"",errorValue:null,errorObject:function(){return this}.property().cacheable(),label:null,toString:function(){return"SC.Error:%@:%@ (%@)".fmt(SC.guidFor(this),this.get("message"),this.get("code"))},isError:YES}),SC.Error.desc=function(e,t,n,r){var i={message:e};return t!==undefined&&(i.label=t),r!==undefined&&(i.code=r),n!==undefined&&(i.errorValue=n),this.create(i)},SC.$error=function(e,t,n,r){return SC.Error.desc(e,t,n,r)},SC.ok=function(e){return e!==!1&&(!e||!e.isError)},SC.$ok=SC.ok,SC.val=function(e){return e&&e.isError?e.get?e.get("errorValue"):null:e},SC.$val=SC.val,SC.Error.HAS_MULTIPLE_VALUES=-100,SC.IndexSet=SC.mixin({},SC.Enumerable,SC.Observable,SC.Freezable,SC.Copyable,{_sc_sliceContent:function(e){if(e.length<1e3)return e.slice();var t=0,n=[],r=e[0];while(r!==0)n[t]=r,t=r<0?0-r:r,r=e[t];return n[t]=0,this._hint(0,t,n),n},create:function(e,t){var n=SC.beget(this);return n.initObservable(),n.registerDependentKey("min","[]"),e&&e.isIndexSet?
(n._content=this._sc_sliceContent(e._content),n.max=e.max,n.length=e.length,n.source=e.source):(n._content=[0],e!==undefined&&n.add(e,t)),n},isIndexSet:YES,HINT_SIZE:256,length:0,max:0,min:function(){var e=this._content,t=e[0];return t===0?-1:t>0?0:Math.abs(t)}.property("[]").cacheable(),firstObject:function(){return this.get("length")>0?this.get("min"):undefined}.property(),rangeStartForIndex:function(e){var t=this._content,n=this.get("max"),r,i,s;if(e>=n)return n;if(Math.abs(t[e])>e)return e;s=e-e%SC.IndexSet.HINT_SIZE,r=t[s];if(r<0||r>e)r=s;i=Math.abs(t[r]);while(i<e)r=i,i=Math.abs(t[r]);return r},isEqual:function(e){if(e===this)return YES;if(!e||!e.isIndexSet||e.max!==this.max||e.length!==this.length)return NO;var t=this._content,n=e._content,r=0,i=t[r];do{if(n[r]!==i)return NO;r=Math.abs(i),i=t[r]}while(r!==0);return YES},indexBefore:function(e){if(e===0)return-1;e--;var t=this._content,n=this.get("max"),r=this.rangeStartForIndex(e);if(!t)return null;while(r===n||t[r]<0){if(r===0)return-1;e=r-1,r=this.rangeStartForIndex(e)}return e},indexAfter:function(e){var t=this._content,n=this.get("max"),r,i;if(!t||e>=n)return-1;e++,r=this.rangeStartForIndex(e),i=t[r];while(i<0){if(i===0)return-1;e=r=Math.abs(i),i=t[r]}return e},contains:function(e,t){var n,r,i,s,o;if(t===undefined){if(e===null||e===undefined)return NO;if(typeof e===SC.T_NUMBER)t=1;else{if(e&&e.isIndexSet){if(e===this)return YES;n=e._content,r=0,i=n[r];while(i!==0){if(i>0&&!this.contains(r,i-r))return NO;r=Math.abs(i),i=n[r]}return YES}t=e.length,e=e.start}}return s=this.rangeStartForIndex(e),o=this._content[s],o>0&&
s<=e&&o>=e+t},intersects:function(e,t){var n,r,i,s;if(t===undefined)if(typeof e===SC.T_NUMBER)t=1;else{if(e&&e.isIndexSet){if(e===this)return YES;n=e._content,r=0,i=n[r];while(i!==0){if(i>0&&this.intersects(r,i-r))return YES;r=Math.abs(i),i=n[r]}return NO}t=e.length,e=e.start}r=this.rangeStartForIndex(e),n=this._content,i=n[r],s=e+t;while(r<s){if(i===0)return NO;if(i>0&&i>e)return YES;r=Math.abs(i),i=n[r]}return NO},without:function(e,t){return e===this?SC.IndexSet.create():this.clone().remove(e,t)},replace:function(e,t){if(t===undefined)if(typeof e===SC.T_NUMBER)t=1;else{if(e&&e.isIndexSet)return this._content=this._sc_sliceContent(e._content),this.beginPropertyChanges().set("max",e.max).set("length",e.length).set("source",e.source).enumerableContentDidChange(),this.endPropertyChanges(),this;t=e.length,e=e.start}var n=this.length;return this._content.length=1,this._content[0]=0,this.length=this.max=0,this.add(e,t)},add:function(e,t){if(this.isFrozen)throw SC.FROZEN_ERROR;var n,r,i;if(e&&e.isIndexSet){n=e._content;if(!n)return this;r=0,i=n[0];while(i!==0)i>0&&this.add(r,i-r),r=i<0?0-i:i,i=n[r];return this}if(t===undefined){if(e===null||e===undefined)return this;typeof e===SC.T_NUMBER?t=1:(t=e.length,e=e.start)}else t===null&&(t=1);if(t<=0)return this;var s=this.get("max"),o=s,u,a;n=this._content;if(e===s)e>0?(r=this.rangeStartForIndex(e-1),i=n[r],i>0?(delete n[s],n[r]=s=e+t,e=r):n[s]=s=e+t):n[e]=s=t,n[s]=0,this.set("max",s),this.set("length",this.length+t),t=s-e;else if(e>s)n[s]=0-e,n[e]=e+t,n[e+t]=0,this.set("max",e+t),this.set("length",this.length+t),t=e+t-s,e=s;else{r=this
.rangeStartForIndex(e),i=n[r],s=e+t,u=0,e>0&&r===e&&i<=0&&(r=this.rangeStartForIndex(e-1),i=n[r]),i<0?(n[r]=0-e,Math.abs(i)>s?(n[e]=0-s,n[s]=i):n[e]=i):(e=r,i>s&&(s=i)),r=e;while(r<s)a=n[r],a===0?(n[s]=0,i=s,u+=s-r):(i=Math.abs(a),i>s&&(n[s]=a,i=s),a<0&&(u+=i-r)),delete n[r],r=i;(r=n[s])>0&&(delete n[s],s=r),n[e]=s,s>o&&this.set("max",s),this.set("length",this.get("length")+u),t=s-e}return this._hint(e,t),u!==0&&this.enumerableContentDidChange(),this},remove:function(e,t){if(this.isFrozen)throw SC.FROZEN_ERROR;if(t===undefined){if(e===null||e===undefined)return this;if(typeof e===SC.T_NUMBER)t=1;else{if(e.isIndexSet)return e.forEachRange(this.remove,this),this;t=e.length,e=e.start}}if(t<=0)return this;var n=this.get("max"),r=n,i=this._content,s,o,u,a,f;if(e>=n)return this;s=this.rangeStartForIndex(e),o=i[s],f=e+t,u=0;var l=this.HINT_SIZE,c=e-e%l+l;Math.abs(i[c])===e&&(i[c]=0),e>0&&s===e&&o>0&&(s=this.rangeStartForIndex(e-1),o=i[s]),o>0?(i[s]=e,o>f?(i[e]=f,i[f]=o):i[e]=o):(e=s,o=Math.abs(o),o>f&&(f=o)),s=e;while(s<f)a=i[s],a===0?(i[f]=0,o=f):(o=Math.abs(a),o>f&&(i[f]=a,o=f),a>0&&(u+=o-s)),delete i[s],s=o;return(s=i[f])<0&&(delete i[f],f=Math.abs(s)),i[f]===0?(delete i[f],i[e]=0,this.set("max",e)):i[e]=0-f,this.set("length",this.get("length")-u),t=f-e,this._hint(e,t),u!==0&&this.enumerableContentDidChange(),this},_hint:function(e,t,n){n===undefined&&(n=this._content);var r=SC.IndexSet.HINT_SIZE,i=Math.abs(n[e]),s=e-e%r+r,o=e+t;while(s<o){while(i!==0&&i<=s)e=i,i=Math.abs(n[e]);i===0?delete n[s]:s!==e&&(n[s]=-e),s+=r}},clear:function(){if(this.isFrozen)throw SC.FROZEN_ERROR;var e=
this.length;this._content.length=1,this._content[0]=0,this.set("length",0).set("max",0),e>0&&this.enumerableContentDidChange()},addEach:function(e){if(this.isFrozen)throw SC.FROZEN_ERROR;this.beginPropertyChanges();var t=e.get("length");if(e.isSCArray)while(--t>=0)this.add(e.objectAt(t));else e.isEnumerable&&e.forEach(function(e){this.add(e)},this);return this.endPropertyChanges(),this},removeEach:function(e){if(this.isFrozen)throw SC.FROZEN_ERROR;this.beginPropertyChanges();var t=e.get("length");if(e.isSCArray)while(--t>=0)this.remove(e.objectAt(t));else e.isEnumerable&&e.forEach(function(e){this.remove(e)},this);return this.endPropertyChanges(),this},clone:function(){return SC.IndexSet.create(this)},inspect:function(){var e=this._content,t=e.length,n=0,r=[],i;for(n=0;n<t;n++)i=e[n],i!==undefined&&r.push("%@:%@".fmt(n,i));return"SC.IndexSet<%@>".fmt(r.join(" , "))},forEachRange:function(e,t){var n=this._content,r=0,i=n[r],s=this.source;t===undefined&&(t=null);while(i!==0)i>0&&e.call(t,r,i-r,this,s),r=Math.abs(i),i=n[r];return this},forEachIn:function(e,t,n,r){var i=this._content,s=0,o=0,u=e+t,a=this.source,f=i[s];r===undefined&&(r=null);while(f!==0){s<e&&(s=e);while(s<f&&s<u)n.call(r,s++,o++,this,a);s>=u?s=f=0:(s=Math.abs(f),f=i[s])}return this},lengthIn:function(e,t){var n=0;if(t===undefined){if(e===null||e===undefined)return 0;if(typeof e===SC.T_NUMBER)t=1;else{if(e.isIndexSet)return e.forEachRange(function(e,t){n+=this.lengthIn(e,t)},this),n;t=e.length,e=e.start}}if(this.get("length")===0)return 0;var r=this._content,i=0,s=r[i],o=e+t;while(i<o&&s!==0)s>0&&(n+=s>o?o-i:s-i
),i=Math.abs(s),s=r[i];return n},source:null,indexOf:function(e,t){var n=this.source;if(!n)throw"%@.indexOf() requires source".fmt(this);var r=n.get("length"),i=this._content,s=i[0]<0?Math.abs(i[0]):0,o;while(s>=0&&s<r){o=n.indexOf(e,s);if(o<0)return-1;if(this.contains(o))return o;s=o+1}return-1},lastIndexOf:function(e,t){var n=this.source;if(!n)throw"%@.lastIndexOf() requires source".fmt(this);var r=n.get("length"),i=this.max-1,s;i>=r&&(i=r-1);while(i>=0){s=n.lastIndexOf(e,i);if(s<0)return-1;if(this.contains(s))return s;i=s+1}return-1},forEachObject:function(e,t){var n=this.source;if(!n)throw"%@.forEachObject() requires source".fmt(this);var r=this._content,i=0,s=0,o=r[i];t===undefined&&(t=null);while(o!==0){while(i<o)e.call(t,n.objectAt(i),i,n,this),i++;i=Math.abs(o),o=r[i]}return this},addObject:function(e,t){var n=this.source;if(!n)throw"%@.addObject() requires source".fmt(this);var r=n.get("length"),i=0,s;while(i>=0&&i<r){s=n.indexOf(e,i);if(!(s>=0))return this;this.add(s);if(t)return this;i=s++}return this},addObjects:function(e,t){return e.forEach(function(e){this.addObject(e,t)},this),this},removeObject:function(e,t){var n=this.source;if(!n)throw"%@.removeObject() requires source".fmt(this);var r=n.get("length"),i=0,s;while(i>=0&&i<r){s=n.indexOf(e,i);if(!(s>=0))return this;this.remove(s);if(t)return this;i=s+1}return this},removeObjects:function(e,t){return e.forEach(function(e){this.removeObject(e,t)},this),this},LOG_OBSERVING:NO,forEach:function(e,t){var n=this._content,r=0,i=0,s=this.source,o=n[r];t===undefined&&(t=null);while(o!==0){while(r<o)e.call(t,r++,i++,this
,s);r=Math.abs(o),o=n[r]}return this},nextObject:function(e,t,n){var r=this._content,i=n.next,s=this.get("max");if(t===null)t=i=0;else{if(t>=s)return delete n.next,null;t++}if(t===i){do t=Math.abs(i),i=r[t];while(i<0);n.next=i}return t<i?t:null},toString:function(){var e=[];return this.forEachRange(function(t,n){e.push(n===1?t:"%@..%@".fmt(t,t+n-1))},this),"SC.IndexSet<%@>".fmt(e.join(","))}}),SC.IndexSet.slice=SC.IndexSet.copy=SC.IndexSet.clone,SC.IndexSet.EMPTY=SC.IndexSet.create().freeze(),SC.json={encode:function(e){return JSON.stringify(e)},decode:function(e){return JSON.parse(e)}},this.JSON||(this.JSON={}),function(){function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)r=rep[n],typeof r=="string"&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.hasOwnProperty
.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));
if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),SC.LOGGER_LOG_DELIMITER=", ",SC.LOGGER_LOG_ERROR="ERROR: ",SC.LOGGER_LOG_INFO="INFO:  ",SC.LOGGER_LOG_WARN="WARN:  ",SC.LOGGER_LOG_DEBUG="DEBUG: ",SC.LOGGER_LOG_GROUP_HEADER="** %@",SC.LOGGER_LOG_GROUP_INDENTATION="    ",SC.LOGGER_RECORDED_LOG_TIMESTAMP_PREFIX="%@:  ",SC.LOGGER_LEVEL_DEBUG="debug",SC.LOGGER_LEVEL_INFO="info",SC.LOGGER_LEVEL_WARN="warn",SC.LOGGER_LEVEL_ERROR="error",SC.LOGGER_LEVEL_NONE="none",SC.Logger=SC.Object.create({messagePrefix:null,outputMessagePrefix:null,recordedMessagePrefix:null,logOutputLevel:null,logRecordingLevel:SC.LOGGER_LEVEL_NONE,recordedLogMessages:null,recordedLogMessagesMaximumLength:500,recordedLogMessagesPruningMinimumLength:100,debugEnabled:NO,exists:function(){return!SC.none(this.get("reporter"))}.property("reporter").cacheable(),fallBackOnAlert:NO,reporter:console,debug:function(e,t){SC.Logger._handleMessage(SC.LOGGER_LEVEL_DEBUG,YES,e,arguments)},debugWithoutFmt:function(){this._handleMessage(SC.LOGGER_LEVEL_DEBUG,NO,null,arguments)},debugGroup:function(e,t){SC.Logger._handleGroup(SC.LOGGER_LEVEL_DEBUG,e,arguments)},debugGroupEnd:function(){SC.Logger._handleGroupEnd(SC.LOGGER_LEVEL_DEBUG)},info:function(e,t){SC.Logger._handleMessage(SC.LOGGER_LEVEL_INFO,YES,e,arguments)},infoWithoutFmt:function(){this._handleMessage(SC.LOGGER_LEVEL_INFO
,NO,null,arguments)},infoGroup:function(e,t){SC.Logger._handleGroup(SC.LOGGER_LEVEL_INFO,e,arguments)},infoGroupEnd:function(){SC.Logger._handleGroupEnd(SC.LOGGER_LEVEL_INFO)},warn:function(e,t){SC.Logger._handleMessage(SC.LOGGER_LEVEL_WARN,YES,e,arguments)},warnWithoutFmt:function(){this._handleMessage(SC.LOGGER_LEVEL_WARN,NO,null,arguments)},warnGroup:function(e,t){SC.Logger._handleGroup(SC.LOGGER_LEVEL_WARN,e,arguments)},warnGroupEnd:function(){SC.Logger._handleGroupEnd(SC.LOGGER_LEVEL_WARN)},error:function(e,t){SC.Logger._handleMessage(SC.LOGGER_LEVEL_ERROR,YES,e,arguments)},errorWithoutFmt:function(){this._handleMessage(SC.LOGGER_LEVEL_ERROR,NO,null,arguments)},errorGroup:function(e,t){SC.Logger._handleGroup(SC.LOGGER_LEVEL_ERROR,e,arguments)},errorGroupEnd:function(){SC.Logger._handleGroupEnd(SC.LOGGER_LEVEL_ERROR)},outputRecordedLogMessages:function(e){if(!this.get("exists"))return;var t=this.get("reporter"),n=this.get("recordedLogMessages"),r=0,i=SC.LOGGER_RECORDED_LOG_TIMESTAMP_PREFIX,s,o,u,a,f,l,c,h,p,d,v,m,g;if(n)for(s=0,o=n.length;s<o;++s){u=n[s],a=u.type,e&&(f=i.fmt(u.timestamp.toUTCString())),l=u.message;if(l)c=u.originalArguments,this._outputMessage(a,f,r,l,c);else{d=u.indentation,p=u.title,v=d-r;if(t.group){if(Math.abs(v)>1)for(m=0,g=v-1;m<g;++m)v>0?t.group():t.groupEnd();v>0?(h=f?f:"",h+=p,t.group(h)):t.groupEnd()}else v>0&&this._outputGroup(a,f,d-1,p);r=d}}},stringifyRecordedLogMessages:function(){var e="",t=this.get("recordedLogMessages"),n=0,r=SC.LOGGER_RECORDED_LOG_TIMESTAMP_PREFIX,i=this._LOG_FALLBACK_PREFIX_MAPPING,s=SC.LOGGER_LOG_GROUP_HEADER,o,u,a,f,
l,c,h,p,d,v,m;if(t)for(o=0,u=t.length;o<u;++o)a=t[o],f=a.type,h=r.fmt(a.timestamp.toUTCString()),h+=i[f]||"",l=a.message,l?(c=a.originalArguments,p=h+this._indentation(n),p+=c?this._argumentsToString(c):l):(v=a.indentation,d=a.title,m=v-n,m>0&&(p=h+this._indentation(n)+s.fmt(d)),n=v),e+=p+"\n";return e},log:function(){var e=this.get("reporter"),t=arguments[0],n=this.get("messagePrefix"),r=this.get("outputMessagePrefix"),i=NO;return t&&SC.typeOf(t)===SC.T_STRING&&(n||r)&&(n&&(t=n+t),r&&(t=r+t),arguments[0]=t),this.get("exists")&&(typeof e.log=="function"?(e.log.apply(e,arguments),i=YES):e.log&&(e.log(this._argumentsToArray(arguments)),i=YES)),!i&&this.get("fallBackOnAlert")&&(this.get("exists")&&typeof e.alert=="function"?(e.alert(arguments),i=YES):(alert(arguments),i=YES)),i},group:function(e){var t=this.get("reporter");this.get("exists")&&typeof t.group=="function"&&t.group(e)},groupEnd:function(){var e=this.get("reporter");this.get("exists")&&typeof e.groupEnd=="function"&&e.groupEnd()},dir:function(){var e=this.get("reporter");this.get("exists")&&typeof e.dir=="function"?e.dir.apply(e,arguments):this.log.apply(this,arguments)},dirxml:function(){var e=this.get("reporter");this.get("exists")&&typeof e.dirxml=="function"?e.dirxml.apply(e,arguments):this.log.apply(this,arguments)},profile:function(e){var t=this.get("reporter");return this.get("exists")&&typeof t.profile=="function"?(t.profile(e),YES):NO},profileEnd:function(e){var t=this.get("reporter");return this.get("exists")&&typeof t.profileEnd=="function"?(t.profileEnd(e),YES):NO},time:function(e){var t=this.get("reporter"
);return this.get("exists")&&typeof t.time=="function"?(t.time(e),YES):NO},timeEnd:function(e){var t=this.get("reporter");return this.get("exists")&&typeof t.timeEnd=="function"?(t.timeEnd(e),YES):NO},trace:function(){var e=this.get("reporter");return this.get("exists")&&typeof e.trace=="function"?(e.trace(),YES):NO},init:function(){arguments.callee.base.apply(this,arguments),this.get("logOutputLevel")||(SC.buildMode==="debug"?this.set("logOutputLevel",SC.LOGGER_LEVEL_DEBUG):this.set("logOutputLevel",SC.LOGGER_LEVEL_INFO)),this.debugEnabledDidChange()},debugEnabledDidChange:function(){this.get("debugEnabled")&&this.set("logOutputLevel",SC.LOGGER_LEVEL_DEBUG)}.observes("debugEnabled"),_handleMessage:function(e,t,n,r){var i=this._shouldOutputType(e),s=this._shouldRecordType(e),o,u,a,f,l,c,h,p,d;if(!i&&!s)return;o=r&&r.length>1,t&&(SC.none(n)||typeof n!="string")&&(t=NO);if(t&&o){f=[];for(u=1,a=r.length;u<a;++u)f.push(r[u]);n=n.fmt.apply(n,f)}h=this.get("messagePrefix"),h&&(n=h+n),i&&(p=this.get("outputMessagePrefix"),f=t?null:r,this._outputMessage(e,null,this._outputIndentationLevel,p?p+n:n,f)),s&&(d=this.get("recordedMessagePrefix"),c={type:e,message:n?d?d+n:n:YES,timestamp:new Date},!t&&o&&(c.originalArguments=r),this._addRecordedMessageEntry(c))},_handleGroup:function(e,t,n){var r=this._shouldOutputType(e),i=this._shouldRecordType(e),s,o,u,a,f,l,c,h,p,d,v;if(!r&&!i)return;s=n&&n.length>1;if(t&&s){a=[];for(o=1,u=n.length;o<u;++o)a.push(n[o]);t=t.fmt.apply(t,a)}r&&(this._outputGroup(e,null,this._outputIndentationLevel,t),this._outputIndentationLevel++),i&&(d=++this._recordingIndentationLevel
,v={type:e,indentation:d,beginGroup:YES,title:t,timestamp:new Date},this._addRecordedMessageEntry(v))},_handleGroupEnd:function(e){var t=this._shouldOutputType(e),n=this._shouldRecordType(e),r,i,s,o;if(!t&&!n)return;t&&(this._outputIndentationLevel--,this.get("exists")&&(r=this.get("reporter"),i=r.groupEnd,i&&i.call(r))),n&&(s=--this._recordingIndentationLevel,o={type:e,indentation:s,timestamp:new Date},this._addRecordedMessageEntry(o))},_shouldOutputType:function(e){var t=this._LOG_LEVEL_MAPPING,n=t[e]||0,r=t[this.get("logOutputLevel")]||0;return n<=r},_shouldRecordType:function(e){var t=this._LOG_LEVEL_MAPPING,n=t[e]||0,r=t[this.get("logRecordingLevel")]||0;return n<=r},_outputMessage:function(e,t,n,r,i){if(!this.get("exists"))return;var s=this.get("reporter"),o,u,a,f,l,c;u=!s.group,a=s[e],a?i?(l=this._argumentsToArray(i),f="",t&&(f=t),u&&(f+=this._indentation(n)),f&&l.splice(0,0,f),a.apply?a.apply(s,l):s[e](l)):(o=t?t:"",u&&(o+=this._indentation(n)),o+=r,s[e](o)):s.log&&(f="",t&&(f=t),f+=this._LOG_FALLBACK_PREFIX_MAPPING[e]||"",u&&(f+=this._indentation(n)),i?(l=this._argumentsToArray(i),f&&l.splice(0,0,f),s.log(l)):s.log(f+r))},_outputGroup:function(e,t,n,r){if(!this.get("exists"))return;var i=this.get("reporter"),s=i.group,o;s?(o=t?t:"",o+=r,s.call(i,o)):i.log&&(o="",t&&(o=t),o+=this._LOG_FALLBACK_PREFIX_MAPPING[e]||"",o+=this._indentation(n),o+=SC.LOGGER_LOG_GROUP_HEADER.fmt(r),i.log(o))},_addRecordedMessageEntry:function(e){var t=this.get("recordedLogMessages"),n;t||(t=[],this.set("recordedLogMessages",t)),t.push(e),n=t.length,n>this.get("recordedLogMessagesMaximumLength"
)&&t.splice(0,n-this.get("recordedLogMessagesPruningMinimumLength")),t.enumerableContentDidChange()},_argumentsToArray:function(e){var t=[],n,r;if(e)for(n=0,r=e.length;n<r;++n)t[n]=e[n];return t},_argumentsToString:function(){var e="",t=SC.LOGGER_LOG_DELIMITER,n,r;for(n=0,r=arguments.length-1;n<r;++n)e+=arguments[n]+t;return e+=arguments[r],e},_indentation:function(e){if(!e||e<0)e=0;var t="",n=SC.LOGGER_LOG_GROUP_INDENTATION,r;for(r=0;r<e;++r)t+=n;return t},_outputIndentationLevel:0,_recordingIndentationLevel:0,_LOG_LEVEL_MAPPING:{debug:4,info:3,warn:2,error:1,none:0},_LOG_FALLBACK_PREFIX_MAPPING:{debug:SC.LOGGER_LOG_DEBUG,info:SC.LOGGER_LOG_INFO,warn:SC.LOGGER_LOG_WARN,error:SC.LOGGER_LOG_ERROR}}),SC.debug=SC.Logger.debug,SC.info=SC.Logger.info,SC.warn=SC.Logger.warn,SC.error=SC.Logger.error,SC.RunLoop=SC.Object.extend({beginRunLoop:function(){return this._start=(new Date).getTime(),this._runLoopInProgress=YES,this},isRunLoopInProgress:function(){return this._runLoopInProgress}.property(),endRunLoop:function(){return this.flushAllPending(),this._start=null,SC.RunLoop.lastRunLoopEnd=Date.now(),this._runLoopInProgress=NO,this},flushAllPending:function(){var e=!0;while(e)e=this.flushApplicationQueues(),e||(e=this._flushinvokeLastQueue())},invokeOnce:function(e,t){t===undefined&&(t=e,e=this);var n;return typeof t=="string"&&(t=e[t]),this._invokeQueue||(this._invokeQueue=SC.ObserverSet.create()),t&&this._invokeQueue.add(e,t,undefined,n),this},invokeLast:function(e,t){t===undefined&&(t=e,e=this);var n;return typeof t=="string"&&(t=e[t]),this._invokeLastQueue||(this._invokeLastQueue=
SC.ObserverSet.create()),this._invokeLastQueue.add(e,t,undefined,n),this},flushApplicationQueues:function(){var e=NO,t=this._invokeQueue;return t&&t.getMembers().length&&(this._invokeQueue=null,e=YES,t.invokeMethods()),SC.Binding.flushPendingChanges()||e},_flushinvokeLastQueue:function(){var e=this._invokeLastQueue,t=NO;return e&&e.getMembers().length&&(this._invokeLastQueue=null,t=YES,t&&e.invokeMethods()),t}}),SC.RunLoop.currentRunLoop=null,SC.RunLoop.runLoopClass=SC.RunLoop,SC.RunLoop.begin=function(){var e=this.currentRunLoop;return e||(e=this.currentRunLoop=this.runLoopClass.create()),e.beginRunLoop(),this},SC.RunLoop.end=function(){var e=this.currentRunLoop;if(!e)throw"SC.RunLoop.end() called outside of a runloop!";return e.endRunLoop(),this},SC.RunLoop.kill=function(){return this.currentRunLoop=this.runLoopClass.create(),this},SC.RunLoop.isRunLoopInProgress=function(){return this.currentRunLoop?this.currentRunLoop.get("isRunLoopInProgress"):NO},SC.run=function(e,t,n){var r=SC.RunLoop.isRunLoopInProgress(),i;if(SC.ExceptionHandler&&SC.ExceptionHandler.enabled)try{(n||!r)&&SC.RunLoop.begin(),e&&(i=e.call(t)),(n||!r)&&SC.RunLoop.end()}catch(s){var o=SC.ExceptionHandler.handleException(s);if(!o&&!SC.browser.msie)throw s}else(n||!r)&&SC.RunLoop.begin(),e&&(i=e.call(t)),(n||!r)&&SC.RunLoop.end();return i},SC.RunLoop.wrapFunction=function(e){var t=function(){var t=SC.$A(arguments),n=this;return SC.run(function(){return e.apply(n,t)})};return t.wrapped=e,t},SC.DROP_ON=1,SC.DROP_BEFORE=2,SC.DROP_AFTER=4,SC.DROP_ANY=7,SC.ALIGN_LEFT="left",SC.ALIGN_RIGHT="right",SC.ALIGN_CENTER="center"
,SC.ALIGN_TOP="top",SC.ALIGN_MIDDLE="middle",SC.ALIGN_BOTTOM="bottom",SC.ALIGN_TOP_LEFT="top-left",SC.ALIGN_TOP_RIGHT="top-right",SC.ALIGN_BOTTOM_LEFT="bottom-left",SC.ALIGN_BOTTOM_RIGHT="bottom-right",SC.mixin({data:$.data,removeData:$.removeData,STRINGS:{},stringsFor:function(e,t){return SC.mixin(SC.STRINGS,t),this}}),SC.Controller=SC.Object.extend({isEditable:YES,destroyContentOnReplace:NO,contentObjectDidChanged:function(){var e,t;if(!this.get("destroyContentOnReplace"))return;e=this._oldContent,t=this.get("content"),e&&t!==e&&e.destroy&&e.destroy(),this._oldContent=t}.observes("content")}),SC.SelectionSupport={hasSelectionSupport:YES,allowsSelection:YES,allowsMultipleSelection:YES,allowsEmptySelection:YES,firstSelectableObject:function(){return this.get("firstObject")}.property(),selection:function(e,t){var n=this._scsel_selection,r=n?n.get("length"):0,i,s=this.get("arrangedObjects"),o;if(t===undefined||!this.get("allowsSelection"))t=n;return o=t&&t.isEnumerable?t.get("length"):0,o>1&&!this.get("allowsMultipleSelection")&&(r>1?(t=SC.SelectionSet.create().addObject(n.get("firstObject")).freeze(),o=1):(t=n,o=r)),o===0&&!this.get("allowsEmptySelection")&&s&&s.get("length")!==0&&(r===0?(t=this.get("firstSelectableObject"),t?t=SC.SelectionSet.create().addObject(t).freeze():t=SC.SelectionSet.EMPTY,o=t.get("length")):(t=n,o=r)),o===0&&(t=SC.SelectionSet.EMPTY),t!==n&&(t=t.frozenCopy()),this._scsel_selection=t,t}.property("arrangedObjects","allowsEmptySelection","allowsMultipleSelection","allowsSelection").cacheable(),hasSelection:function(){var e=this.get("selection");return!!
e&&e.get("length")>0}.property("selection").cacheable(),selectObjects:function(e,t){if(!e||e.get("length")===0)return t||this.set("selection",SC.SelectionSet.EMPTY),this;var n=this.get("selection");return t&&n?n=n.copy():n=SC.SelectionSet.create(),n.addObjects(e).freeze(),this.set("selection",n),this},selectObject:function(e,t){return e===null?(t||this.set("selection",null),this):this.selectObjects([e],t)},deselectObjects:function(e){if(!e||e.get("length")===0)return this;var t=this.get("selection");return!t||t.get("length")===0?this:(t=t.copy().removeObjects(e).freeze(),this.set("selection",t.freeze()),this)},deselectObject:function(e){return e?this.deselectObjects([e]):this},updateSelectionAfterContentChange:function(){var e=this.get("arrangedObjects"),t=this.get("selection"),n=this.get("allowsEmptySelection"),r;if(!t)return this;r=t.indexSetForSource(e);if(r&&r.get("length")!==t.get("length")||!r&&t.get("length")>0)t=t.copy().constrain(e).freeze(),this.set("selection",t);return t.get("length")===0&&e&&e.get("length")>0&&!n&&this.selectObject(this.get("firstSelectableObject"),NO),this}},SC.ArrayController=SC.Controller.extend(SC.Array,SC.SelectionSupport,{content:null,isEditable:YES,orderBy:null,allowsSingleContent:YES,destroyOnRemoval:NO,arrangedObjects:function(){return this}.property().cacheable(),canRemoveContent:function(){var e=this.get("content"),t;return t=!!e&&this.get("isEditable")&&this.get("hasContent"),t?!e.isEnumerable||SC.typeOf(e.removeObject)===SC.T_FUNCTION:NO}.property("content","isEditable","hasContent"),canReorderContent:function(){var e=this.get("content"
),t;return t=!!e&&this.get("isEditable")&&!this.get("orderBy"),t&&!!e.isSCArray}.property("content","isEditable","orderBy"),canAddContent:function(){var e=this.get("content"),t;return t=e&&this.get("isEditable")&&e.isEnumerable,t?SC.typeOf(e.addObject)===SC.T_FUNCTION||SC.typeOf(e.pushObject)===SC.T_FUNCTION:NO}.property("content","isEditable"),hasContent:function(){var e=this.get("content");return!!e&&(!!e.isEnumerable||!!this.get("allowsSingleContent"))}.property("content","allowSingleContent"),status:function(){var e=this.get("content"),t=e?e.get("status"):null;return t?t:SC.Record.READY}.property().cacheable(),addObject:function(e){if(!this.get("canAddContent"))throw"%@ cannot add content".fmt(this);var t=this.get("content");if(t.isSCArray)t.pushObject(e);else{if(!t.addObject)throw"%@.content does not support addObject".fmt(this);t.addObject(e)}return this},removeObject:function(e){if(!this.get("canRemoveContent"))throw"%@ cannot remove content".fmt(this);var t=this.get("content");return t.isEnumerable?t.removeObject(e):this.set("content",null),this.get("destroyOnRemoval")&&e.destroy&&e.destroy(),this},length:function(){var e=this._scac_observableContent();return e?e.get("length"):0}.property().cacheable(),objectAt:function(e){var t=this._scac_observableContent();return t?t.objectAt(e):undefined},replace:function(e,t,n){if(!n||n.get("length")===0){if(!this.get("canRemoveContent"))throw"%@ cannot remove objects from the current content".fmt(this)}else if(!this.get("canReorderContent"))throw"%@ cannot add or reorder the current content".fmt(this);var r=this.get("content"),
i=[],s,o;if(this.get("destroyOnRemoval"))for(s=0;s<t;s++)i.push(r.objectAt(s+e));r&&r.replace(e,t,n);for(s=0,o=i.length;s<o;s++)i[s].destroy();return i=null,this},indexOf:function(e,t){var n=this._scac_observableContent();return n?n.indexOf(e,t):-1},init:function(){arguments.callee.base.apply(this,arguments),this._scac_contentDidChange()},_scac_cached:NO,_scac_observableContent:function(){var e=this._scac_cached;if(e)return e;var t=this.get("content"),n,r,i;if(SC.none(t))return this._scac_cached=[];if(!t.isEnumerable)return e=this.get("allowsSingleContent")?[t]:[],this._scac_cached=e;var s=this.get("orderBy");if(!s){if(t.isSCArray)return this._scac_cached=t;throw"%@.orderBy is required for unordered content".fmt(this)}var o=SC.typeOf(s);if(o===SC.T_STRING)s=[s];else if(o===SC.T_FUNCTION)n=s;else if(o!==SC.T_ARRAY)throw"%@.orderBy must be Array, String, or Function".fmt(this);return n=n||function(e,t){var n,r,o,u;for(var a=0,f=s.get("length");a<f&&!n;a++)r=s.objectAt(a),o=r.match(/^(ASC )?(DESC )?(.*)$/),r=o[3],i=o[2]?-1:1,e&&(e=e.isObservable?e.get(r):e[r]),t&&(t=t.isObservable?t.get(r):t[r]),n=SC.compare(e,t)*i;return n},this._scac_cached=t.toArray().sort(n)},propertyWillChange:function(e){if(e!=="content")return arguments.callee.base.apply(this,arguments);this.arrayContentWillChange(0,this.get("length"),0)},_scac_arrayContentWillChange:function(e,t,n){this.arrayContentWillChange(e,t,n);if(this._kvo_enumerable_property_chains){var r=this.slice(e,e+t);this.teardownEnumerablePropertyChains(r)}},_scac_arrayContentDidChange:function(e,t,n){var r=this._scac_observableContent(),i=
r?r.get("length"):0;this._scac_length=i,this._scac_cached=NO,this.notifyPropertyChange("length");if(this._kvo_enumerable_property_chains){var s=this.slice(e,e+n);this.setupEnumerablePropertyChains(s)}this.updateSelectionAfterContentChange(),this.arrayContentDidChange(e,t,n)},_scac_contentDidChange:function(){this._scac_cached=NO;var e=this.get("content"),t=!!this.get("orderBy"),n=this._scac_content,r=this._scac_length||0,i=this._scac_arrayContentDidChange,s=this._scac_arrayContentWillChange,o=this._scac_contentStatusDidChange,u=this._scac_enumerableDidChange,a;if(e===n)return this;this.arrayContentWillChange(0,r,a),n&&(n.isSCArray?n.removeArrayObservers({target:this,didChange:i,willChange:s}):n.isEnumerable&&n.removeObserver("[]",this,u),n.removeObserver("status",this,o),this.teardownEnumerablePropertyChains(n)),this._scac_cached=NO,this._scac_content=e,e?(e.isSCArray?(e.addArrayObservers({target:this,didChange:i,willChange:s}),a=e.get("length")):e.isEnumerable?(e.addObserver("[]",this,u),a=e.get("length")):a=1,e.addObserver("status",this,o),this.setupEnumerablePropertyChains(e)):a=SC.none(e)?0:1,this._scac_length=a,this._scac_contentStatusDidChange(),this.arrayContentDidChange(0,r,a),this.updateSelectionAfterContentChange()}.observes("content"),_scac_enumerableDidChange:function(){var e=this.get("content"),t=e?e.get("length"):0,n=this._scac_length;this._scac_length=t,this.beginPropertyChanges(),this._scac_cached=NO,this.arrayContentDidChange(0,n,t),this.endPropertyChanges(),this.updateSelectionAfterContentChange()}.observes("orderBy"),_scac_contentStatusDidChange:function()
{this.notifyPropertyChange("status")}}),SC.ObjectController=SC.Controller.extend({content:null,allowsMultipleContent:NO,hasContent:function(){return!SC.none(this.get("observableContent"))}.property("observableContent"),isEditable:YES,observableContent:function(){var e=this.get("content"),t,n;if(e&&e.isEnumerable){t=e.get("length"),n=this.get("allowsMultipleContent");if(t===1)e=e.firstObject();else if(t===0||!n)e=null;e&&!n&&e.isEnumerable&&(e=null)}return e}.property("content","allowsMultipleContent").cacheable(),destroy:function(){var e=this.get("observableContent");return e&&SC.typeOf(e.destroy)===SC.T_FUNCTION&&e.destroy(),this.set("content",null),this},contentPropertyDidChange:function(e,t){t==="*"?this.allPropertiesDidChange():this.notifyPropertyChange(t)},unknownProperty:function(e,t){if(e==="content")return t!==undefined&&(this.content=t),this.content;var n=this.get("observableContent"),r,i,s;if(n===null||n===undefined)return undefined;if(t===undefined)if(n.isEnumerable){t=n.getEach(e),r=t.get("length");if(r>0){s=YES,i=t.objectAt(0);while(--r>0&&s)i!==t.objectAt(r)&&(s=NO);s&&(t=i)}else t=undefined}else t=n.isObservable?n.get(e):n[e];else{if(!this.get("isEditable"))throw"%@.%@ is not editable".fmt(this,e);n.isEnumerable?n.setEach(e,t):n.isObservable?n.set(e,t):n[e]=t}return t},init:function(){arguments.callee.base.apply(this,arguments),this.get("content")&&this._scoc_contentDidChange(),this.get("observableContent")&&this._scoc_observableContentDidChange()},_scoc_contentDidChange:function(){var e=this._scoc_content,t=this.get("content");if(e!==t){this._scoc_content=t;var n=
this._scoc_enumerableContentDidChange;e&&e.isEnumerable&&e.removeObserver("[]",this,n),t&&t.isEnumerable&&t.addObserver("[]",this,n)}}.observes("content"),_scoc_observableContentDidChange:function(){var e=this._scoc_observableContent,t=this.get("observableContent"),n=this.contentPropertyDidChange,r=this._scoc_enumerableContentDidChange;if(e===t)return this;this._scoc_observableContent=t,e&&(e.isEnumerable?e.removeObserver("[]",this,r):e.isObservable&&e.removeObserver("*",this,n)),t&&(t.isEnumerable?t.addObserver("[]",this,r):t.isObservable&&t.addObserver("*",this,n)),e&&e.isEnumerable||t&&t.isEnumerable?this._scoc_enumerableContentDidChange():this.contentPropertyDidChange(t,"*")}.observes("observableContent"),_scoc_enumerableContentDidChange:function(){var e=this.get("observableContent"),t=this._scoc_observableContentItems,n=this.contentPropertyDidChange;return t&&(t.forEach(function(e){e.isObservable&&e.removeObserver("*",this,n)},this),t.clear()),e&&e.isEnumerable?(t||(t=SC.Set.create()),e.forEach(function(e){if(t.contains(e))return;t.add(e),e.isObservable&&e.addObserver("*",this,n)},this)):t=null,this._scoc_observableContentItems=t,this.contentPropertyDidChange(e,"*"),this}}),SC.mixin(Function.prototype,{invokeLater:function(e,t){t===undefined&&(t=1);var n=this;if(arguments.length>2){var r=SC.$A(arguments).slice(2,arguments.length);r.unshift(e);var i=n;n=function(){return i.apply(this,r.slice(1))}}return SC.Timer.schedule({target:e,action:n,interval:t})}}),SC.mixin(SC.Object.prototype,{invokeLater:function(e,t){t===undefined&&(t=1);var n=e,r,i;return arguments.length>2&&(
r=SC.$A(arguments).slice(2),SC.typeOf(n)===SC.T_STRING&&(n=this[e]),i=n,n=function(){return i.apply(this,r)}),SC.Timer.schedule({target:this,action:n,interval:t})},invokeOnceLater:function(e,t){t===undefined&&(t=1);var n=this._sc_invokeOnceLaterTimers,r,i,s,o;return SC.typeOf(e)===SC.T_STRING&&(e=this[e]),r=SC.guidFor(e),n||(this._sc_invokeOnceLaterTimers=n={}),i=n[r],i&&i.invalidate(),s=function(){return delete n[r],e.apply(this,arguments)},o=SC.Timer.schedule({target:this,action:s,interval:t}),n[r]=o,o},invokeWith:function(e,t,n){n===undefined&&(n=t,t=this),t||(t=this),SC.typeOf(n)===SC.T_STRING&&(n=t[n]);var r=this.getPath(e);return n.call(t,r,this),this}}),SC.RunLoop=SC.RunLoop.extend({startTime:function(){return this._start||(this._start=Date.now()),this._start}.property(),endRunLoop:function(){this.fireExpiredTimers();var e=arguments.callee.base.apply(this,arguments);return this.scheduleNextTimeout(),e},scheduleTimer:function(e,t){return this._timerQueue=e.removeFromTimerQueue(this._timerQueue),this._timerQueue=e.scheduleInTimerQueue(this._timerQueue,t),this},cancelTimer:function(e){return this._timerQueue=e.removeFromTimerQueue(this._timerQueue),this},TIMER_ARRAY:[],fireExpiredTimers:function(){if(!this._timerQueue||this._firing)return NO;var e=this.get("startTime"),t=this.TIMER_ARRAY,n,r,i;this._firing=YES;try{this._timerQueue=this._timerQueue.collectExpiredTimers(t,e),r=t.length;for(n=0;n<r;n++)t[n].fire();i=t.length>0,t.length=0}catch(s){throw t.splice(0,n+1),s}finally{this._firing=NO}return i},scheduleNextTimeout:function(){var e=this._timerQueue,t=NO;if(!e)this._timeout&&
clearTimeout(this._timeout);else{var n=e._timerQueueRunTime;if(this._timeoutAt!==n){this._timeout&&clearTimeout(this._timeout);var r=Math.max(0,n-Date.now());this._timeout=setTimeout(this._timeoutDidFire,r),this._timeoutAt=n}t=YES}return t},_timeoutDidFire:function(){var e=SC.RunLoop.currentRunLoop;e._timeout=e._timeoutAt=null,SC.run()}}),SC.RunLoop.currentRunLoop=SC.RunLoop.create(),SC.RunLoop.runLoopClass=SC.RunLoop,SC.Locale=SC.Object.extend(SC.Observable,{init:function(){this.language||SC.Locale._assignLocales();if(!this.hasStrings){var e=this._deprecatedLanguageCodes||[];e.push(this.language);var t=e.length,n=null;while(!n&&--t>=0)n=String[e[t]];n&&(this.hasStrings=YES,this.strings=n)}},hasStrings:NO,strings:{},metrics:{},language:null,isRTL:function(){return!!this.get("language").match(/^(ar|iw)-.*/)}.property("language").cacheable(),toString:function(){return this.language||SC.Locale._assignLocales(),"SC.Locale["+this.language+"]"+SC.guidFor(this)},locWithDefault:function(e,t){var n=this.strings[e];return SC.typeOf(n)===SC.T_STRING?n:SC.typeOf(t)===SC.T_STRING?t:e},locMetric:function(e){var t=this.metrics[e];return SC.typeOf(t)===SC.T_NUMBER?t:t===undefined?(SC.warn('No localized metric found for key "'+e+'"'),undefined):(SC.warn('Unexpected metric type for key "'+e+'"'),undefined)},locLayout:function(e,t){var n,r,i,s,o,u=SC.Locale.layoutKeys,a=this.metrics,f=SC.typeOf,l=SC.T_NUMBER,c={};t&&SC.mixin(c,t);for(n=0,r=u.length;n<r;++n){i=u[n],s=e+"."+i,o=a[s];if(f(o)===l){if(t&&t[i])throw"locLayout():  There is a localized value for the key '"+s+"' but a value for '"+i+"' was also specified in the non-localized hash"
;c[i]=o}}return c}}),SC.Locale.mixin(SC.Observable,{useAutodetectedLanguage:NO,preferredLanguage:null,layoutKeys:["left","top","right","bottom","width","height","minWidth","minHeight","centerX","centerY"],createCurrentLocale:function(){var e=String.useAutodetectedLanguage!==undefined?String.useAutodetectedLanguage:this.useAutodetectedLanguage,t=String.preferredLanguage!==undefined?String.preferredLanguage:this.preferredLanguage,n=(e?SC.browser.language:null)||t||SC.browser.language||"en";n=SC.Locale.normalizeLanguage(n);var r=this.localeClassFor(n);return n!=this.currentLanguage&&(this.currentLanguage=n,this.set("currentLocale",r.create({language:n}))),this.currentLocale},localeClassFor:function(e){e=SC.Locale.normalizeLanguage(e);var t,n=this.locales[e];return!n&&(t=e.split("-")[0])!==e&&(n=this.locales[t])&&(n=this.locales[e]=n.extend()),n||(n=this.locales[e]=this.locales.en.extend()),n},define:function(e,t){var n;return t===undefined&&SC.typeOf(e)!==SC.T_STRING?(n=this,t=e):n=SC.Locale.localeClassFor(e),SC.mixin(n.prototype,t),n},options:function(){return this.prototype},addStrings:function(e){var t=this.prototype.strings;return t?this.prototype.hasOwnProperty("strings")||(this.prototype.strings=SC.clone(t)):t=this.prototype.strings={},e&&(this.prototype.strings=SC.mixin(t,e)),this.prototype.hasStrings=YES,this},addMetrics:function(e){var t=this.prototype.metrics;return t?this.prototype.hasOwnProperty(t)||(this.prototype.metrics=SC.clone(t)):t=this.prototype.metrics={},e&&(this.prototype.metrics=SC.mixin(t,e)),this},_map:{english:"en",french:"fr",german:"de",japanese:"ja"
,jp:"ja",spanish:"es"},normalizeLanguage:function(e){return e?SC.Locale._map[e.toLowerCase()]||e:"en"},_assignLocales:function(){for(var e in this.locales)this.locales[e].prototype.language=e},toString:function(){return this.prototype.language||SC.Locale._assignLocales(),"SC.Locale["+this.prototype.language+"]"},extend:function(){var e=SC.Object.extend.apply(this,arguments);return e.addStrings=SC.Locale.addStrings,e.define=SC.Locale.define,e.options=SC.Locale.options,e.toString=SC.Locale.toString,e}}),SC.Locale.locales={en:SC.Locale.extend({_deprecatedLanguageCodes:["English"]}),fr:SC.Locale.extend({_deprecatedLanguageCodes:["French"]}),de:SC.Locale.extend({_deprecatedLanguageCodes:["German"]}),ja:SC.Locale.extend({_deprecatedLanguageCodes:["Japanese","jp"]}),es:SC.Locale.extend({_deprecatedLanguageCodes:["Spanish"]})},SC.stringsFor=function(e,t){var n=SC.Locale.localeClassFor(e);return n.addStrings(t),this},SC.metricsFor=function(e,t){var n=SC.Locale.localeClassFor(e);return n.addMetrics(t),this},SC.STRING_TITLEIZE_REGEXP=/([\s|\-|\_|\n])([^\s|\-|\_|\n]?)/g,SC.STRING_DECAMELIZE_REGEXP=/([a-z])([A-Z])/g,SC.STRING_DASHERIZE_REGEXP=/[ _]/g,SC.STRING_DASHERIZE_CACHE={},SC.STRING_TRIM_LEFT_REGEXP=/^\s+/g,SC.STRING_TRIM_RIGHT_REGEXP=/\s+$/g,SC.mixin(SC.String,{capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},camelize:function(e){var t=e.replace(SC.STRING_TITLEIZE_REGEXP,function(e,t,n){return n?n.toUpperCase():""}),n=t.charAt(0),r=n.toLowerCase();return n!==r?r+t.slice(1):t},decamelize:function(e){return e.replace(SC.STRING_DECAMELIZE_REGEXP,"$1_$2").toLowerCase
()},dasherize:function(e){var t=SC.STRING_DASHERIZE_CACHE,n=t[e];return n?n:(n=SC.String.decamelize(e).replace(SC.STRING_DASHERIZE_REGEXP,"-"),t[e]=n,n)},loc:function(e){SC.Locale.currentLocale||SC.Locale.createCurrentLocale();var t=SC.Locale.currentLocale.locWithDefault(e);SC.typeOf(t)!==SC.T_STRING&&(t=e);var n=SC.$A(arguments);n.shift(),n.length>0&&n[0].isSCArray&&(n=n[0]);try{return SC.String.fmt(t,n)}catch(r){SC.error("Error processing string with key: "+e),SC.error("Localized String: "+t),SC.error("Error: "+r)}},locMetric:function(e){var t=SC.Locale,n=t.currentLocale;return n||(t.createCurrentLocale(),n=t.currentLocale),n.locMetric(e)},locLayout:function(e,t){var n=SC.Locale,r=n.currentLocale;return r||(n.createCurrentLocale(),r=n.currentLocale),r.locLayout(e,t)},locWithDefault:function(e,t){SC.Locale.currentLocale||SC.Locale.createCurrentLocale();var n=SC.Locale.currentLocale.locWithDefault(e,t);SC.typeOf(n)!==SC.T_STRING&&(n=e);var r=SC.$A(arguments);return r.shift(),r.shift(),SC.String.fmt(n,r)},trim:jQuery.trim,trimLeft:function(e){return e.replace(SC.STRING_TRIM_LEFT_REGEXP,"")},trimRight:function(e){return e.replace(SC.STRING_TRIM_RIGHT_REGEXP,"")},mult:function(e,t){if(SC.typeOf(t)!==SC.T_NUMBER||t<1)return null;var n="";for(var r=0;r<t;r+=1)n+=e;return n}}),String.prototype.trim&&SC.supplement(String.prototype,{trim:function(){return SC.String.trim(this,arguments)},trimLeft:function(){return SC.String.trimLeft(this,arguments)},trimRight:function(){return SC.String.trimRight(this,arguments)}}),SC.mixin(String.prototype,{loc:function(){return SC.String.loc(this.toString
(),SC.$A(arguments))},locMetric:function(){return SC.String.locMetric(this.toString())},locLayout:function(e){return SC.String.locLayout(this.toString(),e)}}),SC.supplement(String.prototype,{capitalize:function(){return SC.String.capitalize(this,arguments)},camelize:function(){return SC.String.camelize(this,arguments)},decamelize:function(){return SC.String.decamelize(this,arguments)},dasherize:function(){return SC.String.dasherize(this,arguments)},loc:function(){var e=SC.$A(arguments);return e.unshift(this),SC.String.loc.apply(SC.String,e)},locWithDefault:function(e){var t=SC.$A(arguments);return t.unshift(this),SC.String.locWithDefault.apply(SC.String,t)},mult:function(e){return SC.String.mult(this,e)}}),SC.ActionSupport={target:null,action:null,actionContext:null,fireAction:function(e){var t=this.get("target")||null,n=this.getPath("pane.rootResponder");return e===undefined&&(e=this.get("action")),e&&n?n.sendAction(e,t,this,this.get("pane"),this.get("actionContext"),this):!1}},SC.DelegateSupport={delegateFor:function(e){var t=1,n=arguments.length,r;while(t<n){r=arguments[t];if(r&&r[e]!==undefined)return r;t++}return this[e]!==undefined?this:null},invokeDelegateMethod:function(e,t,n){n=SC.A(arguments),n=n.slice(2,n.length);if(!e||!e[t])e=this;var r=e[t];return r?r.apply(e,n):null},getDelegateProperty:function(e,t){var n=1,r=arguments.length,i;while(n<r){i=arguments[n++];if(i&&i[e]!=undefined)return i.get?i.get(e):i[e]}return this[e]!=undefined?this.get(e):undefined}},SC.Responder=SC.Object.extend({isResponder:YES,pane:null,responderContext:null,nextResponder:null,isFirstResponder
:NO,hasFirstResponder:NO,acceptsFirstResponder:YES,becomingFirstResponder:NO,becomeFirstResponder:function(){var e=this.get("pane")||this.get("responderContext")||this.pane();return e&&this.get("acceptsFirstResponder")&&e.get("firstResponder")!==this&&e.makeFirstResponder(this),this},resignFirstResponder:function(e){var t=this.get("pane")||this.get("responderContext");return t&&t.get("firstResponder")===this&&(this.get("isPane")||t.set("lastViewFirstResponder",this),t.makeFirstResponder(null,e)),YES},willLoseFirstResponder:function(e){},didBecomeFirstResponder:function(e){},sendAction:function(e,t){return SC.RootResponder.responder.sendAction(e,null,this,null,t,this)}}),SC.ResponderContext={isResponderContext:YES,trace:NO,defaultResponder:null,nextResponder:function(){return this.get("defaultResponder")}.property("defaultResponder").cacheable(),firstResponder:null,nextResponderFor:function(e){var t=e.get("nextResponder");return typeof t===SC.T_STRING?t=SC.objectForPropertyPath(t,this):!t&&e!==this&&(t=this),t},responderNameFor:function(e){if(!e)return"(No Responder)";if(e._scrc_name)return e._scrc_name;var t=this.NAMESPACE;return this._findResponderNamesFor(this,3,t?[this.NAMESPACE]:[]),e._scrc_name||e.toString()},_findResponderNamesFor:function(e,t,n){var r,i;for(r in e){if(r==="nextResponder")continue;i=e[r];if(i&&i.isResponder){if(i._scrc_name)continue;n.push(r),i._scrc_name=n.join("."),t>0&&this._findResponderNamesFor(i,t-1,n),n.pop()}}},makeFirstResponder:function(e,t){var n=this.get("firstResponder"),r=this.get("nextResponder"),i=this.get("trace"),s;if(this._locked){i&&
SC.Logger.log("%@: AFTER ACTION: makeFirstResponder => %@".fmt(this,this.responderNameFor(e))),this._pendingResponder=e;return}i&&SC.Logger.log("%@: makeFirstResponder => %@".fmt(this,this.responderNameFor(e))),e&&e.set("becomingFirstResponder",YES),this._locked=YES,this._pendingResponder=null,s=e?e:null;while(s){if(s.get("hasFirstResponder"))break;s=s===r?null:this.nextResponderFor(s)}return s||(s=r),this._notifyWillLoseFirstResponder(n,n,s,t),n&&n.set("isFirstResponder",NO),this.beginPropertyChanges(),this.set("firstResponder",e),e&&e.set("isFirstResponder",YES),this._notifyDidBecomeFirstResponder(e,e,s),this.endPropertyChanges(),this._locked=NO,this._pendingResponder&&(this.makeFirstResponder(this._pendingResponder),this._pendingResponder=null),e&&e.set("becomingFirstResponder",NO),this},_notifyWillLoseFirstResponder:function(e,t,n,r){if(!t||t===n)return;t.willLoseFirstResponder(e,r),t.set("hasFirstResponder",NO);var i=this.nextResponderFor(t);i&&this._notifyWillLoseFirstResponder(e,i,n)},_notifyDidBecomeFirstResponder:function(e,t,n){if(!t||t===n)return;var r=this.nextResponderFor(t);r&&this._notifyDidBecomeFirstResponder(e,r,n),t.set("hasFirstResponder",YES),t.didBecomeFirstResponder(e)},resetFirstResponder:function(){var e=this.get("firstResponder");if(!e)return;e.willLoseFirstResponder(),e.didBecomeFirstResponder()},sendAction:function(e,t,n){var r=this.get("firstResponder"),i=this.get("nextResponder"),s=this.get("trace"),o=NO,u;this._locked=YES,s&&SC.Logger.log("%@: begin action '%@' (%@, %@)".fmt(this,e,t,n)),!o&&!r&&this.tryToPerform&&(o=this.tryToPerform(e,t,n));while(!
o&&r)r.tryToPerform&&(o=r.tryToPerform(e,t,n)),o||(r=r===i?null:this.nextResponderFor(r));s&&(o?SC.Logger.log("%@: action '%@' handled by %@".fmt(this,e,this.responderNameFor(r))):SC.Logger.log("%@:  action '%@' NOT HANDLED".fmt(this,e))),this._locked=NO;if(u=this._pendingResponder)this._pendingResponder=null,this.makeFirstResponder(u);return r}},SC.RTLSupport={layoutRecipe:null,init:function(e){e();if(!this._isLayoutHashEqualToDefault())throw new Error('The layout value set for "%@" is neither null nor has the default value of {top: 0, left: 0, bottom: 0, right: 0}.'.fmt(this)+"While using this mixin the layout value should not be set. Instead layoutRecipe should be used.");this.layoutDirectionDidChange()}.enhance(),layoutDirectionDidChange:function(){if(!this._isLayoutRecipeValid())throw new Error('The layoutRecipe set for "%@" is not valid. Either it is null or it has "left" and "right" values.'.fmt(this));var e=this.get("layoutRecipe"),t=this._isPreviousLayoutDirectionRTL,n=SC.Locale.currentLocale.get("isRTL");if(t!==n){var r=SC.clone(e),i=r.start,s=r.end,o,u;n?(u=i,o=s):(o=i,u=s),delete r.start,delete r.end,o!==undefined&&(r.left=o),u!==undefined&&(r.right=u),this.set("layout",r)}this._isPreviousLayoutDirectionRTL=n}.observes("SC.Locale.currentLocale"),_isPreviousLayoutDirectionRTL:null,_isLayoutHashEqualToDefault:function(){var e=this.get("layout"),t=!0,n;if(e){var r=SC.View.prototype.layout,i={};for(n in e){if(e[n]!==r[n]){t=!1;break}i[n]=!0}if(t)for(n in r)if(!i[n]){t=!1;break}}return t},_isLayoutRecipeValid:function(){var e=this.get("layoutRecipe"),t=!0;if(e){if(e.left!==
undefined||e.right!==undefined)t=!1}else t=!1;return t}},SC.bodyOverflowArbitrator=SC.Object.create({requestHidden:function(e,t){this._makeRequest(e,-1-9*!!t)},requestVisible:function(e,t){this._makeRequest(e,1+9*!!t)},withdrawRequest:function(e){if(!e)return;var t=SC.guidFor(e);this._requests[t]&&delete this._requests[t],this.setOverflow()},setOverflow:function(){var e=this._decideOverflow();e!==undefined&&(document.body.style.overflow=e?"auto":"hidden")},_makeRequest:function(e,t){if(!e)return;var n=SC.guidFor(e);this._requests[n]=t,this.setOverflow()},_requests:{},_decideOverflow:function(){var e,t,n,r,i=this._requests,s;for(var o in i)(s=i[o])<0&&(e=YES),s<-1&&(n=YES),s>0&&(t=YES),s>1&&(r=YES);return r?YES:t&&n?NO:t?YES:e?NO:undefined}}),SC.mixin(SC.browser,{compareVersion:function(){if(this._versionSplit===undefined){var e=function(e){return Number(e.match(/^[0-9]+/))};this._versionSplit=SC.A(this.version.split(".")).map(e)}var t=SC.A(arguments).map(Number);for(var n=0;n<t.length;n++){var r=this._versionSplit[n]-t[n];if(isNaN(r))return 0;if(r!==0)return r}return 0}}),SC.Builder=function(e){return SC.Builder.create(e)},SC.Builder.create=function(t){var n=SC.mixin(SC.beget(this.fn),t||{});t.hasOwnProperty("toString")&&(n.toString=t.toString);var r=function(){var e=SC.beget(n);return e.defaultClass=this,e.constructor=r,e.init.apply(e,arguments)};return r.fn=r.prototype=n,r.extend=SC.Builder.create,r.mixin=SC.Builder.mixin,r},SC.Builder.mixin=function(){var e=arguments.length,t;for(t=0;t<e;t++)SC.mixin(this,arguments[t]);return this},SC.Builder.fn={init:function(e){if(e!==undefined
)if(SC.typeOf(e)===SC.T_ARRAY){var t=e.length;while(--t>=0)this[t]=e.objectAt?e.objectAt(t):e[t];this.length=e.length}else this[0]=e,this.length=1;return this},size:function(){return this.length},pushStack:function(){var e=this.constructor.apply(this,arguments);return e.prevObject=this,e},end:function(){return this.prevObject||this.constructor()},toString:function(){return"%@$(%@)".fmt(this.defaultClass.toString(),SC.A(this).invoke("toString").join(","))},mixin:SC.Builder.mixin},function(){var e=SC.Enumerable,t=SC.Builder.fn,n,r;for(n in e){if(!e.hasOwnProperty(n))continue;r=Array.prototype[n]||e[n],t[n]=r}}(),SC.$=SC.CoreQuery=jQuery,SC.mixin(SC.$.fn,{isCoreQuery:YES,toString:function(){var e=[],t=this.length,n=0;for(n=0;n<t;n++)e[n]="%@: %@".fmt(n,this[n]?this[n].toString():"(null)");return"<$:%@>(%@)".fmt(SC.guidFor(this),e.join(" , "))},isVisible:function(){return Array.prototype.every.call(this,function(e){return SC.$.isVisible(e)})},view:function(){return this.map(function(){var e=null,t=SC.viewKey,n=this,r;while(!e&&n&&n!==document)n.nodeType===1&&(r=n.getAttribute("id"))&&(e=SC.View.views[r]),n=n.parentNode;return n=null,e})},within:function(e){return this.filter(e).length?!0:!!this.has(e).length}}),function(){var e={},t={find:function(t,n){return n!==undefined?SC.Enumerable.find.call(this,t,n):e.find.call(this,t)},filter:function(t,n){return n!==undefined?this.pushStack(SC.Enumerable.filter.call(this,t,n)):e.filter.call(this,t)},filterProperty:function(e,t){return this.pushStack(SC.Enumerable.filterProperty.call(this,e,t))},indexOf:SC.$.index,map:function(t,n){return n!==
undefined?SC.Enumerable.map.call(this,t,n):e.map.call(this,t)}},n=SC.$.fn,r=SC.Enumerable,i;for(var s in r)r.hasOwnProperty(s)&&(i=r[s],s in t&&(e[s]=n[s],i=t[s]),n[s]=i)}(),SC.mixin(SC.$,{isVisible:function(e){var t=SC.$;return"hidden"!=e.type&&t.css(e,"display")!="none"&&t.css(e,"visibility")!="hidden"}}),SC.Event=function(e){var t,n;if(e){this.originalEvent=e;var r=SC.Event._props,i;n=r.length,t=n;while(--t>=0)i=r[t],this[i]=e[i]}this.timeStamp=this.timeStamp||Date.now(),this.target||(this.target=this.srcElement||document),this.target.nodeType===3&&(this.target=this.target.parentNode),!this.relatedTarget&&this.fromElement&&(this.relatedTarget=this.fromElement===this.target?this.toElement:this.fromElement);if(SC.none(this.pageX)&&!SC.none(this.clientX)){var s=document.documentElement,o=document.body;this.pageX=this.clientX+(s&&s.scrollLeft||o&&o.scrollLeft||0)-(s.clientLeft||0),this.pageY=this.clientY+(s&&s.scrollTop||o&&o.scrollTop||0)-(s.clientTop||0)}!this.which&&(this.charCode||e.charCode===0?this.charCode:this.keyCode)&&(this.which=this.charCode||this.keyCode),!this.metaKey&&this.ctrlKey&&(this.metaKey=this.ctrlKey),!this.which&&this.button&&(this.which=this.button&1?1:this.button&2?3:this.button&4?2:0);if(this.type==="mousewheel"||this.type==="DOMMouseScroll"||this.type==="MozMousePixelScroll"||this.type==="wheel"){var u=SC.Event.MOUSE_WHEEL_MULTIPLIER;(SC.browser.webkit||SC.browser.edge)&&e.wheelDelta!==undefined?(this.wheelDelta=0-(e.wheelDeltaY||e.wheelDeltaX),this.wheelDeltaY=0-(e.wheelDeltaY||0),this.wheelDeltaX=0-(e.wheelDeltaX||0)):!SC.none(e.detail)&&SC.browser
.mozilla?e.axis&&e.axis===e.HORIZONTAL_AXIS?(this.wheelDeltaX=e.detail,this.wheelDeltaY=this.wheelDelta=0):(this.wheelDeltaY=this.wheelDelta=e.detail,this.wheelDeltaX=0):!SC.none(e.deltaX)&&SC.browser.msie?(this.wheelDeltaY=e.deltaY||0,this.wheelDeltaX=e.deltaX||0,this.wheelDelta=this.wheelDeltaY||this.wheelDeltaX):(this.wheelDelta=this.wheelDeltaY=SC.browser.msie||SC.browser.opera?0-e.wheelDelta:e.wheelDelta,this.wheelDeltaX=0),this.wheelDelta*=u,this.wheelDeltaX*=u,this.wheelDeltaY*=u}return this},SC.mixin(SC.Event,{MOUSE_WHEEL_MULTIPLIER:function(){var e=1,t=parseFloat(SC.browser.version);return SC.browser.safari?(e=.4,t>=533.17&&t<534?e=.004:t<533&&(e=40)):SC.browser.msie?e=.3:SC.browser.chrome&&(e=.4),e}(),MOUSE_WHEEL_DELTA_LIMIT:1e3,_MOUSE_WHEEL_LIMIT_INVALIDATED:NO,create:function(e){return new SC.Event(e)},add:function(e,t,n,r,i,s){if(e&&e.isCoreQuery){if(e.length>0)return e.forEach(function(e){this.add(e,t,n,r,i)},this),this;e=e[0]}if(!e)return this;s||(s=NO);if(e.nodeType===3||e.nodeType===8)return SC.Event;SC.typeOf(n)===SC.T_FUNCTION?(i=r,r=n,n=null):n&&SC.typeOf(r)===SC.T_STRING&&(r=n[r]);var o=SC.data(e,"sc_events")||SC.data(e,"sc_events",{}),u=o[t];return u||(u=o[t]={},this._addEventListener(e,t,s)),u[SC.hashFor(n,r)]=[n,r,i],SC.Event._global[t]=YES,e=o=u=null,this},remove:function(e,t,n,r){if(e&&e.isCoreQuery){if(e.length>0)return e.forEach(function(e){this.remove(e,t,n,r)},this),this;e=e[0]}if(!e)return this;if(e.nodeType===3||e.nodeType===8)return SC.Event;var i,s,o=SC.data(e,"sc_events");if(!o)return this;if(t===undefined)for(t in o)this.remove(e,t);else if(
i=o[t]){var u=NO;if(n||r){SC.typeOf(n)===SC.T_FUNCTION?(r=n,n=null):SC.typeOf(r)===SC.T_STRING&&(r=n[r]),delete i[SC.hashFor(n,r)],s=null;for(s in i)break;s===null&&(u=YES)}else u=YES;u&&(delete o[t],this._removeEventListener(e,t)),s=null;for(s in o)break;s||(SC.removeData(e,"sc_events"),delete this._elements[SC.guidFor(e)])}return e=o=i=null,this},NO_BUBBLE:["blur","focus","change"],simulateEvent:function(e,t,n){var r=SC.Event.create({type:t,target:e,preventDefault:function(){this.cancelled=YES},stopPropagation:function(){this.bubbles=NO},allowDefault:function(){this.hasCustomEventHandling=YES},timeStamp:Date.now(),bubbles:this.NO_BUBBLE.indexOf(t)<0,cancelled:NO,normalized:YES});return n&&SC.mixin(r,n),r},trigger:function(e,t,n,r){if(e&&e.isCoreQuery){if(e.length>0)return e.forEach(function(e){this.trigger(e,t,n,r)},this),this;e=e[0]}if(!e)return this;if(e.nodeType===3||e.nodeType===8)return undefined;n=SC.A(n);var i,s=SC.typeOf(e[t]||null)===SC.T_FUNCTION,o,u,a,f;o=n[0];if(!o||!o.preventDefault)o=this.simulateEvent(e,t),n.unshift(o);o.type=t,u=e;do i=SC.Event.handle.apply(u,n),u=u===document?null:u.parentNode||document;while(!i&&o.bubbles&&u);u=null,a=e["on"+t],f=SC.$.nodeName(e,"a")&&t==="click",(!s||f)&&a&&a.apply(e,n)===NO&&(i=NO);if(s&&r!==NO&&i!==NO&&!f){this.triggered=YES;try{e[t]()}catch(l){}}return this.triggered=NO,i},handle:function(e){if(typeof SC=="undefined"||SC.Event.triggered)return YES;var t,n,r,i,s,o,u,a,f,l;o=SC.A(arguments),o[0]=e=SC.Event.normalizeEvent(e||window.event),s=(SC.data(this,"sc_events")||{})[e.type];if(!s)return NO;for(u in s)a=s[u],f=a[1],
e.handler=f,e.data=e.context=a[2],l=a[0]||this,n=f.apply(l,o),t!==NO&&(t=n),n===NO&&(e.preventDefault(),e.stopPropagation());return t},unload:function(){var e,t=this._elements;for(e in t)this.remove(t[e]);for(e in t)delete t[e];delete this._elements},special:{ready:{setup:function(){SC._bindReady();return},teardown:function(){return}},mouseenter:{setup:function(){return SC.browser.msie?NO:(SC.Event.add(this,"mouseover",SC.Event.special.mouseenter.handler),YES)},teardown:function(){return SC.browser.msie?NO:(SC.Event.remove(this,"mouseover",SC.Event.special.mouseenter.handler),YES)},handler:function(e){return SC.Event._withinElement(e,this)?YES:(e.type="mouseenter",SC.Event.handle.apply(this,arguments))}},mouseleave:{setup:function(){return SC.browser.msie?NO:(SC.Event.add(this,"mouseout",SC.Event.special.mouseleave.handler),YES)},teardown:function(){return SC.browser.msie?NO:(SC.Event.remove(this,"mouseout",SC.Event.special.mouseleave.handler),YES)},handler:function(e){return SC.Event._withinElement(e,this)?YES:(e.type="mouseleave",SC.Event.handle.apply(this,arguments))}}},KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,_withinElement:function(e,t){var n=e.relatedTarget;while(n&&n!==t)try{n=n.parentNode}catch(r){n=t}return n===t},_addEventListener:function(e,t,n){var r,i=this.special[t];n||(n=NO);if(!i||i.setup.call(e)===NO){var s=SC.guidFor(e);this._elements[s]=e,r=SC.data(e,"listener")||SC.data(e,"listener",function(){return SC.Event.handle.apply
(SC.Event._elements[s],arguments)}),e.addEventListener?e.addEventListener(t,r,n):e.attachEvent&&e.attachEvent("on"+t,r)}e=i=r=null},_removeEventListener:function(e,t){var n,r=SC.Event.special[t];if(!r||r.teardown.call(e)===NO)n=SC.data(e,"listener"),n&&(e.removeEventListener?e.removeEventListener(t,n,NO):e.detachEvent&&e.detachEvent("on"+t,n));e=r=n=null},_elements:{},normalizeEvent:function(e){return e===window.event?SC.Event.create(e):e.normalized?e:SC.Event.create(e)},_global:{},_props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode metaKey newValue originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target timeStamp toElement type view which touches targetTouches changedTouches animationName elapsedTime dataTransfer".split(" ")}),SC.Event.prototype={hasCustomEventHandling:NO,touchesForView:function(e){if(this.touchContext)return this.touchContext.touchesForView(e)},touchesForResponder:function(e){if(this.touchContext)return this.touchContext.touchesForView(e)},averagedTouchesForView:function(e){return this.touchContext?this.touchContext.averagedTouchesForView(e):null},allowDefault:function(){return this.hasCustomEventHandling=YES,this},preventDefault:function(){var e=this.originalEvent;return e&&(e.preventDefault&&e.preventDefault(),e.returnValue=NO),this.hasCustomEventHandling=YES,this},stopPropagation:function(){var e=this.originalEvent;return e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=YES),this.hasCustomEventHandling=
YES,this},stop:function(){return this.preventDefault().stopPropagation()},normalized:YES,getCharString:function(){if(SC.browser.msie){if(this.keyCode==8||this.keyCode==9||this.keyCode>=37&&this.keyCode<=40)return String.fromCharCode(0);var e=this.keyCode>=96&&this.keyCode<=105?this.charCode:this.keyCode;return e>0?String.fromCharCode(e):null}return this.charCode>0?String.fromCharCode(this.charCode):null},commandCodes:function(){var e=this.keyCode,t=null,n=null,r="",i;if(e){t=SC.FUNCTION_KEYS[e],!t&&(this.altKey||this.ctrlKey||this.metaKey)&&(t=SC.PRINTABLE_KEYS[e]);if(t){this.altKey&&(r+="alt_");if(this.ctrlKey||this.metaKey)r+="ctrl_";this.shiftKey&&(r+="shift_")}}return t||(e=this.which,e>95&&e<106&&(e-=48),n=t=String.fromCharCode(e),i=t.toLowerCase(),this.metaKey?(r="meta_",t=i):t=null),t&&(t=r+t),[t,n]}},SC.Event.observe=SC.Event.add,SC.Event.stopObserving=SC.Event.remove,SC.Event.fire=SC.Event.trigger,SC.browser.msie&&SC.Event.add(window,"unload",SC.Event.prototype,SC.Event.unload),SC.MODIFIER_KEYS={16:"shift",17:"ctrl",18:"alt"},SC.FUNCTION_KEYS={8:"backspace",9:"tab",13:"return",19:"pause",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",44:"printscreen",45:"insert",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock"},SC.PRINTABLE_KEYS={32:" ",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80
:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:'"'},SC.SYSTEM_CURSOR="default",SC.AUTO_CURSOR=SC.DEFAULT_CURSOR="auto",SC.CROSSHAIR_CURSOR="crosshair",SC.HAND_CURSOR=SC.POINTER_CURSOR="pointer",SC.MOVE_CURSOR="move",SC.E_RESIZE_CURSOR="e-resize",SC.NE_RESIZE_CURSOR="ne-resize",SC.NW_RESIZE_CURSOR="nw-resize",SC.N_RESIZE_CURSOR="n-resize",SC.SE_RESIZE_CURSOR="se-resize",SC.SW_RESIZE_CURSOR="sw-resize",SC.S_RESIZE_CURSOR="s-resize",SC.W_RESIZE_CURSOR="w-resize",SC.IBEAM_CURSOR=SC.TEXT_CURSOR="text",SC.WAIT_CURSOR="wait",SC.HELP_CURSOR="help",SC.Cursor=SC.Object.extend({init:function(){arguments.callee.base.apply(this,arguments);var e=this.get("cursorStyle")||SC.DEFAULT_CURSOR,t=this.constructor.sharedStyleSheet(),n=SC.guidFor(this);return t.insertRule?t.insertRule("."+n+" {cursor: "+e+";}",t.cssRules?t.cssRules.length:0):t.addRule&&t.addRule("."+n,"cursor: "+e),this.cursorStyle=e,this.className=n,this},className:null,cursorStyle:SC.DEFAULT_CURSOR,cursorStyleDidChange:function(){var e,t,n,r,i,s,o;e=this.get("cursorStyle")||SC.DEFAULT_CURSOR,t=this._rule;if(t){t.style.cursor=e;return}n="."+this.get("className"),r=this.constructor.sharedStyleSheet(),i=(r.cssRules?r.cssRules:r.rules)||[];for(s=0,o=i.length;s<o;++s){t=i[s];if(t.selectorText===n){this._rule=t,t.style.cursor=e;break}}}.observes("cursorStyle")}),SC.Cursor.sharedStyleSheet=function(){var e,t=this._styleSheet;return t||(t=document.createElement("style"),t.type="text/css",e=document.getElementsByTagName("head"
)[0],e||(e=document.documentElement),e.appendChild(t),t=document.styleSheets[document.styleSheets.length-1],this._styleSheet=t),t},SC.Theme={isTheme:YES,classNames:SC.CoreSet.create(),_extend_class_names:function(e){if(e)if(SC.typeOf(e)===SC.T_HASH&&!e.isSet)for(var t in e)e[t]?this.classNames.add(t):this.classNames.remove(t);else typeof e=="string"?this.classNames.addEach(e.split(" ")):this.classNames.addEach(e)},_extend_self:function(e){e.classNames&&this._extend_class_names(e.classNames);var t,n,r;for(t in e){if(t==="classNames")continue;if(!e.hasOwnProperty(t))continue;n=e[t],n instanceof Function&&!n.base&&n!==(r=this[t])&&(n.base=r),this[t]=n}},create:function(){var e=SC.beget(this);e.baseTheme=this,this.themes===SC.Theme.themes?(e.themes={},e._themeIsUnrelated={}):(e.themes=SC.beget(this.themes),e._themeIsUnrelated=SC.beget(this._themeIsUnrelated)),e._privateThemes={},e._specializedThemes={},e.classNames=SC.clone(this.classNames);var t=arguments,n=t.length,r,i;for(r=0;r<n;r++)e._extend_self(t[r]);return e.name&&e.classNames.add(e.name),e},subtheme:function(e){var t=this.create({name:e});return this.addTheme(t),t},invisibleSubtheme:function(e){var t=this.create({name:e});return this._privateThemes[e]=t,t},themes:{},_themeIsUnrelated:{},find:function(e,t){if(this===SC.Theme)return this.themes[e];var n;n=this._privateThemes[e];if(n)return n;n=this._specializedThemes[e];if(n)return n;n=this.themes[e];if(n&&this._themeIsUnrelated[e])return n;if(n&&!this._specializedThemes[e])return this._specializedThemes[e]=n.create({classNames:this.classNames});if(t)return;return n=SC.Theme
.themes[e],n?n:null},addTheme:function(e){this.themes[e.name]=e,this._themeIsUnrelated[e.name]=NO},addUnrelatedTheme:function(e){this.themes[e.name]=e,this._themeIsUnrelated[e.name]=YES}},SC.BaseTheme=SC.Theme.create({name:""}),SC.Theme.themes["sc-base"]=SC.BaseTheme,SC.defaultTheme="sc-base",SC.CoreView=SC.Responder.extend(SC.DelegateSupport),SC.CONTEXT_MENU_ENABLED=YES,SC.TABBING_ONLY_INSIDE_DOCUMENT=NO,SC.FROM_THEME="__FROM_THEME__",SC.EMPTY_CHILD_VIEWS_ARRAY=[],SC.EMPTY_CHILD_VIEWS_ARRAY.needsClone=YES,SC.CoreView.reopen({concatenatedProperties:["outlets","displayProperties","classNames","renderMixin","didCreateLayerMixin","willDestroyLayerMixin","classNameBindings","attributeBindings"],ariaRole:null,ariaHidden:null,ariaLabel:null,pane:function(){var e=this;while(e&&!e.isPane)e=e.get("parentView");return e}.property("parentView").cacheable(),page:null,parentView:null,isVisible:YES,isVisibleBindingDefault:SC.Binding.bool(),isVisibleInWindow:YES,childViews:SC.EMPTY_CHILD_VIEWS_ARRAY,layer:function(e,t){if(t!==undefined)this._view_layer=t;else{t=this._view_layer;if(!t){var n=this.get("parentView");n&&(n=n.get("layer")),n&&(this._view_layer=t=this.findLayerInParentLayer(n))}}return t}.property("isVisibleInWindow").cacheable(),$:function(e){var t=this.get("layer");return t?e===undefined?SC.$(t):SC.$(e,t):SC.$()},containerLayer:function(){return this.get("layer")}.property("layer").cacheable(),layerId:function(e,t){return t&&(this._layerId=t),this._layerId?this._layerId:SC.guidFor(this)}.property().cacheable(),findLayerInParentLayer:function(e){var t="#"+this.get("layerId");return jQuery
(t)[0]||jQuery(t,e)[0]},isDescendantOf:function(e){var t=this.get("parentView");return this===e?YES:t?t.isDescendantOf(e):NO},displayDidChange:function(){return this.set("layerNeedsUpdate",YES),this},_sc_isVisibleDidChange:function(){this.displayDidChange()}.observes("isVisible"),layerNeedsUpdate:NO,_view_layerNeedsUpdateDidChange:function(){this.get("layerNeedsUpdate")&&this.invokeOnce(this.updateLayerIfNeeded)}.observes("layerNeedsUpdate"),updateLayerIfNeeded:function(e){var t=this.get("layerNeedsUpdate"),n=t&&(e||this.get("isVisibleInWindow"));return n&&this.get("layer")&&(this.beginPropertyChanges(),this.set("layerNeedsUpdate",NO),this.updateLayer(),this.endPropertyChanges()),this},updateLayer:function(e){var t,n,r,i,s=e||this.renderContext(this.get("layer"));this._renderLayerSettings(s,NO),i=!this.update,i?this.render(s,NO):this.update(s.$());if(t=this.renderMixin){r=t.length;for(n=0;n<r;++n)t[n].call(this,s,NO)}s.update();if(s._innerHTMLReplaced){var o=this.get("pane");o&&o.get("isPaneAttached")&&this._notifyDidAppendToDocument()}return this.useStaticLayout&&this.viewDidResize(),this.didUpdateLayer&&this.didUpdateLayer(),this},parentViewDidResize:function(){this.get("hasLayout")||this.notifyPropertyChange("frame"),this.viewDidResize()},viewDidResize:function(){},renderContext:function(e){return SC.RenderContext(e)},createLayer:function(){if(this.get("layer"))return this;var e=this.renderContext(this.get("tagName"));return this.renderToContext(e),this.set("layer",e.element()),this._notifyDidCreateLayer(),this},_notifyDidCreateLayer:function(){var e=this.get("useStaticLayout"
),t=this.didCreateLayerMixin,n,r,i=this.get("childViews"),s;this.notifyPropertyChange("layer");if(e){var o=this.get("pane");o&&o.isPaneAttached&&this.viewDidResize()}this.didCreateLayer&&this.didCreateLayer();if(t){n=t.length;for(r=0;r<n;++r)t[r].call(this)}n=i.length;for(r=0;r<n;++r){s=i[r];if(!s)continue;s.notifyPropertyChange("layer"),e&&(s.get("isFixedLayout")||s.viewDidResize()),s._notifyDidCreateLayer()}},_invalidateStaticLayoutFrames:function(){var e=this.get("childViews"),t=e.length,n,r;for(n=0;n<t;n++)r=e[n],r.useStaticLayout?r.viewDidResize():r._invalidateStaticLayoutFrames()},destroyLayer:function(){var e=this.get("layer");return e&&(this._notifyWillDestroyLayer(),e.parentNode&&e.parentNode.removeChild(e),e=null),this},replaceLayer:function(){this.destroyLayer(),this.set("layerLocationNeedsUpdate",YES),this.invokeOnce(this.updateLayerLocationIfNeeded)},parentViewDidChange:function(){this.parentViewDidResize(),this.updateLayerLocation()},layerLocationNeedsUpdate:NO,updateLayerLocationIfNeeded:function(e){return this.get("layerLocationNeedsUpdate")&&this.updateLayerLocation(),this},updateLayerLocation:function(){var e=this.get("layer"),t=this.get("parentView"),n=t?t.get("containerLayer"):null;e&&e.parentNode&&e.parentNode!==n&&e.parentNode.removeChild(e);if(!t)e&&e.parentNode&&e.parentNode.removeChild(e);else if(!n)e&&(e.parentNode&&e.parentNode.removeChild(e),this.destroyLayer());else{if(!e){this.createLayer(),e=this.get("layer");if(!e)return}var r=t.get("childViews"),i=r.objectAt(r.indexOf(this)+1),s=i?i.get("layer"):null;i&&(!s||s.parentNode!==n)&&(i.updateLayerLocationIfNeeded
(),s=i.get("layer")||null),(e.parentNode!==n||e.nextSibling!==s)&&n.insertBefore(e,s)}return n=t=e=s=null,this.set("layerLocationNeedsUpdate",NO),this},_notifyWillDestroyLayer:function(){this.willDestroyLayer&&this.willDestroyLayer();var e=this.willDestroyLayerMixin,t,n,r=this.get("childViews");if(e){t=e.length;for(n=0;n<t;++n)e[n].call(this)}t=r.length;for(n=0;n<t;++n)r[n]._notifyWillDestroyLayer();this.set("layer",null)},renderToContext:function(e,t){var n,r,i,s;this.beginPropertyChanges(),this.set("layerNeedsUpdate",NO),SC.none(t)&&(t=YES),this._renderLayerSettings(e,t),n=!this.update,n?this.render(e,t):t?this.render(e):this.update(e.$()),t&&!this._didRenderChildViews&&this.renderChildViews(e,t),this._didRenderChildViews=NO;if(r=this.renderMixin){s=r.length;for(i=0;i<s;++i)r[i].call(this,e,t)}this.endPropertyChanges()},_renderLayerSettings:function(e,t){e.resetClassNames(),e.resetStyles(),this.applyAttributesToContext(e)},applyAttributesToContext:function(e){this._didApplyAttributes||(this._applyClassNameBindings(),this._applyAttributeBindings(e),this._didApplyAttributes=YES),e.addClass(this.get("classNames")),this.get("isTextSelectable")&&e.addClass("allow-select"),this.get("isVisible")||e.addClass("sc-hidden"),this.get("isFirstResponder")&&e.addClass("focus"),e.id(this.get("layerId")),e.attr("role",this.get("ariaRole")),e.attr("aria-label",this.get("ariaLabel"));var t=this.get("ariaHidden");t!==null&&(t===NO?e.removeAttr("aria-hidden"):e.attr("aria-hidden",t)),this.get("acceptsFirstResponder")&&e.attr("tabindex","0")},_applyClassNameBindings:function(){var e=this.get("classNameBindings"
),t=this.get("classNames"),n,r,i;if(!e)return;e.forEach(function(e){var s,o=function(){r=this._classStringForProperty(e),n=this.$(),s&&(n.removeClass(s),t.removeObject(s)),r?(n.addClass(r),t.pushObject(r),s=r):s=null};this.addObserver(e.split(":")[0],this,o),i=this._classStringForProperty(e),i&&(t.push(i),s=i)},this)},_applyAttributeBindings:function(e){var t=this.get("attributeBindings"),n,r,i;if(!t)return;t.forEach(function(t){var s=function(){r=this.$();var e=r.attr(t);n=this.get(t),i=typeof n,i!=="string"&&i!=="number"||n===e?n&&i==="boolean"?r.attr(t,t):n===NO&&r.removeAttr(t):r.attr(t,n)};this.addObserver(t,this,s),n=this.get(t),i=typeof n,i==="string"||i==="number"?e.attr(t,n):n&&i==="boolean"&&e.attr(t,t)},this)},_classStringForProperty:function(e){var t=e.split(":"),n=t[1];e=t[0];var r=SC.getPath(this,e);return r===YES?n?n:SC.String.dasherize(e.split(".").get("lastObject")):r!==NO&&r!==undefined&&r!==null?r:null},prepareContext:function(e,t){t!==!1&&(t=YES),t?this.renderToContext(e):this.updateLayer(e)},renderChildViews:function(e,t){var n=this.get("childViews"),r=n.length,i,s;for(i=0;i<r;++i){s=n[i];if(!s)continue;e=e.begin(s.get("tagName")),s.renderToContext(e,t),e=e.end()}return this._didRenderChildViews=YES,e},render:function(){},_notifyDidAppendToDocument:function(){this.get("hasLayout")||this.notifyPropertyChange("frame"),this.didAppendToDocument&&this.didAppendToDocument();var e=0,t,n,r=this.get("childViews");for(e=0,n=r.length;e<n;e++)t=r[e],t._notifyDidAppendToDocument&&t._notifyDidAppendToDocument()},childViewsObserver:function(){var e=this.get("childViews"
),t,n,r;for(t=0,n=e.length;t<n;t++)r=e[t],r._notifyDidAppendToDocument&&r._notifyDidAppendToDocument()}.observes("childViews"),tagName:"div",classNames:[],toolTip:null,displayToolTip:function(){var e=this.get("toolTip");return e&&this.get("localize")?SC.String.loc(e):e||""}.property("toolTip","localize").cacheable(),isTextSelectable:NO,displayProperties:["ariaHidden","ariaLabel"],nextResponder:function(){return this.get("parentView")}.property("parentView").cacheable(),acceptsFirstResponder:NO,focusEventMakesFirstResponder:YES,focusEventMakesFirstResponderBindingDefault:SC.Binding.bool(),init:function(){var e=this.get("parentView"),t,n,r,i;arguments.callee.base.apply(this,arguments),SC.View.views[this.get("layerId")]=this,this.classNames=this.get("classNames").slice(),this.childViews=this.get("childViews").slice(),this.createChildViews(),i=this.get("displayProperties");for(var s=0,o=i.length;s<o;s++)this.addObserver(i[s],this,this.displayDidChange)},awake:function(){arguments.callee.base.apply(this,arguments);var e=this.get("childViews"),t=e.length,n;for(n=0;n<t;++n){if(!e[n])continue;e[n].awake()}},frame:function(){return this.computeFrameWithParentFrame(null)}.property("useStaticLayout").cacheable(),computeFrameWithParentFrame:function(){var e,t=this.get("parentView"),n;return(e=this.get("layer"))?(n=SC.offset(e),t&&(n=t.convertFrameFromView(n,null)),n.width=e.offsetWidth,n.height=e.offsetHeight,n):this.get("hasLayout")?null:{x:0,y:0,width:0,height:0}},clippingFrame:function(){var e=this.__alreadyCalculatedClippingFrame;if(e)return delete this.__alreadyCalculatedClippingFrame
,e;var t=this.get("frame"),n=t,r,i;if(!t)return null;r=this.get("parentView");if(r){i=r.get("clippingFrame");if(!i)return{x:0,y:0,width:t.width,height:t.height};n=SC.intersectRects(i,t)}return n.x-=t.x,n.y-=t.y,n}.property().cacheable(),_previousClippingFrame:null,_sc_view_clippingFrameMayHaveChanged:function(){var e=this._previousClippingFrame,t=this.clippingFrame(),n,r,i,s;if(!e||!t||e.height!==t.height||e.width!==t.width||e.y!==t.y||e.x!==t.x){this._previousClippingFrame=t,this.__alreadyCalculatedClippingFrame=t,this.notifyPropertyChange("clippingFrame"),n=this.get("childViews");for(r=0,i=n.length;r<i;++r)s=n[r],s._sc_view_clippingFrameMayHaveChanged()}else delete this.__alreadyCalculatedClippingFrame},removeChild:function(e){e.set("parentView",null);var t=this.get("childViews"),n=t.indexOf(e);return n>=0&&t.removeAt(n),this},removeAllChildren:function(){var e=this.get("childViews"),t;while(t=e.objectAt(e.get("length")-1))this.removeChild(t);return this},removeFromParent:function(){var e=this.get("parentView");return e&&e.removeChild(this),this},destroy:function(){return this.get("isDestroyed")?this:(this._destroy(),this.get("parentView")&&this.removeFromParent(),arguments.callee.base.apply(this,arguments))},_destroy:function(){this.destroyLayer();var e=this.get("childViews"),t=e.length,n;if(t){e=e.slice();for(n=0;n<t;++n)e[n].destroy()}return delete SC.View.views[this.get("layerId")],delete this._CQ,delete this.page,this.get("parentView")&&this.removeFromParent(),this.set("owner",null),this},createChildViews:function(){var e=this.get("childViews"),t=e.length,n,r,i,s;this
.beginPropertyChanges();for(n=0;n<t;++n){if(r=s=e[n]){typeof r===SC.T_STRING?s=this[r]:r=null;if(!s){SC.Logger.error("No view with name "+r+" has been found in "+this.toString());continue}s=this.createChildView(s),r&&(this[r]=s)}e[n]=s}return this.endPropertyChanges(),this},createChildView:function(e,t){return e.isClass?t?t=SC.clone(t):t={}:t=e,t.owner=t.parentView=this,e.isClass&&e.prototype.hasVisibility&&(t.isVisibleInWindow=this.get("isVisibleInWindow")),t.page||(t.page=this.page),e.isClass&&(e=e.create(t)),e},isView:YES,selectStart:function(e){return this.get("isTextSelectable")},isContextMenuEnabled:SC.CONTEXT_MENU_ENABLED,contextMenu:function(e){return!this.get("isContextMenuEnabled")}}),SC.CoreView.mixin({isViewClass:YES,design:function(){if(this.isDesign)return this;var e=this.extend.apply(this,arguments);return e.isDesign=YES,e},extend:function(){var e=arguments[arguments.length-1];return e&&!SC.none(e.theme)&&typeof e.theme=="string"&&(e.themeName=e.theme,delete e.theme),SC.Object.extend.apply(this,arguments)},layout:function(e){return this.prototype.layout=e,this},classNames:function(e){return e=(this.prototype.classNames||[]).concat(e),this.prototype.classNames=e,this},tagName:function(e){return this.prototype.tagName=e,this},childView:function(e){var t=this.prototype.childViews||[];return t===this.superclass.prototype.childViews&&(t=t.slice()),t.push(e),this.prototype.childViews=t,this},bind:function(e,t){var n=this.prototype,r=this.superclass.prototype,i=n._bindings;if(!i||i===r._bindings)i=n._bindings=(i||[]).slice();return e+="Binding",n[e]=t,i.push(e),this}
,prop:function(e,t){return this.prototype[e]=t,this},localization:function(e,t){return t&&(e.rootElement=SC.$(t)[0]),e},viewFor:function(e,t){var n=SC.$A(arguments);SC.none(e)?n.shift():n[0]={rootElement:SC.$(e)[0]};var r=this.create.apply(this,arguments);return n=n[0]=null,r},create:function(){var e=arguments[arguments.length-1];e&&e.theme&&(e.themeName=e.theme,delete e.theme);var t=this,n=new t(arguments);return n},loc:function(e){var t=e.childViews;delete e.childViews,this.applyLocalizedAttributes(e);var n=this.prototype.childViews,r=n.length,i;while(--r>=0)i=n[r],e=t[r],e&&i&&typeof i===SC.T_STRING&&SC.String.loc(i,e);return this},applyLocalizedAttributes:function(e){SC.mixin(this.prototype,e)},views:{}}),SC.outlet=function(e,t){return function(n){return this[n]=SC.objectForPropertyPath(e,t!==undefined?t:this)}.property()},SC.CoreView.unload=function(){var e=SC.View.views;if(e)for(var t in e){if(!e.hasOwnProperty(t))continue;delete e[t]}},SC.View=SC.CoreView.extend({classNames:["sc-view"],displayProperties:["isFirstResponder"]}),SC.browser.msie&&SC.Event.add(window,"unload",SC.View,SC.View.unload),SC.ANIMATABLE_PROPERTIES={top:YES,left:YES,bottom:YES,right:YES,width:YES,height:YES,centerX:YES,centerY:YES,opacity:YES,scale:YES,rotate:YES,rotateX:YES,rotateY:YES,rotateZ:YES},SC.View.reopen({didCreateLayerMixin:function(){SC.platform.supportsCSSTransitions&&this.resetAnimation()},animate:function(e,t,n,r){var i,s;typeof e===SC.T_STRING?(i={},i[e]=t,s=n):(i=e,s=t,r=n);var o=SC.typeOf(s);if(o===SC.T_NUMBER)s={duration:s};else if(o!==SC.T_HASH)throw"Must provide options hash or duration!"
;r&&(s.callback=r);var u=s.timing;u?typeof u!==SC.T_STRING&&(s.timing="cubic-bezier("+u[0]+", "+u[1]+", "+u[2]+", "+u[3]+")"):s.timing="linear";var a=SC.clone(this.get("layout")),f=NO,l,c,h,p,d;a.animate||(a.animate={});for(d in i){if(!i.hasOwnProperty(d)||!SC.ANIMATABLE_PROPERTIES[d])continue;l=i[d],c=a[d],p=a.animate[d];if(l==null)throw"Can only animate to an actual value!";if(c!==l||p&&p.duration!==s.duration)f=YES,a.animate[d]=s,a[d]=l}return f&&this.set("layout",a),this},resetAnimation:function(){var e=this.get("layout"),t=e.animate,n=NO,r;if(!t)return;var i;for(r in t)n=YES,delete t[r];return n&&(this.set("layout",e),this.notifyPropertyChange("layout")),this},transitionDidEnd:function(e){this.get("layoutStyleCalculator").transitionDidEnd(e)}}),SC.CSS_TRANSFORM_MAP={rotate:function(e){return null},rotateX:function(e){return SC.typeOf(e)===SC.T_NUMBER&&(e+="deg"),"rotateX("+e+")"},rotateY:function(e){return SC.typeOf(e)===SC.T_NUMBER&&(e+="deg"),"rotateY("+e+")"},rotateZ:function(e){return SC.typeOf(e)===SC.T_NUMBER&&(e+="deg"),"rotateZ("+e+")"},scale:function(e){return SC.typeOf(e)===SC.T_ARRAY&&(e=e.join(", ")),"scale("+e+")"}},SC.View.reopen({layoutStyleCalculator:null,layoutStyle:function(){var e={layout:this.get("layout"),turbo:this.get("hasAcceleratedLayer"),staticLayout:this.get("useStaticLayout")},t=this.get("layoutStyleCalculator");return t.set(e),t._layoutDidUpdate(),t.calculate()}.property().cacheable()}),SC.View.LayoutStyleCalculator=SC.Object.extend({_layoutDidUpdate:function(){var e=this.get("layout");if(!e)return;this.dims=SC._VIEW_DEFAULT_DIMS,this.loc=this
.dims.length;var t=this.right=e.right;this.hasRight=t!=null;var n=this.left=e.left;this.hasLeft=n!=null;var r=this.top=e.top;this.hasTop=r!=null;var i=this.bottom=e.bottom;this.hasBottom=i!=null;var s=this.width=e.width;this.hasWidth=s!=null;var o=this.height=e.height;this.hasHeight=o!=null,this.minWidth=e.minWidth===undefined?null:e.minWidth;var u=this.maxWidth=e.maxWidth===undefined?null:e.maxWidth;this.hasMaxWidth=u!=null,this.minHeight=e.minHeight===undefined?null:e.minHeight;var a=this.maxHeight=e.maxHeight===undefined?null:e.maxHeight;this.hasMaxHeight=a!=null;var f=this.centerX=e.centerX;this.hasCenterX=f!=null;var l=this.centerY=e.centerY;this.hasCenterY=l!=null;var c=this.borderTop=(e.borderTop!==undefined?e.borderTop:e.border)||0,h=this.borderRight=(e.borderRight!==undefined?e.borderRight:e.border)||0,p=this.borderBottom=(e.borderBottom!==undefined?e.borderBottom:e.border)||0,d=this.borderLeft=(e.borderLeft!==undefined?e.borderLeft:e.border)||0;this.zIndex=e.zIndex!=null?e.zIndex.toString():null,this.opacity=e.opacity!=null?e.opacity.toString():null,this.backgroundPosition=e.backgroundPosition!=null?e.backgroundPosition:null,this.ret={marginTop:null,marginLeft:null}},_invalidAutoValue:function(e){var t=SC.Error.desc("%@.layout() you cannot use %@:auto if staticLayout is disabled".fmt(this.get("view"),e),"%@".fmt(this.get("view")),-1);throw SC.Logger.error(t.toString()),t},_handleMistakes:function(){var e=this.get("layout");this.staticLayout||(this.width===SC.LAYOUT_AUTO&&this._invalidAutoValue("width"),this.height===SC.LAYOUT_AUTO&&this._invalidAutoValue("height"))
;if(SC.platform.supportsCSSTransforms){var t=e.animate,n,r;if(t)for(r in t)if(SC.CSS_TRANSFORM_MAP[r]){if(this._pendingAnimations&&this._pendingAnimations["-"+SC.platform.cssPrefix+"-transform"])throw"Animations of transforms must be executed simultaneously!";n&&t[r].duration!==n&&(SC.Logger.warn("Can't animate transforms with different durations! Using first duration specified."),t[r].duration=n),n=t[r].duration}}},_calculatePosition:function(e){var t=null,n=this.get("turbo"),r=this.ret;if(!r)return t;var i,s,o,u,a,f,l,c,h,p,d,v,m,g;e==="x"?(i="left",s="right",o="width",u="maxWidth",a="marginLeft",p="borderLeft",v="borderRight",f=this.hasLeft,l=this.hasRight,c=this.hasWidth,h=this.hasMaxWidth):(i="top",s="bottom",o="height",u="maxHeight",a="marginTop",p="borderTop",v="borderBottom",f=this.hasTop,l=this.hasBottom,c=this.hasHeight,h=this.hasMaxHeight),r[i]=this._cssNumber(this[i]),r[s]=this._cssNumber(this[s]),d=this._cssNumber(this[p]),m=this._cssNumber(this[v]),r[p+"Width"]=d||null,r[v+"Width"]=m||null,g=this[o],g>=1&&(g-=d+m),r[o]=this._cssNumber(g);if(f)n&&(t=r[i],r[i]=0),l&&c&&(r[s]=null);else if(!l||l&&!c&&!h)r[i]=0;return!c&&!l&&(r[s]=0),t},_calculateCenter:function(e){var t=this.ret,n,r,i,s,o,u,a,f,l;e==="x"?(n="width",r="centerX",i="left",s="right",o="marginLeft",u="borderLeft",f="borderRight"):(n="height",r="centerY",i="top",s="bottom",o="marginTop",u="borderTop",f="borderBottom"),t[i]="50%",a=this._cssNumber(this[u]),l=this._cssNumber(this[f]),t[u+"Width"]=a||null,t[f+"Width"]=l||null;var c=this[n],h=this[r],p=this[i],d=SC.isPercentage(c),v=SC.isPercentage(h,YES);c>1&&
(c-=a+l);if(d&&v||!d&&!v){var m=h-c/2;t[o]=d?m*100+"%":m}else SC.Logger.warn("You have to set "+n+" and "+r+" using both percentages or pixels"),t[o]="50%";t[n]=this._cssNumber(c)||0,t[s]=null},_calculateTransforms:function(e,t){if(SC.platform.supportsCSSTransforms){var n=this.get("layout"),r=SC.platform.domCSSPrefix+"Transform",i=[];this.turbo&&(i.push("translateX("+(e||0)+"px)","translateY("+(t||0)+"px)"),SC.platform.supportsCSS3DTransforms&&i.push("translateZ(0px)"));var s=SC.CSS_TRANSFORM_MAP;for(var o in s){var u=n[o];u!=null&&i.push(s[o](u))}this.ret[r]=i.length>0?i.join(" "):null}},_calculateAnimations:function(e,t){var n=this.layout,r=n.animate,i;if(!r)return;if(this.getPath("view.isAnimatable"))return;var s=[],o;this._animatedTransforms=[],this._pendingAnimations||(this._pendingAnimations={});var u="-"+SC.platform.cssPrefix+"-transform";if(SC.platform.supportsCSSTransitions){for(i in r){o=r[i];var a=SC.CSS_TRANSFORM_MAP[i],f=i==="top"&&t!=null||i==="left"&&e!=null;SC.platform.supportsCSSTransforms&&(f||a)&&(this._animatedTransforms.push(i),i=u),o.css=i+" "+o.duration+"s "+o.timing,this._pendingAnimations[i]||(this._pendingAnimations[i]=o,s.push(o.css))}this.ret[SC.platform.domCSSPrefix+"Transition"]=s.join(", ")}else for(i in r)this._pendingAnimations[i]=r[i];delete n.animate},_cssNumber:function(e){return e==null?null:e===SC.LAYOUT_AUTO?SC.LAYOUT_AUTO:SC.isPercentage(e)?e*100+"%":e},calculate:function(){var e=this.get("layout"),t=null,n=this.get("staticLayout"),r=null,i=null,s=this.get("turbo"),o=this.ret,u=this.dims,a=this.loc,f=this.get("view"),l,c;this._handleMistakes
(e);if(n&&e===SC.View.prototype.layout)return{};this.hasLeft||this.hasRight||!this.hasCenterX?i=this._calculatePosition("x"):this._calculateCenter("x"),this.hasTop||this.hasBottom||!this.hasCenterY?r=this._calculatePosition("y"):this._calculateCenter("y"),o.minWidth=this.minWidth,o.maxWidth=this.maxWidth,o.minHeight=this.minHeight,o.maxHeight=this.maxHeight,o.zIndex=this.zIndex,o.opacity=this.opacity,o.backgroundPosition=this.backgroundPosition,this._calculateTransforms(i,r),this._calculateAnimations(i,r);for(l in o)c=o[l],typeof c===SC.T_NUMBER&&(o[l]=c+"px");return o},willRenderAnimations:function(){if(SC.platform.supportsCSSTransitions){var e=this.get("view"),t=e.get("layer"),n=t?t.style:null,r=e.get("layoutStyle"),i=this._activeAnimations,s,o=this._pendingAnimations,u,a=this._animatedTransforms,f=a?a.length:0,l=r[SC.platform.domCSSPrefix+"Transition"],c=e.get("layout"),h,p,d,v;if(o){i||(i={});for(h in o){if(!o.hasOwnProperty(h))continue;u=o[h],s=i[h],v=NO,r[h]!==(n?n[h]:null)&&(v=YES),s&&(s.duration!==u.duration||s.timing!==u.timing)&&(v=YES);if(v&&s){if(p=s.callback)if(f>0){for(d=0;d<f;d++)this.runAnimationCallback(p,null,a[d],YES);this._animatedTransforms=null}else this.runAnimationCallback(p,null,h,YES);this.removeAnimationFromLayout(h,YES)}i[h]=u}}this._activeAnimations=i,this._pendingAnimations=null}},didRenderAnimations:function(){if(!SC.platform.supportsCSSTransitions){var e,t;for(e in this._pendingAnimations)t=this._pendingAnimations[e].callback,t&&this.runAnimationCallback(t,null,e,NO),this.removeAnimationFromLayout(e,NO,YES);this._activeAnimations=this._pendingAnimations=
null}},runAnimationCallback:function(e,t,n,r){var i=this.get("view");e&&(SC.typeOf(e)!==SC.T_HASH&&(e={action:e}),e.source=i,e.target||(e.target=this)),SC.View.runCallback(e,{event:t,propertyName:n,view:i,isCancelled:r})},transitionDidEnd:function(e){var t=e.originalEvent.propertyName,n,r;n=this._activeAnimations?this._activeAnimations[t]:null;if(n){if(n.callback){SC.RunLoop.begin();if(this._animatedTransforms&&this._animatedTransforms.length>0)for(r=0;r<this._animatedTransforms.length;r++)this.invokeLater("runAnimationCallback",1,n.callback,e,this._animatedTransforms[r],NO);else this.invokeLater("runAnimationCallback",1,n.callback,e,t,NO);SC.RunLoop.end()}this.removeAnimationFromLayout(t,YES)}},removeAnimationFromLayout:function(e,t,n){if(t){var r=this.getPath("view.layer"),i=[],s;for(s in this._activeAnimations)s!==e&&i.push(this._activeAnimations[s].css);r&&(r.style[SC.platform.domCSSPrefix+"Transition"]=i.join(", "))}var o=this.getPath("view.layout"),u;if(e==="-"+SC.platform.cssPrefix+"-transform"&&this._animatedTransforms&&this._animatedTransforms.length>0){for(u=0;u<this._animatedTransforms.length;u++)delete o["animate"+SC.String.capitalize(this._animatedTransforms[u])];this._animatedTransforms=null}delete o["animate"+SC.String.capitalize(e)],n||delete this._activeAnimations[e]}}),SC.CoreView.runCallback=function(e){var t=SC.$A(arguments).slice(1),n=SC.typeOf(e.action);if(n==SC.T_FUNCTION)e.action.apply(e.target,t);else if(n===SC.T_STRING&&e.action.indexOf(".")>=0){var r=e.action.split("."),i=r.pop(),s=SC.objectForPropertyPath(r,window),o=s.get?s.get(i):s[i];if(!o||SC.
typeOf(o)!=SC.T_FUNCTION)throw"SC.runCallback could not find a function at %@".fmt(e.action);o.apply(s,t)}},SC.View.runCallback=SC.CoreView.runCallback,SC.View.reopen({wantsAcceleratedLayer:NO,hasAcceleratedLayer:function(){if(this.get("wantsAcceleratedLayer")&&SC.platform.supportsAcceleratedLayers){var e=this.get("layout"),t=e.animate,n=SC.LAYOUT_AUTO,r;if(t&&(t.top||t.left))for(r in t)if(SC.CSS_TRANSFORM_MAP[r]&&(t.top&&t.top.duration!==t[r].duration||t.left&&t.left.duration!==t[r].duration))return NO;if(e.left!=null&&!SC.isPercentage(e.left)&&e.left!==n&&e.top!=null&&!SC.isPercentage(e.top)&&e.top!==n&&e.width!=null&&!SC.isPercentage(e.width)&&e.width!==n&&e.height!=null&&!SC.isPercentage(e.height)&&e.height!==n)return YES}return NO}.property("wantsAcceleratedLayer").cacheable()}),SC.View.reopen({cursor:function(e,t){var n;return t&&(this._setCursor=t),this._setCursor!==undefined?this._setCursor:(n=this.get("parentView"),this.get("shouldInheritCursor")&&n?n.get("cursor"):null)}.property("parentView","shouldInheritCursor").cacheable(),applyAttributesToContext:function(e,t){var n=this.get("cursor");n&&t.addClass(n.get("className")),e(t)}.enhance(),shouldInheritCursor:YES}),SC.View.reopen({isEnabled:YES,isEnabledBindingDefault:SC.Binding.oneWay().bool(),isEnabledInPane:function(){var e=this.get("isEnabled"),t;return e&&(t=this.get("parentView"))&&(e=t.get("isEnabledInPane")),e}.property("parentView","isEnabled"),_sc_view_isEnabledDidChange:function(){!this.get("isEnabled")&&this.get("isFirstResponder")&&this.resignFirstResponder()}.observes("isEnabled"),applyAttributesToContext
:function(e,t){var n=this.get("isEnabled");e(t),t.setClass("disabled",!n),t.attr("aria-disabled",n?null:"true")}.enhance()}),SC.View.reopen({isKeyResponder:NO,willLoseKeyResponderTo:function(e){},willBecomeKeyResponderFrom:function(e){},didLoseKeyResponderTo:function(e){},didBecomeKeyResponderFrom:function(e){},interpretKeyEvents:function(e){var t=e.commandCodes(),n=t[0],r=t[1],i;if(!n&&!r)return null;if(n){var s=SC.MODIFIED_KEY_BINDINGS[n]||SC.BASE_KEY_BINDINGS[n.match(/[^_]+$/)[0]];if(s){var o=this,u=this.get("pane"),a=null;while(o&&!(a=o.tryToPerform(s,e)))o=o===u?null:o.get("nextResponder");return a}}return r&&this.respondsTo("insertText")?(i=this.insertText(r,e),i?i===YES?this:i:null):null},insertText:function(e){return NO},performKeyEquivalent:function(e,t){var n=NO,r=this.get("childViews"),i=r.length,s=-1,o;while(!n&&++s<i)o=r[s],n=o.tryToPerform("performKeyEquivalent",e,t);return n},firstKeyView:null,_getFirstKeyView:function(){var e=this.get("firstKeyView");if(e)return e;var t=this.get("childViews");if(t)return t[0]},lastKeyView:null,_getLastKeyView:function(){var e=this.get("lastKeyView");if(e)return e;var t,n=this.get("firstKeyView");if(n){while(t=n._getNextKeyView())n=t;return n}var r=this.get("childViews");if(r)return r[r.length-1]},nextKeyView:undefined,_getNextKeyView:function(){var e=this.get("parentView"),t=this.get("nextKeyView");if(e&&e.get("lastKeyView")===this)return null;if(t!==undefined)return t;if(e){var n=e.get("childViews");return n[n.indexOf(this)+1]}},nextValidKeyView:function(){var e=this,t;while(t!==this){t=null,e.get("isVisibleInWindow")&&(t=e.
_getFirstKeyView()),t||(t=e._getNextKeyView());if(!t)while(e=e.get("parentView"))if(t=e._getNextKeyView())break;if(!t){if(!SC.TABBING_ONLY_INSIDE_DOCUMENT)break;t=this.get("pane")}if(t.get("isVisibleInWindow")&&t.get("acceptsFirstResponder"))return t;e=t}return null}.property("nextKeyView"),previousKeyView:undefined,_getPreviousKeyView:function(){var e=this.get("parentView"),t=this.get("previousKeyView");if(e&&e.get("firstKeyView")===this)return null;if(t!==undefined)return t;if(e){var n=e.get("childViews");return n[n.indexOf(this)-1]}},previousValidKeyView:function(){var e=this,t;while(t!==this){if(e.get("parentView"))t=e._getPreviousKeyView();else{if(!SC.TABBING_ONLY_INSIDE_DOCUMENT)break;t=e}if(t){do e=t,t=t._getLastKeyView();while(t&&t.get("isVisibleInWindow"));t||(t=e)}else t=e.get("parentView");if(t.get("isVisibleInWindow")&&t.get("acceptsFirstResponder"))return t;e=t}return null}.property("previousKeyView")}),SC.LAYOUT_HORIZONTAL="sc-layout-horizontal",SC.LAYOUT_VERTICAL="sc-layout-vertical",SC._VIEW_DEFAULT_DIMS=["marginTop","marginLeft"],SC.FULL_WIDTH={left:0,right:0},SC.FULL_HEIGHT={top:0,bottom:0},SC.ANCHOR_CENTER={centerX:0,centerY:0},SC.LAYOUT_AUTO="auto",SC.View.reopen({hasLayout:YES,useStaticLayout:NO,init:function(e){e(),this.layoutStyleCalculator=SC.View.LayoutStyleCalculator.create({view:this}),this._previousLayout=this.get("layout")}.enhance(),propertyDidChange:function(e,t,n){var r=!1;if(typeof this.layout=="function"&&this._kvo_dependents){var i=this._kvo_dependents[e];i&&i.indexOf("layout")!=-1&&(r=!0)}(e==="layout"||r)&&this.layoutDidChange(),arguments
.callee.base.apply(this,arguments)},adjust:function(e,t){var n=this.get("layout"),r=NO,i,s;if(e===undefined)return this;if(SC.typeOf(e)===SC.T_STRING){i=n[e];if(t===undefined||i==t)return this;n=SC.clone(n),t===null?delete n[e]:n[e]=t,r=YES}else{s=e;for(e in s){if(!s.hasOwnProperty(e))continue;t=s[e],i=n[e];if(t===undefined||i==t)continue;r||(n=SC.clone(n)),t===null?delete n[e]:n[e]=t,r=YES}}return r&&this.set("layout",n),this},layout:{top:0,left:0,bottom:0,right:0},isFixedLayout:function(){return this.get("isFixedPosition")&&this.get("isFixedSize")}.property("isFixedPosition","isFixedSize").cacheable(),isFixedPosition:function(){var e=this.get("layout"),t,n=e.left,r=e.top;return t=n!==undefined&&r!==undefined&&n!==SC.LAYOUT_AUTO&&r!==SC.LAYOUT_AUTO,t&&(t=!SC.isPercentage(r)&&!SC.isPercentage(n)),t}.property("layout").cacheable(),isFixedSize:function(){var e=this.get("layout"),t,n=e.width,r=e.height;return t=n!==undefined&&r!==undefined&&n!==SC.LAYOUT_AUTO&&r!==SC.LAYOUT_AUTO,t&&(t=!SC.isPercentage(n)&&!SC.isPercentage(r)),t}.property("layout").cacheable(),convertFrameToView:function(e,t){var n=0,r=0,i=0,s=0,o=this,u;while(o)u=o.get("frame"),n+=u.x,r+=u.y,o=o.get("layoutView");if(t){o=t;while(o)u=o.get("frame"),i+=u.x,s+=u.y,o=o.get("layoutView")}return n=e.x+n-i,r=e.y+r-s,{x:n,y:r,width:e.width,height:e.height}},convertFrameFromView:function(e,t){var n=0,r=0,i=0,s=0,o=this,u;while(o&&(u=o.get("frame")))n+=u.x,r+=u.y,o=o.get("parentView");if(t){o=t;while(o)u=o.get("frame"),i+=u.x,s+=u.y,o=o.get("parentView")}return n=e.x-n+i,r=e.y-r+s,{x:n,y:r,width:e.width,height:e.height}}
,scrollToVisible:function(){var e=this.get("parentView");while(e&&!e.get("isScrollable"))e=e.get("parentView");return e?(e.scrollToVisible(),e.scrollToVisible(this)):NO},_adjustForBorder:function(e,t){var n=(t.borderTop!==undefined?t.borderTop:t.border)||0,r=(t.borderLeft!==undefined?t.borderLeft:t.border)||0,i=(t.borderBottom!==undefined?t.borderBottom:t.border)||0,s=(t.borderRight!==undefined?t.borderRight:t.border)||0;return e.x+=r,e.y+=n,e.width-=r+s,e.height-=n+i,e},computeFrameWithParentFrame:function(e,t){var n,r=this.get("layout");if(this.get("useStaticLayout"))return n=e(),n?this._adjustForBorder(n,r):null;n={};var i,s,o=SC.LAYOUT_AUTO,u=this.get("parentView"),a,f,l=r.right,c=r.left,h=r.top,p=r.bottom,d=r.width,v=r.height,m=r.centerX,g=r.centerY;if(d===o)throw i=SC.Error.desc("%@.layout() cannot use width:auto if staticLayout is disabled".fmt(this),"%@".fmt(this),-1),SC.Logger.error(i.toString()),i;if(v===o)throw i=SC.Error.desc("%@.layout() cannot use height:auto if staticLayout is disabled".fmt(this),"%@".fmt(this),-1),SC.Logger.error(i.toString()),i;t||(t=this.computeParentDimensions(r)),a=t.height,f=t.width,SC.none(c)?SC.none(l)?SC.none(m)?(n.x=0,SC.none(d)?n.width=f:(d===o&&(n.width=o),SC.isPercentage(d)?n.width=d*f:n.width=d||0)):(d===o?n.width=o:SC.isPercentage(d)?n.width=d*f:n.width=d||0,SC.isPercentage(m)?n.x=(f-n.width)/2+m*f:n.x=(f-n.width)/2+m):SC.none(d)?(SC.isPercentage(l)?n.width=f-f*l:n.width=f-l,n.x=0):(d===o?n.width=o:SC.isPercentage(d)?n.width=f*d:n.width=d||0,SC.isPercentage(d)?n.x=f-l*f-n.width:n.x=f-l-n.width):(SC.isPercentage(c)?n.x=f*c:n.x=c,
d!==undefined?d===o?n.width=o:SC.isPercentage(d)?n.width=f*d:n.width=d:(n.width=f-n.x,l&&SC.isPercentage(l)?n.width=n.width-l*f:n.width=n.width-(l||0))),SC.none(h)?SC.none(p)?SC.none(g)?(n.y=0,SC.none(v)?n.height=a:(v===o&&(n.height=o),SC.isPercentage(v)?n.height=v*a:n.height=v||0)):(v===o&&(n.height=o),v&&SC.isPercentage(v)?n.height=v*a:n.height=v||0,SC.isPercentage(g)?n.y=(a-n.height)/2+g*a:n.y=(a-n.height)/2+g):SC.none(v)?(SC.isPercentage(p)?n.height=a-p*a:n.height=a-p,n.y=0):(v===o&&(n.height=o),v&&SC.isPercentage(v)?n.height=v*a:n.height=v||0,SC.isPercentage(p)?n.y=a-p*a-n.height:n.y=a-p-n.height):(SC.isPercentage(h)?n.y=h*a:n.y=h,v!==undefined?v===o?n.height=o:SC.isPercentage(v)?n.height=v*a:n.height=v:p&&SC.isPercentage(p)?n.height=a-n.y-p*a:n.height=a-n.y-(p||0));if(n.height===o||n.width===o)s=this.get("layer"),n.height===o&&(n.height=s?s.clientHeight:0),n.width===o&&(n.width=s?s.clientWidth:0);return n=this._adjustForBorder(n,r),u&&u.isScrollContainer&&(u=u.get("parentView"),n.x-=u.get("horizontalScrollOffset"),n.y-=u.get("verticalScrollOffset")),!SC.none(r.maxHeight)&&n.height>r.maxHeight&&(n.height=r.maxHeight),!SC.none(r.minHeight)&&n.height<r.minHeight&&(n.height=r.minHeight),!SC.none(r.maxWidth)&&n.width>r.maxWidth&&(n.width=r.maxWidth),!SC.none(r.minWidth)&&n.width<r.minWidth&&(n.width=r.minWidth),n.height<0&&(n.height=0),n.width<0&&(n.width=0),n}.enhance(),computeParentDimensions:function(e){var t,n=this.get("parentView"),r=n?n.get("frame"):null;if(r)t={width:r.width,height:r.height};else{var i=e||{};t={width:(i.left||0)+(i.width||0)+(i.right||0),height:(i.top||0
)+(i.height||0)+(i.bottom||0)}}return t},borderFrame:function(){var e=this.get("layout"),t=this.get("frame"),n=e.border,r=(e.topBorder!==undefined?e.topBorder:e.border)||0,i=(e.rightBorder!==undefined?e.rightBorder:e.border)||0,s=(e.bottomBorder!==undefined?e.bottomBorder:e.border)||0,o=(e.leftBorder!==undefined?e.leftBorder:e.border)||0;return{x:t.x-o,y:t.y-r,width:t.width+o+i,height:t.height+r+s}}.property("frame").cacheable(),parentViewDidResize:function(){var e,t;t=this.useStaticLayout||!this.get("isFixedSize"),e=!this.get("isFixedPosition"),t?this.viewDidResize():e&&this._viewFrameDidChange()},viewDidResize:function(){this._viewFrameDidChange();var e=this.childViews,t,n,r;for(n=0;n<(t=e.length);++n)r=e[n],r.tryToPerform("parentViewDidResize")},_viewFrameDidChange:function(){this.notifyPropertyChange("frame"),this._sc_view_clippingFrameMayHaveChanged()},beginLiveResize:function(){this.willBeginLiveResize&&this.willBeginLiveResize();var e=this.get("childViews"),t=e.length,n,r;for(n=0;n<t;++n)r=e[n],r.beginLiveResize&&r.beginLiveResize();return this},endLiveResize:function(){var e=this.get("childViews"),t=e.length,n,r;for(n=t-1;n>=0;--n)r=e[n],r.endLiveResize&&r.endLiveResize();return this.didEndLiveResize&&this.didEndLiveResize(),this},layoutView:function(){return this.get("parentView")}.property("parentView").cacheable(),layoutDidChange:function(){var e=this._previousLayout,t=this.get("layout"),n=YES,r,i,s,o;SC.none(t.rotate)||SC.none(t.rotateX)&&(t.rotateX=t.rotate,SC.Logger.warn("Please set rotateX instead of rotate")),SC.none(t.rotateX)?delete t.rotate:t.rotate=t.rotateX
;var u=t.animations;u&&(SC.none(u.rotate)||SC.none(u.rotateX)&&(u.rotateX=u.rotate,SC.Logger.warn("Please animate rotateX instead of rotate")),SC.none(u.rotateX)?delete u.rotate:u.rotate=u.rotateX),e&&e!==t&&(r=e.width,r!==undefined&&(s=t.width,r===s&&(i=e.height,e!==undefined&&(o=t.height,i===o&&(n=NO))))),this.beginPropertyChanges(),this.notifyPropertyChange("hasAcceleratedLayer"),this.notifyPropertyChange("layoutStyle"),n?this.viewDidResize():this._viewFrameDidChange(),this.endPropertyChanges();var a=this.get("layoutView");return a&&(a.set("childViewsNeedLayout",YES),a.layoutDidChangeFor(this),a.get("childViewsNeedLayout")&&a.invokeOnce(a.layoutChildViewsIfNeeded)),this._previousLayout=t,this},childViewsNeedLayout:NO,layoutDidChangeFor:function(e){var t=this._needLayoutViews;t||(t=this._needLayoutViews=SC.CoreSet.create()),t.add(e)},layoutChildViewsIfNeeded:function(e){return e||(e=this.get("isVisibleInWindow")),e&&this.get("childViewsNeedLayout")&&(this.set("childViewsNeedLayout",NO),this.layoutChildViews()),this},layoutChildViews:function(){var e=this._needLayoutViews,t=e?e.length:0,n;for(n=0;n<t;++n)e[n].updateLayout();e.clear()},updateLayout:function(){var e=this.get("layer"),t;return e&&(t=this.renderContext(e),this.renderLayout(t,NO),t.update(),this.useStaticLayout&&this.viewDidResize()),e=null,this},renderLayout:function(e,t){var n=this.get("layoutStyleCalculator");n.willRenderAnimations(),e.addStyle(this.get("layoutStyle")),n.didRenderAnimations()},_renderLayerSettings:function(e,t,n){e(t,n),this.renderLayout(t,n)}.enhance(),applyAttributesToContext:function(e,t){
e(t),this.get("useStaticLayout")&&t.addClass("sc-static-layout")}.enhance()}),SC.View.mixin({convertLayoutToAnchoredLayout:function(e,t){var n={top:0,left:0,width:t.width,height:t.height},r=t.width,i=t.height,s=e.right,o=e.left,u=e.top,a=e.bottom,f=e.width,l=e.height,c=e.centerX,h=e.centerY;return SC.none(o)?SC.none(s)?SC.none(c)?SC.none(f)?(n.left=0,n.width=0):(n.left=0,f===SC.LAYOUT_AUTO?n.width=SC.LAYOUT_AUTO:SC.isPercentage(f)?n.width=f*r:n.width=f):(f&&SC.isPercentage(f)?n.width=f*r:n.width=f||0,n.left=(r-n.width)/2,SC.isPercentage(c)?n.left=n.left+c*r:n.left=n.left+c):SC.none(f)?(n.left=0,s&&SC.isPercentage(s)?n.width=r-s*r:n.width=r-(s||0)):f===SC.LAYOUT_AUTO?n.width=SC.LAYOUT_AUTO:(SC.isPercentage(f)?n.width=f*r:n.width=f,SC.isPercentage(s)?n.left=r-(n.width+s):n.left=r-(n.width+s)):(SC.isPercentage(o)?n.left=o*r:n.left=o,f!==undefined?f===SC.LAYOUT_AUTO?n.width=SC.LAYOUT_AUTO:SC.isPercentage(f)?n.width=f*r:n.width=f:s&&SC.isPercentage(s)?n.width=r-n.left-s*r:n.width=r-n.left-(s||0)),e.minWidth!==undefined&&(n.minWidth=e.minWidth),e.maxWidth!==undefined&&(n.maxWidth=e.maxWidth),SC.none(u)?SC.none(a)?SC.none(h)?SC.none(l)?(n.top=0,n.height=0):(n.top=0,l===SC.LAYOUT_AUTO?n.height=SC.LAYOUT_AUTO:SC.isPercentage(l)?n.height=l*i:n.height=l):(l&&SC.isPercentage(l)?n.height=l*i:n.height=l||0,n.top=(i-n.height)/2,SC.isPercentage(h)?n.top=n.top+h*i:n.top=n.top+h):SC.none(l)?(n.top=0,a&&SC.isPercentage(a)?n.height=i-a*i:n.height=i-(a||0)):l===SC.LAYOUT_AUTO?n.height=SC.LAYOUT_AUTO:(SC.isPercentage(l)?n.height=l*i:n.height=l,n.top=i-n.height,SC.isPercentage(a)?n.top=n.top-a*i:n
.top=n.top-a):(SC.isPercentage(u)?n.top=u*i:n.top=u,l!==undefined?l===SC.LAYOUT_AUTO?n.height=SC.LAYOUT_AUTO:SC.isPercentage(l)?n.height=l*i:n.height=l:(n.height=i-n.top,a&&SC.isPercentage(a)?n.height=n.height-a*i:n.height=n.height-(a||0))),e.minHeight!==undefined&&(n.minHeight=e.minHeight),e.maxHeight!==undefined&&(n.maxHeight=e.maxHeight),n}}),SC.View.reopen({_lastLayerId:null,layerIdDidChange:function(){var e=this.get("layer"),t=this.get("layerId"),n=this._lastLayerId;t!==n&&(n&&SC.View.views[n]===this&&delete SC.View.views[n],this._lastLayerId=t,SC.View.views[t]=this,e&&(e.id=t))}.observes("layerId"),parentViewDidChange:function(){return this.recomputeIsVisibleInWindow(),this.resetBuildState(),this.set("layerLocationNeedsUpdate",YES),this.invokeOnce(this.updateLayerLocationIfNeeded),this._invalidatePaneCacheForSelfAndAllChildViews(),this},_invalidatePaneCacheForSelfAndAllChildViews:function(){var e,t=this.get("childViews"),n=t.length,r;this.notifyPropertyChange("pane");for(r=0;r<n;++r)e=t[r],e._invalidatePaneCacheForSelfAndAllChildViews&&e._invalidatePaneCacheForSelfAndAllChildViews()},insertBefore:function(e,t){e.beginPropertyChanges(),e.get("parentView")&&e.removeFromParent(),this.willAddChild&&this.willAddChild(e,t),e.willAddToParent&&e.willAddToParent(this,t),e.set("parentView",this);var n,r=this.get("childViews");return r.needsClone&&this.set(r=[]),n=t?r.indexOf(t):r.length,n<0&&(n=r.length),r.insertAt(n,e),e.parentViewDidChange&&e.parentViewDidChange(),e.layoutDidChange&&e.layoutDidChange(),e.endPropertyChanges(),this.invokeLast(function(){var t=e.get("pane");t&&t.
get("isPaneAttached")&&e._notifyDidAppendToDocument()}),this.didAddChild&&this.didAddChild(e,t),e.didAddToParent&&e.didAddToParent(this,t),this},removeChild:function(e,t){if(!t)return this;if(t.parentView!==this)throw"%@.removeChild(%@) must belong to parent".fmt(this,t);return t.willRemoveFromParent&&t.willRemoveFromParent(),this.willRemoveChild&&this.willRemoveChild(t),e(t),t.parentViewDidChange&&t.parentViewDidChange(),this.didRemoveChild&&this.didRemoveChild(t),t.didRemoveFromParent&&t.didRemoveFromParent(this),this}.enhance(),replaceChild:function(e,t){return e.beginPropertyChanges(),t.beginPropertyChanges(),this.beginPropertyChanges(),this.insertBefore(e,t).removeChild(t),this.endPropertyChanges(),t.endPropertyChanges(),e.endPropertyChanges(),this},replaceAllChildren:function(e){var t=e.get("length"),n;this.beginPropertyChanges(),this.destroyLayer().removeAllChildren();for(n=0;n<t;n++)this.appendChild(e.objectAt(n));return this.replaceLayer(),this.endPropertyChanges(),this},appendChild:function(e){return this.insertBefore(e,null)},buildInChild:function(e){e.willBuildInToView(this),this.appendChild(e),e.buildInToView(this)},buildOutChild:function(e){e.buildOutFromView(this)},buildInDidFinishFor:function(e){},buildOutDidFinishFor:function(e){this.removeChild(e)},isBuildingIn:NO,isBuildingOut:NO,buildIn:function(){this.buildInDidFinish()},buildOut:function(){this.buildOutDidFinish()},resetBuild:function(){},buildOutDidCancel:function(){},buildInDidCancel:function(){},buildInDidFinish:function(){this.isBuildingIn=NO,this._buildingInTo.buildInDidFinishFor(this),this._buildingInTo=
null},buildOutDidFinish:function(){this.isBuildingOut=NO,this._buildingOutFrom.buildOutDidFinishFor(this),this._buildingOutFrom=null},resetBuildState:function(){this.isBuildingIn&&(this.buildInDidCancel(),this.isBuildingIn=NO),this.isBuildingOut&&(this.buildOutDidCancel(),this.isBuildingOut=NO),this.buildingInTo=null,this.buildingOutFrom=null,this.resetBuild()},willBuildInToView:function(e){this.isBuildingOut&&this.buildOutDidCancel()},buildInToView:function(e){if(this.isBuildingIn)return;this._buildingInTo=e,this.isBuildingOut=NO,this.isBuildingIn=YES,this.buildIn()},buildOutFromView:function(e){if(this.isBuildingOut)return;this.isBuildingIn&&this.buildInDidCancel(),this.isBuildingOut=YES,this.isBuildingIn=NO,this._buildingOutFrom=e,this.buildOut()}}),SC.View.reopen({init:function(e){e(),this._lastTheme=this.get("theme"),this._sc_view_lastRenderTheme=this.get("renderTheme")}.enhance(),themeName:null,baseThemeName:null,_sc_view_findThemeInParent:function(e,t,n){if(e){var r;if(t){r=t.find(e,n);if(r)return r}if(!n){r=SC.Theme.find(e);if(r)return r}return t.invisibleSubtheme(e)}return t},findThemeAtPathInParent:function(e,t,n){if(!e)return t;var r=e.split("."),i,s=r.length,o=t;for(i=0;i<s;i++)o=this._sc_view_findThemeInParent(r[i],o,n),n=YES;return o},theme:function(){return this.findThemeAtPathInParent(this.get("themeName"),this.get("baseTheme"))}.property("baseTheme","themeName").cacheable(),_sc_view_themeDidChange:function(){if(this._lastTheme===this.get("theme"))return;this._lastTheme=this.get("theme");var e=this.childViews,t=e.length,n;for(n=0;n<t;n++)e[n].notifyPropertyChange
("baseTheme")}.observes("theme"),baseTheme:function(){var e,t=this.get("baseThemeName");if(t)return this.findThemeAtPathInParent(t,SC.Theme);e=this.get("parentView");var n=e&&e.get("theme");return n||this.findThemeAtPathInParent(SC.defaultTheme,SC.Theme)}.property("baseThemeName","parentView").cacheable(),renderStyle:null,renderTheme:function(){return this.findThemeAtPathInParent(this.get("renderStyle"),this.get("theme"))}.property("theme","renderStyle").cacheable(),_sc_view_renderThemeDidChange:function(){if(this._sc_view_lastRenderTheme===this.get("renderTheme"))return;this._sc_view_lastRenderTheme=this.get("renderTheme"),this.get("layer")&&this.replaceLayer()}.observes("renderTheme"),renderDelegate:function(e,t){t&&(this._setRenderDelegate=t);if(this._setRenderDelegate)return this._setRenderDelegate;var n=this.get("renderDelegateName"),r;if(n){r=this.get("theme")[n];if(!r)throw'%@: Unable to locate render delegate "%@" in theme.'.fmt(this,n);return r}return null}.property("renderDelegateName","renderTheme"),renderDelegateName:null,renderDelegateProxy:function(){return SC.View._RenderDelegateProxy.createForView(this)}.property("renderDelegate").cacheable(),render:function(e,t){var n=this.get("renderDelegate");n&&(t?n.render(this.get("renderDelegateProxy"),e):n.update(this.get("renderDelegateProxy"),e.$()))},applyAttributesToContext:function(e,t){var n=this.get("renderTheme"),r=n.classNames,i,s=r.length;for(i=0;i<s;i++)t.addClass(r[i]);e(t);var o=this.get("renderDelegate");o&&o.className&&t.addClass(o.className)}.enhance(),invokeRenderDelegateMethod:function(e,t){var n=this
.get("renderDelegate");return n?SC.typeOf(n[e])!==SC.T_FUNCTION?undefined:(t=SC.$A(arguments),t.shift(),t.unshift(this.get("renderDelegateProxy")),n[e].apply(n,t)):undefined}}),SC.View._RenderDelegateProxy={isViewRenderDelegateProxy:YES,createForView:function(e){var t=SC.beget(this),n=e.get("displayProperties"),r={};for(var i=0,s=n.length;i<s;i++)r[n[i]]=YES;return r.theme=YES,t._displayPropertiesLookup=r,t.renderState={},t._view=e,t},get:function(e){if(this[e]!==undefined)return this[e];var t="display"+e.capitalize();return this._displayPropertiesLookup[t]?this._view.get(t):this._displayPropertiesLookup[e]?this._view.get(e):undefined},didChangeFor:function(e){var t=arguments.length,n;for(n=1;n<t;n++){var r=arguments[n],i="display"+r.capitalize();if(this._displayPropertiesLookup[i]){if(this._view.didChangeFor(e,i))return YES}else if(this._displayPropertiesLookup[r]&&this._view.didChangeFor(e,r))return YES}return NO}},SC.propertyFromRenderDelegate=function(e,t){return function(n,r){r!==undefined&&(this["_set_rd_"+n]=r);var i=this["_set_rd_"+n];if(i!==undefined)return i;var s=this.get("renderDelegate");if(s&&s.get){var o=this.get("renderDelegateProxy");i=s.getPropertyFor(o,e)}return i!==undefined?i:t}.property("renderDelegate","controlSize").cacheable()},SC.View.reopen({acceptsMultitouch:NO,hasTouch:NO,touchBoundary:{left:50,right:50,top:50,bottom:50},_touchBoundaryFrame:function(){return this.get("parentView").convertFrameToView(this.get("frame"),null)}.property("frame","parentView").cacheable(),touchIsInBoundary:function(e){var t=this.get("_touchBoundaryFrame"),n=0,r=0,i=this
.get("touchBoundary"),s=e.pageX,o=e.pageY;return s<t.x?(s=t.x-s,n=i.left):s>t.x+t.width?(s-=t.x+t.width,n=i.right):(s=0,n=1),o<t.y?(o=t.y-o,r=i.top):o>t.y+t.height?(o-=t.y+t.height,r=i.bottom):(o=0,r=1),s>100||o>100?NO:YES}}),SC.View.reopen({hasVisibility:YES,isVisibleInWindow:NO,recomputeIsVisibleInWindow:function(e){var t=this.get("isVisibleInWindow"),n=this.get("isVisible"),r;n&&(e===undefined&&(r=this.get("parentView"),e=r?r.get("isVisibleInWindow"):NO),n=n&&e);if(t!==n){this.set("isVisibleInWindow",n);var i=this.get("childViews"),s=i.length,o,u;for(o=0;o<s;o++)u=i[o],u&&u.recomputeIsVisibleInWindow&&u.recomputeIsVisibleInWindow(n);n?this.get("childViewsNeedLayout")&&this.invokeOnce(this.layoutChildViewsIfNeeded):this.get("isFirstResponder")&&this.resignFirstResponder()}return this.updateLayerIfNeeded(YES),this},_sc_isVisibleDidChange:function(){this.displayDidChange(),this.recomputeIsVisibleInWindow()}.observes("isVisible")}),SC.MIXED_STATE="__MIXED__",SC.Pane=SC.View.extend(SC.ResponderContext,{isPane:YES,page:null,rootResponder:null,sendEvent:function(e,t,n){var r;n||(n=this.get("firstResponder"));while(n){if(e==="touchStart"){if(t.touchResponder===n){n=null;break}if(!n.get("hasTouch")||n.get("acceptsMultitouch"))if(n.tryToPerform("touchStart",t))break}else if(e==="touchEnd"&&!n.get("acceptsMultitouch")){if(!n.get("hasTouch")&&n.tryToPerform("touchEnd",t))break}else if(n.tryToPerform(e,t))break;n=n===this?null:n.get("nextResponder")}return!n&&(n=this.get("defaultResponder"))?(typeof n===SC.T_STRING&&(n=SC.objectForPropertyPath(n)),n?n=n.tryToPerform(e,t)?n:null:n=null
):!n&&!(n=this.get("defaultResponder"))&&(n=this.tryToPerform(e,t)?this:null),t.mouseHandler||n},nextResponder:function(){return null}.property().cacheable(),firstResponder:null,acceptsKeyPane:YES,isKeyPane:NO,becomeKeyPane:function(){return this.get("isKeyPane")?this:(this.rootResponder&&this.rootResponder.makeKeyPane(this),this)},resignKeyPane:function(){return this.get("isKeyPane")?(this.rootResponder&&this.rootResponder.makeKeyPane(null),this):this},makeFirstResponder:function(e,t,n){t||(t=this);var r=this.get("firstResponder"),i=this.get("isKeyPane");return r===t?this:SC.platform.touch&&t&&t.kindOf(SC.TextFieldView)&&!t.get("focused")?this:(i&&(r&&r.tryToPerform("willLoseKeyResponderTo",t),t&&t.tryToPerform("willBecomeKeyResponderFrom",r)),r&&(r.beginPropertyChanges(),r.set("isKeyResponder",NO)),t&&(t.beginPropertyChanges(),t.set("isKeyResponder",i)),e(t,n),r&&r.endPropertyChanges(),t&&t.endPropertyChanges(),i&&(t&&t.tryToPerform("didBecomeKeyResponderFrom",r),r&&r.tryToPerform("didLoseKeyResponderTo",t)),this)}.enhance(),willLoseKeyPaneTo:function(e){return this._forwardKeyChange(this.get("isKeyPane"),"willLoseKeyResponderTo",e,NO),this},willBecomeKeyPaneFrom:function(e){return this._forwardKeyChange(!this.get("isKeyPane"),"willBecomeKeyResponderFrom",e,YES),this},didBecomeKeyResponderFrom:function(e){},didLoseKeyPaneTo:function(e){var t=this.get("isKeyPane");return this.set("isKeyPane",NO),this._forwardKeyChange(t,"didLoseKeyResponderTo",e),this},didBecomeKeyPaneFrom:function(e){var t=this.get("isKeyPane");return this.set("isKeyPane",YES),this._forwardKeyChange(!t,"didBecomeKeyResponderFrom"
,e,YES),this},isMainPane:NO,focusFrom:function(e){},blurTo:function(e){},blurMainTo:function(e){this.set("isMainPane",NO)},focusMainFrom:function(e){this.set("isMainPane",YES)},append:function(){return this.appendTo(document.body)},remove:function(){if(!this.get("isVisibleInWindow"))return this;if(!this.get("isPaneAttached"))return this;var e=this.get("layer");e&&e.parentNode&&e.parentNode.removeChild(e),e=null,this._removeIntercept(),this.resignKeyPane();var t=this.rootResponder;return this.get("isMainPane")&&t.makeMainPane(null),t.panes.remove(this),this.rootResponder=null,this.set("isPaneAttached",NO),this.parentViewDidChange(),this},insert:function(e){var t=this.get("layer");return t||(t=this.createLayer().get("layer")),e(t),this.get("isPaneAttached")||this.paneDidAttach(),this},appendTo:function(e){return this.insert(function(t){jQuery(e).append(t)})},paneDidAttach:function(){var e=this.rootResponder=SC.RootResponder.responder;return e.panes.add(this),this.set("isPaneAttached",YES),this.recomputeDependentProperties(),this._notifyDidAppendToDocument(),this._invalidateStaticLayoutFrames(),this._addIntercept(),this},recomputeDependentProperties:function(){},isPaneAttached:NO,wantsTouchIntercept:NO,hasTouchIntercept:function(){return this.get("wantsTouchIntercept")&&SC.platform.touch}.property("wantsTouchIntercept").cacheable(),zIndex:0,touchZ:99,_addIntercept:function(){if(this.get("hasTouchIntercept")){var e=document.createElement("div"),t=e.style;t.position="absolute",t.left="0px",t.top="0px",t.right="0px",t.bottom="0px",t.webkitTransform="translateZ(0px)",t.zIndex=this.
get("zIndex")+this.get("touchZ"),e.className="touch-intercept",e.id="touch-intercept-"+SC.guidFor(this),this._touchIntercept=e,document.body.appendChild(e)}},_removeIntercept:function(){this._touchIntercept&&(document.body.removeChild(this._touchIntercept),this._touchIntercept=null)},hideTouchIntercept:function(){this._touchIntercept&&(this._touchIntercept.style.display="none")},showTouchIntercept:function(){this._touchIntercept&&(this._touchIntercept.style.display="block")},recomputeIsVisibleInWindow:function(){var e=this.get("isVisibleInWindow"),t=this.get("isVisible")&&this.get("isPaneAttached");if(e!==t){this.set("isVisibleInWindow",t);var n=this.get("childViews"),r=n.length,i,s;for(i=0;i<r;i++)s=n[i],s.recomputeIsVisibleInWindow&&s.recomputeIsVisibleInWindow(t);t?this.get("childViewsNeedLayout")&&this.invokeOnce(this.layoutChildViewsIfNeeded):this.get("isKeyPane")&&this.resignKeyPane()}return this.updateLayerIfNeeded(YES),this},updateLayerLocation:function(){return this.get("parentView")?arguments.callee.base.apply(this,arguments):this},replaceLayer:function(){var e=this.get("isPaneAttached");this.destroyLayer(),e&&this.invokeLast(this.append)},init:function(){this.hasTouchIntercept===YES&&(SC.Logger.warn("Do not set hasTouchIntercept directly. Use wantsTouchIntercept instead."),this.hasTouchIntercept=SC.platform.touch);var e=!!this.get("layer");arguments.callee.base.apply(this,arguments),e&&this.paneDidAttach()},classNames:["sc-pane"]}),SC.Pane.reopen({performKeyEquivalent:function(e,t){var n=arguments.callee.base.apply(this,arguments);if(!n){var r=this.get("defaultResponder"
);r&&(r.performKeyEquivalent&&(n=r.performKeyEquivalent(e,t)),!n&&r.tryToPerform&&(n=r.tryToPerform(e,t)))}return n},keyDown:function(e){var t;if((e.which===9||SC.browser.mozilla&&e.keyCode===9)&&!this.get("firstResponder")){e.shiftKey?t=this.get("previousValidKeyView"):t=this.get("nextValidKeyView");if(t)return this.makeFirstResponder(t),YES;SC.TABBING_ONLY_INSIDE_DOCUMENT||e.allowDefault()}return NO},_forwardKeyChange:function(e,t,n,r){var i,s,o;e&&(s=this.get("firstResponder"))&&(o=n?n.get("firstResponder"):null,i=this.get("firstResponder"),i&&i[t]&&i[t](o),r!==undefined&&s&&s.set("isKeyResponder",r))}}),SC.Pane.reopen({currentWindowSize:null,computeParentDimensions:function(e){var t={x:0,y:0,width:1e3,height:1e3},n=this.get("layout");document&&document.body&&(t.width=document.body.clientWidth,t.height=document.body.clientHeight);if(n.minHeight||n.minWidth)n.minHeight&&(t.height=Math.max(t.height,n.minHeight)),n.minWidth&&(t.width=Math.max(t.width,n.minWidth));return t},frame:function(){return this.computeFrameWithParentFrame(null)}.property(),enforcesBodyOverflow:NO,windowSizeDidChange:function(e,t){return this.set("currentWindowSize",t),this.setBodyOverflowIfNeeded(),this.parentViewDidResize(),this},setBodyOverflowIfNeeded:function(e){if(!this.get("enforcesBodyOverflow"))return;var t=this.get("layout"),n=this.get("currentWindowSize");if(!t||!n||!n.width||!n.height)return;var r=t.minWidth,i=t.minHeight;if(e===!0||r||i)i&&n.height<i||r&&n.width<r?SC.bodyOverflowArbitrator.requestVisible(this):SC.bodyOverflowArbitrator.requestHidden(this)},paneLayoutDidChange:function(){this
.invokeOnce(this.updateLayout),this.setBodyOverflowIfNeeded()}.observes("layout"),recomputeDependentProperties:function(e){this.set("currentWindowSize",this.rootResponder.computeWindowSize()),e()}.enhance()}),SC.Pane.reopen({prependTo:function(e){return this.insert(function(t){jQuery(e).prepend(t)})},removeFromParent:function(){throw SC.Error.desc("SC.Pane cannot be removed from its parent, since it's the root. Did you mean remove()?")}}),SC.Pane.reopen({recomputeDependentProperties:function(e){this.recomputeIsVisibleInWindow(),e()}.enhance()}),SC.Application=SC.Responder.extend(SC.ResponderContext,{}),SC.BENCHMARK_LOG_READY=YES,SC.mixin({isReady:NO,suppressOnReady:SC.suppressOnReady?YES:NO,suppressMain:SC.suppressMain?YES:NO,ready:function(e,t){var n=SC._readyQueue;return t===undefined?(t=e,e=null):SC.typeOf(t)===SC.T_STRING&&(t=e[t]),SC.isReady?jQuery(document).ready(function(){t.call(e)}):(n||(SC._readyQueue=[]),SC._readyQueue.push(function(){t.call(e)})),this},onReady:{done:function(){if(SC.isReady)return;SC.isReady=!0,SC.RunLoop.begin(),SC.Locale.createCurrentLocale();var e=SC.Locale.currentLanguage.toLowerCase();jQuery("body").addClass(e),jQuery("html").attr("lang",e),jQuery("#loading").remove();var t=SC._readyQueue,n,r;if(t){for(n=0,r=t.length;n<r;n++)t[n].call();SC._readyQueue=null}window.main&&!SC.suppressMain&&SC.mode===SC.APP_MODE&&window.main(),SC.RunLoop.end()}}}),SC.suppressOnReady||(jQuery.event.special.ready._default=SC.onReady.done),SC.APP_MODE="APP_MODE",SC.TEST_MODE="TEST_MODE",SC.mode=SC.APP_MODE,SC.platform=SC.Object.create({scrollbarSize:function(){var e=
document.createElement("DIV"),t;e.innerHTML="<div style='height:1px;'></div>",e.style.cssText="position:absolute;width:100px;height:100px;overflow-y:visible;",t=e.childNodes[0],document.body.appendChild(e);var n=t.innerWidth||t.clientWidth;e.style.overflowY="scroll";var r=t.innerWidth||t.clientWidth;return document.body.removeChild(e),n-r}.property().cacheable(),touch:"createTouch"in document&&(SC.browser.iOS||SC.browser.android||SC.browser.silk),bounceOnScroll:SC.browser.iOS,pinchToZoom:SC.browser.iOS,input:function(e){var t={},n=e.length,r=document.createElement("input"),i,s;for(s=0;s<n;s++)i=e[s],t[i]=i in r;return t}(["autocomplete","readonly","list","size","required","multiple","maxlength","pattern","min","max","step","placeholder"]),standalone:!!navigator.standalone,dpi:BUILD_INFO.stylesDPIUsed,cssPrefix:null,domCSSPrefix:null,simulateTouchEvents:function(){if(this.touch)return;SC.Logger.log("Simulating touch events"),SC.platform.touch=YES,SC.platform.bounceOnScroll=YES,document.body.className=document.body.className+" touch",this._simtouch_counter=1,this.removeEvents(["click","dblclick","mouseout","mouseover","mousewheel"]),this.replaceEvent("mousemove",this._simtouch_mousemove),this.replaceEvent("mousedown",this._simtouch_mousedown),this.replaceEvent("mouseup",this._simtouch_mouseup),SC.platform.windowSizeDeterminesOrientation=YES,SC.device.orientationHandlingShouldChange()},removeEvents:function(e){var t,n=e.length,r;for(t=0;t<n;t++)r=e[t],SC.Event.remove(document,r,SC.RootResponder.responder,SC.RootResponder.responder[r])},replaceEvent:function(e,t){SC.Event.remove
(document,e,SC.RootResponder.responder,SC.RootResponder.responder[e]),SC.Event.add(document,e,this,t)},_simtouch_mousemove:function(e){if(!this._mousedown)return e.altKey&&this._pinchCenter===null?this._pinchCenter={pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY}:!e.altKey&&this._pinchCenter!==null&&(this._pinchCenter=null),NO;var t=this.manufactureTouchEvent(e,"touchmove");return SC.RootResponder.responder.touchmove(t)},_simtouch_mousedown:function(e){this._mousedown=YES;var t=this.manufactureTouchEvent(e,"touchstart");return SC.RootResponder.responder.touchstart(t)},_simtouch_mouseup:function(e){var t=this.manufactureTouchEvent(e,"touchend"),n=SC.RootResponder.responder.touchend(t);return this._mousedown=NO,this._simtouch_counter++,n},manufactureTouchEvent:function(e,t){var n,r,i=this._simtouch_counter;n={type:t,target:e.target,identifier:i,pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY},e.touches=[n];if(e.altKey&&this._pinchCenter!==null){var s=this._pinchCenter.pageX+this._pinchCenter.pageX-e.pageX,o=this._pinchCenter.pageY+this._pinchCenter.pageY-e.pageY,u=this._pinchCenter.screenX+this._pinchCenter.screenX-e.screenX,a=this._pinchCenter.screenY+this._pinchCenter.screenY-e.screenY,f=this._pinchCenter.clientX+this._pinchCenter.clientX-e.clientX,l=this._pinchCenter.clientY+this._pinchCenter.clientY-e.clientY,c=this._simtouch_counter+1;r={type:t,target:e.target,identifier:c,pageX:s,pageY:o,screenX:u,screenY:a,clientX:f,clientY:l},e.touches=[n,r]}return e.changedTouches=
e.touches,e},supportsCSSTransitions:NO,supportsCSSTransforms:NO,understandsCSS3DTransforms:NO,supportsCSS3DTransforms:NO,supportsAcceleratedLayers:NO,supportsHashChange:function(){return"onhashchange"in window&&(document.documentMode===undefined||document.documentMode>7)}(),supportsHistory:function(){return!!window.history&&!!window.history.pushState}(),supportsCanvas:function(){return!!document.createElement("canvas").getContext}(),supportsOrientationChange:"onorientationchange"in window,windowSizeDeterminesOrientation:SC.browser.iOS||!("onorientationchange"in window)}),function(){var e=navigator.userAgent.toLowerCase();/webkit/.test(e)?(SC.platform.cssPrefix="webkit",SC.platform.domCSSPrefix="Webkit"):/opera/.test(e)?(SC.platform.cssPrefix="opera",SC.platform.domCSSPrefix="O"):/msie/.test(e)&&!/opera/.test(e)?(SC.platform.cssPrefix="ms",SC.platform.domCSSPrefix="ms"):/mozilla/.test(e)&&!/(compatible|webkit)/.test(e)&&(SC.platform.cssPrefix="moz",SC.platform.domCSSPrefix="Moz")}(),function(){var e=document.createElement("div"),t=["-moz-","-moz-","-o-","-ms-","-webkit-"],n=["moz","Moz","o","ms","webkit"],r="",i=null,s,o;for(i=0,o=t.length;i<o;i++)s=t[i],r+=s+"transition:all 1s linear;",r+=s+"transform: translate(1px, 1px);",r+=s+"perspective: 500px;";e.style.cssText=r;var u;for(i=0,o=n.length;i<o;i++){u=n[i],e.style[u+"TransitionProperty"]!==undefined&&(SC.platform.supportsCSSTransitions=YES),e.style[u+"Transform"]!==undefined&&(SC.platform.supportsCSSTransforms=YES);if(e.style[u+"Perspective"]!==undefined||e.style[u+"PerspectiveProperty"]!==undefined)SC.platform.understandsCSS3DTransforms=
YES,SC.platform.supportsCSS3DTransforms=YES}try{window.media&&window.media.matchMedium?window.media.matchMedium("(-webkit-transform-3d)")||(SC.platform.supportsCSS3DTransforms=NO):window.styleMedia&&window.styleMedia.matchMedium&&(window.styleMedia.matchMedium("(-webkit-transform-3d)")||(SC.platform.supportsCSS3DTransforms=NO))}catch(a){SC.platform.supportsCSS3DTransforms=NO}SC.platform.supportsCSSTransforms&&SC.platform.cssPrefix==="webkit"&&(SC.platform.supportsAcceleratedLayers=YES)}(),SC.CAPTURE_BACKSPACE_KEY=NO,SC.APP_HAS_NONSC_IFRAME=NO,SC.RootResponder=SC.Object.extend({panes:null,init:function(){arguments.callee.base.apply(this,arguments),this.panes=SC.Set.create(),SC.platform.supportsCSSTransitions&&(this[SC.platform.cssPrefix+"TransitionEnd"]=this.transitionEnd,this.transitionend=this.transitionEnd)},mainPane:null,makeMainPane:function(e){var t=this.get("mainPane");return t===e?this:(this.beginPropertyChanges(),this.get("keyPane")===t&&this.makeKeyPane(e),this.set("mainPane",e),t&&t.blurMainTo(e),e&&e.focusMainFrom(t),this.endPropertyChanges(),this)},menuPane:null,makeMenuPane:function(e){if(e&&!e.get("acceptsMenuPane"))return this;var t=this.get("menuPane");return t===e?this:(this.set("menuPane",e),this)},keyPane:null,previousKeyPanes:[],makeKeyPane:function(e){var t,n,r;if(e){if(!e.get("acceptsKeyPane"))return this;n=this.get("keyPane");if(n===e)return this;n&&(r=this.get("previousKeyPanes"),r.push(n)),t=e}else{n=this.get("keyPane"),r=this.get("previousKeyPanes"),t=null;var i;while(r.length>0){i=r.pop();if(i.get("isPaneAttached")&&i.get("acceptsKeyPane")){t=i;break}
}}if(!t){var s=this.get("mainPane");s&&s.get("acceptsKeyPane")&&(t=s)}return n&&n.willLoseKeyPaneTo(t),t&&t.willBecomeKeyPaneFrom(n),this.set("keyPane",t),t&&t.didBecomeKeyPaneFrom(n),n&&n.didLoseKeyPaneTo(t),this},currentWindowSize:null,computeWindowSize:function(){var e,t,n;return!this._bod||!this._docElement?(t=document.body,n=document.documentElement,this._bod=t,this._docElement=n):(t=this._bod,n=this._docElement),window.innerHeight?e={width:window.innerWidth,height:window.innerHeight}:n&&n.clientHeight?e={width:n.clientWidth,height:n.clientHeight}:t&&(e={width:t.clientWidth,height:t.clientHeight}),e},resize:function(){return this._resize(),YES},_resize:function(){var e=this.computeWindowSize(),t=this.get("currentWindowSize");this.set("currentWindowSize",e),SC.rectsEqual(e,t)||(SC.device.windowSizeDidChange(e),this.panes&&SC.run(function(){this.panes.invoke("windowSizeDidChange",t,e)},this))},hasFocus:NO,focus:function(e){return!this.get("hasFocus")&&document.hasFocus()&&SC.run(function(){SC.$("body").addClass("sc-focus").removeClass("sc-blur");if(!SC.TABBING_ONLY_INSIDE_DOCUMENT&&!SC.browser.isIE8OrLower&&!SC.APP_HAS_NONSC_IFRAME){var e=SC.RootResponder.responder.get("keyPane");if(e){var t=e.get("lastViewFirstResponder");if(t)e.makeFirstResponder(t),e.set("lastViewFirstResponder",null);else{var n=e.get("nextValidKeyView");n&&e.makeFirstResponder(n)}}}this.set("hasFocus",YES)},this),YES},focusin:function(e){this._focusTimeout&&clearTimeout(this._focusTimeout),this.focus(e)},focusout:function(e){var t=this;this._focusTimeout=setTimeout(function(){t.blur(e)},300)},blur:function(
e){if(this.get("hasFocus")&&!document.hasFocus()){SC.$("body").addClass("sc-blur").removeClass("sc-focus");var t=SC.RootResponder.responder.get("keyPane");if(t){var n=t.get("firstResponder");n&&!SC.browser.isIE8OrLower&&!SC.APP_HAS_NONSC_IFRAME&&n.resignFirstResponder(e)}SC.run(function(){this.set("hasFocus",NO)},this)}return YES},dragDidStart:function(e){this._mouseDownView=e,this._drag=e},defaultResponder:null,sendAction:function(e,t,n,r,i,s){return t=this.targetForAction(e,t,n,r,s),t&&t.isResponderContext?!!t.sendAction(e,n,i,s):t&&t.tryToPerform(e,n)},_responderFor:function(e,t,n){var r=e?e.get("defaultResponder"):null;if(e){e=n||e.get("firstResponder")||e;do if(e.respondsTo(t))return e;while(e=e.get("nextResponder"))}return typeof r===SC.T_STRING&&(r=SC.objectForPropertyPath(r)),r?r.isResponderContext?r:r.respondsTo(t)?r:null:null},targetForAction:function(e,t,n,r,i){if(!e||SC.typeOf(e)!==SC.T_STRING)return null;if(t)return SC.typeOf(t)===SC.T_STRING&&(t=SC.objectForPropertyPath(t)||SC.objectForPropertyPath(t,n)),t&&!t.isResponderContext&&(t.respondsTo&&!t.respondsTo(e)?t=null:SC.typeOf(t[e])!==SC.T_FUNCTION&&(t=null)),t;if(r){t=this._responderFor(r,e,i);if(t)return t}var s=this.get("keyPane"),o=this.get("mainPane");return s&&s!==r&&(t=this._responderFor(s,e)),!t&&o&&o!==s&&(t=this._responderFor(o,e)),!t&&(t=this.get("defaultResponder"))&&(SC.typeOf(t)===SC.T_STRING&&(t=SC.objectForPropertyPath(t),t&&this.set("defaultResponder",t)),t&&!t.isResponderContext&&(t.respondsTo&&!t.respondsTo(e)?t=null:SC.typeOf(t[e])!==SC.T_FUNCTION&&(t=null))),t},targetViewForEvent:function(
e){return e.target?SC.$(e.target).view()[0]:null},sendEvent:function(e,t,n){var r,i;return SC.run(function(){n?r=n.get("pane"):r=this.get("menuPane")||this.get("keyPane")||this.get("mainPane"),i=r?r.sendEvent(e,t,n):null},this),i},listenFor:function(e,t,n,r){return n=n?n:this,e.forEach(function(e){var i=n[e];i&&SC.Event.add(t,e,n,i,null,r)},this),t=null,n},setup:function(){this.listenFor(["touchstart","touchmove","touchend","touchcancel"],document),this.listenFor(["keydown","keyup","beforedeactivate","mousedown","mouseup","click","dblclick","mousemove","selectstart","contextmenu","scroll"],document).listenFor(["resize"],window),SC.browser.isIE8OrLower?this.listenFor(["focusin","focusout"],document):this.listenFor(["focus","blur"],window),this.listenFor(["webkitAnimationStart","webkitAnimationIteration","webkitAnimationEnd"],document),SC.platform.supportsCSSTransitions&&this.listenFor(["transitionend",SC.platform.cssPrefix+"TransitionEnd"],document);if(this.keypress)if(SC.CAPTURE_BACKSPACE_KEY&&SC.browser.mozilla){var e=this;document.onkeypress=function(t){return t=SC.Event.normalizeEvent(t),e.keypress.call(e,t)}}else SC.Event.add(document,"keypress",this,this.keypress);["drag","selectstart"].forEach(function(e){var t=this[e];if(t)if(SC.browser.msie){var n=this;document.body["on"+e]=function(e){return t.call(n,SC.Event.normalizeEvent(event||window.event))},SC.Event.add(window,"unload",this,function(){document.body["on"+e]=null})}else SC.Event.add(document,e,this,t)},this);var t="mousewheel";if(SC.browser.mozilla)SC.browser.compareVersion(1,9,1)<0?t="DOMMouseScroll":t="MozMousePixelScroll"
;else if(parseInt(SC.browser.chrome)>=31||parseInt(SC.browser.msie)>=9||parseInt(SC.browser.safari)>=600||SC.browser.isEdge)t="wheel";SC.Event.add(document,t,this,this.mousewheel),this.set("currentWindowSize",this.computeWindowSize());if(SC.browser.mobileSafari){SC.platform&&!SC.platform.touch&&SC.platform.simulateTouchEvents();var n=SC.RunLoop.prototype.endRunLoop,r;r=function(){n&&n.apply(this,arguments);var e=SC.RootResponder.responder._touches,t,r,i,s,o,u=NO;if(e)for(t in e){if(e[t]._rescuedElement)continue;i=r=e[t].target;while(r&&(r=r.parentNode)&&!u)u=r===document.body;if(!u&&i){if(i.parentNode&&i.cloneNode){var a=i.cloneNode(!0);i.parentNode.replaceChild(a,i),i.swapNode=a}var l=SC.touchHoldingPen;l||(l=SC.touchHoldingPen=document.createElement("div"),l.style.display="none",document.body.appendChild(l)),l.appendChild(i),e[t]._rescuedElement=i}}},SC.RunLoop.prototype.endRunLoop=r}},_touchedViews:{},_touches:{},touchesForView:function(e){if(this._touchedViews[SC.guidFor(e)])return this._touchedViews[SC.guidFor(e)].touches},averagedTouchesForView:function(e,t){var n=this.touchesForView(e),r=e._scrr_averagedTouches||(e._scrr_averagedTouches={});if((!n||n.length===0)&&!t)r.x=0,r.y=0,r.d=0,r.touchCount=0;else{var i=this._averagedTouches_touches||(this._averagedTouches_touches=[]),s;i.length=0;if(n){var o;s=n.length;for(o=0;o<s;o++)i.push(n[o])}t&&i.push(t);var u,a,f=0,l=0,c,h,p=0;s=i.length;for(u=0;u<s;u++)a=i[u],f+=a.pageX,l+=a.pageY;f/=s,l/=s;for(u=0;u<s;u++)a=i[u],c=Math.abs(a.pageX-f),h=Math.abs(a.pageY-l),p+=Math.pow(c*c+h*h,.5);p/=s,r.x=f,r.y=l,r.d=p,r.touchCount=s}return r
},assignTouch:function(e,t){if(e.hasEnded)throw"Attemt to assign a touch that is already finished.";if(e.view===t)return;e.view&&this.unassignTouch(e),this._touchedViews[SC.guidFor(t)]||(this._touchedViews[SC.guidFor(t)]={view:t,touches:SC.CoreSet.create([]),touchCount:0},t.set("hasTouch",YES)),e.view=t,this._touchedViews[SC.guidFor(t)].touches.add(e),this._touchedViews[SC.guidFor(t)].touchCount++},unassignTouch:function(e){var t,n;if(!e.view)return;t=e.view,n=this._touchedViews[SC.guidFor(t)],n.touches.remove(e),n.touchCount--,n.touchCount<1&&(t.set("hasTouch",NO),n.view=null,delete this._touchedViews[SC.guidFor(t)]),e.view=undefined},_flushQueuedTouchResponder:function(){if(this._queuedTouchResponder){var e=this._queuedTouchResponder;this._queuedTouchResponder=null,this.makeTouchResponder.apply(this,e)}},makeTouchResponder:function(e,t,n,r){if(this._isMakingTouchResponder){this._queuedTouchResponder=[e,t,n,r];return}this._isMakingTouchResponder=YES;var i=e.touchResponders,s;if(e.touchResponder===t){this._isMakingTouchResponder=NO,this._flushQueuedTouchResponder();return}var o;t?o=t.get("pane"):o=this.get("keyPane")||this.get("mainPane");if(i.indexOf(t)<0)if(r)try{t=o?o.sendEvent("touchStart",e,t):null}catch(u){SC.Logger.error("Error in touchStart: "+u),t=null}else t&&((t.get?t.get("acceptsMultitouch"):t.acceptsMultitouch)||!t.hasTouch)&&(t.touchStart(e)||(t=null));if(!n||i.indexOf(t)>-1&&i[i.length-1]!==t){this.unassignTouch(e);var a=i.length-1,f=i[a];while(f&&f!==t)s=this.touchesForView(f),((f.get?f.get("acceptsMultitouch"):f.acceptsMultitouch)||!s)&&f.touchCancelled&&f.touchCancelled
(e),a--,f=i[a],i.pop(),e.touchResponder=i[a],e.nextTouchResponder=i[a-1]}t&&(this.assignTouch(e,t),t!==e.touchResponder&&(i.push(t),e.touchResponder=t,e.nextTouchResponder=i[i.length-2])),this._isMakingTouchResponder=NO,this._flushQueuedTouchResponder()},captureTouch:function(e,t,n){t||(t=this);var r=e.targetView,i=r,s=[],o,u;SC.LOG_TOUCH_EVENTS&&SC.Logger.info("  -- Received one touch on %@".fmt(r.toString()));while(i&&i!==t)s.unshift(i),i=i.get("nextResponder");for(u=s.length,o=0;o<u;o++){i=s[o],SC.LOG_TOUCH_EVENTS&&SC.Logger.info("  -- Checking %@ for captureTouch response…".fmt(i.toString()));if(i.tryToPerform("captureTouch",e)){SC.LOG_TOUCH_EVENTS&&SC.Logger.info("   -- Making %@ touch responder because it returns YES to captureTouch".fmt(i.toString())),this.makeTouchResponder(e,i,n,YES);return}}SC.LOG_TOUCH_EVENTS&&SC.Logger.info("   -- Didn't find a view that returned YES to captureTouch, so we're calling touchStart"),this.makeTouchResponder(e,r,n,YES)},endMissingTouches:function(e){var t,n=e.length,r={},i=[];for(t=0;t<n;t++)r[e[t].identifier]=YES;for(t in this._touches){var s=this._touches[t].identifier;r[s]||i.push(this._touches[t])}for(t=0,n=i.length;t<n;t++)this.endTouch(i[t]),this.finishTouch(i[t])},_touchCount:0,endTouch:function(e,t,n){t||(t="touchEnd");var r,i,s,o;this.unassignTouch(e);if(e.touchResponder){o=e.touchResponder,i=e.touchResponders,r=i.length-1,s=i[r];while(s){s[t]&&s[t](e,n);if(e.touchResponder!==o)break;r--,s=i[r],t="touchCancelled"}}},finishTouch:function(e){var t;this.unassignTouch(e);if(t=e._rescuedElement)t.swapNode&&t.swapNode.parentNode?t.
swapNode.parentNode.replaceChild(t,t.swapNode):t.parentNode===SC.touchHoldingPen&&SC.touchHoldingPen.removeChild(t),delete e._rescuedElement,t.swapNode=null,t=null;e.touchResponders=null,e.touchResponder=null,e.nextTouchResponder=null,e.hasEnded=YES,this._touches[e.identifier]&&delete this._touches[e.identifier]},touchstart:function(e){if(this.ignoreTouchHandle(e))return YES;var t=NO;return SC.run(function(){this.endMissingTouches(e.touches);var n,r=e.changedTouches,i=r.length,s,o,u,a;e.touchContext=this;for(n=0;n<i;n++){u=r[n],a=SC.Touch.create(u,this);if(!a.targetView)continue;a.hidesTouchIntercept&&(t=YES),a.timeStamp=e.timeStamp,this._touches[u.identifier]=a,a.event=e,this.captureTouch(a,this),a.event=null}},this),t?YES:e.hasCustomEventHandling},touchmove:function(e){return this.ignoreTouchHandle(e)?YES:(SC.run(function(){var t=e.changedTouches,n,r,i,s=t.length,o,u,a,f,l={},c,h,p=NO;this._drag&&(n=SC.Touch.create(e.changedTouches[0],this),this._drag.tryToPerform("mouseDragged",n));for(i=0;i<s;i++){n=t[i],r=this._touches[n.identifier];if(!r)continue;r.hidesTouchIntercept&&(p=YES),r.pageX=n.pageX,r.pageY=n.pageY,r.clientX=n.clientX,r.clientY=n.clientY,r.screenX=n.screenX,r.screenY=n.screenY,r.timeStamp=e.timeStamp,r.event=e,r.touchResponder&&(o=r.touchResponder,h=SC.guidFor(o),l[h]||(l[h]={view:o,touches:[]}),l[h].touches.push(r))}if(p)return e.allowDefault(),YES;for(i in l)o=l[i].view,u=l[i].touches,e.viewChangedTouches=u,a=this.touchesForView(o),f=a.firstObject(),e.pageX=f.pageX,e.pageY=f.pageY,e.clientX=f.clientX,e.clientY=f.clientY,e.screenX=f.screenX,e.screenY=f.screenY
,e.touchContext=this,o.tryToPerform("touchesDragged",e,a);t=e.changedTouches,s=t.length;for(i=0;i<s;i++)n=t[i],r=this._touches[n.identifier],r&&(r.event=null)},this),e.hasCustomEventHandling)},touchend:function(e){var t=NO;return this.ignoreTouchHandle(e)?YES:(SC.run(function(){var n=e.changedTouches,r,i,s,o=n.length,u,a,f=e.isCancel?"touchCancelled":"touchEnd",l,c,h,p;for(s=0;s<o;s++){r=n[s],r.type="touchend",i=this._touches[r.identifier];if(!i)continue;i.timeStamp=e.timeStamp,i.pageX=r.pageX,i.pageY=r.pageY,i.clientX=r.clientX,i.clientY=r.clientY,i.screenX=r.screenX,i.screenY=r.screenY,i.type="touchend",i.event=e,SC.LOG_TOUCH_EVENTS&&SC.Logger.info("-- Received touch end"),i.hidesTouchIntercept&&(i.unhideTouchIntercept(),t=YES),this._drag&&(this._drag.tryToPerform("mouseUp",r),this._drag=null),this.endTouch(i,f,e),this.finishTouch(i)}},this),t?YES:e.hasCustomEventHandling)},touchcancel:function(e){e.isCancel=YES,this.touchend(e)},ignoreTouchHandle:function(e){if(SC.browser.isMobileSafari||SC.browser.android||SC.browser.silk){var t=e.target.tagName;if(t==="INPUT"||t==="A")return e.allowDefault(),YES}return NO},attemptKeyEquivalent:function(e){var t=e.commandCodes()[0],n=null;if(!t)return n;var r=this.get("menuPane"),i=this.get("keyPane"),s=this.get("mainPane");if(r){n=r.performKeyEquivalent(t,e);if(n)return n}if(i){n=i.performKeyEquivalent(t,e);if(n||i.get("isModal"))return n}if(!n&&s&&s!==i){n=s.performKeyEquivalent(t,e);if(n||s.get("isModal"))return n}return n},_lastModifiers:null,_handleModifierChanges:function(e){var t;t=this._lastModifiers=this._lastModifiers||{alt:!1,
ctrl:!1,shift:!1};var n=!1;return e.altKey!==t.alt&&(t.alt=e.altKey,n=!0),e.ctrlKey!==t.ctrl&&(t.ctrl=e.ctrlKey,n=!0),e.shiftKey!==t.shift&&(t.shift=e.shiftKey,n=!0),e.modifiers=t,n?this.sendEvent("flagsChanged",e)?e.hasCustomEventHandling:YES:YES},_isModifierKey:function(e){return!!SC.MODIFIER_KEYS[e.charCode]},keydown:function(e){if(SC.none(e))return YES;var t=e.keyCode;this._lastKeyDownKeyCodeForKeyPress=t,SC.browser.mozilla&&e.keyCode===9&&(this.keydownCounter=1);if(t===229)return this._IMEInputON=YES,this.sendEvent("keyDown",e);if(t===27&&this._drag)return this._drag.cancelDrag(),this._drag=null,this._mouseDownView=null,YES;if(SC.browser.mozilla&&e.which===8)return!0;var n=this._handleModifierChanges(e),r=e.target||e.srcElement,i=e.which===8&&!SC.allowsBackspaceToPreviousPage&&r===document.body;if(this._isModifierKey(e))return i?NO:n;n=YES;if(SC.isFunctionOrNonPrintableKey(e)){if(t>=37&&t<=40&&SC.browser.mozilla)return YES;n=this.sendEvent("keyDown",e),n?(n=e.hasCustomEventHandling,n&&(i=NO)):n=SC.run(function(){return!this.attemptKeyEquivalent(e)},this)}return i?NO:n},keypress:function(e){var t,n=e.keyCode,r=!!SC.browser.mozilla;e.keyCode=e.which=this._lastKeyDownKeyCodeForKeyPress;if(SC.browser.mozilla&&e.keyCode===9){this.keydownCounter++;if(this.keydownCounter==2)return YES}if(r&&e.which===8)return t=this.sendEvent("keyDown",e)||!this.attemptKeyEquivalent(e),t?SC.allowsBackspaceToPreviousPage||e.hasCustomEventHandling:YES;var i=n>=37&&n<=40&&r,s=e.charCode;if(s!==undefined&&s===0&&e.keyCode!==9&&!i)return YES;if(i||!SC.isFunctionOrNonPrintableKey(e))t=this.sendEvent
("keyDown",e),t?t=e.hasCustomEventHandling:t=!this.attemptKeyEquivalent(e);return t},keyup:function(e){this._lastKeyDownKeyCodeForKeyPress=null,this._ffevt&&(this._ffevt=null);var t=this._handleModifierChanges(e);return this._isModifierKey(e)?t:(this._IMEInputON&&e.keyCode===13&&(e.isIMEInput=YES,this.sendEvent("keyDown",e),this._IMEInputON=NO),this.sendEvent("keyUp",e)?e.hasCustomEventHandling:YES)},beforedeactivate:function(e){var t=e.toElement;if(t&&t.tagName&&t.tagName!=="IFRAME"){var n=SC.$(t).view()[0];if(n&&n.get("blocksIEDeactivate"))return NO}return YES},mousedown:function(e){if(SC.platform.touch)return e.allowDefault(),this._lastMouseDownCustomHandling=YES,YES;if(e.target&&e.target.tagName==="HTML")return YES;this._clickCount+=1;if(!this._lastMouseUpAt||SC.getCurrentTimeForPerformance()-this._lastMouseUpAt>250)this._clickCount=1;else{var t=this._lastMouseDownX-e.clientX,n=this._lastMouseDownY-e.clientY,r=Math.sqrt(t*t+n*n);r>8&&(this._clickCount=1)}e.clickCount=this._clickCount,this._lastMouseDownX=e.clientX,this._lastMouseDownY=e.clientY;var i,s=this.targetViewForEvent(e);s&&(i=s.getPath("pane.firstResponder")),i&&i.get("blurOnMouseDown")&&i!==s&&i.resignFirstResponder(e),s=this._mouseDownView=this.sendEvent("mouseDown",e,s),s&&s.respondsTo("mouseDragged")&&(this._mouseCanDrag=YES);var o=s?e.hasCustomEventHandling:YES;return this._lastMouseDownCustomHandling=o,o},mouseup:function(e){var t=NO;if(SC.platform.touch)return e.allowDefault(),this._lastMouseUpCustomHandling=YES,YES;this._drag&&(this._drag.tryToPerform("mouseUp",e),this._drag=null);var n=null,r=this._mouseDownView
,i=this.targetViewForEvent(e);e.clickCount=this._clickCount,r&&(n=this.sendEvent("mouseUp",e,r),!n&&this._clickCount===2&&(n=this.sendEvent("doubleClick",e,r),t=YES),n||(n=this.sendEvent("click",e,r),t=YES)),!n&&!t&&(this._clickCount===2&&(n=this.sendEvent("doubleClick",e,i)),n||(n=this.sendEvent("click",e,i))),this._mouseCanDrag=NO,this._mouseDownView=null,this._lastMouseUpAt=SC.getCurrentTimeForPerformance();var s=n?e.hasCustomEventHandling:YES;return this._lastMouseUpCustomHandling=s,s},click:function(e){return!this._lastMouseUpCustomHandling||!this._lastMouseDownCustomHandling?(e.preventDefault(),e.stopPropagation(),NO):YES},dblclick:function(e){SC.browser.isIE8OrLower&&(this._clickCount=2,this._mouseDownView=this.targetViewForEvent(e),this.mouseup(e))},mousewheel:function(e){var t=this.targetViewForEvent(e),n=this.sendEvent("mouseWheel",e,t);return n?e.hasCustomEventHandling:YES},_lastHovered:null,mousemove:function(e){if(SC.platform.touch)return e.allowDefault(),YES;if(SC.browser.msie&&this._lastMoveX===e.clientX&&this._lastMoveY===e.clientY)return;this._lastMoveX=e.clientX,this._lastMoveY=e.clientY,SC.run(function(){if(this._drag)SC.browser.msie?(this._lastMouseDownX!==e.clientX||this._lastMouseDownY!==e.clientY)&&this._drag.tryToPerform("mouseDragged",e):this._drag.tryToPerform("mouseDragged",e);else{var t=this._lastHovered||[],n=[],r,i,s,o=this.targetViewForEvent(e);while(o&&o!==this)n.push(o),o=o.get("nextResponder");for(i=0,s=t.length;i<s;i++)o=t[i],r=o.respondsTo("mouseExited"),r&&n.indexOf(o)===-1&&o.tryToPerform("mouseExited",e);for(i=0,s=n.length;i<s;i++)o=n[i
],t.indexOf(o)!==-1?o.tryToPerform("mouseMoved",e):o.tryToPerform("mouseEntered",e);this._lastHovered=n,this._mouseDownView&&(SC.browser.msie?this._lastMouseDownX!==e.clientX&&this._lastMouseDownY!==e.clientY&&this._mouseDownView.tryToPerform("mouseDragged",e):this._mouseDownView.tryToPerform("mouseDragged",e))}},this)},_mouseCanDrag:YES,selectstart:function(e){var t=this.targetViewForEvent(e),n=this.sendEvent("selectStart",e,t);return t&&t.respondsTo("mouseDragged")?(n!==null?YES:NO)&&!this._mouseCanDrag:n!==null?YES:NO},drag:function(){return!1},contextmenu:function(e){var t=this.targetViewForEvent(e);return this.sendEvent("contextMenu",e,t)?NO:YES},scroll:function(e){var t=this.targetViewForEvent(e);return this.sendEvent("scroll",e,t)?NO:YES},webkitAnimationStart:function(e){var t;try{t=this.targetViewForEvent(e),this.sendEvent("animationDidStart",e,t)}catch(n){throw SC.Logger.warn("Exception during animationDidStart: %@".fmt(n)),n}return t?e.hasCustomEventHandling:YES},webkitAnimationIteration:function(e){var t;try{t=this.targetViewForEvent(e),this.sendEvent("animationDidIterate",e,t)}catch(n){throw SC.Logger.warn("Exception during animationDidIterate: %@".fmt(n)),n}return t?e.hasCustomEventHandling:YES},webkitAnimationEnd:function(e){var t;try{t=this.targetViewForEvent(e),this.sendEvent("animationDidEnd",e,t)}catch(n){throw SC.Logger.warn("Exception during animationDidEnd: %@".fmt(n)),n}return t?e.hasCustomEventHandling:YES},transitionEnd:function(e){var t;try{t=this.targetViewForEvent(e),this.sendEvent("transitionDidEnd",e,t)}catch(n){throw SC.Logger.warn("Exception during transitionDidEnd: %@"
.fmt(n)),n}return t?e.hasCustomEventHandling:YES}}),SC.Touch=function(e,t){this.touchContext=t,this.identifier=e.identifier;var n=e.target,r;n&&SC.$(n).hasClass("touch-intercept")?(e.target.style.webkitTransform="translate3d(0px,-5000px,0px)",n=document.elementFromPoint(e.pageX,e.pageY),n&&(r=SC.$(n).view()[0]),this.hidesTouchIntercept=NO,n.tagName==="INPUT"?this.hidesTouchIntercept=e.target:e.target.style.webkitTransform="translate3d(0px,0px,0px)"):r=e.target?SC.$(e.target).view()[0]:null,this.targetView=r,this.target=n,this.hasEnded=NO,this.type=e.type,this.clickCount=1,this.view=undefined,this.touchResponder=this.nextTouchResponder=undefined,this.touchResponders=[],this.startX=this.pageX=e.pageX,this.startY=this.pageY=e.pageY,this.clientX=e.clientX,this.clientY=e.clientY,this.screenX=e.screenX,this.screenY=e.screenY},SC.Touch.prototype={unhideTouchIntercept:function(){var e=this.hidesTouchIntercept;e&&setTimeout(function(){e.style.webkitTransform="translate3d(0px,0px,0px)"},500)},allowDefault:function(){this.event&&(this.event.hasCustomEventHandling=YES)},preventDefault:function(){this.event&&this.event.preventDefault()},stopPropagation:function(){this.event&&this.event.stopPropagation()},stop:function(){this.event&&this.event.stop()},end:function(){this.touchContext.endTouch(this)},makeTouchResponder:function(e,t,n){this.touchContext.makeTouchResponder(this,e,t,n)},captureTouch:function(e,t){this.touchContext.captureTouch(this,e,t)},touchesForView:function(e){return this.touchContext.touchesForView(e)},touchesForResponder:function(e){return this.touchContext.touchesForView
(e)},averagedTouchesForView:function(e,t){return this.touchContext.averagedTouchesForView(e,t?this:null)}},SC.mixin(SC.Touch,{create:function(e,t){return new SC.Touch(e,t)}}),SC.ready(SC.RootResponder,SC.RootResponder.ready=function(){var e;e=SC.RootResponder.responder=SC.RootResponder.create(),e.setup();if(window.addEventListener){var t={target:null};window.addEventListener("focus",function(){SC.run(function(){t.target=document.activeElement;var n=e.targetViewForEvent(t);while(n&&!n.get("acceptsFirstResponder"))n=n.get("parentView");return n&&n.get("focusEventMakesFirstResponder")&&n.becomeFirstResponder(),YES})},!0)}}),SC.PORTRAIT_ORIENTATION="portrait",SC.LANDSCAPE_ORIENTATION="landscape",SC.NO_ORIENTATION="desktop",SC.device=SC.Object.create({orientation:SC.NO_ORIENTATION,isOffline:NO,mouseLocation:function(){var e=SC.RootResponder.responder,t=e._lastMoveX,n=e._lastMoveY;return SC.empty(t)||SC.empty(n)?null:{x:t,y:n}}.property(),init:function(){arguments.callee.base.apply(this,arguments),navigator&&navigator.onLine===!1&&this.set("isOffline",YES)},setup:function(){var e=SC.RootResponder.responder;e.listenFor(["online","offline"],window,this),this.orientationHandlingShouldChange()},orientationHandlingShouldChange:function(){SC.platform.windowSizeDeterminesOrientation?(SC.Event.remove(window,"orientationchange",this,this.orientationchange),this.windowSizeDidChange(SC.RootResponder.responder.get("currentWindowSize"))):SC.platform.supportsOrientationChange&&(SC.Event.add(window,"orientationchange",this,this.orientationchange),this.orientationchange())},windowSizeDidChange:function(
e){return SC.platform.windowSizeDeterminesOrientation?(SC.browser.iOS?SC.run(function(){e.width===window.screen.width?SC.device.set("orientation",SC.PORTRAIT_ORIENTATION):SC.device.set("orientation",SC.LANDSCAPE_ORIENTATION)}):SC.run(function(){SC.platform.touch?e.height>=e.width?SC.device.set("orientation",SC.PORTRAIT_ORIENTATION):SC.device.set("orientation",SC.LANDSCAPE_ORIENTATION):SC.device.set("orientation",SC.NO_ORIENTATION)}),YES):NO},orientationchange:function(e){SC.run(function(){window.orientation===0||window.orientation===180?SC.device.set("orientation",SC.PORTRAIT_ORIENTATION):SC.device.set("orientation",SC.LANDSCAPE_ORIENTATION)})},orientationObserver:function(){var e=SC.$(document.body),t=this.get("orientation");t===SC.PORTRAIT_ORIENTATION?e.addClass("portrait"):e.removeClass("portrait"),t===SC.LANDSCAPE_ORIENTATION?e.addClass("landscape"):e.removeClass("landscape")}.observes("orientation"),online:function(e){this.set("isOffline",NO)},offline:function(e){this.set("isOffline",YES)}}),SC.ready(function(){SC.device.setup()}),SC.Page=SC.Object.extend({owner:null,get:function(e){var t=this[e];return t&&t.isClass?(this[e]=t=t.create({page:this}),t.awake(),t):arguments.callee.base.apply(this,arguments)},awake:function(){var e,t;for(t in this){if(!this.hasOwnProperty(t))continue;e=this[t],e&&e.isViewClass&&(this[t]=e=e.create({page:this}))}return this},getIfConfigured:function(e){var t=this[e];return t&&t.isViewClass?null:this.get(e)}}),SC.Page.design=SC.Page.create,SC.Page.localization=function(e){return e},SC.MODE_REPLACE="replace",SC.MODE_APPEND="append",SC.MODE_PREPEND="prepend"
,SC.NON_PIXEL_PROPERTIES=["zIndex","fontWeight","opacity"],SC.COMBO_STYLES={WebkitTransition:["WebkitTransitionProperty","WebkitTransitionDuration","WebkitTransitionDelay","WebkitTransitionTimingFunction"]},SC.RenderContext=SC.Builder.create({SELF_CLOSING:SC.CoreSet.create().addEach(["area","base","basefront","br","hr","input","img","link","meta"]),init:function(e,t){var n,r;t&&(this.prevObject=t,this.strings=t.strings,this.offset=t.length+t.offset),this.strings||(this.strings=[]),e===undefined?(e="div",r=YES):e==="div"||e==="label"||e==="a"?r=YES:SC.typeOf(e)===SC.T_STRING&&(e=e.toLowerCase(),r=YES);if(r){this._tagName=e,this._needsTag=YES,this.needsContent=YES;var i=this;while(i)i.length++,i=i.prevObject;this.strings.push(null),this._selfClosing=this.SELF_CLOSING.contains(e)}else this._elem=e,this._needsTag=NO,this.length=0,this.needsContent=NO;return this},strings:null,offset:0,length:0,updateMode:SC.MODE_REPLACE,needsContent:NO,get:function(e){var t=this.strings||[];return e===undefined?t.slice(this.offset,this.length):t[e+this.offset]},push:function(e){var t=this.strings,n=arguments.length;t||(this.strings=t=[]),n>1?t.push.apply(t,arguments):t.push(e);var r=this;while(r)r.length+=n,r=r.prevObject;return this.needsContent=YES,this},text:function(e){var t=arguments.length,n=0;for(n=0;n<t;n++)this.push(SC.RenderContext.escapeHTML(arguments[n]));return this},join:function(e){this._needsTag&&this.end();var t=this.strings;return t?t.join(e||""):""},begin:function(e){return SC.RenderContext(e,this)},element:function(){return this._elem?this._elem:SC.$(this.join())[0]},remove:function(
e){if(!e)return;var t,n=this._elem;if(!n||!n.removeChild)return;t=document.getElementById(e),t&&(t=n.removeChild(t),t=null)},update:function(){var e=this._elem,t=this.updateMode,n,r,i,s,o;this._innerHTMLReplaced=NO;if(!e)return;n=this.$();if(this.length>0){this._innerHTMLReplaced=YES;if(t===SC.MODE_REPLACE)n.html(this.join());else{i=e.cloneNode(!1),i.innerHTML=this.join(),s=i.firstChild;while(s)o=s.nextSibling,e.insertBefore(s,o),s=o;s=o=i=null}}return this._idDidChange&&(r=this._id)&&n.attr("id",r),jQuery.Buffer.flush(),e=this._elem=null,this.prevObject||this},_DEFAULT_ATTRS:{},end:function(){var e=this._classNames,t=this._styles,n=this._attrs,r=this._id,i=SC.RenderContext,s="",o="",u,a,f,l,c,h,p;s="<"+this._tagName;if(n||e||t||r){n||(n=this._DEFAULT_ATTRS),r&&(n.id=r),e&&(n["class"]=e.join(" "));if(t){for(f in t){if(!t.hasOwnProperty(f))continue;l=t[f];if(l===null)continue;typeof l===SC.T_NUMBER&&!SC.NON_PIXEL_PROPERTIES.contains(f)&&(l+="px"),o=o+this._dasherizeStyleName(f)+": "+l+"; "}n.style=o}s+=" ";for(f in n){if(!n.hasOwnProperty(f))continue;l=n[f];if(l===null)continue;p=i.escapeAttribute(l),s=s+f+'="'+p+'" '}n===this._DEFAULT_ATTRS&&(delete n.style,delete n["class"],delete n.id)}c=this.strings,h=this._selfClosing===NO?NO:this.length===1,s+=h?" />":">",c[this.offset]=s;if(!h){c.push("</"+this._tagName+">");var d=this;while(d)d.length++,d=d.prevObject}return this._elem=null,this.prevObject||this},tag:function(e,t){return this.begin(e,t).end()},tagName:function(e){return e===undefined?(!this._tagName&&this._elem&&(this._tagName=this._elem.tagName),this._tagName):(this.
_tagName=e,this._tagNameDidChange=YES,this)},id:function(e){return e===undefined?(!this._id&&this._elem&&(this._id=this._elem.id),this._id):(this._id=e,this._idDidChange=YES,this)},classNames:function(e,t){return this._elem?e?(this.$().resetClassNames().addClass(e),this):this.$().attr("class").split(" "):e===undefined?(this._cloneClassNames&&(this._classNames=(this._classNames||[]).slice(),this._cloneClassNames=NO),this._classNames||(this._classNames=[]),this._classNames):(this._classNames=e,this._cloneClassNames=t||NO,this._classNamesDidChange=YES,this)},hasClass:function(e){return this._elem?this.$().hasClass(e):this.classNames().indexOf(e)>=0},addClass:function(e){if(e===undefined||e===null)return SC.Logger.warn("You are adding an undefined or empty class"+this.toString()),this;if(this._elem){if(SC.typeOf(e)===SC.T_STRING)this.$().addClass(e);else{var t,n=e.length;for(t=0;t<n;t++)this.$().addClass(e[t])}return this}var r=this.classNames();if(SC.typeOf(e)===SC.T_STRING)r.indexOf(e)<0&&(r.push(e),this._classNamesDidChange=YES);else{var i;for(var s=0,o=e.length;s<o;s++)i=e[s],r.indexOf(i)<0&&(r.push(i),this._classNamesDidChange=YES)}return this},removeClass:function(e){if(this._elem)return this.$().removeClass(e),this;var t=this._classNames,n;return t&&(n=t.indexOf(e))>=0&&(this._cloneClassNames&&(t=this._classNames=t.slice(),this._cloneClassNames=NO),t[n]=null,this._classNamesDidChange=YES),this},resetClassNames:function(){return this._elem?(this.$().resetClassNames(),this):(this._classNames=[],this._classNamesDidChange=YES,this)},setClass:function(e,t){if(this._elem)return this
.$().setClass(e,t),this;var n,r,i,s;if(t!==undefined)return t?this.addClass(e):this.removeClass(e);n=this._classNames,n||(n=this._classNames=[]),this._cloneClassNames&&(n=this._classNames=n.slice(),this._cloneClassNames=NO),s=NO;for(i in e){if(!e.hasOwnProperty(i))continue;r=n.indexOf(i),e[i]?r<0&&(n.push(i),s=YES):r>=0&&(n[r]=null,s=YES)}return s&&(this._classNamesDidChange=YES),this},_STYLE_REGEX:/-?\s*([^:\s]+)\s*:\s*([^;]+)\s*;?/g,styles:function(e,t){if(this._elem)return e&&this.$().resetStyles().css(e),this.$().styles();var n,r,i;if(e===undefined){if(!this._styles&&this._elem){n=this.$().attr("style");if(n&&(n=n.toString()).length>0){SC.browser.msie&&(n=n.toLowerCase()),e={},r=this._STYLE_REGEX,r.lastIndex=0;while(i=r.exec(n))e[this._camelizeStyleName(i[1])]=i[2];this._styles=e,this._cloneStyles=NO}else this._styles={}}else this._styles?this._cloneStyles&&(this._styles=SC.clone(this._styles),this._cloneStyles=NO):this._styles={};return this._styles}return this._styles=e,this._cloneStyles=t||NO,this._stylesDidChange=YES,this},_deleteComboStyles:function(e,t){var n=SC.COMBO_STYLES[t],r=NO,i;if(n)for(var s=0,o=n.length;s<o;s++)i=n[s],e[i]&&(delete e[i],r=YES);return r},resetStyles:function(){return this.styles({}),this},addStyle:function(e,t){if(this._elem)return this.$().css(e,t),this;var n,r=NO,i=this.styles();if(typeof e===SC.T_STRING){if(t===undefined)return i[e];r=this._deleteComboStyles(i,e),i[e]!==t&&(i[e]=t,r=YES),r&&(this._stylesDidChange=YES)}else{for(n in e){if(!e.hasOwnProperty(n))continue;r=r||this._deleteComboStyles(i,n),t=e[n],i[n]!==t&&(i[n]=t,r=YES)}r&&(this
._stylesDidChange=YES)}return this},removeStyle:function(e){if(this._elem)return this.$().css(e,null),this;if(!this._styles)return this;var t=this.styles();t[e]&&(t[e]=null,this._stylesDidChange=YES)},attr:function(e,t){if(this._elem)return this.$().attr(e,t),this;var n,r=this._attrs,i=NO;r||(this._attrs=r={});if(typeof e===SC.T_STRING){if(t===undefined)return r[e];r[e]!==t&&(r[e]=t,this._attrsDidChange=YES)}else{for(n in e){if(!e.hasOwnProperty(n))continue;t=e[n],r[n]!==t&&(r[n]=t,i=YES)}i&&(this._attrsDidChange=YES)}return this},removeAttr:function(e){if(this._elem)return this.$().removeAttr(e),this},$:function(e){var t,n=this._elem;return t=n?e===undefined?SC.$.buffer(n):SC.$.buffer(e,n):SC.$.buffer([]),n=null,t},_camelizeStyleName:function(e){var t=e.match(/^-(webkit|moz|o)-/),n=SC.String.camelize(e);return t?n.substr(0,1).toUpperCase()+n.substr(1):n},_dasherizeStyleName:function(e){var t=SC.String.dasherize(e);return t.match(/^(webkit|moz|ms|o)-/)&&(t="-"+t),t}}),SC.RenderContext.fn.html=SC.RenderContext.fn.push,SC.RenderContext.fn.css=SC.RenderContext.fn.addStyle,function(){var e=/[&<>]/g,t=function(e){switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;"}},n=/[\/\*\+\^'"%`=, ]/g,r=function(e){switch(e){case'"':return"&quot;";case" ":return"&#32;";case"%":return"&#37;";case"'":return"&#39;";case"*":return"&#42;";case"+":return"&#43;";case",":return"&#44;";case"/":return"&#47;";case"=":return"&#61;";case"^":return"&#94;";case"`":return"&#96;"}};SC.RenderContext.escapeHTML=function(n){return SC.none(n)?"":n.replace(e,t)},SC.RenderContext.escapeAttribute=
function(i){if(SC.none(i))return;return SC.typeOf(i)!==SC.T_STRING&&(i=String(i)),i.replace(e,t).replace(n,r)}}(),SC.SelectionSet=SC.Object.extend(SC.Enumerable,SC.Freezable,SC.Copyable,{isSelectionSet:YES,length:function(){var e=0,t=this._sets,n=this._objects;return n&&(e+=n.get("length")),t&&t.forEach(function(t){e+=t.get("length")}),e}.property().cacheable(),sources:function(){var e=[],t=this._sets,n=t?t.length:0,r,i,s;for(r=0;r<n;r++)i=t[r],i&&i.get("length")>0&&i.source&&e.push(i.source);return e}.property().cacheable(),indexSetForSource:function(e){if(!e||!e.isSCArray)return null;var t=this._indexSetCache,n=this._objects,r,i;return t||(t=this._indexSetCache={}),r=t[SC.guidFor(e)],r&&r._sourceRevision&&r._sourceRevision!==e.propertyRevision&&(r=null),r||(r=this._indexSetForSource(e,NO),r&&r.get("length")===0&&(r=null),n&&(r&&(r=r.copy()),n.forEach(function(t){(i=e.indexOf(t))>=0&&(r||(r=SC.IndexSet.create()),r.add(i))},this)),r&&(r=t[SC.guidFor(e)]=r.frozenCopy(),r._sourceRevision=e.propertyRevision)),r},_indexSetForSource:function(e,t){t===undefined&&(t=YES);var n=SC.guidFor(e),r=this[n],i=this._sets,s=i?i.length:0,o=null;return r>=s&&(r=null),SC.none(r)?t&&!this.isFrozen&&(this.propertyWillChange("sources"),i||(i=this._sets=[]),o=i[s]=SC.IndexSet.create(),o.source=e,this[n]=s,this.propertyDidChange("sources")):o=i?i[r]:null,o},add:function(e,t,n){if(this.isFrozen)throw SC.FROZEN_ERROR;var r,i,s,o,u,a,f,l;if(t===undefined&&n===undefined){if(!e)throw"Must pass params to SC.SelectionSet.add()";if(e.isIndexSet)return this.add(e.source,e);if(e.isSelectionSet){r=e._sets,l=e
._objects,i=r?r.length:0,this.beginPropertyChanges();for(s=0;s<i;s++)o=r[s],o&&o.get("length")>0&&this.add(o.source,o);return l&&this.addObjects(l),this.endPropertyChanges(),this}}return o=this._indexSetForSource(e,YES),u=this.get("length"),f=o.get("length"),a=u-f,o.add(t,n),this._indexSetCache=null,a+=o.get("length"),a!==u&&(this.propertyDidChange("length"),this.enumerableContentDidChange(),f===0&&this.notifyPropertyChange("sources")),this},remove:function(e,t,n){if(this.isFrozen)throw SC.FROZEN_ERROR;var r,i,s,o,u,a,f,l;if(t===undefined&&n===undefined){if(!e)throw"Must pass params to SC.SelectionSet.remove()";if(e.isIndexSet)return this.remove(e.source,e);if(e.isSelectionSet){r=e._sets,l=e._objects,i=r?r.length:0,this.beginPropertyChanges();for(s=0;s<i;s++)o=r[s],o&&o.get("length")>0&&this.remove(o.source,o);return l&&this.removeObjects(l),this.endPropertyChanges(),this}}return o=this._indexSetForSource(e,YES),u=this.get("length"),a=u-o.get("length"),o&&(l=this._objects)&&(n!==undefined&&(t=SC.IndexSet.create(t,n),n=undefined),l.forEach(function(n){s=e.indexOf(n),t.contains(s)&&(l.remove(n),a--)},this)),o.remove(t,n),f=o.get("length"),a+=f,this._indexSetCache=null,a!==u&&(this.propertyDidChange("length"),this.enumerableContentDidChange(),f===0&&this.notifyPropertyChange("sources")),this},contains:function(e,t,n){if(t===undefined&&n===undefined)return this.containsObject(e);var r=this.indexSetForSource(e);return r?r.contains(t,n):NO},intersects:function(e,t,n){var r=this.indexSetForSource(e,NO);return r?r.intersects(t,n):NO},_TMP_ARY:[],addObject:function(e){var t=this._TMP_ARY
,n;return t[0]=e,n=this.addObjects(t),t.length=0,n},addObjects:function(e){var t=this._objects,n,r;return t||(t=this._objects=SC.CoreSet.create()),n=t.get("length"),t.addEach(e),r=t.get("length"),this._indexSetCache=null,r!==n&&(this.propertyDidChange("length"),this.enumerableContentDidChange()),this},removeObject:function(e){var t=this._TMP_ARY,n;return t[0]=e,n=this.removeObjects(t),t.length=0,n},removeObjects:function(e){var t=this._objects,n,r,i;return t?(n=t.get("length"),t.removeEach(e),r=t.get("length"),(i=this._sets)&&i.forEach(function(t){n+=t.get("length"),t.removeObjects(e),r+=t.get("length")},this),this._indexSetCache=null,r!==n&&(this.propertyDidChange("length"),this.enumerableContentDidChange()),this):this},containsObject:function(e){var t=this._objects;if(t&&t.contains(e))return YES;var n=this._sets,r=n?n.length:0,i,s;for(i=0;i<r;i++){s=n[i];if(s&&s.indexOf(e)>=0)return YES}return NO},constrain:function(e){var t,n,r,i;this.beginPropertyChanges(),this.get("sources").forEach(function(t){if(t===e)return;var n=this._indexSetForSource(e,NO);n&&this.remove(e,n)},this),t=this._indexSetForSource(e,NO),t&&(r=t.get("max"))>(n=e.get("length"))&&this.remove(e,n,r-n);if(i=this._objects){var s,o;for(s=i.length-1;s>=0;s--)o=i[s],e.indexOf(o)<0&&this.removeObject(o)}return this.endPropertyChanges(),this},isEqual:function(e){var t,n,r,i,s,o;if(!e||!e.isSelectionSet)return NO;if(e===this)return YES;if(this._sets===e._sets&&this._objects===e._objects)return YES;if(this.get("length")!==e.get("length"))return NO;t=this._objects,n=e._objects;if(t||n){if((t?t.get("length"):0)!==(n?n
.get("length"):0))return NO;if(t&&!t.isEqual(n))return NO}s=this.get("sources"),i=s.get("length");for(r=0;r<i;r++){o=s.objectAt(r),t=this._indexSetForSource(o,NO),n=this._indexSetForSource(o,NO);if(!!n!=!!t)return NO;if(t&&!t.isEqual(n))return NO}return YES},clear:function(){if(this.isFrozen)throw SC.FROZEN_ERROR;return this._sets&&(this._sets.length=0),this._objects&&(this._objects=null),this._indexSetCache=null,this.propertyDidChange("length"),this.enumerableContentDidChange(),this.notifyPropertyChange("sources"),this},copy:function(){var e=this.constructor.create(),t=this._sets,n=t?t.length:0,r,i;if(t&&n>0){t=e._sets=t.slice();for(r=0;r<n;r++){if(!(i=t[r]))continue;i=t[r]=i.copy(),e[SC.guidFor(i.source)]=r}}return this._objects&&(e._objects=this._objects.copy()),e},freeze:function(){if(this.get("isFrozen"))return this;var e=this._sets,t=e?e.length:0,n;while(--t>=0)n=e[t],n&&n.freeze();return this._objects&&this._objects.freeze(),this.set("isFrozen",YES),this},toString:function(){var e=this._sets||[];return e=e.map(function(e){return e.toString().replace("SC.IndexSet",SC.guidFor(e.source))},this),this._objects&&e.push(this._objects.toString()),"SC.SelectionSet:%@<%@>".fmt(SC.guidFor(this),e.join(","))},firstObject:function(){var e=this._sets,t=this._objects;if(e&&e.get("length")>0){var n=e?e[0]:null,r=n?n.source:null,i=n?n.firstObject():-1;if(r&&i>=0)return r.objectAt(i)}return t?t.firstObject():undefined}.property(),nextObject:function(e,t,n){var r,i;return e===0&&(r=n.objects=[],this.forEach(function(e){r.push(e)},this),n.max=r.length),r=n.objects,i=r[e],e+1>=n.max&&(n.objects=
n.max=null),i},forEach:function(e,t){var n=this._sets,r=this._objects,i=n?n.length:0,s,o;for(o=0;o<i;o++)s=n[o],s&&s.forEachObject(e,t);return r&&r.forEach(e,t),this}}),SC.SelectionSet.prototype.clone=SC.SelectionSet.prototype.copy,SC.SelectionSet.EMPTY=SC.SelectionSet.create().freeze(),SC.SparseArray=SC.Object.extend(SC.Observable,SC.Enumerable,SC.Array,SC.DelegateSupport,{_requestingLength:0,_requestingIndex:0,length:function(){var e=this.delegate;return e&&SC.none(this._length)&&e.sparseArrayDidRequestLength&&(this._requestingLength++,e.sparseArrayDidRequestLength(this),this._requestingLength--),this._length||0}.property().cacheable(),provideLength:function(e){var t=this._length;if(e!==t){var n=SC.none(e);e=e||0,t=t||0;var r=Math.min(t,e),i=Math.max(t,e),s=i-e,o=e-r,u=this._requestingLength<=0;u&&this.arrayContentWillChange(r,s,o),this._length=e,n&&(this._sa_content=null),u&&this.arrayContentDidChange(r,s,o)}return this},rangeWindowSize:1,requestedRangeIndex:null,init:function(){arguments.callee.base.apply(this,arguments),this.requestedRangeIndex=[],this._TMP_PROVIDE_ARRAY=[],this._TMP_PROVIDE_RANGE={length:1},this._TMP_RANGE={}},objectAt:function(e,t){var n=this._sa_content,r;return n||(n=this._sa_content=[]),(r=n[e])===undefined&&(t||this.requestIndex(e),r=n[e]),r},definedIndexes:function(e){var t=SC.IndexSet.create(),n=this._sa_content,r,i;if(!n)return t.freeze();if(e)e.forEach(function(e){n[e]!==undefined&&t.add(e)});else{i=n.length;for(r=0;r<i;r++)n[r]!==undefined&&t.add(r)}return t.freeze()},_TMP_RANGE:{},requestIndex:function(e){var t=this.delegate;if(!t)return this
;var n=this.get("rangeWindowSize"),r=e;n>1&&(r-=Math.floor(r%n)),n<1&&(n=1),this._requestingIndex++;if(t.sparseArrayDidRequestRange){var i=this._TMP_RANGE;this.wasRangeRequested(r)===-1&&(i.start=r,i.length=n,this.requestedRangeIndex.push(r),t.sparseArrayDidRequestRange(this,i))}else if(t.sparseArrayDidRequestIndex)while(--n>=0)t.sparseArrayDidRequestIndex(this,r+n);return this._requestingIndex--,this},wasRangeRequested:function(e){var t,n;for(t=0,n=this.requestedRangeIndex.length;t<n;t++)if(this.requestedRangeIndex[t]===e)return t;return-1},rangeRequestCompleted:function(e){var t=this.wasRangeRequested(e);return t>=0?(this.requestedRangeIndex.removeAt(t,1),YES):NO},provideObjectsInRange:function(e,t){var n=this._sa_content;n||(n=this._sa_content=[]);var r=e.start,i=e.length,s=this._requestingIndex<=0;s&&this.arrayContentWillChange(e.start,e.length,e.length);while(--i>=0)n[r+i]=t.objectAt(i);return s&&this.arrayContentDidChange(e.start,e.length,e.length),this},provideObjectAtIndex:function(e,t){var n=this._TMP_PROVIDE_ARRAY,r=this._TMP_PROVIDE_RANGE;return n[0]=t,r.start=e,this.provideObjectsInRange(r,n)},objectsDidChangeInRange:function(e){this.arrayContentWillChange(e.start,e.length,e.length);var t=this._sa_content;if(t)if(e.start===0&&SC.maxRange(e)>=t.length)this._sa_content=null;else{var n=e.start,r=Math.min(n+e.length,t.length);while(--r>=n)t[r]=undefined}return this.arrayContentDidChange(e.start,e.length,e.length),this},indexOf:function(e){var t=this.delegate;if(t&&t.sparseArrayDidRequestIndexOf)return t.sparseArrayDidRequestIndexOf(this,e);var n=this._sa_content;return n||
(n=this._sa_content=[]),n.indexOf(e)},replace:function(e,t,n){n=n||[];var r=this.delegate;if(r)if(!r.sparseArrayShouldReplace||!r.sparseArrayShouldReplace(this,e,t,n))return this;var i=n?n.get?n.get("length"):n.length:0;this.arrayContentWillChange(e,t,i);var s=this._sa_content;s||(s=this._sa_content=[]),s.replace(e,t,n);var o=i-t;return SC.none(this._length)||(this.propertyWillChange("length"),this._length+=o,this.propertyDidChange("length")),this.arrayContentDidChange(e,t,i),this.enumerableContentDidChange(e,t,o),this},reset:function(){var e=this._length;return this.arrayContentWillChange(0,e,0),this._sa_content=null,this._length=null,this.arrayContentDidChange(0,e,0),this.invokeDelegateMethod(this.delegate,"sparseArrayDidReset",this),this}}),SC.SparseArray.array=function(e){return this.create({_length:e||0})},SC.Timer=SC.Object.extend({target:null,action:null,isPooled:NO,interval:0,startTime:null,repeats:NO,until:null,isPaused:NO,isScheduled:NO,isValid:YES,lastFireTime:0,fireTime:function(){if(!this.get("isValid"))return-1;var e=this.get("startTime");if(!e||e===0)return-1;var t=this.get("interval"),n=this.get("lastFireTime");n<e&&(n=e);var r;this.get("repeats")?t===0?r=n:r=e+(Math.floor((n-e)/t)+1)*t:r=e+t;var i=this.get("until");return i&&i>0&&r>i&&(r=i),r}.property("interval","startTime","repeats","until","isValid","lastFireTime").cacheable(),schedule:function(){if(!this.get("isValid"))return this;this.beginPropertyChanges(),this.startTime||this.set("startTime",SC.RunLoop.currentRunLoop.get("startTime"));var e=this.get("fireTime"),t=this.get("lastFireTime");return e>=t&&
(this.set("isScheduled",YES),SC.RunLoop.currentRunLoop.scheduleTimer(this,e)),this.endPropertyChanges(),this},invalidate:function(){this.beginPropertyChanges(),this.set("isValid",NO);var e=SC.RunLoop.currentRunLoop;return e&&e.cancelTimer(this),this.action=this.target=null,this.endPropertyChanges(),this.get("isPooled")&&SC.Timer.returnTimerToPool(this),this},fire:function(){var e=Date.now();this.set("lastFireTime",e);var t=this.get("fireTime");this.get("isPaused")||this.performAction(),t>e?this.schedule():this.invalidate()},performAction:function(){var e=SC.typeOf(this.action);if(e==SC.T_FUNCTION)this.action.call(this.target||this,this);else if(e===SC.T_STRING)if(this.action.indexOf(".")>=0){var t=this.action.split("."),n=t.pop(),r=SC.objectForPropertyPath(t,window),i=r.get?r.get(n):r[n];if(!i||SC.typeOf(i)!=SC.T_FUNCTION)throw"%@: Timer could not find a function at %@".fmt(this,this.action);i.call(r,this)}else SC.RootResponder.responder.sendAction(this.action,this.target,this)},init:function(){arguments.callee.base.apply(this,arguments),this.startTime instanceof Date&&(this.startTime=this.startTime.getTime()),this.until instanceof Date&&(this.until=this.until.getTime())},RESET_DEFAULTS:{target:null,action:null,isPooled:NO,isPaused:NO,isScheduled:NO,isValid:YES,interval:0,repeats:NO,until:null,startTime:null,lastFireTime:0},reset:function(e){e||(e=SC.EMPTY_HASH),this.propertyWillChange("fireTime");var t=this.RESET_DEFAULTS;for(var n in t){if(!t.hasOwnProperty(n))continue;this[n]=SC.none(e[n])?t[n]:e[n]}return this.propertyDidChange("fireTime"),this},removeFromTimerQueue:function(
e){var t=this._timerQueuePrevious,n=this._timerQueueNext;return!t&&!n&&e!==this?e:(t&&(t._timerQueueNext=n),n&&(n._timerQueuePrevious=t),this._timerQueuePrevious=this._timerQueueNext=null,e===this?n:e)},scheduleInTimerQueue:function(e,t){this._timerQueueRunTime=t;var n=e,r=null;while(n&&n._timerQueueRunTime<t)r=n,n=n._timerQueueNext;return r&&(r._timerQueueNext=this,this._timerQueuePrevious=r),n&&(n._timerQueuePrevious=this,this._timerQueueNext=n),n===e?this:e},collectExpiredTimers:function(e,t){if(this._timerQueueRunTime>t)return this;e.push(this);var n=this._timerQueueNext;return this._timerQueueNext=null,n&&(n._timerQueuePrevious=null),n?n.collectExpiredTimers(e,t):null}}),SC.Timer.schedule=function(e){var t;return!e||SC.none(e.isPooled)||e.isPooled?t=this.timerFromPool(e):t=this.create(e),t.schedule()},SC.Timer.timerFromPool=function(e){var t=this._timerPool;t||(t=this._timerPool=[]);var n=t.pop();return n||(n=this.create()),n.reset(e)},SC.Timer.returnTimerToPool=function(e){return this._timerPool||(this._timerPool=[]),this._timerPool.push(e),this},SC.mixin({normalizeURL:function(e){return e.slice(0,1)=="/"?e=window.location.protocol+"//"+window.location.host+e:e.slice(0,5)!="http:"&&e.slice(0,6)!="https:"&&(e=window.location.href+"/"+e),e},isPercentage:function(e){return e<1&&e>0},minX:function(e){return e.x||0},maxX:function(e){return(e.x||0)+(e.width||0)},midX:function(e){return(e.x||0)+(e.width||0)/2},minY:function(e){return e.y||0},maxY:function(e){return(e.y||0)+(e.height||0)},midY:function(e){return(e.y||0)+(e.height||0)/2},centerX:function(e,t){return(t.width-e.width
)/2},centerY:function(e,t){return(t.height-e.height)/2},offset:function(e,t){var n,r,i,s;t=t||"document";if(t==="parent")s=jQuery(e).position();else{s=jQuery(e).offset();if(SC.browser.mobileSafari){n=navigator.userAgent,r=n.indexOf("Mobile/"),i=n.substring(r+7,r+9);if(parseInt(SC.browser.mobileSafari,0)<=532||i<="8A")s.left-=window.pageXOffset,s.top-=window.pageYOffset}if(t==="viewport")if(SC.browser.isIE8OrLower){var o=SC.$(window);s.left-=o.scrollLeft(),s.top-=o.scrollTop()}else s.left-=window.pageXOffset,s.top-=window.pageYOffset}try{s.x=s.left,s.y=s.top}catch(u){s={x:s.left,y:s.top}}return delete s.left,delete s.top,s},viewportOffset:function(e){console.warn("SC.viewportOffset() has been deprecated in favor of SC.offset().  Please use SC.offset() from here on.");var t=SC.offset(e,"viewport");return{x:t.left,y:t.top}},isFunctionOrNonPrintableKey:function(e){return!!(e.altKey||e.ctrlKey||e.metaKey||e.charCode!==e.which&&SC.FUNCTION_KEYS[e.which])}}),SC.mixin({ZERO_POINT:{x:0,y:0},pointInRect:function(e,t){return e.x>=SC.minX(t)&&e.y>=SC.minY(t)&&e.x<=SC.maxX(t)&&e.y<=SC.maxY(t)},rectsEqual:function(e,t,n){return!e||!t?e==t:(!n&&n!==0&&(n=.1),e.y!=t.y&&Math.abs(e.y-t.y)>n?NO:e.x!=t.x&&Math.abs(e.x-t.x)>n?NO:e.width!=t.width&&Math.abs(e.width-t.width)>n?NO:e.height!=t.height&&Math.abs(e.height-t.height)>n?NO:YES)},intersectRects:function(e,t){var n={x:Math.max(SC.minX(e),SC.minX(t)),y:Math.max(SC.minY(e),SC.minY(t)),width:Math.min(SC.maxX(e),SC.maxX(t)),height:Math.min(SC.maxY(e),SC.maxY(t))};return n.width=Math.max(0,n.width-n.x),n.height=Math.max(0,n.height-n.y),n},unionRects
:function(e,t){var n={x:Math.min(SC.minX(e),SC.minX(t)),y:Math.min(SC.minY(e),SC.minY(t)),width:Math.max(SC.maxX(e),SC.maxX(t)),height:Math.max(SC.maxY(e),SC.maxY(t))};return n.width=Math.max(0,n.width-n.x),n.height=Math.max(0,n.height-n.y),n},cloneRect:function(e){return{x:e.x,y:e.y,width:e.width,height:e.height}},stringFromRect:function(e){return e?"{x:"+e.x+", y:"+e.y+", width:"+e.width+", height:"+e.height+"}":"(null)"}}),SC.MainPane=SC.Pane.extend({layout:{top:0,left:0,bottom:0,right:0,minHeight:200,minWidth:200},init:function(){var e={x:0,y:0,width:1e3,height:1e3},t=this.get("layout"),n=!1;if(document&&document.body&&this.get("enforcesBodyOverflow")){e.width=document.body.clientWidth,e.height=document.body.clientHeight;if(t.minHeight||t.minWidth)t.minHeight&&e.height<t.minHeight||t.minWidth&&e.width<t.minWidth?SC.bodyOverflowArbitrator.requestVisible(this):SC.bodyOverflowArbitrator.requestHidden(this)}arguments.callee.base.apply(this,arguments)},paneDidAttach:function(){var e=arguments.callee.base.apply(this,arguments),t=this.rootResponder;return t.makeMainPane(this),t.get("keyRootView")||t.makeKeyPane(this),e},acceptsKeyPane:YES,classNames:["sc-main"],enforcesBodyOverflow:YES}),SC.routes=SC.Object.create({wantsHistory:NO,usesHistory:null,baseURI:document.baseURI,_didSetup:NO,_location:null,_firstRoute:null,_extractParametersAndRoute:function(e){var t={},n=e.route||"",r,i,s,o,u,a;r=n.indexOf("?")<0&&n.indexOf("&")>=0?"&":"?",i=n.split(r),n=i[0],i.length===1?i=[]:i.length===2?i=i[1].split("&"):i.length>2&&i.shift(),o=i.length;for(s=0;s<o;++s)u=i[s].split("="),t[u[0]]=u[1
];for(a in e)e.hasOwnProperty(a)&&a!=="route"&&(t[a]=""+e[a]);i=[];for(a in t)i.push([a,t[a]].join("="));return t.params=r+i.join("&"),t.route=n,t},location:function(e,t){var n,r;if(t!==undefined){t===null&&(t=""),typeof t=="object"&&(n=this._extractParametersAndRoute(t),t=n.route+n.params);if(!SC.empty(t)||this._location&&this._location!==t)r=encodeURI(t),this.usesHistory?(r.length>0&&(r="/"+r),window.history.pushState(null,null,this.get("baseURI")+r)):window.location.hash=r;this._location=t}return this._location}.property(),ping:function(){var e;this._didSetup||(this._didSetup=YES,this.get("wantsHistory")&&SC.platform.supportsHistory?(this.usesHistory=YES,this.popState(),SC.Event.add(window,"popstate",this,this.popState)):(this.usesHistory=NO,SC.platform.supportsHashChange?(this.hashChange(),SC.Event.add(window,"hashchange",this,this.hashChange)):(e=this,this._invokeHashChange=function(){e.hashChange(),setTimeout(e._invokeHashChange,100)},this._invokeHashChange())))},hashChange:function(e){var t=window.location.hash;t=t&&t.length>0?t.slice(1,t.length):"",SC.browser.isMozilla||(t=decodeURI(t)),this.get("location")!==t&&SC.run(function(){this.set("location",t)},this)},popState:function(e){var t=this.get("baseURI"),n=document.location.href;n.slice(0,t.length)===t&&(n=n.slice(t.length+1,n.length),this.get("location")!==n&&SC.run(function(){this.set("location",n)},this))},add:function(e,t,n){return this._didSetup||this.invokeLast(this.ping),n===undefined&&SC.typeOf(t)===SC.T_FUNCTION?(n=t,t=null):SC.typeOf(n)===SC.T_STRING&&(n=t[n]),this._firstRoute||(this._firstRoute=this._Route
.create()),this._firstRoute.add(e.split("/"),t,n),this},locationDidChange:function(){this.trigger()}.observes("location"),trigger:function(){var e=this._firstRoute,t=this.get("location"),n,r;e&&(n=this._extractParametersAndRoute({route:t}),t=n.route,delete n.route,delete n.params,r=e.routeForParts(t.split("/"),n),r&&r.method&&r.method.call(r.target||this,n))},_Route:SC.Object.extend({target:null,method:null,staticRoutes:null,dynamicRoutes:null,wildcardRoutes:null,add:function(e,t,n){var r,i;e=SC.clone(e);if(!e||e.length===0)this.target=t,this.method=n;else{r=e.shift();switch(r.slice(0,1)){case":":r=r.slice(1,r.length),this.dynamicRoutes||(this.dynamicRoutes={}),this.dynamicRoutes[r]||(this.dynamicRoutes[r]=this.constructor.create()),i=this.dynamicRoutes[r];break;case"*":r=r.slice(1,r.length),this.wildcardRoutes||(this.wildcardRoutes={}),i=this.wildcardRoutes[r]=this.constructor.create();break;default:this.staticRoutes||(this.staticRoutes={}),this.staticRoutes[r]||(this.staticRoutes[r]=this.constructor.create()),i=this.staticRoutes[r]}i&&i.add(e,t,n)}},routeForParts:function(e,t){var n,r,i;e=SC.clone(e);if(!e||e.length===0)return this.method?this:null;n=e.shift();if(this.staticRoutes&&this.staticRoutes[n])return this.staticRoutes[n].routeForParts(e,t);for(r in this.dynamicRoutes){i=this.dynamicRoutes[r].routeForParts(e,t);if(i)return t[r]=n,i}for(r in this.wildcardRoutes)return e.unshift(n),t[r]=e.join("/"),this.wildcardRoutes[r].routeForParts(null,t);return null}})}),SC.SCANNER_OUT_OF_BOUNDS_ERROR=new Error("Out of bounds."),SC.SCANNER_INT_ERROR=new Error("Not an int."),SC.SCANNER_SKIP_ERROR=new 
Error("Did not find the string to skip."),SC.SCANNER_SCAN_ARRAY_ERROR=new Error("Did not find any string of the given array to scan."),SC.DATETIME_COMPAREDATE_TIMEZONE_ERROR=new Error("Can't compare the dates of two DateTimes that don't have the same timezone."),SC.DATETIME_ISO8601="%Y-%m-%dT%H:%M:%S%Z",SC.Scanner=SC.Object.extend({string:null,scanLocation:0,scan:function(e){if(this.scanLocation+e>this.length)throw SC.SCANNER_OUT_OF_BOUNDS_ERROR;var t=this.string.substr(this.scanLocation,e);return this.scanLocation+=e,t},scanInt:function(e,t){t===undefined&&(t=e);var n=this.scan(t),r=new RegExp("^\\d{"+e+","+t+"}"),i=n.match(r);if(!i)throw SC.SCANNER_INT_ERROR;return i[0].length<t&&(this.scanLocation+=i[0].length-t),parseInt(i[0],10)},skipString:function(e){if(this.scan(e.length)!==e)throw SC.SCANNER_SKIP_ERROR;return YES},scanArray:function(e){for(var t=0,n=e.length;t<n;t++){if(this.scan(e[t].length)===e[t])return t;this.scanLocation-=e[t].length}throw SC.SCANNER_SCAN_ARRAY_ERROR}}),SC.DateTime=SC.Object.extend(SC.Freezable,SC.Copyable,{_ms:0,timezone:0,isFrozen:YES,adjust:function(e,t){var n;return e=e?SC.clone(e):{},n=e.timezone!==undefined?e.timezone:this.timezone!==undefined?this.timezone:0,this.constructor._adjust(e,this._ms,n,t)._createFromCurrentState()},advance:function(e){return this.constructor._advance(e,this._ms,this.timezone)._createFromCurrentState()},unknownProperty:function(e){return this.constructor._get(e,this._ms,this.timezone)},toFormattedString:function(e){return this.constructor._toFormattedString(e,this._ms,this.timezone)},toISO8601:function(){return this
.constructor._toFormattedString(SC.DATETIME_ISO8601,this._ms,this.timezone)},toString:function(){return"UTC: "+(new Date(this._ms)).toUTCString()+", timezone: "+this.timezone},isEqual:function(e){return SC.DateTime.compare(this,e)===0},copy:function(){return this},toTimezone:function(e){return e===undefined&&(e=0),this.advance({timezone:e-this.timezone})}}),SC.DateTime.mixin(SC.Comparable,{recordFormat:SC.DATETIME_ISO8601,dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],_englishDayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],AMPMNames:["AM","PM"],_date:new Date,_tz:0,timezone:(new Date).getTimezoneOffset(),_dt_cache:{},_dt_cache_index:-1,_DT_CACHE_MAX_LENGTH:1e3,_setCalcState:function(e,t){var n={milliseconds:this._date.getTime(),timezone:this._tz};return e!==undefined&&this._date.setTime(e),t!==undefined&&(this._tz=t),n},_setCalcStateFromHash:function(e,t){var n=t!==undefined?t:this._tz,r=this._toMilliseconds(e,this._ms,n);return this._setCalcState(r,n)},_get:function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v=this._date,m,g=null;m=this._setCalcState(t,n),e==="milliseconds"?g=v.getTime():e==="timezone"&&(g=this._tz);if(g===null){c=e.slice(0,4),h=e.slice(4);if(c==="last"||c==="next"){p=this._get("dayOfWeek",t,n),d=this._englishDayNames.indexOf
(h);if(d>=0){var y=d-p;c==="last"&&y>=0&&(y-=7),c==="next"&&y<0&&(y+=7),this._advance({day:y},t,n),g=this._createFromCurrentState()}}}if(g===null){n!==undefined&&this._setCalcState(v.getTime()-n*6e4,0);switch(e){case"year":g=v.getUTCFullYear();break;case"month":g=v.getUTCMonth()+1;break;case"day":g=v.getUTCDate();break;case"dayOfWeek":g=v.getUTCDay();break;case"hour":g=v.getUTCHours();break;case"minute":g=v.getUTCMinutes();break;case"second":g=v.getUTCSeconds();break;case"millisecond":g=v.getUTCMilliseconds()}g===null&&e==="isLeapYear"&&(u=this._get("year"),g=u%4===0&&u%100!==0||u%400===0);if(g===null&&e==="daysInMonth")switch(this._get("month")){case 4:case 6:case 9:case 11:g=30;break;case 2:g=this._get("isLeapYear")?29:28;break;default:g=31}if(g===null&&e==="dayOfYear"){r=v.getTime(),s=this._get("day"),this._setCalcStateFromHash({day:1});for(o=this._get("month")-1;o>0;o--)this._setCalcStateFromHash({month:o}),s+=this._get("daysInMonth");v.setTime(r),g=s}g===null&&e.slice(0,4)==="week"&&(a=e.length===4?1:parseInt(e.slice("4"),10),f=this._get("dayOfWeek"),l=this._get("dayOfYear")-1,a===0?g=parseInt((l-f+7)/7,10):g=parseInt((l-(f-1+7)%7+7)/7,10))}return this._setCalcState(m.milliseconds,m.timezone),g},_adjust:function(e,t,n,r){var i=e?SC.clone(e):{},s=this._toMilliseconds(e,t,n,r);return this._setCalcState(s,n),this},_advance:function(e,t,n){var r=e?SC.clone(e):{},i;for(var s in r)r[s]+=this._get(s,t,n);return i=r.timezone!==undefined?r.timezone:n,this._adjust(r,t,i,NO)},_toMilliseconds:function(e,t,n,r){var i=e?SC.clone(e):{},s=this._date,o=s.getTime(),u,a;SC.none(t)||s.setTime
(t),a=n!==undefined?n:this.timezone!==undefined?this.timezone:0,s.setTime(s.getTime()-a*6e4);if(r===undefined||r===YES)!SC.none(i.hour)&&SC.none(i.minute)&&(i.minute=0),(!SC.none(i.hour)||!SC.none(i.minute))&&SC.none(i.second)&&(i.second=0),!(SC.none(i.hour)&&SC.none(i.minute)&&SC.none(i.second))&&SC.none(i.millisecond)&&(i.millisecond=0);return SC.none(i.year)&&(i.year=s.getUTCFullYear()),SC.none(i.month)&&(i.month=s.getUTCMonth()+1),SC.none(i.day)&&(i.day=s.getUTCDate()),SC.none(i.hour)&&(i.hour=s.getUTCHours()),SC.none(i.minute)&&(i.minute=s.getUTCMinutes()),SC.none(i.second)&&(i.second=s.getUTCSeconds()),SC.none(i.millisecond)&&(i.millisecond=s.getUTCMilliseconds()),u=Date.UTC(i.year,i.month-1,i.day,i.hour,i.minute,i.second,i.millisecond),s.setTime(u+a*6e4),u=s.getTime(),s.setTime(o),u},create:function(){var e=arguments.length===0?{}:arguments[0],t;SC.typeOf(e)===SC.T_NUMBER&&(e={milliseconds:e}),t=e.timezone!==undefined?e.timezone:this.timezone,t===undefined&&(t=0);if(!SC.none(e.milliseconds)){var n="nu"+e.milliseconds+t,r=this._dt_cache,i=r[n];if(!i){var s,o=this._dt_cache_index,u=this;i=r[n]=new u([{_ms:e.milliseconds,timezone:t}]),o=this._dt_cache_index=(o+1)%this._DT_CACHE_MAX_LENGTH,s=r[o],s!==undefined&&r[s]&&delete r[s],r[o]=n}return i}var a=new Date;return this.create({milliseconds:this._toMilliseconds(e,a.getTime(),t,e.resetCascadingly),timezone:t})},_createFromCurrentState:function(){return this.create({milliseconds:this._date.getTime(),timezone:this._tz})},parse:function(e,t,n){var r=new RegExp("(?:%([aAbBcdDhHiIjmMpsSUWwxXyYZ%])|(.))","g"),i,s,o={},u={},a=SC
.Scanner.create({string:e});SC.none(t)&&(t=SC.DATETIME_ISO8601);try{while((s=r.exec(t))!==null)switch(s[1]){case"a":u.dayOfWeek=a.scanArray(this.abbreviatedDayNames);break;case"A":u.dayOfWeek=a.scanArray(this.dayNames);break;case"b":o.month=a.scanArray(this.abbreviatedMonthNames)+1;break;case"B":o.month=a.scanArray(this.monthNames)+1;break;case"c":throw"%c is not implemented";case"d":case"D":o.day=a.scanInt(1,2);break;case"h":case"H":o.hour=a.scanInt(1,2);break;case"i":case"I":o.hour=a.scanInt(1,2);break;case"j":throw"%j is not implemented";case"m":o.month=a.scanInt(1,2);break;case"M":o.minute=a.scanInt(1,2);break;case"p":o.meridian=a.scanArray(this.AMPMNames);break;case"S":o.second=a.scanInt(1,2);break;case"s":o.millisecond=a.scanInt(1,3);break;case"U":throw"%U is not implemented";case"W":throw"%W is not implemented";case"w":throw"%w is not implemented";case"x":throw"%x is not implemented";case"X":throw"%X is not implemented";case"y":o.year=a.scanInt(2),o.year+=o.year>70?1900:2e3;break;case"Y":o.year=a.scanInt(4);break;case"Z":var f=a.scan(1);if(f==="Z")o.timezone=0;else if(f==="+"||f==="-"){var l=a.scanInt(2);a.scan(1)!==":"&&a.scan(-1);var c=a.scanInt(2);o.timezone=(f==="+"?-1:1)*(l*60+c)}break;case"%":a.skipString("%");break;default:a.skipString(s[0])}}catch(h){return SC.Logger.log("SC.DateTime.createFromString "+h.toString()),null}if(!SC.none(o.meridian)&&!SC.none(o.hour)){if(o.meridian===1&&o.hour!==12||o.meridian===0&&o.hour===12)o.hour=(o.hour+12)%24;delete o.meridian}return i=SC.DateTime.create(o),!SC.none(u.dayOfWeek)&&i.get("dayOfWeek")!==u.dayOfWeek?null:i&&n&&this
._checkOverflow(i,o)?null:i},_pad:function(e,t){var n=""+e;t===undefined&&(t=2);while(n.length<t)n="0"+n;return n},__toFormattedString:function(e,t,n){var r,i;switch(e[1]){case"a":return this.abbreviatedDayNames[this._get("dayOfWeek")];case"A":return this.dayNames[this._get("dayOfWeek")];case"b":return this.abbreviatedMonthNames[this._get("month")-1];case"B":return this.monthNames[this._get("month")-1];case"c":return this._date.toString();case"d":return this._pad(this._get("day"));case"D":return this._get("day");case"h":return this._get("hour");case"H":return this._pad(this._get("hour"));case"i":return r=this._get("hour"),r===12||r===0?12:(r+12)%12;case"I":return r=this._get("hour"),this._pad(r===12||r===0?12:(r+12)%12);case"j":return this._pad(this._get("dayOfYear"),3);case"m":return this._pad(this._get("month"));case"M":return this._pad(this._get("minute"));case"p":return this._get("hour")>11?this.AMPMNames[1]:this.AMPMNames[0];case"S":return this._pad(this._get("second"));case"s":return this._pad(this._get("millisecond"),3);case"u":return this._pad(this._get("utc"));case"U":return this._pad(this._get("week0"));case"W":return this._pad(this._get("week1"));case"w":return this._get("dayOfWeek");case"x":return this._date.toDateString();case"X":return this._date.toTimeString();case"y":return this._pad(this._get("year")%100);case"Y":return this._get("year");case"Z":return i=-1*n,(i>=0?"+":"-")+this._pad(parseInt(Math.abs(i)/60,10))+":"+this._pad(Math.abs(i)%60);case"%":return"%"}},_toFormattedString:function(e,t,n){var r=this,i=n!==undefined?n:this.timezone!==undefined?this.timezone
:0;return this._setCalcState(t-n*6e4,0),e.replace(/\%([aAbBcdDhHiIjmMpsSUWwxXyYZ\%])/g,function(){var e=r.__toFormattedString.call(r,arguments,t,n);return e})},compare:function(e,t){var n=e.get("milliseconds"),r=t.get("milliseconds");return n<r?-1:n===r?0:1},compareDate:function(e,t){if(e.get("timezone")!==t.get("timezone"))throw SC.DATETIME_COMPAREDATE_TIMEZONE_ERROR;var n=e.adjust({hour:0}).get("milliseconds"),r=t.adjust({hour:0}).get("milliseconds");return n<r?-1:n===r?0:1},_checkOverflow:function(e,t){var n=["year","month","day","hour","minute","second","millisecond"];return n.some(function(n){var r=t[n],i=e.get(n);return!SC.none(r)&&r!==i})}}),SC.Binding.dateTime=function(e){return this.transform(function(t,n){return t?t.toFormattedString(e):null})},SC.Response=SC.Object.extend({isResponse:YES,isError:NO,errorValue:function(){return this}.property().cacheable(),errorObject:null,request:null,originalRequest:function(){var e=this.get("request");while(e.get("source"))e=e.get("source");return e}.property("request").cacheable(),type:function(){return this.getPath("request.type")}.property("request").cacheable(),address:function(){return this.getPath("request.address")}.property("request").cacheable(),isJSON:function(){return this.getPath("request.isJSON")||NO}.property("request").cacheable(),isXML:function(){return this.getPath("request.isXML")||NO}.property("request").cacheable(),listeners:function(){return this.getPath("request.listeners")}.property("request").cacheable(),status:-100,headers:null,body:function(){var e=this.get("encodedBody");if(e&&this.get("isJSON"))try{e=
SC.json.decode(e)}catch(t){return SC.error("Failed to parse response: %@",e),SC.Error.create({message:t.name+": "+t.message,label:"Response",errorValue:this})}return e}.property("encodedBody").cacheable(),response:function(){return this.get("body")}.property("body").cacheable(),isCancelled:NO,timedOut:null,timeoutTimer:null,fire:function(){var e=this.get("request"),t=e?e.get("source"):null;t&&t.willSend&&t.willSend(e,this),e.freeze(),this.get("isCancelled")||this.invokeTransport();var n=e.get("timeout");if(n){var r=SC.Timer.schedule({target:this,action:"timeoutReached",interval:n,repeats:NO});this.set("timeoutTimer",r)}!this.get("isCancelled")&&t&&t.didSend&&t.didSend(e,this)},invokeTransport:function(){this.receive(function(e){this.set("status",200)},this)},receive:function(e,t){if(!this.get("timedOut")){var n=this.get("timeoutTimer");n&&n.invalidate(),this.set("timedOut",NO)}var r=this.get("request"),i=r?r.get("source"):null;return SC.run(function(){i&&i.willReceive&&i.willReceive(r,this),e.call(t,!this.get("isCancelled")),!this.get("isCancelled")&&i&&i.didReceive&&i.didReceive(r,this),this.get("isCancelled")||this.notify()},this),SC.Request.manager.transportDidClose(this),this},cancel:function(){this.get("isCancelled")||(this.set("isCancelled",YES),this.cancelTransport(),SC.Request.manager.transportDidClose(this))},timeoutReached:function(){return this.get("timedOut")===null?(this.set("timedOut",YES),this.cancelTransport(),this.receive(function(e){if(!e)return;var t=SC.$error("HTTP Request timed out","Request",0);t.set("errorValue",this),this.set("isError",YES),this.set("errorObject"
,t),this.set("status",0)},this),YES):NO},cancelTransport:function(){},_notifyListeners:function(e,t){var n=e[t],r,i,s;if(!n)return NO;var o=NO,u=n.length;for(var a=0;a<u;a++){var f=n[a];r=(f.params||[]).copy(),r.unshift(this),i=f.target,s=f.action,SC.typeOf(s)===SC.T_STRING&&(s=i[s]),o=s.apply(i,r)}return o},notify:function(){var e=this.get("listeners"),t=this.get("status"),n=Math.floor(t/100)*100,r=NO;return e?(r=this._notifyListeners(e,t),!r&&n!==t&&(r=this._notifyListeners(e,n)),!r&&t!==0&&(r=this._notifyListeners(e,0)),this):this},toString:function(){var e=arguments.callee.base.apply(this,arguments);return"%@<%@ %@, status=%@".fmt(e,this.get("type"),this.get("address"),this.get("status"))}}),SC.XHRResponse=SC.Response.extend({headers:function(){var e=this.get("rawRequest"),t=e?e.getAllResponseHeaders():null,n={};return t?(t.split("\n").forEach(function(e){var t=e.indexOf(":"),r,i;t>=0&&(r=e.slice(0,t),i=e.slice(t+1).trim(),n[r]=i)},this),n):n}.property("status").cacheable(),header:function(e){var t=this.get("rawRequest");return t?t.getResponseHeader(e):null},encodedBody:function(){var e=this.get("rawRequest");return e?this.get("isXML")?e.responseXML:e.responseText:null}.property("status").cacheable(),cancelTransport:function(){var e=this.get("rawRequest");e&&e.abort(),this.set("rawRequest",null)},invokeTransport:function(){var e,t,n,r,i;e=this.createRequest(),this.set("rawRequest",e),r=!!this.getPath("request.isAsynchronous"),r&&(!SC.browser.msie&&!SC.browser.opera?SC.Event.add(e,"readystatechange",this,this.finishRequest,e):(t=this,n=function(){if(!t)return null;var e=t
.finishRequest();return e&&(t=null),e},e.onreadystatechange=n)),e.open(this.get("type"),this.get("address"),r),i=this.getPath("request.headers");for(var s in i)e.setRequestHeader(s,i[s]);return e.send(this.getPath("request.encodedBody")),r||this.finishRequest(),e},createRequest:function(){function e(){for(var e=0;e<arguments.length;e++)try{var t=arguments[e]();return t}catch(n){}return NO}return e(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})},finishRequest:function(e){var t=this.get("rawRequest"),n=t.readyState,r,i,s;return n===4&&!this.get("timedOut")?(this.receive(function(e){if(!e)return;i=-1;try{i=t.status||0}catch(n){}if(i<200||i>=300){try{s=t.statusText||""}catch(o){s=""}r=SC.$error(s||"HTTP Request failed","Request",i),r.set("errorValue",this),this.set("isError",YES),this.set("errorObject",r)}this.set("status",i)},this),!SC.browser.msie&&!SC.browser.opera?SC.Event.remove(t,"readystatechange",this,this.finishRequest):t.onreadystatechange=null,YES):NO}}),SC.Request=SC.Object.extend(SC.Copyable,SC.Freezable,{isAsynchronous:YES,isJSON:NO,isXML:NO,attachIdentifyingHeaders:YES,headers:function(){var e=this._headers;return e||(e=this._headers={}),e}.property().cacheable(),responseClass:SC.XHRResponse,source:null,address:null,type:"GET",timeout:null,body:null,encodedBody:function(){var e=this.get("body");return e&&this.get("isJSON")&&(e=SC.json.encode(e)),e}.property("isJSON","isXML","body").cacheable(),willSend:function(e,t){},didSend:function(e,t){},willReceive:function(
e,t){},didReceive:function(e,t){},concatenatedProperties:"COPY_KEYS",COPY_KEYS:["attachIdentifyingHeaders","isAsynchronous","isJSON","isXML","address","type","timeout","body","responseClass","willSend","didSend","willReceive","didReceive"],copy:function(){var e={},t=this.COPY_KEYS,n=t.length,r,i,s;while(--n>=0)r=t[n],this.hasOwnProperty(r)&&(e[r]=this.get(r));return this.hasOwnProperty("listeners")&&(e.listeners=SC.copy(this.get("listeners"))),this.hasOwnProperty("_headers")&&(e._headers=SC.copy(this._headers)),e.source=this.get("source")||this,this.constructor.create(e)},header:function(e,t){var n;if(SC.typeOf(e)===SC.T_STRING)return n=this._headers,arguments.length===1?n?n[e]:null:(this.propertyWillChange("headers"),n||(n=this._headers={}),n[e]=t,this.propertyDidChange("headers"),this);if(t===undefined){n=e,this.beginPropertyChanges();for(e in n){if(!n.hasOwnProperty(e))continue;this.header(e,n[e])}return this.endPropertyChanges(),this}return this},clearHeaders:function(){this.propertyWillChange("headers"),this._headers={},this.propertyDidChange("headers")},async:function(e){return e===undefined&&(e=YES),this.set("isAsynchronous",e)},timeoutAfter:function(e){return this.set("timeout",e)},json:function(e){return e===undefined&&(e=YES),e&&this.set("isXML",NO),this.set("isJSON",e)},xml:function(e){return e===undefined&&(e=YES),e&&this.set("isJSON",NO),this.set("isXML",e)},_prep:function(){var e=!!this.header("Content-Type");return this.get("attachIdentifyingHeaders")&&(this.header("X-Requested-With","XMLHttpRequest"),this.header("X-SproutCore-Version",SC.VERSION)),this.get("isJSON"
)&&!e?this.header("Content-Type","application/json"):this.get("isXML")&&!e&&this.header("Content-Type","text/xml"),this},send:function(e){var t=this.get("timeout");if(t&&!this.get("isAsynchronous"))throw"Timeout values cannot be used with synchronous requests";if(t===0)throw"The timeout value must either not be specified or must be greater than 0";return e&&this.set("body",e),SC.Request.manager.sendRequest(this.copy()._prep())},resend:function(){var e=this.get("source")?this:this.copy()._prep();return SC.Request.manager.sendRequest(e)},notify:function(e,t,n,r){var i=YES;SC.typeOf(e)!==SC.T_NUMBER?(r=SC.A(arguments).slice(2),n=t,t=e,e=0,i=NO):r=SC.A(arguments).slice(3);var s=this.get("listeners");return s||this.set("listeners",s={}),s[e]||(s[e]=[]),s[e].push({target:t,action:n,params:r}),this}}),SC.Request.mixin({getUrl:function(e){return this.create().set("address",e).set("type","GET")},postUrl:function(e,t){var n=this.create().set("address",e).set("type","POST");return t&&n.set("body",t),n},deleteUrl:function(e){return this.create().set("address",e).set("type","DELETE")},putUrl:function(e,t){var n=this.create().set("address",e).set("type","PUT");return t&&n.set("body",t),n}}),SC.Request.manager=SC.Object.create({maxRequests:6,inflight:[],pending:[],sendRequest:function(e){if(!e)return null;var t=e.get("responseClass").create({request:e});return this.get("pending").pushObject(t),this.fireRequestIfNeeded(),t},cancel:function(e){var t=this.get("pending"),n=this.get("inflight"),r;return t.indexOf(e)>=0?(this.propertyWillChange("pending"),t.removeObject(e),this.propertyDidChange
("pending"),YES):n.indexOf(e)>=0?(e.cancel(),n.removeObject(e),this.fireRequestIfNeeded(),YES):NO},cancelAll:function(){return this.get("pending").length||this.get("inflight").length?(this.set("pending",[]),this.get("inflight").forEach(function(e){e.cancel()}),this.set("inflight",[]),YES):NO},fireRequestIfNeeded:function(){var e=this.get("pending"),t=this.get("inflight"),n=this.get("maxRequests"),r;e.length>0&&t.length<n&&(r=e.shiftObject(),t.pushObject(r),r.fire())},transportDidClose:function(e){this.get("inflight").removeObject(e),this.fireRequestIfNeeded()}}),SC.FOCUS_ALL_CONTROLS=YES,SC.TreeItemContent={isTreeItemContent:YES,treeItemChildren:null,treeItemIsExpanded:YES,treeItemIsGrouped:NO,treeItemDisclosureState:function(e,t){return this.get("treeItemIsExpanded")?SC.BRANCH_OPEN:SC.BRANCH_CLOSED},treeItemCollapse:function(e,t){this.setIfChanged("treeItemIsExpanded",NO)},treeItemExpand:function(e,t){this.setIfChanged("treeItemIsExpanded",YES)},treeItemBranchIndexes:function(e,t){var n=this.get("treeItemChildren"),r,i,s,o;if(!n)return null;r=SC.IndexSet.create(),i=n.get("length");for(s=0;s<i;s++){if(!(o=n.objectAt(s)))continue;if(!o.get("treeItemChildren"))continue;o.treeItemDisclosureState(this,s)!==SC.LEAF_NODE&&r.add(s)}return r.get("length")>0?r:null}},SC.BRANCH_OPEN=17,SC.BRANCH_CLOSED=18,SC.LEAF_NODE=32,SC.CollectionContent={isCollectionContent:YES,contentIndexIsSelected:function(e,t,n){var r=e.get("selection");return r?r.contains(t,n):NO},contentIndexIsEnabled:function(e,t,n){return e.get("isEnabled")},contentGroupIndexes:function(e,t){return null},contentIndexIsGroup
:function(e,t,n){return NO},contentIndexOutlineLevel:function(e,t,n){return-1},contentIndexDisclosureState:function(e,t,n){return SC.LEAF_NODE},contentIndexExpand:function(e,t,n){SC.Logger.log("contentIndexExpand(%@, %@, %@)".fmt(e,t,n))},contentIndexCollapse:function(e,t,n){SC.Logger.log("contentIndexCollapse(%@, %@, %@)".fmt(e,t,n))}},SC.TreeItemObserver=SC.Object.extend(SC.Array,SC.CollectionContent,{item:null,delegate:null,parentObserver:null,parentItem:function(){var e=this.get("parentObserver");return e?e.get("item"):null}.property("parentObserver").cacheable(),index:null,outlineLevel:0,children:null,disclosureState:SC.BRANCH_OPEN,branchIndexes:function(){var e=this.get("item"),t,n,r,i,s;if(!e)return SC.IndexSet.EMPTY;if(e.isTreeItemContent)return n=this.get("parentItem"),r=this.get("index"),e.treeItemBranchIndexes(n,r);i=this.get("children");if(!i)return null;s=SC.IndexSet.create(),t=i.get("length"),n=e;for(r=0;r<t;r++){if(!(e=i.objectAt(r)))continue;if(!this._computeChildren(e,n,r))continue;this._computeDisclosureState(e,n,r)!==SC.LEAF_NODE&&s.add(r)}return s.get("length")>0?s:null}.property("children").cacheable(),isHeaderVisible:function(){return!!this.get("parentObserver")}.property("parentObserver").cacheable(),length:0,objectAt:function(e,t){var n=this.get("length"),r=this.get("item"),i=this._objectAtCache,s=e,o=0,u,a;if(e>=n)return undefined;if(this.get("isHeaderVisible")){if(e===0)return r;s--}return r=null,i||(i=this._objectAtCache=[]),(r=i[e])!==undefined?r:(a=this.get("children"),a?((u=this.get("branchIndexes"))&&u.forEach(function(e){if(r||e>s)return;var n=
this.branchObserverAt(e),i;if(!n)return;i=n.get("length"),e+i>s?(r=n.objectAt(s-e,t),s=-1):s-=i-1},this),s>=0&&(r=a.objectAt(s,t)),i[e]=r,r):undefined)},replace:function(e,t,n,r){var i=e,s=null,o,u,a;r===undefined&&(r=SC.DROP_BEFORE),this.get("isHeaderVisible")&&i--;if(i<0)throw"Tree Item cannot replace itself";(o=this.get("branchIndexes"))&&o.forEach(function(e){if(s||e>=i)return;if(!(s=this.branchObserverAt(e)))return;u=s.get("length"),e+u===i&&r===SC.DROP_AFTER?i-=e:e+u>i?i-=e:(i-=u-1,s=null)},this);if(s)return s.replace(i,t,n,r),this;a=i+t,t>1&&o&&o.forEachIn(i,o.get("max")-i,function(e){if(e>a)return;if(!(s=this.branchObserverAt(e)))return;u=s.get("length"),a-=u-1},this),t=a-i;var f=this.get("children");if(!f)throw"cannot replace() tree item with no children";if(t<0||a>f.get("length"))throw"replace() range must lie within a single tree item";return f.replace(i,t,n,r),this},observerContentDidChange:function(e,t,n){this.invalidateBranchObserversAt(e),this._objectAtCache=this._outlineLevelCache=null,this._disclosureStateCache=null,this._contentGroupIndexes=NO,this.notifyPropertyChange("branchIndexes");var r=this.get("length"),i=this._computeLength(),s=this.get("parentObserver"),o;r!==i&&this.set("length",i);if(!this._notifyParent)return this;if(s)o=SC.IndexSet.create(this.get("index")),s._childrenRangeDidChange(s.get("children"),null,"[]",o);else{r===i?(t=this.expandChildIndex(e+t),e=this.expandChildIndex(e),t-=e,n=0):(e=this.expandChildIndex(e),t=i-e,n=i-r);var u=t,a=n+u;this.arrayContentDidChange(e,u,a)}},expandChildIndex:function(e){var t=e;this.get("isHeaderVisible")&&
e++;var n=this.get("branchIndexes");return!n||n.get("length")===0?t:(n.forEachIn(0,e,function(e){t+=this.branchObserverAt(e).get("length")-1},this),t)},_contentGroupIndexes:NO,contentGroupIndexes:function(e,t){if(t!==this)return null;var n=this._contentGroupIndexes;if(n!==NO)return n;if(this.get("parentObserver"))return null;var r=this.get("item"),i,s,o,u;return r&&r.isTreeItemContent?i=r.get("treeItemIsGrouped"):i=!!this.delegate.get("treeItemIsGrouped"),i?(n=SC.IndexSet.create(),s=this.get("branchIndexes"),s&&(o=s.min(),u=0,s.forEach(function(e){n.add(e+u,1);var t=this.branchObserverAt(e);t&&(u+=t.get("length")-1,o+=u)},this))):n=null,this._contentGroupIndexes=n,n},contentIndexIsGroup:function(e,t,n){var r=this.contentGroupIndexes(e,t);return r?r.contains(n):NO},contentIndexOutlineLevel:function(e,t,n){if(t!==this)return-1;var r=this._outlineLevelCache;if(r&&r[n]!==undefined)return r[n];r||(r=this._outlineLevelCache=[]);var i=this.get("length"),s=n,o=0,u=null,a,f,l;if(n>=i)return-1;if(this.get("isHeaderVisible")){if(n===0)return r[0]=this.get("outlineLevel")-1;s--}return(a=this.get("branchIndexes"))&&a.forEach(function(t){if(u!==null||t>s)return;var n=this.branchObserverAt(t),r;if(!n)return;r=n.get("length"),t+r>s?(u=n.contentIndexOutlineLevel(e,n,s-t),s=-1):s-=r-1},this),s>=0&&(u=this.get("outlineLevel")),r[n]=u,u},contentIndexDisclosureState:function(e,t,n){if(t!==this)return-1;var r=this._disclosureStateCache;if(r&&r[n]!==undefined)return r[n];r||(r=this._disclosureStateCache=[]);var i=this.get("length"),s=n,o=0,u=null,a,f,l;if(n>=i)return SC.LEAF_NODE;if(this.get("isHeaderVisible"
)){if(n===0)return r[0]=this.get("disclosureState");s--}return(a=this.get("branchIndexes"))&&a.forEach(function(t){if(u!==null||t>s)return;var n=this.branchObserverAt(t),r;if(!n)return;r=n.get("length"),t+r>s?(u=n.contentIndexDisclosureState(e,n,s-t),s=-1):s-=r-1},this),s>=0&&(u=SC.LEAF_NODE),r[n]=u,u},contentIndexExpand:function(e,t,n){var r,i=n,s,o;if(t!==this)return;if(this.get("isHeaderVisible")){if(n===0){this._expand(this.get("item"));return}i--}(r=this.get("branchIndexes"))&&r.forEach(function(t){if(t>=i)return;var n=this.branchObserverAt(t),r;if(!n)return;r=n.get("length"),t+r>i?(n.contentIndexExpand(e,n,i-t),i=-1):i-=r-1},this),i>=0&&(s=this.get("children"),o=s?s.objectAt(i):null,o&&this._expand(o,this.get("item"),i))},contentIndexCollapse:function(e,t,n){var r,i,s,o=n;if(t!==this)return;if(this.get("isHeaderVisible")){if(n===0){this._collapse(this.get("item"));return}o--}(r=this.get("branchIndexes"))&&r.forEach(function(t){if(t>=o)return;var n=this.branchObserverAt(t),r;if(!n)return;r=n.get("length"),t+r>o?(n.contentIndexCollapse(e,n,o-t),o=-1):o-=r-1},this),o>=0&&(i=this.get("children"),s=i?i.objectAt(o):null,s&&this._collapse(s,this.get("item"),o))},branchObserverAt:function(e){var t=this._branchObserversByIndex,n=this._branchObserverIndexes,r,i,s,o,u,a,f;return t||(t=this._branchObserversByIndex=[]),n||(n=this._branchObserverIndexes=SC.IndexSet.create()),(r=t[e])?r:(u=this.get("children"),o=u?u.objectAt(e):null,o?(t[e]=r=SC.TreeItemObserver.create({item:o,delegate:this.get("delegate"),parentObserver:this,index:e,outlineLevel:this.get("outlineLevel")+1}),n.add(e)
,r):null)},invalidateBranchObserversAt:function(e){var t=this._branchObserversByIndex,n=this._branchObserverIndexes;return!t||t.length<=e?this:(e<0&&(e=0),n.forEachIn(e,n.get("max")-e,function(e){var n=t[e];n&&n.destroy()},this),t.length=e,this)},init:function(){arguments.callee.base.apply(this,arguments);var e=this.get("item");if(!e)throw"SC.TreeItemObserver.item cannot be null";e.addObserver("*",this,this._itemPropertyDidChange),this._itemPropertyDidChange(e,"*"),this._notifyParent=YES},destroy:function(){this.invalidateBranchObserversAt(0),this._objectAtCache=null,this._notifyParent=NO;var e=this.get("item");e&&e.removeObserver("*",this,this._itemPropertyDidChange);var t=this._children,n=this._childrenRangeObserver;t&&n&&t.removeRangeObserver(n),this.set("length",0),arguments.callee.base.apply(this,arguments)},_itemPropertyDidChange:function(e,t){var n=this.get("children"),r=this.get("disclosureState"),i=this.get("item"),s;this.beginPropertyChanges(),s=this._computeDisclosureState(i),r!==s&&this.set("disclosureState",s),s=this._computeChildren(i),n!==s&&this.set("children",s),this.endPropertyChanges()},_childrenDidChange:function(){var e=this.get("disclosureState"),t=e===SC.BRANCH_OPEN?this.get("children"):null,n=this._children,r=this._childrenRangeObserver;if(n===t)return this;r&&n.removeRangeObserver(r),t?this._childrenRangeObserver=t.addRangeObserver(null,this,this._childrenRangeDidChange):this._childrenRangeObserver=null,this._children=t,this._childrenRangeDidChange(t,null,"[]",null)}.observes("children","disclosureState"),_childrenRangeDidChange:function(e,t,n,r){var i=
this.get("children"),s=i?i.get("length"):0,o=r?r.get("min"):0,u=r?r.get("max"):s,a=this._childrenLen||0;this._childrenLen=s,this.observerContentDidChange(o,u-o,s-a)},_computeDisclosureState:function(e,t,n){var r,i;return!e||!this._computeChildren(e)?SC.LEAF_NODE:e.isTreeItemContent?(t===undefined&&(t=this.get("parentItem")),n===undefined&&(n=this.get("index")),e.treeItemDisclosureState(t,n)):(r=this._treeItemIsExpandedKey,r||(i=this.get("delegate"),r=i?i.get("treeItemIsExpandedKey"):"treeItemIsExpanded",this._treeItemIsExpandedKey=r),e.get(r)?SC.BRANCH_OPEN:SC.BRANCH_CLOSED)},_collapse:function(e,t,n){var r,i;return!e||!this._computeChildren(e)?this:(e.isTreeItemContent?(t===undefined&&(t=this.get("parentItem")),n===undefined&&(n=this.get("index")),e.treeItemCollapse(t,n)):(r=this._treeItemIsExpandedKey,r||(i=this.get("delegate"),r=i?i.get("treeItemIsExpandedKey"):"treeItemIsExpanded",this._treeItemIsExpandedKey=r),e.setIfChanged(r,NO)),this)},_expand:function(e,t,n){var r,i;return!e||!this._computeChildren(e)?this:(e.isTreeItemContent?(t===undefined&&(t=this.get("parentItem")),n===undefined&&(n=this.get("index")),e.treeItemExpand(t,n)):(r=this._treeItemIsExpandedKey,r||(i=this.get("delegate"),r=i?i.get("treeItemIsExpandedKey"):"treeItemIsExpanded",this._treeItemIsExpandedKey=r),e.setIfChanged(r,YES)),this)},_computeChildren:function(e){var t,n;return e?e.isTreeItemContent?e.get("treeItemChildren"):(n=this._treeItemChildrenKey,n||(t=this.get("delegate"),n=t?t.get("treeItemChildrenKey"):"treeItemChildren",this._treeItemChildrenKey=n),e.get(n)):null},_computeLength:function(){
var e=this.get("isHeaderVisible")?1:0,t=this.get("disclosureState"),n=this.get("children"),r;return t===SC.BRANCH_OPEN&&n&&(e+=n.get("length"),(r=this.get("branchIndexes"))&&r.forEach(function(t){var n=this.branchObserverAt(t);e+=n.get("length")-1},this)),e}}),SC.TreeController=SC.ObjectController.extend(SC.SelectionSupport,{treeItemIsGrouped:NO,treeItemIsExpandedKey:"treeItemIsExpanded",treeItemChildrenKey:"treeItemChildren",arrangedObjects:function(){var e,t=this.get("content");return t?e=SC.TreeItemObserver.create({item:t,delegate:this}):e=null,this._sctc_arrangedObjects=e,e}.property().cacheable(),_sctc_invalidateArrangedObjects:function(){this.propertyWillChange("arrangedObjects");var e=this._sctc_arrangedObjects;e&&e.destroy(),this._sctc_arrangedObjects=null,this.propertyDidChange("arrangedObjects")}.observes("content","treeItemIsExpandedKey","treeItemChildrenKey","treeItemIsGrouped"),_sctc_arrangedObjectsContentDidChange:function(){this.updateSelectionAfterContentChange()}.observes("*arrangedObjects.[]"),canSelectGroups:NO,firstSelectableObject:function(){var e=this.get("arrangedObjects"),t,n,r=0;if(!e)return null;if(this.get("treeItemIsGrouped")===NO||this.get("canSelectGroups"))return e.get("firstObject");t=e.contentGroupIndexes(null,e),n=e.get("length");while(t.contains(r)&&r<n)r++;return r>=n?null:e.objectAt(r)}.property()}),SC.InlineTextFieldDelegate={editor:null,acquireEditor:function(e){var t=this.editor;if(t){if(t.get("isEditing")&&!t.commitEditing()&&!t.discardEditing())return null;this.releaseEditor(t)}var n=e.exampleEditor?e.exampleEditor:SC.InlineTextFieldView
,r=e.get("pane");return t=this.editor=r.createChildView(n,{inlineEditorDelegate:this}),r.appendChild(t),t},releaseEditor:function(e){return e.removeFromParent(),this.editor=null,YES}},SC.STRING_TITLEIZE_REGEXP=/([\s|\-|\_|\n])([^\s|\-|\_|\n]?)/g,SC.STRING_HUMANIZE_REGEXP=/[\-_]/g,SC.STRING_REGEXP_ESCAPED_REGEXP=/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:])/g,SC.STRING_DASHERIZE_CACHE={top:"top",left:"left",right:"right",bottom:"bottom",width:"width",height:"height",minWidth:"min-width",maxWidth:"max-width"},SC.INFLECTION_CONSTANTS={PLURAL:[[/(quiz)$/i,"$1zes"],[/^(ox)$/i,"$1en"],[/([m|l])ouse$/i,"$1ice"],[/(matr|vert|ind)ix|ex$/i,"$1ices"],[/(x|ch|ss|sh)$/i,"$1es"],[/([^aeiouy]|qu)y$/i,"$1ies"],[/(hive)$/i,"$1s"],[/(?:([^f])fe|([lr])f)$/i,"$1$2ves"],[/sis$/i,"ses"],[/([ti])um$/i,"$1a"],[/(buffal|tomat)o$/i,"$1oes"],[/(bu)s$/i,"$1ses"],[/(alias|status)$/i,"$1es"],[/(octop|vir)us$/i,"$1i"],[/(ax|test)is$/i,"$1es"],[/s$/i,"s"],[/$/,"s"]],SINGULAR:[[/(quiz)zes$/i,"$1"],[/(matr)ices$/i,"$1ix"],[/(vert|ind)ices$/i,"$1ex"],[/^(ox)en/i,"$1"],[/(alias|status)es$/i,"$1"],[/(octop|vir)i$/i,"$1us"],[/(cris|ax|test)es$/i,"$1is"],[/(shoe)s$/i,"$1"],[/(o)es$/i,"$1"],[/(bus)es$/i,"$1"],[/([m|l])ice$/i,"$1ouse"],[/(x|ch|ss|sh)es$/i,"$1"],[/(m)ovies$/i,"$1ovie"],[/(s)eries$/i,"$1eries"],[/([^aeiouy]|qu)ies$/i,"$1y"],[/([lr])ves$/i,"$1f"],[/(tive)s$/i,"$1"],[/(hive)s$/i,"$1"],[/([^f])ves$/i,"$1fe"],[/(^analy)ses$/i,"$1sis"],[/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/i,"$1$2sis"],[/([ti])a$/i,"$1um"],[/(n)ews$/i,"$1ews"],[/s$/i,""]],IRREGULAR:[["move","moves"],["sex","sexes"]
,["child","children"],["man","men"],["person","people"]],UNCOUNTABLE:["sheep","fish","series","species","money","rice","information","info","equipment"]},SC.mixin(SC.String,{capitalizeEach:function(e){return e.replace(SC.STRING_TITLEIZE_REGEXP,function(e,t,n){return n?t+n.toUpperCase():t}).capitalize()},titleize:function(e){var t=e.replace(SC.STRING_DECAMELIZE_REGEXP,"$1_$2");return t.replace(SC.STRING_TITLEIZE_REGEXP,function(e,t,n){return n?" "+n.toUpperCase():" "}).capitalize()},classify:function(e){var t=e.replace(SC.STRING_TITLEIZE_REGEXP,function(e,t,n){return n?n.toUpperCase():""}),n=t.charAt(0),r=n.toUpperCase();return n!==r?r+t.slice(1):t},humanize:function(e){return SC.String.decamelize(e).replace(SC.STRING_HUMANIZE_REGEXP," ")},escapeForRegExp:function(e){return e.replace(SC.STRING_REGEXP_ESCAPED_REGEXP,"\\$1")},removeDiacritics:function(e){var t=SC.diacriticMappingTable;t||(SC.diacriticMappingTable={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Ā":"A","Ă":"A","Ą":"A","Ǎ":"A","Ǟ":"A","Ǡ":"A","Ǻ":"A","Ȁ":"A","Ȃ":"A","Ȧ":"A","Ḁ":"A","Ạ":"A","Ả":"A","Ấ":"A","Ầ":"A","Ẩ":"A","Ẫ":"A","Ậ":"A","Ắ":"A","Ằ":"A","Ẳ":"A","Ẵ":"A","Ặ":"A","Å":"A","Ḃ":"B","Ḅ":"B","Ḇ":"B","Ç":"C","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","Ḉ":"C","Ď":"D","Ḋ":"D","Ḍ":"D","Ḏ":"D","Ḑ":"D","Ḓ":"D","È":"E","É":"E","Ê":"E","Ë":"E","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","Ȅ":"E","Ȇ":"E","Ȩ":"E","Ḕ":"E","Ḗ":"E","Ḙ":"E","Ḛ":"E","Ḝ":"E","Ẹ":"E","Ẻ":"E","Ẽ":"E","Ế":"E","Ề":"E","Ể":"E","Ễ":"E","Ệ":"E","Ḟ":"F","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","Ǧ":"G","Ǵ":"G","Ḡ":"G","Ĥ":"H","Ȟ":"H","Ḣ":"H","Ḥ":"H","Ḧ":"H","Ḩ":"H","Ḫ":"H"
,"Ì":"I","Í":"I","Î":"I","Ï":"I","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","Ǐ":"I","Ȉ":"I","Ȋ":"I","Ḭ":"I","Ḯ":"I","Ỉ":"I","Ị":"I","Ĵ":"J","Ķ":"K","Ǩ":"K","Ḱ":"K","Ḳ":"K","Ḵ":"K","Ĺ":"L","Ļ":"L","Ľ":"L","Ḷ":"L","Ḹ":"L","Ḻ":"L","Ḽ":"L","Ḿ":"M","Ṁ":"M","Ṃ":"M","Ñ":"N","Ń":"N","Ņ":"N","Ň":"N","Ǹ":"N","Ṅ":"N","Ṇ":"N","Ṉ":"N","Ṋ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ō":"O","Ŏ":"O","Ő":"O","Ơ":"O","Ǒ":"O","Ǫ":"O","Ǭ":"O","Ȍ":"O","Ȏ":"O","Ȫ":"O","Ȭ":"O","Ȯ":"O","Ȱ":"O","Ṍ":"O","Ṏ":"O","Ṑ":"O","Ṓ":"O","Ọ":"O","Ỏ":"O","Ố":"O","Ồ":"O","Ổ":"O","Ỗ":"O","Ộ":"O","Ớ":"O","Ờ":"O","Ở":"O","Ỡ":"O","Ợ":"O","Ṕ":"P","Ṗ":"P","Ŕ":"R","Ŗ":"R","Ř":"R","Ȑ":"R","Ȓ":"R","Ṙ":"R","Ṛ":"R","Ṝ":"R","Ṟ":"R","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","Ș":"S","Ṡ":"S","Ṣ":"S","Ṥ":"S","Ṧ":"S","Ṩ":"S","Ţ":"T","Ť":"T","Ț":"T","Ṫ":"T","Ṭ":"T","Ṯ":"T","Ṱ":"T","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","Ư":"U","Ǔ":"U","Ǖ":"U","Ǘ":"U","Ǚ":"U","Ǜ":"U","Ȕ":"U","Ȗ":"U","Ṳ":"U","Ṵ":"U","Ṷ":"U","Ṹ":"U","Ṻ":"U","Ụ":"U","Ủ":"U","Ứ":"U","Ừ":"U","Ử":"U","Ữ":"U","Ự":"U","Ṽ":"V","Ṿ":"V","Ŵ":"W","Ẁ":"W","Ẃ":"W","Ẅ":"W","Ẇ":"W","Ẉ":"W","Ẋ":"X","Ẍ":"X","Ý":"Y","Ŷ":"Y","Ÿ":"Y","Ȳ":"Y","Ẏ":"Y","Ỳ":"Y","Ỵ":"Y","Ỷ":"Y","Ỹ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","Ẑ":"Z","Ẓ":"Z","Ẕ":"Z","`":"`","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","ā":"a","ă":"a","ą":"a","ǎ":"a","ǟ":"a","ǡ":"a","ǻ":"a","ȁ":"a","ȃ":"a","ȧ":"a","ḁ":"a","ạ":"a","ả":"a","ấ":"a","ầ":"a","ẩ":"a","ẫ":"a","ậ":"a","ắ":"a","ằ":"a","ẳ":"a","ẵ":"a","ặ":"a","ḃ":"b","ḅ":"b","ḇ":"b","ç":"c","ć":"c","ĉ":"c","ċ":"c","č":"c","ḉ":"c","ď":"d","ḋ":"d","ḍ":"d","ḏ"
:"d","ḑ":"d","ḓ":"d","è":"e","é":"e","ê":"e","ë":"e","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","ȅ":"e","ȇ":"e","ȩ":"e","ḕ":"e","ḗ":"e","ḙ":"e","ḛ":"e","ḝ":"e","ẹ":"e","ẻ":"e","ẽ":"e","ế":"e","ề":"e","ể":"e","ễ":"e","ệ":"e","ḟ":"f","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","ǧ":"g","ǵ":"g","ḡ":"g","ĥ":"h","ȟ":"h","ḣ":"h","ḥ":"h","ḧ":"h","ḩ":"h","ḫ":"h","ẖ":"h","ì":"i","í":"i","î":"i","ï":"i","ĩ":"i","ī":"i","ĭ":"i","į":"i","ǐ":"i","ȉ":"i","ȋ":"i","ḭ":"i","ḯ":"i","ỉ":"i","ị":"i","ĵ":"j","ǰ":"j","ķ":"k","ǩ":"k","ḱ":"k","ḳ":"k","ḵ":"k","ĺ":"l","ļ":"l","ľ":"l","ḷ":"l","ḹ":"l","ḻ":"l","ḽ":"l","ḿ":"m","ṁ":"m","ṃ":"m","ñ":"n","ń":"n","ņ":"n","ň":"n","ǹ":"n","ṅ":"n","ṇ":"n","ṉ":"n","ṋ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ō":"o","ŏ":"o","ő":"o","ơ":"o","ǒ":"o","ǫ":"o","ǭ":"o","ȍ":"o","ȏ":"o","ȫ":"o","ȭ":"o","ȯ":"o","ȱ":"o","ṍ":"o","ṏ":"o","ṑ":"o","ṓ":"o","ọ":"o","ỏ":"o","ố":"o","ồ":"o","ổ":"o","ỗ":"o","ộ":"o","ớ":"o","ờ":"o","ở":"o","ỡ":"o","ợ":"o","ṕ":"p","ṗ":"p","ŕ":"r","ŗ":"r","ř":"r","ȑ":"r","ȓ":"r","ṙ":"r","ṛ":"r","ṝ":"r","ṟ":"r","ś":"s","ŝ":"s","ş":"s","š":"s","ș":"s","ṡ":"s","ṣ":"s","ṥ":"s","ṧ":"s","ṩ":"s","ţ":"t","ť":"t","ț":"t","ṫ":"t","ṭ":"t","ṯ":"t","ṱ":"t","ẗ":"t","ù":"u","ú":"u","û":"u","ü":"u","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","ư":"u","ǔ":"u","ǖ":"u","ǘ":"u","ǚ":"u","ǜ":"u","ȕ":"u","ȗ":"u","ṳ":"u","ṵ":"u","ṷ":"u","ṹ":"u","ṻ":"u","ụ":"u","ủ":"u","ứ":"u","ừ":"u","ử":"u","ữ":"u","ự":"u","ṽ":"v","ṿ":"v","ŵ":"w","ẁ":"w","ẃ":"w","ẅ":"w","ẇ":"w","ẉ":"w","ẘ":"w","ẋ":"x","ẍ":"x","ý":"y","ÿ":"y","ŷ":"y","ȳ":"y","ẏ":"y","ẙ":"y","ỳ":"y","ỵ":"y","ỷ":"y","ỹ":"y","ź":"z","ż":"z"
,"ž":"z","ẑ":"z","ẓ":"z","ẕ":"z"},t=SC.diacriticMappingTable);var n,r,i="",s=e.length;for(var o=0;o<=s;++o)n=e.charAt(o),r=t[n],i+=r||n;return i},pluralize:function(e){var t,n,r=e.split(/\s/).pop(),i=e.replace(r,""),s=r.charAt(0).match(/[A-Z]/)?!0:!1;r=r.toLowerCase();for(t=0,n=SC.INFLECTION_CONSTANTS.UNCOUNTABLE.length;t<n;t++){var o=SC.INFLECTION_CONSTANTS.UNCOUNTABLE[t];if(r==o)return e.toString()}for(t=0,n=SC.INFLECTION_CONSTANTS.IRREGULAR.length;t<n;t++){var u=SC.INFLECTION_CONSTANTS.IRREGULAR[t][0],a=SC.INFLECTION_CONSTANTS.IRREGULAR[t][1];if(r==u||r==a)return s&&(a=a.capitalize()),i+a}for(t=0,n=SC.INFLECTION_CONSTANTS.PLURAL.length;t<n;t++){var f=SC.INFLECTION_CONSTANTS.PLURAL[t][0],l=SC.INFLECTION_CONSTANTS.PLURAL[t][1];if(f.test(r))return e.replace(f,l)}},singularize:function(e){var t,n,r=e.split(/\s/).pop(),i=e.replace(r,""),s=r.charAt(0).match(/[A-Z]/)?!0:!1;r=r.toLowerCase();for(t=0,n=SC.INFLECTION_CONSTANTS.UNCOUNTABLE.length;t<n;t++){var o=SC.INFLECTION_CONSTANTS.UNCOUNTABLE[t];if(r==o)return e.toString()}for(t=0,n=SC.INFLECTION_CONSTANTS.IRREGULAR.length;t<n;t++){var u=SC.INFLECTION_CONSTANTS.IRREGULAR[t][0],a=SC.INFLECTION_CONSTANTS.IRREGULAR[t][1];if(r==u||r==a)return s&&(u=u.capitalize()),i+u}for(t=0,n=SC.INFLECTION_CONSTANTS.SINGULAR.length;t<n;t++){var f=SC.INFLECTION_CONSTANTS.SINGULAR[t][0],l=SC.INFLECTION_CONSTANTS.SINGULAR[t][1];if(f.test(r))return e.replace(f,l)}}}),SC.String.strip=SC.String.trim,SC.supplement(String.prototype,{capitalizeEach:function(){return SC.String.capitalizeEach(this,arguments)},titleize:function(e){return SC.String.titleize(this
,arguments)},classify:function(e){return SC.String.classify(this,arguments)},humanize:function(e){return SC.String.humanize(this,arguments)},escapeForRegExp:function(e){return SC.String.escapeForRegExp(this,arguments)},removeDiacritics:function(e){return SC.String.removeDiacritics(this,arguments)},trim:function(e){return SC.String.trim(this,arguments)},trimLeft:function(e){return SC.String.trimLeft(this,arguments)},trimRight:function(e){return SC.String.trimRight(this,arguments)},pluralize:function(e){return SC.String.pluralize(this,arguments)},singularize:function(e){return SC.String.singularize(this,arguments)}}),SC.Gesture=SC.Object.extend({name:"gesture",touchIsInGesture:function(e,t){return NO},touchStart:function(e){},touchesDragged:function(e,t){},touchEnd:function(e){},start:function(){if(!this.get("isActive")){this.set("isActive",YES);var e=SC.$A(arguments);e.unshift(this);var t=this.name+"Start";this.view[t]&&this.view[t].apply(this.view,e)}},end:function(){if(this.get("isActive")){this.set("isActive",NO);var e=SC.$A(arguments);e.unshift(this);var t=this.name+"End";this.view[t]&&this.view[t].apply(this.view,e)}},change:function(){if(this.get("isActive")){var e=SC.$A(arguments);e.unshift(this);var t=this.name+"Changed";this.view[t]&&this.view[t].apply(this.view,e)}},cancel:function(){if(this.get("isActive")){this.set("isActive",NO);var e=SC.$A(arguments);e.unshift(this);var t=this.name+"Cancelled";this.view[t]&&this.view[t].apply(this.view,e)}},trigger:function(){var e=SC.$A(arguments);e.unshift(this);var t=this.name;this.view[t]&&this.view[t].apply(this.view,e)},take
:function(e){e.isTaken=YES,(SC.none(e.touchResponder)||e.touchResponder!==this)&&e.makeTouchResponder(this,YES)},release:function(e){e.isTaken=NO,e.nextTouchResponder&&e.makeTouchResponder(e.nextTouchResponder)},discardTouch:function(e){e.isTaken=YES,e.makeTouchResponder(null)},statusForTouch:function(e){var t=SC.guidFor(e.view)+this.name,n=e[t];return n||(n=e[t]={}),n},unassignedTouchDidStart:function(e){if(e.isTaken)return;this.touchIsInGesture(e,this.statusForTouch(e))&&this.take(e)},unassignedTouchesDidChange:function(e,t){t.forEach(function(e){if(e.isTaken)return;this.touchIsInGesture(e,this.statusForTouch(e))&&this.take(e)},this)},unassignedTouchDidEnd:function(e){},interestedInTouch:function(e){var t=this.statusForTouch(e);if(t.isInterested)return;t.isInterested=YES,e.isInteresting++},uninterestedInTouch:function(e){var t=this.statusForTouch(e);if(!t.isInterested)return;t.isInterested=NO,e.isInteresting--}}),SC.PinchGesture=SC.Gesture.extend({name:"pinch",acceptsMultitouch:YES,scale:1,unassignedTouchesDidChange:function(e,t){t.length==2&&(this.take(t[0]),this.take(t[1]))},touchStart:function(e){var t=e.touchesForResponder(this);return!t||t.length===0?YES:t.length==1?(this.start([t[0],e]),YES):NO},touchesDragged:function(e,t){var n=t.firstObject(),r=n.averagedTouchesForView(this);r.touchCount==2&&(this._startDistance||(this._startDistance=r.d),this.scale=r.d/this._startDistance,this.change(t,this.scale))},touchEnd:function(e){this._startDistance=null;var t=e.touchesForResponder(this);this.trigger(t,this.scale),this.end(t,this.scale),t&&t.forEach(function(e){this.release
(e)},this)}}),SC.SWIPE_HORIZONTAL="X",SC.SWIPE_VERTICAL="Y",SC.SWIPE_ANY="XY",SC.SWIPE_LEFT="LEFT",SC.SWIPE_RIGHT="RIGHT",SC.SWIPE_UP="UP",SC.SWIPE_DOWN="DOWN",SC.SwipeGesture=SC.Gesture.extend({name:"swipe",acceptsMultitouch:YES,direction:SC.SWIPE_HORIZONTAL,currentDirection:null,startDistance:5,swipeDistance:40,tolerance:.5,touchIsInGesture:function(e,t){if(!t.flunked){var n=this.get("direction"),r=this.get("currentDirection"),i=this.get("startDistance"),s=e.pageX-e.startX,o=e.pageY-e.startY,u=Math.abs(s),a=Math.abs(o);if(Math.abs(s)>i||Math.abs(o)>i){if(!r){if(n==SC.SWIPE_ANY)if(u>a)r=SC.SWIPE_HORIZONTAL;else{if(!(a>u))return NO;r=SC.SWIPE_VERTICAL}else r=n;this.set("currentDirection",r)}var f=r==SC.SWIPE_HORIZONTAL?s:o,l=r==SC.SWIPE_HORIZONTAL?o:s;if(Math.abs(f)*this.get("tolerance")>Math.abs(l))return YES}}return NO},touchStart:function(e){var t=this.get("currentDirection"),n=e["page"+t]-e["start"+t],r;return n<0?r=t===SC.SWIPE_HORIZONTAL?SC.SWIPE_LEFT:SC.SWIPE_UP:r=t===SC.SWIPE_HORIZONTAL?SC.SWIPE_RIGHT:SC.SWIPE_DOWN,this.start(e,r,n),YES},touchesDragged:function(e,t){var n=t.firstObject(),r=this.get("currentDirection"),i=r===SC.SWIPE_HORIZONTAL?"Y":"X",s=n["page"+r]-n["start"+r],o=n["page"+i]-n["start"+i],u;s<0?u=r===SC.SWIPE_HORIZONTAL?SC.SWIPE_LEFT:SC.SWIPE_UP:u=r===SC.SWIPE_HORIZONTAL?SC.SWIPE_RIGHT:SC.SWIPE_DOWN;if(Math.abs(s)<this.get("startDistance")||Math.abs(s)*this.get("tolerance")<Math.abs(o)){this.release(n);var a=n.touchesForResponder(this);(!a||a.length===0)&&this.cancel(n,u,s)}else this.change(n,u,s)},touchEnd:function(e){var t=this.get("currentDirection"
),n=t===SC.SWIPE_HORIZONTAL?"Y":"X",r=e["page"+t]-e["start"+t],i=e["page"+n]-e["start"+n],s;r<0?s=t===SC.SWIPE_HORIZONTAL?SC.SWIPE_LEFT:SC.SWIPE_UP:s=t===SC.SWIPE_HORIZONTAL?SC.SWIPE_RIGHT:SC.SWIPE_DOWN,(Math.abs(r)>this.get("swipeDistance")||Math.abs(r)*this.get("tolerance")<Math.abs(i))&&this.trigger(e,s),this.end(e,s,r),this.set("currentDirection",null);var o=e.touchesForResponder(this);o&&o.forEach(function(e){this.release(e)},this)},cancel:function(){arguments.callee.base.apply(this,arguments),this.set("currentDirection",null)}}),SC.TapGesture=SC.Gesture.extend({name:"tap",acceptsMultitouch:NO,_tapCount:null,_candidateTouch:null,_eventTimer:null,tapWiggle:10,tapDelay:200,touchIsInGesture:function(e,t){return!e.tapFlunked},touchStart:function(e){return this._eventTimer&&this._eventTimer.invalidate(),this._candidateTouch&&this._candidateTouch.touch.identifier!==e.identifier?(this._cancelTap(e),NO):(this._candidateTouch={startTime:SC.getCurrentTimeForPerformance(),touch:e},this.start(e),YES)},touchesDragged:function(e,t){var n=t[0],r=t.length>1||!this._candidateTouch||n.identifier!==this._candidateTouch.touch.identifier,i=this._calculateDragDistance(n)>this.get("tapWiggle");(r||i)&&this._cancelTap(n)},touchEnd:function(e){this._calculateDragDistance(e)>this.get("tapWiggle")||SC.getCurrentTimeForPerformance()-this._candidateTouch.startTime>this.get("tapDelay")?this._cancelTap(e):this._addTap(e)},_addTap:function(e){var t=this;this._eventTimer&&this._eventTimer.invalidate(),this._tapCount=(this._tapCount||0)+1,this._candidateTouch=null,this._eventTimer=SC.Timer.schedule({target
:t,action:function(){this._triggerTap(e)},interval:this.get("tapDelay")}),this.change(e,this._tapCount),this.trigger(e,this._tapCount)},_cancelTap:function(e){e.tapFlunked=YES,this.release(e),this.cancel(e,this._tapCount),this._eventTimer&&this._eventTimer.invalidate(),this._tapCount=null,this._candidateTouch=null,this._eventTimer=null},_triggerTap:function(e){this.end(e,this._tapCount),this._tapCount=null,this._candidateTouch=null,this._eventTimer=null},_calculateDragDistance:function(e){return Math.sqrt(Math.pow(e.pageX-e.startX,2)+Math.pow(e.pageY-e.startY,2))}}),SC.AutoMixin={autoMixins:[],createChildView:function(e,t){t||(t={}),t.owner=t.parentView=this,t.isVisibleInWindow=this.get("isVisibleInWindow"),t.page||(t.page=this.page);var n=this.get("autoMixins");return n.push(t),e=e.create.apply(e,n),e}},SC.mixin({_copy_computed_props:["maxWidth","maxHeight","paddingLeft","paddingRight","paddingTop","paddingBottom","fontFamily","fontSize","fontStyle","fontWeight","fontVariant","lineHeight","whiteSpace","letterSpacing","wordWrap","boxSizing","webkitBoxSizing","MozBoxSizing"],stringFromLayout:function(e){var t=["maxHeight","maxWidth","minHeight","minWidth","centerY","centerX","width","height","bottom","right","top","left"],n=[],r,i=t.length;while(--i>=0)r=t[i],e.hasOwnProperty(r)&&n.push(r+":"+e[r]);return"{"+n.join(", ")+"}"},heightForString:function(e,t,n,r,i,s){if(s){var o=this.bestStringMetricsForMaxWidth(e,t,s,r,i);return o.height}SC.debug("Warning: Use the element reference for the heightForString method. Just using class names may result in inaccurate values.");var s,u;
u=r&&SC.typeOf(r)===SC.T_ARRAY?r.join(" "):"",elem=document.createElement("div"),document.body.insertBefore(elem,null),n=n+"; width: "+t+"px; left: "+ -1*t+"px; position: absolute;";var a=SC.$(elem);a.attr("style",n),u!==""&&a.attr("class",u),elem.innerHTML=e;var o=this.bestStringMetricsForMaxWidth(e,t,elem,r,i);return elem.parentNode.removeChild(elem),elem=null,o.height},prepareStringMeasurement:function(e,t){var n=this._metricsCalculationElement,r,i,s,o;r=SC.A(t).join(" ");if(!n){var u=document.createElement("div");u.style.cssText="position:absolute; left:-10010px; top:-10px;width:10000px; height:0px; overflow:hidden;visibility:hidden;",n=this._metricsCalculationElement=document.createElement("div"),u.appendChild(n),document.body.insertBefore(u,null)}o=SC.$(n);if(SC.typeOf(e)!=SC.T_STRING){var a=null;document.defaultView&&document.defaultView.getComputedStyle?a=document.defaultView.getComputedStyle(e,null):a=e.currentStyle;var f=this._copy_computed_props;for(var l=0;l<f.length;l++){var c=f[l],h=a[c];n.style[c]=h}var p=n.style;if(p.font===""){var d="";p.fontStyle&&(d+=p.fontStyle+" "),p.fontVariant&&(d+=p.fontVariant+" "),p.fontWeight&&(d+=p.fontWeight+" "),p.fontSize?d+=p.fontSize:d+="10px",p.lineHeight&&(d+="/"+p.lineHeight),d+=" ",p.fontFamily?d+=p.fontFamily:p+="sans-serif",n.style.font=d}SC.mixin(n.style,{left:"0px",top:"0px",position:"absolute",bottom:"auto",right:"auto",width:"auto",height:"auto"}),a=null}else s=e,o.attr("style",s+"; position:absolute; left: 0px; top: 0px; bottom: auto; right: auto; width: auto; height: auto;");n.className=r,n=null},teardownStringMeasurement
:function(){var e=this._metricsCalculationElement;e.innerHTML="",e.className="",e.setAttribute("style",""),e=null},measureString:function(e,t,n){var r=this._metricsCalculationElement,i=SC.browser,s=0;if(!r)throw"measureString requires a string measurement environment to be set up. Did you mean metricsForString?";t?r.innerHTML=e:typeof r.innerText!="undefined"?r.innerText=e:r.textContent=e;var o=r.getBoundingClientRect(),u=o.width,a=o.height,f={width:u,height:a};return i.isMozilla&&!n&&(f.width+=1),r=null,f},metricsForString:function(e,t,n,r,i){SC.prepareStringMeasurement(t,n);var s=SC.measureString(e,r,i);return SC.teardownStringMeasurement(),s}}),SC.AutoResize={shouldAutoResize:YES,shouldMeasureSize:YES,shouldCacheSizes:NO,shouldResizeWidth:YES,shouldResizeHeight:NO,measuredSize:{width:0,height:0},maxWidth:null,maxHeight:null,shouldAutoFitText:NO,autoFitDiscreteFontSizes:NO,minFontSize:12,maxFontSize:20,calculatedFontSize:20,autoFitTextFramePadding:{width:1,height:1},useExactMeasurement:NO,fontPropertyDidChange:function(){this.get("shouldAutoFitText")&&this.invokeLast(this.fitTextToFrame)}.observes("shouldAutoFitText","minFontSize","maxFontSize","frame"),measuredSizeDidChange:function(){var e=this.get("measuredSize"),t=e.width,n=e.height,r,i,s=this.get("autoResizePadding")||0,o=this.get("maxWidth"),u=this.get("maxHeight"),a=this.get("minWidth"),f=this.get("minHeight");SC.typeOf(s)===SC.T_NUMBER?r=i=s:(r=s.height,i=s.width),n+=r,t+=i,this.get("shouldAutoResize")&&(this.get("shouldResizeWidth")&&(a&&t<a&&(t=a),o&&t>o&&(t=o),this.set("calculatedWidth",t),this.adjust("width",t)
),this.get("shouldResizeHeight")&&(f&&n<f&&(n=f),u&&n>u&&(n=u),this.set("calculatedHeight",n),this.adjust("height",n))),this.get("shouldAutoFitText")&&this.invokeLast(this.fitTextToFrame)}.observes("shouldAutoResize","measuredSize","autoResizePadding","maxWidth","minWidth","shouldResizeWidth","shouldResizeHeight"),initMixin:function(){},batchResizeId:null,scheduleMeasurement:function(){var e=this.get("batchResizeId");if(!this.get("shouldMeasureSize")||!this.get("isVisibleInWindow")||this.get("autoResizeText")===this._lastMeasuredText&&e===this._lastMeasuredId)return;SC.AutoResizeManager.scheduleMeasurementForView(this,e)}.observes("isVisibleInWindow","shouldMeasureSize","autoResizeText","batchResizeId"),_lastMeasuredText:null,_cachedMetrics:function(e,t){if(!this.get("shouldCacheSizes"))return;var n=SC.cacheSlotFor(this.get("batchResizeId")||this),r=this.get("autoResizeText");return t?n[r]=t:t=n[r],t}.property("shouldCacheSizes","autoResizeText","batchResizeId").cacheable(),measureSize:function(e){var t,n=this.get("autoResizeLayer"),r=this.get("autoResizeText"),i=!this.get("escapeHTML"),s=this.get("batchResizeId"),o=this.get("_cachedMetrics"),u=this.get("maxFontSize");if(!n)return;return o?t=o:SC.none(r)||r===""?t={width:0,height:0}:e?t=SC.measureString(r,i,this.get("useExactMeasurement")):(this.prepareLayerForStringMeasurement(n),t=SC.metricsForString(r,n,this.get("classNames"),i,this.get("useExactMeasurement"))),this.set("measuredSize",t),this.get("shouldCacheSizes")&&this.setIfChanged("_cachedMetrics",t),this._lastMeasuredText=r,this._lastMeasuredId=s,t},prepareLayerForStringMeasurement
:function(e){var t=this.get("maxFontSize");this.get("shouldAutoFitText")&&this.get("calculatedFontSize")!==t&&(e.style.fontSize=t+"px")},viewDidResize:function(e){e(),this.fontPropertyDidChange()}.enhance(),fitTextToFrame:function(){var e=this.get("autoResizeLayer");if(!e)return;var t=this.get("maxFontSize"),n=this.get("minFontSize");this.prepareLayerForStringMeasurement(e);var r=this.get("frame"),i=this.get("autoResizePadding")||0,s=this.get("autoFitTextFramePadding"),o=s.width,u=s.height,a=r.width,f=r.height,l=a-o,c=f-u,h=this.get("measuredSize"),p=h.width,d=h.height,v;SC.typeOf(i)===SC.T_NUMBER?(l-=i,c-=i):(l-=i.width,c-=i.height);if(p<=l&&d<=c){this.set("calculatedFontSize",t),e.style.fontSize=t+"px";return}if(this.get("autoFitDiscreteFontSizes"))v=n;else{var m=l/p,g=c/d,y=Math.floor(t*Math.min(m,g)),b=this.get("classNames"),w=!this.get("escapeHTML"),E=this.get("autoResizeText"),S;y=v=Math.min(t,Math.max(n,y)),e.style.fontSize=y+"px",S=SC.metricsForString(E,e,b,w);if(S.width>l||S.height>c)for(y-=1;y>=n;y--){e.style.fontSize=y+"px",S=SC.metricsForString(E,e,b,w),v=y;if(S.width<=l&&S.height<=c)break}else if(S.width<l||S.height<c)for(y+=1;y<=t;y++){e.style.fontSize=y+"px",S=SC.metricsForString(E,e,b,w),S.width<=l&&S.height<=c&&(v=y);if(S.width>=l||S.height>=c)break}}e.style.fontSize=v+"px",this.set("calculatedFontSize",v)},applyAttributesToContext:function(e,t){e(t),this.get("shouldAutoFitText")&&t.css("font-size",this.get("calculatedFontSize")+"px")}.enhance(),didCreateLayer:function(e){e(),this.scheduleMeasurement()}.enhance()},SC.AutoResizeManager={measurementQueue:SC.CoreSet
.create(),scheduleMeasurementForView:function(e){this.measurementQueue.add(e),SC.RunLoop.currentRunLoop.invokeLast(this.doBatchResize)},cancelMeasurementForView:function(e,t){this.measurementQueue.remove(e)},doBatchResize:function(){if(this!==SC.AutoResizeManager)return SC.AutoResizeManager.doBatchResize();var e,t,n,r=this.measurementQueue,i,s,o,u;while((u=r.get("length"))>0){i=NO,e=r[u-1].get("batchResizeId");for(o=u-1;o>=0;--o){t=r[o];if(t.get("batchResizeId")!==e)continue;t.get("isVisibleInWindow")&&t.get("shouldMeasureSize")&&(n=t.get("autoResizeLayer"))&&(s=t.get("autoResizeText"),!SC.none(s)&&s!==""&&!t.get("_cachedMetrics")&&!i&&(t.prepareLayerForStringMeasurement(n),SC.prepareStringMeasurement(n,t.get("classNames")),i=YES),t.measureSize(YES)),r.remove(t);if(!e)break}i&&SC.teardownStringMeasurement()}}},SC.Button&&(SC.Button.initMixin=function(){throw"SC.Button is deprecated as a mixin and is now a subclass of SC.TemplateView. Subclass SC.ButtonView instead."}),SC.ContentDisplay={concatenatedProperties:"contentDisplayProperties",displayProperties:["content"],contentDisplayProperties:[],initMixin:function(){this._display_contentDidChange()},destroyMixin:function(){if(!this._display_content)return;this._display_stopObservingContent(this._display_content),this._display_content=null},_display_beginObservingContent:function(e){var t=this._display_contentPropertyDidChange;SC.isArray(e)?e.invoke("addObserver","*",this,t):e.addObserver&&e.addObserver("*",this,t)},_display_stopObservingContent:function(e){var t=this._display_contentPropertyDidChange;SC.isArray(e)?e.invoke("removeObserver"
,"*",this,t):e.removeObserver&&e.removeObserver("*",this,t)},_display_contentDidChange:function(e,t,n){if((n=this.get("content"))===this._display_content)return;var r=this._display_content;r&&this._display_stopObservingContent(r),r=this._display_content=n,r&&this._display_beginObservingContent(r),this.displayDidChange()}.observes("content","contentDisplayProperties"),_display_contentPropertyDidChange:function(e,t,n,r){if(t==="*")this.displayDidChange();else{var i=this.get("contentDisplayProperties");i&&i.indexOf(t)>=0&&this.displayDidChange()}}},SC.ContentValueSupport={hasContentValueSupport:YES,initMixin:function(){this._control_contentKeysDidChange()},value:null,content:null,contentKeys:null,_default_contentKeys:{contentValueKey:"value"},contentValueKey:null,contentPropertyDidChange:function(e,t){var n=this.get("contentKeys"),r;if(n){for(r in n)(t==="*"||t===this.getDelegateProperty(r,this,this.get("displayDelegate"),n))&&this.updatePropertyFromContent(n[r],t,r,e);return this}return this.updatePropertyFromContent("value",t,"contentValueKey",e)},updatePropertyFromContent:function(e,t,n,r){var i,s;n===undefined&&(n="content"+e.capitalize()+"Key");if(this[n])n=this.get(n);else{if(!(i=this.get("displayDelegate"))||!(s=i[n]))return this;n=i.get?i.get(n):s}if(t==="*"||t===n)r===undefined&&(r=this.get("content")),r?s=r.get?r.get(n):r[n]:s=null,this.setIfChanged(e,s);return this},updateContentWithValueObserver:function(e,t){var n=this._reverseContentKeys;if(!t||t==="*")for(t in n)this.updateContentWithValueObserver(this,t);var r=this.get(t),i=this.get("content"),s=this.getDelegateProperty
(n[t],this,this.displayDelegate);if(!s||!i)return this;typeof i.setIfChanged===SC.T_FUNCTION?i.setIfChanged(s,r):i[s]!==r&&(i[s]=r)},_control_content:null,_old_contentValueKeys:null,_old_contentKeys:null,_control_contentDidChange:function(e,t){var n=this.get("content"),r=this.get("contentKeys"),i,s=this._control_content,o=this._old_contentValueKeys,u=SC.typeOf(o),a=this.contentPropertyDidChange;if(s&&s.removeObserver&&o)if(u===SC.T_STRING)s.removeObserver(o,this,a),o=null;else{var f,l=o.get("length");for(f=0;f<l;f++)i=o[f],s.removeObserver(i,this,a);o.clear()}if(n&&n.addObserver)if(r){o||(o=SC.CoreSet.create());for(i in r)i=this.getDelegateProperty(i,this,this.get("displayDelegate")),i&&(n.addObserver(i,this,a),o.add(i))}else i=this.getDelegateProperty("contentValueKey",this,this.get("displayDelegate")),i&&(n.addObserver(i,this,a),o?o.add(i):o=i);this._control_content=n,this._old_contentValueKeys=o,t=!t||t==="content"?"*":this.get(t),t&&this.contentPropertyDidChange(n,t)}.observes("content"),_old_contentKeys:null,_control_contentKeysDidChange:function(){var e,t={},n=this.get("contentKeys")||this._default_contentKeys,r,i=this._old_contentKeys,s=this._control_contentDidChange,o=this.updateContentWithValueObserver;for(e in i)r=i[e],this.removeObserver(r,this,o),this.removeObserver(e,this,s);for(e in n)r=n[e],t[r]=e,this.addObserver(r,this,o),this.addObserver(e,this,s);this._reverseContentKeys=t,this._old_contentKeys=n,this._control_contentDidChange()}.observes("contentKeys")},SC.AUTO_CONTROL_SIZE="__AUTO__",SC.JUMBO_CONTROL_SIZE="sc-jumbo-size",SC.HUGE_CONTROL_SIZE="sc-huge-size"
,SC.LARGE_CONTROL_SIZE="sc-large-size",SC.REGULAR_CONTROL_SIZE="sc-regular-size",SC.SMALL_CONTROL_SIZE="sc-small-size",SC.TINY_CONTROL_SIZE="sc-tiny-size",SC.CUSTOM_CONTROL_SIZE="sc-custom-size",SC.Control=SC.mixin(SC.clone(SC.ContentValueSupport),{isControl:YES,isSelected:NO,isSelectedBindingDefault:SC.Binding.oneWay().bool(),isActive:NO,isActiveBindingDefault:SC.Binding.oneWay().bool(),fieldKey:null,fieldLabel:null,errorLabel:function(){var e,t,n,r;return(e=this.get("fieldLabel"))?e:(t=this.get("fieldKey")||this.constructor.toString(),n=t?SC.String.capitalize(SC.String.humanize(t)):"",r=SC.String.locWithDefault("FieldKey."+t,n),SC.String.locWithDefault("ErrorLabel."+t,r))}.property("fieldLabel","fieldKey").cacheable(),controlSize:SC.REGULAR_CONTROL_SIZE,displayProperties:["isEnabled","isSelected","isActive","controlSize"],_CONTROL_TMP_CLASSNAMES:{},renderMixin:function(e,t){var n=this.get("isSelected"),r=!this.get("isEnabled"),i=this._CONTROL_TMP_CLASSNAMES;i.mixed=n===SC.MIXED_STATE,i.sel=n&&n!==SC.MIXED_STATE,i.active=this.get("isActive");var s=this.get("controlSize");s||(s=SC.REGULAR_CONTROL_SIZE),t?(e.setClass(i),this.get("renderDelegate")||e.addClass(s)):(e.$().setClass(i),this.get("renderDelegate")||e.$().addClass(s));if(!t&&this.$input){var o=this.$input();o.attr("type")!=="radio"&&this.$input().attr("disabled",r)}}}),SC.Editable={isEditable:NO,isEditing:NO,beginEditing:function(){return this.get("isEditable")?this.get("isEditing")?YES:(this.beginPropertyChanges(),this.set("isEditing",YES),this.becomeFirstResponder(),this.endPropertyChanges(),YES):NO},discardEditing
:function(){return!this.get("isEditing")},commitEditing:function(){return this.get("isEditing")?(this.set("isEditing",NO),this.resignFirstResponder(),YES):YES}},SC.ALIGN_JUSTIFY="justify",SC.FlowedLayout={isFlowedLayout:YES,layoutDirection:SC.LAYOUT_HORIZONTAL,autoResize:YES,shouldResizeWidth:YES,shouldResizeHeight:YES,align:SC.ALIGN_LEFT,canWrap:YES,defaultFlowSpacing:{left:0,bottom:0,top:0,right:0},flowPadding:{left:0,bottom:0,right:0,top:0},_scfl_validFlowPadding:function(){var e=this.get("flowPadding")||{},t={};return t.left=e.left||0,t.top=e.top||0,t.bottom=e.bottom||0,t.right=e.right||0,t}.property("flowPadding").cacheable(),concatenatedProperties:["childMixins"],initMixin:function(){this._scfl_tileOnce()},_scfl_childViewsDidChange:function(e){this._scfl_tileOnce()}.observes("childViews"),_scfl_layoutPropertyDidChange:function(e){this._scfl_tileOnce()}.observes("layoutDirection","align","flowPadding","canWrap","defaultFlowSpacing","isVisibleInWindow"),layoutDidChangeFor:function(e){var t=e._scfl_lastLayout,n=e.get("layout"),r=e.get("frame");if(!t)return arguments.callee.base.apply(this,arguments);var i=YES;t.left&&t.left!==n.left?i=NO:t.top&&t.top!==n.top?i=NO:!e.get("fillWidth")&&t.width&&t.width!==n.width?i=NO:!t.width&&!e.get("fillWidth")&&r.width!==e._scfl_lastFrame.width?i=NO:!e.get("fillHeight")&&t.height&&t.height!==n.height?i=NO:!t.height&&!e.get("fillHeight")&&r.height!==e._scfl_lastFrame.height&&(i=NO);if(i)return arguments.callee.base.apply(this,arguments);this._scfl_tileOnce(),arguments.callee.base.apply(this,arguments)},observeChildLayout:function(e){if(e.
_scfl_isBeingObserved)return;e._scfl_isBeingObserved=YES,e.addObserver("flowSpacing",this,"_scfl_tileOnce"),e.addObserver("isVisible",this,"_scfl_tileOnce"),e.addObserver("useAbsoluteLayout",this,"_scfl_tileOnce"),e.addObserver("calculatedWidth",this,"_scfl_tileOnce"),e.addObserver("calculatedHeight",this,"_scfl_tileOnce"),e.addObserver("startsNewRow",this,"_scfl_tileOnce"),e.addObserver("isSpacer",this,"_scfl_tileOnce"),e.addObserver("maxSpacerLength",this,"_scfl_tileOnce"),e.addObserver("fillWidth",this,"_scfl_tileOnce"),e.addObserver("fillHeight",this,"_scfl_tileOnce")},unobserveChildLayout:function(e){e._scfl_isBeingObserved=NO,e.removeObserver("flowSpacing",this,"_scfl_tileOnce"),e.removeObserver("isVisible",this,"_scfl_tileOnce"),e.removeObserver("useAbsoluteLayout",this,"_scfl_tileOnce"),e.removeObserver("calculatedWidth",this,"_scfl_tileOnce"),e.removeObserver("calculatedHeight",this,"_scfl_tileOnce"),e.removeObserver("startsNewRow",this,"_scfl_tileOnce"),e.removeObserver("isSpacer",this,"_scfl_tileOnce"),e.removeObserver("maxSpacerLength",this,"_scfl_tileOnce"),e.removeObserver("fillWidth",this,"_scfl_tileOnce"),e.removeObserver("fillHeight",this,"_scfl_tileOnce")},shouldIncludeChildInFlow:function(e,t){return t.get("isVisible")&&!t.get("useAbsoluteLayout")},flowSpacingForChild:function(e,t){var n=t.get("flowSpacing");return SC.none(n)&&(n=this.get("defaultFlowSpacing")),SC.none(n)&&(n=0),SC.typeOf(n)===SC.T_NUMBER?n={left:n,right:n,bottom:n,top:n}:(n.left=n.left||0,n.right=n.right||0,n.top=n.top||0,n.bottom=n.bottom||0),n},flowSizeForChild:function(e,t){var n=t.get
("calculatedWidth"),r=t.get("calculatedHeight"),i=this.get("layoutDirection"),s={},o=t.get("frame"),u=t.get("layout");return t._scfl_lastFrame=o,n?s.width=n:s.width=u.width||o.width,r?s.height=r:s.height=u.height||o.height,t.get("isSpacer")&&(s.maxSpacerLength=t.get("maxSpacerLength"),i===SC.LAYOUT_HORIZONTAL?s.width=u.minWidth||0:s.height=u.minHeight||0),i===SC.LAYOUT_HORIZONTAL&&t.get("fillHeight")?s.height=u.minHeight||0:i===SC.LAYOUT_VERTICAL&&t.get("fillWidth")&&(s.width=u.minWidth||0),s},clippingFrame:function(){return{left:0,top:0,width:this.get("calculatedWidth"),height:this.get("calculatedHeight")}}.property("calculatedWidth","calculatedHeight"),_scfl_maxCollapsedRowLength:0,_scfl_totalCollapsedRowSize:0,_scfl_calculatedSizeDidChange:function(){this.get("autoResize")&&(this.get("layoutDirection")==SC.LAYOUT_VERTICAL?(this.get("shouldResizeHeight")&&this.adjust("minHeight",this.get("_scfl_maximumCollapsedRowLength")),this.get("shouldResizeWidth")&&this.adjust("minWidth",this.get("_scfl_totalCollapsedRowSize"))):(this.get("shouldResizeWidth")&&this.adjust("minWidth",this.get("_scfl_maximumCollapsedRowLength")),this.get("shouldResizeHeight")&&this.adjust("minHeight",this.get("_scfl_totalCollapsedRowSize"))))}.observes("autoResize","shouldResizeWidth","_scfl_maximumCollapsedRowLength","_scfl_totalCollapsedRowSize","shouldResizeHeight"),_scfl_createPlan:function(){var e=this.get("layoutDirection"),t=this.get("_scfl_validFlowPadding"),n=this.get("frame"),r=e===SC.LAYOUT_VERTICAL,i={rows:undefined,maximumCollapsedRowLength:0,totalCollapsedRowSize:0,isVertical:e===SC.LAYOUT_VERTICAL
,isHorizontal:e===SC.LAYOUT_HORIZONTAL,flowPadding:t,planStartPadding:t[r?"left":"top"],planEndPadding:t[r?"right":"bottom"],rowStartPadding:t[r?"top":"left"],rowEndPadding:t[r?"bottom":"right"],maximumRowLength:undefined,fitToPlanSize:undefined,align:this.get("align")};return r?(i.maximumRowLength=n.height-i.rowStartPadding-i.rowEndPadding,i.fitToPlanSize=n.width-i.planStartPadding-i.planEndPadding):(i.maximumRowLength=n.width-i.rowStartPadding-i.rowEndPadding,i.fitToPlanSize=n.height-i.planStartPadding-i.planEndPadding),i},_scfl_distributeChildrenIntoRows:function(e){var t=this.get("childViews"),n,r,i=t.length,s=e.isVertical,o=[],u;u=-1,r=0;while(r<i&&r!==u){u=r;var a={plan:e,rowLength:undefined,rowSize:undefined,shouldExpand:undefined,items:undefined,position:undefined};r=this._scfl_distributeChildrenIntoRow(t,r,a),o.push(a)}e.rows=o},_scfl_distributeChildrenIntoRow:function(e,t,n){var r,i=e.length,s=n.plan,o,u,a,f=[],l=0,c=s.isVertical,h,p,d,v=this.get("canWrap"),m=NO,g=0,y=n.plan.maximumRowLength;for(r=t;r<i;r++){o=e[r],m=m||f.length>0&&o.get("startsNewRow");if(!this.shouldIncludeChildInFlow(r,o))continue;u=this.flowSizeForChild(r,o),a=this.flowSpacingForChild(r,o),u.width+=a.left+a.right,u.height+=a.top+a.bottom,p=u[c?"height":"width"],SC.none(u.maxSpacerLength)||(d=u.maxSpacerLength+(c?a.top+a.bottom:a.left+a.right)),h=u[c?"width":"height"];if((m||v&&l+p>y)&&f.length>0)break;var b={child:o,itemLength:p,maxSpacerLength:d,itemSize:h,spacing:a,position:undefined,fillRow:c?o.get("fillWidth"):o.get("fillHeight"),isSpacer:o.get("isSpacer"),left:undefined,top:undefined,width
:undefined,height:undefined};f.push(b),l+=p,g=Math.max(p,g)}n.rowLength=l;var w=v?g:n.rowLength;return n.plan.maximumCollapsedRowLength=Math.max(w,n.plan.maximumCollapsedRowLength),n.items=f,r},_scfl_positionChildrenInRows:function(e){var t=e.rows,n=t.length,r;for(r=0;r<n;r++)this._scfl_positionChildrenInRow(t[r])},_scfl_positionChildrenInRow:function(e){var t=e.items,n=t.length,r,i,s,o=0,u=0,a,f=e.plan.align,l=YES,c=0,h=NO;for(r=0;r<n;r++)i=t[r],i.isSpacer&&(u+=i.child.get("spaceUnits")||1);f===SC.ALIGN_JUSTIFY&&(u+=n-1),a=Math.max(0,e.plan.maximumRowLength-e.rowLength)/u;while(a>0){for(r=0;r<n;r++)i=t[r],i.isSpacer&&(i.itemLength+=a*(i.child.get("spaceUnits")||1),i.itemLength>i.maxSpacerLength?(c+=i.itemLength-i.maxSpacerLength,i.itemLength=i.maxSpacerLength):h=YES);if(!h)break;a=Math.round(c/u),c=0}s=0,u!==0||f!==SC.ALIGN_RIGHT&&f!==SC.ALIGN_BOTTOM?u===0&&(f===SC.ALIGN_CENTER||f===SC.ALIGN_MIDDLE)&&(s=e.plan.maximumRowLength/2-e.rowLength/2):s=e.plan.maximumRowLength-e.rowLength,s+=e.plan.rowStartPadding;for(r=0;r<n;r++)i=t[r],i.fillRow||(l=NO),o=Math.max(i.itemSize,o),i.position=s,s+=i.itemLength,f===SC.ALIGN_JUSTIFY&&r<n-1&&(s+=a);e.shouldExpand=n>0?l:NO,e.rowLength=s-e.plan.rowStartPadding,e.rowSize=o,e.plan.totalCollapsedRowSize+=e.rowSize},_scfl_positionRows:function(e){var t=e.rows,n=t.length,r,i,s,o=0,u=0,a;for(r=0;r<n;r++)t[r].shouldExpand&&o++,u+=t[r].rowSize;a=e.fitToPlanSize-u,s=e.planStartPadding;for(r=0;r<n;r++)i=t[r],i.shouldExpand&&a>0&&(i.rowSize+=a/o,o--),i.position=s,s+=i.rowSize},_scfl_applyPlan:function(e){var t=e.rows,n,r,i,s=0,o=0,u,a,f,l,c,h,p=e.isVertical
;r=t.length;for(n=0;n<r;n++){i=t[n],s=Math.max(s,i.rowLength),o+=i.rowSize,u=i.items,f=u.length;for(a=0;a<f;a++)l=u[a],l.child.beginPropertyChanges(),h=l.fillRow?i.rowSize:l.itemSize,c={left:l.spacing.left+(p?i.position:l.position),top:l.spacing.top+(p?l.position:i.position),width:p?h:l.itemLength,height:p?l.itemLength:h},c.width-=l.spacing.left+l.spacing.right,c.height-=l.spacing.top+l.spacing.bottom,this.applyPlanToView(l.child,c),l.child._scfl_lastLayout=c,l.child.endPropertyChanges()}o+=e.planStartPadding+e.planEndPadding,s+=e.rowStartPadding+e.rowEndPadding,this.beginPropertyChanges(),this.set("calculatedHeight",p?s:o),this.set("calculatedWidth",p?o:s),this.set("_scfl_maximumCollapsedRowLength",e.maximumCollapsedRowLength),this.set("_scfl_totalCollapsedRowSize",e.totalCollapsedRowSize),this.endPropertyChanges()},applyPlanToView:function(e,t){e.adjust(t)},_scfl_tileOnce:function(){this.invokeLast(this._scfl_tile)},_scfl_tile:function(){if(!this.get("isVisibleInWindow"))return;var e=this._scfl_createPlan();this._scfl_distributeChildrenIntoRows(e),this._scfl_positionChildrenInRows(e),this._scfl_positionRows(e),this._scfl_applyPlan(e),this.setIfChanged("numberOfRows",e.rows.length);var t=this._scfl_isObserving||SC.CoreSet.create(),n=SC.CoreSet.create(),r=this.get("childViews"),i=r.length,s,o;for(s=0;s<i;s++)o=r[s],t.contains(o)?t.remove(o):this.observeChildLayout(o),n.add(o);i=t.length;for(s=0;s<i;s++)this.unobserveChildLayout(t[s])},_scfl_frameDidChange:function(){var e=this.get("frame"),t=this._scfl_lastFrameSize||{};this._scfl_lastFrameSize=SC.clone(e);if(t.width==e.width&&
t.height==e.height)return;this._scfl_tileOnce()}.observes("frame"),destroyMixin:function(){var e=this._scfl_isObserving;if(!e)return;var t=e.length,n;for(n=0;n<t;n++)this.unobserveChildLayout(e[n])},reorder:function(e){!SC.typeOf(e)===SC.T_ARRAY&&(e=arguments);var t=e.length,n=this.childViews,r;this.beginPropertyChanges();while(t-->0)r=e[t],SC.typeOf(r)===SC.T_STRING&&(r=this.get(r)),n.removeObject(r),n.unshiftObject(r);return this.endPropertyChanges(),this._scfl_childViewsDidChange(),this}},SC.Gesturable={concatenatedProperties:["gestures"],gestures:[],initMixin:function(){this.createGestures()},createGestures:function(){var e=this.get("gestures"),t,n=e.length,r,i=[];for(t=0;t<n;t++){SC.typeOf(e[t])===SC.T_STRING?r=this.get(e[t]):r=e[t];if(!r)throw"Could not find gesture named '"+e[t]+"' on view.";r.isClass&&(r=r.create({view:this})),SC.typeOf(e[t])===SC.T_STRING&&(this[e[t]]=r),i.push(r)}this.set("gestures",i)},touchStart:function(e){this.gestureTouchStart(e)},touchesDragged:function(e,t){this.gestureTouchesDragged(e,t)},touchEnd:function(e){this.gestureTouchEnd(e)},gestureTouchStart:function(e){e.isInteresting=0;var t=this.get("gestures"),n,r=t.length,i;for(n=0;n<r;n++)i=t[n],i.unassignedTouchDidStart(e)},gestureTouchesDragged:function(e,t){var n=this.get("gestures"),r,i=n.length,s;for(r=0;r<i;r++)s=n[r],s.unassignedTouchesDidChange(e,t)},gestureTouchEnd:function(e){var t=this.get("gestures"),n,r=t.length,i;for(n=0;n<r;n++)i=t[n],i.unassignedTouchDidEnd(e)}},SC.InlineEditable={isInlineEditable:YES,isEditable:YES,exampleEditor:SC.InlineTextFieldView,isEditing:NO,inlineEditorDelegate
:SC.InlineTextFieldDelegate,_editor:null,beginEditing:function(){var e;return e=this.delegateFor("inlineEditorShouldBeginEditing",this.inlineEditorDelegate),e&&!e.inlineEditorShouldBeginEditing(this,this.get("value"))?NO:(this._editor=this.invokeDelegateMethod(this.inlineEditorDelegate,"acquireEditor",this),this._editor?this._editor.beginEditing(this):NO)},commitEditing:function(){return this._editor?this._editor.commitEditing():NO},discardEditing:function(){return this._editor?this._editor.discardEditing():NO},inlineEditorShouldBeginEditing:function(){return!this.get("isEditing")&&this.get("isEditable")},inlineEditorWillBeginEditing:function(e,t,n){e.set("value",this.get("value"))},inlineEditorDidBeginEditing:function(e,t,n){this.set("isEditing",YES)},inlineEditorWillCommmitEditing:function(e,t,n){this.inlineEditorWillEndEditing&&this.inlineEditorWillEndEditing(e,t)},inlineEditorDidCommitEditing:function(e,t,n){n.setIfChanged("value",t),this.inlineEditorDidEndEditing&&this.inlineEditorDidEndEditing(e,t),this._endEditing()},inlineEditorWillDiscardEditing:function(e,t){this.inlineEditorWillEndEditing&&this.inlineEditorWillEndEditing(e,this.get("value"))},inlineEditorDidDiscardEditing:function(e,t){this.inlineEditorDidEndEditing&&this.inlineEditorDidEndEditing(e,this.get("value")),this._endEditing()},_endEditing:function(){this._editor&&(this.invokeDelegateMethod(this.inlineEditorDelegate,"releaseEditor",this._editor),this._editor=null),this.set("isEditing",NO)}},SC.InlineEditor={isInlineEditor:YES,isEditing:NO,inlineEditorDelegate:null,_target:null,beginEditing:function(e){if(
this.get("isEditing")||!e||!e.isInlineEditable)return NO;var t,n;return n=this._target=e,t=this.delegateFor("inlineEditorWillBeginEditing",this.inlineEditorDelegate,n),t&&t.inlineEditorWillBeginEditing(this,this.get("value"),n),this.set("isEditing",YES),this.invokeLast(this._callDidBegin),this._didBeginInvoked=YES,YES},_callDidBegin:function(){if(!this.get("isEditing"))return NO;this._didBeginInvoked=NO;var e=this._target,t;t=this.delegateFor("inlineEditorDidBeginEditing",this.inlineEditorDelegate,e),t&&t.inlineEditorDidBeginEditing(this,this.get("value"),e)},commitEditing:function(){if(!this.get("isEditing"))return NO;this._didBeginInvoked&&this._callDidBegin();var e,t=this._target;return e=this.delegateFor("inlineEditorShouldCommitEditing",this.inlineEditorDelegate,t),e&&!e.inlineEditorShouldCommitEditing(this,this.get("value"),t)?NO:(e=this.delegateFor("inlineEditorWillCommitEditing",this.inlineEditorDelegate,t),e&&e.inlineEditorWillCommitEditing(this,this.get("value"),t),this._endEditing(),e=this.delegateFor("inlineEditorDidCommitEditing",this.inlineEditorDelegate,t),e&&e.inlineEditorDidCommitEditing(this,this.get("value"),t),YES)},discardEditing:function(){if(!this.get("isEditing"))return NO;this._didBeginInvoked&&this._callDidBegin();var e,t=this._target;return e=this.delegateFor("inlineEditorShouldDiscardEditing",this.inlineEditorDelegate,t),e&&!e.inlineEditorShouldDiscardEditing(this,t)?NO:(e=this.delegateFor("inlineEditorWillDiscardEditing",this.inlineEditorDelegate,t),e&&e.inlineEditorWillDiscardEditing(this,t),this._endEditing(),e=this.delegateFor("inlineEditorDidDiscardEditing"
,this.inlineEditorDelegate,t),e&&e.inlineEditorDidDiscardEditing(this,t),YES)},_endEditing:function(){this.set("isEditing",NO),this._target=null}},SC.InlineEditorDelegate={acquireEditor:function(e){},releaseEditor:function(e){},inlineEditorShouldBeginEditing:function(e,t){},inlineEditorWillBeginEditing:function(e,t,n){},inlineEditorDidBeginEditing:function(e,t,n){},inlineEditorShouldCommitEditing:function(e,t,n){},inlineEditorWillCommitEditing:function(e,t,n){},inlineEditorDidCommitEditing:function(e,t,n){},inlineEditorShouldDiscardEditing:function(e,t){},inlineEditorWillDiscardEditing:function(e,t){},inlineEditorDidDiscardEditing:function(e,t){},inlineEditorWillEndEditing:function(e,t,n){},inlineEditorDidEndEditing:function(e,t,n){}},SC.SCALE_NONE="none",SC.FILL="fill",SC.FILL_PROPORTIONALLY="fillProportionally",SC.BEST_FIT="fitBest",SC.BEST_FIT_DOWN_ONLY="fitBestDown",SC.InnerFrame={align:SC.ALIGN_CENTER,innerFrameForSize:function(e,t,n,r){var i=this.get("align"),s=this.get("scale"),o,u,a;a={x:0,y:0,width:n,height:r};if(s===SC.FILL)return a;o=n/e,u=r/t;switch(s){case SC.FILL_PROPORTIONALLY:s=o>u?o:u;break;case SC.BEST_FIT:s=o<u?o:u;break;case SC.BEST_FIT_DOWN_ONLY:e>n||t>r?s=o<u?o:u:s=1;break;case SC.SCALE_NONE:s=1;break;default:if(isNaN(window.parseFloat(s))||window.parseFloat(s)<=0)return SC.Logger.warn("SC.InnerFrame: The scale '%@' was not understood.  Scale must be one of SC.FILL, SC.FILL_PROPORTIONALLY, SC.BEST_FIT, SC.BEST_FIT_DOWN_ONLY or a positive number greater than 0.00.".fmt(s)),a}e*=s,t*=s,a.width=Math.round(e),a.height=Math.round(t);switch(i){case SC.ALIGN_LEFT
:a.x=0,a.y=r/2-t/2;break;case SC.ALIGN_RIGHT:a.x=n-e,a.y=r/2-t/2;break;case SC.ALIGN_TOP:a.x=n/2-e/2,a.y=0;break;case SC.ALIGN_BOTTOM:a.x=n/2-e/2,a.y=r-t;break;case SC.ALIGN_TOP_LEFT:a.x=0,a.y=0;break;case SC.ALIGN_TOP_RIGHT:a.x=n-e,a.y=0;break;case SC.ALIGN_BOTTOM_LEFT:a.x=0,a.y=r-t;break;case SC.ALIGN_BOTTOM_RIGHT:a.x=n-e,a.y=r-t;break;default:i!==SC.ALIGN_CENTER&&i!==SC.ALIGN_MIDDLE&&SC.Logger.warn("SC.InnerFrame: The align '%@' was not understood.  Align must be one of SC.ALIGN_CENTER/SC.ALIGN_MIDDLE, SC.ALIGN_LEFT, SC.ALIGN_RIGHT, SC.ALIGN_TOP, SC.ALIGN_BOTTOM, SC.ALIGN_TOP_LEFT, SC.ALIGN_TOP_RIGHT, SC.ALIGN_BOTTOM_LEFT or SC.ALIGN_BOTTOM_RIGHT.".fmt(i)),a.x=n/2-e/2,a.y=r/2-t/2}return a},scale:SC.FILL},SC.StaticLayout={hasStaticLayout:YES},SC.Validatable={initMixin:function(){this._validatable_validatorDidChange()},validator:null,errorLabel:null,isValid:function(){return SC.typeOf(this.get("value"))!==SC.T_ERROR}.property("value"),ownerForm:null,performValidate:function(e){var t=SC.VALIDATE_OK;if(this._validator){var n=this.get("ownerForm");e?(t=this._validator.validatePartial(n,this),t==SC.VALIDATE_NO_CHANGE&&this._validator.validateChange(n,this)==SC.VALIDATE_OK&&(t=SC.VALIDATE_OK)):t=this._validator.validateChange(n,this)}return t},performValidateSubmit:function(){return this._validator?this._validator.validateSubmit(this.get("ownerForm"),this):SC.VALIDATE_OK},performValidateKeyDown:function(e){var t=e.getCharString();return t?this._validator?this._validator.validateKeyDown(this.get("ownerForm"),this,t):YES:YES},validatorObject:function(){return this._validator}.property
(),validateSubmit:function(){return this.performValidateSubmit()},objectForFieldValue:function(e,t){return this._validator?this._validator.objectForFieldValue(e,this.get("ownerForm"),this):e},fieldValueForObject:function(e){return this._validator?this._validator.fieldValueForObject(e,this.get("ownerForm"),this):e},_validatable_displayObserver:function(){this.displayDidChange()}.observes("isValid"),renderMixin:function(e){e.setClass("invalid",!this.get("isValid"))},_validatable_validatorDidChange:function(){var e=this.get("ownerForm"),t=SC.Validator.findFor(e,this,this.get("validator"));t!=this._validator&&(this.propertyWillChange("validatorObject"),this._validator&&this._validator.detachFrom(e,this),this._validator=t,this._validator&&this._validator.attachTo(e,this),this.propertyDidChange("validatorObject"))}.observes("validator","ownerForm")},SC.RenderDelegate={create:function(){var e=SC.beget(this),t,n=arguments.length;for(t=0;t<n;t++)e.mixin(arguments[t]);return e},reopen:function(e){var t,n;for(t in e){n=e[t];if(!e.hasOwnProperty(t))continue;typeof n=="function"&&n!==this[t]&&(n.base=this[t]||SC.K),n&&n.isEnhancement&&n!==this[t]&&(n=SC._enhance(this[t]||SC.K,n)),this[t]=n}},get:function(e){return this[e]},getPropertyFor:function(e,t){return this[t+"For"]?this[t+"For"](e,t):this[t]},className:undefined,render:function(e,t){},update:function(e,t){}},SC.RenderDelegate.extend=SC.RenderDelegate.create,SC.RenderDelegate.mixin=SC.RenderDelegate.reopen,SC.BaseTheme.canvasImageRenderDelegate=SC.RenderDelegate.create({className:"canvasImage",render:function(e,t){var n=e.get("width"
)||0,r=e.get("height")||0;t.attr("width",n),t.attr("height",r)},update:function(e,t){var n=t[0],r=e.get("image"),i=e.get("frame"),s=i.width,o=i.height,u=e.get("innerFrame"),a=e.get("backgroundColor"),f=e.get("renderState"),l,c=![u.x,u.y,u.width,u.height].isEqual(f._lastInnerFrameValues),h=![n.width,n.height].isEqual(f._lastElemSizeValues),p=e.didChangeFor("canvasImageRenderDelegate","backgroundColor"),d=e.didChangeFor("canvasImageRenderDelegate","image")||(r&&r.complete)!==f._lastImageComplete;if(h||c||p||d)n&&n.getContext&&(n.height=o,n.width=s,l=n.getContext("2d"),l.clearRect(0,0,s,o),a&&(l.fillStyle=a,l.fillRect(0,0,s,o)),r&&r.complete&&l.drawImage(r,Math.floor(u.x),Math.floor(u.y),Math.floor(u.width),Math.floor(u.height))),f._lastInnerFrameValues=[u.x,u.y,u.width,u.height],f._lastElemSizeValues=[n.width,n.height],f._lastImageComplete=r&&r.complete}}),SC.BaseTheme.containerRenderDelegate=SC.RenderDelegate.create({render:function(e,t){},update:function(){}}),SC.RenderDelegate.reopen({sizes:[SC.TINY_CONTROL_SIZE,SC.SMALL_CONTROL_SIZE,SC.REGULAR_CONTROL_SIZE,SC.LARGE_CONTROL_SIZE,SC.HUGE_CONTROL_SIZE,SC.JUMBO_CONTROL_SIZE],sizeFor:function(e){var t=e.get("controlSize"),n,r,i;if(t)return this[t]||(this[t]={}),n=this[t],n.name||(n.name=t),n;var s=e.get("frame");if(!s)return n=this["sc-regular-size"],n||(n=this["sc-regular-size"]={}),n.name||(n.name="sc-regular-size"),n;for(r=0;r<i;r++){key=sizes[r],n=this[key];if(!n)continue;if(n.width===undefined&&n.height===undefined&&n.minHeight===undefined&&n.minWidth===undefined&&n.maxHeight===undefined&&n.maxWidth===undefined||n.width!==
undefined&&s.width!==n.width||n.minWidth!==undefined&&s.width<n.minWidth||n.maxWidth!==undefined&&s.width>n.maxWidth||n.height!==undefined&&s.height!==n.height||n.minHeight!==undefined&&s.height<n.minHeight||n.maxHeight!==undefined&&s.height<n.maxHeight)continue;return n.name||(n.name=key),n}return n=this["sc-regular-size"],n||(n=this["sc-regular-size"]={}),n.name||(n.name="sc-regular-size"),n},addSizeClassName:function(e,t){var n=this.sizeFor(e);n&&t.addClass(n.name)},updateSizeClassName:function(e,t){var n=this.sizeFor(e);n&&t.addClass(n.name)},getPropertyFor:function(e,t){var n=this.sizeFor(e);if(n){if(n[t+"For"])return n[t+"For"](e,t);if(n[t]!==undefined)return n[t]}return this[t+"For"]?this[t+"For"]:this[t]}}),SC.BaseTheme.imageRenderDelegate=SC.RenderDelegate.create({className:"image",render:function(e,t){var n=e.get("image"),r=e.get("imageValue"),i=e.get("type")||SC.IMAGE_TYPE_URL,s=e.get("toolTip");t=t.begin("img"),t.attr("src",n.src),r&&i===SC.IMAGE_TYPE_CSS_CLASS&&(t.addClass(r),this._last_class=r),s&&(t.attr("title",s),t.attr("aria-label",s)),t.addStyle(this.imageStyles(e)),t=t.end()},update:function(e,t){var n=e.get("image"),r=e.get("imageValue"),i=e.get("toolTip");t=t.find("img"),t.attr("src",n.src),r!==this._last_class&&t.setClass(this._last_class,NO),r&&(t.addClass(r),this._last_class=r),i&&(t.attr("title",i),t.attr("alt",i)),t.css(this.imageStyles(e))},imageStyles:function(e){var t=e.get("innerFrame");return{position:"absolute",left:Math.round(t.x),top:Math.round(t.y),width:Math.round(t.width),height:Math.round(t.height)}}}),SC.BaseTheme.labelRenderDelegate=SC
.RenderDelegate.create({className:"label",render:function(e,t){this.addSizeClassName(e,t);var n=e.get("fontWeight"),r=e.get("textAlign");(n||r)&&t.addStyle({fontWeight:n||null,textAlign:r||null}),t.setClass("ellipsis",e.get("needsEllipsis")||NO),t.setClass("icon",e.get("icon")||NO);var i=this.htmlForTitleAndIcon(e);t.push(i),e.get("renderState")._lastHTMLForTitleAndIcon=i},update:function(e,t){this.updateSizeClassName(e,t);var n=e.get("fontWeight"),r=e.get("textAlign");(n||r)&&t.css({fontWeight:n||null,textAlign:r||null}),t.setClass("ellipsis",e.get("needsEllipsis")||NO);var i=this.htmlForTitleAndIcon(e);e.get("renderState")._lastHTMLForTitleAndIcon!==i&&(t.html(i),e.get("renderState")._lastHTMLForTitleAndIcon=i)},htmlForTitleAndIcon:function(e){var t=e.get("title"),n=e.get("hint"),r=e.get("hintEnabled"),i=e.get("escapeHTML"),s=e.get("icon")||"";return t&&i&&(t=SC.RenderContext.escapeHTML(t)),r&&n&&!t&&(i&&(n=SC.RenderContext.escapeHTML(n)),t="<span class='sc-hint'>"+n+"</span>"),s&&(s.indexOf("/")>=0?s='<img src="'+s+'" class="icon" />':s='<img src="'+SC.BLANK_IMAGE_URL+'" class="icon '+s+'" />'),s+t}}),SC.Benchmark={verbose:NO,enabled:YES,events:{},stats:{},globalStartTime:null,addEvent:function(e,t){t||(t=SC.getCurrentTimeForPerformance()),this.events[e]=t},start:function(e,t,n,r){if(!this.enabled)return;var i=n||SC.getCurrentTimeForPerformance(),s;return t?s=this._subStatFor(e,t):s=this._statFor(e),r&&s._starts.length>0?s._starts.push("ignore"):s._starts.push(i),s._times.push({start:i,_subStats:{}}),e},end:function(e,t,n){var r,i,s;if(!this.enabled)return;t?r=this._subStatFor
(e,t):r=this._statFor(e),i=r._starts,i&&(s=i.pop());if(!s){SC.Logger.log('SC.Benchmark "%@" ended without a matching start.  No information was saved.'.fmt(e));return}if(s=="ignore")return;var o=n||SC.getCurrentTimeForPerformance(),u=o-s;r._times[r._times.length-1].end=o,r._times[r._times.length-1].dur=u,r.amt+=u,r.runs++,this.verbose&&this.log(e)},setGlobalStartTime:function(e){this.globalStartTime=e},bench:function(e,t,n){t||(t="bench%@".fmt(this._benchCount++)),n||(n=1);var r;while(--n>=0){var i=SC.Benchmark.start(t);r=e(),SC.Benchmark.end(i)}return r},install:function(e,t,n){e["b__"+t]=e[t];var r=e["b__"+t];e[t]=function(){var e="%@(%@)".fmt(t,$A(arguments).join(", "));SC.Benchmark.start(e,n);var i=r.apply(this,arguments);return SC.Benchmark.end(e),i}},restore:function(e,t){e[t]=e["b__"+t]},report:function(e){if(e)return this._genReport(e);var t=[];for(var n in this.stats){if(!this.stats.hasOwnProperty(n))continue;t.push(this._genReport(n))}return t.join("\n")},timelineReport:function(e){e=e?"SproutCore Application":e;var t=[e,"User-Agent: %@".fmt(navigator.userAgent),"Report Generated: %@ (%@)".fmt((new Date).toString(),Date.now()),""],n=this._compileChartData(!0);for(var r=0;r<n.length;r++)n[r][4]?t.push(this._timelineGenSubReport(n[r])):t.push(this._timelineGenReport(n[r]));return t.join("\n")},getTimelineChartContent:function(){var e=this._compileChartData(!1),t=e.length;if(t===0)return;var n=this.globalStartTime?this.globalStartTime:e[0][1],r=e[t-1][2]-n,i=25+t*30,s=Math.ceil(r/200)+1,o=s*50,u=10,a=300,f="<div class = 'sc-benchmark-timeline-chart' style = 'position:relative;'>"
;f+="<div class = 'sc-benchmark-top'></div>";for(var l=0;l<s;l++)f+="<div class = 'sc-benchmark-tick' style = '",f+="left: "+(u+l*50)+"px; ",f+="height: "+i+"px;",f+="'></div>",f+="<div class = 'sc-benchmark-tick-label' style = '",f+="left: "+(u+l*50)+"px; ",f+="'>"+l*200+"ms</div>";for(l=0;l<t;l++){f+="<div class = 'sc-benchmark-row ",f+=l%2===0?"even":"odd",f+="' style = '",f+="top: "+(50+l*30)+"px; ",f+="'></div>";var c=document.createElement("div"),h=e[l][1],p=e[l][2],d=e[l][3];f+="<div class = 'sc-benchmark-bar' style = '",f+="left:"+(u+(h-n)/4)+"px; width: "+d/4+"px;",f+="top: "+(28+l*30)+"px;",f+="' title = 'start: "+(h-n)+" ms, end: "+(p-n)+" ms, duration: "+d+" ms'",f+=">",f+="&nbsp;"+e[l][0]+" <span class='sc-benchmark-emphasis'>",f+=d+"ms (start: "+(h-n)+"ms)",f+="</span>",f+="</div>"}var v=this.events,m=0;for(l in v){var g=v[l]-n;f+="<div class = 'sc-benchmark-event idx"+m%10+"' style = '",f+="left: "+(u+g/4)+"px; height: "+i+"px; top: 20px;",f+="' title = '"+l+": "+g+"'></div>",m++}return f+="</div>",{html:f,totalCapturedTime:r,pointsCaptured:t,width:o+u+a,height:i}},getTimelineChartView:function(){var e=SC.ScrollView.create({contentView:SC.StaticContentView.extend({}),reload:function(){var e=SC.Benchmark.getTimelineChartContent();this.contentView.set("content",e.html),this.contentView.adjust({width:e.width,height:e.height}),this.chartContent=e,SC.RunLoop.invokeLater(SC.Benchmark,function(){this.contentView.notifyPropertyChange("frame")})}});return e.reload(),e},timelineChart:function(e){SC.RunLoop.begin();var t=0;this.hideChart();var n=this.getTimelineChartView
(),r=n.chartContent.pointsCaptured,i=n.chartContent.totalCapturedTime;this._benchmarkChart=SC.Pane.create({classNames:["sc-benchmark-pane"],layout:{left:20,right:20,bottom:20,top:20},childViews:["title","exit"],exit:SC.ButtonView.extend({layout:{right:20,top:20,width:100,height:30},title:"Hide Chart",target:this,action:"hideChart"}),title:SC.LabelView.extend({classNames:["sc-benchmark-title"],layout:{left:20,top:23,right:200,height:30},value:(e?e:"SproutCore Application")+(" - Total Captured Time: "+i+" ms - Points Captured: "+r),fontWeight:"bold"})}).append(),n.set("layout",{left:20,top:60,bottom:20,right:20}),this._benchmarkChart.appendChild(n),SC.RunLoop.end()},hideChart:function(){return this._benchmarkChart&&(this._benchmarkChart.remove(),this._benchmarkChart=null),YES},tryToPerform:function(e,t){return this[e]?this[e](t):NO},log:function(e){var t=this.report(e).split("\n"),n=t.length,r;for(r=0;r<n;r++)SC.Logger.log(t[r])},startProfile:function(e){if(!this.enabled)return;SC.Logger.profile(e)},endProfile:function(e){if(!this.enabled)return;SC.Logger.profileEnd(e)},loadPreloadEvents:function(){var e=SC.benchmarkPreloadEvents,t=[],n,r,i;typeof webkitPerformnce!="undefined"&&SC.mixin(e,webkitPerformane.timing);if(!this.globalStartTime){var s=["navigation","navigationStart","headStart"];r=s.length;for(n=0;n<r;n++)if(e[s[n]]){this.globalStartTime=e[s[n]];break}}this.javascriptStartTime=e.headStart,SC.mixin(this.events,e),this._hasLoadedPreloadEvents=!0},_loadBenchmarksFromEvents:function(){this._hasLoadedPreloadEvents||this.loadPreloadEvents();var e=this.events;for(var t in e
){if(t.substr(-3)!=="End")continue;var n=t.substr(0,t.length-3);if(!e[n+"Start"])continue;SC.Benchmark.start(n,undefined,e[n+"Start"]),SC.Benchmark.end(n,undefined,e[n+"End"]),delete e[n+"Start"],delete e[n+"End"]}},_compileChartData:function(e){this._loadBenchmarksFromEvents();var t=[],n;for(var r in this.stats){var i=this.stats[r];for(var s=0;s<i._times.length;s++){var o=i._times[s];n=i._times.length>1?s+1+" - "+r:r,t.push([n,o.start,o.end,o.dur,!1]);if(e){var u=o._subStats;for(var a in u){var f=u[a];for(var l=0;l<f._times.length;l++){var c=f._times[l];n=f._times.length>1?l+1+" - "+a:a,t.push([n,c.start,c.end,c.dur,!0])}}}}}return t.sort(function(e,t){return e[1]<t[1]?-1:e[1]==t[1]?e[3]&&!t[3]?-1:!e[3]&&t[3]?1:0:1}),t},_genReport:function(e){var t=this._statFor(e),n=t.runs>0?Math.floor(t.amt*1e3/t.runs)/1e3:0,r=t._times[t._times.length-1];return"BENCH %@ msec: %@ (%@x); latest: %@".fmt(n,t.name||e,t.runs,r.end-r.start)},_timelineGenReport:function(e){return this.globalStartTime?"BENCH start: %@ msec, duration: %@ msec,  %@".fmt(e[1]-this.globalStartTime,e[3],e[0]):"BENCH duration: %@ msec, %@".fmt(e[3],e[0])},_timelineGenSubReport:function(e){return this.globalStartTime?"   CHECKPOINT BENCH start: %@ msec, duration: %@ msec,  %@".fmt(e[1]-this.globalStartTime,e[3],e[0]):"   CHECKPOINT BENCH duration: %@ msec, %@".fmt(e[3],e[0])},_subStatFor:function(e,t){var n=this.stats[t]._times.length;if(n===0)return;var r=this.stats[t]._times[this.stats[t]._times.length-1]._subStats,i=r[e];return i||(r[e]={runs:0,amt:0,name:e,_starts:[],_times:[]},i=r[e]),i},_statFor:function(e){var t=
this.stats[e];return t||(t=this.stats[e]={runs:0,amt:0,name:e,_starts:[],_times:[]},t=this.stats[e]),t},reset:function(){this.stats={}},_bench:function(e,t){SC.Benchmark.bench(e,t,1)},_benchCount:1},SC.Benchmark=SC.Benchmark,SC.Cookie=SC.Object.extend({name:null,value:"",expires:null,path:null,domain:null,secure:NO,isCookie:YES,destroy:function(){this.set("expires",-1),this.write(),arguments.callee.base.apply(this,arguments)},write:function(){var e=this.get("name"),t=this.get("value"),n=this.get("expires"),r=this.get("path"),i=this.get("domain"),s=this.get("secure"),o="",u;return n&&(typeof n===SC.T_NUMBER?(u=new Date,u.setTime(u.getTime()+n*24*60*60*1e3)):SC.DateTime&&n.get&&n.get("milliseconds")?u=new Date(n.get("milliseconds")):n.toUTCString&&n.toUTCString.apply&&(u=n),u&&(o="; expires="+u.toUTCString())),SC.none(r)||(o+="; path="+r),SC.none(i)||(o+="; domain="+i),s===YES&&(o+="; secure"),document.cookie=e+"="+encodeURIComponent(t)+o,this}}),SC.Cookie.mixin({find:function(e){if(document.cookie&&document.cookie!==""){var t=document.cookie.split(";");for(var n=0;n<t.length;n++){var r=SC.String.trim(String(t[n]));if(r.substring(0,e.length+1)===e+"=")return SC.Cookie.create({name:e,value:decodeURIComponent(r.substring(e.length+1))})}}return null}}),SC.CookieMonster={nomNomNom:function(e){var t=SC.kindOf(e,SC.Cookie);return t?(SC.Logger.log("YUM!"),e.destroy()):(SC.Logger.error("Y U PASS ME NO COOKIE? %@",e),NO)}},SC.mixin(SC.$.fn,{setClass:function(e,t){if(SC.none(e))return this;var n=SC.typeOf(e)!==SC.T_STRING,r=this._fixupClass,i;return this.each(function(){if(this.nodeType!==1
)return;var i=this.className.split(/\s+/),s=NO;if(n)for(var o in e)e.hasOwnProperty(o)&&(s=r(i,o,e[o])||s);else s=r(i,e,t);s&&(this.className=i.join(" "))}),this},_fixupClass:function(e,t,n){var r=e.indexOf(t);if(n){if(r<0)return e.push(t),YES}else if(r>=0)return e[r]=null,YES;return NO}}),SC.ExceptionHandler={enabled:SC.buildMode!=="debug",handleException:function(e){return this.isShowingErrorDialog?NO:(this._displayErrorDialog(e),NO)},_displayErrorDialog:function(e){var t=this._errorDialogHTMLForException(e),n=document.createElement("div");n.style.cssText="left: 0px; right: 0px; top: 0px; bottom: 0px; position: absolute; background-color: white; background-color: rgba(255,255,255,0.6); z-index:100;",n.innerHTML=t,document.body.appendChild(n),this.isShowingErrorDialog=YES},_errorDialogHTMLForException:function(e){var t;return t=['<div id="sc-error-dialog" style="position: absolute; width: 500px; left: 50%; top: 50%; margin-left: -250px; background-color: white; border: 1px solid black; font-family: Monaco, monospace; font-size: 9px; letter-spacing: 1px; padding: 10px">',"An error has occurred which prevents the application from running:","<br><br>",e.message,'<div id="sc-error-dialog-reload-button" onclick="window.location.reload();" style="float: right; font-family: Monaco, monospace; font-size: 9px; letter-spacing: 1px; border: 1px solid black; padding: 3px; clear: both; margin-top: 20px; cursor: pointer;">',"Reload","</div>","</div>"],t.join("")},isShowingErrorDialog:NO},SC.IMAGE_ABORTED_ERROR=SC.$error("SC.Image.AbortedError","Image",-100),SC.IMAGE_FAILED_ERROR=SC.$error
("SC.Image.FailedError","Image",-101),SC.imageQueue=SC.Object.create({loadLimit:4,activeRequests:0,loadImage:function(e,t,n,r){var i=SC.typeOf(t);SC.none(n)&&SC.typeOf(t)===SC.T_FUNCTION&&(t=null,n=t),SC.typeOf(n)===SC.T_STRING&&(n=t[n]),SC.none(r)&&(r=SC.none(t)&&SC.none(n));var s=this._imageEntryFor(e);s.status===this.IMAGE_LOADED?n&&n.call(t||s.image,s.url,s.image):((t||n)&&this._addCallback(s,t,n),s.retainCount++,this._scheduleImageEntry(s,r))},releaseImage:function(e,t,n){var r=this._imageEntryFor(e,NO);if(!r)return this;if(--r.retainCount<=0)this._deleteEntry(r);else if(t||n){var i=SC.typeOf(t);SC.none(n)&&SC.typeOf(t)===SC.T_FUNCTION&&(t=null,n=t),SC.typeOf(n)===SC.T_STRING&&(n=t[n]),this._removeCallback(r,t,n)}},reloadImage:function(e){var t=this._imageEntryFor(e,NO);t&&t.status===this.IMAGE_LOADED&&(t.status=this.IMAGE_WAITING)},loadNextImage:function(){var e=null,t;if(this.get("activeRequests")>=this.get("loadLimit"))return;t=this._foregroundQueue;while(t.length>0&&!e)e=t.shift();if(!e){t=this._backgroundQueue;while(t.length>0&&!e)e=t.shift()}this.set("isLoading",!!e);if(e){var n=e.image;if(!n)return;var r=SC.$(n);r.length!==0?(r.bind("abort",this._imageDidAbort),r.bind("error",this._imageDidError),r.bind("load",this._imageDidLoad),n.src=e.url,this._loading.push(e)):e.url?SC.error("Unable to load the image for url %@".fmt(e.url)):SC.error("entry does not contain any url. Its an invalid entry"),this.incrementProperty("activeRequests"),this.loadNextImage()}},_imageEntryFor:function(e,t){t===undefined&&(t=YES);var n=this._images[e];if(!n&&t){var r=new Image;n=this._images
[e]={url:e,status:this.IMAGE_WAITING,callbacks:[],retainCount:0,image:r},r.entry=n}return n},_deleteEntry:function(e){this._unscheduleImageEntry(e),delete this._images[e.url]},_addCallback:function(e,t,n){var r=e.callbacks,i=r.find(function(e){return e[0]===t&&e[1]===n},this);return i||r.push([t,n]),r=null,this},_removeCallback:function(e,t,n){var r=e.callbacks;return r.forEach(function(e,i){e[0]===t&&e[1]===n&&(r[i]=null)},this),r=null,this},_scheduleImageEntry:function(e,t){var n=this._backgroundQueue,r=this._foregroundQueue;if(e.status===this.IMAGE_LOADED)return this;e.status===this.IMAGE_QUEUED&&!t&&e.isBackground&&(n[n.indexOf(e)]=null,e.status=this.IMAGE_WAITING);if(e.status!==this.IMAGE_QUEUED){var i=t?n:r;i.push(e),e.status=this.IMAGE_QUEUED,e.isBackground=t}return this.isLoading||this.invokeLater(this.loadNextImage,100),this.set("isLoading",YES),this},_unscheduleImageEntry:function(e){if(e.status!==this.IMAGE_QUEUED)return this;var t=e.isBackground?this._backgroundQueue:this._foregroundQueue;return t[t.indexOf(e)]=null,this._loading.indexOf(e)>=0&&(t.image&&t.image.abort(),this.imageStatusDidChange(e,this.ABORTED)),this},_imageDidAbort:function(){SC.run(function(){SC.imageQueue.imageStatusDidChange(this.entry,SC.imageQueue.ABORTED)},this)},_imageDidError:function(){SC.run(function(){SC.imageQueue.imageStatusDidChange(this.entry,SC.imageQueue.ERROR)},this)},_imageDidLoad:function(){SC.run(function(){SC.imageQueue.imageStatusDidChange(this.entry,SC.imageQueue.LOADED)},this)},imageStatusDidChange:function(e,t){if(!e)return;var n=e.url,r;switch(t){case this.LOADED:r=e.image
;break;case this.ABORTED:r=SC.IMAGE_ABORTED_ERROR;break;case this.ERROR:r=SC.IMAGE_FAILED_ERROR;break;default:r=SC.IMAGE_FAILED_ERROR}e.callbacks.forEach(function(e){var t=e[0],i=e[1];i.call(t,n,r)},this),e.callbacks=[],e.status=t===this.LOADED?this.IMAGE_LOADED:this.IMAGE_WAITING;var i=e.image;i&&(i.onload=i.onerror=i.onabort=null,t!==this.LOADED&&(e.image=null)),this._loading[this._loading.indexOf(e)]=null,this._loading.length>this.loadLimit*2&&(this._loading=this._loading.compact()),this.decrementProperty("activeRequests"),this.loadNextImage()},init:function(){arguments.callee.base.apply(this,arguments),this._images={},this._loading=[],this._foregroundQueue=[],this._backgroundQueue=[]},IMAGE_LOADED:"loaded",IMAGE_QUEUED:"queued",IMAGE_WAITING:"waiting",ABORTED:"aborted",ERROR:"error",LOADED:"loaded"}),SC.Math=SC.Object.create({near:function(e,t,n){return n||(n=1e-5),Math.abs(e-t)<=n},round:function(e,t){t||(t=0);var n=Math.pow(10,t);if(t<0){var r=n.toString();n=r.substring(0,r.indexOf("1")+1)}return e=e.valueOf(),Math.round(e*n)/n}}),SC.Task=SC.Object.extend({run:function(e){}}),SC.LOG_MODULE_LOADING=YES,SC.Module=SC.Object.create({isModuleReady:function(e){var t=SC.MODULE_INFO[e];return t?!!t.isReady:NO},loadModule:function(e,t,n){var r=SC.MODULE_INFO[e],i,s,o=SC.A(arguments).slice(3),u=SC.LOG_MODULE_LOADING,a,f;n===undefined&&SC.typeOf(t)===SC.T_FUNCTION&&(n=t,t=null),u&&SC.debug("SC.Module: Attempting to load '%@'",e);if(!r)throw"SC.Module: could not find module '%@'".fmt(e);r.isPrefetching=NO;if(r.isLoaded&&!r.isWaitingForRunLoop)return u&&SC.debug("SC.Module: Module '%@' already loaded."
,e),this._dependenciesMetForModule(e)?r.source?(u&&SC.debug("SC.Module: Evaluating JavaScript for module '%@'.",e),this._evaluateStringLoadedModule(r),this._addCallbackForModule(e,t,n,o),this.invokeLast(function(){r.isReady=YES,this._moduleDidBecomeReady(e)}),NO):(n&&(SC.isReady?SC.Module._invokeCallback(e,t,n,o):SC.ready(SC.Module,function(){SC.Module._invokeCallback(e,t,n,o)})),YES):(this._addCallbackForModule(e,t,n,o),this._loadDependenciesForModule(e),NO);if(!r.isWaitingForRunLoop)return u&&SC.debug("SC.Module: Module '%@' is not loaded, loading now.",e),this._addCallbackForModule(e,t,n,o),r.isLoading||(this._loadDependenciesForModule(e),this._loadCSSForModule(e),this._loadJavaScriptForModule(e),r.isLoading=YES),NO;this._addCallbackForModule(e,t,n,o)},_addCallbackForModule:function(e,t,n,r){var i=SC.MODULE_INFO[e],s=i.callbacks||[];n&&s.push(function(){SC.Module._invokeCallback(e,t,n,r)}),i.callbacks=s},prefetchModule:function(e){var t=SC.MODULE_INFO[e];if(t.isLoading||t.isLoaded)return;SC.LOG_MODULE_LOADING&&SC.debug("SC.Module: Prefetching module '%@'.",e),this._loadDependenciesForModule(e),this._loadCSSForModule(e),this._loadJavaScriptForModule(e),t.isLoading=YES,t.isPrefetching=YES},_executeLazilyInstantiatedModule:function(e,t,n){var r=SC.LAZY_INSTANTIATION[e],i,s,o,u;SC.LOG_MODULE_LOADING&&SC.debug("SC.Module: Module '%@' is marked for lazy instantiation, instantiating it now…",e),u=r.length;for(o=0;o<u;o++)try{r[o]()}catch(a){SC.Logger.error("SC.Module: Failed to lazily instatiate entry for  '%@'".fmt(e))}delete SC.LAZY_INSTANTIATION[e],i=this._targetForTargetName
(t),s=this._methodForMethodNameInTarget(n,i);if(!s)throw"SC.Module: could not find callback for lazily instantiated module '%@'".fmt(e)},_evaluateStringLoadedModule:function(e){var t=e.source;jQuery.globalEval(t),delete e.source;if(e.cssSource){var n=this.getInlinedCSSFor(e),r=document.createElement("style");r.setAttribute("type","text/css");if(r.styleSheet)r.styleSheet.cssText=n;else{var i=document.createTextNode(n);r.appendChild(i)}document.getElementsByTagName("head")[0].appendChild(r)}e.isReady=YES},getInlinedCSSFor:function(e){var t=typeof e=="string"?SC.MODULE_INFO[e]:e,n,r;if(t._sc_module_postprocessed_css)return t._sc_module_postprocessed_css;window.devicePixelRatio>1?(n=t.css2xSource,r=t.css2xLogicalUrl,n||(n=t.cssSource,r=t.cssLogicalUrl)):(n=t.cssSource,r=t.cssLogicalUrl);var i=SC.absoluteUrl(r);return i=i.split("/"),i.pop(),i=i.join("/"),n=n.replace(/url\s*\(\s*["']?(.*?)["']\s*?\)/g,function(e,t){return t[0]==="/"?e:t.match(/https?:|file:/)?e:(t=i+"/"+t,"url("+JSON.stringify(t)+")")}),t._sc_module_postprocessed_css=n,n},_loadCSSForModule:function(e){var t=document.getElementsByTagName("head")[0],n=SC.MODULE_INFO[e],r=window.devicePixelRatio>1?n.styles2x:n.styles||[],i=r.length,s,o,u;t||(t=document.documentElement),i=r.length;for(u=0;u<i;u++)s=r[u],s.length>0&&(SC.LOG_MODULE_LOADING&&SC.debug("SC.Module: Loading CSS file in '%@' -> '%@'",e,s),o=document.createElement("link"),o.setAttribute("href",s),o.setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),t.appendChild(o));o=null},_loadJavaScriptForModule:function(e){var t=SC.MODULE_INFO[e],n,r,i=t.dependencies
,s=YES;i&&i.length>0&&(s=this._dependenciesMetForModule(e)),t.isPrefetched?r=t.stringURL:s?r=t.scriptURL:r=t.stringURL;if(r.length>0){SC.LOG_MODULE_LOADING&&SC.debug("SC.Module: Loading JavaScript file in '%@' -> '%@'",e,r);if(parseFloat(SC.browser.msie)>=11){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(this.readyState!==4||this.status!==200||this._done===(this._done=YES))return;window.eval.call(window,this.responseText+';SC.run(function(){SC.Module._moduleDidLoad("'+e+'")})')},o.open("GET",r),o.send(null);return}n=document.createElement("script"),n.setAttribute("type","text/javascript"),n.setAttribute("async","true"),n.setAttribute("src",r),SC.browser.isIE?n.onreadystatechange=function(){(this.readyState=="complete"||this.readyState=="loaded")&&SC.run(function(){SC.Module._moduleDidLoad(e)})}:n.onload=function(){SC.run(function(){SC.Module._moduleDidLoad(e)})},document.body.appendChild(n)}},_dependenciesMetForModule:function(e){var t=SC.MODULE_INFO[e].dependencies||[],n,r=t.length,i,s;for(n=0;n<r;n++){i=t[n],s=SC.MODULE_INFO[i];if(!s)throw"SC.loadModule: Unable to find dependency %@ for module %@.".fmt(i,e);if(!s.isReady)return NO}return YES},_loadDependenciesForModule:function(e){var t=SC.MODULE_INFO[e],n=SC.LOG_MODULE_LOADING,r=t.dependencies||[],i=YES,s=r.length,o,u,a,f;for(o=0;o<s;o++){u=r[o],a=SC.MODULE_INFO[u];if(!a)throw"SC.Module: could not find required module '%@' for module '%@'".fmt(u,e);if(a.isLoading)i=NO,f=a.dependents,f||(a.dependents=f=[]),f.push(e);else{if(a.isReady)continue;i=NO,f=a.dependents,f||(a.dependents=f=[]),f.push(e),n&&SC.debug("SC.Module: '%@' depends on '%@', loading dependency…"
,e,u),SC.Module.loadModule(u)}}},_invokeCallback:function(e,t,n,r){var i,s;s=this._targetForTargetName(t),i=this._methodForMethodNameInTarget(n,s);if(!i){if(!SC.LAZY_INSTANTIATION[e])throw"SC.Module: could not find callback for '%@'".fmt(e);this._executeLazilyInstantiatedModule(e,t,n),s=this._targetForTargetName(t),i=this._methodForMethodNameInTarget(n,s)}r||(r=[]),r.unshift(e);var o=!!SC.RunLoop.currentRunLoop;o?SC.run(function(){i.apply(s,r)}):i.apply(s,r)},_invokeCallbacksForModule:function(e){var t=SC.MODULE_INFO[e],n;if(!t)return;SC.LOG_MODULE_LOADING&&SC.debug("SC.Module: Module '%@' has completed loading, invoking callbacks.",e),n=t.callbacks||[];for(var r=0,i=n.length;r<i;++r)n[r]()},_evaluateAndInvokeCallbacks:function(e){var t=SC.MODULE_INFO,n=t[e],r=SC.LOG_MODULE_LOADING;r&&SC.debug("SC.Module: Evaluating and invoking callbacks for '%@'.",e),n.source&&this._evaluateStringLoadedModule(n),n.isWaitingForRunLoop=YES,this.invokeLast(function(){n.isReady=YES,this._moduleDidBecomeReady(e)})},_moduleDidBecomeReady:function(e){var t=SC.MODULE_INFO,n=t[e],r=SC.LOG_MODULE_LOADING;n.isWaitingForRunLoop=NO,SC.isReady?(SC.Module._invokeCallbacksForModule(e),delete n.callbacks):SC.ready(SC,function(){SC.Module._invokeCallbacksForModule(e),delete n.callbacks});var i=n.dependents||[],s,o;for(var u=0,a=i.length;u<a;u++)s=i[u],o=t[s],o.isLoaded&&this._dependenciesMetForModule(s)&&(r&&SC.debug("SC.Module: Now that %@ has loaded, all dependencies for a dependent %@ are met.",e,s),this._evaluateAndInvokeCallbacks(s))},_moduleDidLoad:function(e){var t=SC.MODULE_INFO[e],n=SC.LOG_MODULE_LOADING
,r,i,s;n&&SC.debug("SC.Module: Module '%@' finished loading.",e);if(!t){n&&SC.debug("SC._moduleDidLoad() called for unknown module '@'.",e),t=SC.MODULE_INFO[e]={isLoaded:YES,isReady:YES};return}if(t.isLoaded){n&&SC.debug("SC._moduleDidLoad() called more than once for module '%@'. Skipping.",e);return}delete t.isLoading,t.isLoaded=YES,t.isPrefetching?(delete t.isPrefetching,n&&SC.debug("SC.Module: Module '%@' was prefetched, not evaluating until needed.",e)):(r=this._dependenciesMetForModule(e),r?this._evaluateAndInvokeCallbacks(e):n&&SC.debug("SC.Module: Dependencies for '%@' not met yet, waiting to evaluate.",e))},_targetForTargetName:function(e){return SC.typeOf(e)===SC.T_STRING?SC.objectForPropertyPath(e):e},_methodForMethodNameInTarget:function(e,t){return SC.typeOf(e)===SC.T_STRING?SC.objectForPropertyPath(e,t):e},methodsForSuspend:"loadModule _moduleDidLoad prefetchModule _moduleDidBecomeReady".w(),suspend:function(){this._suspendCount=(this._suspendCount||0)+1;if(this._suspendCount!==1)return;var e=this.get("methodsForSuspend"),t,n,r,i;for(i=0;r=e[i];i++)this[t="__replacement_"+r+"__"]||((this[t]=function(){(this._bufferedCalls||(this._bufferedCalls=[])).push({method:arguments.callee.methodName,arguments:arguments})}).methodName=r),this[n="__saved_"+r+"__"]||(this[n]=this[r]),this[r]=this[t]},resume:function(){this._suspendCount=(this._suspendCount||0)-1;if(this._suspendCount<0){SC.warn("SC.Module.resume() was called without SC.Module having been in a suspended state. Call aborted."),this._suspendCount=0;return}if(this._suspendCount>0)return;var e=this.get("methodsForSuspend"
),t=this._bufferedCalls,n,r,i,s;for(r=0;n=e[r];r++)this[n]=this["__saved_"+n+"__"];for(r=0;s=t&&t[r];r++)this[s.method].apply(this,s.arguments);t&&(t.length=0)}}),SC.ready(function(){var e=SC.MODULE_INFO,t,n,r;for(t in e)n=e[t],n.isPrefetched&&(r=SC.Module.PrefetchModuleTask.create({prefetchedModuleName:t}),SC.backgroundTaskQueue.push(r))}),SC.Module.PrefetchModuleTask=SC.Task.extend({prefetchedModuleName:null,run:function(){SC.Module.prefetchModule(this.prefetchedModuleName)}}),SC.TaskQueue=SC.Task.extend({init:function(){var e=this;this._doIdleEntry=function(){e._idleEntry()},this._suspendCount=0,this._tasks=[]},runWhenIdle:NO,runLimit:50,interval:50,isRunning:NO,minimumIdleDuration:500,_tasks:null,hasTasks:function(){return this._tasks.length>0}.property("taskCount").cacheable(),taskCount:function(){return this._tasks.length}.property().cacheable(),push:function(e){this._tasks.push(e),this.notifyPropertyChange("taskCount")},next:function(){if(this._tasks.length<1)return null;var e=this._tasks.shift();return this.notifyPropertyChange("taskCount"),e},suspend:function(){this._suspendCount++},resume:function(){this._suspendCount--,this._suspendCount<=0&&this._setupIdle()},_taskCountDidChange:function(){this._setupIdle()}.observes("taskCount"),_runWhenIdleDidChange:function(){this._setupIdle()}.observes("runWhenIdle"),_setupIdle:function(){!this._suspendCount&&this.get("runWhenIdle")&&!this._idleIsScheduled&&this.get("taskCount")>0&&(setTimeout(this._doIdleEntry,this.get("interval")),this._idleIsScheduled=YES)},_idleEntry:function(){this._idleIsScheduled=NO;var e=SC.RunLoop.lastRunLoopEnd
;if(!this.get("runWhenIdle")&&!this._suspendCount)return;Date.now()-e>this.get("minimumIdleDuration")&&(SC.run(this.run,this),SC.RunLoop.lastRunLoopEnd=e),this._setupIdle()},run:function(e){this.set("isRunning",YES),e||(e=this.get("runLimit"));var t,n=Date.now();while(t=this.next()){t.run(this);if(Date.now()-n>e)break}this.set("isRunning",NO)}}),SC.backgroundTaskQueue=SC.TaskQueue.create({runWhenIdle:YES}),SC.TextSelection=SC.Object.extend(SC.Copyable,SC.Freezable,{start:-1,end:-1,length:function(){var e=this.get("start"),t=this.get("end");return e===-1||t===-1?-1:t-e}.property("start","end").cacheable(),init:function(){arguments.callee.base.apply(this,arguments),this.freeze()},copy:function(){return SC.TextSelection.create({start:this.get("start"),end:this.get("end")})},toString:function(){var e=this.get("length");return e&&e>0?e===1?"[%@ character selected: {%@, %@}]".fmt(e,this.get("start"),this.get("end")):"[%@ characters selected: {%@, %@}]".fmt(e,this.get("start"),this.get("end")):"[no text selected; caret at %@]".fmt(this.get("start"))}}),SC.UserDefaults=SC.Object.extend({ready:NO,userDomain:null,appDomain:null,_defaults:null,_safari3DB:null,_localStorage:null,defaults:function(e){this._defaults=e,this.allPropertiesDidChange()},readDefault:function(e){var t,n,r,i,s,o;e=this._normalizeKeyName(e),n=this._userKeyName(e),this._written&&(t=this._written[n]);if(SC.browser.msie=="7.0"){r=document.body;try{r.load("SC.UserDefaults")}catch(u){SC.Logger.error("Couldn't load userDefaults in IE7: "+u.description)}}else this.HTML5DB_noLocalStorage?o=this._safari3DB:(r=this._localStorage
,!r&&window.globalStorage&&(r=window.globalStorage[window.location.hostname]));if(r||o){i=["SC.UserDefaults",n].join("-at-"),SC.browser.msie=="7.0"?t=r.getAttribute(i.replace(/\W/gi,"")):o?t=this.dataHash[i]:t=r[i];if(!SC.none(t))try{t=SC.json.decode(t)}catch(a){}}return s=this.delegate,s&&s.userDefaultsNeedsDefault&&(t=s.userDefaultsNeedsDefault(this,e,n)),t===undefined&&this._defaults&&(t=this._defaults[n]||this._defaults[e]),t},writeDefault:function(e,t){var n,r,i,s,o,u;e=this._normalizeKeyName(e),n=this._userKeyName(e),r=this._written,r||(r=this._written={}),r[n]=t,SC.browser.msie=="7.0"?i=document.body:this.HTML5DB_noLocalStorage?u=this._safari3DB:(i=this._localStorage,!i&&window.globalStorage&&(i=window.globalStorage[window.location.hostname])),s=["SC.UserDefaults",n].join("-at-");if(i||u){var a=SC.json.encode(t);if(SC.browser.msie=="7.0")i.setAttribute(s.replace(/\W/gi,""),a),i.save("SC.UserDefaults");else if(u){var f=this;u.transaction(function(e){e.executeSql("delete from SCLocalStorage where key = ?",[s],function(){e.executeSql("insert into SCLocalStorage(key, value) VALUES ('"+s+"', '"+a+"');",[],f._nullDataHandler,f.killTransaction)})}),this.dataHash[s]=a}else try{i[s]=a}catch(l){SC.Logger.error("Failed using localStorage. "+l)}}return o=this.delegate,o&&o.userDefaultsDidChange&&o.userDefaultsDidChange(this,e,t,n),this},resetDefault:function(e){var t,n,r,i,s,o;t=this._normalizeKeyName(e),n=this._userKeyName(t),this.propertyWillChange(e),this.propertyWillChange(t),r=this._written,r&&delete r[n],SC.browser.msie=="7.0"?i=document.body:this.HTML5DB_noLocalStorage?o=this
._safari3DB:(i=this._localStorage,!i&&window.globalStorage&&(i=window.globalStorage[window.location.hostname])),s=["SC.UserDefaults",n].join("-at-");if(i)if(SC.browser.msie=="7.0")i.setAttribute(s.replace(/\W/gi,""),null),i.save("SC.UserDefaults");else if(o){var u=this;o.transaction(function(e){e.executeSql("delete from SCLocalStorage where key = ?",[s],null)}),delete this.dataHash[s]}else try{delete i[s]}catch(a){SC.Logger.warn("Deleting local storage encountered a problem. "+a)}return this.propertyDidChange(e),this.propertyDidChange(t),this},unknownProperty:function(e,t){return t===undefined?this.readDefault(e):(this.writeDefault(e,t),t)},_normalizeKeyName:function(e){if(e.indexOf(":")<0){var t=this.get("appDomain")||"app";e=[t,e].join(":")}return e},_userKeyName:function(e){var t=this.get("userDomain")||"(anonymous)";return[t,e].join("-at-")},_domainDidChange:function(){var e=NO;this.get("userDomain")!==this._scud_userDomain&&(this._scud_userDomain=this.get("userDomain"),e=YES),this.get("appDomain")!==this._scud_appDomain&&(this._scud_appDomain=this.get("appDomain"),e=YES),e&&this.allPropertiesDidChange()}.observes("userDomain","appDomain"),init:function(){arguments.callee.base.apply(this,arguments),jQuery.readyWait++;if(SC.userDefaults&&SC.userDefaults.get("dataHash")){var e=SC.userDefaults.get("dataHash");e&&(this.dataHash=SC.userDefaults.get("dataHash"))}this._scud_userDomain=this.get("userDomain"),this._scud_appDomain=this.get("appDomain");try{this._localStorage=window.localStorage}catch(t){SC.Logger.error("Could not access browser's localStorage: "+t)}SC.browser.msie=="7.0"&&
document.body.addBehavior("#default#userData"),this.HTML5DB_noLocalStorage=parseInt(SC.browser.webkit,0)>523&&parseInt(SC.browser.webkit,0)<528;if(this.HTML5DB_noLocalStorage){var n;try{if(!window.openDatabase){SC.Logger.error("Trying to load a database with safari version 3.1 to get SC.UserDefaults to work. You are either in a previous version or there is a problem with your browser.");return}var r="scdb",i="1.0",s="SproutCore database",o=65536;n=openDatabase(r,i,s,o)}catch(t){SC.Logger.error("Trying to load a database with safari version 3.1 to get SC.UserDefaults to work. You are either in a previous version or there is a problem with your browser.");return}if(n){var u=this;n.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS SCLocalStorage(key TEXT NOT NULL PRIMARY KEY, value TEXT NOT NULL);",[],u._nullDataHandler,u.killTransaction)}),n.transaction(function(e){e.parent=u,e.executeSql("SELECT * from SCLocalStorage;",[],function(e,t){var n={},r;for(var i=0,s=t.rows.length;i<s;i++)r=t.rows.item(i),n[r.key]=r.value;e.parent.dataHash=n,SC.run(function(){jQuery.ready(!0)})},u.killTransaction)}),this._safari3DB=n}}else jQuery.ready(!0)},_killTransaction:function(e,t){return!0},_nullDataHandler:function(e,t){}}),SC.userDefaults=SC.UserDefaults.create(),SC.mixin({convertHsvToHex:function(e,t,n){var r=0,i=0,s=0;if(n>0){var o=e==1?0:Math.floor(e*6),u=e==1?0:e*6-o,a=n*(1-t),f=n*(1-t*u),l=n*(1-t*(1-u)),c=[[n,l,a],[f,n,a],[a,n,l],[a,f,n],[l,a,n],[n,a,f]];r=Math.round(255*c[o][0]),i=Math.round(255*c[o][1]),s=Math.round(255*c[o][2])}return this.parseColor("rgb("+r+","+i+","+
s+")")},convertHexToHsv:function(e){var t=this.expandColor(e),n=0,r=0,i=0;if(t){var s=Math.max(Math.max(t[0],t[1]),t[2]),o=Math.min(Math.min(t[0],t[1]),t[2]);r=s===0?0:1-o/s,i=s/255,n=s==o?0:s==t[0]?(t[1]-t[2])/(s-o)/6:s==t[1]?(t[2]-t[0])/(s-o)/6+1/3:(t[0]-t[1])/(s-o)/6+2/3,n=n<0?n+1:n>1?n-1:n}return[n,r,i]},PARSE_COLOR_RGBRE:/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i,PARSE_COLOR_HEXRE:/^\#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/,expandColor:function(e){var t,n,r,i;t=this.parseColor(e);if(t)return n=parseInt(t.slice(1,3),16),r=parseInt(t.slice(3,5),16),i=parseInt(t.slice(5,7),16),[n,r,i]},parseColor:function(e){var t=0,n="#",r,i;if(r=this.PARSE_COLOR_RGBRE.exec(e)){for(t=1;t<=3;t++)i=Math.max(0,Math.min(255,parseInt(r[t],0))),n+=this.toColorPart(i);return n}if(r=this.PARSE_COLOR_HEXRE.exec(e)){if(r[1].length==3){for(t=0;t<3;t++)n+=r[1].charAt(t)+r[1].charAt(t);return n}return"#"+r[1]}return!1},toColorPart:function(e){e>255&&(e=255);var t=e.toString(16);return e<16?"0"+t:t}}),SC.mixin({_downloadFrames:0,download:function(e){var t=document.createElement("iframe"),n="DownloadFrame_"+this._downloadFrames;SC.$(t).attr("id",n),t.style.border="10px",t.style.width="0px",t.style.height="0px",t.style.position="absolute",t.style.top="-10000px",t.style.left="-10000px",SC.browser.isSafari||SC.$(t).attr("src",e),document.getElementsByTagName("body")[0].appendChild(t),SC.browser.isSafari&&SC.$(t).attr("src",e),this._downloadFrames=this._downloadFrames+1;if(!SC.browser.isSafari){var r=function(){document.body.removeChild(document.getElementById(n)),n=null};r.invokeLater(null,2e4)}t=null},getStyle
:function(e,t){var n="";return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(e,"").getPropertyValue(t):e.currentStyle&&(t=t.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()}),n=e.currentStyle[t]),n},uniJapaneseConvert:function(e){var t,n="",r,i;for(r=0,i=e.length;r<i;r++)t=e.charCodeAt(r),t=t>=65281&&t<=65392?t-65248:t,t=t===12540?45:t,n+=String.fromCharCode(t);return n},pointInElement:function(e,t,n,r){var i,s,o,u;return t=jQuery(t),n=n||"border",i=SC.offset(t,r),n==="padding"?(s=t.innerWidth(),o=t.innerHeight(),i.x+=window.parseInt(t.css("border-top-width").replace("px","")),i.y+=window.parseInt(t.css("border-left-width").replace("px",""))):(s=t.outerWidth(n==="margin"),o=t.outerHeight(n==="margin"),n==="margin"&&(i.x-=window.parseInt(t.css("margin-top").replace("px","")),i.y-=window.parseInt(t.css("margin-left").replace("px","")))),u={x:i.x,y:i.y,width:s,height:o},SC.pointInRect(e,u)},switchScale:function(){$("head meta[name=viewport]").remove(),window.innerWidth===window.screen.width?$("head").prepend('<meta name="viewport" content="width=device-width, initial-scale=0.5, maximum-scale=0.5, minimum-scale=0.5, user-scalable=0" />'):$("head").prepend('<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=0" />')}}),SC.mixin({ZERO_RANGE:{start:0,length:0},RANGE_NOT_FOUND:{start:0,length:-1},valueInRange:function(e,t){return e>=0&&e>=t.start&&e<t.start+t.length},minRange:function(e){return e.start},maxRange:function(e){return e.length<0?-1:e.start+e.length
},unionRanges:function(e,t){if(e==null||e.length<0)return t;if(t==null||t.length<0)return e;var n=Math.min(e.start,t.start),r=Math.max(SC.maxRange(e),SC.maxRange(t));return{start:n,length:r-n}},intersectRanges:function(e,t){if(e==null||t==null)return SC.RANGE_NOT_FOUND;if(e.length<0||t.length<0)return SC.RANGE_NOT_FOUND;var n=Math.max(SC.minRange(e),SC.minRange(t)),r=Math.min(SC.maxRange(e),SC.maxRange(t));return r<n?SC.RANGE_NOT_FOUND:{start:n,length:r-n}},subtractRanges:function(e,t){if(e==null||t==null)return SC.RANGE_NOT_FOUND;if(e.length<0||t.length<0)return SC.RANGE_NOT_FOUND;var n=Math.max(SC.minRange(e),SC.minRange(t)),r=Math.min(SC.maxRange(e),SC.maxRange(t));return n<r?SC.RANGE_NOT_FOUND:{start:r,length:n-r}},cloneRange:function(e){return{start:e.start,length:e.length}},rangesEqual:function(e,t){return e===t?!0:e==null?t.length<0:t==null?e.length<0:e.start==t.start&&e.length==t.length}}),SC.mixin({bestStringMetricsForMaxWidth:function(e,t,n,r,i){if(!t)return SC.warn("When calling bestMetricsForWidth, the second argument, maxWidth, is required. There's no reason to call this without a maxWidth."),undefined;t=Math.ceil(parseFloat(t));var s=arguments.callee,o=SC.typeOf(n||(n=""))!==SC.T_STRING,u=o?n.style.maxWidth:undefined,a=!o||n.cacheableForMetrics?SC.cacheSlotFor(n,r,i,e):undefined,f=o?s._applyMaxToEl||(s._applyMaxToEl=function(e,t){return e.style.maxWidth=t+"px",e}):s._applyMaxToStr||(s._applyMaxToStr=function(e,t){return e.replace(/max-width:[^;]*;/g,"")+" max-width:"+t+"px"}),l=o?s._removeMaxFromEl||(s._removeMaxFromEl=function(e){return e.style.maxWidth="none"
,e}):s._removeMaxFromStr||(s._removeMaxFromStr=function(e){return e.replace(/max-width:[^;]*;/g,"")+" max-width:none"}),c=!1;if(a){a.list||(a.list=[{width:Infinity,height:0}]);for(var h=1,p=a.list.length,d,v,m;h<p&&!m;h++){d=a.list[h],v=a.list[h-1];if(!d||!d.width)continue;if(t>=d.width){if(v&&v.width||t<=d.maxWidth)return d;m=d}}}var g=f(n,t),y=SC.metricsForString(e,g,r,i),b=y.height,w=a?a.parent.height||(a.parent.height=SC.metricsForString("W",g,r).height):SC.metricsForString("W",g,r).height,E=Math.round(b/w);c&&(E--,b=E*w);if(b>w){var S=c?Math.ceil(y.width*2.5):y.width,x=c?y.width:Math.floor(y.width/2.5),T,N=new Date*1,C=0;while(S-x>1||y.height>b&&!c||y.height<b&&c)C++,T=(S+x)/2,g=f(g,T),y=SC.metricsForString(e,g,r,i),y.height>b?x=T:S=T;y.width=Math.ceil(T),y.height=b,y.maxWidth=t,y.lineHeight=w,y.lines=E,y.searchPerformed=!0,y.searchTime=new Date*1-N,y.searchCount=C}else c&&(y=SC.metricsForString(e,g=l(g),r,i)),y.maxWidth=t,y.lineHeight=w,y.lines=E,y.searchPerformed=!1;y.browserCorrection=0,SC.browser.msie&&(y.browserCorrection=1),SC.browser.mozilla&&(y.browserCorrection=1),y.width=Math.min(t,y.width+y.browserCorrection);if(a){var k=a.list[E];k&&k.maxWidth<t&&(k.maxWidth=t),k||(k=a.list[E]=y)}return o&&(g.style.maxWidth=u),m=c?m:y,m},cacheSlotFor:function(){var e=arguments.callee.caller,t=e.cache||(e.cache={});if(!arguments.length)return t;var n=arguments[0],r=n&&(n instanceof Array||n.callee)?n:arguments,i=r.length,s,o;for(o=0;o<i;o++)typeof (s=r[o])=="object"&&(s=SC.guidFor(s)),t=t[s]||(t[s]={parent:t});return t},cachedVersionOf:function(){var e=function(e){var t=function(
){var e=SC.cacheSlotFor(arguments);return e.result||(e.result=arguments.callee.func.apply(this,arguments))};return t.func=e,t};return e(e)}()}),SC.didPreloadBundle=function(){},SC.PreloadBundleTask=SC.Task.extend({bundle:null,target:"SC",action:"preloaded",run:function(e){var t;if(t=this.get("bundle")){var n=Date.now();SC.Module.loadModule(this.get("bundle"),this.get("target"),this.get("action"))}}}),SC.VALIDATE_OK=YES,SC.VALIDATE_NO_CHANGE=NO,SC.Validator=SC.Object.extend({fieldValueForObject:function(e,t,n){return e},objectForFieldValue:function(e,t,n){return e},validate:function(e,t){return!0},validateError:function(e,t){return SC.$error(SC.String.loc("Invalid.General(%@)",t.get("fieldValue")),t.get("fieldKey"))},validateChange:function(e,t,n){return this.validate(e,t)?SC.VALIDATE_OK:this.validateError(e,t)},validateSubmit:function(e,t){return this.validate(e,t)?SC.VALIDATE_OK:this.validateError(e,t)},validatePartial:function(e,t){return t.get("isValid")?SC.VALIDATE_NO_CHANGE:this.validate(e,t)?SC.VALIDATE_OK:this.validateError(e,t)},validateKeyDown:function(e,t,n){return!0},attachTo:function(e,t){},detachFrom:function(e,t){}}),SC.Validator.mixin({OK:!0,NO_CHANGE:!1,findFor:function(e,t,n){var r;if(!n)return;if(n instanceof SC.Validator)r=n;else if(n.isClass)r=n.create();else if(SC.typeOf(n)===SC.T_STRING){var i=null,s=n.match(/^(.+)\[(.*)\]/);s&&(n=s[1],i=s[2]),n=SC.String.classify(n);var o=SC.Validator[n];if(SC.none(o))throw"validator %@ not found for %@".fmt(n,t);if(i){if(!e)throw"named validator (%@) could not be found for field %@ because the field does not belong to a form"
.fmt(i,t);e._validatorHash||(e._validatorHash={}),r=i?e._validatorHash[i]:null,r||(r=o.create()),i&&(e._validatorHash[i]=r)}else r=o.create()}return r},fieldValueForObject:function(e,t,n){return this.prototype&&this.prototype.fieldValueForObject?this.prototype.fieldValueForObject(e,t,n):null},objectForFieldValue:function(e,t,n){return this.prototype&&this.prototype.objectForFieldValue?this.prototype.objectForFieldValue(e,t,n):null}}),SC.Validator.CreditCard=SC.Validator.extend({fieldValueForObject:function(e,t,n){return typeof e=="string"&&e.length==16&&(e=[e.slice(0,4),e.slice(4,8),e.slice(8,12),e.slice(12,16)].join(" ")),e},objectForFieldValue:function(e,t,n){return e.replace(/[\s-\.\:]/g,"")},validate:function(e,t){return this.checkNumber(t.get("fieldValue"))},validateError:function(e,t){var n=t.get("errorLabel")||"Field";return SC.$error(SC.String.loc("Invalid.CreditCard(%@)",n),n)},validateKeyDown:function(e,t,n){return!!n.match(/[0-9\- ]/)},checkNumber:function(e){if(!e||e.length===0)return YES;e=e.replace(/[^0-9]/g,"");var t="0123456789",n=e.length,r=parseInt(e,0),i=e.toString();i=i.replace(/^\s+|\s+$/g,"");var s=0,o=!0,u=!1,a,f;for(var l=0;l<n;l++)a=""+i.substring(l,l+1),t.indexOf(a)=="-1"&&(o=!1);o||(u=!1);if(n===0&&u)u=!1;else if(n>=15){for(var c=n;c>0;c--){f=parseInt(r,0)%10,f=parseInt(f,0),s+=f,c--,r/=10,f=parseInt(r,0)%10,f*=2;switch(f){case 10:f=1;break;case 12:f=3;break;case 14:f=5;break;case 16:f=7;break;case 18:f=9;break;default:f=f}r/=10,s+=f}s%10===0?u=!0:u=!1}return u}}),SC.Validator.Date=SC.Validator.extend({format:"%b %d, %Y %i:%M:%S %p",fieldValueForObject
:function(e,t,n){var r=this.get("format"),i;return SC.typeOf(e)===SC.T_NUMBER?i=SC.DateTime.create(e):e instanceof Date&&(i=e.getTime()),i&&(e=i.toFormattedString(r)),e},objectForFieldValue:function(e,t,n){var r=this.get("format"),i;return e&&(i=SC.DateTime.parse(e,r),e=i?i._ms:null),e}}),SC.Validator.DateTime=SC.Validator.extend({format:"%d/%m/%Y",fieldValueForObject:function(e,t,n){return SC.kindOf(e,SC.DateTime)?e=e.toFormattedString(this.get("format")):e=null,e},objectForFieldValue:function(e,t,n){return e&&(e=SC.DateTime.parse(e,this.get("format"))),e}}),SC.Validator.Email=SC.Validator.extend({validate:function(e,t){return(t.get("fieldValue")||"").match(/.+@.+\...+/)},validateError:function(e,t){var n=t.get("errorLabel")||"Field";return SC.$error(SC.String.loc("Invalid.Email(%@)",n),n)}}),SC.Validator.EmailOrEmpty=SC.Validator.Email.extend({validate:function(e,t){var n=t.get("fieldValue");return n&&n.length>0?n.match(/.+@.+\...+/):!0}}),SC.Validator.NotEmpty=SC.Validator.extend({validate:function(e,t){var n=t.get("fieldValue");return SC.none(n)?NO:SC.none(n.length)?YES:n.length>0},validateError:function(e,t){var n=t.get("errorLabel")||"Field";return SC.$error(SC.String.loc("Invalid.NotEmpty(%@)",SC.String.capitalize(n)),t.get("errorLabel"))}}),SC.Validator.Number=SC.Validator.extend({places:0,fieldValueForObject:function(e,t,n){switch(SC.typeOf(e)){case SC.T_NUMBER:e=e.toFixed(this.get("places"));break;case SC.T_NULL:case SC.T_UNDEFINED:e=""}return e},objectForFieldValue:function(e,t,n){var r;e=e.replace(/,/g,"");switch(SC.typeOf(e)){case SC.T_STRING:e.length===0?e=null
:this.get("places")>0?e=parseFloat(e):e.length==1&&e.match(/-/)?e=null:(r=parseInt(e,0),isNaN(r)?(e=SC.uniJapaneseConvert(e),e=parseInt(e,0),isNaN(e)&&(e="")):e=r);break;case SC.T_NULL:case SC.T_UNDEFINED:e=null}return e},validate:function(e,t){var n=t.get("fieldValue");return n===""||!isNaN(n)&&!isNaN(parseFloat(n))},validateError:function(e,t){var n=t.get("errorLabel")||"Field";return SC.$error(SC.String.loc("Invalid.Number(%@)",n),n)},validateKeyDown:function(e,t,n){var r=t.$input().val();return r||(r=""),r+=n,this.get("places")===0?n.length===0?!0:r.match(/^[\-{0,1}]?[0-9,\0]*/)[0]===r:n.length===0?!0:r.match(/^[\-{0,1}]?[0-9,\0]*\.?[0-9\0]+/)===r}}),SC.Validator.Password=SC.Validator.extend({attachTo:function(e,t){arguments.callee.base.apply(this,arguments),this.fields||(this.fields=[]),this.fields.push(t)},validate:function(e){if(!this.fields||this.fields.length===0)return!0;var t=!1,n=!1,r=!0,i=this.fields[0].get("fieldValue");return this.fields.forEach(function(e){var s=e.get("fieldValue");s!=i&&(r=!1);if(!s||s.length===0)t=!0;s&&s.length>0&&(n=!0)}),e?n===!1?!1:r:t===!0?!0:r},updateFields:function(e,t){if(!this.fields||this.fields.length===0)return!0;var n=SC.String.loc("Invalid.Password"),r=this._field;return this.fields.forEach(function(i){var s=t?null:i==r?n:"";e.setErrorFor(i,s)}),t?SC.VALIDATE_OK:n},validateChange:function(e,t,n){return this.updateFields(e,this.validate(!1))},validateSubmit:function(e,t){return this.updateFields(e,this.validate(!0))},validatePartial:function(e,t){var n=!this._field.get("isValid");return n?this.updateFields(e,this.validate(!1)):
SC.VALIDATE_NO_CHANGE}}),SC.Validator.PositiveInteger=SC.Validator.extend({defaultValue:null,fieldValueForObject:function(e,t,n){switch(SC.typeOf(e)){case SC.T_NUMBER:e=e.toFixed(0);break;case SC.T_NULL:case SC.T_UNDEFINED:e=this.get("defaultValue")}return e},objectForFieldValue:function(e,t,n){e=e.replace(/,/g,"");switch(SC.typeOf(e)){case SC.T_STRING:e.length===0?e=this.get("defaultValue"):e=parseInt(e,0);break;case SC.T_NULL:case SC.T_UNDEFINED:e=this.get("defaultValue")}return isNaN(e)?this.get("defaultValue"):e},validate:function(e,t){var n=t.get("fieldValue");return n===""||!isNaN(n)},validateError:function(e,t){var n=t.get("errorLabel")||"Field";return SC.$error(SC.String.loc("Invalid.Number(%@)",n),n)},validateKeyDown:function(e,t,n){var r=t.$input().val();return r||(r=""),r+=n,n.length===0?!0:r.match(/^[0-9\0]*/)[0]===r}}),SC.ContainerView=SC.View.extend({classNames:["sc-container-view"],renderDelegateName:"containerRenderDelegate",nowShowing:null,contentView:null,contentViewBindingDefault:SC.Binding.single(),replaceContent:function(e){this.removeAllChildren(),e&&this.appendChild(e)},createChildViews:function(){var e=this.get("contentView");e&&(e=this.contentView=this.createChildView(e),this.childViews=[e])},awake:function(){arguments.callee.base.apply(this,arguments);var e=this.get("nowShowing");e&&e.length>0&&this.nowShowingDidChange()},nowShowingDidChange:function(){var e=this.get("nowShowing");if(e===SC.CONTENT_SET_DIRECTLY)return;var t=this._instantiatedLastView===YES?this.get("contentView"):null;this._instantiatedLastView=NO;if(SC.typeOf(e)===SC.T_STRING&&e.length>0
)if(e.indexOf(".")>0)e=SC.objectForPropertyPath(e);else{var n=this.getPath(e);e=SC.kindOf(n,SC.CoreView)?n:SC.objectForPropertyPath(e,this.get("page"))}SC.typeOf(e)===SC.T_CLASS&&(e.kindOf(SC.CoreView)?(e=this.createChildView(e),this._instantiatedLastView=YES):e=null),e&&!(e instanceof SC.CoreView)&&(e=null),this.set("contentView",e),t&&t.destroy()}.observes("nowShowing"),contentViewDidChange:function(){this.replaceContent(this.get("contentView"))}.observes("contentView")}),SC.FieldView=SC.View.extend(SC.Control,SC.Validatable,{isTextArea:NO,_field_isMouseDown:NO,fieldValue:function(){var e=this.get("value");return SC.typeOf(e)===SC.T_ERROR&&(e=e.get("errorValue")),this.fieldValueForObject(e)}.property("value","validator").cacheable(),$input:function(){return this.get("isTextArea")?this.$("textarea").andSelf().filter("textarea"):this.$("input").andSelf().filter("input")},setFieldValue:function(e){SC.none(e)&&(e="");var t=this.$input();return t.val()!==e&&t.val(e),this},getFieldValue:function(){return this.$input().val()},_field_fieldValueDidChange:function(e){SC.run(function(){this.fieldValueDidChange(NO)},this)},fieldValueDidChange:function(e){var t=this.getFieldValue(),n=this.objectForFieldValue(t,e);this.setIfChanged("value",n)},_field_valueDidChange:function(){this.setFieldValue(this.get("fieldValue"))}.observes("fieldValue"),didCreateLayer:function(){this.setFieldValue(this.get("fieldValue")),SC.Event.add(this.$input(),"change",this,this._field_fieldValueDidChange)},didAppendToDocument:function(){this.get("isTextArea")&&(this.setFieldValue(this.get("fieldValue")),SC.Event
.add(this.$input(),"change",this,this._field_fieldValueDidChange))},willDestroyLayer:function(){SC.Event.remove(this.$input(),"change",this,this._field_fieldValueDidChange)},mouseDown:function(e){return this._field_isMouseDown=YES,e.allowDefault(),YES},mouseExited:function(e){return this._field_isMouseDown&&this.set("isActive",NO),e.allowDefault(),YES},mouseEntered:function(e){return this.set("isActive",this._field_isMouseDown),e.allowDefault(),YES},mouseUp:function(e){return this._field_isMouseDown&&this.set("isActive",NO),this._field_isMouseDown=NO,e.allowDefault(),YES},keyDown:function(e){if(e.which===9||e.keyCode===9){var t=e.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");return t?t.becomeFirstResponder():e.allowDefault(),YES}return this.performValidateKeyDown(e)?(this._isKeyDown=YES,e.allowDefault()):e.stop(),YES},acceptsFirstResponder:function(){return SC.FOCUS_ALL_CONTROLS?this.get("isEnabled"):NO}.property("isEnabled"),_field_setFieldValue:function(e){this.propertyWillChange("fieldValue"),this.fieldValueForObject&&(e=this.fieldValueForObject(e));var t=this.setFieldValue(e);return this.propertyDidChange("fieldValue"),t},_field_getFieldValue:function(){var e=this.getFieldValue();return this.objectForFieldValue&&(e=this.objectForFieldValue(e)),e}}),SC.IMAGE_STATE_NONE="none",SC.IMAGE_STATE_LOADING="loading",SC.IMAGE_STATE_LOADED="loaded",SC.IMAGE_STATE_FAILED="failed",SC.IMAGE_TYPE_NONE="NONE",SC.IMAGE_TYPE_URL="URL",SC.IMAGE_TYPE_CSS_CLASS="CSS_CLASS",SC.BLANK_IMAGE_DATAURL="data:image/gif;base64,R0lGODlhAQABAJAAAP///wAAACH5BAUQAAAALAAAAAABAAEAAAICBAEAOw=="
,SC.BLANK_IMAGE_URL=SC.browser.msie&&SC.browser.msie<8?"/applications/mail/1808Project39/frameworks/sproutcore/foundation/1808Project39/en-us/source/resources/blank.gif":SC.BLANK_IMAGE_DATAURL,SC.BLANK_IMAGE=new Image,SC.BLANK_IMAGE.src=SC.BLANK_IMAGE_URL,SC.BLANK_IMAGE.width=SC.BLANK_IMAGE.height=1,SC.ImageView=SC.View.extend(SC.Control,SC.InnerFrame,{classNames:"sc-image-view",displayProperties:["frame","image","innerFrame","toolTip","imageValue","type"],renderDelegateName:function(){return(this.get("useCanvas")?"canvasImage":"image")+"RenderDelegate"}.property("useCanvas").cacheable(),tagName:function(){return this.get("useCanvas")?"canvas":"div"}.property("useCanvas").cacheable(),canLoadInBackground:NO,image:SC.BLANK_IMAGE,imageValue:function(){var e=this.get("value");return e&&e.isEnumerable?e.firstObject():e}.property("value").cacheable(),innerFrame:function(){var e=this.get("image"),t=e.width,n=e.height,r=this.get("frame");return SC.none(r)?{x:0,y:0,width:0,height:0}:this.innerFrameForSize(t,n,r.width,r.height)}.property("align","image","scale","frame").cacheable(),localize:YES,status:SC.IMAGE_STATE_NONE,type:function(){var e=this.get("imageValue");return SC.ImageView.valueIsUrl(e)?SC.IMAGE_TYPE_URL:SC.none(e)?SC.IMAGE_TYPE_NONE:SC.IMAGE_TYPE_CSS_CLASS}.property("imageValue").cacheable(),useCanvas:function(){return SC.platform.supportsCanvas&&!this.get("useStaticLayout")&&this.get("type")!==SC.IMAGE_TYPE_CSS_CLASS}.property("useStaticLayout","type").cacheable(),useImageQueue:YES,value:null,viewDidResize:function(){var e=this.get("layer"),t,n;if(e){t=e.offsetWidth,n=e.
offsetHeight;if(this._cachedWidth!==t||this._cachedHeight!==n)this.notifyPropertyChange("frame"),this._cachedWidth=t,this._cachedHeight=n}},init:function(){arguments.callee.base.apply(this,arguments),this._image_valueDidChange(),this.get("useImageCache")!==undefined&&(SC.Logger.warn("%@ has useImageCache set, please set useImageQueue instead".fmt(this)),this.set("useImageQueue",this.get("useImageCache")))},layerDidChange:function(){this.get("useCanvas")&&this.set("layerNeedsUpdate",YES)}.observes("layer"),_image_valueDidChange:function(){var e=this.get("imageValue"),t=this.get("type");e!==this._iv_value&&(this._iv_value=e,this.set("image",SC.BLANK_IMAGE),t!==SC.IMAGE_TYPE_CSS_CLASS&&(this.set("status",SC.IMAGE_STATE_LOADING),this._loadImageUsingCache()||this._loadImage()))}.observes("imageValue"),_loadImageUsingCache:function(){var e=this.get("imageValue"),t=this.get("type");if(t===SC.IMAGE_TYPE_URL&&this.get("useImageQueue")){var n=this.get("isVisibleInWindow")||this.get("canLoadInBackground");return SC.imageQueue.loadImage(e,this,this._loadImageUsingCacheDidComplete,n),YES}return NO},_loadImageUsingCacheDidComplete:function(e,t){var n=this.get("imageValue");n===e&&(SC.ok(t)?this.didLoad(t):this.didError(t))},_loadImage:function(){var e=this.get("imageValue"),t=this.get("type"),n=this,r,i;if(t===SC.IMAGE_TYPE_URL){r=new Image;var s=function(){SC.run(function(){n._loadImageDidComplete(e,SC.$error("SC.Image.FailedError","Image",-101))})},o=function(){SC.run(function(){n._loadImageDidComplete(e,r)})};return i=$(r),i.bind("error",s),i.bind("abort",s),i.bind("load",o),r.src=e,YES
}return NO},_loadImageDidComplete:function(e,t){var n=this.get("imageValue");n===e&&(SC.ok(t)?this.didLoad(t):this.didError(t))},didLoad:function(e){this.set("status",SC.IMAGE_STATE_LOADED),e||(e=SC.BLANK_IMAGE),this.set("image",e)},didError:function(e){this.set("status",SC.IMAGE_STATE_FAILED),this.set("image",SC.BLANK_IMAGE)}}),SC.ImageView.valueIsUrl=function(e){return e&&SC.typeOf(e)===SC.T_STRING?e.indexOf("/")>=0:NO},SC.TextFieldView=SC.FieldView.extend(SC.StaticLayout,SC.Editable,{classNames:["sc-text-field-view"],isTextField:YES,escapeHTML:NO,applyImmediately:YES,commitOnBlur:YES,isPassword:NO,isTextArea:NO,hint:"",type:"text",isBrowserFocusable:YES,autoCorrect:!0,autoCapitalize:!0,formattedHint:function(){var e=this.get("hint");return typeof e=="string"&&(this.get("localize")&&(e=SC.String.loc(e)),this.get("escapeHTML")&&(e=SC.RenderContext.escapeHTML(e)),e=e.replace(/\"/g,"&#34;")),e}.property("hint","localize","escapeHTML").cacheable(),hintOnFocus:YES,localize:YES,isEditing:NO,defaultTabbingEnabled:YES,isContextMenuEnabled:YES,continuouslyUpdatesValue:null,allowsErrorAsValue:YES,leftAccessoryView:null,rightAccessoryView:null,spellCheckEnabled:YES,maxLength:5096,shouldRenderBorder:YES,shouldRenderInnerBorder:NO,supportsAutoResize:YES,autoResizeLayer:function(){return this.$input()[0]}.property("layer").cacheable(),autoResizeText:function(){return this.get("value")}.property("value").cacheable(),autoResizePadding:SC.propertyFromRenderDelegate("autoResizePadding",20),_hintON:YES,init:function(){var e=this.get("value");this._hintON=(!e||e&&e.length===0)&&!this.get("hintOnFocus"
)?YES:NO;var t=this.get("continouslyUpdatesValue");return t!==null&&t!==undefined&&this.set("applyImmediately",t),arguments.callee.base.apply(this,arguments)},isEditable:YES,selection:function(e,t){var n=this.$input()[0],r,i,s;if(t===undefined){if(n){i=null,s=null;if(!n.value)i=s=0;else{try{"selectionStart"in n&&(i=n.selectionStart),"selectionEnd"in n&&(s=n.selectionEnd)}catch(o){return null}if(i===null||s===null){var u=document.selection;if(u){var a=u.type;if(a&&(a==="None"||a==="Text")){r=u.createRange();if(!this.get("isTextArea")){var f=r.text.length;i=Math.abs(r.moveStart("character",0-(n.value.length+1))),s=i+f}else{var l=r.duplicate();l.moveToElementText(n),l.setEndPoint("EndToStart",r),i=l.text.length,s=i+r.text.length}}}}}return SC.TextSelection.create({start:i,end:s})}return null}if(!t||!t.kindOf||!t.kindOf(SC.TextSelection))throw"When setting the selection, you must specify an SC.TextSelection instance.";if(n)if(n.setSelectionRange)n.setSelectionRange(t.get("start"),t.get("end"));else{r=n.createTextRange(),i=t.get("start"),r.move("character",i),r.moveEnd("character",t.get("end")-i);try{r.select()}catch(o){SC.Error("Failed selecting, this is a know bug with IE8, error 800a025e. Ignoring")}}return t}.property("fieldValue").cacheable(),displayProperties:["isBrowserFocusable","formattedHint","fieldValue","isEditing","isEditable","leftAccessoryView","rightAccessoryView","isTextArea"],createChildViews:function(){arguments.callee.base.apply(this,arguments),this.accessoryViewObserver()},acceptsFirstResponder:function(){return this.get("isEnabled")}.property("isEnabled"),accessoryViewObserver
:function(){var e,t=["leftAccessoryView","rightAccessoryView"],n=t.length,r,i,s,o;for(r=0;r<n;r++){i=t[r],s=this["_"+i],o=this.get(i);if(!s||!o||s!==o){s&&(e=s.get("classNames"),e=e.without("sc-text-field-accessory-view"),s.set("classNames",e),this.removeChild(s),s=null,this["_"+i]=null);if(o){o.isClass&&(o=o.create({layoutView:this})),e=o.get("classNames");var u="sc-text-field-accessory-view";e.indexOf(u)<0&&(e=SC.clone(e),e.push(u),o.set("classNames",e)),this.appendChild(o),this["_"+i]=o}}}}.observes("leftAccessoryView","rightAccessoryView"),layoutChildViewsIfNeeded:function(e){e||(e=this.get("isVisibleInWindow"));if(e&&this.get("childViewsNeedLayout")){var t=this.get("rightAccessoryView");if(t&&t.get){var n=t.get("layout");n&&(n.left=null,n.right||(n.right=0),t.adjust({layout:n}))}}arguments.callee.base.apply(this,arguments)},render:function(e,t){arguments.callee.base.apply(this,arguments);var n,r,i,s;n=this.get("fieldValue"),SC.none(n)&&(n=""),n=String(n),e.setClass("not-empty",n.length>0),r=this._getAccessoryViewWidths(),i=r.left,s=r.right,i&&(i+="px"),s&&(s+="px"),this._renderField(e,t,n,i,s)},localizedAriaLabel:function(){var e=this.get("ariaLabel");return!SC.none(e)&&typeof e===SC.T_STRING&&this.get("localize")&&(e=SC.String.loc(e)),e}.property("ariaLabel","localize").cacheable(),_forceRenderFirstTime:NO,_renderFieldLikeFirstTime:function(){this.set("_forceRenderFirstTime",YES)}.observes("isTextArea"),_renderField:function(e,t,n,r,i){var s=this.get("formattedHint"),o=this.get("localizedAriaLabel"),u=this.get("hintOnFocus"),a="",f=this.get("maxLength"),l=this.get("isTextArea"
),c=this.get("isEnabled"),h=this.get("isEditable"),p=this.get("autoCorrect"),d=this.get("autoCapitalize"),v=this.get("isBrowserFocusable"),m=SC.RenderContext,g="",y="",b="",w,E,S,x,T,N,C,k,L,A;n&&(this.get("escapeHTML")&&(n=m.escapeHTML(n)),n=n.replace(/\"/g,"&#34;")),e.setClass("text-area",l),e.setClass("text-field",!l),k=SC.browser.isWebkit&&parseInt(SC.browser.webkit,0)<532,e.setClass("oldWebKitFieldPadding",k);if(SC.none(o)){var O=this.get("hint");o=this.get("localize")?SC.String.loc(O):O}if(t||this._forceRenderFirstTime){this._forceRenderFirstTime=NO,L=c?h?"":'readonly="readonly"':'disabled="disabled"',w=this.get("layerId"),g=this.get("spellCheckEnabled")?' spellcheck="true"':' spellcheck="false"',o=m.escapeAttribute(o),SC.browser.mobileSafari&&(b=p?"":' autocorrect="off"',y=d?"":' autocapitalize="off"'),v&&(A='tabindex="-1"'),SC.platform.input.placeholder&&!u&&(a=' placeholder="'+s+'"'),this.get("shouldRenderBorder")&&!this.get("shouldRenderInnerBorder")&&e.push('<div class="border"></div>'),E="";if(r||i)E='style="',r&&(E+="left: "+r+"; "),i&&(E+="right: "+i+";"),E+='"';e.push('<div class="padding" '+E+">"),this._hintON&&!SC.platform.input.placeholder&&(!n||n&&n.length===0)&&(n=s,e.setClass("sc-hint",YES));if(u){var M='<div aria-hidden="true" class="hint '+(l?"":"ellipsis")+'%@">'+s+"</div>";e.push(M.fmt(n?" sc-hidden":""))}C="field",l?e.push('<textarea aria-label="'+o+'" aria-multiline="true" class="'+C+'" name="'+w+'" '+L+a+g+b+A+y+' maxlength="'+f+'">'+n+"</textarea>"):(S=this.get("type"),this.get("isPassword")&&(S="password"),e.push('<input aria-label="'+o+'" class="'+
C+'" type="'+S+'" name="'+w+'" '+L+' value="'+n+'"'+a+g+A+' maxlength="'+f+'" '+b+" "+y+"/>")),this.get("shouldRenderInnerBorder")&&e.push('<div class="border"></div>'),e.push("</div>")}else{var _=this.$input(),D=_[0],P=this.get("value"),H=this.$(".hint")[0];u&&H?H.innerHTML=s:u||(D.placeholder=s);if(!P||P&&P.length===0)this.get("isPassword")&&(D.type="password"),!SC.platform.input.placeholder&&this._hintON&&(this.get("isFirstResponder")?(e.setClass("sc-hint",NO),_.val("")):(e.setClass("sc-hint",YES),_.val(s)));_.attr("aria-label",o),SC.browser.mobileSafari&&(_.attr("autoCapitalize",d?"true":"off"),_.attr("autoCorrect",p?"true":"off")),!u&&SC.platform.input.placeholder&&_.attr("placeholder",s),v?_.removeAttr("tabindex"):_.attr("tabindex","-1"),T=_[0],T&&(c?h?(T.disabled=null,T.readOnly=null):(T.disabled=null,T.readOnly="true"):(T.disabled="true",T.readOnly=null),N=T.parentNode.style,r?N.left!==r&&(N.left=r):N.left=null,i?N.right!==i&&(N.right=i):N.right=null)}},_getAccessoryViewWidths:function(){var e={},t=["left","right"],n=t.length,r,i,s,o,u,a,f,l;for(r=0;r<n;r++)i=t[r],s=this.get(i+"AccessoryView"),s&&(s.isClass&&(s=s.create({layoutView:this})),s.get&&(l=s.get("frame"),l&&(u=l.width,u&&(a=s.get("layout"),a&&(f=a[i],u+=f),e[i]=u))));return e},didCreateLayer:function(){arguments.callee.base.apply(this,arguments),SC.platform.input.placeholder||this.invokeLast(this._setInitialPlaceHolderIE);if(this.get("isTextArea"))this.invokeLast(this._addTextAreaEvents);else{this._addTextAreaEvents();if(SC.browser.mozilla){var e=this.$input();SC.Event.add(e,"keypress",this,this._firefox_dispatch_keypress
)}}},_setInitialPlaceHolderIE:function(){if(!SC.platform.input.placeholder&&this._hintON){var e=this.$input(),t=e.val();(!t||t&&t.length===0)&&e.val(this.get("formattedHint"))}},_addTextAreaEvents:function(){var e=this.$input();SC.Event.add(e,"focus",this,this._textField_fieldDidFocus),SC.Event.add(e,"blur",this,this._textField_fieldDidBlur),SC.Event.add(e,"select",this,this._textField_selectionDidChange),SC.Event.add(e,"input",this,this._html5input),SC.Event.add(e,"compositionstart",this,this._IMECompositionStart)},willDestroyLayer:function(){arguments.callee.base.apply(this,arguments);var e=this.$input();SC.Event.remove(e,"focus",this,this._textField_fieldDidFocus),SC.Event.remove(e,"blur",this,this._textField_fieldDidBlur),SC.Event.remove(e,"select",this,this._textField_selectionDidChange),SC.Event.remove(e,"keypress",this,this._firefox_dispatch_keypress),SC.Event.remove(e,"input",this,this._html5input),SC.Event.remove(e,"compositionstart",this,this._IMECompositionStart)},_textField_fieldDidFocus:function(e){SC.run(function(){this.set("focused",YES),this.fieldDidFocus(e);var t=this.get("value");!SC.platform.input.placeholder&&(!t||t&&t.length===0)&&(this._hintON=NO)},this)},_textField_fieldDidBlur:function(e){SC.run(function(){this.set("focused",NO),this.fieldDidBlur(this._origEvent||e);var t=this.get("value");!SC.platform.input.placeholder&&!this.get("hintOnFocus")&&(!t||t&&t.length===0)&&(this._hintON=YES)},this)},fieldDidFocus:function(e){this.becomeFirstResponder(),this.beginEditing(e),this._field_valueHasChanged=NO,this._didHideInterceptForPane&&(this._didHideInterceptForPane
.showTouchIntercept(),this._didHideInterceptForPane=null);var t=this.get("pane");t&&t.get("hasTouchIntercept")&&(t.hideTouchIntercept(),this._didHideInterceptForPane=this.get("pane"))},fieldDidBlur:function(e){this.resignFirstResponder(e),this._field_valueHasChanged&&(this.fieldValueDidChange(NO),this._field_valueHasChanged=NO),this.get("commitOnBlur")&&this.commitEditing(e);var t=this._didHideInterceptForPane;t&&(t.showTouchIntercept(),t=null)},_field_fieldValueDidChange:function(e){this.get("focused")&&SC.run(function(){this.fieldValueDidChange(NO)},this),this.updateHintOnFocus()},_html5input:function(e){SC.run(function(){this.get("applyImmediately")||!this.get("focused")?this.fieldValueDidChange(YES):this._field_valueHasChanged=YES},this),this.updateHintOnFocus()},_IMECompositionStart:function(e){this.updateHintOnFocus(YES)},updateHintOnFocus:function(e){var t=this.get("hintOnFocus");if(!t)return;var n=this.getFieldValue();n!==undefined&&n!==null&&n.length>0||e&&SC.typeOf(e)===SC.T_BOOL?this.$(".hint").addClass("sc-hidden"):this.$(".hint").removeClass("sc-hidden")}.observes("value"),_topOffsetForFirefoxCursorFix:3,_firefox_dispatch_keypress:function(e){var t=this.get("selection"),n=this.get("value"),r=n?n.length:0,i;if(!t||t.get("length")===0&&t.get("start")===0||t.get("end")===r){i=SC.RootResponder.responder;if(e.keyCode===9)return;i.keypress.call(i,e),e.stopPropagation()}},_textField_selectionDidChange:function(){this.notifyPropertyChange("selection")},didBecomeKeyResponderFrom:function(e){if(this.get("isVisibleInWindow")){var t=this.$input()[0];try{t&&t.focus()}catch(n
){}this._txtFieldMouseDown||this.invokeLast(this._selectRootElement)}},_selectRootElement:function(){var e=this.$input()[0];e?(!SC.browser.isSafari||!SC.browser.isLion||SC.buildLocale!=="ko-kr")&&e.select():this._textField_selectionDidChange()},didLoseKeyResponderTo:function(e){var t=this.$input()[0];t&&t.blur(),this.invokeLater("scrollToOriginIfNeeded",100)},scrollToOriginIfNeeded:function(){var e=this.get("pane");if(!e)return;var t=e.get("firstResponder");if(!t||!t.get("isTextField"))document.body.scrollTop=document.body.scrollLeft=0},keyDown:function(e){var t=e.which,n=e.keyCode,r=!1,i,s;if(t===SC.Event.KEY_RETURN&&!e.isIMEInput&&!this.get("isTextArea"))return NO;if(t===SC.Event.KEY_ESC)return NO;if(t!==SC.Event.KEY_TAB&&n!==SC.Event.KEY_TAB||!this.get("defaultTabbingEnabled")){if(!SC.platform.input.maxlength&&this.get("isTextArea")){var o=this.get("value");o&&(!SC.browser.mozilla&&t>47||SC.browser.mozilla&&(t>32&&t<43||t>47)&&!(n>36&&n<41))&&o.length>=this.get("maxLength")&&(r=!0)}(this.performValidateKeyDown(e)||SC.platform.touch)&&!r||SC.isFunctionOrNonPrintableKey(e)?(this._isKeyDown=YES,e.allowDefault()):e.stop();if(this.get("applyImmediately")){var u=this;setTimeout(function(){u.fieldValueDidChange()},10)}else this._field_valueHasChanged=YES;return YES}return s=e.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView"),s?s.becomeFirstResponder():e.allowDefault(),YES},keyUp:function(e){return SC.browser.mozilla&&e.keyCode===SC.Event.KEY_RETURN&&this.fieldValueDidChange(),this.notifyPropertyChange("selection"),this._isKeyDown=NO,e.allowDefault(),YES},mouseDown
:function(e){var t=this.get("fieldValue"),n=this.$input();return n&&(n=n[0]),this._txtFieldMouseDown=YES,document.activeElement!==n&&(SC.browser.isIE8OrLower?this.invokeLater(this.becomeFirstResponder,50):this.becomeFirstResponder()),this.get("isEnabled")?e.target!==n?(e.stop(),SC.browser.isIE8OrLower&&setTimeout(function(){n.focus()},0),YES):arguments.callee.base.apply(this,arguments):(e.stop(),YES)},mouseUp:function(e){return this._txtFieldMouseDown=NO,this.notifyPropertyChange("selection"),this.get("isEnabled")?arguments.callee.base.apply(this,arguments):(e.stop(),YES)},doubleClick:function(e){return SC.browser.isIE8OrLower?this.mouseDown(e)|this.mouseUp(e):NO},touchStart:function(e){return this.mouseDown(e)},touchEnd:function(e){return this.mouseUp(e)},mouseWheel:function(e){return this.get("isTextArea")?(e.allowDefault(),YES):NO},selectStart:function(e){return YES},_valueObserver:function(){var e=this.get("value"),t;e&&e.length>0?(this._hintON=NO,t=this.get("maxLength"),!SC.platform.input.maxlength&&e.length>t&&this.set("value",e.substr(0,t))):this.get("hintOnFocus")||(this._hintON=YES)}.observes("value")}),SC.InlineTextFieldView=SC.TextFieldView.extend(SC.InlineEditor,{classNames:["inline-editor"],_topOffsetForFirefoxCursorFix:0,blurOnMouseDown:YES,_updateViewStyle:function(e){var t="",n=SC.getStyle(e,"font-size");return n&&n.length>0&&(t=t+"font-size: "+n+" !important; "),n=SC.getStyle(e,"font-family"),n&&n.length>0&&(t=t+"font-family: "+n+" !important; "),n=SC.getStyle(e,"font-weight"),n&&n.length>0&&(t=t+"font-weight: "+n+" !important; "),n=SC.getStyle(e,"z-index"),
n&&n.length>0&&(t=t+"z-index: "+n+" !important; "),n=SC.getStyle(e,"line-height"),n&&n.length>0&&(t=t+"line-height: "+n+" !important; "),n=SC.getStyle(e,"text-align"),n&&n.length>0&&(t=t+"text-align: "+n+" !important; "),n=SC.getStyle(e,"top-margin"),n&&n.length>0&&(t=t+"top-margin: "+n+" !important; "),n=SC.getStyle(e,"bottom-margin"),n&&n.length>0&&(t=t+"bottom-margin: "+n+" !important; "),n=SC.getStyle(e,"left-margin"),n&&n.length>0&&(t=t+"left-margin: "+n+" !important; "),n=SC.getStyle(e,"right-margin"),n&&n.length>0&&(t=t+"right-margin: "+n+" !important; "),t},_updateViewPaddingStyle:function(e){var t="",n=SC.getStyle(e,"padding-top");return n&&n.length>0&&(t=t+"top: "+n+" !important; "),n=SC.getStyle(e,"padding-bottom"),n&&n.length>0&&(t=t+"bottom: "+n+" !important; "),n=SC.getStyle(e,"padding-left"),n&&n.length>0&&(t=t+"left: "+n+" !important; "),n=SC.getStyle(e,"padding-right"),n&&n.length>0&&(t=t+"right: "+n+" !important; "),t},updateStyle:function(e){e.length&&(e=e[0]);var t=document.getElementById("sc-inline-text-field-style"),n=this._updateViewStyle(e),r=this._updateViewPaddingStyle(e),i=".inline-editor input{"+n+"}"+".inline-editor textarea{"+n+"}"+".inline-editor .padding{"+r+"}";if(!t){var s=document.getElementsByTagName("head")[0];t=document.createElement("style"),t.type="text/css",t.media="screen",t.id="sc-inline-text-field-style",s.appendChild(t)}t.styleSheet?t.styleSheet.cssText=i:t.innerHTML=i},positionOverTargetView:function(e,t,n,r,i){n||(n=e.get("pane")),i||(i=e.$()[0]);if(!r){var s=e.get("frame");r=SC.offset(i),r.height=s.height,r.width=s.width}var o=
{},u=n.$()[0],a=e.get("layout");o.height=r.height,o.width=r.width,t&&a.left?(o.left=r.x-a.left-u.offsetLeft-1,SC.browser.msie==7&&o.left--):(o.left=r.x-u.offsetLeft-1,SC.browser.msie==7&&o.left--),t&&a.top?(o.top=r.y-a.top-u.offsetTop,SC.browser.msie==7&&(o.top=o.top-2)):(o.top=r.y-u.offsetTop,SC.browser.msie==7&&(o.top=o.top-2)),this.set("layout",o)},multiline:NO,isTextArea:function(){return this.get("multiline")}.property("multiline").cacheable(),beginEditing:function(e,t){if(!e(t))return NO;var n=t.get("pane"),r=this.get("exampleElement");return this.beginPropertyChanges(),r?r.length&&(r=r[0]):r=t.$()[0],this.updateStyle(r),this.positionOverTargetView(t,this.get("isCollection"),n,this.get("exampleFrame"),r),this._previousFirstResponder=n?n.get("firstResponder"):null,this.becomeFirstResponder(),this.endPropertyChanges(),YES}.enhance(),blurEditor:function(e){return this.get("isEditing")?this.commitOnBlur?this.commitEditing():this.discardEditing():YES},_endEditing:function(e){var t=e();if(this.get("isFirstResponder")){var n=this.get("pane");n&&this._previousFirstResponder?n.makeFirstResponder(this._previousFirstResponder):this.resignFirstResponder()}return this._previousFirstResponder=null,t}.enhance(),mouseDown:function(e){return arguments.callee.base.call(this,e),this.get("isEditing")},touchStart:function(e){this.mouseDown(e)},keyDown:function(e){if(e.isIMEInput===!0&&e.which===13)return!0;var t=this.interpretKeyEvents(e);return this.fieldValueDidChange(!0),t?t:NO},insertText:null,_scitf_blurInput:function(){var e=this.$input()[0];e&&e.blur(),e=null},willRemoveFromParent:function(
){return this._scitf_blurInput()},willLoseFirstResponder:function(e,t){if(e!==this)return;return this._previousFirstResponder=null,this._origEvent=t,this._scitf_blurInput(),this.blurEditor(t)},cancel:function(){return this.discardEditing(),YES},fieldValueDidChange:function(e){arguments.callee.base.call(this,e)},insertNewline:function(e){return this.get("isTextArea")?(e.allowDefault(),arguments.callee.base.call(this,e)):(this.get("value")!=this.$input().val()&&this.set("value",this.$input().val()),this.commitEditing(),YES)},insertTab:function(e){var t=this.target;this.resignFirstResponder(),this.commitEditing();if(t){var n=t.get("nextValidKeyView");n&&n.beginEditing&&n.beginEditing()}return YES},insertBacktab:function(e){var t=this.target;this.resignFirstResponder(),this.commitEditing();if(t){var n=t.get("previousValidKeyView");n&&n.beginEditing&&n.beginEditing()}return YES},deleteForward:function(e){return e.allowDefault(),YES},deleteBackward:function(e){return e.allowDefault(),YES}}),SC.mixin(SC.InlineTextFieldView,{inlineEditorDelegate:SC.InlineTextFieldDelegate,label:null,editor:null,beginEditing:function(e){var t,n,r,i,s;if(SC.typeOf(e)===SC.T_HASH){r=e;if(!r.delegate||!r.exampleElement||!r.frame)return SC.error("Delegate, exampleElement, and frame options are required."),NO;e=r.delegate,i=r.value}else i=e.get("value");return s=SC.beget(e),s.mixin({inlineEditorWillBeginEditing:function(){e.inlineEditorWillBeginEditing&&e.inlineEditorWillBeginEditing.apply(e,arguments)},inlineEditorDidBeginEditing:function(){e.inlineEditorDidBeginEditing&&e.inlineEditorDidBeginEditing.apply
(e,arguments)},inlineEditorWillCommitEditing:function(t,n,r){e.inlineEditorWillCommitEditing&&e.inlineEditorWillCommitEditing(t,n,r),e.inlineEditorWillEndEditing&&e.inlineEditorWillEndEditing(t,n)},inlineEditorDidCommitEditing:function(t,n,r){e.inlineEditorDidCommitEditing&&e.inlineEditorDidCommitEditing(t,n,r),e.inlineEditorDidEndEditing&&e.inlineEditorDidEndEditing(t,n),SC.InlineTextFieldView._endEditing()},inlineEditorWillDiscardEditing:function(t,n){e.inlineEditorWillDiscardEditing&&e.inlineEditorWillDiscardEditing(t,n),e.inlineEditorWillEndEditing&&e.inlineEditorWillEndEditing(t,this.get("value"))},inlineEditorDidDiscardEditing:function(t,n){e.inlineEditorDidDiscardEditing&&e.inlineEditorDidDiscardEditing(t,n),e.inlineEditorDidEndEditing&&e.inlineEditorDidEndEditing(t,this.get("value")),SC.InlineTextFieldView._endEditing()}}),e.inlineEditorShouldBeginEditing&&!e.inlineEditorShouldBeginEditing(e,i)?NO:(this.editor=n=this.inlineEditorDelegate.acquireEditor(e),n.set("value",i),r&&(n.set("exampleElement",r.exampleElement),n.set("exampleFrame",r.frame),n.set("multiline",r.multiline),n.set("escapeHTML",r.escapeHTML),n.set("isCollection",r.isCollection),n.set("commitOnBLur",r.commitOnBlur),n.set("validator",r.validator)),n?n.beginEditing(s):NO)},commitEditing:function(){return this.inlineEditorDelegate.editor?this.inlineEditorDelegate.editor.commitEditing():NO},discardEditing:function(){return this.inlineEditorDelegate.editor?this.inlineEditorDelegate.editor.discardEditing():NO},_endEditing:function(){this.inlineEditorDelegate.releaseEditor(this.editor),this.editor=null}}),SC.
REGULAR_WEIGHT="normal",SC.BOLD_WEIGHT="bold",SC.LabelView=SC.View.extend(SC.Control,SC.InlineEditable,{classNames:["sc-label-view"],displayProperties:["displayTitle","textAlign","fontWeight","icon","escapeHTML","needsEllipsis","hint"],inlineEditorDelegate:SC.InlineTextFieldDelegate,isEditable:NO,exampleEditor:SC.InlineTextFieldView,fontWeight:null,escapeHTML:YES,escapeHTMLBindingDefault:SC.Binding.oneWay().bool(),localize:NO,localizeBindingDefault:SC.Binding.oneWay().bool(),formatter:null,value:"",hint:null,hintEnabled:function(){return this.get("isEditable")}.property("isEditable").cacheable(),icon:null,textAlign:null,supportsAutoResize:YES,autoResizeLayer:function(){return this.get("layer")}.property("layer").cacheable(),autoResizeText:function(){return this.get("displayTitle")}.property("displayTitle").cacheable(),autoResizePadding:SC.propertyFromRenderDelegate("autoResizePadding",10),renderDelegateName:"labelRenderDelegate",displayTitle:function(){var e,t;e=this.get("value"),t=this.getDelegateProperty("formatter",this.displayDelegate);if(t){var n=SC.typeOf(t)===SC.T_FUNCTION?t(e,this):t.fieldValueForObject(e,this);SC.none(n)||(e=n)}if(SC.typeOf(e)===SC.T_ARRAY){var r=[];for(var i=0,s=e.get("length");i<s;i++){var o=e.objectAt(i);!SC.none(o)&&o.toString&&(o=o.toString()),r.push(o)}e=r.join(",")}return!SC.none(e)&&e.toString&&(e=e.toString()),e&&this.getDelegateProperty("localize",this.displayDelegate)&&(e=SC.String.loc(e)),e}.property("value","localize","formatter").cacheable(),hintValue:function(){var e=this.get("hint");return e}.property("hint").cacheable(),doubleClick:
function(e){return this.beginEditing()},inlineEditorDidBeginEditing:function(e,t,n,r){this._oldOpacity=this.get("layout").opacity||1,this.adjust("opacity",0),e(t,n,r)}.enhance(),inlineEditorDidEndEditing:function(){this.adjust("opacity",this._oldOpacity),this._oldOpacity=null}}),SC.BORDER_BEZEL="sc-bezel-border",SC.BORDER_BLACK="sc-black-border",SC.BORDER_GRAY="sc-gray-border",SC.BORDER_TOP="sc-top-border",SC.BORDER_BOTTOM="sc-bottom-border",SC.BORDER_NONE=null,SC.Border={borderTop:0,borderRight:0,borderBottom:0,borderLeft:0,borderStyle:SC.BORDER_GRAY,hasBorder:YES,displayProperties:["borderStyle"],_BORDER_REGEXP:/-border$/,initMixin:function(){console.warn("SC.Border is deprecated, please set border in your layout"),this._sc_border_borderStyleDidChange(),this._sc_border_borderDimensionsDidChange()},renderMixin:function(e,t){var n=this.get("borderStyle");n&&(this._BORDER_REGEXP.exec(n)?e.addClass(n):e.addStyle("border","1px "+n+" solid"))},_sc_border_borderStyleDidChange:function(){var e=this.get("borderStyle"),t=SC.Border.dimensions[e];t&&(this.beginPropertyChanges(),this.set("borderTop",t),this.set("borderRight",t),this.set("borderBottom",t),this.set("borderLeft",t),this.endPropertyChanges())},_sc_border_borderDimensionsDidChange:function(){var e=this.get("borderTop"),t=this.get("borderRight"),n=this.get("borderBottom"),r=this.get("borderLeft");this.adjust({borderTop:e,borderRight:t,borderBottom:n,borderLeft:r})}.observes("borderTop","borderRight","borderBottom","borderLeft")},SC.mixin(SC.Border,{dimensions:{"sc-bezel-border":1,"sc-black-border":1,"sc-gray-border":1,"sc-top-border"
:1,"sc-bottom-border":1}}),SC.CollectionFastPath={initMixin:function(){this._indexMap={}},poolForExampleView:function(e){var t="_pool_"+SC.guidFor(e);return this[t]||(this[t]=[]),this[t]},createItemViewFromExampleView:function(e,t){var n=this.createItemView(e,null,t);return n.isPoolable&&(n.owningPool=this.poolForExampleView(e)),n.createdFromExampleView=e,n},configureItemView:function(e,t){e.beginPropertyChanges(),e.setIfChanged("content",t.content),e.setIfChanged("contentIndex",t.contentIndex),e.setIfChanged("parentView",t.parentView),e.setIfChanged("layerId",t.layerId),e.setIfChanged("isEnabled",t.isEnabled),e.setIfChanged("isSelected",t.isSelected),e.setIfChanged("outlineLevel",t.outlineLevel),e.setIfChanged("layout",t.layout),e.setIfChanged("disclosureState",t.disclosureState),e.setIfChanged("isVisibleInWindow",t.isVisibleInWindow),e.setIfChanged("isGroupView",t.isGroupView),e.setIfChanged("page",this.page),e.endPropertyChanges()},wakePooledView:function(e,t){this.configureItemView(e,t),e.awakeFromPool&&e.awakeFromPool(e.owningPool,this)},allocateItemView:function(e,t){var n;if(e.prototype.isPoolable){var r=this.poolForExampleView(e);r.length>0&&(n=r.pop(),this.wakePooledView(n,t))}return n||(n=this.createItemViewFromExampleView(e,t)),n},releaseItemView:function(e){if(!e.isPoolable){e.destroy();return}var t=e.owningPool;t.push(e),e.hibernateInPool&&e.hibernateInPool(t,this)},contentIndexIsGroup:function(e,t,n){var r=this.get("contentDelegate"),i=this.get("_contentGroupIndexes"),s=NO;return s=i&&i.contains(n),s&&(s=r.contentIndexIsGroup(this,this.get("content"),n)),s},exampleViewForItem
:function(e,t){var n=this.get("contentDelegate"),r=this.get("_contentGroupIndexes"),i,s,o=this.contentIndexIsGroup(this,this.get("content"),t);return o?(i=this.get("contentGroupExampleViewKey"),i&&e&&(s=e.get(i)),s||(s=this.get("groupExampleView")||this.get("exampleView"))):(i=this.get("contentExampleViewKey"),i&&e&&(s=e.get(i)),s||(s=this.get("exampleView"))),s},setAttributesForItem:function(e,t,n){var r=this.get("contentDelegate"),i=this.contentIndexIsGroup(this,this.get("content"),t),s=this.exampleViewForItem(e,t),o=this.get("content");n.createdFromExampleView=s,n.parentView=this.get("containerView")||this,n.contentIndex=t,n.owner=n.displayDelegate=this,n.content=e,n.page=this.page,n.layerId=this.layerIdFor(t),n.isEnabled=r.contentIndexIsEnabled(this,o,t),n.isSelected=r.contentIndexIsSelected(this,o,t),n.outlineLevel=r.contentIndexOutlineLevel(this,o,t),n.disclosureState=r.contentIndexDisclosureState(this,o,t),n.isVisibleInWindow=this.get("isVisibleInWindow"),n.isGroupView=i,n.layout=this.layoutForContentIndex(t),n.layout||(n.layout=s.prototype.layout)},mappedViewsForItem:function(e,t){return t||(t=this._viewMap),t[SC.guidFor(e)]},mappedViewForItem:function(e,t,n){n||(n=this._viewMap);var r=n[SC.guidFor(e)];return r?r[t]:undefined},mapView:function(e,t,n,r){r||(r=this._viewMap);var i=SC.guidFor(e),s=r[i];s||(s=r[i]={_length:0}),s[t]=n,s._length++},unmapView:function(e,t,n){n||(n=this._viewMap);var r=SC.guidFor(e),i=n[r];if(!i)return;if(i[t]){var s=i[t];delete i[t],i._length--,i._length<=0&&delete n[r]}},itemViewForContentIndex:function(e){var t=this.get("content");if(!t)return;
var n=t.objectAt(e);if(!n)return null;var r=this.exampleViewForItem(n,e),i=this._indexMap[e];return i&&i.createdFromExampleView!==r&&(this.removeItemView(i),this.unmapView(n,e),i=null),i||(i=this.addItemView(r,n,e)),i},nearestMappedViewIndexForItem:function(e,t,n){var r=this.mappedViewsForItem(e,n);if(!r)return null;var i=null,s=-1,o=0;for(var u in r){u=parseInt(u,10);if(isNaN(u))continue;o=Math.abs(t-u);if(s<0||o<s)s=o,i=u}return i},remapItemViews:function(e){var t=this._viewMap||{},n=this._viewMap={},r=this._indexMap={},i=[],s=this.get("content"),o;if(!s)return;var u=this._itemsToAdd;e.forEach(function(e){o=s.objectAt(e);var a=this.mappedViewsForItem(o,t);if(a)if(a[e]){var f=a[e];this.unmapView(o,e,t),this.mapView(o,e,f,n),r[e]=f}else i.push(e);else u.push(e)},this);for(var a=0,f=i.length;a<f;a++){var l=i[a];o=s.objectAt(l);var c=this.nearestMappedViewIndexForItem(o,l,t),h;if(!SC.none(c)){h=this.mappedViewForItem(o,c,t);var p=this.exampleViewForItem(o,l);p===h.createdFromExampleView?(this.unmapView(o,c,t),this.mapView(o,l,h,n),r[l]=h):u.push(l)}else u.push(l)}return t},reloadIfNeeded:function(e,t){var n=this.get("content"),r;if(!e||!e.isIndexSet)e=this.get("nowShowing");if(!t){r=this._invalidIndexes;if(!r||!this.get("isVisibleInWindow"))return this;this._invalidIndexes=NO,r.isIndexSet&&r.contains(e)&&(r=YES),this.willReload&&this.willReload(r===YES?null:r)}var i=this._itemsToAdd||(this._itemsToAdd=[]),s=this.remapItemViews(e);this.processRemovals(s);if(r){var o=e;r.isIndexSet&&e.contains(r)&&(o=r),this.processUpdates(o)}this.processAdds(),t||this.clearDOMPools(),i.length=0
;if(!t){var u=this.computeLayout();u&&this.adjust(u),this.didReload&&this.didReload(r===YES?null:r)}return this},processRemovals:function(e){var t=this.get("content");for(var n in e){var r=e[n];for(var i in r){i=parseInt(i,10);if(isNaN(i))continue;var s=r[i];this._indexMap[i]===s&&delete this._indexMap[i],s._isInCollection=NO,this.removeItemView(s)}}},processUpdates:function(e){var t=this._itemsToUpdate,n=this.get("content"),r,i;e.forEach(function(e){r=n.objectAt(e);if(i=this.mappedViewForItem(r,e)){if(!i._isInCollection)return;var t=this.exampleViewForItem(r,e);this.updateItemView(i,t,r,e)}},this)},processAdds:function(){var e=this.get("content"),t=this._itemsToAdd,n,r=t.length,i,s;for(n=0;n<r;n++){i=t[n],s=e.objectAt(i);var o=this.exampleViewForItem(s,i),u=this.addItemView(o,s,i)}},clearDOMPools:function(){var e=this._domPools||(this._domPools={});for(var t in e)this.clearDOMPool(e[t])},domPoolSize:10,clearDOMPool:function(e){var t,n=e.length,r;for(t=this.domPoolSize;t<n;t++)r=e[t],this.removeChild(r),this.releaseItemView(r);e.length=Math.min(e.length,this.domPoolSize)},domPoolForExampleView:function(e){var t=this._domPools||(this._domPools={}),n=SC.guidFor(e),r=t[n];return r||(r=t[n]=[]),r},itemFromDOMPool:function(e){var t=this.domPoolForExampleView(e);if(t.length<1)return null;var n=t.shift();return n.wakeFromDOMPool&&n.wakeFromDOMPool(),n},sendToDOMPool:function(e){var t=this.domPoolForExampleView(e.createdFromExampleView);t.push(e);var n=e.get("frame");e.adjust({top:-n.height}),e.set("layerId",SC.guidFor(e)),e.sleepInDOMPool&&e.sleepInDOMPool()},addItemView:function(e
,t,n){var r,i=this._TMP_ATTRS||(this._TMP_ATTRS={});return this.setAttributesForItem(t,n,i),(r=this.itemFromDOMPool(e))?(this.configureItemView(r,i),r._isInCollection=YES,this.mapView(t,n,r),this._indexMap[n]=r,r):(r=this.allocateItemView(e,i),this.appendChild(r),r._isInCollection=YES,this.mapView(t,n,r),this._indexMap[n]=r,r)},removeItemView:function(e){e.get("layerIsCacheable")?this.sendToDOMPool(e):(this.removeChild(e),e.destroyLayer()),e._isInCollection=NO},updateItemView:function(e,t,n,r){if(!e.get("layerIsCacheable")||e.createdFromExampleView!==t){this.unmapView(e,r),delete this._indexMap[r],this.removeItemView(e,n,r);var i=this.addItemView(t,n,r)}else{var s=this._TMP_ATTRS||(this._TMP_ATTRS={});this.setAttributesForItem(n,r,s),this.configureItemView(e,s)}},_lastTopUpdate:0,_lastLeftUpdate:0,_tolerance:100,touchScrollDidChange:function(e,t){if(SC.getCurrentTimeForPerformance()-this._lastTouchScrollTime<25)return;var n=this.get("clippingFrame"),r=this._inScrollClippingFrame||(this._inScrollClippingFrame={x:0,y:0,width:0,height:0});r.x=n.x,r.y=n.y,r.width=n.width,r.height=n.height,r.x=e,r.y=t;var i=this.contentIndexesInRect(r);if(!i)return;var s=this.get("length"),o=i.get("max"),u=i.get("min");if(o>s||u<0)i=i.copy(),i.remove(s,o-s).remove(u,0-u).freeze();if(this._lastNowShowing&&i.contains(this._lastNowShowing)&&this._lastNowShowing.contains(i))return;this._lastNowShowing=i,this.reloadIfNeeded(i,YES),this._lastTouchScrollTime=SC.getCurrentTimeForPerformance()}},SC.CollectionGroup={classNames:["sc-collection-group"]},SC.CollectionRowDelegate={isCollectionRowDelegate:YES,itemHeight
:24,rowSpacing:0,rowPadding:0,rowHeight:function(e,t){var n=this.get("rowPadding"),r=this.get("itemHeight");return t!==undefined?(this.set("itemHeight",t-n*2),t):r+n*2}.property("itemHeight","rowPadding"),customRowHeightIndexes:null,contentIndexRowHeight:function(e,t,n){return this.get("rowHeight")}},SC.CollectionViewDelegate={isCollectionViewDelegate:YES,collectionViewSelectionForProposedSelection:function(e,t){return t},collectionViewShouldSelectIndexes:function(e,t,n){return t},collectionViewShouldDeselectIndexes:function(e,t){return t},collectionViewShouldDeleteIndexes:function(e,t){return t},collectionViewDeleteContent:function(e,t,n){return t?SC.typeOf(t.destroyAt)===SC.T_FUNCTION?(t.destroyAt(n),e.selectPreviousItem(NO,1),YES):SC.typeOf(t.removeAt)===SC.T_FUNCTION?(t.removeAt(n),e.selectPreviousItem(NO,1),YES):NO:NO},collectionViewShouldBeginDrag:function(e){return YES},collectionViewDragDataTypes:function(e){return[]},collectionViewDragDataForType:function(e,t,n){return null},collectionViewComputeDragOperations:function(e,t,n){return n},collectionViewValidateDragOperation:function(e,t,n,r,i){return i&SC.DROP_ON?SC.DRAG_NONE:n},collectionViewPerformDragOperation:function(e,t,n,r,i){return SC.DRAG_NONE},collectionViewDragViewFor:function(e,t){return null},ghostActsLikeCursor:NO},SC.ModalPane=SC.Pane.extend({classNames:"sc-modal",_openPaneCount:0,paneWillAppend:function(e){var t,n=SC.RootResponder.responder.panes;this._openPaneCount++,this.get("isVisibleInWindow")||this.append();for(var r=0,i=n.length;r<i;r++)t=n[r],t!==e&&t.set("ariaHidden",YES);return this},paneDidRemove
:function(e){var t,n=SC.RootResponder.responder.panes;this._openPaneCount--,this._openPaneCount<=0&&(this._openPaneCount=0,this.get("isVisibleInWindow")&&this.remove());for(var r=0,i=n.length;r<i;r++)t=n[r],t!==e&&t.set("ariaHidden",NO)},mouseDown:function(e){var t=this.get("owner");t&&t.modalPaneDidClick&&t.modalPaneDidClick(e)},touchStart:function(e){this.mouseDown(e)}}),SC.PanelPane=SC.Pane.extend({isPanelPane:YES,classNames:["sc-panel"],acceptsKeyPane:YES,ariaRole:"dialog",ariaLabel:null,ariaLabelledBy:null,ariaDescribedBy:null,isModal:YES,modalPane:SC.ModalPane.extend({classNames:"for-sc-panel"}),contentView:null,contentViewBindingDefault:SC.Binding.single(),replaceContent:function(e){this.removeAllChildren(),e&&this.appendChild(e)},createChildViews:function(){var e=this.contentView;e&&(e=this.contentView=this.createChildView(e),this.childViews=[e])},contentViewDidChange:function(){this.replaceContent(this.get("contentView"))}.observes("contentView"),renderDelegateName:"panelRenderDelegate",_modalPane:function(){var e=this.get("modalPane");return e&&e.isClass&&(e=e.create({owner:this}),this.set("modalPane",e)),e},appendTo:function(e){var t;return!this.get("isVisibleInWindow")&&this.get("isModal")&&(t=this._modalPane())&&(this._isShowingModal=YES,t.paneWillAppend(this)),arguments.callee.base.apply(this,arguments)},remove:function(){var e,t=arguments.callee.base.apply(this,arguments);return this._isShowingModal&&(this._isShowingModal=NO,(e=this._modalPane())&&e.paneDidRemove(this)),t},destroy:function(){var e=this.get("modalPane");e&&!e.isClass&&e.destroy(),arguments.callee
.base.apply(this,arguments)},_isModalDidChange:function(){var e,t=this.get("isModal");t?!this._isShowingModal&&this.get("isVisibleInWindow")&&(e=this._modalPane())&&(this._isShowingModal=YES,e.paneWillAppend(this)):this._isShowingModal&&(e=this._modalPane())&&(this._isShowingModal=NO,e.paneDidRemove(this))}.observes("isModal"),paneDidAttach:function(){var e=arguments.callee.base.apply(this,arguments);return this.becomeKeyPane(),e},displayProperties:["ariaLabel","ariaLabelledBy","ariaDescribedBy"]}),SC.TOGGLE_BEHAVIOR="toggle",SC.PUSH_BEHAVIOR="push",SC.TOGGLE_ON_BEHAVIOR="on",SC.TOGGLE_OFF_BEHAVIOR="off",SC.HOLD_BEHAVIOR="hold",SC.ButtonView=SC.View.extend(SC.Control,{acceptsFirstResponder:function(){return SC.FOCUS_ALL_CONTROLS?this.get("isEnabled"):NO}.property("isEnabled"),classNames:["sc-button-view"],themeName:"square",value:null,toggleOnValue:YES,toggleOffValue:NO,localize:NO,localizeBindingDefault:SC.Binding.bool(),title:"",tooltip:"",contentTitleKey:null,icon:null,contentIconKey:null,needsEllipsis:YES,displayTitle:function(){var e=this.get("title");return e&&this.get("localize")?SC.String.loc(e):e||""}.property("title","localize").cacheable(),keyEquivalent:null,isBorderless:NO,buttonBehavior:SC.PUSH_BEHAVIOR,holdInterval:100,isDefault:NO,isDefaultBindingDefault:SC.Binding.oneWay().bool(),isCancel:NO,isCancelBindingDefault:SC.Binding.oneWay().bool(),action:null,target:null,supportFocusRing:NO,supportsAutoResize:YES,autoResizeLayer:function(){var e=this.invokeRenderDelegateMethod("getRenderedAutoResizeLayer",this.$());return e||this.get("layer")}.property("layer").cacheable
(),autoResizeText:function(){return this.get("displayTitle")}.property("displayTitle").cacheable(),autoResizePadding:SC.propertyFromRenderDelegate("autoResizePadding",10),_labelMinWidthIE7:0,triggerActionAfterDelay:function(e){return this.get("isEnabled")?(this.set("isActive",YES),this.invokeLater("triggerAction",200,e),YES):NO},triggerAction:function(e){this._action(e,YES),this.didTriggerAction(),this.set("isActive",NO)},didTriggerAction:function(){},init:function(){arguments.callee.base.apply(this,arguments);var e=this.get("keyEquivalent");e&&(this._defaultKeyEquivalent=e),SC.none(this.get("value"))||this._button_valueDidChange()},ariaRole:"button",displayProperties:["icon","displayTitle","value","displayToolTip","isDefault","isCancel","escapeHTML","needsEllipsis","tooltip","supportFocusRing","buttonBehavior","isBorderless"],renderDelegateName:"buttonRenderDelegate",contentKeys:{contentValueKey:"value",contentTitleKey:"title",contentIconKey:"icon"},_button_displayObserver:function(){this.displayDidChange()}.observes("title","icon","value"),performKeyEquivalent:function(e,t){if(!this.get("isVisibleInWindow"))return NO;if(!this.get("isEnabled"))return NO;var n=this.get("keyEquivalent");if(n){if(n===e)return this.triggerAction(t)}else if(this.get("isDefault")&&e==="return"||this.get("isCancel")&&e==="escape")return this.triggerAction(t);return NO},computeIsSelectedForValue:function(e){var t=this.get("toggleOnValue"),n,r;return SC.typeOf(e)===SC.T_ARRAY?e.length===1?n=e[0]==t:(n=null,e.find(function(e){return r=e==t,n===null?n=r:r!==n&&(n=SC.MIXED_STATE),n===SC.MIXED_STATE})):
e===SC.MIXED_STATE?n=SC.MIXED_STATE:n=e===t,n},_button_valueDidChange:function(){var e=this.get("value"),t=this.computeIsSelectedForValue(e);this.set("isSelected",t)}.observes("value"),_button_isSelectedDidChange:function(){var e=this.get("isSelected"),t=this.computeIsSelectedForValue(this.get("value"));if(e!==SC.MIXED_STATE&&t!==e){var n=e?"toggleOnValue":"toggleOffValue";this.set("value",this.get(n))}}.observes("isSelected"),_defaultKeyEquivalent:null,_isDefaultOrCancelDidChange:function(){var e=!!this.get("isDefault"),t=!e&&this.get("isCancel");e?this.set("keyEquivalent","return"):t?this.set("keyEquivalent","escape"):this.set("keyEquivalent",this._defaultKeyEquivalent)}.observes("isDefault","isCancel"),mouseDown:function(e){var t=this.get("buttonBehavior");return this.get("isEnabled")?(this.set("isActive",YES),this._isMouseDown=YES,t===SC.HOLD_BEHAVIOR?this._action(e):!this._isFocused&&t!==SC.PUSH_BEHAVIOR&&(this._isFocused=YES,this.becomeFirstResponder()),YES):YES},mouseExited:function(e){return this._isMouseDown&&this.set("isActive",NO),YES},mouseEntered:function(e){return this._isMouseDown&&this.set("isActive",YES),YES},mouseUp:function(e){this._isMouseDown&&this.set("isActive",NO),this._isMouseDown=!1;if(this.get("buttonBehavior")!==SC.HOLD_BEHAVIOR){var t=this.$().within(e.target);t&&this.get("isEnabled")&&this._action(e)}return YES},touchStart:function(e){var t=this.get("buttonBehavior");return this.get("isEnabled")?(this.set("isActive",YES),t===SC.HOLD_BEHAVIOR?this._action(e):!this._isFocused&&t!==SC.PUSH_BEHAVIOR&&(this._isFocused=YES,this.becomeFirstResponder())
,e.preventDefault(),YES):YES},touchesDragged:function(e,t){return this.touchIsInBoundary(e)?(this._touch_exited&&this.set("isActive",YES),this._touch_exited=NO):(this._touch_exited||this.set("isActive",NO),this._touch_exited=YES),e.preventDefault(),YES},touchEnd:function(e){return this._touch_exited=NO,this.set("isActive",NO),this.get("buttonBehavior")!==SC.HOLD_BEHAVIOR&&this.touchIsInBoundary(e)&&this.get("isEnabled")&&this._action(e),e.preventDefault(),YES},keyDown:function(e){if(!this.get("isEnabled"))return YES;if(e.which===9||e.keyCode===9){var t=e.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");return t?t.becomeFirstResponder():e.allowDefault(),YES}return e.which===32?(this.triggerActionAfterDelay(e),YES):(e.allowDefault(),NO)},_action:function(e,t){switch(this.get("buttonBehavior")){case SC.TOGGLE_BEHAVIOR:var n=this.get("isSelected");n?this.set("value",this.get("toggleOffValue")):this.set("value",this.get("toggleOnValue"));break;case SC.TOGGLE_ON_BEHAVIOR:this.set("value",this.get("toggleOnValue"));break;case SC.TOGGLE_OFF_BEHAVIOR:this.set("value",this.get("toggleOffValue"));break;case SC.HOLD_BEHAVIOR:this._runHoldAction(e,t);break;default:this._runAction(e)}},_runAction:function(e){var t=this.get("action"),n=this.get("target")||null,r;if(t){if(t&&SC.typeOf(t)===SC.T_FUNCTION){this.action(e);return}r=this.getPath("pane.rootResponder"),r&&r.sendAction(t,n,this,this.get("pane"),null,this)}},_runHoldAction:function(e,t){this.get("isActive")&&(this._runAction(),t||(SC.RunLoop.begin(),this.invokeLater("_runHoldAction",this.get("holdInterval"),e),
SC.RunLoop.end()))},didBecomeKeyResponderFrom:function(e){this._isFocused||(this._isFocused=YES,this.becomeFirstResponder(),this.get("isVisibleInWindow")&&this.$().focus())},willLoseKeyResponderTo:function(e){this._isFocused&&(this._isFocused=NO)},didAppendToDocument:function(){if(parseInt(SC.browser.msie,0)===7&&this.get("useStaticLayout")){var e=this.get("layout"),t=this.$(),n=0;if(t&&t[0]&&(n=t[0].clientWidth)&&n!==0&&this._labelMinWidthIE7===0){var r=this.$(".sc-button-label"),i=parseInt(r.css("paddingRight"),0),s=parseInt(r.css("paddingLeft"),0),o=parseInt(r.css("marginRight"),0),u=parseInt(r.css("marginLeft"),0);o=="auto"&&SC.Logger.log(o+","+u+","+i+","+s),!i&&isNaN(i)&&(i=0),!s&&isNaN(s)&&(s=0),!o&&isNaN(o)&&(o=0),!u&&isNaN(u)&&(u=0),this._labelMinWidthIE7=n-(i+s)-(o+u),r.css("minWidth",this._labelMinWidthIE7+"px")}else this.invokeLater(this.didAppendToDocument,1)}}}),SC.ButtonView.CLICK_AND_HOLD_DELAY=SC.browser.msie?600:300,SC.REGULAR_BUTTON_HEIGHT=24,SC.BUTTON1_STATUS="button1",SC.BUTTON2_STATUS="button2",SC.BUTTON3_STATUS="button3",SC.AlertPane=SC.PanelPane.extend({classNames:["sc-alert"],ariaRole:"alertdialog",delegate:null,icon:"sc-icon-alert-48",message:"",ariaLabel:function(){return this.get("message")}.property("message").cacheable(),description:"",displayDescription:function(){var e=this.get("description");return!e||e.length===0?e:(e=SC.RenderContext.escapeHTML(e),'<p class="description">'+e.split("\n").join('</p><p class="description">')+"</p>")}.property("description").cacheable(),caption:"",displayCaption:function(){var e=this.get("caption");return!e||e.
length===0?e:(e=SC.RenderContext.escapeHTML(e),'<p class="caption">'+e.split("\n").join('</p><p class="caption">')+"</p>")}.property("caption").cacheable(),button1:SC.outlet("contentView.childViews.1.childViews.1"),button2:SC.outlet("contentView.childViews.1.childViews.0"),button3:SC.outlet("contentView.childViews.2.childViews.0"),buttonThreeWrapper:SC.outlet("contentView.childViews.2"),layout:{top:.3,centerX:0,width:500},contentView:SC.View.extend({useStaticLayout:YES,layout:{left:0,right:0,top:0,height:"auto"},childViews:[SC.View.extend(SC.StaticLayout,{classNames:["info"],render:function(e,t){var n=this.get("pane");n.get("icon")=="blank"&&e.addClass("plain"),e.push('<img src="'+SC.BLANK_IMAGE_URL+'" class="icon '+n.get("icon")+'" />'),e.begin("h1").attr("class","header").text(n.get("message")||"").end(),e.push(n.get("displayDescription")||""),e.push(n.get("displayCaption")||""),e.push('<div class="separator"></div>')}}),SC.View.extend({layout:{bottom:13,height:24,right:18,width:466},childViews:["cancelButton","okButton"],classNames:["text-align-right"],cancelButton:SC.ButtonView.extend({useStaticLayout:YES,actionKey:SC.BUTTON2_STATUS,localize:YES,layout:{right:5,height:"auto",width:"auto",bottom:0},isCancel:YES,action:"dismiss",isVisible:NO}),okButton:SC.ButtonView.extend({useStaticLayout:YES,actionKey:SC.BUTTON1_STATUS,localize:YES,layout:{left:0,height:"auto",width:"auto",bottom:0},isDefault:YES,action:"dismiss",isVisible:NO})}),SC.View.extend({layout:{bottom:13,height:24,left:18,width:150},childViews:[SC.ButtonView.extend({useStaticLayout:YES,actionKey:SC.BUTTON3_STATUS
,localize:YES,layout:{left:0,height:"auto",width:"auto",bottom:0},action:"dismiss",isVisible:NO})]})]}),dismiss:function(e){var t=this.delegate,n,r,i;t&&t.alertPaneDidDismiss&&t.alertPaneDidDismiss(this,e.get("actionKey"));if(r=e&&e.get("customAction"))SC.typeOf(r)===SC.T_FUNCTION?r.call(r):(n=this.getPath("pane.rootResponder"),n&&(i=e.get("target"),n.sendAction(r,i||t,this,this,null,this)));this.remove()},alertInfoDidChange:function(){var e=this.getPath("contentView.childViews.0");e&&e.displayDidChange()}.observes("icon","message","displayDescription","displayCaption")}),SC.AlertPane.mixin({show:function(e){e=SC.AlertPane._argumentsCall.apply(this,arguments);var t=this.create(e),n=0,r=e.buttons,i,s,o,u,a;r?r.forEach(function(r){n++;if(!r)return;i=t.get("button%@".fmt(n)),s=r.title,o=r.action,u=r.target,a=e.themeName||"capsule",i.set("title".fmt(n),s),o&&i.set("customAction".fmt(n),o),u&&i.set("target".fmt(n),u),i.set("isVisible",!!s),i.set("themeName",a)}):(i=t.get("button1"),i.set("title","OK"),i.set("isVisible",YES));var f=t.append();return t.adjust("height",t.childViews[0].$().height()),t.updateLayout(),f},warn:function(e){return e=SC.AlertPane._argumentsCall.apply(this,arguments),e.icon="sc-icon-alert-48",this.show(e)},info:function(e){return e=SC.AlertPane._argumentsCall.apply(this,arguments),e.icon="sc-icon-info-48",this.show(e)},error:function(e){return e=SC.AlertPane._argumentsCall.apply(this,arguments),e.icon="sc-icon-error-48",this.show(e)},plain:function(e){return e=SC.AlertPane._argumentsCall.apply(this,arguments),e.icon="blank",this.show(e)},_argumentsCall:function(
e){var t=e;if(SC.typeOf(e)!==SC.T_HASH){var n=this._normalizeArguments(arguments);t={message:n[0],description:n[1],caption:n[2],delegate:n[7],icon:n[6]||"sc-icon-alert-48",themeName:"capsule"};if(SC.typeOf(n[3])===SC.T_STRING||SC.typeOf(n[4])===SC.T_STRING||SC.typeOf(n[5])===SC.T_STRING)t.buttons=[{title:n[3]},{title:n[4]},{title:n[5]}]}return t},_normalizeArguments:function(e){e=SC.A(e);var t=e.length,n=e[t-1];return SC.typeOf(n)!==SC.T_STRING?e[t-1]=null:n=null,e[7]=n,e}}),SC.PalettePane=SC.PanelPane.extend({classNames:["sc-palette"],isModal:NO,modalPane:SC.ModalPane,isAnchored:NO,_mouseOffsetX:null,_mouseOffsetY:null,mouseDown:function(e){var t=this.get("frame");return this._mouseOffsetX=t?t.x-e.pageX:0,this._mouseOffsetY=t?t.y-e.pageY:0,YES},mouseDragged:function(e){return this.isAnchored||(this.set("layout",{width:this.layout.width,height:this.layout.height,left:this._mouseOffsetX+e.pageX,top:this._mouseOffsetY+e.pageY}),this.updateLayout()),YES},touchStart:function(e){return this.mouseDown(e)},touchesDragged:function(e){return this.mouseDragged(e)}}),SC.PICKER_MENU="menu",SC.PICKER_FIXED="fixed",SC.PICKER_POINTER="pointer",SC.PICKER_MENU_POINTER="menu-pointer",SC.POINTER_LAYOUT=["perfectRight","perfectLeft","perfectTop","perfectBottom"],SC.PickerPane=SC.PalettePane.extend({classNames:["sc-picker"],isAnchored:YES,isModal:YES,pointerPos:"perfectRight",pointerPosX:0,pointerPosY:0,anchorElement:null,anchorCached:null,preferType:null,preferMatrix:null,pointerOffset:null,extraRightOffset:0,removeTarget:null,removeAction:null,repositionOnWindowResize:YES,_anchorView:null,_anchorHTMLElement
:null,popup:function(e,t,n,r){return e&&(e.isView?(this._anchorView=e,this._anchorHTMLElement=null,this._setupScrollObservers(e)):(this._anchorHTMLElement=e,this._anchorView=null)),this.beginPropertyChanges(),t&&this.set("preferType",t),n&&this.set("preferMatrix",n),r&&this.set("pointerOffset",r),this.endPropertyChanges(),this.positionPane(),this._hideOverflow(),this.append()},positionPane:function(e){e=e&&this.get("anchorCached");var t=e?this.get("anchorCached"):this.get("anchorElement"),n=this.get("preferType"),r=this.get("preferMatrix"),i=this.get("layout"),s;if(t){e||(t=this.computeAnchorRect(t),this.set("anchorCached",t));if(t.x===0&&t.y===0)return;s=SC.cloneRect(t);if(n)switch(n){case SC.PICKER_MENU:case SC.PICKER_FIXED:(!r||r.length!==3)&&this.set("preferMatrix",[1,4,3]),s.x+=(this.preferMatrix[2]===0?s.width:0)+this.preferMatrix[0],s.y+=(this.preferMatrix[2]===3?s.height:0)+this.preferMatrix[1];break;default:s.y+=s.height}else s.y+=s.height;s=this.fitPositionToScreen(s,this.get("frame"),t),this.adjust({width:s.width,height:s.height,left:s.x,top:s.y})}else this.adjust({width:i.width,height:i.height,centerX:0,centerY:0});return this.updateLayout(),this},computeAnchorRect:function(e){var t,n,r,i=SC.RootResponder.responder.computeWindowSize();if(e.getBoundingClientRect){if(SC.browser.isIE)try{t=e.getBoundingClientRect()}catch(s){t={left:0,top:0,width:0,height:0}}else t=e.getBoundingClientRect();n={x:t.left,y:t.top,width:t.width,height:t.height};if(n.width===undefined||n.height===undefined)r=SC.$(e),n.width=r.outerWidth(),n.height=r.outerHeight()}else n=SC.offset(e),r=SC.
$(e),n.width=r.outerWidth(),n.height=r.outerHeight();return n.height=i.height-n.y<n.height?i.height-n.y:n.height,!SC.browser.msie&&window.scrollX>0||window.scrollY>0?(n.x+=window.scrollX,n.y+=window.scrollY):SC.browser.msie&&(document.documentElement.scrollTop>0||document.documentElement.scrollLeft>0)&&(n.x+=document.documentElement.scrollLeft,n.y+=document.documentElement.scrollTop),n},fitPositionToScreen:function(e,t,n){var r=SC.RootResponder.responder.computeWindowSize(),i={x:0,y:0,width:r.width,height:r.height},s=SC.RootResponder.responder.mainPane;if(s){var o=s.layout.minWidth,u=s.layout.minHeight;o&&i.width<o&&(i.width=s.layout.minWidth),u&&i.height<u&&(i.height=s.layout.minHeight)}t.x=e.x,t.y=e.y;if(this.preferType)switch(this.preferType){case SC.PICKER_MENU:t=this.fitPositionToScreenMenu(i,t,this.get("isSubMenu"));break;case SC.PICKER_MENU_POINTER:this.setupPointer(n),t=this.fitPositionToScreenMenuPointer(i,t,n);break;case SC.PICKER_POINTER:this.setupPointer(n),t=this.fitPositionToScreenPointer(i,t,n);break;case SC.PICKER_FIXED:break;default:}else t=this.fitPositionToScreenDefault(i,t,n);return this.displayDidChange(),t},fitPositionToScreenDefault:function(e,t,n){if(SC.maxX(t)>e.width){var r=Math.max(SC.maxX(n),t.width);t.x=Math.min(r,e.width)-t.width}return SC.minX(t)<0&&(t.x=SC.minX(Math.max(n,0)),SC.maxX(t)>e.width&&(t.x=Math.max(0,e.width-t.width))),SC.maxY(t)>e.height&&(r=Math.max(n.y-t.height,0),r>e.height?t.y=Math.max(0,e.height-t.height):t.y=r),SC.minY(t)<0&&(r=Math.min(SC.maxY(n),e.height-n.height),t.y=Math.max(r,0)),t},fitPositionToScreenMenu:function(e,t,n
){return n&&(t.x-=this.get("submenuOffsetX"),t.y-=Math.floor(this.get("menuHeightPadding")/2)),SC.Locale.getPath("currentLocale.isRTL")&&(t.x=t.x-t.width),t.x+t.width>e.width-20&&(n?t.x=t.x-t.width*2:t.x=e.width-t.width-20),t.x<7&&(t.x=7),t.y<7&&(t.height+=t.y,t.y=7),t.height+t.y+35>=e.height&&(t.height+50>=e.height?(t.y=SC.MenuPane.VERTICAL_OFFSET,t.height=e.height-SC.MenuPane.VERTICAL_OFFSET*2):t.y+=e.height-(t.height+t.y+35)),t},fitPositionToScreenMenuPointer:function(e,t,n){return t=this.fitPositionToScreenPointer(e,t,n),t.y>=0&&t.height+t.y+35>=e.height&&(t.height=e.height-t.y-SC.MenuPane.VERTICAL_OFFSET*2),t.y<0&&t.height>=e.height&&(t.y=SC.MenuPane.VERTICAL_OFFSET,t.height=e.height-SC.MenuPane.VERTICAL_OFFSET*2,this.set("pointerPosY",n.y-t.y-26)),t},fitPositionToScreenPointer:function(e,t,n){var r=[this.pointerOffset[0],this.pointerOffset[1],this.pointerOffset[2],this.pointerOffset[3]],i=[[n.x+n.width+r[0],n.y+parseInt(n.height/2,0)-40],[n.x-t.width+r[1],n.y+parseInt(n.height/2,0)-40],[n.x+parseInt(n.width/2-t.width/2,0),n.y-t.height+r[2]],[n.x+parseInt(n.width/2-t.width/2,0),n.y+n.height+r[3]]],s=[[n.x+n.width+t.width+r[0],n.y+parseInt(n.height/2,0)+t.height-24],[n.x+r[1],n.y+parseInt(n.height/2,0)+t.height-24],[n.x+parseInt(n.width/2-t.width/2,0)+t.width,n.y+r[2]],[n.x+parseInt(n.width/2-t.width/2,0)+t.width,n.y+n.height+t.height+r[3]]],o=[[i[0][1]>0?0:0-i[0][1],s[0][0]<e.width?0:s[0][0]-e.width,s[0][1]<e.height?0:s[0][1]-e.height,i[0][0]>0?0:0-i[0][0]],[i[1][1]>0?0:0-i[1][1],s[1][0]<e.width?0:s[1][0]-e.width,s[1][1]<e.height?0:s[1][1]-e.height,i[1][0]>0?0:0-i[1][0]
],[i[2][1]>0?0:0-i[2][1],s[2][0]<e.width?0:s[2][0]-e.width,s[2][1]<e.height?0:s[2][1]-e.height,i[2][0]>0?0:0-i[2][0]],[i[3][1]>0?0:0-i[3][1],s[3][0]<e.width?0:s[3][0]-e.width,s[3][1]<e.height?0:s[3][1]-e.height,i[3][0]>0?0:0-i[3][0]]],u=this.preferMatrix;u[4]===-1?(t.x=n.x+parseInt(n.width/2,0),t.y=n.y+parseInt(n.height/2,0)-parseInt(t.height/2,0),this.set("pointerPos",SC.POINTER_LAYOUT[0]+" fallback"),this.set("pointerPosY",parseInt(t.height/2,0)-40)):(t.x=i[u[4]][0],t.y=i[u[4]][1],this.set("pointerPos",SC.POINTER_LAYOUT[u[4]]),this.set("pointerPosY",0)),this.set("pointerPosX",0);for(var a=0,f,l=SC.POINTER_LAYOUT.length;a<l;a++)f=u[a],o[f][0]===0&&o[f][1]===0&&o[f][2]===0&&o[f][3]===0?(u[4]!==f&&(t.x=i[f][0],t.y=i[f][1],this.set("pointerPosY",0),this.set("pointerPos",SC.POINTER_LAYOUT[f])),a=SC.POINTER_LAYOUT.length):(f===0||f===1)&&o[f][0]===0&&o[f][1]===0&&o[f][2]<t.height-91&&o[f][3]===0?(u[4]!==f&&(t.x=i[f][0],this.set("pointerPos",SC.POINTER_LAYOUT[f])),t.y=i[f][1]-o[f][2],this.set("pointerPosY",o[f][2]),a=SC.POINTER_LAYOUT.length):(f===0||f===1)&&o[f][0]===0&&o[f][1]===0&&o[f][2]<=t.height-51&&o[f][3]===0?(u[4]!==f&&(t.x=i[f][0]),t.y=i[f][1]-(t.height-51),this.set("pointerPosY",t.height-53),this.set("pointerPos",SC.POINTER_LAYOUT[f]+" extra-low"),a=SC.POINTER_LAYOUT.length):(f===2||f===3)&&o[f][0]===0&&o[f][1]<=parseInt(t.width/2,0)-this.get("extraRightOffset")&&o[f][2]===0&&o[f][3]===0?(u[4]!==f&&(t.y=i[f][1]),t.x=i[f][0]-(parseInt(t.width/2,0)-this.get("extraRightOffset")),this.set("pointerPos",SC.POINTER_LAYOUT[f]+" extra-right"),a=SC.POINTER_LAYOUT.length):(f===2||
f===3)&&o[f][0]===0&&o[f][1]===0&&o[f][2]===0&&o[f][3]<=parseInt(t.width/2,0)-this.get("extraRightOffset")&&(u[4]!==f&&(t.y=i[f][1]),t.x=i[f][0]+(parseInt(t.width/2,0)-this.get("extraRightOffset")),this.set("pointerPos",SC.POINTER_LAYOUT[f]+" extra-left"),a=SC.POINTER_LAYOUT.length);return t},setupPointer:function(e){var t=this.pointerOffset,n=SC.PickerPane;if(!t||t.length!==4)if(this.get("preferType")==SC.PICKER_MENU_POINTER)switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:this.set("pointerOffset",n.TINY_PICKER_MENU_POINTER_OFFSET),this.set("extraRightOffset",n.TINY_PICKER_MENU_EXTRA_RIGHT_OFFSET);break;case SC.SMALL_CONTROL_SIZE:this.set("pointerOffset",n.SMALL_PICKER_MENU_POINTER_OFFSET),this.set("extraRightOffset",n.SMALL_PICKER_MENU_EXTRA_RIGHT_OFFSET);break;case SC.REGULAR_CONTROL_SIZE:this.set("pointerOffset",n.REGULAR_PICKER_MENU_POINTER_OFFSET),this.set("extraRightOffset",n.REGULAR_PICKER_MENU_EXTRA_RIGHT_OFFSET);break;case SC.LARGE_CONTROL_SIZE:this.set("pointerOffset",n.LARGE_PICKER_MENU_POINTER_OFFSET),this.set("extraRightOffset",n.LARGE_PICKER_MENU_EXTRA_RIGHT_OFFSET);break;case SC.HUGE_CONTROL_SIZE:this.set("pointerOffset",n.HUGE_PICKER_MENU_POINTER_OFFSET),this.set("extraRightOffset",n.HUGE_PICKER_MENU_EXTRA_RIGHT_OFFSET)}else{var r=e.width<16?e.width<4?9:6:0,i=e.height<16?e.height<4?9:6:0,s=n.PICKER_POINTER_OFFSET,o=[s[0]+r,s[1]-r,s[2]-i,s[3]+i];this.set("pointerOffset",o),this.set("extraRightOffset",n.PICKER_EXTRA_RIGHT_OFFSET)}if(!this.preferMatrix||this.preferMatrix.length!==5){var u;this.get("preferType")===SC.PICKER_MENU_POINTER?u=[3,2,1,0,3]:SC
.Locale.getPath("currentLocale.isRTL")?u=[1,0,2,3,2]:u=[0,1,2,3,2],this.set("preferMatrix",u)}},displayProperties:["preferType","pointerPos","pointerPosY"],renderDelegateName:"pickerRenderDelegate",modalPaneDidClick:function(e){var t=this.get("frame"),n=this.get("removeTarget")||null,r=this.get("removeAction"),i=this.get("rootResponder");return this.clickInside(t,e)?NO:(r?i.sendAction(r,n,this,this,null,this):this.remove(),YES)},mouseDown:function(e){return this.modalPaneDidClick(e)},clickInside:function(e,t){return SC.pointInRect({x:t.pageX,y:t.pageY},e)},windowSizeDidChange:function(e,t){this.repositionOnWindowResize&&this.positionPane()},remove:function(){return this.get("isVisibleInWindow")&&this.get("isPaneAttached")&&this._withdrawOverflowRequest(),this._removeScrollObservers(),arguments.callee.base.apply(this,arguments)},anchorElement:function(e,t){var n;if(t===undefined)return n=this._anchorView,n?n.get("layer"):this._anchorHTMLElement;if(!t)throw"You must set 'anchorElement' to either a view or a DOM element";t.isView?(this._anchorView=t,this._anchorHTMLElement=null):(this._anchorView=null,this._anchorHTMLElement=t)}.property("layer").cacheable(),_hideOverflow:function(){var e=SC.$(document.body),t=SC.$(".sc-main"),n=parseInt(t.css("minWidth"),0),r=parseInt(t.css("minHeight"),0),i=SC.RootResponder.responder.get("currentWindowSize");i.width>=n&&i.height>=r&&SC.bodyOverflowArbitrator.requestHidden(this)},_withdrawOverflowRequest:function(){SC.bodyOverflowArbitrator.withdrawRequest(this)},_getScrollViewOfView:function(e){var t=e;while(YES){if(!t)return null;if(t.isScrollable
)return t;t=t.get("parentView")}},_setupScrollObservers:function(e){var t=this._getScrollViewOfView(e);t&&(t.addObserver("horizontalScrollOffset",this,this._scrollOffsetDidChange),t.addObserver("verticalScrollOffset",this,this._scrollOffsetDidChange),this._scrollView=t)},_removeScrollObservers:function(){var e=this._scrollView;e&&(e.removeObserver("horizontalScrollOffset",this,this._scrollOffsetDidChange),e.removeObserver("verticalScrollOffset",this,this._scrollOffsetDidChange))},_scrollOffsetDidChange:function(){this.positionPane()}}),SC.PickerPane.PICKER_POINTER_OFFSET=[9,-9,-18,18],SC.PickerPane.PICKER_EXTRA_RIGHT_OFFSET=20,SC.PickerPane.TINY_PICKER_MENU_POINTER_OFFSET=[9,-9,-14,14],SC.PickerPane.TINY_PICKER_MENU_EXTRA_RIGHT_OFFSET=12,SC.PickerPane.SMALL_PICKER_MENU_POINTER_OFFSET=[9,-9,-4,4],SC.PickerPane.SMALL_PICKER_MENU_EXTRA_RIGHT_OFFSET=11,SC.PickerPane.REGULAR_PICKER_MENU_POINTER_OFFSET=[9,-9,-8,8],SC.PickerPane.REGULAR_PICKER_MENU_EXTRA_RIGHT_OFFSET=12,SC.PickerPane.LARGE_PICKER_MENU_POINTER_OFFSET=[9,-9,-12,12],SC.PickerPane.LARGE_PICKER_MENU_EXTRA_RIGHT_OFFSET=17,SC.PickerPane.HUGE_PICKER_MENU_POINTER_OFFSET=[9,-9,-14,14],SC.PickerPane.HUGE_PICKER_MENU_EXTRA_RIGHT_OFFSET=12,SC.SeparatorView=SC.View.extend({classNames:["sc-separator-view"],tagName:"span",layoutDirection:SC.LAYOUT_HORIZONTAL,render:function(e,t){t&&e.push("<span></span>"),e.addClass(this.get("layoutDirection"))}}),SC.MenuItemView=SC.View.extend(SC.ContentDisplay,{classNames:["sc-menu-item"],displayProperties:["title","isEnabled","isSeparator","isChecked"],ariaRole:"menuitem",escapeHTML:YES,acceptsFirstResponder
:YES,blocksIEDeactivate:YES,isContextMenuEnabled:NO,content:null,isSeparator:function(){return this.getContentProperty("itemSeparatorKey")===YES}.property("content").cacheable(),isEnabled:function(){return this.getContentProperty("itemIsEnabledKey")!==NO&&this.getContentProperty("itemSeparatorKey")!==YES}.property("content.isEnabled").cacheable(),isChecked:function(){return this.getContentProperty("itemCheckboxKey")}.property(),subMenu:function(){var e=this.get("content"),t,n;return e?(n=this.get("parentMenu"),t=e.get(n.itemSubMenuKey),t?SC.kindOf(t,SC.MenuPane)?(t.set("isModal",NO),t.set("isSubMenu",YES),t.set("parentMenu",n),t):SC.MenuPane.create({layout:{width:200},items:t,isModal:NO,isSubMenu:YES,parentMenu:n,controlSize:n.get("controlSize"),exampleView:n.get("exampleView")}):null):null}.property("content").cacheable(),hasSubMenu:function(){return!!this.get("subMenu")}.property("subMenu").cacheable(),init:function(){arguments.callee.base.apply(this,arguments),this.contentDidChange()},render:function(e,t){var n=this.get("content"),r,i,s=this.get("parentMenu"),o=this.get("itemWidth")||s.layout.width,u=this.get("itemHeight")||SC.DEFAULT_MENU_ITEM_HEIGHT;this.set("itemWidth",o),this.set("itemHeight",u),this.get("isSeparator")?e.attr("role","separator"):this.get("isChecked")&&(e.attr("role","menuitemcheckbox"),e.attr("aria-checked",!0)),e=e.begin("a").addClass("menu-item"),this.get("isSeparator")?(e.push('<span class="separator"></span>'),e.addClass("disabled")):(i=n.get(s.itemIconKey),i&&(this.renderImage(e,i),e.addClass("has-icon")),i=this.get("title"),SC.typeOf(i)!==SC.T_STRING&&
(i=i.toString()),this.renderLabel(e,i),this.get("isChecked")&&e.push('<div class="checkbox"></div>'),this.get("hasSubMenu")&&this.renderBranch(e),i=this.getContentProperty("itemShortCutKey"),i&&this.renderShortcut(e,i)),e=e.end()},renderImage:function(e,t){var n,r;t&&SC.ImageView.valueIsUrl(t)?(n=t,r=""):(r=t,n=SC.BLANK_IMAGE_URL),e.begin("img").addClass("image").addClass(r).attr("src",n).end()},renderLabel:function(e,t){this.get("escapeHTML")&&(t=SC.RenderContext.escapeHTML(t)),e.push("<span class='value ellipsis'>"+t+"</span>")},renderBranch:function(e){e.push('<span class="has-branch"></span>')},renderShortcut:function(e,t){e.push('<span class = "shortcut">'+t+"</span>")},showSubMenu:function(){var e=this.get("subMenu");e&&(e.set("mouseHasEntered",NO),e.popup(this,[0,0,0])),this._subMenuTimer=null},title:function(){var e=this.getContentProperty("itemTitleKey"),t=this.getPath("parentMenu.localize");return t&&e&&(e=SC.String.loc(e)),e||""}.property("content.title").cacheable(),getContentProperty:function(e){var t=this.get("content"),n=this.get("parentMenu");if(t)return t.get(n.get(e))},mouseUp:function(e){var t;return t=this.getPath("parentMenu.rootMenu.targetMenuItem"),t&&t.performAction(),YES},performAction:function(){if(!this.get("isEnabled"))return this.getPath("parentMenu.rootMenu").remove(),YES;if(this.get("hasSubMenu"))return NO;var e=this.getContentProperty("itemDisableMenuFlashKey"),t;return e?this.sendAction():(this._flashCounter=0,t=this.getPath("parentMenu.rootMenu"),t._isFlashing=YES,this.invokeLater(this.flashHighlight,25),this.invokeLater(this.sendAction,150)
),YES},sendAction:function(){var e=this.getContentProperty("itemActionKey"),t=this.getContentProperty("itemTargetKey"),n=this.getPath("parentMenu.rootMenu"),r;this.getPath("parentMenu.rootMenu").remove(),n._isFlashing=NO,e=e===undefined?n.get("action"):e,t=t===undefined?n.get("target"):t,n.set("selectedItem",this.get("content")),SC.typeOf(e)===SC.T_FUNCTION?e.apply(t,[n]):(r=this.getPath("pane.rootResponder")||SC.RootResponder.responder,r&&r.sendAction(e,t,n))},flashHighlight:function(){var e=this._flashCounter,t=this.$();e%2===0?t.addClass("focus"):t.removeClass("focus"),e<=2&&(this.invokeLater(this.flashHighlight,50),this._flashCounter++)},mouseDown:function(e){if(!this.get("mouseHasEntered")){var t=this.get("parentMenu");t.set("mouseHasEntered",YES),this.set("mouseHasEntered",YES),t.set("currentMenuItem",this),this.get("isEnabled")&&this.becomeFirstResponder(),this.get("hasSubMenu")&&(this._subMenuTimer=this.invokeLater(this.showSubMenu,100))}return YES},mouseEntered:function(e){var t=this.get("parentMenu"),n=t.get("rootMenu");if(n._isFlashing)return;return t.set("mouseHasEntered",YES),this.set("mouseHasEntered",YES),t.set("currentMenuItem",this),this.get("isEnabled")&&this.becomeFirstResponder(),this.get("hasSubMenu")&&(this._subMenuTimer=this.invokeLater(this.showSubMenu,100)),YES},mouseExited:function(e){var t,n;return this.get("hasSubMenu")?(n=this._subMenuTimer,n?n.invalidate():this.invokeLater(this.checkMouseLocation,100)):(t=this.get("parentMenu"),t.get("currentMenuItem")===this&&t.set("currentMenuItem",null)),YES},touchStart:function(e){return this.mouseEntered(e)
,YES},touchEnd:function(e){return this.mouseUp(e)},touchEntered:function(e){return this.mouseEntered(e)},touchExited:function(e){return this.mouseExited(e)},checkMouseLocation:function(){var e=this.get("subMenu"),t=this.get("parentMenu"),n,r;if(!e.get("mouseHasEntered")){n=t.get("currentMenuItem");if(n===this||n===null)r=t.get("previousMenuItem"),r&&r.resignFirstResponder(),this.resignFirstResponder(),e.remove()}},moveUp:function(e,t){var n=this.get("parentMenu");return n&&n.moveUp(this),YES},moveDown:function(e,t){var n=this.get("parentMenu");return n&&n.moveDown(this),YES},moveRight:function(e,t){return this.showSubMenu(),YES},insertText:function(e,t){var n=this.get("parentMenu");n&&n.insertText(e,t)},keyDown:function(e){return this.interpretKeyEvents(e)},keyUp:function(e){return YES},cancel:function(e){return this.getPath("parentMenu.rootMenu").remove(),YES},didBecomeFirstResponder:function(e){if(e!==this)return;var t=this.get("parentMenu");t&&t.set("currentSelectedMenuItem",this)},willLoseFirstResponder:function(e){if(e!==this)return;var t=this.get("parentMenu");t&&(t.set("currentSelectedMenuItem",null),t.set("previousSelectedMenuItem",this))},insertNewline:function(e,t){this.mouseUp(t)},closeParent:function(){this.$().removeClass("focus");var e=this.get("parentMenu");e&&e.remove()},clickInside:function(e,t){return SC.pointInRect({x:t.pageX,y:t.pageY},e)},contentDidChange:function(){var e=this.get("content"),t=this._content;if(e===t)return;var n=this.contentPropertyDidChange;t&&t.removeObserver&&t.removeObserver("*",this,n),this._content=e,e&&e.addObserver&&e.addObserver
("*",this,n),this.contentPropertyDidChange(e,"*")}.observes("content"),contentPropertyDidChange:function(e,t){var n=this.get("parentMenu");if(!n)return;var r=SC.MenuItemView._contentPropertyToMenuItemPropertyMapping,i=SC.keys(r),s,o,u,a;if(t==="*")for(s=0,o=i.length;s<o;++s)u=i[s],a=r[u],this.notifyPropertyChange(a);else for(s=0,o=i.length;s<o;++s)u=i[s],n.get(u)===t&&(a=r[u],this.notifyPropertyChange(a))}}),SC.MenuItemView._contentPropertyToMenuItemPropertyMapping={itemTitleKey:"title",itemIsEnabledKey:"isEnabled",itemSeparatorKey:"isSeparator",itemSubMenuKey:"subMenu"},SC.MenuPane=SC.PickerPane.extend({classNames:["sc-menu"],ariaRole:"menu",items:[],controlSize:SC.REGULAR_CONTROL_SIZE,itemHeight:SC.propertyFromRenderDelegate("itemHeight",20),itemSeparatorHeight:SC.propertyFromRenderDelegate("itemSeparatorHeight",9),menuHeight:0,menuHeightPadding:SC.propertyFromRenderDelegate("menuHeightPadding",6),submenuOffsetX:SC.propertyFromRenderDelegate("submenuOffsetX",2),selectedItem:null,exampleView:SC.MenuItemView,anchor:null,isSubMenu:NO,localize:YES,acceptsMenuPane:YES,isContextMenuEnabled:NO,popup:function(e,t){var n;this.beginPropertyChanges(),e&&(e.isView?(this._anchorView=e,this._setupScrollObservers(e)):this._anchorHTMLElement=e),t&&this.set("preferMatrix",t),this.adjust("height",this.get("menuHeight")),this.positionPane(),this.set("defaultResponder",this),this.endPropertyChanges(),this._hideOverflow(),this.append()},remove:function(){var e=this.get("parentMenu");return this._isRemoving=!0,this.set("currentMenuItem",null),this._isRemoving=!1,this.closeOpenMenus(),this.resignMenuPane
(),e&&e.becomeMenuPane(),arguments.callee.base.apply(this,arguments)},itemTitleKey:"title",itemIsEnabledKey:"isEnabled",itemValueKey:"value",itemIconKey:"icon",itemHeightKey:"height",itemSubMenuKey:"subMenu",itemSeparatorKey:"separator",itemTargetKey:"target",itemActionKey:"action",itemCheckboxKey:"checkbox",itemShortCutKey:"shortcut",itemKeyEquivalentKey:"keyEquivalent",itemDisableMenuFlashKey:"disableMenuFlash",itemLayerIdKey:"layerId",itemExampleViewKey:"exampleView",menuItemKeys:["itemTitleKey","itemValueKey","itemIsEnabledKey","itemIconKey","itemSeparatorKey","itemActionKey","itemCheckboxKey","itemShortCutKey","itemHeightKey","itemSubMenuKey","itemKeyEquivalentKey","itemTargetKey","itemLayerIdKey"],preferType:SC.PICKER_MENU,isModal:YES,_menuView:null,init:function(){return arguments.callee.base.apply(this,arguments)},displayProperties:["controlSize"],renderDelegateName:"menuRenderDelegate",createChildViews:function(){var e,t,n;return e=this.createChildView(SC.MenuScrollView,{borderStyle:SC.BORDER_NONE,controlSize:this.get("controlSize")}),t=this._menuView=SC.View.create({parentViewDidResize:function(){this.notifyPropertyChange("frame")},viewDidResize:function(){}}),n=this.get("menuItemViews"),t.set("layout",{top:0,left:0,height:this.get("menuHeight")}),t.replaceAllChildren(n),e.set("contentView",t),this.childViews=[e],this},paneDidAttach:function(){var e=this.rootResponder=SC.RootResponder.responder;return e.panes.add(this),this.set("currentWindowSize",e.computeWindowSize()),this.set("isPaneAttached",YES),this.parentViewDidChange(),this._notifyDidAppendToDocument(),this
.becomeMenuPane(),this},becomeMenuPane:function(){return this.rootResponder&&this.rootResponder.makeMenuPane(this),this},resignMenuPane:function(){return this.rootResponder&&this.rootResponder.makeMenuPane(null),this},menuItemViews:function(){return this.createMenuItemViews()}.property("displayItems").cacheable(),createMenuItemViews:function(){var e=[],t=this.get("displayItems"),n=this.get("exampleView"),r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b;if(!t)return e;u=this.get("itemHeightKey"),a=this.get("itemSeparatorKey"),exampleViewKey=this.get("itemExampleViewKey"),f=this.get("itemHeight"),p=this.get("itemKeyEquivalentKey"),l=this.get("itemSeparatorHeight"),g=this.get("itemLayerIdKey"),h=Math.floor(this.get("menuHeightPadding")/2),c=h,v=this.menuItemKeys.map(SC._menu_fetchKeys,this),b=t.get("length");for(m=0;m<b;m++)r=t[m],o=r.get(u),o||(o=r.get(a)?l:f),y={layout:{height:o,top:c},contentDisplayProperties:v,content:r,parentMenu:this},r.get(g)&&(y.layerId=r.get(g)),itemExampleView=r.get(exampleViewKey),itemExampleView?i=itemExampleView:i=n,s=this._menuView.createChildView(i,y),e[m]=s,c+=o,d=r.get(p),d&&(SC.typeOf(d)===SC.T_ARRAY?d.forEach(function(e){this._keyEquivalents[e]=s},this):this._keyEquivalents[d]=s);return this.set("menuHeight",c+h),e},menuItemViewForContentIndex:function(e){var t=this.get("menuItemViews");return t?t.objectAt(e):undefined},_keyEquivalents:{},_rootMenuBinding:SC.Binding.oneWay("*parentMenu.rootMenu"),rootMenu:function(){return this.get("isSubMenu")?this.get("_rootMenu"):this}.property("isSubMenu","_rootMenu").cacheable(),windowSizeDidChange:function(e,t){return this
.remove(),arguments.callee.base.apply(this,arguments)},displayItems:function(){var e=this.get("items"),t=this.get("localize"),n=this.get("itemHeight"),r,i=[],s,o,u;if(!e)return null;r=e.get("length");for(s=0;s<r;s++){o=e.objectAt(s);if(!o)continue;u=SC.typeOf(o),u===SC.T_STRING?o=SC.Object.create({title:o,value:o,isEnabled:YES}):u===SC.T_HASH?o=SC.Object.create(o):u===SC.T_ARRAY&&(o=this.convertArrayMenuItemToObject(o)),o.contentIndex=s,i.push(o)}return i}.property("items").cacheable(),_sc_menu_itemsDidChange:function(){var e=this.get("menuItemViews");this._menuView.replaceAllChildren(e),this._menuView.adjust("height",this.get("menuHeight"))}.observes("items"),convertArrayMenuItemToObject:function(e){SC.Logger.warn("Support for Array-based menu items has been deprecated.  Please update your menus to use a hash.");var t,n=SC._menu_fetchKeys,r=SC._menu_fetchItem,i,s=SC.Object.create(),o,u;return t=this.menuItemKeys.map(n,this),s[t[0]]=e[0],s[t[1]]=e[1],s[t[2]]=e[2],s[t[3]]=e[3],s[t[4]]=e[4],s[t[5]]=e[5],s[t[6]]=e[6],s[t[7]]=e[7],s[t[8]]=e[8],s[t[9]]=e[9],s[t[10]]=e[10],s[t[11]]=e[11],s[t[12]]=e[12],s},currentMenuItem:function(e,t){return t!==undefined?(this._currentMenuItem!==null&&this.set("previousMenuItem",this._currentMenuItem),this._currentMenuItem=t,(!this._isRemoving||!this.get("isSubMenu"))&&this.setPath("rootMenu.targetMenuItem",t),t):this._currentMenuItem}.property().cacheable(),_sc_menu_currentMenuItemDidChange:function(){var e=this.get("currentMenuItem"),t=this.get("previousMenuItem");t&&(!t.get("hasSubMenu")||e!==null)&&(t.resignFirstResponder(),this.closeOpenMenusFor
(t)),e&&e.get("isEnabled")&&e.scrollToVisible()}.observes("currentMenuItem"),closeOpenMenusFor:function(e){if(!e)return;var t=e.get("parentMenu");while(t&&e)t=e.get("subMenu"),t&&(t.remove(),e.resignFirstResponder(),e=t.get("previousMenuItem"))},closeOpenMenus:function(){this.closeOpenMenusFor(this.get("previousMenuItem"))},mouseDown:function(e){return this.modalPaneDidClick(e),YES},mouseEntered:function(e){this.set("mouseHasEntered",YES)},keyUp:function(e){var t=this.interpretKeyEvents(e);return t?t:NO},moveUp:function(){var e=this.get("currentMenuItem"),t=this.get("menuItemViews"),n,r,i;if(!e)i=t.get("length")-1;else{n=e.getPath("content.contentIndex");if(n===0)return YES;i=n-1}while(i>=0){if(t[i].get("isEnabled")){this.set("currentMenuItem",t[i]),t[i].becomeFirstResponder();break}i--}return YES},moveDown:function(){var e=this.get("currentMenuItem"),t=this.get("menuItemViews"),n=t.get("length"),r,i,s;if(!e)s=0;else{r=e.getPath("content.contentIndex");if(r===n)return YES;s=r+1}while(s<n){if(t[s].get("isEnabled")){this.set("currentMenuItem",t[s]),t[s].becomeFirstResponder();break}s++}return YES},insertText:function(e,t){var n=this._timer,r=this._keyBuffer;return n&&n.invalidate(),n=this._timer=SC.Timer.schedule({target:this,action:"clearKeyBuffer",interval:500,isPooled:NO}),r=r||"",r+=e.toUpperCase(),this.selectMenuItemForString(r),this._keyBuffer=r,YES},performKeyEquivalent:function(e,t,n){if(!n&&!this.get("isVisibleInWindow"))return NO;var r=this._keyEquivalents[e];return r?(r.performAction(YES),YES):e==="escape"||e==="return"?(this.remove(),YES):NO},selectMenuItemForString
:function(e){var t=this.get("menuItemViews"),n,r,i,s,o;if(!t)return;o=e.length,s=t.get("length");for(i=0;i<s;i++){n=t.objectAt(i),r=n.get("title");if(!r)continue;r=r.replace(/ /g,"").substr(0,o).toUpperCase();if(r===e){this.set("currentMenuItem",n),n.becomeFirstResponder();break}}},clearKeyBuffer:function(){this._keyBuffer=""},modalPaneDidClick:function(e){return this.remove(),YES}}),SC._menu_fetchKeys=function(e){return this.get(e)},SC._menu_fetchItem=function(e){return e?this.get?this.get(e):this[e]:null},SC.MenuPane.VERTICAL_OFFSET=23,SC.MenuPane.TINY_MENU_ITEM_HEIGHT=10,SC.MenuPane.TINY_MENU_ITEM_SEPARATOR_HEIGHT=2,SC.MenuPane.TINY_MENU_HEIGHT_PADDING=2,SC.MenuPane.TINY_SUBMENU_OFFSET_X=0,SC.MenuPane.SMALL_MENU_ITEM_HEIGHT=16,SC.MenuPane.SMALL_MENU_ITEM_SEPARATOR_HEIGHT=7,SC.MenuPane.SMALL_MENU_HEIGHT_PADDING=4,SC.MenuPane.SMALL_SUBMENU_OFFSET_X=2,SC.MenuPane.REGULAR_MENU_ITEM_HEIGHT=22,SC.MenuPane.REGULAR_MENU_ITEM_SEPARATOR_HEIGHT=9,SC.MenuPane.REGULAR_MENU_HEIGHT_PADDING=6,SC.MenuPane.REGULAR_SUBMENU_OFFSET_X=2,SC.MenuPane.LARGE_MENU_ITEM_HEIGHT=31,SC.MenuPane.LARGE_MENU_ITEM_SEPARATOR_HEIGHT=20,SC.MenuPane.LARGE_MENU_HEIGHT_PADDING=0,SC.MenuPane.LARGE_SUBMENU_OFFSET_X=4,SC.MenuPane.HUGE_MENU_ITEM_HEIGHT=20,SC.MenuPane.HUGE_MENU_ITEM_SEPARATOR_HEIGHT=9,SC.MenuPane.HUGE_MENU_HEIGHT_PADDING=0,SC.MenuPane.HUGE_SUBMENU_OFFSET_X=0,SC.SheetPane=SC.PanelPane.extend({classNames:["sc-sheet"],modalPane:SC.ModalPane,transitionDuration:200,_state:"NO_VIEW",init:function(){arguments.callee.base.apply(this,arguments),SC.Animatable&&(SC.SheetPane.ANIMATABLE_AVAILABLE=YES,this.mixin(
SC.Animatable),this.transitions||(this.transitions={}),this.transitions.top||(this.transitions.top={duration:this.transitionDuration===200?.3:this.transitionDuration/1e3,action:"_complete",target:this}))},append:function(){var e=this.get("layout");if(!e.height||!e.top)e=SC.View.convertLayoutToAnchoredLayout(e,this.computeParentDimensions());return e.top=-1*e.height,this.disableAnimation&&this.disableAnimation(),this.adjust(e),this.updateLayout(),this.enableAnimation&&this.enableAnimation(),arguments.callee.base.apply(this,arguments)},remove:function(){var e=this,t=arguments;return this.invokeLater(function(){t.callee.base.apply(e,t)},this.transitionDuration),this.slideUp(),this},paneDidAttach:function(){var e=arguments.callee.base.apply(this,arguments);return this.slideDown(),e},slideDown:function(){this._state=SC.SheetPane.ANIMATING,this._direction=SC.SheetPane.SLIDE_DOWN,SC.SheetPane.ANIMATABLE_AVAILABLE?(this.transitions.top.timing=SC.Animatable.TRANSITION_EASE_OUT,this.adjust("top",0)):(this._start=SC.getCurrentTimeForPerformance(),this._end=this._start+this.get("transitionDuration"),this.tick())},slideUp:function(){this._state=SC.SheetPane.ANIMATING,this._direction=SC.SheetPane.SLIDE_UP;if(SC.SheetPane.ANIMATABLE_AVAILABLE){var e=this.get("layout");this.transitions.top.timing=SC.Animatable.TRANSITION_EASE_IN,this.adjust("top",-1*e.height)}else this._start=SC.getCurrentTimeForPerformance(),this._end=this._start+this.get("transitionDuration"),this.tick()},_complete:function(){var e=this._direction;if(e===SC.SheetPane.SLIDE_DOWN)SC.SheetPane.ANIMATABLE_AVAILABLE||this.adjust
("top",0),this.adjust({centerX:0,left:null}),SC.browser.mozilla&&this.parentViewDidChange();else{var t=this.get("layout");SC.SheetPane.ANIMATABLE_AVAILABLE||this.adjust("top",-1*t.height)}this._state=SC.SheetPane.READY,this.updateLayout()},blurTo:function(e){this.setFirstResponder("")},tick:function(){this._timer=null;var e=SC.getCurrentTimeForPerformance(),t=(e-this._start)/(this._end-this._start),n=this,r=this._direction,i=this.get("layout"),s,o;return t<0&&(t=0),t>=1?(this._complete(),this):(o=Math.floor(i.height*t),r==SC.SheetPane.SLIDE_DOWN?n.adjust("top",0-(i.height-o)):r==SC.SheetPane.SLIDE_UP&&n.adjust("top",0-o),this._timer=this.invokeLater(this.tick,20),n.updateLayout(),this)}}),SC.SheetPane.mixin({ANIMATABLE_AVAILABLE:NO,NO_VIEW:"NO_VIEW",ANIMATING:"ANIMATING",READY:"READY",SLIDE_DOWN:"SLIDEDOWN",SLIDE_UP:"SLIDEUP"}),SC.BaseTheme.buttonRenderDelegate=SC.RenderDelegate.create({className:"button","sc-small-size":{height:18,autoResizePadding:{width:15,height:0}},"sc-regular-size":{height:24,autoResizePadding:{width:20,height:0}},"sc-huge-size":{height:30,autoResizePadding:{width:30,height:0}},"sc-jumbo-size":{height:44,autoResizePadding:{width:50,height:0}},render:function(e,t){this.addSizeClassName(e,t);var n,r=e.get("toolTip"),i=e.get("value"),s=e.get("isSelected")||NO,o=e.get("isActive")||NO,u=e.get("isDefault")||NO,a=e.get("isCancel")||NO,f=e.get("isToggle")||NO,l=SC.guidFor(e)+"-label",c=e.get("isBorderless")||NO;t.setClass({icon:!!e.get("icon"),def:u,cancel:a&&!u,active:o,sel:s}),r&&(t.attr("title",r),t.attr("alt",r)),c||this.includeSlices(e,t,SC.THREE_SLICE),e
.get("isSegment")?t.attr("aria-selected",s.toString()):f&&t.attr("aria-pressed",o.toString()),i?t.attr("aria-labelledby",l):r?t.attr("aria-label",r):t.attr("aria-label",e.get("displayTitle")),t=t.begin("label").addClass("sc-button-label").id(l),e.get("theme").labelRenderDelegate.render(e,t),t=t.end(),e.get("supportFocusRing")&&(t=t.begin("div").addClass("focus-ring"),this.includeSlices(e,t,SC.THREE_SLICE),t=t.end())},update:function(e,t){var n=e.get("buttonBehavior")===SC.TOGGLE_BEHAVIOR;this.updateSizeClassName(e,t),e.get("isActive")&&t.addClass("active");var r=e.get("isDefault"),i=e.get("isCancel");e.get("isSegment")?t.attr("aria-selected",e.get("isSelected").toString()):n&&t.attr("aria-pressed",e.get("isActive").toString());var s=e.get("toolTip");t.attr("title",s),t.attr("aria-label",s),t.setClass("icon",!!e.get("icon")),t.setClass("def",!!r),t.setClass("cancel",!!i&&!r),e.get("theme").labelRenderDelegate.update(e,t.find("label"))},getRenderedAutoResizeLayer:function(e,t){return t.find(".sc-button-label")[0]}}),SC.BaseTheme.checkboxRenderDelegate=SC.RenderDelegate.create({className:"checkbox",render:function(e,t){this.addSizeClassName(e,t);var n=e.get("theme"),r,i;i=SC.guidFor(e)+"-label";var s=e.get("isSelected")||NO,o=e.get("isActive"),u=!e.get("isEnabled"),a;s===SC.MIXED_STATE?a="mixed":s?a="true":a="false",t.attr("role","checkbox"),t.attr("aria-checked",a),t.attr("aria-labelledby",i),t.setClass({sel:s,active:o,disabled:u}),t.push('<span class = "button"></span>'),t=t.begin("span").addClass("label").id(i),n.labelRenderDelegate.render(e,t),t=t.end()},update:function(e,t
){this.updateSizeClassName(e,t);var n=e.get("theme"),r=e.get("isSelected"),i=e.get("isActive"),s=!e.get("isEnabled"),o;r===SC.MIXED_STATE?o="mixed":r?o="true":o="false",t.attr("aria-checked",o),n.labelRenderDelegate.update(e,t.find("span.label")),t.setClass({sel:r,active:i,disabled:s})},isEventWithinActiveArea:function(e,t){var n=t.target||t.srcElement,r=n===e.$(".button")[0]||n===e.$(".label")[0];return!r&&document.activeElement===e.$()[0]&&t.pageX===0&&t.pageY===0&&(r=!0),n&&r}}),SC.BaseTheme.collectionRenderDelegate=SC.RenderDelegate.create({className:"collection",render:function(e,t){t.setClass("focus",e.get("hasFirstResponder")),t.setClass("disabled",!e.get("isEnabled")),t.setClass("active",e.get("isActive"))},update:function(e,t){t.setClass("focus",e.get("hasFirstResponder")),t.setClass("disabled",!e.get("isEnabled")),t.setClass("active",e.get("isActive"))}}),SC.BaseTheme.disclosureRenderDelegate=SC.RenderDelegate.create({className:"disclosure",render:function(e,t){this.addSizeClassName(e,t);var n=e.get("theme"),r=e.get("value"),i=e.get("title"),s=SC.guidFor(e)+"-label",o=r?"true":"false";t.attr("role","disclosure checkbox"),t.attr("aria-labelledby",s),t.attr("aria-checked",o),e.get("isSelected")&&t.addClass("sel");var u="";u+=e.get("isSelected")?"open":"closed",e.get("isActive")&&(u+=" active"),t.push('<img src = "'+SC.BLANK_IMAGE_URL+'" class = "disclosure button '+u+'" />'),t=t.begin("span").addClass("sc-button-label").id(s),n.labelRenderDelegate.render(e,t),t=t.end()},update:function(e,t){this.updateSizeClassName(e,t);var n=e.get("theme"),r=e.get("value"),i=e.get("title"
),s=r?"true":"false";t.attr("role","disclosure checkbox"),t.attr("aria-checked",s),e.get("isSelected")&&t.addClass("sel"),t.find("img").setClass({open:e.get("isSelected"),closed:!e.get("isSelected"),active:e.get("isActive")}),n.labelRenderDelegate.update(e,t.find("span.sc-button-label"))}}),SC.THREE_SLICE=["left","middle","right"],SC.NINE_SLICE=["top-left","top","top-right","left","middle","right","bottom-left","bottom","bottom-right"],SC.RenderDelegate.reopen({includeSlices:function(e,t,n){for(var r=0,i=n.length;r<i;r++)t.push('<div class="'+n[r]+'"></div>')}}),SC.BaseTheme.imageButtonRenderDelegate=SC.RenderDelegate.create({className:"image-button",render:function(e,t){var n=e.get("image"),r=e.get("toolTip");this.addSizeClassName(e,t),t.addClass("no-min-width"),r&&(t.attr("title",r),t.attr("alt",r)),n?t.push("<div class='img "+n+"'></div>"):t.push("<div class='img'></div>")},update:function(e,t){var n,r;this.updateSizeClassName(e,t),e.didChangeFor("imageButtonRenderDelegate","toolTip")&&(r=e.get("toolTip"),t.attr("title",r),t.attr("aria-label",r)),n=e.get("image"),n&&e.didChangeFor("imageButtonRenderDelegate","image")&&(t.children()[0].className="img "+n)}}),SC.BaseTheme.panelRenderDelegate=SC.RenderDelegate.create({className:"panel",render:function(e,t){t=t.begin("div").addClass("panel-background"),this.includeSlices(e,t,SC.NINE_SLICE),t=t.end();var n=e.get("ariaLabel"),r=e.get("ariaLabelledBy"),i=e.get("ariaDescribedBy");n&&t.attr("aria-label",n),r&&t.attr("aria-labelledby",r),i&&t.attr("aria-describedby",i)},update:function(e,t){var n=e.get("ariaLabel"),r=e.get("ariaLabelledBy"
),i=e.get("ariaDescribedBy");n&&t.attr("aria-label",n),r&&t.attr("aria-labelledby",r),i&&t.attr("aria-describedby",i)}}),SC.BaseTheme.pickerRenderDelegate=SC.RenderDelegate.create({className:"picker",render:function(e,t){var n=e.get("theme").panelRenderDelegate;n.render(e,t);var r=e.get("preferType"),i=e.get("pointerPos"),s=e.get("pointerPosY");if(r==SC.PICKER_POINTER||r==SC.PICKER_MENU_POINTER)t.push('<div class="sc-pointer '+i+'" style="margin-top: '+s+'px"></div>'),t.addClass(i)},update:function(e,t){var n=e.get("theme").panelRenderDelegate;n.update(e,t);var r=e.get("preferType"),i=e.get("pointerPos"),s=e.get("pointerPosY");if(r==SC.PICKER_POINTER||r==SC.PICKER_MENU_POINTER){var o=t.find(".sc-pointer");o.attr("class","sc-pointer "+i),o.attr("style","margin-top: "+s+"px"),t.addClass(i)}}}),SC.BaseTheme.menuRenderDelegate=SC.BaseTheme.pickerRenderDelegate.create({className:"menu",render:function(e,t,n){this.addSizeClassName(t,n),e(t,n)}.enhance(),update:function(e,t,n){this.updateSizeClassName(t,n),e(t,n)}.enhance(),itemHeight:26,itemSeparatorHeight:9,menuHeightPadding:6,menuWidthPadding:50,minimumMenuWidth:50,submenuOffsetX:2,verticalOffset:23,"sc-tiny-size":{itemHeight:22,itemSeparatorHeight:2,menuHeightPadding:4,submenuOffsetX:0},"sc-small-size":{itemHeight:26,itemSeparatorHeight:7,menuHeightPadding:0,submenuOffsetX:4},"sc-large-size":{itemHeight:30,itemSeparatorHeight:20,menuHeightPadding:0,submenuOffsetX:4},"sc-huge-size":{itemHeight:30,itemSeparatorHeight:9,menuHeightPadding:0,submenuOffsetX:0}}),SC.BaseTheme.popupButtonRenderDelegate=SC.BaseTheme.buttonRenderDelegate
.create({render:function(e,t){t.attr("aria-haspopup","true"),arguments.callee.base.apply(this,arguments)},update:function(e,t){arguments.callee.base.apply(this,arguments)}}),SC.BaseTheme.segmentRenderDelegate=SC.RenderDelegate.create({className:"segment",render:function(e,t){var n=e.get("theme"),r,i;i={"sc-first-segment":e.get("isFirstSegment"),"sc-middle-segment":e.get("isMiddleSegment"),"sc-last-segment":e.get("isLastSegment"),"sc-overflow-segment":e.get("isOverflowSegment")},SC.none(e.get("index"))||(i["sc-segment-"+e.get("index")]=YES),t.setClass(i),t.attr("tabindex",e.get("isSelected")?0:-1),r=n.buttonRenderDelegate,r.render(e,t)},update:function(e,t){var n=e.get("theme"),r,i={};i={"sc-first-segment":e.get("isFirstSegment"),"sc-middle-segment":e.get("isMiddleSegment"),"sc-last-segment":e.get("isLastSegment"),"sc-overflow-segment":e.get("isOverflowSegment")||NO},SC.none(e.get("index"))||(i["sc-segment-"+e.get("index")]=YES),t.setClass(i),t.attr("tabindex",e.get("isSelected")?0:-1),r=n.buttonRenderDelegate,r.update(e,t)}}),SC.BaseTheme.segmentedRenderDelegate=SC.RenderDelegate.create({className:"segmented",render:function(e,t){this.addSizeClassName(e,t),t.addStyle("text-align",e.get("align"))},update:function(e,t){this.updateSizeClassName(e,t),t.css("text-align",e.get("align"))},segmentWidths:function(e){var t=e.$(".sc-segment-view"),n,r=[];for(var i=0,s=t.length;i<s-1;i++)n=t[i],r[i]=n.getBoundingClientRect().width;return r},overflowSegmentWidth:function(e){var t=e.$(".sc-segment-view"),n;return n=t[t.length-1],n.getBoundingClientRect().width},indexForClientPosition:function(
e,t,n){var r=e.$(".sc-segment-view"),i,s,o,u,a;a={x:t,y:n};for(s=0,i=r.length;s<i;s++){o=r[s],u=o.getBoundingClientRect(),u={x:u.left,y:u.top,width:u.right-u.left,height:u.bottom-u.top};if(SC.pointInRect(a,u))return s}return-1}}),SC.BaseTheme.SourceList=SC.BaseTheme.subtheme("source-list"),SC.BaseTheme.toolbarRenderDelegate=SC.RenderDelegate.create({className:"toolbar",render:function(e,t){},update:function(){}}),SC.BaseTheme.wellRenderDelegate=SC.RenderDelegate.create({className:"well",render:function(e,t){},update:function(){}}),SC.DRAG_LINK=4,SC.DRAG_COPY=1,SC.DRAG_MOVE=2,SC.DRAG_NONE=0,SC.DRAG_ANY=15,SC.DRAG_DATA=8,SC.DRAG_AUTOSCROLL_ZONE_THICKNESS=20,SC.View.reopen({init:function(e){e(),this.get("isDropTarget")&&SC.Drag.addDropTarget(this),this.get("isScrollable")&&SC.Drag.addScrollableView(this)}.enhance(),destroy:function(e){return this.get("isDropTarget")&&SC.Drag.removeDropTarget(this),this.get("isScrollable")&&SC.Drag.removeScrollableView(this),e()}.enhance()}),SC.Drag=SC.Object.extend({source:null,ghostView:null,ghostActsLikeCursor:NO,dragView:null,ghost:YES,sourceIsDraggable:YES,slideBack:YES,ghostOffset:{x:0,y:0},location:{},dataTypes:function(){if(this.dataSource)return this.dataSource.get("dragDataTypes")||[];var e=this.data;if(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}var r=this.get("source");return r&&r.dragDataTypes?r.get("dragDataTypes")||[]:[]}.property().cacheable(),hasDataType:function(e){return this.get("dataTypes").indexOf(e)>=0},dataForType:function(e){if(this.dataSource)return this.dataSource.dragDataForType(this,e);if(this.
data)return this.data[e];var t=this.get("source");return t&&SC.typeOf(t.dragDataForType)==SC.T_FUNCTION?t.dragDataForType(this,e):null},dataSource:null,data:null,allowedDragOperations:SC.DRAG_ANY,_dragInProgress:YES,_dragViewWasVisible:null,startDrag:function(){this.get("sourceIsDraggable")&&this._createGhostView();var e=this.event,t={x:e.pageX,y:e.pageY};this.set("location",t);if(this.get("sourceIsDraggable")){var n=this._getDragView(),r=n.get("parentView"),i=r?r.convertFrameToView(n.get("frame"),null):n.get("frame");this.get("ghost")&&(this._dragViewWasVisible=n.get("isVisible"),n.set("isVisible",NO)),this.ghostActsLikeCursor?this.ghostOffset={x:14,y:14}:this.ghostOffset={x:t.x-i.x,y:t.y-i.y},this._ghostViewHidden||this._positionGhostView(e);if(e.makeTouchResponder){var s=this;SC.Timer.schedule({target:e,action:function(){e.hasEnded||e.makeTouchResponder(s,YES)},interval:1})}else this.ghostView.rootResponder.dragDidStart(this,e)}var o=this.source;o&&o.dragDidBegin&&o.dragDidBegin(this,t);var u=this._dropTargets();for(var a=0,f=u.length;a<f;a++)u[a].tryToPerform("dragStarted",this,e)},cancelDrag:function(){var e=this._lastTarget,t=this.get("location");e&&e.dragExited&&e.dragExited(this,this._lastMouseDraggedEvent),this.get("sourceIsDraggable")&&(this._destroyGhostView(),this.get("ghost")&&(this._dragViewWasVisible&&this._getDragView().set("isVisible",YES),this._dragViewWasVisible=null));var n=this.source;n&&n.dragDidEnd&&n.dragDidEnd(this,t,SC.DRAG_NONE),this._lastTarget=null,this._dragInProgress=NO},touchStart:function(e){return YES},mouseDragged:function(e){var t=this._autoscroll
(e),n=this.get("location");if(!t&&e.pageX===n.x&&e.pageY===n.y)return;n={x:e.pageX,y:e.pageY},this.set("location",n),this._lastMouseDraggedEvent=e;var r=this.source,i=this._lastTarget,s=this._findDropTarget(e),o=SC.DRAG_NONE;while(s&&s!==i&&o===SC.DRAG_NONE)s&&r&&r.dragSourceOperationMaskFor?o=r.dragSourceOperationMaskFor(this,s):o=SC.DRAG_ANY,o!==SC.DRAG_NONE&&s&&s.computeDragOperations?o&=s.computeDragOperations(this,e,o):o=SC.DRAG_NONE,this.allowedDragOperations=o,o===SC.DRAG_NONE&&(s=this._findNextDropTarget(s));s!==i?(i&&i.dragExited&&i.dragExited(this,e),s&&(s.dragEntered&&s.dragEntered(this,e),s.dragUpdated&&s.dragUpdated(this,e)),this._lastTarget=s):s&&s.dragUpdated&&s.dragUpdated(this,e),r&&r.dragDidMove&&r.dragDidMove(this,n),this.get("sourceIsDraggable")&&!this._ghostViewHidden&&this._positionGhostView(e)},touchesDragged:function(e){this.mouseDragged(e)},mouseUp:function(e){var t={x:e.pageX,y:e.pageY},n=this._lastTarget,r=this.allowedDragOperations;this.set("location",t);try{n&&n.acceptDragOperation&&n.acceptDragOperation(this,r)?r=n.performDragOperation?n.performDragOperation(this,r):SC.DRAG_NONE:r=SC.DRAG_NONE}catch(i){SC.Logger.error("Exception in SC.Drag.mouseUp(acceptDragOperation|performDragOperation): %@".fmt(i))}try{n&&n.dragExited&&n.dragExited(this,e)}catch(s){SC.Logger.error("Exception in SC.Drag.mouseUp(target.dragExited): %@".fmt(s))}var o=this._dropTargets();for(var u=0,a=o.length;u<a;u++)try{o[u].tryToPerform("dragEnded",this,e)}catch(f){SC.Logger.error("Exception in SC.Drag.mouseUp(dragEnded on %@): %@".fmt(o[u],f))}this.get("sourceIsDraggable")&&(
this._destroyGhostView(),this.get("ghost")&&(this._dragViewWasVisible&&this._getDragView().set("isVisible",YES),this._dragViewWasVisible=null));var l=this.source;l&&l.dragDidEnd&&l.dragDidEnd(this,t,r),this._lastTarget=null,this._dragInProgress=NO},touchEnd:function(e){this.mouseUp(e)},_getDragView:function(){if(!this.dragView){if(!this.source||!this.source.isView)throw"Source can't be used as dragView, because it's not a view.";this.dragView=this.source}return this.dragView},_createGhostView:function(){var e=this,t=this._getDragView(),n=t.get("frame"),r;r=this.ghostView=SC.Pane.create({classNames:["sc-ghost-view"],layout:{top:n.y,left:n.x,width:n.width,height:n.height},owner:this,didCreateLayer:function(){if(t){var e=t.get("layer");e&&(e=e.cloneNode(!0),e.style.top="0px",e.style.left="0px",this.get("layer").appendChild(e))}}}),r.append()},_positionGhostView:function(e){var t=this.get("location");t.x-=this.ghostOffset.x,t.y-=this.ghostOffset.y;var n=this.ghostView;n&&(n.adjust({top:t.y,left:t.x}),n.invokeOnce("updateLayout"))},_ghostViewHidden:NO,hideGhostView:function(){this.ghostView&&!this._ghostViewHidden&&(this.ghostView.remove(),this._ghostViewHidden=YES)},unhideGhostView:function(){this._ghostViewHidden&&(this._ghostViewHidden=NO,this._createGhostView())},_destroyGhostView:function(){this.ghostView&&(this.ghostView.remove(),this.ghostView=null,this._ghostViewHidden=NO)},_dropTargets:function(){if(this._cachedDropTargets)return this._cachedDropTargets;var e=[],t=SC.Drag._dropTargets;for(var n in t)t.hasOwnProperty(n)&&e.push(t[n]);var r={},i=SC.Drag._dropTargets,s=function(
e){if(!e)return 0;var t=SC.guidFor(e),n=r[t];if(!n){n=1;while(e=e.get("parentView"))i[SC.guidFor(e)]!==undefined&&n++;r[t]=n}return n};return e.sort(function(e,t){return e===t?0:(e=s(e),t=s(t),e>t?-1:1)}),this._cachedDropTargets=e,e},_findDropTarget:function(e){var t={x:e.pageX,y:e.pageY},n,r,i=this._dropTargets();for(var s=0,o=i.length;s<o;s++){n=i[s];if(!n.get("isVisibleInWindow"))continue;r=n.convertFrameToView(n.get("clippingFrame"),null);if(SC.pointInRect(t,r))return n}return null},_findNextDropTarget:function(e){var t=SC.Drag._dropTargets;while(e=e.get("parentView"))if(t[SC.guidFor(e)])return e;return null},_autoscroll:function(e){e||(e=this._lastAutoscrollEvent);if(!this._dragInProgress)return NO;var t=e?{x:e.pageX,y:e.pageY}:this.get("location"),n=this._findScrollableView(t),r=null,i,s,o,u,a,f,l;while(n&&!r){i=n.get("canScrollVertical")?1:0,s=n.get("canScrollHorizontal")?1:0;if(i||s)f=n.get("containerView"),f?l=n.convertFrameToView(f.get("frame"),null):i=s=0;i&&(u=SC.maxY(l),o=u-SC.DRAG_AUTOSCROLL_ZONE_THICKNESS,t.y>=o&&t.y<=u?i=1:(o=SC.minY(l),u=o+SC.DRAG_AUTOSCROLL_ZONE_THICKNESS,t.y>=o&&t.y<=u?i=-1:i=0)),s&&(u=SC.maxX(l),o=u-SC.DRAG_AUTOSCROLL_ZONE_THICKNESS,t.x>=o&&t.x<=u?s=1:(o=SC.minX(l),u=o+SC.DRAG_AUTOSCROLL_ZONE_THICKNESS,t.x>=o&&t.x<=u?s=-1:s=0)),i||s?r=n:n=this._findNextScrollableView(n)}r&&this._lastScrollableView===r?SC.getCurrentTimeForPerformance()-this._hotzoneStartTime>100&&(this._horizontalScrollAmount*=1.05,this._verticalScrollAmount*=1.05):(this._lastScrollableView=r,this._horizontalScrollAmount=15,this._verticalScrollAmount=15,this._hotzoneStartTime=
r?SC.getCurrentTimeForPerformance():null,s=i=0);if(r&&(s||i)){var c={x:s*this._horizontalScrollAmount,y:i*this._verticalScrollAmount};r.scrollBy(c)}return r?(e&&(this._lastAutoscrollEvent={pageX:e.pageX,pageY:e.pageY}),this.invokeLater(this._autoscroll,100,null),YES):(this._lastAutoscrollEvent=null,NO)},_scrollableViews:function(){if(this._cachedScrollableView)return this._cachedScrollableView;var e=[],t=SC.Drag._scrollableViews;for(var n in t)t.hasOwnProperty(n)&&e.push(t[n]);return e=e.sort(function(e,t){var n=e;while(n=n.get("parentView"))if(t==n)return-1;return 1}),this._cachedScrollableView=e,e},_findScrollableView:function(e){var t=this._scrollableViews(),n=t?t.length:0,r,i,s;for(s=0;s<n;s++){r=t[s];if(!r.get("isVisibleInWindow"))continue;i=r.convertFrameToView(r.get("clippingFrame"),null);if(SC.pointInRect(e,i))return r}return null},_findNextScrollableView:function(e){var t=SC.Drag._scrollableViews;while(e=e.get("parentView"))if(t[SC.guidFor(e)])return e;return null}}),SC.Drag.mixin({start:function(e){var t=this.create(e);return t.startDrag(),t},_dropTargets:{},_scrollableViews:{},addDropTarget:function(e){this._dropTargets[SC.guidFor(e)]=e},removeDropTarget:function(e){delete this._dropTargets[SC.guidFor(e)]},addScrollableView:function(e){this._scrollableViews[SC.guidFor(e)]=e},removeScrollableView:function(e){delete this._scrollableViews[SC.guidFor(e)]}}),SC.MODIFIED_KEY_BINDINGS={"ctrl_.":"cancel",shift_tab:"insertBacktab",shift_left:"moveLeftAndModifySelection",shift_right:"moveRightAndModifySelection",shift_up:"moveUpAndModifySelection",shift_down:"moveDownAndModifySelection"
,alt_left:"moveLeftAndModifySelection",alt_right:"moveRightAndModifySelection",alt_up:"moveUpAndModifySelection",alt_down:"moveDownAndModifySelection",ctrl_a:"selectAll"},SC.BASE_KEY_BINDINGS={escape:"cancel",backspace:"deleteBackward","delete":"deleteForward","return":"insertNewline",tab:"insertTab",left:"moveLeft",right:"moveRight",up:"moveUp",down:"moveDown",home:"moveToBeginningOfDocument",end:"moveToEndOfDocument",pagedown:"pageDown",pageup:"pageUp"},SC.CheckboxView=SC.ButtonView.extend(SC.StaticLayout,{classNames:["sc-checkbox-view","sc-checkbox-control"],ariaRole:"checkbox",themeName:null,renderDelegateName:"checkboxRenderDelegate",needsEllipsis:NO,acceptsFirstResponder:function(){return SC.FOCUS_ALL_CONTROLS?this.get("isEnabled"):NO}.property("isEnabled"),_toggleValue:function(){var e=this.get("value")===this.get("toggleOnValue");this.set("value",e?this.get("toggleOffValue"):this.get("toggleOnValue"))},mouseDown:function(e){if(!this.get("isEnabled"))return YES;var t=NO,n=this.get("renderDelegate"),r;return n?t=n.isEventWithinActiveArea(this,e):t=YES,t?(this.set("isActive",YES),this._isMouseDown=YES,e&&this.get("acceptsFirstResponder")&&e.allowDefault(),r=YES):r=NO,r},mouseUp:function(e){return this.get("isEnabled")?(this.set("isActive",NO),this._isMouseDown=NO,this.get("buttonBehavior")!==SC.HOLD_BEHAVIOR&&this.$().within(e.target)&&(this._toggleValue(),this._action(e)),YES):YES},keyDown:function(e){if(!this.get("isEnabled"))return YES;if(e.which===9||e.keyCode===9){var t=e.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");return t?t.becomeFirstResponder
():e.allowDefault(),YES}return e.which===13||e.which===32?(this._toggleValue(),this.get("buttonBehavior")!==SC.HOLD_BEHAVIOR&&this.$().within(e.target)&&this._action(e),YES):(e.allowDefault(),NO)},touchStart:function(e){return this.mouseDown(e)},touchEnd:function(e){return this.mouseUp(e)}}),SC.LIST_ITEM_ACTION_CANCEL="sc-list-item-cancel-action",SC.LIST_ITEM_ACTION_REFRESH="sc-list-item-cancel-refresh",SC.LIST_ITEM_ACTION_EJECT="sc-list-item-cancel-eject",SC.ListItemView=SC.View.extend(SC.InlineEditable,SC.Control,{classNames:["sc-list-item-view"],displayProperties:["disclosureState","escapeHTML"],content:null,contentIndex:null,hasContentIcon:NO,hasContentRightIcon:NO,hasContentBranch:NO,contentCheckboxKey:null,icon:null,contentIconKey:null,rightIcon:null,contentRightIconKey:null,contentValueKey:null,escapeHTML:YES,contentUnreadCountKey:null,contentIsBranchKey:null,outlineIndent:16,outlineLevel:0,disclosureState:SC.LEAF_NODE,validator:null,contentKeys:{contentValueKey:"title",contentCheckboxKey:"checkbox",contentIconKey:"icon",contentRightIconKey:"rightIcon",contentUnreadCountKey:"count",contentIsBranchKey:"branch"},contentPropertyDidChange:function(){this.get("contentIsEditable")!==this.contentIsEditable()&&this.notifyPropertyChange("contentIsEditable"),this.displayDidChange()},contentIsEditable:function(){var e=this.get("content");return e&&(e.get?e.get("isEditable")!==NO:NO)}.property("content").cacheable(),inlineEditorDelegate:SC.InlineTextFieldDelegate,$label:function(){return this.$("label")},_isInsideElementWithClassName:function(e,t){var n=this.get("layer");if(!n)return NO
;var r=SC.$(t.target),i=NO,s;while(!i&&r.length>0&&r[0]!==n)r.hasClass(e)&&(i=YES),r=r.parent();return r=n=null,i},_isInsideCheckbox:function(e){var t=this.displayDelegate,n=this.getDelegateProperty("contentCheckboxKey",t);return n&&this._isInsideElementWithClassName("sc-checkbox-view",e)},_isInsideDisclosure:function(e){return this.get("disclosureState")===SC.LEAF_NODE?NO:this._isInsideElementWithClassName("sc-disclosure-view",e)},_isInsideRightIcon:function(e){var t=this.displayDelegate,n=this.getDelegateProperty("hasContentRightIcon",t)||!SC.none(this.rightIcon);return n&&this._isInsideElementWithClassName("right-icon",e)},mouseDown:function(e){return this.get("contentIsEditable")?this._isInsideCheckbox(e)?(this._addCheckboxActiveState(),this._isMouseDownOnCheckbox=YES,this._isMouseInsideCheckbox=YES,YES):this._isInsideDisclosure(e)?(this._addDisclosureActiveState(),this._isMouseDownOnDisclosure=YES,this._isMouseInsideDisclosure=YES,YES):this._isInsideRightIcon(e)?(this._addRightIconActiveState(),this._isMouseDownOnRightIcon=YES,this._isMouseInsideRightIcon=YES,YES):NO:NO},mouseUp:function(e){var t=NO,n,r,i,s,o,u;if(this._isMouseDownOnCheckbox){if(this._isInsideCheckbox(e)){n=this.displayDelegate,r=this.getDelegateProperty("contentCheckboxKey",n),i=this.get("content");if(i&&i.get){var a=i.get(r);a=a===SC.MIXED_STATE?YES:!a,i.set(r,a),this.displayDidChange()}}this._removeCheckboxActiveState(),t=YES}else this._isMouseDownOnDisclosure?(this._isInsideDisclosure(e)&&(s=this.get("disclosureState"),o=this.get("contentIndex"),u=SC.none(o)?null:SC.IndexSet.create(o),n=this.get("displayDelegate"
),s===SC.BRANCH_OPEN?(u&&n&&n.collapse?n.collapse(u):this.set("disclosureState",SC.BRANCH_CLOSED),this.displayDidChange()):s===SC.BRANCH_CLOSED&&(u&&n&&n.expand?n.expand(u):this.set("disclosureState",SC.BRANCH_OPEN),this.displayDidChange())),this._removeDisclosureActiveState(),t=YES):this._isMouseDownOnRightIcon&&(this._removeRightIconActiveState(),t=YES);return this._isMouseInsideCheckbox=this._isMouseDownOnCheckbox=NO,this._isMouseDownOnDisclosure=this._isMouseInsideDisclosure=NO,this._isMouseInsideRightIcon=this._isMouseDownOnRightIcon=NO,t},mouseMoved:function(e){return this._isMouseDownOnCheckbox&&this._isInsideCheckbox(e)?(this._addCheckboxActiveState(),this._isMouseInsideCheckbox=YES):this._isMouseDownOnCheckbox?(this._removeCheckboxActiveState(),this._isMouseInsideCheckbox=NO):this._isMouseDownOnDisclosure&&this._isInsideDisclosure(e)?(this._addDisclosureActiveState(),this._isMouseInsideDisclosure=YES):this._isMouseDownOnDisclosure?(this._removeDisclosureActiveState(),this._isMouseInsideDisclosure=NO):this._isMouseDownOnRightIcon&&this._isInsideRightIcon(e)?(this._addRightIconActiveState(),this._isMouseInsideRightIcon=YES):this._isMouseDownOnRightIcon&&(this._removeRightIconActiveState(),this._isMouseInsideRightIcon=NO),NO},touchStart:function(e){return this.mouseDown(e)},touchEnd:function(e){return this.mouseUp(e)},touchEntered:function(e){return this.mouseEntered(e)},touchExited:function(e){return this.mouseExited(e)},_addCheckboxActiveState:function(){if(this.get("isEnabled"))if(this._checkboxRenderDelegate){var e=this._checkboxRenderSource;e.set("isActive",YES),this
._checkboxRenderDelegate.update(e,this.$(".sc-checkbox-view"))}else this.$(".sc-checkbox-view").addClass("active")},_removeCheckboxActiveState:function(){if(this._checkboxRenderer){var e=this._checkboxRenderSource;e.set("isActive",NO),this._checkboxRenderDelegate.update(e,this.$(".sc-checkbox-view"))}else this.$(".sc-checkbox-view").removeClass("active")},_addDisclosureActiveState:function(){if(this.get("isEnabled"))if(this._disclosureRenderDelegate){var e=this._disclosureRenderSource;e.set("isActive",YES),this._disclosureRenderDelegate.update(e,this.$(".sc-disclosure-view"))}else this.$(".sc-disclosure-view").addClass("active")},_removeDisclosureActiveState:function(){if(this._disclosureRenderer){var e=this._disclosureRenderSource;e.set("isActive",NO),this._disclosureRenderDelegate.update(e,this.$(".sc-disclosure-view"))}else this.$(".sc-disclosure-view").addClass("active")},_addRightIconActiveState:function(){this.$("img.right-icon").setClass("active",YES)},_removeRightIconActiveState:function(){this.$("img.right-icon").removeClass("active")},contentHitTest:function(e){var t=this.displayDelegate,n=this.getDelegateProperty("contentValueKey",t);if(!n)return NO;var r=this.$label()[0];if(!r)return NO;var i=e.target,s=this.get("layer");while(i&&i!==s&&i!==window){if(i===r)return YES;i=i.parentNode}return NO},beginEditing:function(e,t){var n=this.$label(),r=this.get("parentView");if(t&&this.scrollToVisible()){var i=this.get("owner"),s=this.get("contentIndex");return this.invokeLast(function(){var e=i.itemViewForContentIndex(s);e&&e.beginEditing&&e.beginEditing(NO)}),YES}return!r||!
n||n.get("length")===0?NO:e()}.enhance(),inlineEditorWillBeginEditing:function(e,t,n){var r=this.get("content"),i=this.get("displayDelegate"),s=this.getDelegateProperty("contentValueKey",i),o=this.get("parentView"),u=this.$label(),a=this.get("validator"),f,l,c,h,p,d,v,m,g,y;l=s&&r?r.get?r.get(s):r[s]:r,f=this.computeFrameWithParentFrame(null),d=this._oldLineHeight=u.css("lineHeight"),h=u.css("fontSize"),p=this.$().css("top"),p?p=parseInt(p.substring(0,p.length-2),0):p=0,m=0,h&&d&&(g=h*1.5,g<d?(u.css({lineHeight:"1.5"}),m=(d-g)/2):oldLineHeight=null),u=u[0],c=SC.offset(u),f.x=c.x,f.y=c.y+p+m,f.height=u.offsetHeight,f.width=u.offsetWidth,v=this.get("escapeHTML"),e.set({value:l,exampleFrame:f,exampleElement:u,multiline:NO,isCollection:YES,validator:a,escapeHTML:v})},inlineEditorShouldBeginEditing:function(e){return YES},inlineEditorDidBeginEditing:function(e,t,n,r){e(t,n,r);var i=this.$label();this._oldOpacity=i.css("opacity"),i.css("opacity",0),this._oldLineHeight&&i.css({lineHeight:this._oldLineHeight})}.enhance(),inlineEditorDidCommitEditing:function(e,t,n){var r=this.get("content"),i=this.displayDelegate,s=this.getDelegateProperty("contentValueKey",i);s&&r?r.set?r.set(s,t):r[s]=t:this.set("content",t),this.displayDidChange(),this._endEditing()},_endEditing:function(e){this.$label().css("opacity",this._oldOpacity),e()}.enhance(),render:function(e,t){var n=this.get("content"),r=this.displayDelegate,i=this.get("outlineLevel"),s=this.get("outlineIndent"),o,u,a,f=[];f.push(this.get("contentIndex")%2===0?"even":"odd"),e.setClass("disabled",!this.get("isEnabled")),a=e.begin("div")
.addClass("sc-outline"),i>=0&&s>0&&a.addStyle("left",s*(i+1)),u=this.get("disclosureState"),u!==SC.LEAF_NODE&&(this.renderDisclosure(a,u),f.push("has-disclosure")),o=this.getDelegateProperty("contentCheckboxKey",r),o&&(u=n?n.get?n.get(o):n[o]:NO,u!==null&&(this.renderCheckbox(a,u),f.push("has-checkbox"))),this.getDelegateProperty("hasContentIcon",r)?(o=this.getDelegateProperty("contentIconKey",r),u=o&&n?n.get?n.get(o):n[o]:null,this.renderIcon(a,u),f.push("has-icon")):this.get("icon")&&(u=this.get("icon"),this.renderIcon(a,u),f.push("has-icon")),o=this.getDelegateProperty("contentValueKey",r),u=o&&n?n.get?n.get(o):n[o]:n,u&&SC.typeOf(u)!==SC.T_STRING&&(u=u.toString()),this.get("escapeHTML")&&(u=SC.RenderContext.escapeHTML(u)),this.renderLabel(a,u),this.getDelegateProperty("hasContentRightIcon",r)&&(o=this.getDelegateProperty("contentRightIconKey",r),u=o&&n?n.get?n.get(o):n[o]:null,this.renderRightIcon(a,u),f.push("has-right-icon")),o=this.getDelegateProperty("contentUnreadCountKey",r),u=o&&n?n.get?n.get(o):n[o]:null;if(!SC.none(u)&&u!==0){this.renderCount(a,u);var l=["zero","one","two","three","four","five"],c=u.toString().length,h=l.length,p=c<h?l[c]:l[h-1];f.push("has-count "+p+"-digit")}o=this.getDelegateProperty("listItemActionProperty",r),u=o&&n?n.get?n.get(o):n[o]:null,u&&(this.renderAction(a,u),f.push("has-action")),this.getDelegateProperty("hasContentBranch",r)&&(o=this.getDelegateProperty("contentIsBranchKey",r),u=o&&n?n.get?n.get(o):n[o]:NO,this.renderBranch(a,u),f.push("has-branch")),e.addClass(f),e=a.end()},renderDisclosure:function(e,t){var n=this.get("theme").disclosureRenderDelegate
;e=e.begin("div").addClass("sc-disclosure-view").addClass("sc-regular-size").addClass(this.get("theme").classNames).addClass(n.get("className"));var r=this._disclosureRenderSource;r||(this._disclosureRenderSource=r=SC.Object.create({renderState:{},theme:this.get("theme")})),r.set("isSelected",t===SC.BRANCH_OPEN).set("isEnabled",this.get("isEnabled")).set("title",""),n.render(r,e),e=e.end(),this._disclosureRenderDelegate=n},renderCheckbox:function(e,t){var n=this.get("theme").checkboxRenderDelegate;e=e.begin("div").addClass("sc-checkbox-view").addClass("sc-regular-size").addClass(this.get("theme").classNames).addClass(n.get("className"));var r=this._checkboxRenderSource;r||(r=this._checkboxRenderSource=SC.Object.create({renderState:{},theme:this.get("theme")})),r.set("isSelected",t&&t!==SC.MIXED_STATE).set("isEnabled",this.get("isEnabled")&&this.get("contentIsEditable")).set("isActive",this._checkboxIsActive).set("title",""),n.render(r,e),e=e.end(),this._checkboxRenderDelegate=n},renderIcon:function(e,t){var n=null,r=null,i=[];t&&SC.ImageView.valueIsUrl(t)?(n=t,r=""):(r=t,n=SC.BLANK_IMAGE_URL),i.push(r,"icon"),e.begin("img").addClass(i).attr("src",n).end()},renderLabel:function(e,t){e.push("<label>",t||"","</label>")},renderRightIcon:function(e,t){var n=null,r=null,i=[];t&&SC.ImageView.valueIsUrl(t)?(n=t,r=""):(r=t,n=SC.BLANK_IMAGE_URL),i.push("right-icon",r),e.begin("img").addClass(i).attr("src",n).end()},renderCount:function(e,t){e.push('<span class="count"><span class="inner">',t.toString(),"</span></span>")},renderAction:function(e,t){e.push('<img src="',SC.BLANK_IMAGE_URL
,'" class="action" />')},renderBranch:function(e,t){var n=[];n.push("branch",t?"branch-visible":"branch-hidden"),e.begin("span").addClass(n).push("&nbsp;").end()}}),SC.ListItemView._deprecatedRenderWarningHasBeenIssued=!1,SC.DRAG_REORDER=16,SC.BENCHMARK_RELOAD=NO,SC.CollectionView=SC.View.extend(SC.CollectionViewDelegate,SC.CollectionContent,{classNames:["sc-collection-view"],displayProperties:["hasFirstResponder","isEnabled","isActive"],renderDelegateName:"collectionRenderDelegate",ACTION_DELAY:200,useFastPath:NO,content:null,contentBindingDefault:SC.Binding.multiple(),length:0,nowShowing:function(){return this.computeNowShowing()}.property("length","clippingFrame").cacheable(),selection:null,isSelectable:YES,isSelectableBindingDefault:SC.Binding.bool(),isEnabled:YES,isEnabledBindingDefault:SC.Binding.bool(),isEditable:YES,isEditableBindingDefault:SC.Binding.bool(),canReorderContent:NO,canReorderContentBindingDefault:SC.Binding.bool(),canDeleteContent:NO,canDeleteContentBindingDefault:SC.Binding.bool(),canEditContent:NO,canEditContentBindingDefault:SC.Binding.bool(),isDropTarget:NO,useToggleSelection:NO,actOnSelect:NO,selectOnMouseDown:YES,exampleView:SC.ListItemView,contentExampleViewKey:null,groupExampleView:null,contentGroupExampleViewKey:null,action:null,target:null,contentValueKey:null,acceptsFirstResponder:NO,isActive:NO,calculatedHeight:0,calculatedWidth:0,computeLayout:function(){return null},layoutForContentIndex:function(e){return null},allContentIndexes:function(){return SC.IndexSet.create(0,this.get("length")).freeze()}.property("length").cacheable(),contentIndexesInRect
:function(e){return null},computeNowShowing:function(){var e=this.contentIndexesInRect(this.get("clippingFrame"));if(!e)e=this.get("allContentIndexes");else{var t=this.get("length"),n=e.get("max");n>t&&(e=e.copy().remove(t,n-t).freeze())}return e},showInsertionPoint:function(e,t){},hideInsertionPoint:function(){},delegate:null,selectionDelegate:function(){var e=this.get("delegate"),t=this.get("content");return this.delegateFor("isCollectionViewDelegate",e,t)}.property("delegate","content").cacheable(),contentDelegate:function(){var e=this.get("delegate"),t=this.get("content");return this.delegateFor("isCollectionContent",e,t)}.property("delegate","content").cacheable(),_contentGroupIndexes:function(){return this.get("contentDelegate").contentGroupIndexes(this,this.get("content"))}.property("contentDelegate","content").cacheable(),contentRangeDidChange:function(e,t,n,r){!t&&n==="[]"?(this.notifyPropertyChange("_contentGroupIndexes"),this.reload(r)):this.contentPropertyDidChange(t,n,r)},contentPropertyDidChange:function(e,t,n){},updateContentRangeObserver:function(){var e=this.get("nowShowing"),t=this._cv_contentRangeObserver,n=this.get("content");if(!n)return;if(t)n.updateRangeObserver(t,e);else{var r=this.contentRangeDidChange;t=n.addRangeObserver(e,this,r,null),this._cv_contentRangeObserver=t}},removeContentRangeObserver:function(){var e=this.get("content"),t=this._cv_contentRangeObserver;t&&(e&&e.removeRangeObserver(t),this._cv_contentRangeObserver=null)},contentLengthDidChange:function(){var e=this.get("content");this.set("length",e?e.get("length"):0)},_cv_contentDidChange
:function(){var e=this.get("content"),t=this.contentLengthDidChange;if(e===this._content)return;this.removeContentRangeObserver(),this._content&&this._content.removeObserver("length",this,t),this._content=e,e&&e.addObserver("length",this,t),this.contentLengthDidChange(),this.contentRangeDidChange(e,null,"[]",null)}.observes("content"),_invalidIndexes:NO,reload:function(e){var t=this._invalidIndexes;return e&&t!==YES?t?t.add(e):t=this._invalidIndexes=e.clone():this._invalidIndexes=YES,this.get("isVisibleInWindow")&&this.invokeOnce(this.reloadIfNeeded),this},reloadIfNeeded:function(){var e=this._invalidIndexes;if(!e||!this.get("isVisibleInWindow"))return this;this._invalidIndexes=NO;var t=this.get("content"),n,r,i,s=this.computeLayout(),o=SC.BENCHMARK_RELOAD,u=this.get("nowShowing"),a=this._sc_itemViews,f=this.get("containerView")||this,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C;e.isIndexSet&&e.contains(u)&&(e=YES),this.willReload&&this.willReload(e===YES?null:e),l=this.get("exampleView"),h=l?l.isReusableInCollections:NO,c=this.get("groupExampleView"),p=c?c.isReusableInCollections:NO;if(e.isIndexSet){o&&SC.Benchmark.start(o="%@#reloadIfNeeded (Partial)".fmt(this),YES),v=[],m=[],g=[],e.forEach(function(e){i=a?a[e]:null,u.contains(e)?i&&i.parentView===f?m.push(e):g.push(e):i&&i.parentView===f&&v.push(e)},this);for(n=0,r=v.length;n<r;++n)b=v[n],i=a?a[b]:null,delete a[b],T=this.get("contentDelegate"),N=this.get("_contentGroupIndexes"),C=N&&N.contains(b),C&&(C=T.contentIndexIsGroup(this,t,b)),d=C?p:h,d&&(x=C?this._GROUP_VIEW_POOL:this._VIEW_POOL,x.push(i),i.destroyLayer()),E=i.get("layer"),
E&&E.parentNode&&E.parentNode.removeChild(E),f.removeChild(i),d||i.destroy();for(n=0,r=m.length;n<r;++n)b=m[n],i=a?a[b]:null,i.destroyLayer(),w=this.itemViewForContentIndex(b,YES),f.replaceChild(w,i);for(n=0,r=g.length;n<r;++n)b=g[n],w=this.itemViewForContentIndex(b,YES),f.insertBefore(w,null);o&&SC.Benchmark.end(o)}else{o&&SC.Benchmark.start(o="%@#reloadIfNeeded (Full)".fmt(this),YES),a&&(a.length=0),y=f.get("childViews"),y&&(y=y.copy()),f.beginPropertyChanges(),this.willRemoveAllChildren&&this.willRemoveAllChildren(),f.destroyLayer().removeAllChildren();if(y)for(n=0,r=y.length;n<r;++n)w=y[n],C=w.get("isGroupView"),d=C?p:h,d?(x=C?this._GROUP_VIEW_POOL:this._VIEW_POOL,x.push(w),w.destroyLayer()):w.destroy();y=[],u.forEach(function(e){y.push(this.itemViewForContentIndex(e,YES))},this),f.set("childViews",y),f.replaceLayer(),f.endPropertyChanges(),o&&SC.Benchmark.end(o)}return s&&this.adjust(s),this.didReload&&this.didReload(e===YES?null:e),this},_TMP_ATTRS:{},_COLLECTION_CLASS_NAMES:["sc-collection-item"],_GROUP_COLLECTION_CLASS_NAMES:["sc-collection-item","sc-group-item"],_VIEW_POOL:null,_GROUP_VIEW_POOL:null,itemViewForContentIndex:function(e,t){var n,r=this._sc_itemViews;if(!r)r=this._sc_itemViews=[];else if(!t&&(n=r[e]))return n;var i=this.get("content"),s=i.objectAt(e),o=this.get("contentDelegate"),u=this.get("_contentGroupIndexes"),a=NO,f,l,c,h,p,d,v,m,g,y,b,w,E;a=u&&u.contains(e),a&&(a=o.contentIndexIsGroup(this,i,e)),a?(f=this.get("contentGroupExampleViewKey"),f&&s&&(l=s.get(f)),l||(l=this.get("groupExampleView")||this.get("exampleView")),p="_GROUP_VIEW_POOL"):(f=this.
get("contentExampleViewKey"),f&&s&&(l=s.get(f)),l||(l=this.get("exampleView")),p="_VIEW_POOL"),m=this.get("containerView")||this,h=this.layerIdFor(e),g=o.contentIndexIsEnabled(this,i,e),y=o.contentIndexIsSelected(this,i,e),b=o.contentIndexOutlineLevel(this,i,e),w=o.contentIndexDisclosureState(this,i,e),E=this.isVisibleInWindow,c=this.layoutForContentIndex(e),l&&l.isReusableInCollections&&(d=this[p],d||(d=this[p]=[]),d.length>0&&(n=d.pop(),v=n.prepareForReuse,v&&v.call(n),n.beginPropertyChanges(),n.set("contentIndex",e),n.set("layerId",h),n.set("isEnabled",g),n.set("isSelected",y),n.set("outlineLevel",b),n.set("disclosureState",w),n.set("isVisibleInWindow",E),n.set("parentView",m),SC.View.views[h]=n,c?n.set("layout",c):n.set("layout",l.prototype.layout),n.set("content",s),n.endPropertyChanges()));if(!n){var S=this._TMP_ATTRS;S.contentIndex=e,S.content=s,S.owner=S.displayDelegate=this,S.parentView=m,S.page=this.page,S.layerId=h,S.isEnabled=g,S.isSelected=y,S.outlineLevel=b,S.disclosureState=w,S.isGroupView=a,S.isVisibleInWindow=E,a?S.classNames=this._GROUP_COLLECTION_CLASS_NAMES:S.classNames=this._COLLECTION_CLASS_NAMES,c?S.layout=c:delete S.layout,n=this.createItemView(l,e,S)}return r[e]=n,n},itemViewForContentObject:function(e){return this.itemViewForContentIndex(this.get("content").indexOf(e))},_TMP_LAYERID:[],createItemView:function(e,t,n){return e.create(n)},layerIdFor:function(e){var t=this._TMP_LAYERID;return t[0]=SC.guidFor(this),t[1]=e,t.join("-")},contentIndexForLayerId:function(e){if(!e||!(e=e.toString()))return null;var t=this._baseLayerId;t||(t=this._baseLayerId=SC
.guidFor(this)+"-");if(e.length<=t.length||e.indexOf(t)!==0)return null;var n=Number(e.slice(e.lastIndexOf("-")+1));return isNaN(n)?null:n},itemViewForEvent:function(e){var t=this.getPath("pane.rootResponder");if(!t)return null;var n=SC.guidFor(this)+"-",r=n.length,i=e.target,s=this.get("layer"),o=null,u,a,f;while(i&&i!==document&&i!==s){u=i?SC.$(i).attr("id"):null;if(u&&(o=this.contentIndexForLayerId(u))!==null)break;i=i.parentNode}if(o===null||i===s)return i=s=null,null;if(o>=this.get("length"))throw"layout for item view %@ was found when item view does not exist (%@)".fmt(u,this);return this.itemViewForContentIndex(o)},expand:function(e){if(!e)return this;var t=this.get("contentDelegate"),n=this.get("content");return e.forEach(function(e){var r=t.contentIndexDisclosureState(this,n,e);r===SC.BRANCH_CLOSED&&t.contentIndexExpand(this,n,e)},this),this},collapse:function(e){if(!e)return this;var t=this.get("contentDelegate"),n=this.get("content");return e.forEach(function(e){var r=t.contentIndexDisclosureState(this,n,e);r===SC.BRANCH_OPEN&&t.contentIndexCollapse(this,n,e)},this),this},_cv_selectionDidChange:function(){var e=this.get("selection"),t=this._cv_selection,n=this._cv_selectionContentDidChange;if(e===t)return;t&&t.removeObserver("[]",this,n),e&&e.addObserver("[]",this,n),this._cv_selection=e,this._cv_selectionContentDidChange()}.observes("selection"),_cv_selectionContentDidChange:function(){var e=this.get("selection"),t=this._cv_selindexes,n=this.get("content"),r;this._cv_selindexes=e?e.frozenCopy():null,t&&(t=t.indexSetForSource(n)),e&&(e=e.indexSetForSource(n)),e&&t?
r=e.without(t).add(t.without(e)):r=e||t,r&&r.get("length")>0&&this.reloadSelectionIndexes(r)},_invalidSelection:NO,reloadSelectionIndexes:function(e){var t=this._invalidSelection;return e&&t!==YES?t?t.add(e):t=this._invalidSelection=e.copy():this._invalidSelection=YES,this.get("isVisibleInWindow")&&this.invokeOnce(this.reloadSelectionIndexesIfNeeded),this},reloadSelectionIndexesIfNeeded:function(){var e=this._invalidSelection;if(!e||!this.get("isVisibleInWindow"))return this;var t=this.get("nowShowing"),n=this._invalidIndexes,r=this.get("content"),i=this.get("selection");return this._invalidSelection=NO,n===YES||!t?this:(e===YES&&(e=t),n&&n.isIndexSet&&(e=e.without(n)),e.forEach(function(e){if(!t.contains(e))return;var n=this.itemViewForContentIndex(e,NO);n&&n.set("isSelected",i?i.contains(r,e):NO)},this),this)},select:function(e,t){var n=this.get("content"),r=this.get("selectionDelegate"),i=this.get("_contentGroupIndexes"),s;if(!this.get("isSelectable")||!this.get("isEnabled"))return this;SC.typeOf(e)===SC.T_NUMBER&&(e=SC.IndexSet.create(e,1));if(e&&e.get("length")>0){i&&i.get("length")>0&&(e=e.copy().remove(i)),e=r.collectionViewShouldSelectIndexes(this,e,t);if(!e||e.get("length")===0)return this}else e=null;return t&&(s=this.get("selection"))?s=s.copy():s=SC.SelectionSet.create(),e&&e.get("length")>0&&(e.get("length")===1?s.addObject(n.objectAt(e.get("firstObject"))):s.add(n,e)),s=r.collectionViewSelectionForProposedSelection(this,s),s||(s=SC.SelectionSet.create()),this._selectionAnchor=null,this.set("selection",s.freeze()),this},deselect:function(e){var t=this.get("selection"
),n=this.get("content"),r=this.get("selectionDelegate");return!this.get("isSelectable")||!this.get("isEnabled")?this:!t||t.get("length")===0?this:(SC.typeOf(e)===SC.T_NUMBER&&(e=SC.IndexSet.create(e,1)),e=r.collectionViewShouldDeselectIndexes(this,e),!e||e.get("length")===0?this:(t=t.copy().remove(n,e),t=r.collectionViewSelectionForProposedSelection(this,t),t||(t=SC.SelectionSet.create()),this.set("selection",t.freeze()),this))},_findNextSelectableItemFromIndex:function(e,t){var n=this.get("length"),r=SC.IndexSet.create(),i=this.get("content"),s=this.get("selectionDelegate"),o=this.get("_contentGroupIndexes"),u,a;if(!o&&s.collectionViewShouldSelectIndexes===SC.CollectionView.prototype.collectionViewShouldSelectIndexes)return e;while(e<n){if(!o||!o.contains(e)){r.add(e),u=s.collectionViewShouldSelectIndexes(this,r);if(u&&u.get("length")>=1)return e;r.remove(e)}e++}return t===undefined&&(a=this.get("selection"),t=a?a.get("max"):-1),t},_findPreviousSelectableItemFromIndex:function(e,t){var n=SC.IndexSet.create(),r=this.get("content"),i=this.get("selectionDelegate"),s=this.get("_contentGroupIndexes"),o;SC.none(e)&&(e=-1);if(!s&&i.collectionViewShouldSelectIndexes===SC.CollectionView.prototype.collectionViewShouldSelectIndexes)return e;while(e>=0){if(!s||!s.contains(e)){n.add(e),o=i.collectionViewShouldSelectIndexes(this,n);if(o&&o.get("length")>=1)return e;n.remove(e)}e--}if(t===undefined){var u=this.get("selection");t=u?u.get("min"):-1}return SC.none(t)&&(t=-1),t},selectPreviousItem:function(e,t){SC.none(t)&&(t=1),SC.none(e)&&(e=!1);var n=this.get("selection"),r=this.get("content"
);n&&(n=n.indexSetForSource(r));var i=n?n.get("min"):-1,s=n?n.get("max")-1:-1,o=this._selectionAnchor;SC.none(o)&&(o=i);if(e){s>o?s-=t:i=this._findPreviousSelectableItemFromIndex(i-t);if(SC.none(i)||i<0)i=0;r.objectAt(i)||(i=n?n.get("min"):-1),s<i&&(s=i)}else{i=this._findPreviousSelectableItemFromIndex(i-t);if(SC.none(i)||i<0)i=0;r.objectAt(i)||(i=n?n.get("min"):-1),s=i,o=null}var u=i;return n=SC.IndexSet.create(i,s+1-i),this.scrollToContentIndex(u),this.select(n),this._selectionAnchor=o,this},selectNextItem:function(e,t){SC.none(t)&&(t=1),SC.none(e)&&(e=!1);var n=this.get("selection"),r=this.get("content");n&&(n=n.indexSetForSource(r));var i=n?n.get("min"):-1,s=n?n.get("max")-1:-1,o=this._selectionAnchor,u=this.get("length");SC.none(o)&&(o=i),e?(i<o?i+=t:s=this._findNextSelectableItemFromIndex(s+t,s),s>=u&&(s=u-1),r.objectAt(s)||(s=n?n.get("max")-1:-1),i>s&&(i=s)):(s=this._findNextSelectableItemFromIndex(s+t,s),s>=u&&(s=u-1),r.objectAt(s)||(s=n?n.get("max")-1:-1),i=s,o=null);var a=s;return n=SC.IndexSet.create(i,s-i+1),this.scrollToContentIndex(a),this.select(n),this._selectionAnchor=o,this},deleteSelection:function(){if(!this.get("canDeleteContent"))return NO;var e=this.get("selection"),t=this.get("content"),n=this.get("selectionDelegate"),r=e&&t?e.indexSetForSource(t):null;return!t||!r||r.get("length")===0?NO:(r=n.collectionViewShouldDeleteIndexes(this,r),!r||r.get("length")===0?NO:(n.collectionViewDeleteContent(this,this.get("content"),r),YES))},scrollToContentIndex:function(e){var t=this.itemViewForContentIndex(e);return t&&this.scrollToItemView(t),this},scrollToItemView
:function(e){return e&&e.scrollToVisible(),this},keyDown:function(e){var t=this.interpretKeyEvents(e);return t?t:NO},keyUp:function(){return!0},insertText:function(e,t){if(e===" "){var n=this.get("selection");return n&&n.get("length")>0&&this.invokeLater(this._cv_action,0,null,t),YES}return NO},selectAll:function(e){var t=this.get("content"),n=t?SC.IndexSet.create(0,t.get("length")):null;return this.select(n,NO),YES},deselectAll:function(){var e=this.get("content"),t=e?SC.IndexSet.create(0,e.get("length")):null;return this.deselect(t,NO),YES},deleteBackward:function(e){return this.deleteSelection()},deleteForward:function(e){return this.deleteSelection()},moveDown:function(e,t){return this.selectNextItem(!1,this.get("itemsPerRow")||1),this._cv_performSelectAction(null,t,this.ACTION_DELAY),!0},moveUp:function(e,t){return this.selectPreviousItem(!1,this.get("itemsPerRow")||1),this._cv_performSelectAction(null,t,this.ACTION_DELAY),!0},moveLeft:function(e){if(e.ctrlKey||e.metaKey)return NO;if((this.get("itemsPerRow")||1)>1)this.selectPreviousItem(!1,1),this._cv_performSelectAction(null,e,this.ACTION_DELAY);else{var t=this.get("selection"),n=this.get("content"),r=t?t.indexSetForSource(n):null;if(r){var i=undefined,s=!1,o=undefined;if(r.get("length")===1){o=r.get("firstObject"),i=this.get("contentDelegate");var u=i.contentIndexDisclosureState(this,n,o);u!==SC.BRANCH_OPEN&&(s=!0)}if(s){var a=i.contentIndexOutlineLevel(this,n,o)-1;if(a>=0){var f=-1;while(f<0){var l=this._findPreviousSelectableItemFromIndex(o-1);if(l<0)return!1;o=l;var c=i.contentIndexOutlineLevel(this,n,o);c===a&&(f=
l)}f!==-1&&this.select(o)}}else this.collapse(r)}}return!0},moveRight:function(e){if(e.ctrlKey||e.metaKey)return NO;if((this.get("itemsPerRow")||1)>1)this.selectNextItem(!1,1),this._cv_performSelectAction(null,e,this.ACTION_DELAY);else{var t=this.get("selection"),n=this.get("content"),r=t?t.indexSetForSource(n):null;r&&this.expand(r)}return!0},moveDownAndModifySelection:function(e,t){return this.selectNextItem(!0,this.get("itemsPerRow")||1),this._cv_performSelectAction(null,t,this.ACTION_DELAY),!0},moveUpAndModifySelection:function(e,t){return this.selectPreviousItem(!0,this.get("itemsPerRow")||1),this._cv_performSelectAction(null,t,this.ACTION_DELAY),!0},moveLeftAndModifySelection:function(e,t){return(this.get("itemsPerRow")||1)>1&&(this.selectPreviousItem(!0,1),this._cv_performSelectAction(null,t,this.ACTION_DELAY)),!0},moveRightAndModifySelection:function(e,t){return(this.get("itemsPerRow")||1)>1&&(this.selectNextItem(!0,1),this._cv_performSelectAction(null,t,this.ACTION_DELAY)),!0},insertNewline:function(e,t){var n=this.get("isEditable")&&this.get("canEditContent"),r,i,s,o,u;return n&&(r=this.get("selection"),i=this.get("content"),r&&r.get("length")===1&&(s=r.indexSetForSource(i),o=s?s.get("min"):-1,n=o>=0)),n&&(u=this.itemViewForContentIndex(o),n=u&&SC.typeOf(u.beginEditing)===SC.T_FUNCTION),n?(this.scrollToContentIndex(o),u=this.itemViewForContentIndex(o),u.beginEditing()):this.invokeLater(this._cv_action,0,u,null),YES},insertTab:function(e){var t=this.get("nextValidKeyView");return t?t.becomeFirstResponder():e.allowDefault(),YES},insertBacktab:function(e){var t=this.get
("previousValidKeyView");return t?t.becomeFirstResponder():e.allowDefault(),YES},mouseDown:function(e){var t=this.itemViewForEvent(e),n=this.get("content"),r=t?t.get("contentIndex"):-1,i,s,o,u,a,f=NO,l=n.get("allowsMultipleSelection");if(!this.get("isEnabled"))return r>-1;if(!this.get("isSelectable"))return NO;this.becomeFirstResponder();if(this.get("useToggleSelection")){if(this.get("selectOnMouseDown")){if(!t)return;o=this.get("selection"),u=o&&o.containsObject(t.get("content")),u?this.deselect(r):l?(this.select(r,YES),f=YES):(this.select(r,NO),f=YES),f&&this.get("actOnSelect")&&this._cv_performSelectAction(t,e)}return YES}return t?(o=this.get("selection"),o&&(o=o.indexSetForSource(n)),i=this.mouseDownInfo={event:e,itemView:t,contentIndex:r,at:Date.now()},u=o?o.contains(r):NO,i.modifierKeyPressed=a=e.ctrlKey||e.metaKey,a&&u?i.shouldDeselect=r>=0:e.shiftKey&&o&&o.get("length")>0&&l?(o=this._findSelectionExtendedByShift(o,r),s=this._selectionAnchor,this.select(o),this._selectionAnchor=s):!a&&u?i.shouldReselect=r>=0:((e.shiftKey||a)&&!l&&this.select(null,!1),this.get("selectOnMouseDown")?this.select(r,a):i.shouldSelect=r>=0),i.previousContentIndex=r,YES):(this.get("allowDeselectAll")&&this.select(null,!1),YES)},mouseUp:function(e){var t=this.itemViewForEvent(e),n=this.mouseDownInfo,r=this.get("content"),i=t?t.get("contentIndex"):-1,s,o,u,a,f,l=r.get("allowsMultipleSelection");if(!this.get("isEnabled"))return i>-1;if(!this.get("isSelectable"))return NO;if(this.get("useToggleSelection")){if(!t||this.get("selectOnMouseDown"))return NO;s=this.get("selection"),o=s&&s.containsObject
(t.get("content")),o?this.deselect(i):l?this.select(i,YES):this.select(i,NO)}else n&&(f=n.contentIndex,i=t?t.get("contentIndex"):-1,n.shouldSelect&&this.select(f,n.modifierKeyPressed),n.shouldDeselect&&this.deselect(f),n.shouldReselect&&(u=this.get("isEditable")&&this.get("canEditContent"),u&&(s=this.get("selection"),u=s&&s.get("length")===1),u&&(a=this.itemViewForContentIndex(f),u=a&&(!a.contentHitTest||a.contentHitTest(e)),u=u&&a.beginEditing?a.beginEditing():NO),u||(this._cv_reselectTimer&&this._cv_reselectTimer.invalidate(),this._cv_reselectTimer=this.invokeLater(this.select,300,f,!1))),this._cleanupMouseDown());return this._cv_performSelectAction(t,e,0,e.clickCount),NO},_cleanupMouseDown:function(){var e=this.mouseDownInfo,t;if(e)for(t in e){if(!e.hasOwnProperty(t))continue;delete e[t]}this.mouseDownInfo=null},mouseMoved:function(e){var t=this.itemViewForEvent(e),n=this._lastHoveredItem;return t!==n&&(n&&n.mouseExited&&n.mouseExited(e),t&&t.mouseEntered&&t.mouseEntered(e)),this._lastHoveredItem=t,t&&t.mouseMoved&&t.mouseMoved(e),YES},mouseExited:function(e){var t=this._lastHoveredItem;return this._lastHoveredItem=null,t&&t.mouseExited&&t.mouseExited(e),YES},touchStart:function(e,t){var n=this.itemViewForEvent(e),r=n?n.get("contentIndex"):-1;return this.get("isEnabled")?(this.becomeFirstResponder(),this._touchSelectedView=n,this.get("useToggleSelection")||n&&!n.get("isSelected")&&n.set("isSelected",YES),YES):r>-1},touchesDragged:function(e,t){t.forEach(function(e){(Math.abs(e.pageX-e.startX)>5||Math.abs(e.pageY-e.startY)>5)&&e.makeTouchResponder(e.nextTouchResponder)},this
)},touchEnd:function(e){var t=this._touchSelectedView,n=t?t.get("contentIndex"):-1,r=NO,i;if(!this.get("isEnabled"))return n>-1;t&&t.set("isSelected",NO),n>-1&&(this.get("useToggleSelection")&&(i=this.get("selection"),r=i&&i.containsObject(t.get("content"))),r?this.deselect(n):(this.select(n,NO),this._cv_performSelectAction(t,e,0))),this._touchSelectedView=null},touchCancelled:function(e){this._touchSelectedView&&(this._touchSelectedView.set("isSelected",NO),this._touchSelectedView=null)},_findSelectionExtendedByShift:function(e,t){if(!e||e.get("length")===0)return SC.IndexSet.create(t);var n=this.get("content"),r=n.get("length")-1,i=e.get("min"),s=e.get("max")-1,o=this.mouseDownInfo,u=this._selectionAnchor;return SC.none(u)&&(u=-1),t<i?(i=t,u<0&&(this._selectionAnchor=u=s)):t>s?(s=t,u<0&&(this._selectionAnchor=u=i)):t>=i&&t<=s&&(u<0&&(this._selectionAnchor=u=i),t===u?i=s=t:t>u?(i=u,s=t):t<u&&(i=t,s=u)),SC.IndexSet.create(i,s-i+1)},reorderDataType:function(){return"SC.CollectionView.Reorder."+SC.guidFor(this)}.property().cacheable(),dragContent:null,proposedInsertionIndex:null,proposedDropOperation:null,mouseDragged:function(e){var t=this.get("selectionDelegate"),n=this.get("content"),r=this.get("selection"),i=this.mouseDownInfo,s=this.get("_contentGroupIndexes"),o,u,a,f,l;if(!i||i.contentIndex<0)return YES;if(Date.now()-i.at<123)return YES;if(t.collectionViewShouldBeginDrag(this))return this.get("selectOnMouseDown")?(o=r?r.indexSetForSource(n):null,l=r):(o=SC.IndexSet.create(i.contentIndex),f=r?r.indexSetForSource(n):null,f&&f.contains(o)?(o=f,l=r):(l=SC.SelectionSet.create
(),l.addObjects([i.itemView.get("content")]))),o&&s&&s.get("length")>0&&(o=o.copy().remove(s),o.get("length")===0?o=null:o.freeze()),o?(o=o.frozenCopy(),o={content:n,indexes:o,contentDragged:l},this.set("dragContent",o),u=this.get("dragDataTypes"),u&&u.get("length")>0?(a=t.collectionViewDragViewFor(this,o.indexes),a||(a=this._cv_dragViewFor(o.indexes)),a.createLayer(),SC.Drag.start({event:i.event,source:this,dragView:a,ghost:NO,ghostActsLikeCursor:t.ghostActsLikeCursor,slideBack:YES,dataSource:this}),this._cleanupMouseDown(),this._lastInsertionIndex=null):this.set("dragContent",null),YES):YES},_cv_dragViewFor:function(e){var t=this.get("nowShowing").without(e),n=this.get("layer").cloneNode(!1),r=SC.View.create({layer:n,parentView:this}),i=0,s;return t=this.get("nowShowing").without(t),SC.$(n).css("backgroundColor","transparent").css("border","none").css("top",0).css("left",0),t.forEach(function(e){var t=this.itemViewForContentIndex(e),r,o;t&&(r=t.get("isSelected"),t.set("isSelected",NO),t.updateLayerIfNeeded(),o=t.get("layer"),o&&(o=o.cloneNode(!0)),t.set("isSelected",r),t.updateLayerIfNeeded()),o&&(n.appendChild(o),s=t.get("layout"),s.height+s.top>i&&(i=s.height+s.top)),o=null},this),r.set("layout",{height:i}),n=null,r},dragDataTypes:function(){var e=this.get("selectionDelegate"),t=e.collectionViewDragDataTypes(this),n;return this.get("canReorderContent")&&(t=t?t.copy():[],n=this.get("reorderDataType"),t.indexOf(n)<0&&t.push(n)),t?t:[]}.property(),dragDataForType:function(e,t){if(this.get("canReorderContent")&&t===this.get("reorderDataType"))return this.get("dragContent");var n=
this.get("selectionDelegate");return n.collectionViewDragDataForType(this,e,t)},computeDragOperations:function(e,t){var n=SC.DRAG_NONE,r=this.get("selectionDelegate");return this.get("canReorderContent")&&e.get("dataTypes").indexOf(this.get("reorderDataType"))>=0&&(n=SC.DRAG_REORDER),n=r.collectionViewComputeDragOperations(this,e,n),n&SC.DRAG_REORDER&&(n=SC.DRAG_MOVE),n},_computeDropOperationState:function(e,t,n){var r=this.convertFrameFromView(e.get("location"),null),i=SC.DROP_BEFORE,s=this.get("selectionDelegate"),o=this.get("canReorderContent"),u,a,f,l,c,h,p=this.insertionIndexForLocation(r,SC.DROP_ON);SC.typeOf(p)===SC.T_ARRAY&&(i=p[1],p=p[0]);if(i===SC.DROP_ON){this.set("proposedInsertionIndex",p),this.set("proposedDropOperation",i),h=s.collectionViewValidateDragOperation(this,e,n,p,i),p=this.get("proposedInsertionIndex"),i=this.get("proposedDropOperation"),this._dropInsertionIndex=this._dropOperation=null;if(h!==SC.DRAG_NONE)return[p,i,h];i=SC.DROP_BEFORE,p=this.insertionIndexForLocation(r,SC.DROP_BEFORE),SC.typeOf(p)===SC.T_ARRAY&&(i=p[1],p=p[0])}if(p>=0&&o&&i!==SC.DROP_ON){u=e.dataForType(this.get("reorderDataType"));if(u){a=this.get("content"),i===SC.DROP_BEFORE?(f=u.indexes.contains(p-1),l=u.indexes.contains(p)):(f=u.indexes.contains(p),l=u.indexes.contains(p-1));if(f&&l)if(SC.none(this._lastInsertionIndex))if(i===SC.DROP_BEFORE)while(p>=0&&u.indexes.contains(p))p--;else{c=a?a.get("length"):0;while(p<c&&u.indexes.contains(p))p++}else p=this._lastInsertionIndex;p>=0&&(n=SC.DRAG_REORDER)}}return this.set("proposedInsertionIndex",p),this.set("proposedDropOperation",i)
,n=s.collectionViewValidateDragOperation(this,e,n,p,i),p=this.get("proposedInsertionIndex"),i=this.get("proposedDropOperation"),this._dropInsertionIndex=this._dropOperation=null,[p,i,n]},dragUpdated:function(e,t){var n=e.get("allowedDragOperations"),r=this._computeDropOperationState(e,t,n),i=r[0],s=r[1],o=r[2];if(o!==SC.DRAG_NONE){if(this._lastInsertionIndex!==i||this._lastDropOperation!==s){var u=this.itemViewForContentIndex(i);this.showInsertionPoint(u,s)}this._lastInsertionIndex=i,this._lastDropOperation=s}else this.hideInsertionPoint(),this._lastInsertionIndex=this._lastDropOperation=null;return o&SC.DRAG_REORDER?SC.DRAG_MOVE:o},dragExited:function(){this.hideInsertionPoint(),this._lastInsertionIndex=this._lastDropOperation=null},acceptDragOperation:function(e,t){return YES},performDragOperation:function(e,t){var n=this._computeDropOperationState(e,null,t),r=n[0],i=n[1],s=n[2],o=this.get("selectionDelegate"),u,a,f,l,c,h;s&SC.DRAG_REORDER?t=t&SC.DRAG_MOVE?SC.DRAG_REORDER:SC.DRAG_NONE:t&=s;if(t===SC.DRAG_NONE)return t;u=o.collectionViewPerformDragOperation(this,e,t,r,i);if(u===SC.DRAG_NONE&&t&SC.DRAG_REORDER){f=e.dataForType(this.get("reorderDataType"));if(!f)return SC.DRAG_NONE;l=this.get("content"),h=f.indexes;if(h.get("length")===1&&(i===SC.DROP_BEFORE||i===SC.DROP_AFTER)&&h.get("min")===r)return SC.DRAG_MOVE;l.beginPropertyChanges(),a=[],c=0,f.indexes.forEach(function(e){a.push(l.objectAt(e-c)),l.removeAt(e-c),c++,e<r&&r--},this),i===SC.DROP_AFTER&&r++,l.replace(r,0,a,i),this.select(SC.IndexSet.create(r,a.length)),l.endPropertyChanges(),t=SC.DRAG_MOVE}return t},collectionViewShouldBeginDrag
:function(e){return this.get("canReorderContent")},insertionIndexForLocation:function(e,t){return-1},_cv_isVisibleInWindowDidChange:function(){this.get("isVisibleInWindow")&&(this._invalidIndexes&&this.invokeOnce(this.reloadIfNeeded),this._invalidSelection&&this.invokeOnce(this.reloadSelectionIndexesIfNeeded))}.observes("isVisibleInWindow"),collectionViewShouldSelectItem:function(e,t){return this.get("isSelectable")},_TMP_DIFF1:SC.IndexSet.create(),_TMP_DIFF2:SC.IndexSet.create(),_cv_nowShowingDidChange:function(){var e=this.get("nowShowing"),t=this._sccv_lastNowShowing,n,r,i;t!==e&&(t&&e?(r=this._TMP_DIFF1.add(t).remove(e),i=this._TMP_DIFF2.add(e).remove(t),n=r.add(i)):n=t||e),n&&n.get("length")>0&&(this._sccv_lastNowShowing=e?e.frozenCopy():null,this.updateContentRangeObserver(),this.reload(n)),r&&r.clear(),i&&i.clear()}.observes("nowShowing"),init:function(){arguments.callee.base.apply(this,arguments),this.useFastPath&&this.mixin(SC.CollectionFastPath),this.get("canReorderContent")&&this._cv_canReorderContentDidChange(),this._sccv_lastNowShowing=this.get("nowShowing").clone(),this.content&&this._cv_contentDidChange(),this.selection&&this._cv_selectionDidChange()},_cv_canReorderContentDidChange:function(){this.get("canReorderContent")&&(this.get("isDropTarget")||this.set("isDropTarget",YES),SC.Drag.addDropTarget(this))}.observes("canReorderContent"),_cv_performSelectAction:function(e,t,n,r){var i;n===undefined&&(n=0),r===undefined&&(r=1);if(r>1||this.get("actOnSelect"))this._cv_reselectTimer&&this._cv_reselectTimer.invalidate(),i=this.get("selection"),i=i?i.toArray():[],this
._cv_actionTimer&&this._cv_actionTimer.invalidate(),this._cv_actionTimer=this.invokeLater(this._cv_action,n,e,t,i)},_cv_action:function(e,t,n){var r=this.get("action"),i=this.get("target")||null;this._cv_actionTimer=null;if(r){if(SC.typeOf(r)===SC.T_FUNCTION)return this.action(e,t);var s=this.get("pane");s&&s.rootResponder.sendAction(r,i,this,s,n)}else{if(!e)return;if(SC.typeOf(e._action)==SC.T_FUNCTION)return e._action(t);if(SC.typeOf(e.action)==SC.T_FUNCTION)return e.action(t)}}}),SC.DisclosureView=SC.ButtonView.extend({classNames:["sc-disclosure-view"],renderDelegateName:"disclosureRenderDelegate",buttonBehavior:SC.TOGGLE_BEHAVIOR,toggleOnValue:YES,toggleOffValue:NO,valueBindingDefault:SC.Binding.bool(),keyDown:function(e){if(e.which===37||e.which===38)return this.set("value",this.get("toggleOffValue")),YES;if(e.which===39||e.which===40)return this.set("value",this.get("toggleOnValue")),YES;arguments.callee.base.apply(this,arguments)}}),SC.ImageButtonView=SC.ButtonView.extend({classNames:["sc-image-button-view"],themeName:null,renderDelegateName:"imageButtonRenderDelegate",displayProperties:["image"],image:null}),SC.ListView=SC.CollectionView.extend(SC.CollectionRowDelegate,{classNames:["sc-list-view"],acceptsFirstResponder:YES,showAlternatingRows:NO,render:function(e,t){return e.setClass("alternating",this.get("showAlternatingRows")),arguments.callee.base.apply(this,arguments)},rowDelegate:function(){var e=this.delegate,t=this.get("content");return this.delegateFor("isCollectionRowDelegate",e,t)}.property("delegate","content").cacheable(),_sclv_rowDelegateDidChange:function(
){var e=this._sclv_rowDelegate,t=this.get("rowDelegate"),n=this._sclv_rowHeightDidChange,r=this._sclv_customRowHeightIndexesDidChange;if(e===t)return this;this._sclv_rowDelegate=t,e&&(e.removeObserver("rowHeight",this,n),e.removeObserver("customRowHeightIndexes",this,r));if(!t)throw"Internal Inconsistancy: ListView must always have CollectionRowDelegate";return t.addObserver("rowHeight",this,n),t.addObserver("customRowHeightIndexes",this,r),this._sclv_rowHeightDidChange()._sclv_customRowHeightIndexesDidChange(),this}.observes("rowDelegate"),_sclv_rowHeightDidChange:function(){var e=this.get("rowDelegate"),t=e.get("rowHeight"),n;return t===this._sclv_rowHeight?this:(this._sclv_rowHeight=t,n=SC.IndexSet.create(0,this.get("length")),this.rowHeightDidChangeForIndexes(n),this)},_sclv_customRowHeightIndexesDidChange:function(){var e=this.get("rowDelegate"),t=e.get("customRowHeightIndexes"),n=this._sclv_customRowHeightIndexes,r=this._sclv_customRowHeightIndexesContentDidChange;return t===n||n&&n.isEqual(t)?this:(n&&this._sclv_isObservingCustomRowHeightIndexes&&n.removeObserver("[]",this,r),(this._sclv_isObservingCustomRowHeightIndexes=t&&!t.get("isFrozen"))&&t.addObserver("[]",this,r),this._sclv_customRowHeightIndexesContentDidChange(),this)},_sclv_customRowHeightIndexesContentDidChange:function(){var e=this.get("rowDelegate"),t=e.get("customRowHeightIndexes"),n=this._sclv_customRowHeightIndexes,r;return t&&n?r=t.copy().add(n):r=t||n,this._sclv_customRowHeightIndexes=t?t.frozenCopy():null,this.rowHeightDidChangeForIndexes(r),this},rowOffsetForContentIndex:function(e){if(e===0)return 0
;var t=this.get("rowDelegate"),n=t.get("rowHeight"),r,i,s,o,u,a,f;return i=e*n,r=this.get("rowSpacing"),r&&(i+=e*r),t.customRowHeightIndexes&&(s=t.get("customRowHeightIndexes"))&&(o=this._sclv_offsetCache,o||(o=[],u=a=0,s.forEach(function(e){u+=this.rowHeightForContentIndex(e)-n,o[e+1]=u,a=e},this),this._sclv_max=a+1,this._sclv_offsetCache=o),u=o[e],u===undefined&&(u=o[e]=o[e-1],u===undefined&&(a=this._sclv_max,e<a&&(a=s.indexBefore(e)+1),u=o[e]=o[a]||0)),i+=u),i},rowHeightForContentIndex:function(e){var t=this.get("rowDelegate"),n,r,i,s;return t.customRowHeightIndexes&&(s=t.get("customRowHeightIndexes"))?(r=this._sclv_heightCache,r||(r=[],i=this.get("content"),s.forEach(function(e){r[e]=t.contentIndexRowHeight(this,i,e)},this),this._sclv_heightCache=r),n=r[e],n===undefined&&(n=t.get("rowHeight"))):n=t.get("rowHeight"),n},rowHeightDidChangeForIndexes:function(e){var t=this.get("length");return this._sclv_heightCache=this._sclv_offsetCache=null,e&&e.isIndexSet&&(e=e.get("min")),this.reload(SC.IndexSet.create(e,t-e)),this},_sclv_lengthDidChange:function(){this.adjust(this.computeLayout())}.observes("length"),computeLayout:function(){var e=this._sclv_layout;return e||(e=this._sclv_layout={}),e.minHeight=this.rowOffsetForContentIndex(this.get("length")),this.set("calculatedHeight",e.minHeight),e},layoutForContentIndex:function(e){var t=this.get("rowDelegate");return{top:this.rowOffsetForContentIndex(e),height:this.rowHeightForContentIndex(e)-t.get("rowPadding")*2,left:0,right:0}},contentIndexesInRect:function(e){var t=this.get("rowDelegate").get("rowHeight"),n=SC.minY(e),r=SC.maxY
(e),i=e.height||0,s=this.get("length"),o,u,a;u=(n-n%t)/t,o=this.rowOffsetForContentIndex(u);while(u>0&&o>n)u--,o-=this.rowHeightForContentIndex(u);o+=this.rowHeightForContentIndex(u);while(u<s&&o<=n)u++,o+=this.rowHeightForContentIndex(u);u<0&&(u=0),u>=s&&(u=s),a=u+(i-i%t)/t,a>s&&(a=s),o=this.rowOffsetForContentIndex(a);while(a>=u&&o>=r)a--,o-=this.rowHeightForContentIndex(a);o+=this.rowHeightForContentIndex(a);while(a<s&&o<r)a++,o+=this.rowHeightForContentIndex(a);return a++,a<u&&(a=u),a>s&&(a=s),SC.IndexSet.create(u,a-u)},insertionPointView:SC.View.extend({classNames:"sc-list-insertion-point",render:function(e,t){t&&e.push('<div class="anchor"></div>')}}),showInsertionPoint:function(e,t){var n=this._insertionPointView;n||(n=this._insertionPointView=this.get("insertionPointView").create());var r=e.get("contentIndex"),i=this.get("length"),s=SC.clone(e.get("layout")),o=e.get("outlineLevel"),u=e.get("outlineIndent")||0,a;r>=i&&r>0&&(a=this.itemViewForContentIndex(i-1),a.get("isGroupView")&&(o=1,u=a.get("outlineIndent"))),SC.none(o)&&(o=-1),t&SC.DROP_ON?(this.hideInsertionPoint(),e.set("isSelected",YES),this._lastDropOnView=e):(this._lastDropOnView&&(this._lastDropOnView.set("isSelected",NO),this._lastDropOnView=null),t&SC.DROP_AFTER&&(s.top+=s.height),s.height=2,s.right=0,s.left=(o+1)*u+12,delete s.width,n.set("layout",s),this.appendChild(n))},hideInsertionPoint:function(){this._lastDropOnView&&(this._lastDropOnView.set("isSelected",NO),this._lastDropOnView=null);var e=this._insertionPointView;e&&e.removeFromParent().destroy(),this._insertionPointView=null},insertionIndexForLocation
:function(e,t){var n={x:e.x,y:e.y,width:1,height:1},r=this.contentIndexesInRect(n),i=r.get("min"),s=this.get("length"),o,u,a,f,l,c,h,p,d;if(SC.none(i)||i<0)s===0||e.y<=this.rowOffsetForContentIndex(0)?i=0:e.y>=this.rowOffsetForContentIndex(s)&&(i=s);o=this.rowOffsetForContentIndex(i),u=o+this.rowHeightForContentIndex(i);if(t==SC.DROP_ON){this.get("isEditable")?a=Math.min(Math.floor((u-o)*.2),5):a=0;if(e.y>=o+a||e.y<=u+a)return[i,SC.DROP_ON]}i>0&&(p=this.itemViewForContentIndex(i-1),h=(p?p.get("outlineIndent"):0)||0,c=p?p.get("outlineLevel"):0,i<s?(p=this.itemViewForContentIndex(i),f=p?p.get("outlineLevel"):0,l=(p?p.get("outlineIndent"):0)||0,l*=f):(f=p.get("isGroupView")?1:0,l=h*f),h*=c,f!==c&&l!==h&&h>l&&(i--,t=SC.DROP_AFTER));if(t===SC.DROP_BEFORE){p=i<s?this.itemViewForContentIndex(i):null;if(!p||p.get("isGroupView"))i>0?(p=this.itemViewForContentIndex(i-1),!p.get("isGroupView")||p.get("disclosureState")===SC.BRANCH_OPEN?(i-=1,t=SC.DROP_AFTER):i=-1):i=-1;i<0&&(t=SC.DRAG_NONE)}return[i,t]},mouseWheel:function(e){var t=SC.InlineTextFieldView,n=t&&t.editor;return n&&n.get("isEditing")&&n.get("delegate").get("displayDelegate")===this&&t.commitEditing(),NO},init:function(){arguments.callee.base.apply(this,arguments),this._sclv_rowDelegateDidChange()}}),SC.ScrollerView=SC.View.extend({classNames:["sc-scroller-view"],displayProperties:["thumbPosition","thumbLength","isEnabled","controlsHidden"],ariaRole:"scrollbar",shouldScrollToClick:NO,_touchScrollValue:NO,value:function(e,t){var n=this.get("minimum");return t!==undefined&&(this._scs_value=t),t=this._scs_value||n,Math.max(Math
.min(t,this.get("maximum")),n)}.property("maximum","minimum").cacheable(),displayValue:function(){var e;return this.get("_touchScrollValue")?e=this.get("_touchScrollValue"):e=this.get("value"),e}.property("value","_touchScrollValue").cacheable(),proportion:0,maximum:100,minimum:0,isEnabled:function(e,t){return t!==undefined&&(this._scsv_isEnabled=t),this._scsv_isEnabled!==undefined?this._scsv_isEnabled:this.get("proportion")<1}.property("proportion").cacheable(),_scsv_isEnabled:undefined,layoutDirection:SC.LAYOUT_VERTICAL,hasButtons:YES,scrollbarThickness:14,capLength:18,capOverlap:14,buttonLength:41,buttonOverlap:11,minimumThumbLength:20,_classNames:{},render:function(e,t){var n=this._classNames,r="",i=this.get("parentView"),s=this.get("layoutDirection"),o,u,a,f,l,c,h,p,d;n["sc-vertical"]=s===SC.LAYOUT_VERTICAL,n["sc-horizontal"]=s===SC.LAYOUT_HORIZONTAL,n.disabled=!this.get("isEnabled"),n["controls-hidden"]=this.get("controlsHidden"),e.setClass(n),u=this.get("thumbLength"),o=this.get("thumbPosition");if(t)e.push('<div class="track"></div>'),this.renderButtons(e,this.get("hasButtons")),this.renderThumb(e,s,u,o),e.attr("aria-orientation","vertical"),e.attr("aria-valuemax",this.get("maximum")),e.attr("aria-valuemin",this.get("minimum")),e.attr("aria-valuenow",this.get("value")),e.attr("aria-controls",i.getPath("contentView.layerId"));else{if(this.get("controlsHidden"))return;f=this.$(".thumb"),this.adjustThumb(f,o,u),e.attr("aria-valuenow",this.get("value"))}},renderThumb:function(e,t,n,r){var i;t===SC.LAYOUT_HORIZONTAL?i="width: "+n+"px; left: "+r+"px;":i="height: "+n+"px; top: "+
r+"px;",e.push('<div class="thumb" style="%@">'.fmt(i),'<div class="thumb-center"></div></div>')},renderButtons:function(e,t){t&&e.push('<div class="button-bottom"></div><div class="button-top"></div>')},touchScrollDidStart:function(e){this.set("_touchScrollValue",e)},touchScrollDidEnd:function(e){this.set("_touchScrollValue",NO)},touchScrollDidChange:function(e){this.set("_touchScrollValue",e)},adjustThumb:function(e,t,n){this.adjustThumbPosition(e,t),this.adjustThumbSize(e,n)},adjustThumbPosition:function(e,t){if(this._thumbPosition===t)return;switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:e.css("top",t);break;case SC.LAYOUT_HORIZONTAL:e.css("left",t)}this._thumbPosition=t},adjustThumbSize:function(e,t){t=Math.max(t,this.get("minimumThumbLength"));if(this._thumbSize===t)return;switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:e.css("height",t);break;case SC.LAYOUT_HORIZONTAL:e.css("width",t)}this._thumbSize=t},trackLength:function(){var e=this.get("scrollerLength");return e-=this.capLength-this.capOverlap,e-=this.buttonLength-this.buttonOverlap,e}.property("scrollerLength").cacheable(),scrollerLength:function(){switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:return this.get("frame").height;case SC.LAYOUT_HORIZONTAL:return this.get("frame").width}return 0}.property("frame").cacheable(),thumbLength:function(){var e;return e=Math.floor(this.get("trackLength")*this.get("proportion")),e=isNaN(e)?0:e,Math.max(e,this.get("minimumThumbLength"))}.property("trackLength","proportion").cacheable(),thumbPosition:function(){var e=this.get("displayValue"
),t=this.get("maximum"),n=this.get("trackLength"),r=this.get("thumbLength"),i=this.get("capLength"),s=this.get("capOverlap"),o;return o=e/t*(n-r),o+=i-s,Math.floor(isNaN(o)?0:o)}.property("displayValue","maximum","trackLength","thumbLength").cacheable(),controlsHidden:function(){return this.get("proportion")>=1}.property("proportion").cacheable(),valueForPosition:function(e){var t=this.get("maximum"),n=this.get("trackLength"),r=this.get("thumbLength"),i=this.get("capLength"),s=this.get("capOverlap"),o;return o=e-(i-s),o/=n-r,o*=t,o},mouseDown:function(e){if(!this.get("isEnabled"))return NO;this._altIsDown=e.altKey,this._shiftIsDown=e.shiftKey;var t=e.target,n=this.get("thumbPosition"),r,i,s,o=this.get("scrollerLength");if(t.className.indexOf("thumb")>=0)i=this.convertFrameFromView({x:e.pageX,y:e.pageY}),i.x-=n,i.y-=n,this._thumbDragging=YES,this._thumbOffset=i,this._mouseDownLocation={x:e.pageX,y:e.pageY},this._thumbPositionAtDragStart=this.get("thumbPosition"),this._valueAtDragStart=this.get("value");else if(t.className.indexOf("button-top")>=0)this.decrementProperty("value",this._altIsDown?o:30),this.makeButtonActive(".button-top"),this.startMouseDownTimer("scrollUp"),this._isScrollingUp=YES;else if(t.className.indexOf("button-bottom")>=0)this.incrementProperty("value",this._altIsDown?o:30),this.makeButtonActive(".button-bottom"),this.startMouseDownTimer("scrollDown"),this._isScrollingDown=YES;else{var u=this.get("shouldScrollToClick");e.altKey&&(u=!u);var a=this.get("trackLength"),f=this.get("thumbLength"),l=this.convertFrameFromView({x:e.pageX,y:e.pageY}),c;switch(this.get
("layoutDirection")){case SC.LAYOUT_VERTICAL:this._mouseDownLocation=c=l.y;break;case SC.LAYOUT_HORIZONTAL:this._mouseDownLocation=c=l.x}u?(this.set("value",this.valueForPosition(c-f/2)),n=this.get("thumbPosition"),this._thumbDragging=YES,this._thumbOffset={x:l.x-n,y:l.y-n},this._mouseDownLocation={x:e.pageX,y:e.pageY},this._thumbPositionAtDragStart=n,this._valueAtDragStart=this.get("value")):c<n?(this.decrementProperty("value",o),this.startMouseDownTimer("page")):(this.incrementProperty("value",o),this.startMouseDownTimer("page"))}return YES},mouseUp:function(e){var t=this._scs_buttonActive,n=NO,r;return t&&(t.removeClass("active"),n=YES),r=this._mouseDownTimer,r&&(r.invalidate(),this._mouseDownTimer=null),this._thumbDragging=NO,this._isScrollingDown=NO,this._isScrollingUp=NO,n},mouseDragged:function(e){var t,n,r,i,s=e.target,o=this._thumbPositionAtDragStart,u=this._isScrollingUp,a=this._isScrollingDown,f=this._scs_buttonActive,l;if(this._thumbDragging){switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:r=e.pageY-this._mouseDownLocation.y;break;case SC.LAYOUT_HORIZONTAL:r=e.pageX-this._mouseDownLocation.x}if(e.altKey){if(!this._altIsDown||this._shiftIsDown!==e.shiftKey)o=this._thumbPositionAtDragStart=o+r,r=0,this._mouseDownLocation={x:e.pageX,y:e.pageY},this._valueAtDragStart=this.get("value");e.shiftKey&&(r=-r),this.set("value",Math.round(this._valueAtDragStart+r*2))}else i=o+r,n=this.get("trackLength")-this.get("thumbLength"),this.set("value",Math.round(i/n*this.get("maximum")))}else if(u||a){var c=NO,h=NO,p=this.$(".button-top")[0].getBoundingClientRect(),d=this
.$(".button-bottom")[0].getBoundingClientRect();switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:e.clientY<p.bottom?c=YES:h=YES;break;case SC.LAYOUT_HORIZONTAL:e.clientX<p.right?c=YES:h=YES}(c||h)&&c!==u&&(f&&f.removeClass("active"),this._mouseDownTimerAction=c?"scrollUp":"scrollDown",c?this.makeButtonActive(".button-top"):h&&this.makeButtonActive(".button-bottom"),this._isScrollingUp=c,this._isScrollingDown=h)}return this._altIsDown=e.altKey,this._shiftIsDown=e.shiftKey,YES},startMouseDownTimer:function(e,t){var n;this._mouseDownTimerAction=e,this._mouseDownTimer=SC.Timer.schedule({target:this,action:this.mouseDownTimerDidFire,interval:t?0:300})},mouseDownTimerDidFire:function(){var e=this.get("scrollerLength"),t=SC.device.get("mouseLocation"),n=this.get("thumbPosition"),r=this.get("thumbLength"),i=50;switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:t=this.convertFrameFromView(t).y;break;case SC.LAYOUT_HORIZONTAL:t=this.convertFrameFromView(t).x}switch(this._mouseDownTimerAction){case"scrollDown":this.incrementProperty("value",this._altIsDown?e:30);break;case"scrollUp":this.decrementProperty("value",this._altIsDown?e:30);break;case"page":i=150,t<n?this.decrementProperty("value",e):t>n+r&&this.incrementProperty("value",e)}this._mouseDownTimer=SC.Timer.schedule({target:this,action:this.mouseDownTimerDidFire,interval:i})},makeButtonActive:function(e){this._scs_buttonActive=this.$(e).addClass("active")}}),SC.TouchScrollerView=SC.ScrollerView.extend({classNames:["sc-touch-scroller-view"],scrollbarThickness:12,capLength:5,capOverlap:0,hasButtons:NO,buttonOverlap
:36,adjustThumb:function(e,t,n){var r=this.$(".thumb-inner"),i=this.get("scrollerLength"),s=this.get("minimum");t+n>i&&(t=Math.min(i-20,t),n=i-t),t<s&&(n-=s-t,t=s);switch(this.get("layoutDirection")){case SC.LAYOUT_VERTICAL:this._thumbPosition!==t&&e.css("-webkit-transform","translate3d(0px,"+t+"px,0px)"),this._thumbSize!==n&&r.css("-webkit-transform","translate3d(0px,"+Math.round(n-1044)+"px,0px)");break;case SC.LAYOUT_HORIZONTAL:this._thumbPosition!==t&&e.css("-webkit-transform","translate3d("+t+"px,0px,0px)"),this._thumbSize!==n&&r.css("-webkit-transform","translate3d("+Math.round(n-1044)+"px,0px,0px)")}this._thumbPosition=t,this._thumbSize=n},render:function(e,t){var n=this._classNames,r=this.get("layoutDirection"),i,s,o,u,a,f,l,c,h;n["sc-vertical"]=r===SC.LAYOUT_VERTICAL,n["sc-horizontal"]=r===SC.LAYOUT_HORIZONTAL,n.disabled=!this.get("isEnabled"),n["controls-hidden"]=this.get("controlsHidden"),e.setClass(n),s=this.get("thumbLength"),i=this.get("thumbPosition");if(t)e.push('<div class="track"></div>'),this.renderButtons(e,this.get("hasButtons")),this.renderThumb(e,this.get("layoutDirection"),s);else{if(this.get("controlsHidden"))return;u=this.$(".thumb"),this.adjustThumb(u,i,s)}},renderThumb:function(e,t,n){n-=1044,t=t===SC.LAYOUT_HORIZONTAL?"X":"Y",e.push('<div class="thumb"><div class="thumb-top"></div><div class="thumb-clip">'+'<div class="thumb-inner" style="-webkit-transform: translate%@(%@px);">'.fmt(t,n)+'<div class="thumb-center"></div>'+'<div class="thumb-bottom"></div></div></div></div>')}}),SC.NORMAL_SCROLL_DECELERATION=.95,SC.FAST_SCROLL_DECELERATION=.85,SC.
ScrollView=SC.View.extend({classNames:["sc-scroll-view"],isScrollable:YES,contentView:null,horizontalAlign:SC.ALIGN_LEFT,verticalAlign:SC.ALIGN_TOP,horizontalScrollOffset:function(e,t){if(t!==undefined){var n=this.minimumHorizontalScrollOffset(),r=this.get("maximumHorizontalScrollOffset");this._scroll_horizontalScrollOffset=Math.max(n,Math.min(r,t)),this.childViews&&this.horizontalScrollerView&&this.horizontalScrollerView.isObject&&this.horizontalScrollerView.set("value",this._scroll_horizontalScrollOffset||0)}return this._scroll_horizontalScrollOffset||0}.property().cacheable(),verticalScrollOffset:function(e,t){if(t!==undefined){var n=this.get("minimumVerticalScrollOffset"),r=this.get("maximumVerticalScrollOffset");this._scroll_verticalScrollOffset=Math.max(n,Math.min(r,t)),this.childViews&&this.verticalScrollerView&&this.verticalScrollerView.isObject&&this.verticalScrollerView.set("value",this._scroll_verticalScrollOffset||0)}return this._scroll_verticalScrollOffset||0}.property().cacheable(),maximumScrollOffset:function(e,t,n){return e>=t?e-t:n===SC.ALIGN_LEFT||n===SC.ALIGN_TOP?0:n===SC.ALIGN_MIDDLE||n===SC.ALIGN_CENTER?0-Math.round((t-e)/2):0-(t-e)},minimumScrollOffset:function(e,t,n){return e>t?0:n===SC.ALIGN_LEFT||n===SC.ALIGN_TOP?0:n===SC.ALIGN_MIDDLE||n===SC.ALIGN_CENTER?0-Math.round((t-e)/2):0-(t-e)},maximumHorizontalScrollOffset:function(){var e=this.get("contentView"),t=e?e.get("frame").width:0,n=e?e.get("calculatedWidth"):0;n&&(t=e.calculatedWidth),t*=this._scale;var r=this.get("containerView").get("frame").width;return this.get("canScrollHorizontal")||(t=Math.min
(t,r)),this.maximumScrollOffset(t,r,this.get("horizontalAlign"))}.property(),maximumVerticalScrollOffset:function(){var e=this.get("contentView"),t=e&&e.get("frame")?e.get("frame").height:0,n=e?e.get("calculatedHeight"):0;n&&(t=n),t*=this._scale;var r=this.get("containerView").get("frame").height;return this.get("canScrollVertical")||(t=Math.min(t,r)),this.maximumScrollOffset(t,r,this.get("verticalAlign"))}.property(),minimumHorizontalScrollOffset:function(){var e=this.get("contentView"),t=e?e.get("frame").width:0,n=e?e.get("calculatedWidth"):0;n&&(t=n),t*=this._scale;var r=this.get("containerView").get("frame").width;return this.get("canScrollHorizontal")||(t=Math.min(t,r)),this.minimumScrollOffset(t,r,this.get("horizontalAlign"))}.property(),minimumVerticalScrollOffset:function(){var e=this.get("contentView"),t=e&&e.get("frame")?e.get("frame").height:0,n=e?e.get("calculatedHeight"):0;n&&(t=e.calculatedHeight),t*=this._scale;var r=this.get("containerView").get("frame").height;return this.get("canScrollVertical")||(t=Math.min(t,r)),this.minimumScrollOffset(t,r,this.get("verticalAlign"))}.property(),verticalLineScroll:20,horizontalLineScroll:20,verticalPageScroll:function(){return this.get("frame").height}.property("frame"),horizontalPageScroll:function(){return this.get("frame").width}.property("frame"),hasHorizontalScroller:YES,horizontalScrollerView:SC.ScrollerView,horizontalTouchScrollerView:SC.TouchScrollerView,isHorizontalScrollerVisible:YES,canScrollHorizontal:function(){return!!(this.get("hasHorizontalScroller")&&this.get("horizontalScrollerView")&&this.get("isHorizontalScrollerVisible"
))}.property("isHorizontalScrollerVisible").cacheable(),autohidesHorizontalScroller:YES,hasVerticalScroller:YES,verticalScrollerView:SC.ScrollerView,verticalTouchScrollerView:SC.TouchScrollerView,isVerticalScrollerVisible:YES,canScrollVertical:function(){return!!(this.get("hasVerticalScroller")&&this.get("verticalScrollerView")&&this.get("isVerticalScrollerVisible"))}.property("isVerticalScrollerVisible").cacheable(),autohidesVerticalScroller:YES,verticalScrollerBottom:0,verticalOverlay:function(){return SC.platform.touch?YES:NO}.property().cacheable(),horizontalOverlay:function(){return SC.platform.touch?YES:NO}.property().cacheable(),verticalScrollerLayout:null,horizontalScrollerLayout:null,containerView:SC.ContainerView.extend({}),scrollTo:function(e,t){return t===undefined&&SC.typeOf(e)===SC.T_HASH&&(t=e.y,e=e.x),SC.none(e)||this.set("horizontalScrollOffset",e),SC.none(t)||this.set("verticalScrollOffset",t),this},scrollBy:function(e,t){return t===undefined&&SC.typeOf(e)===SC.T_HASH&&(t=e.y,e=e.x),e=e?this.get("horizontalScrollOffset")+e:null,t=t?this.get("verticalScrollOffset")+t:null,this.scrollTo(e,t)},scrollToVisible:function(e){if(arguments.length===0)return arguments.callee.base.apply(this,arguments);var t=this.get("contentView");if(!t)return NO;var n=e.get("frame");return n?(n=t.convertFrameFromView(n,e.get("parentView")),this.scrollToRect(n)):NO},scrollToRect:function(e){var t=SC.cloneRect(this.get("containerView").get("frame"));t.x=this.get("horizontalScrollOffset"),t.y=this.get("verticalScrollOffset");var n=t.x,r=t.y;return t.y-=Math.max(0,SC.minY(t)-SC.minY(e))
,t.x-=Math.max(0,SC.minX(t)-SC.minX(e)),t.y+=Math.max(0,SC.maxY(e)-SC.maxY(t)),t.x+=Math.max(0,SC.maxX(e)-SC.maxX(t)),n!==t.x||r!==t.y?(this.scrollTo(t.x,t.y),YES):NO},scrollDownLine:function(e){return e===undefined&&(e=1),this.scrollBy(null,this.get("verticalLineScroll")*e)},scrollUpLine:function(e){return e===undefined&&(e=1),this.scrollBy(null,0-this.get("verticalLineScroll")*e)},scrollRightLine:function(e){return e===undefined&&(e=1),this.scrollTo(this.get("horizontalLineScroll")*e,null)},scrollLeftLine:function(e){return e===undefined&&(e=1),this.scrollTo(0-this.get("horizontalLineScroll")*e,null)},scrollDownPage:function(e){return e===undefined&&(e=1),this.scrollBy(null,this.get("verticalPageScroll")*e)},scrollUpPage:function(e){return e===undefined&&(e=1),this.scrollBy(null,0-this.get("verticalPageScroll")*e)},scrollRightPage:function(e){return e===undefined&&(e=1),this.scrollBy(this.get("horizontalPageScroll")*e,null)},scrollLeftPage:function(e){return e===undefined&&(e=1),this.scrollBy(0-this.get("horizontalPageScroll")*e,null)},tile:function(){var e=this.get("hasHorizontalScroller")?this.get("horizontalScrollerView"):null,t=e&&this.get("isHorizontalScrollerVisible"),n=this.get("hasVerticalScroller")?this.get("verticalScrollerView"):null,r=n&&this.get("isVerticalScrollerVisible"),i=this.get("containerView"),s={left:0,top:0},o,u,a,f,l,c,h=t?e.get("scrollbarThickness"):0,p=r?n.get("scrollbarThickness"):0;t?(c=this.get("horizontalScrollerLayout"),u={left:c?c.left:0,bottom:c?c.bottom:0,right:c?c.right+p-1:p-1,height:h},e.set("layout",u),f=this.get("horizontalOverlay"),s
.bottom=f?0:u.bottom+h):s.bottom=0,e&&e.set("isVisible",t),r?(h+=this.get("verticalScrollerBottom"),l=this.get("verticalScrollerLayout"),u={top:l?l.top:0,bottom:l?l.bottom+h:h,right:l?l.right:0,width:p},n.set("layout",u),a=this.get("verticalOverlay"),s.right=a?0:u.right+p):s.right=0,n&&n.set("isVisible",r),i.adjust(s)},scrollerVisibilityDidChange:function(){this.tile()}.observes("isVerticalScrollerVisible","isHorizontalScrollerVisible"),_scroll_wheelDeltaX:0,_scroll_wheelDeltaY:0,mouseWheel:function(e){return this._scroll_wheelDeltaX+=e.wheelDeltaX,this._scroll_wheelDeltaY+=e.wheelDeltaY,this.invokeLater(this._scroll_mouseWheel,10).set("isPooled",!0),this.get("canScrollHorizontal")||this.get("canScrollVertical")},_scroll_mouseWheel:function(){this.scrollBy(this._scroll_wheelDeltaX,this._scroll_wheelDeltaY),SC.WHEEL_MOMENTUM&&this._scroll_wheelDeltaY>0?(this._scroll_wheelDeltaY=Math.floor(this._scroll_wheelDeltaY*.95),this._scroll_wheelDeltaY=Math.max(this._scroll_wheelDeltaY,0),this.invokeLater(this._scroll_mouseWheel,10).set("isPooled",!0)):SC.WHEEL_MOMENTUM&&this._scroll_wheelDeltaY<0?(this._scroll_wheelDeltaY=Math.ceil(this._scroll_wheelDeltaY*.95),this._scroll_wheelDeltaY=Math.min(this._scroll_wheelDeltaY,0),this.invokeLater(this._scroll_mouseWheel,10).set("isPooled",!0)):(this._scroll_wheelDeltaY=0,this._scroll_wheelDeltaX=0)},_handleDomScrollEvent:function(e){var t=this.$(e.target);this.setIfChanged("verticalScrollOffset",t.scrollTop()),this.setIfChanged("horizontalScrollOffset",t.scrollLeft())},didCreateLayer:function(){var e=this.containerView.$()[0];SC.Event.add(e,"scroll"
,this,this._handleDomScrollEvent)},willDestroyLayer:function(){var e=this.containerView.$()[0];SC.Event.remove(e,"scroll",this,this._handleDomScrollEvent)},canScale:NO,_scale:1,scale:function(e,t){return t!==undefined&&(this._scale=Math.min(Math.max(this.get("minimumScale"),t),this.get("maximumScale"))),this._scale}.property().cacheable(),minimumScale:.25,maximumScale:2,autoScaleRange:NO,_scale_css:"",updateScale:function(e){var t=this.get("contentView");if(!t)return;t.isScalable?(this.get("contentView").applyScale(e),this._scale_css=""):this._scale_css="scale3d("+e+", "+e+", 1)"},acceptsMultitouch:YES,decelerationRate:SC.NORMAL_SCROLL_DECELERATION,alwaysBounceHorizontal:NO,alwaysBounceVertical:YES,delaysContentTouches:YES,_touchScrollDidChange:function(){this.get("contentView").touchScrollDidChange&&this.get("contentView").touchScrollDidChange(this._scroll_horizontalScrollOffset,this._scroll_verticalScrollOffset),this.verticalScrollerView&&this.verticalScrollerView.touchScrollDidChange&&this.verticalScrollerView.touchScrollDidChange(this._scroll_verticalScrollOffset),this.horizontalScrollerView&&this.horizontalScrollerView.touchScrollDidChange&&this.horizontalScrollerView.touchScrollDidChange(this._scroll_horizontalScrollOffset)},_touchScrollDidStart:function(){this.get("contentView").touchScrollDidStart&&this.get("contentView").touchScrollDidStart(this._scroll_horizontalScrollOffset,this._scroll_verticalScrollOffset),this.verticalScrollerView&&this.verticalScrollerView.touchScrollDidStart&&this.verticalScrollerView.touchScrollDidStart(this._touch_verticalScrollOffset),this
.horizontalScrollerView&&this.horizontalScrollerView.touchScrollDidStart&&this.horizontalScrollerView.touchScrollDidStart(this._touch_horizontalScrollOffset)},_touchScrollDidEnd:function(){this.get("contentView").touchScrollDidEnd&&this.get("contentView").touchScrollDidEnd(this._scroll_horizontalScrollOffset,this._scroll_verticalScrollOffset),this.verticalScrollerView&&this.verticalScrollerView.touchScrollDidEnd&&this.verticalScrollerView.touchScrollDidEnd(this._touch_verticalScrollOffset),this.horizontalScrollerView&&this.horizontalScrollerView.touchScrollDidEnd&&this.horizontalScrollerView.touchScrollDidEnd(this._touch_horizontalScrollOffset)},_applyCSSTransforms:function(e){var t="";this.updateScale(this._scale),t+="translate3d("+ -this._scroll_horizontalScrollOffset+"px, "+ -Math.round(this._scroll_verticalScrollOffset)+"px,0) ",t+=this._scale_css;if(e){var n=e.style;n.webkitTransform=t,n.webkitTransformOrigin="top left"}},captureTouch:function(e){return YES},touchGeneration:0,touchStart:function(e){var t=++this.touchGeneration;return!this.tracking&&this.get("delaysContentTouches")?this.invokeLater(this.beginTouchesInContent,150,t).set("isPooled",!0):this.tracking||this.invokeLater(this.beginTouchesInContent,1,t).set("isPooled",!0),this.beginTouchTracking(e,YES),YES},beginTouchesInContent:function(e){if(e!==this.touchGeneration)return;var t=this.touch,n;t&&this.tracking&&!this.dragging&&!t.touch.scrollHasEnded&&(t.touch.captureTouch(this,YES),t.touch.touchResponder?t.needsScrollEnd&&this._touchScrollDidEnd():t.touch.makeTouchResponder(this))},beginTouchTracking:function(
e,t){var n=e.averagedTouchesForView(this,t),r=this._scroll_verticalScrollOffset||0,i=this._scroll_horizontalScrollOffset||0,s=i,o=r,u=NO,a=0,f=0,l,c;this.touch&&this.touch.timeout&&(clearTimeout(this.touch.timeout),this.touch.timeout=null,s=this.touch.startClipOffset.x,o=this.touch.startClipOffset.y,u=YES),c=this.get("contentView"),c&&(l=c.get("frame"),a=l.width,f=l.height),c.calculatedWidth&&c.calculatedWidth!==0&&(a=c.calculatedWidth),c.calculatedHeight&&c.calculatedHeight!==0&&(f=c.calculatedHeight);var h=this.get("containerView").get("frame"),p=h.width,d=h.height,v=this.convertFrameToView(this.get("frame"),null),m=(i+(n.x-v.x))/this._scale,g=(r+(n.y-v.y))/this._scale;this.touch={startTime:e.timeStamp,notCalculated:YES,enableScrolling:{x:a*this._scale>p||this.get("alwaysBounceHorizontal"),y:f*this._scale>d||this.get("alwaysBounceVertical")},scrolling:{x:NO,y:NO},enableBouncing:SC.platform.bounceOnScroll,startClipOffset:{x:s,y:o},lastScrollOffset:{x:i,y:r},startTouchOffset:{x:n.x,y:n.y},scrollVelocity:{x:0,y:0},startTouchOffsetInContent:{x:m,y:g},containerSize:{width:p,height:d},contentSize:{width:a,height:f},startScale:this._scale,startDistance:n.d,canScale:this.get("canScale")&&SC.platform.pinchToZoom,minimumScale:this.get("minimumScale"),maximumScale:this.get("maximumScale"),globalFrame:v,layer:c.get("layer"),resistanceCoefficient:.998,resistanceAsymptote:320,decelerationFromEdge:.05,accelerationToEdge:.1,scrollTolerance:{x:15,y:15},scaleTolerance:5,secondaryScrollTolerance:30,scrollLock:500,decelerationRate:this.get("decelerationRate"),lastEventTime:e.timeStamp,touch:t?
e:this.touch?this.touch.touch:null,needsScrollEnd:u},this.tracking||(this.tracking=YES,this.dragging=NO)},_adjustForEdgeResistance:function(e,t,n,r,i){var s;if(e<t)s=e-t;else{if(!(e>n))return e;s=n-e}return s=Math.pow(r,Math.abs(s))*i,e<t?s-=i:s=-s+i,Math.min(Math.max(t,e),n)+s},touchesDragged:function(e,t){var n=e.averagedTouchesForView(this);this.updateTouchScroll(n.x,n.y,n.d,e.timeStamp)},updateTouchScroll:function(e,t,n,r){var i=this.touch,s=e-i.globalFrame.x,o=t-i.globalFrame.y,u,a,f,l,c,h,p=i.scrolling,d=this.get("horizontalAlign"),v=this.get("verticalAlign"),m=((this._scroll_horizontalScrollOffset||0)+s)/this._scale,g=((this._scroll_verticalScrollOffset||0)+o)/this._scale,y=m-i.startTouchOffset.x,b=g-i.startTouchOffset.y,w=i.dragging;!p.x&&Math.abs(y)>i.scrollTolerance.x&&i.enableScrolling.x&&(w=YES,p.x=YES,i.scrollTolerance.y=i.secondaryScrollTolerance,i.startTouchOffset.x=e,y=0),!p.y&&Math.abs(b)>i.scrollTolerance.y&&i.enableScrolling.y&&(w=YES,p.y=YES,i.scrollTolerance.x=i.secondaryScrollTolerance,i.startTouchOffset.y=t,b=0),w&&!i.dragging&&(i.dragging=YES,this.dragging=YES,this._touchScrollDidStart());if(!p.x&&!p.y&&!i.canScale)return;p.x&&!p.y&&y>i.scrollLock&&!p.y&&(i.enableScrolling.y=NO),p.y&&!p.x&&b>i.scrollLock&&!p.x&&(i.enableScrolling.x=NO);if(i.canScale){var E=i.startDistance,S=n-E;if(Math.abs(S)>i.scaleTolerance){p.y=YES,p.x=YES;var x=i.startScale*(n/Math.max(E,50)),T=this._adjustForEdgeResistance(x,i.minimumScale,i.maximumScale,i.resistanceCoefficient,i.resistanceAsymptote);this.dragging=YES,this._scale=T;var N=m*this._scale,C=g*this._scale}}c=this.minimumScrollOffset
(i.contentSize.width*this._scale,i.containerSize.width,d),h=this.minimumScrollOffset(i.contentSize.height*this._scale,i.containerSize.height,v),l=this.maximumScrollOffset(i.contentSize.width*this._scale,i.containerSize.width,d),a=this.maximumScrollOffset(i.contentSize.height*this._scale,i.containerSize.height,v),f=i.startTouchOffsetInContent.x*this._scale-s,u=i.startTouchOffsetInContent.y*this._scale-o,i.enableBouncing?(f=this._adjustForEdgeResistance(f,c,l,i.resistanceCoefficient,i.resistanceAsymptote),u=this._adjustForEdgeResistance(u,h,a,i.resistanceCoefficient,i.resistanceAsymptote)):(f=Math.max(c,Math.min(l,f)),u=Math.max(h,Math.min(a,u))),p.x&&(this._scroll_horizontalScrollOffset=f),p.y&&(this._scroll_verticalScrollOffset=u),this._applyCSSTransforms(i.layer),this._touchScrollDidChange();if(r-i.lastEventTime>=1||i.notCalculated){i.notCalculated=NO;var k=this._scroll_horizontalScrollOffset,L=this._scroll_verticalScrollOffset;i.scrollVelocity.x=(k-i.lastScrollOffset.x)/Math.max(1,r-i.lastEventTime),i.scrollVelocity.y=(L-i.lastScrollOffset.y)/Math.max(1,r-i.lastEventTime),i.lastScrollOffset.x=k,i.lastScrollOffset.y=L,i.lastEventTime=r}},touchEnd:function(e){var t=this.touch,n=e.averagedTouchesForView(this);e.scrollHasEnded=YES,n.touchCount>0?this.beginTouchTracking(e,NO):(this.dragging?(t.dragging=NO,t.lastEventTime=e.timeStamp,this.startDecelerationAnimation()):(t.needsScrollEnd&&this._touchScrollDidEnd(),e.captureTouch(this,YES),e.touchResponder&&e.touchResponder!==this?e.end():(!e.touchResponder||e.touchResponder===this)&&e.nextTouchResponder&&e.makeTouchResponder(e.nextTouchResponder
),this.touch=null),this.tracking=NO,this.dragging=NO)},touchCancelled:function(e){var t=this.touch,n=e.averagedTouchesForView(this);if(!this.touch||!this.touch.timeout)this.beginPropertyChanges(),this.set("scale",this._scale),this.set("verticalScrollOffset",this._scroll_verticalScrollOffset),this.set("horizontalScrollOffset",this._scroll_horizontalScrollOffset),this.endPropertyChanges(),this.tracking=NO,this.dragging&&this._touchScrollDidEnd(),this.dragging=NO,this.touch=null},startDecelerationAnimation:function(e){var t=this.touch;t.decelerationVelocity={x:t.scrollVelocity.x*10,y:t.scrollVelocity.y*10},this.decelerateAnimation()},bouncyBounce:function(e,t,n,r,i,s,o){return t<n?e<0?e+=(n-t)*i:e=Math.min((n-t)*s+o,n-t-.01):t>r&&(e>0?e-=(t-r)*i:e=-Math.min((t-r)*s+o,t-r-.01)),e},decelerateAnimation:function(){var e=this.touch,t=this._scale,n=e.contentSize,r=e.containerSize,i=this.get("horizontalAlign"),s=this.get("verticalAlign"),o=this.minimumScrollOffset(n.width*this._scale,r.width,i),u=this.minimumScrollOffset(n.height*this._scale,r.height,s),a=this.maximumScrollOffset(n.width*this._scale,r.width,i),f=this.maximumScrollOffset(n.height*this._scale,r.height,s),l=SC.getCurrentTimeForPerformance(),c=Math.max(l-e.lastEventTime,1),h=this._scroll_horizontalScrollOffset+e.decelerationVelocity.x*(c/10),p=this._scroll_verticalScrollOffset+e.decelerationVelocity.y*(c/10),d=e.decelerationFromEdge,v=e.accelerationToEdge,m=!e.enableBouncing,g=!e.enableBouncing;h>=o&&h<=a&&(m=YES),p>=u&&p<=f&&(g=YES),h/=this._scale,p/=this._scale;var y=0;y=this.bouncyBounce(y,t,e.minimumScale,e.maximumScale
,d,v,0),this._scale=t+=y,h*=this._scale,p*=this._scale,o=this.minimumScrollOffset(n.width*this._scale,r.width,i),u=this.minimumScrollOffset(n.height*this._scale,r.height,s),a=this.maximumScrollOffset(n.width*this._scale,r.width,i),f=this.maximumScrollOffset(n.height*this._scale,r.height,s),m&&(h<o||h>a)&&(h=Math.max(o,Math.min(h,a)),e.decelerationVelocity.x=0),g&&(p<u||p>f)&&(p=Math.max(u,Math.min(p,f)),e.decelerationVelocity.y=0),this._scroll_horizontalScrollOffset=h,this._scroll_verticalScrollOffset=p,this._applyCSSTransforms(e.layer),this._touchScrollDidChange();var b=e.decelerationRate,w=Math.pow(b,c/10);e.decelerationVelocity.y*=w,e.decelerationVelocity.x*=w,e.decelerationVelocity.x=this.bouncyBounce(e.decelerationVelocity.x,h,o,a,d,v,.3),e.decelerationVelocity.y=this.bouncyBounce(e.decelerationVelocity.y,p,u,f,d,v,.3);var E=Math.abs(e.decelerationVelocity.x),S=Math.abs(e.decelerationVelocity.y);if(S<.05&&E<.05&&Math.abs(y)<.05){e.timeout=null,this.touch=null,this._touchScrollDidEnd(),this.beginPropertyChanges(),this.set("scale",this._scale),this.set("verticalScrollOffset",this._scroll_verticalScrollOffset),this.set("horizontalScrollOffset",this._scroll_horizontalScrollOffset),this.endPropertyChanges();return}var x=this;e.lastEventTime=SC.getCurrentTimeForPerformance(),this.touch.timeout=setTimeout(function(){SC.run(x.decelerateAnimation(),x)},30)},createChildViews:function(){var e=[],t;SC.none(t=this.containerView)&&(t=SC.ContainerView),e.push(this.containerView=this.createChildView(t,{contentView:this.contentView,isScrollContainer:YES})),this.contentView=this.containerView
.get("contentView"),t=SC.platform.touch?this.get("horizontalTouchScrollerView"):this.get("horizontalScrollerView"),t&&(this.get("hasHorizontalScroller")?(t=this.horizontalScrollerView=this.createChildView(t,{layoutDirection:SC.LAYOUT_HORIZONTAL,valueBinding:"*owner.horizontalScrollOffset"}),e.push(t)):this.horizontalScrollerView=null),t=SC.platform.touch?this.get("verticalTouchScrollerView"):this.get("verticalScrollerView"),t&&(this.get("hasVerticalScroller")?(t=this.verticalScrollerView=this.createChildView(t,{layoutDirection:SC.LAYOUT_VERTICAL,valueBinding:"*owner.verticalScrollOffset"}),e.push(t)):this.verticalScrollerView=null),this.childViews=e,this.contentViewDidChange(),this.tile()},init:function(){arguments.callee.base.apply(this,arguments),this._scroll_contentView=this.get("contentView");var e=this._scroll_contentView;e&&(e.addObserver("frame",this,this.contentViewFrameDidChange),e.addObserver("calculatedWidth",this,this.contentViewFrameDidChange),e.addObserver("calculatedHeight",this,this.contentViewFrameDidChange)),this.get("isVisibleInWindow")&&this._scsv_registerAutoscroll()},_scsv_registerAutoscroll:function(){this.get("isVisibleInWindow")?SC.Drag.addScrollableView(this):SC.Drag.removeScrollableView(this)}.observes("isVisibleInWindow"),contentViewDidChange:function(){var e=this.get("contentView"),t=this._scroll_contentView,n=this.contentViewFrameDidChange,r=this.contentViewLayerDidChange;e!==t&&(t&&(t.removeObserver("calculatedWidth",this,this.contentViewFrameDidChange),t.removeObserver("calculatedHeight",this,this.contentViewFrameDidChange),t.removeObserver("frame"
,this,n),t.removeObserver("layer",this,r)),this._scroll_contentView=e,e&&(e.addObserver("frame",this,n),e.addObserver("calculatedWidth",this,this.contentViewFrameDidChange),e.addObserver("calculatedHeight",this,this.contentViewFrameDidChange),e.addObserver("layer",this,r)),this.containerView.set("contentView",e),this.contentViewFrameDidChange())}.observes("contentView"),render:function(e,t){return this.invokeLast(this.adjustElementScroll),t&&e.push('<div class="corner"></div>'),arguments.callee.base.apply(this,arguments)},oldMaxHOffset:0,oldMaxVOffset:0,contentViewFrameDidChange:function(e){var t=this.get("contentView"),n=t?t.get("frame"):null,r=this._scale,i=0,s=0,o,u,a,f,l;if(!t||!n)return;i=t.get("calculatedWidth")||n.width||0,s=t.get("calculatedHeight")||n.height||0,i*=r,s*=r;if(!e&&i===this._scroll_contentWidth&&s===this._scroll_contentHeight)return;this._scroll_contentWidth=i,this._scroll_contentHeight=s,o=this.getPath("containerView.frame"),u=o.width,a=o.height,this.get("hasHorizontalScroller")&&(t=this.get("horizontalScrollerView"))&&(this.get("autohidesHorizontalScroller")&&this.set("isHorizontalScrollerVisible",i>u),t.setIfChanged("maximum",i-u),t.setIfChanged("proportion",u/i)),this.get("hasVerticalScroller")&&(t=this.get("verticalScrollerView"))&&(this.get("autohidesVerticalScroller")&&this.set("isVerticalScrollerVisible",s>a),t.setIfChanged("maximum",s-a),t.setIfChanged("proportion",a/s)),!this.get("isVerticalScrollerVisible")&&this.get("verticalScrollOffset")!==0&&this.get("autohidesVerticalScroller")&&this.set("verticalScrollOffset",0),!this.get("isHorizontalScrollerVisible"
)&&this.get("horizontalScrollOffset")!==0&&this.get("autohidesHorizontalScroller")&&this.set("horizontalScrollOffset",0);var c=this.get("maximumVerticalScrollOffset"),h=this.get("verticalScrollOffset"),p=this.get("maximumHorizontalScrollOffset"),d=this.get("horizontalScrollOffset"),v=c<h,m=p<d;(v||m)&&this.forceDimensionsRecalculation(m,v,h,d),this.notifyPropertyChange("maximumVerticalScrollOffset"),this.notifyPropertyChange("maximumHorizontalScrollOffset")},frameDidChange:function(){this.contentViewFrameDidChange(YES)}.observes("frame"),contentViewLayerDidChange:function(){this._verticalScrollOffset!==0&&(this._verticalScrollOffset=-1),this._horizontalScrollOffset!==0&&(this._horizontalScrollOffset=-1),this.invokeLast(this.adjustElementScroll)},_scroll_horizontalScrollOffsetDidChange:function(){this.invokeLast(this.adjustElementScroll)}.observes("horizontalScrollOffset"),_scroll_verticalScrollOffsetDidChange:function(){this.invokeLast(this.adjustElementScroll)}.observes("verticalScrollOffset"),adjustElementScroll:function(){var e=this.get("containerView"),t=this.get("contentView"),n=this.get("verticalScrollOffset"),r=this.get("horizontalScrollOffset");t&&(SC.platform.touch&&this._applyCSSTransforms(t.get("layer")),t._viewFrameDidChange&&t._viewFrameDidChange()),e&&!SC.platform.touch&&(e=e.$()[0],e&&(n!==this._verticalScrollOffset&&(e.scrollTop=n,this._verticalScrollOffset=n),r!==this._horizontalScrollOffset&&(e.scrollLeft=r,this._horizontalScrollOffset=r)))},forceDimensionsRecalculation:function(e,t,n,r){var i=r,s=n;this.scrollTo(0,0),e&&t&&this.scrollTo(this.get("maximumHorizontalScrollOffset"
),this.get("maximumVerticalScrollOffset")),e&&!t&&this.scrollTo(this.get("maximumHorizontalScrollOffset"),s),!e&&t&&this.scrollTo(i,this.get("maximumVerticalScrollOffset"))},_scroll_verticalScrollOffset:0,_scroll_horizontalScrollOffset:0}),SC.MenuScrollerView=SC.ScrollerView.extend({classNames:["sc-menu-scroller-view"],scrollDown:NO,value:function(e,t){if(t===undefined){var n=this._value||0;return Math.min(n,this.get("maximum"))}this._value=t}.property("maximum").cacheable(),maximum:0,isEnabled:YES,layoutDirection:SC.LAYOUT_VERTICAL,verticalLineScroll:20,ownerScrollValueKey:function(){return"verticalScrollOffset"}.property("layoutDirection").cacheable(),init:function(){switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:this.set("scrollerThickness",SC.MenuScrollerView.TINY_SCROLLER_THICKNESS);break;case SC.SMALL_CONTROL_SIZE:this.set("scrollerThickness",SC.MenuScrollerView.SMALL_SCROLLER_THICKNESS);break;case SC.REGULAR_CONTROL_SIZE:this.set("scrollerThickness",SC.MenuScrollerView.REGULAR_SCROLLER_THICKNESS);break;case SC.LARGE_CONTROL_SIZE:this.set("scrollerThickness",SC.MenuScrollerView.LARGE_SCROLLER_THICKNESS);break;case SC.HUGE_CONTROL_SIZE:this.set("scrollerThickness",SC.MenuScrollerView.HUGE_SCROLLER_THICKNESS)}return arguments.callee.base.apply(this,arguments)},render:function(e,t){e.addClass("sc-vertical"),e.addClass(this.get("controlSize"));if(t){var n=this.get("scrollDown")?"arrowDown":"arrowUp";e.push('<span class="scrollArrow '+n+'">&nbsp;</span>')}e.setClass("disabled",!this.get("isEnabled"))},didCreateLayer:function(){},willDestroyLayer:function(){var e=
this._sc_scroller_scrollDidChange;SC.Event.remove(this.$(),"scroll",this,e)},mouseEntered:function(e){this.set("isMouseOver",YES),this._invokeScrollOnMouseOver()},mouseExited:function(e){this.set("isMouseOver",NO)},_sc_scroller_valueDidChange:function(){}.observes("value"),_sc_scroller_armScrollTimer:function(){if(!this._sc_scrollTimer){SC.RunLoop.begin();var e=this._sc_scroller_scrollDidChange;this._sc_scrollTimer=this.invokeLater(e,50),SC.RunLoop.end()}},_sc_scroller_scrollDidChange:function(){var e=SC.getCurrentTimeForPerformance(),t=this._sc_lastScroll,n=this.get("layer"),r=0;if(t&&e-t<50)return this._sc_scroller_armScrollTimer();this._sc_scrollTimer=null,this._sc_lastScroll=e,SC.RunLoop.begin();if(!this.get("isEnabled"))return;this._sc_scrollValue=r=n.scrollTop,this.set("value",r),SC.RunLoop.end()},_scrollMenu:function(){var e=this.get("value"),t;return this.get("scrollDown")?(t=e+this.verticalLineScroll,t<=this.get("maximum")?this.set("value",t):this.set("value",this.get("maximum"))):(t=e-this.verticalLineScroll,t>=0?this.set("value",t):e<=this.verticalLineScroll&&e>0&&this.set("value",0)),YES},_invokeScrollOnMouseOver:function(){this._scrollMenu(),this.get("isMouseOver")&&this.invokeLater(this._invokeScrollOnMouseOver,50)}}),SC.MenuScrollerView.REGULAR_SCROLLER_THICKNESS=18,SC.MenuScrollerView.TINY_SCROLLER_THICKNESS=10,SC.MenuScrollerView.SMALL_SCROLLER_THICKNESS=14,SC.MenuScrollerView.LARGE_SCROLLER_THICKNESS=23,SC.MenuScrollerView.HUGE_SCROLLER_THICKNESS=26,SC.MenuScrollView=SC.ScrollView.extend({classNames:["sc-menu-scroll-view"],maximumHorizontalScrollOffset:0,hasHorizontalScroller
:NO,horizontalScrollerView:SC.MenuScrollerView,isHorizontalScrollerVisible:NO,canScrollHorizontal:NO,autohidesHorizontalScroller:NO,hasVerticalScroller:YES,verticalScrollerView:SC.MenuScrollerView,verticalScrollerView2:SC.MenuScrollerView,isVerticalScrollerVisible:YES,canScrollVertical:YES,autohidesVerticalScroller:YES,verticalScrollerBottom:0,controlSize:SC.REGULAR_CONTROL_SIZE,containerView:SC.ContainerView,scrollToVisible:function(e){if(arguments.length===0)return arguments.callee.base.apply(this,arguments);var t=this.get("contentView");if(!t)return NO;var n=e.get("frame");if(!n)return NO;n=t.convertFrameFromView(n,e.get("parentView"));var r=this.get("verticalScrollerView2");r&&r.get("isVisible")&&(n.height+=r.get("frame").height);var i=this.get("verticalScrollerView");return i&&i.get("isVisible")&&(n.y-=i.get("frame").height),this.scrollToRect(n)},tile:function(){var e,t,n,r,i,s,o;e=this.get("hasVerticalScroller"),t=e?this.get("verticalScrollerView"):null,n=e?this.get("verticalScrollerView2"):null,r=t&&this.get("isVerticalScrollerVisible"),i=this.get("containerView"),s={left:0,top:0};if(r){o=0;var u=t.get("scrollerThickness")||n.get("scrollerThickness"),a=this.get("contentView"),f,l=a?a.get("frame"):null,c=l?l.height:0,h=this.containerView.$()[0],p=this.get("verticalScrollOffset"),d={height:0,top:0,right:0,left:0},v={height:u,top:0,right:0,left:0},m={height:u,bottom:0,right:0,left:0},g={height:0,bottom:0,right:0,left:0};h&&(o=h.offsetHeight),p===0?(s.top=0,s.bottom=u,t.set("layout",d),n.set("layout",m)):p>=c-o-u?(s.top=u,s.bottom=0,t.set("layout",v),n.set("layout",g)):(s
.top=u,s.bottom=u,t.set("layout",v),n.set("layout",m))}t&&(t.set("isVisible",r),n.set("isVisible",r)),i.set("layout",s)},scrollerVisibilityDidChange:function(){this.tile()}.observes("isVerticalScrollerVisible","isHorizontalScrollerVisible","verticalScrollOffset"),createChildViews:function(){var e=[],t,n,r=this.get("controlSize");SC.none(t=this.containerView)&&(t=SC.ContainerView),e.push(this.containerView=this.createChildView(t,{contentView:this.contentView})),this.contentView=this.containerView.get("contentView"),(t=this.verticalScrollerView)&&(n=this.verticalScrollerView2)&&(this.get("hasVerticalScroller")?(t=this.verticalScrollerView=this.createChildView(t,{layout:{top:0,left:0,right:0},controlSize:r,valueBinding:"*owner.verticalScrollOffset"}),e.push(t),n=this.verticalScrollerView2=this.createChildView(n,{scrollDown:YES,layout:{bottom:0,left:0,right:0},controlSize:r,valueBinding:"*owner.verticalScrollOffset"}),e.push(n)):(this.verticalScrollerView=null,this.verticalScrollerView2=null)),this.childViews=e,this.contentViewFrameDidChange(),this.tile()},init:function(){arguments.callee.base.apply(this,arguments),this._scroll_contentView=this.get("contentView");var e=this._scroll_contentView;e&&e.addObserver("frame",this,this.contentViewFrameDidChange),this.get("isVisibleInWindow")&&this._scsv_registerAutoscroll()},_scsv_registerAutoscroll:function(){this.get("isVisibleInWindow")?SC.Drag.addScrollableView(this):SC.Drag.removeScrollableView(this)}.observes("isVisibleInWindow"),contentViewFrameDidChange:function(){var e=this.get("contentView"),t,n=e?e.get("frame"):null,r=n?n.width
:0,i=n?n.height:0,s=this.get("frame"),o,u;this._scroll_contentWidth=r,this._scroll_contentHeight=i,this.get("hasVerticalScroller")&&(e=this.get("verticalScrollerView"))&&(t=this.get("verticalScrollerView2"))&&(i-=1,this.get("autohidesVerticalScroller")&&this.set("isVerticalScrollerVisible",i>s.height),i-=this.get("verticalScrollerBottom"),o=0,u=this.containerView.$()[0],u&&(o=u.offsetHeight),i-=o,e.setIfChanged("maximum",i),t.setIfChanged("maximum",i))},_scroll_horizontalScrollOffsetDidChange:function(){},_scroll_verticalScrollOffsetDidChange:function(){this.adjustElementScroll()}.observes("verticalScrollOffset")}),SC.PopupButtonView=SC.ButtonView.extend({classNames:["sc-popup-button"],renderDelegateName:"popupButtonRenderDelegate",preferMatrix:null,menu:null,shouldLoadInBackground:NO,init:function(){arguments.callee.base.apply(this,arguments),this._setupMenu(),this.get("shouldLoadInBackground")&&SC.backgroundTaskQueue.push(SC.PopupButtonMenuLoader.create({popupButton:this}))},_setupMenu:function(){var e=this.get("instantiatedMenu");this.isActiveBinding&&this.isActiveBinding.disconnect(),this.isActiveBinding=null,e&&!e.isClass&&(this.isActiveBinding=this.bind("isActive",e,"isVisibleInWindow"))},_popup_menuDidChange:function(){this._setupMenu()}.observes("menu"),isActive:NO,_instantiateMenu:function(){var e=this.get("menu");if(!e||!e.isClass)return;this.menu=e.create(),this._setupMenu()},instantiatedMenu:function(){var e=this.get("menu");return e&&e.isClass&&(this._instantiateMenu(),e=this.get("menu")),e}.property("menu").cacheable(),action:function(e){var t=this.get("instantiatedMenu"
);return t?(t.popup(this,this.get("preferMatrix")),YES):NO},mouseDown:function(e){if(!this.get("isEnabled"))return YES;this._isMouseDown=YES,this._action(),this._menuRenderedTimestamp=0;var t=this;return setTimeout(function(){SC.run(function(){t._menuRenderedTimestamp=SC.getCurrentTimeForPerformance()})},1),this.becomeFirstResponder(),YES},mouseUp:function(e){var t=SC.getCurrentTimeForPerformance(),n=this._menuRenderedTimestamp,r=this.get("instantiatedMenu"),i=SC.platform.touch,s;return n===0&&(n=SC.getCurrentTimeForPerformance()),r&&(s=r.getPath("rootMenu.targetMenuItem"),s?s.performAction()||r.remove():!i&&t-n>SC.ButtonView.CLICK_AND_HOLD_DELAY&&r.remove()),this._isMouseDown=NO,arguments.callee.base.apply(this,arguments),YES},mouseExited:function(e){return YES},performKeyEquivalent:function(e,t){if(!this.get("isEnabled"))return NO;var n=this.get("instantiatedMenu");return!!n&&n.performKeyEquivalent(e,t,YES)}}),SC.PopupButtonMenuLoader=SC.Task.extend({popupButton:null,run:function(){this.popupButton&&this.popupButton._instantiateMenu()}}),SC.SegmentView=SC.View.extend(SC.Control,{ariaRole:"tab",isSegment:YES,classNames:["sc-segment-view"],toolTip:null,isEnabled:YES,isActive:NO,isSelected:NO,controlSize:null,supportFocusRing:NO,displayProperties:["icon","displayTitle","value","displayToolTip","isDefault","isCancel","width","isSegment","isFirstSegment","isMiddleSegment","isLastSegment","isOverflowSegment","index","needsEllipsis","isBorderless"],renderDelegateName:"segmentRenderDelegate",useStaticLayout:YES,title:"",value:null,icon:null,localize:NO,keyEquivalent:null,escapeHTML
:YES,needsEllipsis:YES,displayTitle:function(){var e=this.get("title");return this.get("localize")&&(e=SC.String.loc(e)),e}.property("title","localize").cacheable(),width:null,localItem:null,isBorderless:YES,widthDidChange:function(){this.adjust("width",this.get("width"))}.observes("width"),updateItem:function(e,t){var n=e.get("itemKeys"),r,i=e.get("viewKeys"),s,o;for(o=n.get("length")-1;o>=0;o--)r=e.get(n.objectAt(o)),s=i.objectAt(o),SC.none(t.get(r))||this.set(s,t.get(r));this.set("localItem",t)}}),SC.SegmentedView=SC.View.extend(SC.Control,{acceptsFirstResponder:function(){return SC.FOCUS_ALL_CONTROLS?this.get("isEnabled"):NO}.property("isEnabled").cacheable(),_focusSelectedChildView:function(){if(this.get("isFirstResponder")){var e=document.activeElement;e&&!$.isEmptyObject(e)&&e.blur();if(!SC.isArray(this.get("value"))){var t=this.get("childViews");for(var n=0;n<t.length;n++){var r=t[n];if(r.get("isSelected")){var i=r.get("layer");i&&i.focus();return}}}var s=this.get("layer");s&&s.focus()}}.observes("paneAttached"),didBecomeFirstResponder:function(){this._focusSelectedChildView()},ariaRole:"tablist",classNames:["sc-segmented-view"],themeName:"square",value:null,isEnabled:YES,allowsEmptySelection:NO,allowsMultipleSelection:NO,selectSegmentWhenTriggeringAction:NO,localize:YES,align:SC.ALIGN_CENTER,layoutDirection:SC.LAYOUT_HORIZONTAL,items:null,itemTitleKey:null,itemValueKey:null,itemIsEnabledKey:null,itemIconKey:null,itemWidthKey:null,itemActionKey:null,itemTargetKey:null,itemLayerIdKey:null,itemKeyEquivalentKey:null,shouldHandleOverflow:NO,overflowTitle:"&raquo;",overflowToolTip
:"More...",overflowIcon:null,segmentViewClass:SC.SegmentView,itemKeys:["itemTitleKey","itemValueKey","itemIsEnabledKey","itemIconKey","itemWidthKey","itemToolTipKey","itemKeyEquivalentKey","itemLayerIdKey"],viewKeys:["title","value","isEnabled","icon","width","toolTip","keyEquivalent","layerId"],init:function(){arguments.callee.base.apply(this,arguments);var e=this.get("overflowTitle"),t=this.get("overflowToolTip"),n=this.get("overflowIcon"),r;r=this.get("segmentViewClass").create({controlSize:this.get("controlSize"),localize:this.get("localize"),title:e,toolTip:t,icon:n,isLastSegment:YES,isOverflowSegment:YES,isVisible:this.get("shouldHandleOverflow")}),this.set("overflowView",r),this.appendChild(r),this.itemsDidChange()},shouldHandleOverflowDidChange:function(){this.get("shouldHandleOverflow")?this.invokeLast(this.remeasure):this.get("overflowView").set("isVisible",NO)}.observes("shouldHandleOverflow"),itemsDidChange:function(){var e=this.get("items")||[],t,n,r,i=this.get("childViews"),s,o=i.lastObject(),u=this.get("value"),a,f=this.get("itemKeys"),l,c=this.get("viewKeys"),h,p=this.get("segmentViewClass"),d,v;if(i.get("length")-1>e.get("length")){for(d=i.get("length")-2;d>=e.get("length");d--){s=i.objectAt(d),SC.isArray(u)?u.removeObject(s.get("value")):u===s.get("value")&&(u=null),n=s.get("localItem");for(v=f.get("length")-1;v>=0;v--)l=this.get(f.objectAt(v)),l&&n.removeObserver(l,this,this.itemContentDidChange);this.removeChild(s)}this.set("value",u)}else if(i.get("length")-1<e.get("length"))for(d=i.get("length")-1;d<e.get("length");d++)s=p.create({controlSize:this.get("controlSize"
),localize:this.get("localize")}),this.insertBefore(s,o);i=this.get("childViews");var m=this.get("isEnabled");for(d=0;d<e.get("length");d++){n=e.objectAt(d),s=i.objectAt(d),r=s.get("localItem");if(r&&!e.contains(r))for(v=f.get("length")-1;v>=0;v--)l=this.get(f.objectAt(v)),l&&r.removeObserver(l,this,this.itemContentDidChange);if(SC.none(n))continue;if(SC.typeOf(n)===SC.T_STRING)n=SC.Object.create({title:n.humanize().titleize(),value:n}),this.set("itemTitleKey","title"),this.set("itemValueKey","value");else if(SC.typeOf(n)===SC.T_HASH)n=SC.Object.create(n);else if(n instanceof SC.Object)for(v=f.get("length")-1;v>=0;v--)l=this.get(f.objectAt(v)),l&&(n.removeObserver(l,this,this.itemContentDidChange),n.addObserver(l,this,this.itemContentDidChange,d));else SC.Logger.error("SC.SegmentedView items may be Strings, Objects (ie. Hashes) or SC.Objects only");a=NO;if(SC.isArray(u)?u.indexOf(n.get(this.get("itemValueKey")))>=0:u===n.get(this.get("itemValueKey")))a=YES;s.set("isSelected",a),s.setIfChanged("isEnabled",m),s.set("index",d),s.set("isFirstSegment",d===0),s.set("isMiddleSegment",d<e.get("length")-1&&d>0),s.set("isLastSegment",d===e.get("length")-1),s.updateItem(this,n)}this.get("shouldHandleOverflow")&&this.invokeLast(this.remeasure)}.observes("*items.[]"),itemContentDidChange:function(e,t,n,r){var i=this.get("items"),s=this.get("childViews"),o;o=s.objectAt(r),o?o.updateItem(this,e):SC.Logger.warn("Item content change was observed on item without matching segment child view."),this.get("shouldHandleOverflow")&&this.invokeLast(this.remeasure)},viewDidResize:function(){var e=this
.$().width();this.get("shouldHandleOverflow")&&(this.isOverflowing||e<=this.cachedMinimumWidth)&&this.adjustOverflow()},isVisibleInWindowDidChange:function(){this.get("shouldHandleOverflow")&&this.invokeLast(this.remeasure)}.observes("isVisibleInWindow"),remeasure:function(){if(!this.get("shouldHandleOverflow"))return;var e=this.get("renderDelegate"),t=this.get("childViews"),n;if(this.get("isVisibleInWindow")){n=t.lastObject(),n.set("isVisible",YES);for(var r=t.get("length")-1;r>=0;r--)t.objectAt(r).set("isVisible",YES);this.cachedWidths=e.segmentWidths(this),this.cachedOverflowWidth=e.overflowSegmentWidth(this),this.adjustOverflow()}},adjustOverflow:function(){if(!this.get("shouldHandleOverflow"))return;var e=this.get("childViews"),t,n=this.get("value"),r=e.lastObject(),i=this.$().width(),s=0,o,u,a;this.isOverflowing=NO,r.set("isSelected",NO),this.overflowItems=[],u=this.cachedWidths.length;for(a=0;a<u;a++)t=e.objectAt(a),s+=this.cachedWidths[a],o=a===u-1?s:s+this.cachedOverflowWidth,o>i?(this.overflowItems.pushObject(t.get("localItem")),this.isOverflowing=YES,t.set("isVisible",NO),a===0&&r.set("isFirstSegment",YES),(SC.isArray(n)?n.indexOf(t.get("value"))>=0:n===t.get("value"))&&r.set("isSelected",YES)):(t.set("isVisible",YES),a===0&&r.set("isFirstSegment",NO));this.isOverflowing?r.set("isVisible",YES):r.set("isVisible",NO),this.cachedMinimumWidth=s+this.cachedOverflowWidth},displayProperties:["align"],renderDelegateName:"segmentedRenderDelegate",displayItemIndexForEvent:function(e){var t=this.get("renderDelegate");if(t&&t.indexForClientPosition){var n=e.clientX,r=e.clientY
;if(n===0&&r===0){var i=e.target;if(i){var s=SC.offset(i);n=s.x+Math.round(i.offsetWidth/2),r=s.y+Math.round(i.offsetHeight/2)}}return t.indexForClientPosition(this,n,r)}},keyDown:function(e){var t,n,r,i,s,o;if(e.which===9||e.keyCode===9){var u=e.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");return u?u.becomeFirstResponder():e.allowDefault(),YES}if(!this.get("allowsMultipleSelection")){t=this.get("childViews"),i=t.get("length"),s=this.get("value"),o=SC.isArray(s);if(e.which===39||e.which===40){if(s)for(r=0;r<i-2;r++){n=t.objectAt(r);if(o?s.indexOf(n.get("value"))>=0:n.get("value")===s)this.triggerItemAtIndex(r+1),this._focusSelectedChildView()}else this.triggerItemAtIndex(0),this._focusSelectedChildView();return YES}if(e.which===37||e.which===38){if(s)for(r=1;r<i-1;r++){n=t.objectAt(r);if(o?s.indexOf(n.get("value"))>=0:n.get("value")===s)this.triggerItemAtIndex(r-1),this._focusSelectedChildView()}else this.triggerItemAtIndex(i-2),this._focusSelectedChildView();return YES}}return NO},mouseDown:function(e){var t=this.get("childViews"),n,r=t.get("length")-1,i;return this.get("isEnabled")?(i=this.displayItemIndexForEvent(e),i>=0&&(n=t.objectAt(i),n.set("isActive",YES),this.activeChildView=n,i===r?this.showOverflowMenu():this._isMouseDown=YES),YES):YES},mouseUp:function(e){var t,n;return n=this.displayItemIndexForEvent(e),this._isMouseDown&&n>=0&&(this.triggerItemAtIndex(n),this.becomeFirstResponder(),this._focusSelectedChildView(),t=this.activeChildView,t&&(t.set("isActive",NO),this.activeChildView=null)),this._isMouseDown=NO,YES},mouseMoved:function(e){
var t=this.get("childViews"),n=t.get("length")-1,r,i,s;return this._isMouseDown&&(s=this.displayItemIndexForEvent(e),r=this.activeChildView,i=t.objectAt(s),i&&i!==r&&(r&&r.set("isActive",NO),i.set("isActive",YES),this.activeChildView=i,s===n&&(this.showOverflowMenu(),this._isMouseDown=NO))),YES},mouseEntered:function(e){var t=this.get("childViews"),n,r=t.get("length")-1,i;return this._isMouseDown&&(i=this.displayItemIndexForEvent(e),i===r?(this.showOverflowMenu(),this._isMouseDown=NO):i>=0&&(n=t.objectAt(i),n.set("isActive",YES),this.activeChildView=n)),YES},mouseExited:function(e){var t;return this._isMouseDown&&(t=this.activeChildView,t&&t.set("isActive",NO),this.activeChildView=null),YES},touchStart:function(e){var t=this.get("childViews"),n,r=t.get("length")-1,i;return this.get("isEnabled")?(i=this.displayItemIndexForEvent(e),i>=0&&(n=t.objectAt(i),n.set("isActive",YES),this.activeChildView=n,i===r?this.showOverflowMenu():this._isTouching=YES),YES):YES},touchEnd:function(e){var t,n;return n=this.displayItemIndexForEvent(e),this._isTouching&&n>=0&&(this.triggerItemAtIndex(n),this.becomeFirstResponder(),this._focusSelectedChildView(),t=this.activeChildView,t.set("isActive",NO),this.activeChildView=null,this._isTouching=NO),YES},touchesDragged:function(e,t){var n=this.touchIsInBoundary(e),r=this.get("childViews"),i=r.get("length")-1,s,o,u;return n?(this._isTouching||this._touchDidEnter(e),u=this.displayItemIndexForEvent(e),s=this.activeChildView,o=r[u],o&&o!==s&&(s&&s.set("isActive",NO),o.set("isActive",YES),this.activeChildView=o,u===i&&(this.showOverflowMenu(),this._isMouseDown=
NO))):this._isTouching&&this._touchDidExit(e),this._isTouching=n,YES},_touchDidExit:function(e){var t;return this.isTouching&&(t=this.activeChildView,t.set("isActive",NO),this.activeChildView=null),YES},_touchDidEnter:function(e){var t=this.get("childViews"),n,r=t.get("length")-1,i;return i=this.displayItemIndexForEvent(e),i===r?(this.showOverflowMenu(),this._isTouching=NO):i>=0&&(n=t.objectAt(i),n.set("isActive",YES),this.activeChildView=n),YES},triggerItemAtIndex:function(e){var t=this.get("childViews"),n,r,i,s,o,u;n=t.objectAt(e);if(!n.get("isEnabled"))return this;o=this.get("allowsEmptySelection"),u=this.get("allowsMultipleSelection"),r=n.get("value"),i=s=this.get("value"),SC.empty(i)?i=[]:SC.isArray(i)||(i=[i]);if(!u)o&&i.get("length")===1&&i.objectAt(0)===r?i=[]:i=[r];else if(i.indexOf(r)>=0){if(i.get("length")>1||i.objectAt(0)!==r||o)i=i.without(r)}else i=i.concat([r]);switch(i.get("length")){case 0:i=null;break;case 1:i=i.objectAt(0);break;default:}var a=this.get("itemActionKey"),f=this.get("itemTargetKey"),l,c=null,h=this.getPath("pane.rootResponder"),p;a&&(p=this.get("items").objectAt(e))&&(l=p.get?p.get(a):p[a],f&&(c=p.get?p.get(f):p[f]),h&&h.sendAction(l,c,this,this.get("pane"))),s!==undefined&&(!l||this.get("selectSegmentWhenTriggeringAction"))&&this.set("value",i),l=this.get("action"),l&&h&&h.sendAction(l,this.get("target"),this,this.get("pane"))},selectOverflowItem:function(e){var t=e.get("selectedItem");this.triggerItemAtIndex(t.get("index")),e.removeObserver("selectedItem",this,"selectOverflowItem"),this.activeChildView.set("isActive",NO),this.activeChildView=
null},showOverflowMenu:function(){var e=this.get("childViews"),t=e.get("length")-1,n=this.overflowItems,r,i,s,o;r=n.get("length"),i=e.get("length")-1-r,o=this.get("value"),s=SC.isArray(o);for(var u=0;u<r;u++){var a=n.objectAt(u),f=this.get("itemValueKey");(s?o.indexOf(a.get(f))>=0:o===a.get(f))?a.set("isChecked",YES):a.set("isChecked",NO),a.set("index",i+u)}var l=this,c=SC.MenuPane.create({layout:{width:200},items:n,itemTitleKey:this.get("itemTitleKey"),itemIconKey:this.get("itemIconKey"),itemIsEnabledKey:this.get("itemIsEnabledKey"),itemKeyEquivalentKey:this.get("itemKeyEquivalentKey"),itemCheckboxKey:"isChecked",modalPaneDidClick:function(){arguments.callee.base.apply(this,arguments),this.removeObserver("selectedItem",l,"selectOverflowItem"),l.activeChildView.set("isActive",NO),l.activeChildView=null}}),h=this.get("layer"),p=h.childNodes[h.childNodes.length-1];c.popup(p),c.addObserver("selectedItem",this,"selectOverflowItem")},valueDidChange:function(){var e=this.get("value"),t,n=this.get("childViews"),r=Infinity,i=n.lastObject(),s,o;this.overflowItems&&(t=this.overflowItems.get("length"),r=n.get("length")-1-t,i.set("isSelected",NO));for(var u=n.get("length")-2;u>=0;u--)s=n.objectAt(u),(SC.isArray(e)?e.indexOf(s.get("value"))>=0:e===s.get("value"))?(s.set("isSelected",YES),u>=r&&i.set("isSelected",YES)):s.set("isSelected",NO)}.observes("value"),isEnabledDidChange:function(){var e=this.childViews,t=this.get("isEnabled");for(var n=0,r=e.length;n<r;n++)e[n].setIfChanged("isEnabled",t)}.observes("isEnabled")}),SC.SelectView=SC.ButtonView.extend({acceptsFirstResponder:function(
){return this.get("isEnabled")}.property("isEnabled"),items:[],itemsBindingDefault:SC.Binding.multiple(),itemTitleKey:null,itemSortKey:null,itemValueKey:null,itemIconKey:null,itemSeparatorKey:"separator",itemIsEnabledKey:"isEnabled",localize:YES,disableSort:YES,classNames:["sc-select-view"],menu:null,_itemList:[],_itemIdx:null,value:null,checkboxEnabled:YES,showCheckbox:YES,_defaultVal:null,_defaultTitle:null,_defaultIcon:null,themeName:"dropdown",displayProperties:["icon","value","controlSize","items","titleForMixedValues"],preferMatrix:null,CUSTOM_MENU_ITEM_HEIGHT:20,isActiveBinding:"*menu.isVisibleInWindow",isDefaultPosition:NO,lastMenuWidth:null,exampleView:null,customViewMenuOffsetWidth:0,needsEllipsis:YES,menuPaneHeightPadding:0,menuItemPadding:37,isContextMenuEnabled:NO,supportFocusRing:YES,leftAlign:function(){switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:return SC.SelectView.TINY_OFFSET_X;case SC.SMALL_CONTROL_SIZE:return SC.SelectView.SMALL_OFFSET_X;case SC.REGULAR_CONTROL_SIZE:return SC.SelectView.REGULAR_OFFSET_X;case SC.LARGE_CONTROL_SIZE:return SC.SelectView.LARGE_OFFSET_X;case SC.HUGE_CONTROL_SIZE:return SC.SelectView.HUGE_OFFSET_X}return 0}.property("controlSize"),sortObjects:function(e){if(!this.get("disableSort")){var t=this.get("itemSortKey")||this.get("itemTitleKey");e=e.sort(function(e,n){return t&&(e=e.get?e.get(t):e[t],n=n.get?n.get(t):n[t]),e<n?-1:e>n?1:0})}return e},render:function(e,t){arguments.callee.base.apply(this,arguments);var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E;r=this.get("items"),r=this.sortObjects(r),i=r.length,s=this.get("itemTitleKey"
),o=this.get("itemIconKey"),u=this.get("itemValueKey"),a=this.get("itemSeparatorKey"),f=this.get("showCheckbox"),E=this.get("itemIsEnabledKey"),l=this.get("value"),c=this.get("localize"),p=[],d=YES,v=0;var S=null;r.forEach(function(e){if(e||e===0){m=s?e.get?e.get(s):e[s]:e.toString(),m=c?SC.String.loc(m):m,g=o?e.get?e.get(o):e[o]:null,SC.none(e[o])&&(g=null),y=u?e.get?e.get(u):e[u]:e,!SC.none(l)&&!SC.none(y)&&l===y&&(this.set("title",m),this.set("icon",g)),y===this.get("value")?(S=v,d=f?YES:NO):d=NO,w=e.get?e.get(E):e[E],NO!==w&&(w=YES),h=a?e.get?e.get(a):e[a]:NO,v===0&&(this._defaultVal=y,this._defaultTitle=m,this._defaultIcon=g);var t=SC.Object.create({separator:h,title:m,icon:g,value:y,isEnabled:w,checkbox:d,target:this,action:"displaySelectedItem"});p.push(t)}v+=1,this.set("_itemList",p)},this),this.set("_itemIdx",S),t&&this.invokeLast(function(){var e=this.get("value");SC.none(e)&&(this.set("value",this._defaultVal),this.set("title",this._defaultTitle),this.set("icon",this._defaultIcon))}),this.changeSelectPreferMatrix(this.get("_itemIdx"))},_action:function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g=0,y=this.get("controlSize"),b=this.getPath("theme.classNames").toArray().join(" "),w=this.$(".sc-button-label")[0],E=SC.SelectView.MENU_WIDTH_OFFSET;if(!this.get("isDefaultPosition"))switch(y){case SC.TINY_CONTROL_SIZE:E+=SC.SelectView.TINY_POPUP_MENU_WIDTH_OFFSET,m=SC.SelectView.TINY_ICON_PADDING;break;case SC.SMALL_CONTROL_SIZE:E+=SC.SelectView.SMALL_POPUP_MENU_WIDTH_OFFSET,m=SC.SelectView.SMALL_ICON_PADDING;break;case SC.REGULAR_CONTROL_SIZE:E+=SC.SelectView.REGULAR_POPUP_MENU_WIDTH_OFFSET
,m=SC.SelectView.REGULAR_ICON_PADDING;break;case SC.LARGE_CONTROL_SIZE:E+=SC.SelectView.LARGE_POPUP_MENU_WIDTH_OFFSET,m=SC.SelectView.LARGE_ICON_PADDING;break;case SC.HUGE_CONTROL_SIZE:E+=SC.SelectView.HUGE_POPUP_MENU_WIDTH_OFFSET,m=SC.SelectView.HUGE_ICON_PADDING}t=this.get("layer").offsetWidth+E,t=this.get("layer").offsetWidth,n=w.scrollWidth,r=this.get("lastMenuWidth"),n&&(i=w.offsetWidth,n&&i&&(t=t+n-i));if(!r||t>r)r=t;s=this.get("_itemList");var S=this.get("customViewClassName"),x=this.get("customViewMenuOffsetWidth"),T="sc-view sc-pane sc-panel sc-palette sc-picker sc-menu select-button sc-scroll-view sc-menu-scroll-view sc-container-view menuContainer sc-button-view sc-menu-item "+b+" "+y;T=S?T+" "+S:T,SC.prepareStringMeasurement("",T);for(a=0,d=s.length;a<d;++a)u=s.objectAt(a),o=SC.measureString(u.title).width,u.icon&&(o+=m),o>g&&(g=o);SC.teardownStringMeasurement(),r=g+this.menuItemPadding>r?g+this.menuItemPadding:r;var N=SC.RootResponder.responder.get("currentWindowSize").width;return r>N&&(r=N-25),this.set("lastMenuWidth",r),f=this.get("value"),l=this.get("_itemList"),c=this.get("menuPaneHeightPadding"),h=this.get("exampleView")||SC.MenuItemView,p=SC.MenuPane.create({classNames:["select-button"],baseTheme:this.get("theme"),items:l,exampleView:h,isEnabled:YES,menuHeightPadding:c,preferType:SC.PICKER_MENU,layout:{width:r},controlSize:y,itemWidth:r}),p?(p.popup(this,this.preferMatrix),this.set("menu",p),v=this._itemIdx,!SC.empty(v)&&v>-1&&(h=p.menuItemViewForContentIndex(v),h&&(h.becomeFirstResponder(),h.scrollToVisible())),this.set("isActive",YES),YES):NO},displaySelectedItem
:function(e){var t=e.get("selectedItem");this.set("value",t.get("value")),this.set("title",t.get("title")),this.set("_itemIdx",t.get("contentIndex"))},changeSelectPreferMatrix:function(){var e=0,t=0;switch(this.get("controlSize")){case SC.TINY_CONTROL_SIZE:e=SC.SelectView.TINY_OFFSET_Y,t=SC.MenuPane.TINY_MENU_ITEM_HEIGHT;break;case SC.SMALL_CONTROL_SIZE:e=SC.SelectView.SMALL_OFFSET_Y,t=SC.MenuPane.SMALL_MENU_ITEM_HEIGHT;break;case SC.REGULAR_CONTROL_SIZE:e=SC.SelectView.REGULAR_OFFSET_Y,t=SC.MenuPane.REGULAR_MENU_ITEM_HEIGHT;break;case SC.LARGE_CONTROL_SIZE:e=SC.SelectView.LARGE_OFFSET_Y,t=SC.MenuPane.LARGE_MENU_ITEM_HEIGHT;break;case SC.HUGE_CONTROL_SIZE:e=SC.SelectView.HUGE_OFFSET_Y,t=SC.MenuPane.HUGE_MENU_ITEM_HEIGHT}var n=e,r=this.get("_itemIdx"),i=this.get("leftAlign"),s,o;this.get("isDefaultPosition")?(s=[1,0,3],this.set("preferMatrix",s)):(r&&(n=r*t+e),o=[i,-n,2],this.set("preferMatrix",o))},mouseDown:function(e){if(!this.get("isEnabled"))return YES;this.set("isActive",YES),this._isMouseDown=YES,this.becomeFirstResponder(),this._action();var t=this;return t._mouseDownTimestamp=0,setTimeout(function(){t._mouseDownTimestamp=SC.getCurrentTimeForPerformance()},1),YES},mouseUp:function(e){var t=this.get("menu"),n,r;return t&&(n=t.getPath("rootMenu.targetMenuItem"),this._mouseDownTimestamp===0&&(this._mouseDownTimestamp=SC.getCurrentTimeForPerformance()),SC.getCurrentTimeForPerformance()-this._mouseDownTimestamp>400&&(n&&t.get("mouseHasEntered")&&this._mouseDownTimestamp?n.performAction()||t.remove():t.remove())),this._mouseDownTimestamp=undefined,this._isMouseDown=NO,this.
set("isActive",NO),YES},mouseExited:function(){return YES},keyDown:function(e){if(e.which===9||e.keyCode===9){var t=e.shiftKey?this.get("previousValidKeyView"):this.get("nextValidKeyView");return t?t.becomeFirstResponder():e.allowDefault(),YES}return this.interpretKeyEvents(e)?YES:e.keyCode===13?NO:arguments.callee.base.apply(this,arguments)},interpretKeyEvents:function(e){return e&&(e.keyCode===38||e.keyCode===40?this._action():e.keyCode===27&&this.resignFirstResponder()),arguments.callee.base.apply(this,arguments)},_button_isSelectedDidChange:function(){}.observes("isSelected")}),SC.SelectView.TINY_OFFSET_X=0,SC.SelectView.TINY_OFFSET_Y=0,SC.SelectView.TINY_POPUP_MENU_WIDTH_OFFSET=0,SC.SelectView.SMALL_OFFSET_X=-18,SC.SelectView.SMALL_OFFSET_Y=3,SC.SelectView.SMALL_POPUP_MENU_WIDTH_OFFSET=7,SC.SelectView.REGULAR_OFFSET_X=-22,SC.SelectView.REGULAR_OFFSET_Y=0,SC.SelectView.REGULAR_POPUP_MENU_WIDTH_OFFSET=4,SC.SelectView.LARGE_OFFSET_X=-30,SC.SelectView.LARGE_OFFSET_Y=0,SC.SelectView.LARGE_POPUP_MENU_WIDTH_OFFSET=3,SC.SelectView.HUGE_OFFSET_X=0,SC.SelectView.HUGE_OFFSET_Y=0,SC.SelectView.HUGE_POPUP_MENU_WIDTH_OFFSET=0,SC.SelectView.MENU_WIDTH_OFFSET=-2,SC.SelectView.TINY_ICON_PADDING=16,SC.SelectView.SMALL_ICON_PADDING=16,SC.SelectView.REGULAR_ICON_PADDING=16,SC.SelectView.LARGE_ICON_PADDING=20,SC.SelectView.HUGE_ICON_PADDING=24,SC.SourceListGroupView=SC.View.extend(SC.Control,SC.CollectionGroup,{classNames:["sc-source-list-group"],content:null,isGroupVisible:YES,hasGroupTitle:YES,groupTitleKey:null,groupVisibleKey:null,render:function(e,t){e.push('<div role="button" class="sc-source-list-label sc-disclosure-view sc-button-view button disclosure no-disclosure">'
,'<img src="'+SC.BLANK_IMAGE_URL+'" class="button" />','<span class="label"></span></div>')},createChildViews:function(){},contentPropertyDidChange:function(e,t){var n=this.get("content"),r=this.outlet("labelView");if(n===null){r.setIfChanged("isVisible",NO),this.setIfChanged("hasGroupTitle",NO);return}r.setIfChanged("isVisible",YES),this.setIfChanged("hasGroupTitle",YES);var i=this.getDelegateProperty("groupTitleKey",this.displayDelegate);if(t=="*"||i&&t==i){var s=n&&n.get&&i?n.get(i):n;s!=this._title&&(this._title=s,s&&(s=s.capitalize()),r.set("title",s))}var o=this.getDelegateProperty("groupVisibleKey",this.displayDelegate);if(t=="*"||o&&t==o)if(o){r.removeClassName("no-disclosure");var u=n&&n.get?!!n.get(o):YES;u!=this.get("isGroupVisible")&&(this.set("isGroupVisible",u),r.set("value",u))}else r.addClassName("no-disclosure")},disclosureValueDidChange:function(e){if(e==this.get("isGroupVisible"))return;var t=this.get("content"),n=this.getDelegateProperty("groupVisibleKey",this.displayDelegate);t&&t.set&&n&&t.set(n,e),this.set("isGroupVisible",e),this.owner&&this.owner.updateChildren&&this.owner.updateChildren(!0)},labelView:SC.DisclosureView.extend({value:YES,_valueObserver:function(){this.owner&&this.owner.disclosureValueDidChange(this.get("value"))}.observes("value")})}),SC.SourceListView=SC.ListView.extend({themeName:"source-list",classNames:["sc-source-list"],rowHeight:32,selectOnMouseDown:NO,actOnSelect:YES}),SC.StackedView=SC.CollectionView.extend({classNames:["sc-stacked-view"],layout:{top:0,left:0,right:0,height:1},computeNowShowing:function(e){return this.get("allContentIndexes"
)},updateHeight:function(e){return e?this._updateHeight():this.invokeLast(this._updateHeight),this},_updateHeight:function(){var e=this.get("childViews"),t=e.get("length"),n,r,i;t===0?i=1:(n=e.objectAt(t-1),r=n?n.get("layer"):null,i=r?r.offsetTop+r.offsetHeight:1,r=null),this.adjust("height",i)},didReload:function(e){return this.updateHeight()},didCreateLayer:function(){return this.updateHeight()}}),SC.StaticContentView=SC.View.extend(SC.StaticLayout,{classNames:["sc-static-content-view"],displayProperties:["content"],content:null,contentLayoutDidChange:function(){this._viewFrameDidChange()},useStaticLayout:YES,frame:function(){var e=this.get("layer"),t;return e?e.getBoundingClientRect&&!SC.browser.isIE8OrLower?(t=e.getBoundingClientRect(),{x:0,y:0,width:t.width,height:t.height}):{x:0,y:0,width:e.clientWidth,height:e.clientHeight}:{x:0,y:0,width:0,height:0}}.property("content").cacheable(),parentViewDidResize:function(){this.contentLayoutDidChange()},didUpdateLayer:function(){this.contentLayoutDidChange()},render:function(e,t){var n=this.get("content");n&&e.push(n||"")},touchStart:function(e){return e.allowDefault(),YES},touchEnd:function(e){return e.allowDefault(),YES}}),SC.WebView=SC.View.extend(SC.Control,{classNames:"sc-web-view",displayProperties:["value","shouldAutoResize"],shouldAutoResize:NO,render:function(e,t){var n=this.get("value"),r;t?e.push('<iframe src="'+n+'" style="position: absolute; width: 100%; height: 100%; border: 0px; margin: 0px; padding: 0px;"></iframe>'):n!==this._lastSrc&&(r=this.$("iframe"),r.attr("src","javascript:;"),r.attr("src",n)),this._lastSrc=
n},didCreateLayer:function(){var e=this.$("iframe");SC.Event.add(e,"load",this,this.iframeDidLoad)},willDestroyLayer:function(){var e=this.$("iframe");SC.Event.remove(e,"load",this,this.iframeDidLoad)},iframeDidLoad:function(){if(this.get("shouldAutoResize")===YES){var e,t=this.$("iframe")[0];if(t&&t.contentWindow){e=t.contentWindow;if(e&&e.document&&e.document.documentElement){var n=e.document.documentElement;SC.browser.isIE?(this.$().width(n.scrollWidth+12),this.$().height(n.scrollHeight+5)):(this.$().width(n.scrollWidth),this.$().height(n.scrollHeight))}}}}}),SC.WELL_CONTAINER_PADDING=15,SC.WellView=SC.ContainerView.extend({classNames:"sc-well-view",contentLayout:{top:SC.WELL_CONTAINER_PADDING,bottom:SC.WELL_CONTAINER_PADDING,left:SC.WELL_CONTAINER_PADDING,right:SC.WELL_CONTAINER_PADDING},renderDelegateName:"wellRenderDelegate",createChildViews:function(){var e=this.get("contentView");e&&(e=this.contentView=this.createChildView(e),e.set("layout",this.contentLayout),this.childViews=[e])},contentViewDidChange:function(){var e=this.get("contentView");e.set("layout",this.contentLayout),this.replaceContent(e)}.observes("contentView")}),SC.MIXED_STATE="__MIXED__",SC.DataSource=SC.Object.extend({fetch:function(e,t){return NO},retrieveRecords:function(e,t,n){return this._handleEach(e,t,this.retrieveRecord,n)},commitRecords:function(e,t,n,r,i){var s,o,u;return t.length>0&&(u=this.createRecords.call(this,e,t,i)),n.length>0&&(s=this.updateRecords.call(this,e,n,i),u=SC.none(u)?s:u===s?u:SC.MIXED_STATE),r.length>0&&(o=this.destroyRecords.call(this,e,r,i),u=SC.none(u)?o:u===o?u:SC.MIXED_STATE
),u||NO},cancel:function(e,t){return NO},updateRecords:function(e,t,n){return this._handleEach(e,t,this.updateRecord,null,n)},createRecords:function(e,t,n){return this._handleEach(e,t,this.createRecord,null,n)},destroyRecords:function(e,t,n){return this._handleEach(e,t,this.destroyRecord,null,n)},_handleEach:function(e,t,n,r,i){var s=t.length,o,u,a,f;for(o=0;o<s;o++)f=r?r[o]:i,a=n.call(this,e,t[o],f),u===undefined?u=a:u===YES?u=a===YES?YES:SC.MIXED_STATE:u===NO&&(u=a===NO?NO:SC.MIXED_STATE);return SC.none(u)?null:u},updateRecord:function(e,t,n){return NO},retrieveRecord:function(e,t,n){return NO},createRecord:function(e,t,n){return NO},destroyRecord:function(e,t,n){return NO}}),SC.CascadeDataSource=SC.DataSource.extend({dataSources:null,from:function(e){var t=this.get("dataSources");return t||this.set("dataSources",t=[]),t.push(e),this},fetch:function(e,t){var n=this.get("dataSources"),r=n?n.length:0,i=NO,s,o,u;for(u=0;i!==YES&&u<r;u++)o=n.objectAt(u),s=o.fetch?o.fetch.apply(o,arguments):NO,i=this._handleResponse(i,s);return i},retrieveRecords:function(e,t,n){var r=this.get("dataSources"),i=r?r.length:0,s=NO,o,u,a;for(a=0;s!==YES&&a<i;a++)u=r.objectAt(a),o=u.retrieveRecords.apply(u,arguments),s=this._handleResponse(s,o);return s},commitRecords:function(e,t,n,r,i){var s=this.get("dataSources"),o=s?s.length:0,u=NO,a,f,l;for(l=0;u!==YES&&l<o;l++)f=s.objectAt(l),a=f.commitRecords.apply(f,arguments),u=this._handleResponse(u,a);return u},cancel:function(e,t){var n=this.get("dataSources"),r=n?n.length:0,i=NO,s,o,u;for(u=0;i!==YES&&u<r;u++)o=n.objectAt(u),s=o.cancel.apply(o,arguments
),i=this._handleResponse(i,s);return i},init:function(){arguments.callee.base.apply(this,arguments);var e=this.get("dataSources"),t=e?e.get("length"):0,n;while(--t>=0)n=e[t],SC.typeOf(n)===SC.T_STRING&&(e[t]=this.get(n))},_handleResponse:function(e,t){return t===YES?YES:e===NO?t===NO?NO:SC.MIXED_STATE:SC.MIXED_STATE}}),SC.Query=SC.Object.extend(SC.Copyable,SC.Freezable,{isQuery:YES,conditions:null,orderBy:null,recordType:null,recordTypes:null,expandedRecordTypes:function(){var e=SC.CoreSet.create(),t,n;return(t=this.get("recordType"))?this._scq_expandRecordType(t,e):(t=this.get("recordTypes"))?t.forEach(function(t){this._scq_expandRecordType(t,e)},this):this._scq_expandRecordType(SC.Record,e),n=SC.Query._scq_queriesWithExpandedRecordTypes,n||(n=SC.Query._scq_queriesWithExpandedRecordTypes=SC.CoreSet.create()),n.add(this),e.freeze()}.property("recordType","recordTypes").cacheable(),_scq_expandRecordType:function(e,t){if(t.contains(e))return;t.add(e),SC.typeOf(e)===SC.T_STRING&&(e=SC.objectForPropertyPath(e)),e.subclasses.forEach(function(e){this._scq_expandRecordType(e,t)},this)},parameters:null,location:"local",scope:null,isRemote:function(){return this.get("location")===SC.Query.REMOTE}.property("location").cacheable(),isLocal:function(){return this.get("location")===SC.Query.LOCAL}.property("location").cacheable(),isEditable:NO,contains:function(e,t){var n,r=YES;if(n=this.get("recordTypes"))r=n.find(function(t){return SC.kindOf(e,t)});else if(n=this.get("recordType"))r=SC.kindOf(e,n);if(!r)return NO;var i=this.get("scope");return i&&!i.contains(e)?NO:(this._isReady||this.parse
(),this._isReady?(t===undefined&&(t=this.parameters||this),this._tokenTree.evaluate(e,t)):NO)},containsRecordTypes:function(e){var t=this.get("recordType");return t?!!e.find(function(e){return SC.kindOf(e,t)}):(t=this.get("recordTypes"))?!!t.find(function(t){return!!e.find(function(e){return SC.kindOf(e,t)})}):YES},compare:function(e,t){var n=0,r,i,s,o;if(e===t)return 0;this._isReady||this.parse();if(!this._isReady)return SC.compare(e.get("id"),t.get("id"));i=this._order;if(SC.typeOf(i)===SC.T_FUNCTION)n=i.call(null,e,t);else{s=i?i.length:0;for(o=0;n===0&&o<s;o++)r=i[o].propertyName,SC.Query.comparisons[r]?n=SC.Query.comparisons[r](e.get(r),t.get(r)):n=SC.compare(e.get(r),t.get(r)),n!==0&&i[o].descending&&(n=-1*n)}return n!==0?n:SC.compare(e.get("id"),t.get("id"))},_isReady:NO,parse:function(){var e=this.get("conditions"),t=this.get("queryLanguage"),n,r;n=this._tokenList=this.tokenizeString(e,t),r=this._tokenTree=this.buildTokenTree(n,t),this._order=this.buildOrder(this.get("orderBy")),this._isReady=!!r&&!r.error;if(r&&r.error)throw r.error;return this._isReady},queryWithScope:function(e){var t=SC.keyFor("__query__",SC.guidFor(this)),n=e[t];return n||(e[t]=n=this.copy(),n.set("scope",e),n.freeze()),n},copyKeys:["conditions","orderBy","recordType","recordTypes","parameters","location","scope"],concatenatedProperties:["copyKeys"],copy:function(){var e={},t=this.get("copyKeys"),n=t?t.length:0,r,i,s;while(--n>=0)r=t[n],i=this.get(r),i!==undefined&&(e[r]=i);return s=this.constructor.create(e),e=null,s},queryLanguage:{UNKNOWN:{firstCharacter:/[^\s'"\w\d\(\)\{\}]/,notAllowed:/[\-\s'"\w\d\(\)\{\}]/
},PROPERTY:{firstCharacter:/[a-zA-Z_]/,notAllowed:/[^a-zA-Z_0-9\.]/,evalType:"PRIMITIVE",evaluate:function(e,t){var n=this.tokenValue.split("."),r=n.length;if(r<2)return e.get(this.tokenValue);var i=e;for(var s=0;s<r;s++){if(!i)return;i.get?i=i.get(n[s]):i=i[n[s]]}return i}},NUMBER:{firstCharacter:/[\d\-]/,notAllowed:/[^\d\-\.]/,format:/^-?\d+$|^-?\d+\.\d+$/,evalType:"PRIMITIVE",evaluate:function(e,t){return parseFloat(this.tokenValue)}},STRING:{firstCharacter:/['"]/,delimeted:!0,evalType:"PRIMITIVE",evaluate:function(e,t){return this.tokenValue}},PARAMETER:{firstCharacter:/\{/,lastCharacter:"}",delimeted:!0,evalType:"PRIMITIVE",evaluate:function(e,t){return t[this.tokenValue]}},"%@":{rememberCount:!0,reservedWord:!0,evalType:"PRIMITIVE",evaluate:function(e,t){return t[this.tokenValue]}},OPEN_PAREN:{firstCharacter:/\(/,singleCharacter:!0},CLOSE_PAREN:{firstCharacter:/\)/,singleCharacter:!0},AND:{reservedWord:!0,leftType:"BOOLEAN",rightType:"BOOLEAN",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide.evaluate(e,t),r=this.rightSide.evaluate(e,t);return n&&r}},OR:{reservedWord:!0,leftType:"BOOLEAN",rightType:"BOOLEAN",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide.evaluate(e,t),r=this.rightSide.evaluate(e,t);return n||r}},NOT:{reservedWord:!0,rightType:"BOOLEAN",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.rightSide.evaluate(e,t);return!n}},"=":{reservedWord:!0,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide.evaluate(e,t),r=this.rightSide.evaluate(e,t);return SC.isEqual(n,r)}},"!=":{reservedWord
:!0,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide.evaluate(e,t),r=this.rightSide.evaluate(e,t);return!SC.isEqual(n,r)}},"<":{reservedWord:!0,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide.evaluate(e,t),r=this.rightSide.evaluate(e,t);return SC.compare(n,r)==-1}},"<=":{reservedWord:!0,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide.evaluate(e,t),r=this.rightSide.evaluate(e,t);return SC.compare(n,r)!=1}},">":{reservedWord:!0,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide.evaluate(e,t),r=this.rightSide.evaluate(e,t);return SC.compare(n,r)==1}},">=":{reservedWord:!0,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide.evaluate(e,t),r=this.rightSide.evaluate(e,t);return SC.compare(n,r)!=-1}},BEGINS_WITH:{reservedWord:!0,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide.evaluate(e,t),r=this.rightSide.evaluate(e,t);return n&&n.indexOf(r)===0}},ENDS_WITH:{reservedWord:!0,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide.evaluate(e,t),r=this.rightSide.evaluate(e,t);return n&&n.indexOf(r)===n.length-r.length}},CONTAINS:{reservedWord:!0,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide.evaluate(e,t)||[],r=this.rightSide.evaluate(e,t),i=SC.typeOf(
n);if(i===SC.T_STRING)return n.indexOf(r)!==-1;if(i===SC.T_ARRAY||n.toArray){i!==SC.T_ARRAY&&(n=n.toArray());var s=!1,o=0;while(s===!1&&o<n.length)r==n[o]&&(s=!0),o++;return s}}},ANY:{reservedWord:!0,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide.evaluate(e,t),r=this.rightSide.evaluate(e,t),i=!1,s=0;while(i===!1&&s<r.length)n==r[s]&&(i=!0),s++;return i}},MATCHES:{reservedWord:!0,leftType:"PRIMITIVE",rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,t){var n=this.leftSide.evaluate(e,t),r=this.rightSide.evaluate(e,t);return r.test(n)}},TYPE_IS:{reservedWord:!0,rightType:"PRIMITIVE",evalType:"BOOLEAN",evaluate:function(e,t){var n=SC.Store.recordTypeFor(e.storeKey),r=this.rightSide.evaluate(e,t),i=SC.objectForPropertyPath(r);return n==i}},"null":{reservedWord:!0,evalType:"PRIMITIVE",evaluate:function(e,t){return null}},"undefined":{reservedWord:!0,evalType:"PRIMITIVE",evaluate:function(e,t){return undefined}},"false":{reservedWord:!0,evalType:"PRIMITIVE",evaluate:function(e,t){return!1}},"true":{reservedWord:!0,evalType:"PRIMITIVE",evaluate:function(e,t){return!0}},YES:{reservedWord:!0,evalType:"PRIMITIVE",evaluate:function(e,t){return!0}},NO:{reservedWord:!0,evalType:"PRIMITIVE",evaluate:function(e,t){return!1}}},tokenizeString:function(e,t){function m(e,r){i=t[e],i.format&&!i.format.test(r)&&(e="UNKNOWN"),i.delimeted&&(d=!0);if(!i.delimeted)for(var s in t)t[s].reservedWord&&s==r&&(e=s);i=t[e],i&&i.rememberCount&&(v[e]||(v[e]=0),r=v[e],v[e]+=1),n.push({tokenType:e,tokenValue:r}),u=null,a=null,f=null}var n=[],r=
null,i=null,s=null,o=null,u=null,a=null,f=null,l=null,c=!1,h=!1,p=!1,d=!1,v={};if(!e)return[];var g=e.length;for(var y=0;y<g;y++){c=y===g-1,r=e.charAt(y),d=!1,u&&(i=t[u],h=i.delimeted?r===l:i.notAllowed.test(r),h||(f+=r),(h||c)&&m(u,f),c&&!h&&(d=!0));if(!u&&!d){for(s in t)i=t[s],i.firstCharacter&&i.firstCharacter.test(r)&&(u=s);u&&(i=t[u],f=r,i.delimeted&&(f="",i.lastCharacter?l=i.lastCharacter:l=r),(i.singleCharacter||c)&&m(u,f))}}return n},buildTokenTree:function(e,t){function u(e){var r=e;if(r<0)return!1;var i=t[n[r].tokenType];return i?(n[r].evaluate=i.evaluate,i):(o.push("logic for token '"+n[r].tokenType+"' is not defined"),!1)}function a(e,t){var n=t,r=u(n);if(!r)return!1;if(e=="left")return r.leftType;if(e=="right")return r.rightType}function f(e){var t=e,n=u(t);return n?n.evalType:!1}function l(e){n.splice(e,1),e<=r&&r--}function c(e){var t=e||r;return t>0?!0:!1}function h(e){var t=e;return t<0?!0:a("left",t)&&!n[t].leftSide||a("right",t)&&!n[t].rightSide}function p(e,t){var n=t<e?"left":"right";return e<0||t<0?!1:a(n,e)?f(t)?a(n,e)==f(t)?!0:!1:!1:!1}function d(e){var t=e;return h(t)?c(t)?p(t,t-1)?!0:!1:!1:!1}function v(e){var t=e;return h(t)?!1:c(t)?h(t-1)?p(t-1,t)?!0:!1:!1:!1}function m(e){var t=e;if(t<1)return!1;n[t].leftSide=n[t-1],l(t-1)}function g(e){var t=e;if(t<1)return!1;n[t-1].rightSide=n[t],l(t)}function y(e){l(e),l(i.pop())}var n=e.slice(),r=0,i=[],s=!1,o=[];if(!e||e.length===0)return{evaluate:function(){return!0}};for(r=0;r<n.length;r++)s=!1,n[r].tokenType=="UNKNOWN"&&o.push("found unknown token: "+n[r].tokenValue),n[r].tokenType=="OPEN_PAREN"&&i.push(r
),n[r].tokenType=="CLOSE_PAREN"&&y(r),d(r)&&m(r),v(r)&&(g(r),s=!0),s&&r--;return n.length==1?n=n[0]:o.push("string did not resolve to a single tree"),o.length>0?{error:o.join(",\n"),tree:n}:n},buildOrder:function(e){if(!e)return[];if(SC.typeOf(e)===SC.T_FUNCTION)return e;var t=e.split(",");for(var n=0;n<t.length;n++){var r=t[n];r=r.replace(/^\s+|\s+$/,""),r=r.replace(/\s+/,","),r=r.split(","),t[n]={propertyName:r[0]},r[1]&&r[1]=="DESC"&&(t[n].descending=!0)}return t}}),SC.Query.mixin({LOCAL:"local",REMOTE:"remote",storeKeyFor:function(e){return e?e.get("storeKey"):null},containsRecords:function(e,t,n){var r=[];for(var i=0,s=t.get("length");i<s;i++){var o=t.objectAt(i);o&&e.contains(o)&&r.push(o.get("storeKey"))}return r=SC.Query.orderStoreKeys(r,e,n),r},orderStoreKeys:function(e,t,n){if(e)var r=e.sort(function(e,r){return SC.Query.compareStoreKeys(t,n,e,r)});return e},compareStoreKeys:function(e,t,n,r){var i=t.materializeRecord(n),s=t.materializeRecord(r);return e.compare(i,s)},build:function(e,t,n,r){var i=null,s,o,u,a;if(t&&t.isQuery)return t.get("location")===e?t:t.copy().set("location",e).freeze();if(typeof t===SC.T_STRING){s=SC.objectForPropertyPath(t);if(!s)throw"%@ did not resolve to a class".fmt(t);t=s}else t&&t.isEnumerable?(s=[],t.forEach(function(e){typeof e===SC.T_STRING&&(e=SC.objectForPropertyPath(e));if(!e)throw"cannot resolve record types: %@".fmt(t);s.push(e)},this),t=s):t||(t=SC.Record);return r===undefined&&(r=null),n===undefined&&(n=null),!r&&typeof n!==SC.T_STRING&&(i=n,n=null),!r&&!i?(a=SC.Query._scq_recordTypeCache,a||(a=SC.Query._scq_recordTypeCache={
}),o=a[e],o||(o=a[e]={}),t.isEnumerable?(u=t.map(function(e){return SC.guidFor(e)}),u=u.sort().join(":")):u=SC.guidFor(t),n&&(u=[u,n].join("::")),s=o[u],s||(t.isEnumerable?i={recordTypes:t.copy()}:i={recordType:t},i.location=e,i.conditions=n,s=o[u]=SC.Query.create(i).freeze())):(i||(i={}),i.location||(i.location=e),t&&t.isEnumerable?i.recordsTypes=t:i.recordType=t,n&&(i.conditions=n),r&&(i.parameters=r),s=SC.Query.create(i).freeze()),s},local:function(e,t,n){return this.build(SC.Query.LOCAL,e,t,n)},remote:function(e,t,n){return this.build(SC.Query.REMOTE,e,t,n)},_scq_didDefineRecordType:function(){var e=SC.Query._scq_queriesWithExpandedRecordTypes;e&&(e.forEach(function(e){e.notifyPropertyChange("expandedRecordTypes")},this),e.clear())}}),SC.Query.comparisons={},SC.Query.registerComparison=function(e,t){SC.Query.comparisons[e]=t},SC.Query.registerQueryExtension=function(e,t){SC.Query.prototype.queryLanguage[e]=t},SC.Q=SC.Query.from,SC.Record=SC.Object.extend({isRecord:YES,isParentRecord:NO,primaryKey:"guid",id:function(e,t){return t!==undefined?(this.writeAttribute(this.get("primaryKey"),t),t):SC.Store.idFor(this.storeKey)}.property("storeKey").cacheable(),status:function(){return this.store.readStatus(this.storeKey)}.property("storeKey").cacheable(),store:null,storeKey:null,isDestroyed:function(){return!!(this.get("status")&SC.Record.DESTROYED)}.property("status").cacheable(),isEditable:function(e,t){return t!==undefined&&(this._screc_isEditable=t),this.get("status")&SC.Record.READY?this._screc_isEditable:NO}.property("status").cacheable(),_screc_isEditable:YES,isLoaded:function(
){var e=SC.Record,t=this.get("status");return t!==e.EMPTY&&t!==e.BUSY_LOADING&&t!==e.ERROR}.property("status").cacheable(),relationships:null,attributes:function(){var e=this.get("store"),t=this.storeKey;return e.readEditableDataHash(t)}.property(),readOnlyAttributes:function(){var e=this.get("store"),t=this.storeKey,n=e.readDataHash(t);return n&&(n=SC.clone(n,YES)),n}.property(),nestedRecordNamespace:null,isNestedRecord:function(){var e=this.get("store"),t,n=this.get("storeKey"),r=e.parentStoreKeyExists(n);return t=r?YES:NO,t}.property().cacheable(),parentRecord:function(){var e=this.storeKey,t=this.get("store");return t.materializeParentRecord(e)}.property(),refresh:function(e,t){var n=this.get("store"),r,i,s=this.get("storeKey"),o=n.parentStoreKeyExists();return i=e||SC.none(e)&&SC.none(o),i?n.refreshRecord(null,null,s,t):o&&(r=n.materializeRecord(o),r.refresh(e,t)),this},destroy:function(e){var t=this.get("store"),n,r,i=this.get("storeKey"),s=t.parentStoreKeyExists();return r=e||SC.none(e)&&SC.none(s),r?(t.destroyRecord(null,null,i),this.notifyPropertyChange("status"),this.propagateToAggregates()):s&&(n=t.materializeRecord(s),n.destroy(e)),this},recordDidChange:function(e){var t=this.get("parentRecord");return t&&t.recordDidChange(),this.get("store").recordDidChange(null,null,this.get("storeKey"),e),this.notifyPropertyChange("status"),this.propagateToAggregates(),this},toJSON:function(){return this.get("attributes")},_editLevel:0,beginEditing:function(){return this._editLevel++,this},endEditing:function(e){return--this._editLevel<=0&&(this._editLevel=0,this.recordDidChange
(e)),this},readAttribute:function(e){var t=this.get("store"),n=this.storeKey,r=t.readDataHash(n);return r?r[e]:undefined},writeAttribute:function(e,t,n){var r=this.get("store"),i=this.storeKey,s;s=r.readEditableDataHash(i);if(!s)throw SC.Record.BAD_STATE_ERROR;return t!==s[e]&&(n||this.beginEditing(),s[e]=t,e===this.get("primaryKey")&&(SC.Store.replaceIdFor(i,t),this.propertyDidChange("id")),n||this.endEditing(e)),this},propagateToAggregates:function(){var e=this.get("storeKey"),t=SC.Store.recordTypeFor(e),n=t.__sc_aggregate_keys,r,i,s,o,u,a;if(!n){n=[];for(s in this)o=this[s],o&&o.isRecordAttribute&&o.aggregate===YES&&n.push(s);t.__sc_aggregate_keys=n}var f=SC.Record,l=f.DIRTY,c=f.READY_NEW,h=f.DESTROYED,p=f.READY_CLEAN,d;d=function(e){var t,n,r,i;if(e){t=this.get("status");if(t&l||t&c||t&h)n=e.get("store"),r=e.get("storeKey"),i=n.peekStatus(r),i===p&&e.get("store").recordDidChange(e.constructor,null,e.get("storeKey"),null,YES)}};for(r=0,i=n.length;r<i;++r)s=n[r],u=this.get(s),a=SC.kindOf(u,SC.ManyArray)?u:[u],a.forEach(d,this)},storeDidChangeProperties:function(e,t){if(e)this.notifyPropertyChange("status");else{t?(this.beginPropertyChanges(),t.forEach(function(e){this.notifyPropertyChange(e)},this),this.notifyPropertyChange("status"),this.endPropertyChanges()):this.allPropertiesDidChange();var n=this.relationships,r=n?n.length:0;while(--r>=0)n[r].recordPropertyDidChange(t)}},normalize:function(e){var t=this.primaryKey,n=this.get("id"),r=this.get("store"),i=this.get("storeKey"),s={},o,u,a,f,l,c,h,p,d,v,m,g=r.readEditableDataHash(i)||{};g[t]=n,f=r.readDataHash(i);for(o in this
)u=this[o],u&&(a=u.typeClass,a&&(v=u.get("key")||o,s[v]=YES,h=SC.typeOf(a.call(u))===SC.T_CLASS,p=u.isNestedRecordTransform,!h&&!p?(l=this.get(o),l===undefined||l===null&&!e?e||(s[v]=NO):(m=this[o],SC.instanceOf(m,SC.RecordAttribute)&&(l=m.fromType(this,o,l)),g[v]=l)):p?(l=this.get(o),l&&l.normalize&&l.normalize()):h&&(l=f[v],l!==undefined?g[v]=l:(d=u.get("defaultValue"),SC.typeOf(d)===SC.T_FUNCTION?g[v]=d(this,o,d):g[v]=d))));for(o in g)s[o]||(SC.debug("%@:  Deleting key from underlying data hash due to normalization:  %@",this,o),delete g[o]);return this},unknownProperty:function(e,t){if(t!==undefined){var n=this.get("storeKey"),r=SC.Store.recordTypeFor(n);if(r.ignoreUnknownProperties===YES)return this[e]=t,t;var i=this.get("primaryKey");this.writeAttribute(e,t),e===i&&SC.Store.replaceIdFor(n,t)}return this.readAttribute(e)},commitRecord:function(e,t,n){var r=this.get("store"),i,s,o=this.get("storeKey"),u=r.parentStoreKeyExists();return s=t||SC.none(t)&&SC.none(u),s?r.commitRecord(undefined,undefined,this.get("storeKey"),e,n):u&&(i=r.materializeRecord(u),i.commitRecord(e,t,n)),this},isError:function(){return this.get("status")&SC.Record.ERROR}.property("status").cacheable(),errorValue:function(){return this.get("isError")?SC.val(this.get("errorObject")):null}.property("isError").cacheable(),errorObject:function(){if(this.get("isError")){var e=this.get("store");return e.readError(this.get("storeKey"))||SC.Record.GENERIC_ERROR}return null}.property("isError").cacheable(),set:function(e,t){var n=this[e];return n&&n.isProperty&&n.get&&!n.get("isEditable")?this:arguments.callee
.base.apply(this,arguments)},toString:function(){var e=this.get("store").readDataHash(this.get("storeKey"));return"%@(%@) %@".fmt(this.constructor.toString(),SC.inspect(e),this.statusString())},statusString:function(){var e=[],t=this.get("status");for(var n in SC.Record)n.match(/[A-Z_]$/)&&SC.Record[n]===t&&e.push(n);return e.join(" ")},registerNestedRecord:function(e,t,n){var r,i,s,o,u;return SC.none(n)&&(n=t),e&&e.get&&e.get("isRecord")?o=e:(u=this._materializeNestedRecordType(e,t),o=this.createNestedRecord(u,e)),o&&(this.isParentRecord=YES,r=this.get("store"),i=this.get("storeKey"),s=o.get("storeKey"),r.registerChildToParent(i,s,n)),o},_materializeNestedRecordType:function(e,t){var n,r,i;SC.typeOf(e)===SC.T_HASH&&(n=this.get("nestedRecordNamespace"),e.type&&!SC.none(n)&&(r=n[e.type])),!r&&t&&this[t]&&(r=this[t].get("typeClass"));if(!r||!SC.kindOf(r,SC.Record))throw"SC.Child: Error during transform: Invalid record type.";return r},createNestedRecord:function(e,t){var n,r,i,s,o=null,u=null;return SC.run(function(){t=t||{},u=t[e.prototype.primaryKey],n=this.get("store");if(SC.none(n))throw"Error: during the creation of a child record: NO STORE ON PARENT!";!r&&(s=e.prototype.primaryKey)&&(r=t[s],i=r?n.storeKeyExists(e,r):null,i?(n.writeDataHash(i,t),o=n.materializeRecord(i)):(o=n.createRecord(e,t),SC.none(r)&&(i=o.get("storeKey"),r="cr"+i,SC.Store.replaceIdFor(i,r),t=n.readEditableDataHash(i),t[s]=r))),SC.none(u)&&this.generateIdForChild&&this.generateIdForChild(o)},this),o},_nestedRecordKey:0,generateIdForChild:function(e){}}),SC.Record.mixin({ignoreUnknownProperties:NO,CLEAN
:1,DIRTY:2,EMPTY:256,ERROR:4096,READY:512,READY_CLEAN:513,READY_DIRTY:514,READY_NEW:515,DESTROYED:1024,DESTROYED_CLEAN:1025,DESTROYED_DIRTY:1026,BUSY:2048,BUSY_LOADING:2052,BUSY_CREATING:2056,BUSY_COMMITTING:2064,BUSY_REFRESH:2080,BUSY_REFRESH_CLEAN:2081,BUSY_REFRESH_DIRTY:2082,BUSY_DESTROYING:2112,BAD_STATE_ERROR:SC.$error("Internal Inconsistency"),RECORD_EXISTS_ERROR:SC.$error("Record Exists"),NOT_FOUND_ERROR:SC.$error("Not found "),BUSY_ERROR:SC.$error("Busy"),GENERIC_ERROR:SC.$error("Generic Error"),_nextChildKey:0,attr:function(e,t){return SC.RecordAttribute.attr(e,t)},fetch:function(e,t){return SC.FetchedAttribute.attr(e,t)},toMany:function(e,t){t=t||{};var n=t.nested||t.isNested,r;return n?r=SC.ChildrenAttribute.attr(e,t):r=SC.ManyAttribute.attr(e,t),r},toOne:function(e,t){t=t||{};var n=t.nested||t.isNested,r;return n?r=SC.ChildAttribute.attr(e,t):r=SC.SingleAttribute.attr(e,t),r},storeKeysById:function(){var e=SC.keyFor("storeKey",SC.guidFor(this)),t=this[e];return t||(t=this[e]={}),t},storeKeyFor:function(e){var t=this.storeKeysById(),n=t[e];return n||(n=SC.Store.generateStoreKey(),SC.Store.idsByStoreKey[n]=e,SC.Store.recordTypesByStoreKey[n]=this,t[e]=n),n},storeKeyExists:function(e){var t=this.storeKeysById(),n=t[e];return n},find:function(e,t){return e.find(this,t)},extend:function(){var e=SC.Object.extend.apply(this,arguments);return SC.Query&&SC.Query._scq_didDefineRecordType(e),e}}),SC.FixturesDataSource=SC.DataSource.extend({simulateRemoteResponse:NO,latency:50,cancel:function(e,t){return NO},fetch:function(e,t){if(t.get("location")!==SC.Query.LOCAL)throw SC.
$error("SC.Fixture data source can only fetch local queries");if(!t.get("recordType")&&!t.get("recordTypes"))throw SC.$error("SC.Fixture data source can only fetch queries with one or more record types");this.get("simulateRemoteResponse")?this.invokeLater(this._fetch,this.get("latency"),e,t):this._fetch(e,t)},_fetch:function(e,t){var n=t.get("recordType"),r=t.get("recordTypes")||[n];r.forEach(function(t){SC.typeOf(t)===SC.T_STRING&&(t=SC.objectForPropertyPath(t)),t&&this.loadFixturesFor(e,t)},this),e.dataSourceDidFetchQuery(t)},retrieveRecords:function(e,t){var n=this.get("latency"),r=this.hasFixturesFor(t);return r?(this.get("simulateRemoteResponse")?this.invokeLater(this._retrieveRecords,n,e,t):this._retrieveRecords(e,t),r):r},_retrieveRecords:function(e,t){t.forEach(function(t){var n=[],r=SC.Store.recordTypeFor(t),i=e.idFor(t),s=this.fixtureForStoreKey(e,t);n.push(t),e.dataSourceDidComplete(t,s,i)},this)},updateRecords:function(e,t,n){var r=this.get("latency"),i=this.hasFixturesFor(t);return i?(this.get("simulateRemoteResponse")?this.invokeLater(this._updateRecords,r,e,t):this._updateRecords(e,t),i):i},_updateRecords:function(e,t){t.forEach(function(t){var n=e.readDataHash(t);this.setFixtureForStoreKey(e,t,n),e.dataSourceDidComplete(t)},this)},createRecords:function(e,t,n){var r=this.get("latency");return this.get("simulateRemoteResponse")?this.invokeLater(this._createRecords,r,e,t):this._createRecords(e,t),YES},_createRecords:function(e,t){t.forEach(function(t){var n=e.idFor(t),r=e.recordTypeFor(t),i=e.readDataHash(t),s=this.fixturesFor(r);n||(n=this.generateIdFor(r,i,e,
t)),this._invalidateCachesFor(r,t,n),s[n]=i,e.dataSourceDidComplete(t,null,n)},this)},destroyRecords:function(e,t,n){var r=this.get("latency"),i=this.hasFixturesFor(t);return i?(this.get("simulateRemoteResponse")?this.invokeLater(this._destroyRecords,r,e,t):this._destroyRecords(e,t),i):i},_destroyRecords:function(e,t){t.forEach(function(t){var n=e.idFor(t),r=e.recordTypeFor(t),i=this.fixturesFor(r);this._invalidateCachesFor(r,t,n),n&&delete i[n],e.dataSourceDidDestroy(t)},this)},loadFixturesFor:function(e,t,n){var r=[],i,s,o;i=this.fixturesFor(t);for(s in i)o=t.storeKeyFor(s),e.peekStatus(o)===SC.Record.EMPTY&&r.push(i[s]),n&&n.push(o);return r&&r.length>0&&e.loadRecords(t,r),this},generateIdFor:function(e,t,n,r){return"@id%@".fmt(SC.Store.generateStoreKey())},fixtureForStoreKey:function(e,t){var n=e.idFor(t),r=e.recordTypeFor(t),i=this.fixturesFor(r);return i?i[n]:null},setFixtureForStoreKey:function(e,t,n){var r=e.idFor(t),i=e.recordTypeFor(t),s=this.fixturesFor(i);return this._invalidateCachesFor(i,t,r),s[r]=n,this},fixturesFor:function(e){this._fixtures||(this._fixtures={});var t=this._fixtures[SC.guidFor(e)];if(t)return t;var n=e?e.FIXTURES:null,r=n?n.length:0,i=e?e.prototype.primaryKey:"guid",s,o,u;this._fixtures[SC.guidFor(e)]=t={};for(s=0;s<r;s++)o=n[s],u=o[i],u||(u=this.generateIdFor(e,o)),t[u]=o;return t},fixturesLoadedFor:function(e){if(!this._fixtures)return NO;var t=[],n=this._fixtures[SC.guidFor(e)];return n?YES:NO},reset:function(){return this._fixtures=null,this},hasFixturesFor:function(e){var t=NO;return e.forEach(function(e){if(t!==SC.MIXED_STATE){var n=SC.
Store.recordTypeFor(e),r=n?n.FIXTURES:null;r&&r.length&&r.length>0?t===NO&&(t=YES):t===YES&&(t=SC.MIXED_STATE)}},this),t},_invalidateCachesFor:function(e,t,n){var r=this._storeKeyCache;return r&&delete r[SC.guidFor(e)],this}}),SC.Record.fixtures=SC.FixturesDataSource.create(),SC.RelationshipSupport={_srs_inverseDidRelinquishRelationships:function(e,t,n,r){t.forEach(function(t){this._srs_inverseDidRelinquishRelationship(e,t,n,r)},this)},_srs_inverseDidRelinquishRelationship:function(e,t,n,r){var i=e.storeKeyFor(t),s=this.readDataHash(i),o=n.inverse,u=e.prototype;if(!s||!o)return;SC.instanceOf(u[o],SC.SingleAttribute)?delete s[o]:SC.instanceOf(u[o],SC.ManyAttribute)&&SC.typeOf(s[o])===SC.T_ARRAY&&s[o].removeObject(r),this.pushRetrieve(e,t,s,undefined,!0)},_srs_inverseDidAddRelationships:function(e,t,n,r){t.forEach(function(t){this._srs_inverseDidAddRelationship(e,t,n,r)},this)},_srs_inverseDidAddRelationship:function(e,t,n,r){var i=e.storeKeyFor(t),s=this.readDataHash(i),o=this.peekStatus(i),u=e.prototype,a=n.inverse,f=u[a],l=u[u.primaryKey],c=!1;f=f&&f.get&&f.get("key")||f.key||a,o===SC.Record.EMPTY&&(SC.typeOf(n.lazilyInstantiate)===SC.T_FUNCTION&&n.lazilyInstantiate()||SC.typeOf(n.lazilyInstantiate)!==SC.T_FUNCTION&&n.lazilyInstantiate)&&(!SC.none(l)&&l.typeClass&&SC.typeOf(l.typeClass())===SC.T_CLASS&&(c=!0),s={},s[u.primaryKey]=t);if(!s||!a)return;SC.instanceOf(u[a],SC.SingleAttribute)?s[f]=r:SC.instanceOf(u[a],SC.ManyAttribute)&&(s[f]=s[f]||[],s[a].indexOf(r)<0&&s[f].push(r)),this.pushRetrieve(e,t,s,undefined,!c)},_srs_pushIterator:function(e,t,n,r){var i=e.prototype,s,o
,u,a;typeof n=="undefined"&&(n=e.storeKeyFor(t)),o=this.readDataHash(n)||{};for(u in i){s=i[u];if(s&&s.typeClass&&s.inverse&&s.isMaster){a=s.typeClass();if(SC.typeOf(a)!==SC.T_CLASS)continue;r.apply(this,[a,o,s,s.get&&s.get("key")||u])}}},pushDestroy:function(e,t,n,r){var i;return this._srs_pushIterator(t,n,r,function(e,t,r,s){i=[t[s]||null].flatten().compact().uniq(),this._srs_inverseDidRelinquishRelationships(e,i,r,n)}),e(t,n,r)}.enhance(),pushRetrieve:function(e,t,n,r,i,s){if(!s){var o,u;this._srs_pushIterator(t,n,i,function(e,t,i,s){o=[t[s]||null].flatten().compact().uniq(),u=[r[s]||null].flatten().compact().uniq(),this._srs_inverseDidRelinquishRelationships(e,o.filter(function(e){return u.indexOf(e)===-1}),i,n),this._srs_inverseDidAddRelationships(e,u,i,n)})}return i=i||t.storeKeyFor(n),e(t,n,r,i)}.enhance()},SC.RecordAttribute=SC.Object.extend({isRecordAttribute:YES,defaultValue:null,type:String,key:null,isRequired:NO,isEditable:YES,useIsoDate:YES,aggregate:NO,lazilyInstantiate:NO,typeClass:function(){var e=this.get("type");return SC.typeOf(e)===SC.T_STRING&&(e=SC.requiredObjectForPropertyPath(e)),e}.property("type").cacheable(),transform:function(){var e=this.get("typeClass")||String,t=SC.RecordAttribute.transforms,n;while(e&&!(n=t[SC.guidFor(e)]))e.superclass.hasOwnProperty("create")?e=e.superclass:e=SC.T_FUNCTION;return n}.property("typeClass").cacheable(),toType:function(e,t,n){var r=this.get("transform"),i=this.get("typeClass"),s;if(r&&r.to){n=r.to(n,this,i,e,t);if(!SC.none(n)&&(s=r.observesChildren)){var o,u=s.length,a={record:e,key:t};for(o=0;o<u;o++)n.addObserver
(s[o],this,this._SCRA_childObserver,a)}}return n},_SCRA_childObserver:function(e,t,n,r){this.call(r.record,r.key,e),r.record.notifyPropertyChange(r.key)},fromType:function(e,t,n){var r=this.get("transform"),i=this.get("typeClass");return r&&r.from&&(n=r.from(n,this,i,e,t)),n},getDefaultValue:function(e,t){var n=this.get("defaultValue");return typeof n===SC.T_FUNCTION&&(n=n(e,t,this)),n},call:function(e,t,n){var r=this.get("key")||t,i;return n!==undefined&&this.get("isEditable")&&(i=this.fromType(e,t,n),e.writeAttribute(r,i)),n=e.readAttribute(r),SC.none(n)&&(n=this.getDefaultValue(e,t)),n=this.toType(e,t,n),n},apply:function(e,t){return this.call.apply(e,t)},isProperty:YES,isCacheable:YES,dependentKeys:[],init:function(){arguments.callee.base.apply(this,arguments),this.cacheKey="__cache__"+SC.guidFor(this),this.lastSetValueKey="__lastValue__"+SC.guidFor(this)}}),SC.RecordAttribute.mixin({attr:function(e,t){return t||(t={}),t.type||(t.type=e||String),this.create(t)},transforms:{},registerTransform:function(e,t){SC.RecordAttribute.transforms[SC.guidFor(e)]=t}}),SC.RecordAttribute.registerTransform(Boolean,{to:function(e){return SC.none(e)?null:!!e}}),SC.RecordAttribute.registerTransform(Number,{to:function(e){return SC.none(e)?null:Number(e)}}),SC.RecordAttribute.registerTransform(String,{to:function(e){return typeof e!==SC.T_STRING&&!SC.none(e)&&e.toString&&(e=e.toString()),e}}),SC.RecordAttribute.registerTransform(Array,{to:function(e){return!SC.isArray(e)&&!SC.none(e)&&(e=[]),e},observesChildren:["[]"]}),SC.RecordAttribute.registerTransform(Object,{to:function(e){return typeof 
e!="object"&&!SC.none(e)&&(e={}),e}}),SC.RecordAttribute.registerTransform(SC.Record,{to:function(e,t,n,r){var i=r.get("store");return SC.none(e)||e===""?null:i.find(n,e)},from:function(e){return e?e.get("id"):null}}),SC.RecordAttribute.registerTransform(SC.T_FUNCTION,{to:function(e,t,n,r){n=n.apply(r);var i=r.get("store");return i.find(n,e)},from:function(e){return e.get("id")}}),SC.RecordAttribute.registerTransform(Date,{to:function(e,t){if(SC.none(e))return e;var n;e=e.toString()||"";if(t.get("useIsoDate")){var r="([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(\\.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?",i=e.match(new RegExp(r)),s=0,o=new Date(i[1],0,1),u;i[3]&&o.setMonth(i[3]-1),i[5]&&o.setDate(i[5]),i[7]&&o.setHours(i[7]),i[8]&&o.setMinutes(i[8]),i[10]&&o.setSeconds(i[10]),i[12]&&o.setMilliseconds(Number("0."+i[12])*1e3),i[14]&&(s=Number(i[16])*60+Number(i[17]),s*=i[15]==="-"?1:-1),s-=o.getTimezoneOffset(),u=Number(o)+s*60*1e3,n=new Date,n.setTime(Number(u))}else n=new Date(Date.parse(e));return n},_dates:{},_zeropad:function(e){var t=Math.abs(e),n=e<0?"-":"";return n+(t<10?"0":"")+t},from:function(e){if(SC.none(e))return null;var t=this._dates[e.getTime()];if(t)return t;var n=this._zeropad,r=-e.getTimezoneOffset();if(r===0)r="Z";else{var i=r<0?"-":"+";r=Math.abs(r);var s=Math.floor(r/60),o=r%60;r=i+n(s)+":"+n(o)}return this._dates[e.getTime()]=t="%@-%@-%@T%@:%@:%@%@".fmt(n(e.getFullYear()),n(e.getMonth()+1),n(e.getDate()),n(e.getHours()),n(e.getMinutes()),n(e.getSeconds()),r),t}}),SC.DateTime&&!SC.RecordAttribute.transforms[SC.guidFor
(SC.DateTime)]&&SC.RecordAttribute.registerTransform(SC.DateTime,{to:function(e,t){if(SC.none(e)||SC.instanceOf(e,SC.DateTime))return e;if(SC.none(e)||SC.instanceOf(e,Date))return SC.DateTime.create(e.getTime());var n=t.get("format");return SC.DateTime.parse(e,n?n:SC.DateTime.recordFormat)},from:function(e,t){if(SC.none(e))return e;var n=t.get("format");return e.toFormattedString(n?n:SC.DateTime.recordFormat)}}),SC.RecordAttribute.registerTransform(SC.Set,{to:function(e,t,n,r,i){return SC.Set.create(e)},from:function(e,t,n,r,i){return e.toArray()},observesChildren:["[]"]}),SC.ChildAttribute=SC.RecordAttribute.extend({isNestedRecordTransform:YES,toType:function(e,t,n){var r=null,i,s=this.get("typeClass");if(!e)throw"SC.Child: Error during transform: Unable to retrieve parent record.";return SC.none(n)||(r=e.registerNestedRecord(n,t)),r},fromType:function(e,t,n){var r,i,s;return e&&(SC.none(n)?(e.writeAttribute(t,n),s=n):(s=e.registerNestedRecord(n,t),s?(r=s.get("storeKey"),i=s.get("store"),e.writeAttribute(t,i.readDataHash(r))):n&&e.writeAttribute(t,n))),s},call:function(e,t,n){var r=this.get("key")||t,i,s=SC.keyFor("__kid__",SC.guidFor(this));return n!==undefined?n=this.fromType(e,t,n):(n=e.readAttribute(r),SC.none(n)&&(n=this.get("defaultValue"))?typeof n===SC.T_FUNCTION&&(n=this.defaultValue(e,t,this),e.attributes()&&e.writeAttribute(r,n,!0)):n=this.toType(e,t,n)),n}}),SC.ChildRecord=SC.Record.extend({}),SC.ChildRecord.extend=function(){return SC.Record.extend.apply(this,arguments)},SC.ChildArray=SC.Object.extend(SC.Enumerable,SC.Array,{defaultRecordType:null,record:null,propertyName
:null,children:null,store:function(){return this.getPath("record.store")}.property("record").cacheable(),storeKey:function(){return this.getPath("record.storeKey")}.property("record").cacheable(),readOnlyChildren:function(){return this.get("record").readAttribute(this.get("propertyName"))}.property(),editableChildren:function(){var e=this.get("store"),t=this.get("storeKey"),n=this.get("propertyName"),r,i;return r=e.readEditableProperty(t,n),r||(i=e.readEditableDataHash(t),r=i[n]=[]),r}.property(),length:function(){var e=this.get("readOnlyChildren");return e?e.length:0}.property("readOnlyChildren"),objectAt:function(e){var t=this._records,n=this.get("readOnlyChildren"),r,i,s=this.get("propertyName"),o=this.get("record"),u=n?n.length:0;return n?t&&(i=t[e])?i:(t||(this._records=t=[]),e>=u?undefined:(r=n.objectAt(e),r?(t[e]=i=o.registerNestedRecord(r,s,s+"."+e),i):undefined)):undefined},replace:function(e,t,n){var r=this.get("editableChildren"),i=n?n.get?n.get("length"):n.length:0,s=this.get("record"),o,u=this.get("propertyName"),a,f;return o=this._processRecordsToHashes(n),r.replace(e,t,o),o!==this._prevChildren&&(this._performRecordPropertyChange(null,!1),this.arrayContentWillChange(e,t,i),this._childrenContentDidChange(e,t,i)),s.recordDidChange(u),this},_processRecordsToHashes:function(e){var t,n;return e=e||[],e.forEach(function(r,i){r.isNestedRecord&&(t=r.get("store"),n=r.storeKey,e[i]=t.readDataHash(n))}),e},normalize:function(){this.forEach(function(e,t){e.normalize&&e.normalize()})},recordPropertyDidChange:function(e){return this._performRecordPropertyChange(e,!0),this},
_performRecordPropertyChange:function(e,t){if(e&&!e.contains(this.get("propertyName")))return this;var n=this.get("readOnlyChildren"),r=0,i=0,s=this._prevChildren,o=this._childrenContentDidChange;return t=SC.none(t)?!0:t,n===s?this:(s&&(s.removeArrayObservers({target:this,willChange:this.arrayContentWillChange,didChange:o}),r=s.get("length")),n&&(n.addArrayObservers({target:this,willChange:this.arrayContentWillChange,didChange:o}),i=n.get("length")),this._prevChildren=n,t&&(this.arrayContentWillChange(0,r,i),this._childrenContentDidChange(0,r,i)),this)},_childrenContentDidChange:function(e,t,n){this._records=null,this.arrayContentDidChange(e,t,n)},init:function(){arguments.callee.base.apply(this,arguments),this.recordPropertyDidChange()}}),SC.ChildrenAttribute=SC.ChildAttribute.extend({toType:function(e,t,n){var r=this.get("key")||t,i=SC.keyFor("__kidsArray__",SC.guidFor(this)),s=e[i],o=this.get("typeClass"),u;return s||(s=SC.ChildArray.create({record:e,propertyName:r,defaultRecordType:o}),e[i]=s,u=e.get("relationships"),u||e.set("relationships",u=[]),u.push(s)),s},fromType:function(e,t,n){var r,i,s=SC.keyFor("__kidsArray__",SC.guidFor(this)),o=e[s];return e&&(e.writeAttribute(t,n),o&&(o=o.recordPropertyDidChange())),o}}),SC.FetchedAttribute=SC.RecordAttribute.extend({paramValueKey:"link",paramOwnerKey:"owner",paramRelKey:"rel",queryKey:null,isEditable:NO,toType:function(e,t,n){var r=e.get("store");if(!r)return null;var i=this.get("paramValueKey"),s=this.get("paramOwnerKey"),o=this.get("paramRelKey"),u=this.get("queryKey")||this.get("typeClass"),a={};return i&&(a[i]=n),s&&(a
[s]=e),o&&(a[o]=this.get("key")||t),r.findAll(u,a)},fromType:function(e,t,n){return n}}),SC.ManyArray=SC.Object.extend(SC.Enumerable,SC.Array,{recordType:null,record:null,propertyName:null,manyAttribute:null,store:function(){return this.get("record").get("store")}.property("record").cacheable(),storeKey:function(){return this.get("record").get("storeKey")}.property("record").cacheable(),readOnlyStoreIds:function(){return this.get("record").readAttribute(this.get("propertyName"))}.property(),editableStoreIds:function(){var e=this.get("store"),t=this.get("storeKey"),n=this.get("propertyName"),r,i;return r=e.readEditableProperty(t,n),r||(i=e.readEditableDataHash(t),r=i[n]=[]),r!==this._prevStoreIds&&this.recordPropertyDidChange(),r}.property(),isEditable:function(){var e=this.manyAttribute;return e?e.get("isEditable"):NO}.property("manyAttribute").cacheable(),inverse:function(){var e=this.manyAttribute;return e?e.get("inverse"):null}.property("manyAttribute").cacheable(),isMaster:function(){var e=this.manyAttribute;return e?e.get("isMaster"):null}.property("manyAttribute").cacheable(),orderBy:function(){var e=this.manyAttribute;return e?e.get("orderBy"):null}.property("manyAttribute").cacheable(),length:function(){var e=this.get("readOnlyStoreIds");return e?e.get("length"):0}.property("readOnlyStoreIds"),objectAt:function(e){var t=this._records,n=this.get("readOnlyStoreIds"),r=this.get("store"),i=this.get("recordType"),s,o,u;return!n||!r?undefined:t&&(o=t[e])?o:(t||(this._records=t=[]),u=n.objectAt(e),u&&(s=r.storeKeyFor(i,u),r.readStatus(s)===SC.Record.EMPTY&&r.retrieveRecord(
i,null,s),t[e]=o=r.materializeRecord(s)),o)},replace:function(e,t,n){if(!this.get("isEditable"))throw"%@.%@[] is not editable".fmt(this.get("record"),this.get("propertyName"));var r=this.get("editableStoreIds"),i=n?n.get?n.get("length"):n.length:0,s=this.get("record"),o=this.get("propertyName"),u,a,f,l,c,h,p;f=[];for(u=0;u<i;u++)f[u]=n.objectAt(u).get("id");c=this.get("inverse");if(c&&t>0){l=SC.ManyArray._toRemove,l?SC.ManyArray._toRemove=null:l=[];for(u=0;u<t;u++)l[u]=this.objectAt(e+u)}r.replace(e,t,f);if(c){for(u=0;u<t;u++)p=l[u],h=p?p[c]:null,h&&h.inverseDidRemoveRecord&&h.inverseDidRemoveRecord(p,c,s,o);l&&(l.length=0,SC.ManyArray._toRemove||(SC.ManyArray._toRemove=l));for(u=0;u<i;u++)p=n.objectAt(u),h=p?p[c]:null,h&&h.inverseDidAddRecord&&h.inverseDidAddRecord(p,c,s,o)}return s&&(!c||this.get("isMaster"))&&s.recordDidChange(o),this.enumerableContentDidChange(e,t,i-t),this},removeInverseRecord:function(e){if(!e)return this;var t=e.get("id"),n=this.get("editableStoreIds"),r=n&&t?n.indexOf(t):-1,i;return r>=0&&(n.removeAt(r),this.get("isMaster")&&(i=this.get("record"))&&i.recordDidChange(this.get("propertyName"))),this},addInverseRecord:function(e){if(!e)return this;var t=e.get("id"),n=this.get("editableStoreIds"),r=this.get("orderBy"),i=n.get("length"),s,o;return r?s=this._findInsertionLocation(e,0,i,r):s=i,n.insertAt(s,e.get("id")),this.get("isMaster")&&(o=this.get("record"))&&o.recordDidChange(this.get("propertyName")),this},_findInsertionLocation:function(e,t,n,r){var i=t+Math.floor((n-t)/2),s=this.objectAt(i),o=this._compare(e,s,r);return o<0?i===0?i:this._findInsertionLocation
(e,0,i,r):o>0?i>=n?i:this._findInsertionLocation(e,i,n,r):i},_compare:function(e,t,n){var r=SC.typeOf(n),i,s,o;if(r===SC.T_FUNCTION)i=n(e,t);else if(r===SC.T_STRING)i=SC.compare(e,t);else{o=n.get("length"),i=0;for(s=0;i===0&&s<o;s++)i=SC.compare(e,t)}return i},recordPropertyDidChange:function(e){if(e&&!e.contains(this.get("propertyName")))return this;var t=this.get("readOnlyStoreIds"),n,r,i=this._prevStoreIds,s=this._storeIdsContentDidChange;if(t===i)return this;i?(i.removeArrayObservers({target:this,willChange:this.arrayContentWillChange,didChange:s}),n=i.get("length")):n=0,t?(t.addArrayObservers({target:this,willChange:this.arrayContentWillChange,didChange:s}),r=t.get("length")):r=0,this.arrayContentWillChange(0,n,r),this._prevStoreIds=t,this._storeIdsContentDidChange(0,n,r)},_storeIdsContentDidChange:function(e,t,n){this._records=null,this.arrayContentDidChange(e,t,n)},unknownProperty:function(e,t){var n;return SC.typeOf(e)===SC.T_STRING&&(n=this.reducedProperty(e,t)),n===undefined?arguments.callee.base.apply(this,arguments):n},init:function(){arguments.callee.base.apply(this,arguments),this.recordPropertyDidChange()}}),SC.ManyAttribute=SC.RecordAttribute.extend({inverse:null,isMaster:YES,orderBy:null,toType:function(e,t,n){var r=this.get("typeClass"),i=this.get("key")||t,s=SC.keyFor("__manyArray__",SC.guidFor(this)),o=e[s],u;return o||(o=SC.ManyArray.create({recordType:r,record:e,propertyName:i,manyAttribute:this}),e[s]=o,u=e.get("relationships"),u||e.set("relationships",u=[]),u.push(o)),o},fromType:function(e,t,n){var r=[];if(!SC.isArray(n))throw"Expects toMany attribute to be an array"
;var i=n.get("length");for(var s=0;s<i;s++)r[s]=n.objectAt(s).get("id");return r},inverseDidRemoveRecord:function(e,t,n,r){var i=e.get(t);i&&i.removeInverseRecord(n)},inverseDidAddRecord:function(e,t,n,r){var i=e.get(t);i&&i.addInverseRecord(n)}}),SC.SingleAttribute=SC.RecordAttribute.extend({inverse:null,isMaster:YES,call:function(e,t,n){var r=this.get("key")||t,i,s,o,u,a,f;if(n!==undefined&&this.get("isEditable")){if(n&&!SC.kindOf(n,SC.Record))throw"%@ is not an instance of SC.Record".fmt(n);i=this.get("inverse"),i&&(o=this._scsa_call(e,t)),f=this.fromType(e,t,n),e.writeAttribute(r,f,!this.get("isMaster")),a=n,i&&o!==n&&(o&&(u=o[i])&&u.inverseDidRemoveRecord(o,i,e,t),n&&(u=n[i])&&u.inverseDidAddRecord(n,i,e,t))}else a=this._scsa_call(e,t,n);return a},_scsa_call:SC.RecordAttribute.prototype.call,inverseDidRemoveRecord:function(e,t,n,r){var i=this.get("inverse"),s=this._scsa_call(e,t),o=this.get("isMaster"),u;e.writeAttribute(t,null,!o),e.notifyPropertyChange(t),(s!==n||r!==i)&&s&&(u=s[i])&&u.inverseDidRemoveRecord(s,i,e,t)},inverseDidAddRecord:function(e,t,n,r){var i=this.get("inverse"),s=this._scsa_call(e,t),o=this.get("isMaster"),u,a;a=this.fromType(e,t,n),e.writeAttribute(t,a,!o),e.notifyPropertyChange(t),(s!==n||r!==i)&&s&&(u=s[i])&&u.inverseDidRemoveRecord(s,i,e,t)}}),SC.Store=SC.Object.extend({name:null,nestedStores:null,dataSource:null,isNested:NO,commitRecordsAutomatically:NO,from:function(e){return this.set("dataSource",e),this},_getDataSource:function(){var e=this.get("dataSource");return typeof e===SC.T_STRING&&(e=SC.requiredObjectForPropertyPath(e),e.isClass&&(e=
e.create()),this.set("dataSource",e)),e},cascade:function(e){var t=SC.A(arguments);return e=SC.CascadeDataSource.create({dataSources:t}),this.from(e)},chain:function(e,t){e||(e={}),e.parentStore=this;if(t){if(SC.typeOf(t)!=="class")throw new Error("%@ is not a valid class".fmt(t));if(!SC.kindOf(t,SC.NestedStore))throw new Error("%@ is not a type of SC.NestedStore".fmt(t))}else t=SC.NestedStore;e.childRecords=this.childRecords?SC.clone(this.childRecords):{},e.parentRecords=this.parentRecords?SC.clone(this.parentRecords):{};var n=t.create(e),r=this.nestedStores;return r||(r=this.nestedStores=[]),r.push(n),n},willDestroyNestedStore:function(e){return this.nestedStores&&this.nestedStores.removeObject(e),this},hasNestedStore:function(e){while(e&&e!==this)e=e.get("parentStore");return e===this},dataHashes:null,statuses:null,revisions:null,editables:null,changelog:null,recordErrors:null,queryErrors:null,childRecords:null,parentRecords:null,storeKeyEditState:function(e){var t=this.editables,n=this.locks;return t&&t[e]?SC.Store.EDITABLE:SC.Store.LOCKED},readDataHash:function(e){return this.dataHashes[e]},readEditableDataHash:function(e){var t=this.dataHashes[e];if(!t)return t;var n=this.editables;return n||(n=this.editables=[]),n[e]||(n[e]=1,t=this.dataHashes[e]=SC.clone(t,YES)),t},readEditableProperty:function(e,t){var n=this.readEditableDataHash(e),r=this.editables[e],i=n[t];return r===1&&(r=this.editables[e]={}),r[t]||(i=n[t],i&&i.isCopyable&&(i=n[t]=i.copy(YES)),r[t]=YES),i},writeDataHash:function(e,t,n){t&&(this.dataHashes[e]=t),n&&(this.statuses[e]=n);var r=this.editables;r||(r=
this.editables=[]),r[e]=1;var i=this;return this._propagateToChildren(e,function(e){i.writeDataHash(e,null,n)}),this},removeDataHash:function(e,t){this.dataHashes[e]=null,this.statuses[e]=t||SC.Record.EMPTY;var n=this.editables;return n&&(n[e]=0),this},readStatus:function(e){return this.readDataHash(e),this.statuses[e]||SC.Record.EMPTY},peekStatus:function(e){return this.statuses[e]||SC.Record.EMPTY},writeStatus:function(e,t){return this.writeDataHash(e,null,t)},dataHashDidChange:function(e,t,n,r){t||(t=SC.Store.generateStoreKey());var i,s,o,u;i=SC.typeOf(e)===SC.T_ARRAY,i?s=e.length:(s=1,u=e);var a=this;for(o=0;o<s;o++)i&&(u=e[o]),this.revisions[u]=t,this._notifyRecordPropertyChange(u,n,r),this._propagateToChildren(u,function(e){a.dataHashDidChange(e,null,n,r)});return this},_notifyRecordPropertyChange:function(e,t,n){var r=this.records,i=this.get("nestedStores"),s=SC.Store,o,u,a,f,l,c,h;a=i?i.length:0;for(f=0;f<a;f++){l=i[f],c=l.peekStatus(e),u=l.storeKeyEditState(e);if(u===s.INHERITED)l._notifyRecordPropertyChange(e,t,n);else if(c&SC.Record.BUSY){if(l.get("hasChanges"))throw s.CHAIN_CONFLICT_ERROR;l.reset()}}var p=this.recordPropertyChanges;return p||(p=this.recordPropertyChanges={storeKeys:SC.CoreSet.create(),records:SC.CoreSet.create(),hasDataChanges:SC.CoreSet.create(),propertyForStoreKeys:{}}),p.storeKeys.add(e),r&&(o=r[e])&&(p.records.push(e),t||p.hasDataChanges.push(e),n?((h=p.propertyForStoreKeys[e])||(h=p.propertyForStoreKeys[e]=SC.CoreSet.create()),h!=="*"&&h.add(n)):p.propertyForStoreKeys[e]="*"),this.invokeOnce(this.flush),this},flush:function(){if(!this.recordPropertyChanges
)return this;var e=this.recordPropertyChanges,t=e.storeKeys,n=e.hasDataChanges,r=e.records,i=e.propertyForStoreKeys,s=SC.CoreSet.create(),o,u,a,f,l,c,h;return t.forEach(function(e){r.contains(e)&&(a=n.contains(e)?NO:YES,o=this.records[e],h=i?i[e]:null,h==="*"&&(h=null),r.remove(e),o&&o.storeDidChangeProperties(a,h)),u=SC.Store.recordTypeFor(e),s.add(u)},this),t.get("length")>0&&this._notifyRecordArrays(t,s),t.clear(),n.clear(),r.clear(),this.recordPropertyChanges.propertyForStoreKeys={},this},reset:function(){this.dataHashes={},this.revisions={},this.statuses={},this.chainedChanges=this.locks=this.editables=null,this.changelog=null,this.recordErrors=null,this.queryErrors=null;var e=this.get("dataSource");e&&e.reset&&e.reset();var t=this.records,n;if(t)for(n in t){if(!t.hasOwnProperty(n))continue;this._notifyRecordPropertyChange(parseInt(n,10),NO)}this.set("hasChanges",NO)},commitChangesFromNestedStore:function(e,t,n){n||this._verifyLockRevisions(t,e.locks);var r=t.length,i,s,o,u,a,f,l,c,h,p,d,v,m;f=this.revisions,o=this.dataHashes,u=this.statuses,a=this.editables,l=this.parentRecords?this.parentRecords:this.parentRecords={},c=this.childRecords?this.childRecords:this.childRecords={},a||(a=this.editables=[]),h=e.dataHashes,d=e.revisions,p=e.statuses,v=e.parentRecords||{},m=e.childRecords||{};for(i=0;i<r;i++)s=t[i],o[s]=h[s],u[s]=p[s],f[s]=d[s],l[s]=v[s],c[s]=m[s],a[s]=0,this._notifyRecordPropertyChange(s,NO);var g=this.changelog,y=e.changelog;return y&&(g||(g=this.changelog=SC.CoreSet.create()),g.addEach(y)),this.changelog=g,this.get("parentStore")||this.flush(),this},_verifyLockRevisions
:function(e,t){var n=e.length,r=this.revisions,i,s,o,u;if(t&&r)for(i=0;i<n;i++){s=e[i],o=t[s]||1,u=r[s]||1;if(o<u)throw SC.Store.CHAIN_CONFLICT_ERROR}return this},find:function(e,t){SC.typeOf(e)===SC.T_STRING&&(e=SC.objectForPropertyPath(e));if(arguments.length===1&&!(e&&e.get&&e.get("isRecord"))){if(!e)throw new Error("SC.Store#find() must pass recordType or query");return e.isQuery||(e=SC.Query.local(e)),this._findQuery(e,YES,YES)}return this._findRecord(e,t)},findAll:function(e,t,n){SC.Logger.warn("SC.Store#findAll() will be removed in a future version of SproutCore.  Use SC.Store#find() instead");if(!e||!e.isQuery)e=SC.Query.local(e,t,n);return this._findQuery(e,YES,YES)},_findQuery:function(e,t,n){var r=this._scst_recordArraysByQuery,i=SC.guidFor(e),s,o;return r||(r=this._scst_recordArraysByQuery={}),s=r[i],!s&&t&&(r[i]=s=SC.RecordArray.create({store:this,query:e}),o=this.get("recordArrays"),o||this.set("recordArrays",o=SC.Set.create()),o.add(s),n&&this.refreshQuery(e)),this.flush(),s},_findRecord:function(e,t){var n;return e&&e.get&&e.get("isRecord")?n=e.get("storeKey"):n=SC.none(t)?null:e.storeKeyFor(t),n&&this.readStatus(n)===SC.Record.EMPTY&&(n=this.retrieveRecord(e,t)),n?this.materializeRecord(n):null},recordArrayWillDestroy:function(e){var t=this._scst_recordArraysByQuery,n=this.get("recordArrays");return t&&delete t[SC.guidFor(e.get("query"))],n&&n.remove(e),this},refreshQuery:function(e){if(!e)throw new Error("refreshQuery() requires a query");var t=this._scst_recordArraysByQuery,n=t?t[SC.guidFor(e)]:null,r=this._getDataSource();return r&&r.fetch&&(n&&n.storeWillFetchQuery
(e),r.fetch.call(r,this,e)),this},_notifyRecordArrays:function(e,t){var n=this.get("recordArrays");return n?(n.forEach(function(n){n&&n.storeDidChangeStoreKeys(e,t)},this),this):this},recordsFor:function(e){var t=[],n=e.storeKeysById(),r,i,s;for(r in n)i=n[r],this.readStatus(i)!==SC.RECORD_EMPTY&&t.push(i);return t.length>0?s=SC.RecordArray.create({store:this,storeKeys:t}):s=t,s},_TMP_REC_ATTRS:{},materializeRecord:function(e){var t=this.records,n,r,i;return t||(t=this.records={}),n=t[e],n?n:(r=SC.Store.recordTypeFor(e),r?(i=this._TMP_REC_ATTRS,i.storeKey=e,i.store=this,n=t[e]=r.create(i),n):null)},createRecord:function(e,t,n){var r,i,s,o=SC.Record,u,a,f;!n&&(r=e.prototype.primaryKey)&&(n=t[r],a=e.prototype[r]?e.prototype[r].defaultValue:null,!n&&SC.typeOf(a)===SC.T_FUNCTION&&(n=t[r]=a())),i=n?e.storeKeyFor(n):SC.Store.generateStoreKey(),s=this.readStatus(i);if(s&o.BUSY||s&o.READY||s===o.DESTROYED_DIRTY)throw n?o.RECORD_EXISTS_ERROR:o.BAD_STATE_ERROR;if(!!n||s!==SC.DESTROYED_CLEAN&&s!==SC.ERROR)return this.writeDataHash(i,t?t:{},o.READY_NEW),SC.Store.replaceRecordTypeFor(i,e),this.dataHashDidChange(i),u=this.changelog,u||(u=SC.Set.create()),u.add(i),this.changelog=u,this.get("commitRecordsAutomatically")&&this.invokeLast(this.commitRecords),f=this.materializeRecord(i),f&&f.propagateToAggregates(),f;throw o.BAD_STATE_ERROR},createRecords:function(e,t,n){var r=[],i,s,o,u=t.length,a;o=SC.typeOf(e)===SC.T_ARRAY,o||(i=e);for(a=0;a<u;a++)o&&(i=e[a]||SC.Record),s=n?n[a]:undefined,r.push(this.createRecord(i,t[a],s));return r},unloadRecord:function(e,t,n,r){n===undefined&&(n=e.storeKeyFor
(t));var i=this.readStatus(n),s=SC.Record;r=r||s.EMPTY;if(i===s.BUSY_DESTROYING||i&s.DESTROYED)return this;if(i&s.BUSY)throw s.BUSY_ERROR;i=r,this.removeDataHash(n,i),this.dataHashDidChange(n);var o=this;return this._propagateToChildren(n,function(e){o.unloadRecord(null,null,e,r)}),this},unloadRecords:function(e,t,n,r){var i,s,o,u,a,f;if(n===undefined){s=SC.typeOf(e)===SC.T_ARRAY,s||(a=e);if(t===undefined){i=s?e.length:1;for(o=0;o<i;o++)s&&(a=e[o]),n=this.storeKeysFor(a),this.unloadRecords(undefined,undefined,n,r)}else{i=t.length;for(o=0;o<i;o++)s&&(a=e[o]||SC.Record),u=t?t[o]:undefined,this.unloadRecord(a,u,undefined,r)}}else{i=n.length;for(o=0;o<i;o++)f=n?n[o]:undefined,this.unloadRecord(undefined,undefined,f,r)}return this},destroyRecord:function(e,t,n){n===undefined&&(n=e.storeKeyFor(t));var r=this.readStatus(n),i,s=SC.Record;if(r===s.BUSY_DESTROYING||r&s.DESTROYED)return this;if(r&s.BUSY)throw s.BUSY_ERROR;r===s.READY_NEW?r=s.DESTROYED_CLEAN:r=s.DESTROYED_DIRTY,this.writeStatus(n,r),this.dataHashDidChange(n),i=this.changelog,i||(i=this.changelog=SC.Set.create()),r&s.DIRTY?i.add(n):i.remove(n),this.changelog=i,this.get("commitRecordsAutomatically")&&this.invokeLast(this.commitRecords);var o=this;return this._propagateToChildren(n,function(e){o.destroyRecord(null,null,e)}),this},destroyRecords:function(e,t,n){var r,i,s,o,u,a;if(n===undefined){r=t.length,i=SC.typeOf(e)===SC.T_ARRAY,i||(u=e);for(s=0;s<r;s++)i&&(u=e[s]||SC.Record),o=t?t[s]:undefined,this.destroyRecord(u,o,undefined)}else{r=n.length;for(s=0;s<r;s++)a=n?n[s]:undefined,this.destroyRecord(undefined,undefined,a)}
return this},registerChildToParent:function(e,t,n){var r,i,s,o,u;i=this.childRecords||{},r=this.parentRecords||{},s=i[t],s&&(o=r[s],delete o[t]),u=r[e]||{},u[t]=n||YES,r[e]=u,i[t]=e,this.writeStatus(t,this.statuses[e]),this.childRecords=i,this.parentRecords=r},materializeParentRecord:function(e){var t,n;return SC.none(e)?null:(n=this.childRecords,t=n?this.childRecords[e]:null,SC.none(t)?null:this.materializeRecord(t))},parentStoreKeyExists:function(e){if(SC.none(e))return;var t=this.childRecords||{};return t[e]},_propagateToChildren:function(e,t){if(SC.none(this.parentRecords))return;var n=this.parentRecords[e]||{};if(SC.none(t))return;for(var r in n)n.hasOwnProperty(r)&&t(r)},recordDidChange:function(e,t,n,r,i){n===undefined&&(n=e.storeKeyFor(t));var s=this.readStatus(n),o,u=SC.Record;if(s&u.BUSY)throw u.BUSY_ERROR;if(!(s&u.READY))throw u.NOT_FOUND_ERROR;return s!=u.READY_NEW&&this.writeStatus(n,u.READY_DIRTY),this.dataHashDidChange(n,null,i,r),o=this.changelog,o||(o=this.changelog=SC.Set.create()),o.add(n),this.changelog=o,this.get("commitRecordsAutomatically")&&this.invokeLast(this.commitRecords),this},recordsDidChange:function(e,t,n){var r,i,s,o,u,a;if(n===undefined){r=t.length,i=SC.typeOf(e)===SC.T_ARRAY,i||(u=e);for(s=0;s<r;s++)i&&(u=e[s]||SC.Record),o=t?t[s]:undefined,a=n?n[s]:undefined,this.recordDidChange(u,o,a)}else{r=n.length;for(s=0;s<r;s++)a=n?n[s]:undefined,this.recordDidChange(undefined,undefined,a)}return this},retrieveRecords:function(e,t,n,r,i){var s=this._getDataSource(),o=SC.typeOf(e)===SC.T_ARRAY,u=SC.typeOf(i)===SC.T_ARRAY,a=n?n.length:t.length,f=[],l=SC
.Store.generateStoreKey(),c=SC.Record,h,p,d,v,m,g;o||(h=e);for(p=0;p<a;p++){n?d=n[p]:(o&&(h=e[p]),d=h.storeKeyFor(t[p])),g=u?i[p]:i,v=this.readStatus(d);if(v==c.EMPTY||v==c.ERROR||v==c.DESTROYED_CLEAN)this.writeStatus(d,c.BUSY_LOADING),this.dataHashDidChange(d,l,YES),f.push(d),this._setCallbackForStoreKey(d,g,u,n);else if(r)if(v&c.READY)this.writeStatus(d,c.BUSY_REFRESH|v&3),this.dataHashDidChange(d,l,YES),f.push(d),this._setCallbackForStoreKey(d,g,u,n);else{if(v==c.BUSY_DESTROYING||v==c.BUSY_CREATING||v==c.BUSY_COMMITTING)throw c.BUSY_ERROR;if(v==c.DESTROYED_DIRTY)throw c.BAD_STATE_ERROR}}m=NO,s&&(m=s.retrieveRecords.call(s,this,f,t));if(!m){a=f.length,l=SC.Store.generateStoreKey();for(p=0;p<a;p++)d=f[p],v=this.readStatus(d),v===c.BUSY_LOADING?(this.writeStatus(d,c.ERROR),this.dataHashDidChange(d,l,YES)):v&c.BUSY_REFRESH&&(this.writeStatus(d,c.READY|v&3),this.dataHashDidChange(d,l,YES));f.length=0}return f},_TMP_RETRIEVE_ARRAY:[],_callback_queue:{},_setCallbackForStoreKey:function(e,t,n,r){var i=this._callback_queue;n?i[e]={callback:t,otherKeys:r}:i[e]=t},_retreiveCallbackForStoreKey:function(e){var t=this._callback_queue,n=t[e],r,i;n&&(SC.typeOf(n)===SC.T_FUNCTION?(n.call(),delete t[e]):SC.typeOf(n)==SC.T_HASH&&(n.completed=YES,i=n.storeKeys,i.forEach(function(e){t[e].completed||(r=YES)}),r&&(n.callback.call(),i.forEach(function(e){delete t[e]}))))},_cancelCallback:function(e){var t=this._callback_queue;t[e]&&delete t[e]},retrieveRecord:function(e,t,n,r,i){var s=this._TMP_RETRIEVE_ARRAY,o;return n?(s[0]=n,n=s,t=null):(s[0]=t,t=s),o=this.retrieveRecords(e,t,n,r,i),s.length=0
,o[0]},refreshRecord:function(e,t,n,r){return!!this.retrieveRecord(e,t,n,YES,r)},refreshRecords:function(e,t,n,r){var i=this.retrieveRecords(e,t,n,YES,r);return i&&i.length>0},commitRecords:function(e,t,n,r,i){var s=this._getDataSource(),o=SC.typeOf(e)===SC.T_ARRAY,u=SC.typeOf(i)===SC.T_ARRAY,a=[],f=[],l=[],c=SC.Store.generateStoreKey(),h=SC.Record,p,d,v,m,g,y,b,w;!e&&!t&&!n&&(n=this.changelog),b=n?n.get("length"):t?t.get("length"):0;for(d=0;d<b;d++){n?v=n[d]:(o?p=e[d]||SC.Record:p=e,v=p.storeKeyFor(t[d])),w=u?i[d]:i,m=this.readStatus(v);if(m==h.EMPTY||m==h.ERROR)throw h.NOT_FOUND_ERROR;m==h.READY_NEW?(this.writeStatus(v,h.BUSY_CREATING),this.dataHashDidChange(v,c,YES),a.push(v),this._setCallbackForStoreKey(v,w,u,n)):m==h.READY_DIRTY?(this.writeStatus(v,h.BUSY_COMMITTING),this.dataHashDidChange(v,c,YES),f.push(v),this._setCallbackForStoreKey(v,w,u,n)):m==h.DESTROYED_DIRTY?(this.writeStatus(v,h.BUSY_DESTROYING),this.dataHashDidChange(v,c,YES),l.push(v),this._setCallbackForStoreKey(v,w,u,n)):m==h.DESTROYED_CLEAN&&this.dataHashDidChange(v,c,YES)}return s&&(b>0||r)&&(y=s.commitRecords.call(s,this,a,f,l,r)),y&&!e&&!t&&(n===this.changelog?this.changelog=null:this.changelog.removeEach(n)),y},commitRecord:function(e,t,n,r,i){var s=this._TMP_RETRIEVE_ARRAY,o;return t===undefined&&n===undefined?NO:(n!==undefined?(s[0]=n,n=s,t=null):(s[0]=t,t=s),o=this.commitRecords(e,t,n,r,i),s.length=0,o)},cancelRecords:function(e,t,n){var r=this._getDataSource(),i=SC.typeOf(e)===SC.T_ARRAY,s=SC.Record,o=[],u,a,f,l,c,h;a=n===undefined?t.length:n.length;for(f=0;f<a;f++){i?c=e[f]||SC.Record:c=e||SC.Record
,l=t?t[f]:undefined,n===undefined?h=c.storeKeyFor(l):h=n?n[f]:undefined;if(h){u=this.readStatus(h);if(u==s.EMPTY||u==s.ERROR)throw s.NOT_FOUND_ERROR;o.push(h),this._cancelCallback(h)}}return r&&r.cancel.call(r,this,o),this},cancelRecord:function(e,t,n){var r=this._TMP_RETRIEVE_ARRAY,i;return n!==undefined?(r[0]=n,n=r,t=null):(r[0]=t,t=r),i=this.cancelRecords(e,t,n),r.length=0,this},loadRecord:function(e,t,n){var r=SC.Record,i,s,o;return e=e||SC.Record,s=e.prototype.primaryKey,n=n||t[s],i=o=e.storeKeyFor(n),this.readStatus(o)&r.BUSY?this.dataSourceDidComplete(o,t,n):this.pushRetrieve(e,n,t,o),i},loadRecords:function(e,t,n){var r=SC.typeOf(e)===SC.T_ARRAY,i=t.get("length"),s=[],o=SC.Record,u,a,f,l,c,h;r||(u=e||SC.Record,f=u.prototype.primaryKey);for(l=0;l<i;l++)c=t.objectAt(l),r&&(u=e.objectAt(l)||SC.Record,f=u.prototype.primaryKey),a=n?n.objectAt(l):c[f],s[l]=this.loadRecord(u,c,a);return s},readError:function(e){var t=this.recordErrors;return t?t[e]:undefined},readQueryError:function(e){var t=this.queryErrors;return t?t[SC.guidFor(e)]:undefined},dataSourceDidCancel:function(e){var t=this.readStatus(e),n=SC.Record;if(!(t&n.BUSY))throw n.BAD_STATE_ERROR;switch(t){case n.BUSY_LOADING:t=n.EMPTY;break;case n.BUSY_CREATING:t=n.READY_NEW;break;case n.BUSY_COMMITTING:t=n.READY_DIRTY;break;case n.BUSY_REFRESH_CLEAN:t=n.READY_CLEAN;break;case n.BUSY_REFRESH_DIRTY:t=n.READY_DIRTY;break;case n.BUSY_DESTROYING:t=n.DESTROYED_DIRTY;break;default:throw n.BAD_STATE_ERROR}return this.writeStatus(e,t),this.dataHashDidChange(e,null,YES),this._cancelCallback(e),this},dataSourceDidComplete:function(
e,t,n){var r=this.readStatus(e),i=SC.Record,s;if(!(r&i.BUSY))throw i.BAD_STATE_ERROR;if(r===i.BUSY_DESTROYING)throw i.BAD_STATE_ERROR;r=i.READY_CLEAN,this.writeStatus(e,r),t&&this.writeDataHash(e,t,r),n&&SC.Store.replaceIdFor(e,n),s=t||n?NO:YES,this.dataHashDidChange(e,null,s);var o=this.materializeRecord(e);return o!=null&&o.notifyPropertyChange("status"),this._retreiveCallbackForStoreKey(e),this},dataSourceDidDestroy:function(e){var t=this.readStatus(e),n=SC.Record;if(!(t&n.BUSY))throw n.BAD_STATE_ERROR;t=n.DESTROYED_CLEAN,this.removeDataHash(e,t),this.dataHashDidChange(e);var r=this.materializeRecord(e);return r!=null&&r.notifyPropertyChange("status"),this._retreiveCallbackForStoreKey(e),this},dataSourceDidError:function(e,t){var n=this.readStatus(e),r=this.recordErrors,i=SC.Record;if(!(n&i.BUSY))throw i.BAD_STATE_ERROR;n=i.ERROR,t&&t.isError&&(r||(r=this.recordErrors=[]),r[e]=t),this.writeStatus(e,n),this.dataHashDidChange(e,null,YES);var s=this.materializeRecord(e);return s!=null&&s.notifyPropertyChange("status"),this._retreiveCallbackForStoreKey(e),this},pushRetrieve:function(e,t,n,r){var i=SC.Record,s;return r===undefined&&(r=e.storeKeyFor(t)),s=this.readStatus(r),s==i.EMPTY||s==i.ERROR||s==i.READY_CLEAN||s==i.DESTROYED_CLEAN?(s=i.READY_CLEAN,n===undefined?this.writeStatus(r,s):this.writeDataHash(r,n,s),this.dataHashDidChange(r),r):NO},pushDestroy:function(e,t,n){var r=SC.Record,i;return n===undefined&&(n=e.storeKeyFor(t)),i=this.readStatus(n),i==r.EMPTY||i==r.ERROR||i==r.READY_CLEAN||i==r.DESTROYED_CLEAN?(i=r.DESTROYED_CLEAN,this.removeDataHash(n,i),this.dataHashDidChange
(n),n):NO},pushError:function(e,t,n,r){var i=SC.Record,s,o=this.recordErrors;return r===undefined&&(r=e.storeKeyFor(t)),s=this.readStatus(r),s==i.EMPTY||s==i.ERROR||s==i.READY_CLEAN||s==i.DESTROYED_CLEAN?(s=i.ERROR,n&&n.isError&&(o||(o=this.recordErrors=[]),o[r]=n),this.writeStatus(r,s),this.dataHashDidChange(r,null,YES),r):NO},loadQueryResults:function(e,t){if(e.get("location")===SC.Query.LOCAL)throw new Error("Cannot load query results for a local query");var n=this._findQuery(e,YES,NO);return n&&n.set("storeKeys",t),this.dataSourceDidFetchQuery(e),this},dataSourceDidFetchQuery:function(e){return this._scstore_dataSourceDidFetchQuery(e,YES)},_scstore_dataSourceDidFetchQuery:function(e,t){var n=this._findQuery(e,t,NO),r=this.get("nestedStores"),i=r?r.get("length"):0;n&&n.storeDidFetchQuery(e);while(--i>=0)r[i]._scstore_dataSourceDidFetchQuery(e,NO);return this},dataSourceDidCancelQuery:function(e){return this._scstore_dataSourceDidCancelQuery(e,YES)},_scstore_dataSourceDidCancelQuery:function(e,t){var n=this._findQuery(e,t,NO),r=this.get("nestedStores"),i=r?r.get("length"):0;n&&n.storeDidCancelQuery(e);while(--i>=0)r[i]._scstore_dataSourceDidCancelQuery(e,NO);return this},dataSourceDidErrorQuery:function(e,t){var n=this.queryErrors;return t&&t.isError&&(n||(n=this.queryErrors={}),n[SC.guidFor(e)]=t),this._scstore_dataSourceDidErrorQuery(e,YES)},_scstore_dataSourceDidErrorQuery:function(e,t){var n=this._findQuery(e,t,NO),r=this.get("nestedStores"),i=r?r.get("length"):0;n&&n.storeDidErrorQuery(e);while(--i>=0)r[i]._scstore_dataSourceDidErrorQuery(e,NO);return this},init:function(
){arguments.callee.base.apply(this,arguments),this.reset()},toString:function(){var e=this.get("name");if(!e)return arguments.callee.base.apply(this,arguments);var t=arguments.callee.base.apply(this,arguments);return"%@ (%@)".fmt(e,t)},idFor:function(e){return SC.Store.idFor(e)},recordTypeFor:function(e){return SC.Store.recordTypeFor(e)},storeKeyFor:function(e,t){return e.storeKeyFor(t)},storeKeyExists:function(e,t){return e.storeKeyExists(t)},storeKeysFor:function(e){var t=[],n=e&&e.isEnumerable,r,i,s;if(!this.statuses)return t;for(i in SC.Store.recordTypesByStoreKey)r=SC.Store.recordTypesByStoreKey[i],n?s=e.contains(r):s=r===e,s&&this.statuses[i]&&t.push(parseInt(i,10));return t},storeKeys:function(){var e=[],t;if(!this.statuses)return e;for(t in this.statuses)this.statuses[t]!=SC.Record.EMPTY&&e.push(parseInt(t,10));return e},statusString:function(e){var t=this.materializeRecord(e);return t.statusString()}}),SC.Store.mixin({CHAIN_CONFLICT_ERROR:new Error("Nested Store Conflict"),NO_PARENT_STORE_ERROR:new Error("Parent Store Required"),NESTED_STORE_UNSUPPORTED_ERROR:new Error("Unsupported In Nested Store"),NESTED_STORE_RETRIEVE_DIRTY_ERROR:new Error("Cannot Retrieve Dirty Record in Nested Store"),EDITABLE:"editable",LOCKED:"locked",INHERITED:"inherited",idsByStoreKey:[],recordTypesByStoreKey:{},queriesByStoreKey:[],nextStoreKey:1,generateStoreKey:function(){return this.nextStoreKey++},idFor:function(e){return this.idsByStoreKey[e]},queryFor:function(e){return this.queriesByStoreKey[e]},recordTypeFor:function(e){return this.recordTypesByStoreKey[e]},replaceIdFor:function(e,
t){var n=this.idsByStoreKey[e],r,i;if(n!==t){r=this.recordTypeFor(e);if(!r)throw new Error("replaceIdFor: storeKey %@ does not exist".fmt(e));this.idsByStoreKey[e]=t,i=r.storeKeysById(),delete i[n],i[t]=e}return this},replaceRecordTypeFor:function(e,t){return this.recordTypesByStoreKey[e]=t,this}}),SC.Store.prototype.nextStoreIndex=1,SC.Store._getDefaultStore=function(){var e=this._store;return e||(this._store=e=SC.Store.create()),e},SC.Store.updateRecords=function(e,t,n,r){SC.Logger.warn("SC.Store.updateRecords() is deprecated.  Use loadRecords() instead");var i=this._getDefaultStore(),s=e.length,o,u;if(!n){n=[];for(o=0;o<s;o++)n[o]=e[o].recordType}u=i.loadRecords(n,e),s=u.length;for(o=0;o<s;o++)u[o]=i.materializeRecord(u[o]);return u},SC.Store.find=function(e,t){return this._getDefaultStore().find(t,e)},SC.Store.findAll=function(e,t){return this._getDefaultStore().findAll(e,t)},SC.NestedStore=SC.Store.extend({hasChanges:NO,parentStore:null,isNested:YES,lockOnRead:YES,locks:null,chainedChanges:null,find:function(e){if(e&&e.isQuery&&e.get("location")!==SC.Query.LOCAL)throw"SC.Store#find() can only accept LOCAL queries in nested stores";return arguments.callee.base.apply(this,arguments)},commitChanges:function(e){if(this.get("hasChanges")){var t=this.get("parentStore");t.commitChangesFromNestedStore(this,this.chainedChanges,e)}return this.reset(),this},discardChanges:function(){var e,t;if((e=this.records)&&(t=this.locks)){var n=this.get("parentStore"),r=n.revisions,i=this.revisions,s,o,u;for(s in e){if(!e.hasOwnProperty(s))continue;if(!(o=t[s]))continue;u=r[s],(u!==o||i[s]>u)&&
this._notifyRecordPropertyChange(parseInt(s,10))}}return this.reset(),this.flush(),this},destroy:function(){this.discardChanges();var e=this.get("parentStore");return e&&e.willDestroyNestedStore(this),arguments.callee.base.apply(this,arguments),this},reset:function(){var e,t,n,r=this.get("parentStore");if(!r)throw SC.Store.NO_PARENT_STORE_ERROR;this.dataHashes=SC.beget(r.dataHashes),this.revisions=SC.beget(r.revisions),this.statuses=SC.beget(r.statuses),this.childRecords=r.childRecords?SC.beget(r.childRecords):{},this.parentRecords=r.parentRecords?SC.beget(r.parentRecords):{},this.chainedChanges=this.locks=this.editables=null,this.changelog=null,this.set("hasChanges",NO)},refreshQuery:function(e){var t=this.get("parentStore");return t&&t.refreshQuery(e),this},readError:function(e){var t=this.get("parentStore");return t?t.readError(e):null},readQueryError:function(e){var t=this.get("parentStore");return t?t.readQueryError(e):null},storeKeyEditState:function(e){var t=this.editables,n=this.locks;return t&&t[e]?SC.Store.EDITABLE:n&&n[e]?SC.Store.LOCKED:SC.Store.INHERITED},_lock:function(e){var t=this.locks,n,r,i,s,o,u,a,f;if(t&&t[e])return this;t||(t=this.locks=[]),r=this.editables,r&&(r[e]=0);var l=this.get("parentStore"),c;while(l&&(c=l.storeKeyEditState(e))===SC.Store.INHERITED)l=l.get("parentStore");return l&&c===SC.Store.EDITABLE?(i=this.childRecords[e],i?(this._lock(i),s=this.parentRecords[i],s&&(o=s[e],u=o?SC.tupleForPropertyPath(o,this.dataHashes[i]):null,u&&(a=u[0],f=u[1]),this.dataHashes[e]=a&&f?a[f]:null)):this.dataHashes[e]=SC.clone(l.dataHashes[e],YES),r||(r=this.editables=
[]),r[e]=1):this.dataHashes[e]=l.dataHashes[e],this.statuses[e]=this.statuses[e],n=this.revisions[e]=this.revisions[e],t[e]=n||1,this},readDataHash:function(e){return this.get("lockOnRead")&&this._lock(e),this.dataHashes[e]},readEditableDataHash:function(e){return this._lock(e),arguments.callee.base.apply(this,arguments)},writeDataHash:function(e,t,n){var r=this.locks,i=NO,s;t?this.dataHashes[e]=t:(this._lock(e),i=YES),n?this.statuses[e]=n:i||(this.statuses[e]=this.statuses[e]||SC.Record.READY_NEW),i||(s=this.revisions[e]=this.revisions[e],r||(r=this.locks=[]),r[e]||(r[e]=s||1));var o=this.editables;return o||(o=this.editables=[]),o[e]=1,this},removeDataHash:function(e,t){var n=this.locks;return n||(n=this.locks=[]),n[e]||(n[e]=this.revisions[e]||1),arguments.callee.base.apply(this,arguments)},dataHashDidChange:function(e,t,n,r){t||(t=SC.Store.generateStoreKey());var i,s,o,u;i=SC.typeOf(e)===SC.T_ARRAY,i?s=e.length:(s=1,u=e);var a=this.chainedChanges;a||(a=this.chainedChanges=SC.Set.create());for(o=0;o<s;o++)i&&(u=e[o]),this._lock(u),this.revisions[u]=t,a.add(u),this._notifyRecordPropertyChange(u,n,r);return this.setIfChanged("hasChanges",YES),this},commitChangesFromNestedStore:function(e,t,n){arguments.callee.base.apply(this,arguments);var r=this.get("parentStore"),i=r.revisions,s,o=this.locks,u=this.chainedChanges,a,f;o||(o=this.locks=[]),u||(u=this.chainedChanges=SC.Set.create()),a=t.length;for(s=0;s<a;s++)f=t[s],o[f]||(o[f]=i[f]||1),u.add(f);return this.setIfChanged("hasChanges",u.get("length")>0),this.flush(),this},queryFor:function(e,t,n){return this.get("parentStore")
.queryFor(e,t,n)},findAll:function(e,t,n,r,i){return i||(i=this),this.get("parentStore").findAll(e,t,n,r,i)},retrieveRecords:function(e,t,n,r){var i=this.get("parentStore"),s,o,u,a=n?n.length:t.length,f=SC.Record,l;if(r)for(s=0;s<a;s++){o=n?n[s]:i.storeKeyFor(e,t[s]),l=this.peekStatus(o);if(l&f.DIRTY)throw SC.Store.NESTED_STORE_RETRIEVE_DIRTY_ERROR;var c=this.dataHashes,h=this.revisions,p=this.statuses,d=this.editables,v=this.locks,m=NO,g=NO;c&&c.hasOwnProperty(o)&&(delete c[o],m=YES),h&&h.hasOwnProperty(o)&&(delete h[o],m=YES),d&&delete d[o],v&&delete v[o],p&&p.hasOwnProperty(o)&&(delete p[o],m||(g=YES),m=YES),m&&this._notifyRecordPropertyChange(o,g)}return i.retrieveRecords(e,t,n,r)},commitRecords:function(e,t,n){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},commitRecord:function(e,t,n){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},cancelRecords:function(e,t,n){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},cancelRecord:function(e,t,n){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},dataSourceDidCancel:function(e){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},dataSourceDidComplete:function(e,t,n){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},dataSourceDidDestroy:function(e){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},dataSourceDidError:function(e,t){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},pushRetrieve:function(e,t,n,r){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},pushDestroy:function(e,t,n){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR},pushError:function(e,t,n,r){throw SC.Store.NESTED_STORE_UNSUPPORTED_ERROR}}),SC.RecordArray=SC.Object.extend(SC.Enumerable,
SC.Array,{store:null,query:null,storeKeys:null,status:SC.Record.EMPTY,isEditable:function(){var e=this.get("query");return e?e.get("isEditable"):YES}.property("query").cacheable(),length:function(){this.flush();var e=this.get("storeKeys");return e?e.get("length"):0}.property("storeKeys").cacheable(),_scra_records:null,objectAt:function(e){this.flush();var t=this._scra_records,n=this.get("storeKeys"),r=this.get("store"),i,s;return!n||!r?undefined:t&&(s=t[e])?s:(t||(this._scra_records=t=[]),i=n.objectAt(e),i&&(r.peekStatus(i)===SC.Record.EMPTY&&r.retrieveRecord(null,null,i),t[e]=s=r.materializeRecord(i)),s)},forEach:function(e,t){this.flush();var n=this._scra_records,r=this.get("storeKeys"),i=this.get("store"),s=r?r.get("length"):0,o,u,a;if(!r||!i)return this;n||(n=this._scra_records=[]),t||(t=this);for(o=0;o<s;o++)a=n[o],a||(a=n[o]=i.materializeRecord(r.objectAt(o))),e.call(t,a,o,this);return this},replace:function(e,t,n){this.flush();var r=this.get("storeKeys"),i=n?n.get?n.get("length"):n.length:0,s,o;if(!r)throw"Unable to edit an SC.RecordArray that does not have its storeKeys property set.";if(!this.get("isEditable"))throw SC.RecordArray.NOT_EDITABLE;o=[];for(s=0;s<i;s++)o[s]=n.objectAt(s).get("storeKey");return r.replace(e,t,o),this},contains:function(e){return this.indexOf(e)>=0},indexOf:function(e,t){if(!SC.kindOf(e,SC.Record))return SC.Logger.warn("Using indexOf on %@ with an object that is not an SC.Record".fmt(e)),-1;this.flush();var n=e.get("storeKey"),r=this.get("storeKeys");return r?r.indexOf(n,t):-1},lastIndexOf:function(e,t){if(!SC.kindOf(e,SC.Record))return SC.
Logger.warn("Using lastIndexOf on %@ with an object that is not an SC.Record".fmt(e)),-1;this.flush();var n=e.get("storeKey"),r=this.get("storeKeys");return r?r.lastIndexOf(n,t):-1},add:function(e){return SC.kindOf(e,SC.Record)?(this.indexOf(e)<0&&this.pushObject(e),this):this},remove:function(e){return SC.kindOf(e,SC.Record)?(this.removeObject(e),this):this},find:function(e,t,n){return t&&t.isQuery?this.get("store").find(t.queryWithScope(this)):e.apply(this,SC.$A(arguments).slice(1))}.enhance(),refresh:function(){return this.get("store").refreshQuery(this.get("query")),this},reload:function(){return this.flush(YES),this},destroy:function(){this.get("isDestroyed")||this.get("store").recordArrayWillDestroy(this),arguments.callee.base.apply(this,arguments)},storeWillFetchQuery:function(e){var t=this.get("status"),n=SC.Record;if(t===n.EMPTY||t===n.ERROR)t=n.BUSY_LOADING;return t&n.READY&&(t=n.BUSY_REFRESH),this.setIfChanged("status",t),this},storeDidFetchQuery:function(e){return this.setIfChanged("status",SC.Record.READY_CLEAN),this},storeDidCancelQuery:function(e){var t=this.get("status"),n=SC.Record;return t===n.BUSY_LOADING?t=n.EMPTY:t===n.BUSY_REFRESH&&(t=n.READY_CLEAN),this.setIfChanged("status",t),this},storeDidErrorQuery:function(e){return this.setIfChanged("status",SC.Record.ERROR),this},storeDidChangeStoreKeys:function(e,t){var n=this.get("query");if(n.get("location")!==SC.Query.LOCAL)return this;if(!n.containsRecordTypes(t))return this;var r=this._scq_changedStoreKeys;return r||(r=this._scq_changedStoreKeys=SC.IndexSet.create()),r.addEach(e),this.set("needsFlush",YES)
,this.get("storeKeys")&&this.flush(),this},flush:function(e){if(this._insideFlush)return this.set("needsFlush",YES),this;if(!this.get("needsFlush")&&!e)return this;this.set("needsFlush",NO);var t=this.get("query"),n=this.get("store");if(!n||!t||t.get("location")!==SC.Query.LOCAL)return this;this._insideFlush=YES;var r=this.get("storeKeys"),i=this._scq_changedStoreKeys,s=NO,o=SC.Record,u=[],a=new Date,f,l,c,h,p,d,v=r;if(r&&!e)i&&(i.forEach(function(e){if(u.length>0||new Date-a>SC.RecordArray.QUERY_MATCHING_THRESHOLD){u.push(e);return}l=n.peekStatus(e),!(l&o.EMPTY)&&!(l&o.DESTROYED||l===o.BUSY_DESTROYING)?(f=n.materializeRecord(e),d=!!f&&!!t.contains(f)):d=NO,d?r.indexOf(e)<0&&(s||(r=r.copy()),r.pushObject(e)):r.indexOf(e)>=0&&(s||(r=r.copy()),r.removeObject(e))},this),s=YES);else{if(p=t.get("scope"))h=p.flush().get("storeKeys");else if(c=t.get("expandedRecordTypes"))h=SC.IndexSet.create(),c.forEach(function(e){h.addEach(n.storeKeysFor(e))});r=[],h.forEach(function(e){if(u.length>0||new Date-a>SC.RecordArray.QUERY_MATCHING_THRESHOLD){u.push(e);return}l=n.peekStatus(e),!(l&o.EMPTY)&&!(l&o.DESTROYED||l===o.BUSY_DESTROYING)&&(f=n.materializeRecord(e),f&&t.contains(f)&&r.push(e))}),s=YES}if(u.length>0){var m=this;window.setTimeout(function(){SC.run(function(){if(!m||m.get("isDestroyed"))return;m.set("needsFlush",YES),m._scq_changedStoreKeys=SC.IndexSet.create().addEach(u),m.flush()})},1)}return i&&i.clear(),s&&(r&&r===v&&(r=r.copy()),r=SC.Query.orderStoreKeys(r,t,n),SC.compare(v,r)!==0&&this.set("storeKeys",SC.clone(r))),this._insideFlush=NO,this},needsFlush:YES,isError:function()
{return this.get("status")&SC.Record.ERROR}.property("status").cacheable(),errorValue:function(){return this.get("isError")?SC.val(this.get("errorObject")):null}.property("isError").cacheable(),errorObject:function(){if(this.get("isError")){var e=this.get("store");return e.readQueryError(this.get("query"))||SC.Record.GENERIC_ERROR}return null}.property("isError").cacheable(),propertyWillChange:function(e,t){if(e==="storeKeys"){var n=this.get("storeKeys"),r=n?n.get("length"):0,i=t?t.get("length"):0;this.arrayContentWillChange(0,r,i)}return arguments.callee.base.apply(this,arguments)},_storeKeysDidChange:function(){var e=this.get("storeKeys"),t=this._prevStoreKeys,n,r,i=this._storeKeysContentDidChange,s=this._storeKeysStateDidChange;if(e===t)return;t?(t.removeArrayObservers({target:this,willChange:this.arrayContentWillChange,didChange:this._storeKeysContentDidChange}),n=t.get("length")):n=0,this._prevStoreKeys=e,e?(e.addArrayObservers({target:this,willChange:this.arrayContentWillChange,didChange:this._storeKeysContentDidChange}),r=e.get("length")):r=0,this._storeKeysContentDidChange(0,n,r)}.observes("storeKeys"),addArrayObservers:function(){return this.flush(),SC.Array.addArrayObservers.apply(this,arguments)},_storeKeysContentDidChange:function(e,t,n){this._scra_records&&(this._scra_records.length=0),this.arrayContentDidChange(e,t,n)},init:function(){arguments.callee.base.apply(this,arguments),this._storeKeysDidChange()}}),SC.RecordArray.mixin({NOT_EDITABLE:SC.Error.desc("SC.RecordArray is not editable"),QUERY_MATCHING_THRESHOLD:100}),Function.prototype.handleEvents=function()
{return this.isEventHandler=YES,this.events=arguments,this},Function.prototype.stateObserves=function(){return this.isStateObserveHandler=YES,this.args=SC.A(arguments),this},SC.StatechartEventDelegate={isStatechartEventDelegate:YES,tryToPerform:function(e,t,n){if(!this.respondsTo(e))return NO;if(SC.typeOf(this[e])===SC.T_FUNCTION){var r=this[e](t,n);if(r!==NO)return YES}return!!this.sendEvent(e,t,n)},sendEvent:function(e,t,n){}},SC.StatechartRoutingDelegate={isStatechartDelegate:YES,isStatechartRoutingDelegate:YES,statechartUpdateLocationForState:function(e,t,n){SC.routes.set("location",t)},statechartAcquireLocationForState:function(e,t){return SC.routes.get("location")},statechartBindStateToRoute:function(e,t,n,r){SC.routes.add(n,t,r)},statechartShouldStateHandleTriggeredRoute:function(e,t,n){return YES},statechartStateCancelledHandlingTriggeredRoute:function(e,t,n){}},SC.StatechartDelegate=SC.StatechartRoutingDelegate,SC.StatePathMatcher=SC.Object.extend({state:null,expression:null,tokens:null,init:function(){arguments.callee.base.apply(this,arguments),this._parseExpression()},_parseExpression:function(){var e=this.expression?this.expression.split("."):[],t=e.length,n=0,r,i=null,s,o=[];for(;n<t;n+=1){r=e[n];if(r.indexOf("~")>=0){r=r.split("~");if(r.length>2)throw"Invalid use of '~' at part %@".fmt(n);s=SC.StatePathMatcher._ExpandToken.create({start:r[0],end:r[1]})}else if(r==="this"){if(o.length>0)throw"Invalid use of 'this' at part %@".fmt(n);s=SC.StatePathMatcher._ThisToken.create()}else s=SC.StatePathMatcher._BasicToken.create({value:r});s.owner=this,o.push(s)}this.set("tokens"
,o);var u=SC.clone(o);this._chain=i=u.pop();while(s=u.pop())i.nextToken=s,i=s},lastPart:function(){var e=this.get("tokens"),t=e?e.length:0,n=t>0?e[t-1]:null;return n.get("lastPart")}.property("tokens").cacheable(),match:function(e){return this._stack=e.split("."),SC.empty(e)||SC.typeOf(e)!==SC.T_STRING?NO:this._chain.match()},_pop:function(){return this._lastPopped=this._stack.pop(),this._lastPopped}}),SC.StatePathMatcher._Token=SC.Object.extend({type:null,owner:null,nextToken:null,lastPart:null,match:function(){return NO}}),SC.StatePathMatcher._BasicToken=SC.StatePathMatcher._Token.extend({type:"basic",value:null,lastPart:function(){return this.value}.property("value").cacheable(),match:function(){var e=this.owner._pop(),t=this.nextToken;return this.value!==e?NO:t?t.match():YES}}),SC.StatePathMatcher._ExpandToken=SC.StatePathMatcher._Token.extend({type:"expand",start:null,end:null,lastPart:function(){return this.end}.property("end").cacheable(),match:function(){var e=this.start,t=this.end,n,r=this.nextToken;n=this.owner._pop();if(n!==t)return NO;while(n=this.owner._pop())if(n===e)return r?r.match():YES;return NO}}),SC.StatePathMatcher._ThisToken=SC.StatePathMatcher._Token.extend({type:"this",lastPart:"this",match:function(){var e=this.owner.state,t=e.get("substates"),n=t.length,r=0,i;i=this.owner._lastPopped;if(!i||this.owner._stack.length!==0)return NO;for(;r<n;r+=1)if(t[r].get("name")===i)return YES;return NO}}),SC.Async=SC.Object.extend({func:null,arg1:null,arg2:null,tryToPerform:function(e){var t=this.get("func"),n=this.get("arg1"),r=this.get("arg2"),i=SC.typeOf(t);i===
SC.T_STRING?e.tryToPerform(t,n,r):i===SC.T_FUNCTION&&t.apply(e,[n,r])}}),SC.Async.mixin({perform:function(e,t,n){return SC.Async.create({func:e,arg1:t,arg2:n})}}),SC.State=SC.Object.extend({name:null,parentState:null,historyState:null,initialSubstate:null,substatesAreConcurrent:NO,substates:null,statechart:null,stateIsInitialized:NO,currentSubstates:null,enteredSubstates:null,representRoute:null,trace:function(){var e=this.getPath("statechart.statechartTraceKey");return this.getPath("statechart.%@".fmt(e))}.property().cacheable(),owner:function(){var e=this.get("statechart"),t=e?e.get("statechartOwnerKey"):null,n=e?e.get(t):null;return n?n:e}.property().cacheable(),statechartDelegate:function(){return this.getPath("statechart.statechartDelegate")}.property().cacheable(),routingDelegate:function(){return this.getPath("statechart.routingDelegateValue")}.property().cacheable(),location:function(e,t){var n=this.get("statechart"),r=this.get("routingDelegate");return t!==undefined&&r.statechartUpdateLocationForState(n,t,this),r.statechartAcquireLocationForState(n,this)}.property().idempotent(),init:function(){arguments.callee.base.apply(this,arguments),this._registeredEventHandlers={},this._registeredStringEventHandlers={},this._registeredRegExpEventHandlers=[],this._registeredStateObserveHandlers={},this._registeredSubstatePaths={},this._registeredSubstates=[],this._isEnteringState=NO,this._isExitingState=NO;var e=this.get("statechart"),t=e?e.get("statechartOwnerKey"):null,n=e?e.get("statechartTraceKey"):null;e&&(e.addObserver(t,this,"_statechartOwnerDidChange"),e.addObserver(n,this
,"_statechartTraceDidChange"))},destroy:function(){var e=this.get("statechart"),t=e?e.get("statechartOwnerKey"):null,n=e?e.get("statechartTraceKey"):null;e&&(e.removeObserver(t,this,"_statechartOwnerDidChange"),e.removeObserver(n,this,"_statechartTraceDidChange"));var r=this.get("substates");r&&r.forEach(function(e){e.destroy()}),this._teardownAllStateObserveHandlers(),this.set("substates",null),this.set("currentSubstates",null),this.set("enteredSubstates",null),this.set("parentState",null),this.set("historyState",null),this.set("initialSubstate",null),this.set("statechart",null),this.notifyPropertyChange("trace"),this.notifyPropertyChange("owner"),this._registeredEventHandlers=null,this._registeredStringEventHandlers=null,this._registeredRegExpEventHandlers=null,this._registeredStateObserveHandlers=null,this._registeredSubstatePaths=null,this._registeredSubstates=null,arguments.callee.base.apply(this,arguments)},initState:function(){if(this.get("stateIsInitialized"))return;this._registerWithParentStates(),this._setupRouteHandling();var e=null,t=null,n=null,r=null,i=this.constructor,s=null,o=[],u=NO,a=this.get("initialSubstate"),f=this.get("substatesAreConcurrent"),l=this.get("statechart"),c=0,h=0,p=NO,d=null;this.set("substates",o),a&&a.isClass&&SC.kindOf(a,SC.HistoryState)&&(d=this.createSubstate(a),this.set("initialSubstate",d),SC.none(d.get("defaultState"))&&(this.stateLogError("Initial substate is invalid. History state requires the name of a default state to be set"),this.set("initialSubstate",null),d=null));for(e in this){t=this[e];if(!t)continue;r=t,n=t.isClass,p=!n&&
t instanceof Function;if(p){if(t.isEventHandler){this._registerEventHandler(e,t);continue}if(t.isStateObserveHandler){this._registerStateObserveHandler(e,t);continue}t.statePlugin&&(t=t.apply(this))}t&&t.isClass&&r!==i&&SC.kindOf(t,SC.State)&&(s=this._addSubstate(e,t),e===a?(this.set("initialSubstate",s),u=YES):d&&d.get("defaultState")===e&&(d.set("defaultState",s),u=YES))}!SC.none(a)&&!u&&this.stateLogError("Unable to set initial substate %@ since it did not match any of state's %@ substates".fmt(a,this)),o.length===0?SC.none(a)||this.stateLogWarning("Unable to make %@ an initial substate since state %@ has no substates".fmt(a,this)):o.length>0&&(s=this._addEmptyInitialSubstateIfNeeded(),!s&&a&&f&&(this.set("initialSubstate",null),this.stateLogWarning("Can not use %@ as initial substate since substates are all concurrent for state %@".fmt(a,this)))),this.notifyPropertyChange("substates"),this.set("currentSubstates",[]),this.set("enteredSubstates",[]),this.set("stateIsInitialized",YES)},_setupRouteHandling:function(){var e=this.get("representRoute"),t=this.get("statechart"),n=this.get("routingDelegate");if(!e)return;if(this.get("isConcurrentState")){this.stateLogError("State %@ cannot handle route '%@' since state is concurrent".fmt(this,e));return}n.statechartBindStateToRoute(t,this,e,this.routeTriggered)},routeTriggered:function(e){if(this._isEnteringState)return;var t=this.get("statechart"),n=this.get("routingDelegate"),r=this.get("location"),i={state:this,location:r,params:e,handler:this.routeTriggered},s=this.createStateRouteHandlerContext(i);n.statechartShouldStateHandleTriggeredRoute
(t,this,s)?(this.get("trace")&&r&&this.stateLogTrace("will handle route '%@'".fmt(r)),this.handleTriggeredRoute(s)):n.statechartStateCancelledHandlingTriggeredRoute(t,this,s)},createStateRouteHandlerContext:function(e){return SC.StateRouteHandlerContext.create(e)},handleTriggeredRoute:function(e){this.gotoState(this,e)},_addEmptyInitialSubstateIfNeeded:function(){var e=this.get("initialSubstate"),t=this.get("substatesAreConcurrent");if(e||t)return null;var n=this.createSubstate(SC.EmptyState);return this.set("initialSubstate",n),this.get("substates").push(n),this[n.get("name")]=n,n.initState(),this.stateLogWarning("state %@ has no initial substate defined. Will default to using an empty state as initial substate".fmt(this)),n},_addSubstate:function(e,t,n){var r=this.get("substates");return n=SC.clone(n)||{},n.name=e,t=this.createSubstate(t,n),r.push(t),this[e]=t,t.initState(),t},addSubstate:function(e,t,n){if(SC.empty(e))return this.stateLogError("Can not add substate. name required"),null;if(this[e]!==undefined)return this.stateLogError("Can not add substate '%@'. Already a defined property".fmt(e)),null;if(!this.get("stateIsInitialized"))return this.stateLogError("Can not add substate '%@'. this state is not yet initialized".fmt(e)),null;var r=arguments.length;r===1?t=SC.State:r===2&&SC.typeOf(t)===SC.T_HASH&&(n=t,t=SC.State);var i=t&&t.isClass&&SC.kindOf(t,SC.State);return i?(t=this._addSubstate(e,t,n),this._addEmptyInitialSubstateIfNeeded(),this.notifyPropertyChange("substates"),t):(this.stateLogError("Can not add substate '%@'. must provide a state class".fmt(e)),null)}
,createSubstate:function(e,t){return t=t||{},e.create({parentState:this,statechart:this.get("statechart")},t)},_registerEventHandler:function(e,t){var n=t.events,r=null,i=n.length,s=0;this._registeredEventHandlers[e]=t;for(;s<i;s+=1){r=n[s];if(SC.typeOf(r)===SC.T_STRING){this._registeredStringEventHandlers[r]={name:e,handler:t};continue}if(r instanceof RegExp){this._registeredRegExpEventHandlers.push({name:e,handler:t,regexp:r});continue}this.stateLogError("Invalid event %@ for event handler %@ in state %@".fmt(r,e,this))}},_registerStateObserveHandler:function(e,t){var n=0,r=t.args,i=r.length,s,o=YES;for(;n<i;n+=1){s=r[n];if(SC.typeOf(s)!==SC.T_STRING||SC.empty(s))this.stateLogError("Invalid argument %@ for state observe handler %@ in state %@".fmt(s,e,this)),o=NO}if(!o)return;this._registeredStateObserveHandlers[e]=t.args},_registerWithParentStates:function(){var e=this.get("parentState");while(!SC.none(e))e._registerSubstate(this),e=e.get("parentState")},_registerSubstate:function(e){var t=e.pathRelativeTo(this);if(SC.none(t))return;this._registeredSubstates.push(e);var n=this._registeredSubstatePaths;n[e.get("name")]===undefined&&(n[e.get("name")]={});var r=n[e.get("name")];r[t]=e},pathRelativeTo:function(e){var t=this.get("name"),n=this.get("parentState");while(!SC.none(n)&&n!==e)t="%@.%@".fmt(n.get("name"),t),n=n.get("parentState");return n!==e&&e!==this?(this.stateLogError("Can not generate relative path from %@ since it not a parent state of %@".fmt(e,this)),null):t},getSubstate:function(e,t,n){if(!e)return null;var r=SC.typeOf(e);if(r===SC.T_OBJECT)return this._registeredSubstates
.indexOf(e)>-1?e:null;if(r!==SC.T_STRING)return this.stateLogError("Can not find matching subtype. value must be an object or string: %@".fmt(e)),null;var i=SC.StatePathMatcher.create({state:this,expression:e}),s=[],o;if(i.get("tokens").length===0)return null;var u=this._registeredSubstatePaths[i.get("lastPart")];if(!u)return this._notifySubstateNotFound(t,n,e);for(o in u)i.match(o)&&s.push(u[o]);if(s.length===1)return s[0];if(s.length>1){var a=[];for(o in u)a.push(o);if(t)return this._notifySubstateNotFound(t,n,e,a);var f="Can not find substate matching '%@' in state %@. Ambiguous with the following: %@";this.stateLogError(f.fmt(e,this.get("fullPath"),a.join(", ")))}return this._notifySubstateNotFound(t,n,e)},_notifySubstateNotFound:function(e,t,n,r){return e?e.call(t||this,this,n,r):null},getState:function(e){return e===this.get("name")?this:SC.kindOf(e,SC.State)?e:this.getSubstate(e,this._handleSubstateNotFound)},_handleSubstateNotFound:function(e,t,n){var r=this.get("parentState");if(r)return r.getState(t);if(n){var i="Can not find state matching '%@'. Ambiguous with the following: %@";this.stateLogError(i.fmt(t,n.join(", ")))}return null},gotoState:function(e,t){var n=this.getState(e);if(!n){var r="can not go to state %@ from state %@. Invalid value.";this.stateLogError(r.fmt(e,this));return}var i=this.findFirstRelativeCurrentState(n);this.get("statechart").gotoState(n,i,!1,t)},gotoHistoryState:function(e,t,n){var r=this.getState(e);if(!r){var i="can not go to history state %@ from state %@. Invalid value.";this.stateLogError(i.fmt(e,this));return}var s=this.findFirstRelativeCurrentState
(r);this.get("statechart").gotoHistoryState(r,s,t,n)},resumeGotoState:function(){this.get("statechart").resumeGotoState()},stateIsCurrentSubstate:function(e){SC.typeOf(e)===SC.T_STRING&&(e=this.get("statechart").getState(e));var t=this.get("currentSubstates");return!!t&&t.indexOf(e)>=0},stateIsEnteredSubstate:function(e){SC.typeOf(e)===SC.T_STRING&&(e=this.get("statechart").getState(e));var t=this.get("enteredSubstates");return!!t&&t.indexOf(e)>=0},isRootState:function(){return this.getPath("statechart.rootState")===this}.property(),isCurrentState:function(){return this.stateIsCurrentSubstate(this)}.property("currentSubstates").cacheable(),isConcurrentState:function(){return this.getPath("parentState.substatesAreConcurrent")}.property(),isEnteredState:function(){return this.stateIsEnteredSubstate(this)}.property("enteredSubstates").cacheable(),hasSubstates:function(){return this.getPath("substates.length")>0}.property("substates"),hasCurrentSubstates:function(){var e=this.get("currentSubstates");return!!e&&e.get("length")>0}.property("currentSubstates").cacheable(),hasEnteredSubstates:function(){var e=this.get("enteredSubstates");return!!e&&e.get("length")>0}.property("enteredSubstates").cacheable(),findFirstRelativeCurrentState:function(e){if(this.get("isCurrentState"))return this;var t=this.get("currentSubstates")||[],n=t.get("length"),r=this.get("parentState");if(n===0)return r?r.findFirstRelativeCurrentState():null;if(n>1){e=this.getSubstate(e);if(e)return e.findFirstRelativeCurrentState()}return t[0]},reenter:function(){this.get("isEnteredState")?this.gotoState(this):SC
.Logger.error("Can not re-enter state %@ since it is not an entered state in the statechart".fmt(this))},tryToHandleEvent:function(e,t,n){var r=this.get("trace"),i=this.get("statechart"),s;if(this._registeredEventHandlers[e])return this.stateLogWarning("state %@ can not handle event '%@' since it is a registered event handler".fmt(this,e)),NO;if(this._registeredStateObserveHandlers[e])return this.stateLogWarning("state %@ can not handle event '%@' since it is a registered state observe handler".fmt(this,e)),NO;if(SC.typeOf(this[e])===SC.T_FUNCTION)return r&&this.stateLogTrace("will handle event '%@'".fmt(e)),i.stateWillTryToHandleEvent(this,e,e),s=this[e](t,n)!==NO,i.stateDidTryToHandleEvent(this,e,e,s),s;var o=this._registeredStringEventHandlers[e];if(o)return r&&this.stateLogTrace("%@ will handle event '%@'".fmt(o.name,e)),i.stateWillTryToHandleEvent(this,e,o.name),s=o.handler.call(this,e,t,n)!==NO,i.stateDidTryToHandleEvent(this,e,o.name,s),s;var u=this._registeredRegExpEventHandlers.length,a=0;for(;a<u;a+=1){o=this._registeredRegExpEventHandlers[a];if(e.match(o.regexp))return r&&this.stateLogTrace("%@ will handle event '%@'".fmt(o.name,e)),i.stateWillTryToHandleEvent(this,e,o.name),s=o.handler.call(this,e,t,n)!==NO,i.stateDidTryToHandleEvent(this,e,o.name,s),s}return SC.typeOf(this.unknownEvent)===SC.T_FUNCTION?(r&&this.stateLogTrace("unknownEvent will handle event '%@'".fmt(e)),i.stateWillTryToHandleEvent(this,e,"unknownEvent"),s=this.unknownEvent(e,t,n)!==NO,i.stateDidTryToHandleEvent(this,e,"unknownEvent",s),s):NO},enterState:function(e){},stateWillBecomeEntered:function(
e){this._isEnteringState=YES},stateDidBecomeEntered:function(e){this._setupAllStateObserveHandlers(),this._isEnteringState=NO},exitState:function(e){},stateWillBecomeExited:function(e){this._isExitingState=YES,this._teardownAllStateObserveHandlers()},stateDidBecomeExited:function(e){this._isExitingState=NO},_setupAllStateObserveHandlers:function(){this._configureAllStateObserveHandlers("addObserver")},_teardownAllStateObserveHandlers:function(){this._configureAllStateObserveHandlers("removeObserver")},_configureAllStateObserveHandlers:function(e){var t,n,r,i,s,o,u,a;for(t in this._registeredStateObserveHandlers){n=this._registeredStateObserveHandlers[t];for(u=0;u<n.length;u+=1)s=n[u],o=t,i=s.indexOf("."),i<0?this[e](s,this,o):s.indexOf("*")===0?this[e](s.slice(1),this,o):(a=null,i===0?(a=this,s=s.slice(1)):i===4&&s.slice(0,5)==="this."?(a=this,s=s.slice(5)):i<0&&s.length===4&&s==="this"&&(a=this,s=""),SC.Observers[e](s,this,o,a))}},performAsync:function(e,t,n){return SC.Async.perform(e,t,n)},respondsToEvent:function(e){if(this._registeredEventHandlers[e])return!1;if(SC.typeOf(this[e])===SC.T_FUNCTION)return!0;if(this._registeredStringEventHandlers[e])return!0;if(this._registeredStateObserveHandlers[e])return!1;var t=this._registeredRegExpEventHandlers.length,n=0,r;for(;n<t;n+=1){r=this._registeredRegExpEventHandlers[n];if(e.match(r.regexp))return!0}return SC.typeOf(this.unknownEvent)===SC.T_FUNCTION},fullPath:function(){var e=this.getPath("statechart.rootState");return e?this.pathRelativeTo(e):this.get("name")}.property("name","parentState").cacheable(),toString:function(){return this
.get("fullPath")},_enteredSubstatesDidChange:function(){this.notifyPropertyChange("enteredSubstates")}.observes("*enteredSubstates.[]"),_currentSubstatesDidChange:function(){this.notifyPropertyChange("currentSubstates")}.observes("*currentSubstates.[]"),_statechartTraceDidChange:function(){this.notifyPropertyChange("trace")},_statechartOwnerDidChange:function(){this.notifyPropertyChange("owner")},stateLogTrace:function(e){var t=this.get("statechart");t.statechartLogTrace("%@: %@".fmt(this,e))},stateLogWarning:function(e){var t=this.get("statechart");t.statechartLogWarning(e)},stateLogError:function(e){var t=this.get("statechart");t.statechartLogError(e)}}),SC.State.plugin=function(e){var t=SC.A(arguments);t.shift();var n=function(){var n=SC.objectForPropertyPath(e);return n?!n.isClass||!n.kindOf(SC.State)?(console.error("SC.State.plugin: Unable to extend. %@ must be a class extending from SC.State".fmt(e)),undefined):n.extend.apply(n,t):(console.error("SC.State.plugin: Unable to determine path %@".fmt(e)),undefined)};return n.statePlugin=YES,n},SC.State.design=SC.State.extend,SC.EMPTY_STATE_NAME="__EMPTY_STATE__",SC.EmptyState=SC.State.extend({name:SC.EMPTY_STATE_NAME,enterState:function(){var e="No initial substate was defined for state %@. Entering default empty state";this.stateLogWarning(e.fmt(this.get("parentState")))}}),SC.HistoryState=SC.Object.extend({isRecursive:NO,defaultState:null,statechart:null,parentState:null,state:function(){var e=this.get("defaultState"),t=this.getPath("parentState.historyState");return t?t:e}.property().cacheable(),parentHistoryStateDidChange
:function(){this.notifyPropertyChange("state")}.observes("*parentState.historyState")}),SC.StateRouteHandlerContext=SC.Object.extend({state:null,location:null,params:null,handler:null,retry:function(){var e=this.get("state"),t=this.get("params"),n=this.get("handler");SC.typeOf(n)===SC.T_STRING&&(n=e[n]),SC.typeOf(n)===SC.T_FUNCTION&&n.apply(e,[t])}}),SC.StatechartManager={isResponderContext:YES,isStatechart:YES,statechartIsInitialized:NO,name:null,rootState:null,rootStateExample:SC.State,initialState:null,statesAreConcurrent:NO,monitorIsActive:NO,monitor:null,statechartTraceKey:"trace",trace:NO,statechartOwnerKey:"owner",owner:null,autoInitStatechart:YES,suppressStatechartWarnings:NO,delegate:null,statechartDelegate:function(){var e=this.get("delegate");return this.delegateFor("isStatechartDelegate",e)}.property("delegate"),routingDelegate:null,eventDelegate:null,routingDelegateValue:function(){var e=this.get("routingDelegate"),t=this.get("delegate");return this.delegateFor("isStatechartRoutingDelegate",e,t)}.property("routingDelegate").cacheable(),initMixin:function(){this.get("autoInitStatechart")&&this.initStatechart()},destroyMixin:function(){var e=this.get("rootState"),t=this.get("statechartTraceKey");this.removeObserver(t,this,"_statechartTraceDidChange"),e.destroy(),this.set("rootState",null)},initStatechart:function(){if(this.get("statechartIsInitialized"))return;this._gotoStateLocked=NO,this._sendEventLocked=NO,this._pendingStateTransitions=[],this._pendingSentEvents=[],this.sendAction=this.sendEvent,this.get("monitorIsActive")&&this.set("monitor",SC.StatechartMonitor
.create({statechart:this}));var e=this.get("statechartTraceKey");this.addObserver(e,this,"_statechartTraceDidChange"),this._statechartTraceDidChange();var t=this.get("allowStatechartTracing"),n=this.get("rootState"),r;t&&this.statechartLogTrace("BEGIN initialize statechart"),n?SC.typeOf(n)===SC.T_FUNCTION&&n.statePlugin&&(n=n.apply(this)):n=this._constructRootStateClass();if(!SC.kindOf(n,SC.State)||!n.isClass)throw r="Unable to initialize statechart. Root state must be a state class",this.statechartLogError(r),r;n=this.createRootState(n,{statechart:this,name:SC.ROOT_STATE_NAME}),this.set("rootState",n),n.initState();if(SC.kindOf(n.get("initialSubstate"),SC.EmptyState))throw r="Unable to initialize statechart. Root state must have an initial substate explicilty defined",this.statechartLogError(r),r;if(!SC.empty(this.get("initialState"))){var i="initialState";this.set(i,n.get(this.get(i)))}this.set("statechartIsInitialized",YES),this.gotoState(n),t&&this.statechartLogTrace("END initialize statechart")},createRootState:function(e,t){return t||(t={}),e=e.create(t),e},currentStates:function(){return this.getPath("rootState.currentSubstates")}.property().cacheable(),firstCurrentState:function(){var e=this.get("currentStates");return e?e.objectAt(0):null}.property("currentStates").cacheable(),currentStateCount:function(){return this.getPath("currentStates.length")}.property("currentStates").cacheable(),stateIsCurrentState:function(e){return this.get("rootState").stateIsCurrentSubstate(e)},enteredStates:function(){return this.getPath("rootState.enteredSubstates")}.property().cacheable
(),stateIsEntered:function(e){return this.get("rootState").stateIsEnteredSubstate(e)},doesContainState:function(e){return!SC.none(this.getState(e))},getState:function(e){var t=this.get("rootState");return t===e?t:t.getSubstate(e)},gotoState:function(e,t,n,r){if(!this.get("statechartIsInitialized")){this.statechartLogError("can not go to state %@. statechart has not yet been initialized".fmt(e));return}if(this.get("isDestroyed")){this.statechartLogError("can not go to state %@. statechart is destroyed".fmt(this));return}var i=this._processGotoStateArgs(arguments);e=i.state,t=i.fromCurrentState,n=i.useHistory,r=i.context;var s=null,o=[],u=[],a=this.get("allowStatechartTracing"),f=this.get("rootState"),l=e,c=t,h;e=this.getState(e);if(SC.none(e)){this.statechartLogError("Can not to goto state %@. Not a recognized state in statechart".fmt(l));return}if(this._gotoStateLocked){this._pendingStateTransitions.push({state:e,fromCurrentState:t,useHistory:n,context:r});return}this._gotoStateLocked=YES;if(t){t=this.getState(t);if(SC.none(t)||!t.get("isCurrentState")){h="Can not to goto state %@. %@ is not a recognized current state in statechart",this.statechartLogError(h.fmt(l,c)),this._gotoStateLocked=NO;return}}else t=e.findFirstRelativeCurrentState(),t||(t=this.get("firstCurrentState"));a&&(this.statechartLogTrace("BEGIN gotoState: %@".fmt(e)),h="starting from current state: %@",h=h.fmt(t?t:"---"),this.statechartLogTrace(h),h="current states before: %@",h=h.fmt(this.getPath("currentStates.length")>0?this.get("currentStates"):"---"),this.statechartLogTrace(h)),SC.none(t)||(o=this._createStateChain
(t)),u=this._createStateChain(e),s=this._findPivotState(o,u);if(s){a&&this.statechartLogTrace("pivot state = %@".fmt(s));if(s.get("substatesAreConcurrent")&&s!==e){this.statechartLogError("Can not go to state %@ from %@. Pivot state %@ has concurrent substates.".fmt(e,t,s)),this._gotoStateLocked=NO;return}}var p=[];this._traverseStatesToExit(o.shift(),o,s,p),s!==e?this._traverseStatesToEnter(u.pop(),u,s,n,p):(this._traverseStatesToExit(s,[],null,p),this._traverseStatesToEnter(s,null,null,n,p)),this._gotoStateActions=p,this._executeGotoStateActions(e,p,null,r)},gotoStateActive:function(){return this._gotoStateLocked}.property(),gotoStateSuspended:function(){return this._gotoStateLocked&&!!this._gotoStateSuspendedPoint}.property(),resumeGotoState:function(){if(!this.get("gotoStateSuspended")){this.statechartLogError("Can not resume goto state since it has not been suspended");return}var e=this._gotoStateSuspendedPoint;this._executeGotoStateActions(e.gotoState,e.actions,e.marker,e.context)},_executeGotoStateActions:function(e,t,n,r){var i=null,s=t.length,o=null;n=SC.none(n)?0:n;for(;n<s;n+=1){this._currentGotoStateAction=i=t[n];switch(i.action){case SC.EXIT_STATE:o=this._exitState(i.state,r);break;case SC.ENTER_STATE:o=this._enterState(i.state,i.currentState,r)}if(SC.kindOf(o,SC.Async)){this._gotoStateSuspendedPoint={gotoState:e,actions:t,marker:n+1,context:r},o.tryToPerform(i.state);return}}this.beginPropertyChanges(),this.notifyPropertyChange("currentStates"),this.notifyPropertyChange("enteredStates"),this.endPropertyChanges(),this.get("allowStatechartTracing")&&(this.statechartLogTrace
("current states after: %@".fmt(this.get("currentStates"))),this.statechartLogTrace("END gotoState: %@".fmt(e))),this._cleanupStateTransition()},_cleanupStateTransition:function(){this._currentGotoStateAction=null,this._gotoStateSuspendedPoint=null,this._gotoStateActions=null,this._gotoStateLocked=NO,this._flushPendingStateTransition()},_exitState:function(e,t){var n;if(e.get("currentSubstates").indexOf(e)>=0){n=e.get("parentState");while(n)n.get("currentSubstates").removeObject(e),n=n.get("parentState")}n=e;while(n)n.get("enteredSubstates").removeObject(e),n=n.get("parentState");this.get("allowStatechartTracing")&&this.statechartLogTrace("<-- exiting state: %@".fmt(e)),e.set("currentSubstates",[]),e.stateWillBecomeExited(t);var r=this.exitState(e,t);return e.stateDidBecomeExited(t),this.get("monitorIsActive")&&this.get("monitor").pushExitedState(e),e._traverseStatesToExit_skipState=NO,r},exitState:function(e,t){return e.exitState(t)},_enterState:function(e,t,n){var r=e.get("parentState");r&&!e.get("isConcurrentState")&&r.set("historyState",e);if(t){r=e;while(r)r.get("currentSubstates").pushObject(e),r=r.get("parentState")}r=e;while(r)r.get("enteredSubstates").pushObject(e),r=r.get("parentState");this.get("allowStatechartTracing")&&this.statechartLogTrace("--> entering state: %@".fmt(e)),e.stateWillBecomeEntered(n);var i=this.enterState(e,n);return e.stateDidBecomeEntered(n),this.get("monitorIsActive")&&this.get("monitor").pushEnteredState(e),i},enterState:function(e,t){return e.enterStateByRoute&&SC.kindOf(t,SC.StateRouteHandlerContext)?e.enterStateByRoute(t):e.enterState(t
)},gotoHistoryState:function(e,t,n,r){if(!this.get("statechartIsInitialized")){this.statechartLogError("can not go to state %@'s history state. Statechart has not yet been initialized".fmt(e));return}var i=this._processGotoStateArgs(arguments);e=i.state,t=i.fromCurrentState,n=i.useHistory,r=i.context,e=this.getState(e);if(!e){this.statechartLogError("Can not to goto state %@'s history state. Not a recognized state in statechart".fmt(e));return}var s=e.get("historyState");n?this.gotoState(e,t,YES,r):s?this.gotoState(s,t,r):this.gotoState(e,t,r)},sendEvent:function(e,t,n){if(this.get("isDestroyed")){this.statechartLogError("can send event %@. statechart is destroyed".fmt(e));return}var r=NO,i=this.get("currentStates").slice(),s={},o=[],u=NO,a=0,f=0,l=null,c=this.get("allowStatechartTracing");if(this._sendEventLocked||this._goStateLocked){this._pendingSentEvents.push({event:e,arg1:t,arg2:n});return}this._sendEventLocked=YES;var h=this.get("eventDelegate");h&&(r=h.sendEvent(e,t,n),r&&c&&this.statechartLogTrace("eventDelegate handled event: '%@'".fmt(e)));if(!r){c&&this.statechartLogTrace("BEGIN sendEvent: '%@'".fmt(e)),a=i.get("length");for(;f<a;f+=1){l=i[f];if(!l.get("isCurrentState"))continue;while(l){var p=SC.hashFor(l);if(l.get("substatesAreConcurrent")){s[p]?s[p]++:s[p]=1;if(s[p]<l.substates.length||o.indexOf(l)!=-1)break}u=l.tryToHandleEvent(e,t,n),r=r||u;var d=l.get("parentState");u&&d&&d.get("substatesAreConcurrent")&&o.push(d);if(u)break;l=l.get("parentState")}}c&&(r||this.statechartLogTrace("No state was able handle event %@".fmt(e)),this.statechartLogTrace("END sendEvent: '%@'"
.fmt(e)))}this._sendEventLocked=NO;var v=this._flushPendingSentEvents();return r?this:v?this:null},stateWillTryToHandleEvent:function(e,t,n){this._stateHandleEventInfo={state:e,event:t,handler:n}},stateDidTryToHandleEvent:function(e,t,n,r){this._stateHandleEventInfo=null},_createStateChain:function(e){var t=[];while(e)t.push(e),e=e.get("parentState");return t},_findPivotState:function(e,t){if(e.length===0||t.length===0)return null;var n=e.find(function(e,n){if(t.indexOf(e)>=0)return YES});return n},_traverseStatesToExit:function(e,t,n,r){if(!e||e===n)return;var i=this.get("allowStatechartTracing");if(e.get("substatesAreConcurrent")){var s=0,o=e.get("currentSubstates"),u=o.length,a=null;for(;s<u;s+=1){a=o[s];if(a._traverseStatesToExit_skipState===YES)continue;var f=this._createStateChain(a);this._traverseStatesToExit(f.shift(),f,e,r)}}r.push({action:SC.EXIT_STATE,state:e}),e.get("isCurrentState")&&(e._traverseStatesToExit_skipState=YES),this._traverseStatesToExit(t.shift(),t,n,r)},_traverseStatesToEnter:function(e,t,n,r,i){if(!e)return;var s=this.get("allowStatechartTracing");if(n)e!==n?this._traverseStatesToEnter(t.pop(),t,n,r,i):this._traverseStatesToEnter(t.pop(),t,null,r,i);else if(!t||t.length===0){var o={action:SC.ENTER_STATE,state:e,currentState:NO};i.push(o);var u=e.get("initialSubstate"),a=e.get("historyState");e.get("substatesAreConcurrent")?this._traverseConcurrentStatesToEnter(e.get("substates"),null,r,i):e.get("hasSubstates")&&a&&r?this._traverseStatesToEnter(a,null,null,r,i):u?(SC.kindOf(u,SC.HistoryState)&&(r||(r=u.get("isRecursive")),u=u.get("state")),this._traverseStatesToEnter
(u,null,null,r,i)):o.currentState=YES}else if(t.length>0){i.push({action:SC.ENTER_STATE,state:e});var f=t.pop();this._traverseStatesToEnter(f,t,null,r,i),e.get("substatesAreConcurrent")&&this._traverseConcurrentStatesToEnter(e.get("substates"),f,r,i)}},respondsTo:function(e){var t=this.get("currentStates"),n=t.get("length"),r=0,i=null;for(;r<n;r+=1){i=t.objectAt(r);while(i){if(i.respondsToEvent(e))return!0;i=i.get("parentState")}}return SC.typeOf(this[e])===SC.T_FUNCTION},invokeStateMethod:function(e,t,n){if(e==="unknownEvent"){this.statechartLogError("can not invoke method unkownEvent");return}t=SC.A(arguments),t.shift();var r=t.length,i=r>0?t[r-1]:null,s=SC.typeOf(i)===SC.T_FUNCTION?t.pop():null,o=this.get("currentStates"),u=0,a=null,f={},l,c=undefined,h=0;r=o.get("length");for(;u<r;u+=1){a=o.objectAt(u);while(a){if(f[a.get("fullPath")])break;f[a.get("fullPath")]=YES,l=a[e];if(SC.typeOf(l)===SC.T_FUNCTION&&!l.isEventHandler){c=l.apply(a,t),s&&s.call(this,a,c),h+=1;break}a=a.get("parentState")}}return h===1?c:undefined},_traverseConcurrentStatesToEnter:function(e,t,n,r){var i=0,s=e.length,o=null;for(;i<s;i+=1)o=e[i],o!==t&&this._traverseStatesToEnter(o,null,null,n,r)},_flushPendingStateTransition:function(){if(!this._pendingStateTransitions){this.statechartLogError("Unable to flush pending state transition. _pendingStateTransitions is invalid");return}var e=this._pendingStateTransitions.shift();if(!e)return;this.gotoState(e.state,e.fromCurrentState,e.useHistory,e.context)},_flushPendingSentEvents:function(){var e=this._pendingSentEvents.shift();return e?this.sendEvent(e.event
,e.arg1,e.arg2):null},_monitorIsActiveDidChange:function(){this.get("monitorIsActive")&&SC.none(this.get("monitor"))&&this.set("monitor",SC.StatechartMonitor.create())}.observes("monitorIsActive"),_processGotoStateArgs:function(e){var t={state:null,fromCurrentState:null,useHistory:!1,context:null},n=null,r=null;e=SC.$A(e),e=e.filter(function(e){return e!==undefined}),n=e.length;if(n<1)return t;t.state=e[0];if(n===2){r=e[1];switch(SC.typeOf(r)){case SC.T_BOOL:t.useHistory=r;break;case SC.T_HASH:case SC.T_OBJECT:SC.kindOf(r,SC.State)||(t.context=r);break;default:t.fromCurrentState=r}}else n===3?(r=e[1],SC.typeOf(r)===SC.T_BOOL?(t.useHistory=r,t.context=e[2]):(t.fromCurrentState=r,r=e[2],SC.typeOf(r)===SC.T_BOOL?t.useHistory=r:t.context=r)):(t.fromCurrentState=e[1],t.useHistory=e[2],t.context=e[3]);return t},_constructRootStateClass:function(){var e="rootStateExample",t=this.get(e),n=this.get("initialState"),r=this.get("statesAreConcurrent"),i=0,s,o,u,a={};SC.typeOf(t)===SC.T_FUNCTION&&t.statePlugin&&(t=t.apply(this));if(!SC.kindOf(t,SC.State)||!t.isClass)return this._logStatechartCreationError("Invalid root state example"),null;if(r&&!SC.empty(n))this._logStatechartCreationError("Can not assign an initial state when states are concurrent");else if(r)a.substatesAreConcurrent=YES;else{if(SC.typeOf(n)!==SC.T_STRING)return this._logStatechartCreationError("Must either define initial state or assign states as concurrent"),null;a.initialSubstate=n}for(s in this){if(s===e)continue;o=this[s],u=SC.typeOf(o)===SC.T_FUNCTION,u&&o.statePlugin&&(o=o.apply(this)),SC.kindOf(o,SC.State)&&o.isClass&&
this[s]!==this.constructor&&(a[s]=o,i+=1)}return i===0?(this._logStatechartCreationError("Must define one or more states"),null):t.extend(a)},_logStatechartCreationError:function(e){SC.Logger.error("Unable to create statechart for %@: %@.".fmt(this,e))},statechartLogTrace:function(e){SC.Logger.info("%@: %@".fmt(this.get("statechartLogPrefix"),e))},statechartLogError:function(e){SC.Logger.error("ERROR %@: %@".fmt(this.get("statechartLogPrefix"),e))},statechartLogWarning:function(e){if(this.get("suppressStatechartWarnings"))return;SC.Logger.warn("WARN %@: %@".fmt(this.get("statechartLogPrefix"),e))},statechartLogPrefix:function(){var e=SC._object_className(this.constructor),t=this.get("name"),n;return SC.empty(t)?n="%@<%@>".fmt(e,SC.guidFor(this)):n="%@<%@, %@>".fmt(e,t,SC.guidFor(this)),n}.property().cacheable(),allowStatechartTracing:function(){var e=this.get("statechartTraceKey");return this.get(e)}.property().cacheable(),_statechartTraceDidChange:function(){this.notifyPropertyChange("allowStatechartTracing")},details:function(){var e={initialized:this.get("statechartIsInitialized")};this.get("name")&&(e.name=this.get("name"));if(!this.get("statechartIsInitialized"))return e;e["current-states"]=[],this.get("currentStates").forEach(function(t){e["current-states"].push(t.get("fullPath"))});var t={active:this.get("gotoStateActive"),suspended:this.get("gotoStateSuspended")};if(this._gotoStateActions){t["transition-sequence"]=[];var n=this._gotoStateActions,r=function(e){var t=e.action===SC.ENTER_STATE?"enter":"exit";return"%@ %@".fmt(t,e.state.get("fullPath"))};n.forEach(function(
e){t["transition-sequence"].push(r(e))}),t["current-transition"]=r(this._currentGotoStateAction)}e["state-transition"]=t;if(this._stateHandleEventInfo){var i=this._stateHandleEventInfo;e["handling-event"]={state:i.state.get("fullPath"),event:i.event,handler:i.handler}}else e["handling-event"]=!1;return e}.property(),toStringWithDetails:function(){var e="",t=this.toString(),n=this.get("details");return e+=t+"\n",e+=this._hashToString(n,2),e},_hashToString:function(e,t){var n="";for(var r in e){var i=e[r];i instanceof Array?n+=this._arrayToString(r,i,t)+"\n":i instanceof Object?(n+="%@%@:\n".fmt(" ".mult(t),r),n+=this._hashToString(i,t+2)):n+="%@%@: %@\n".fmt(" ".mult(t),r,i)}return n},_arrayToString:function(e,t,n){if(t.length===0)return"%@%@: []".fmt(" ".mult(n),e);var r="%@%@: [\n".fmt(" ".mult(n),e);return t.forEach(function(e,t){r+="%@%@\n".fmt(" ".mult(n+2),e)},this),r+=" ".mult(n)+"]",r}},SC.supplement(SC.StatechartManager,SC.StatechartRoutingDelegate,SC.StatechartEventDelegate,SC.DelegateSupport),SC.ROOT_STATE_NAME="__ROOT_STATE__",SC.EXIT_STATE=0,SC.ENTER_STATE=1,SC.Statechart=SC.Object.extend(SC.StatechartManager,{autoInitStatechart:NO}),SC.Statechart.design=SC.Statechart.extend,function(){function e(){if(e.is(arguments[0],_)){var t=arguments[0],r=$t[h](e,t.splice(0,3+e.is(t[0],O))),i=r.set();for(var o=0,u=t[S];o<u;o++){var a=t[o]||{};n[s](a.type)&&i[j](r[a.type]().attr(a))}return i}return $t[h](e,arguments)}function ut(){return"r-"+CW.UUID()}function ht(e,t,n){function r(){var o=Array[i].slice.call(arguments,0),u=o[E]("►"),a=r.cache=r.cache||{},f=r.count=r.count||[]
;return a[s](u)?n?n(a[u]):a[u]:(f[S]>=1e3&&delete a[f.shift()],f[j](u),a[u]=e[h](t,o),n?n(a[u]):a[u])}return r}function mn(){return this.x+m+this.y}function Ln(t){return function(n,r,i,s){var o={back:t};return e.is(i,"function")?s=i:o.rot=i,n&&n.constructor==It&&(n=n.attrs.path),n&&(o.along=n),this.animate(o,r,s)}}function An(e,t,n,r,i,s){function h(e){return((a*e+u)*e+o)*e}function p(e,t){var n=d(e,t);return((c*n+l)*n+f)*n}function d(e,t){var n,r,i,s,f,l;for(i=e,l=0;l<8;l++){s=h(i)-e;if(k(s)<t)return i;f=(3*a*i+2*u)*i+o;if(k(f)<1e-6)break;i-=s/f}n=0,r=1,i=e;if(i<n)return n;if(i>r)return r;while(n<r){s=h(i);if(k(s-e)<t)return i;e>s?n=i:r=i,i=(r-n)/2+n}return i}var o=3*t,u=3*(r-t)-o,a=1-o-u,f=3*n,l=3*(i-n)-f,c=1-f-l;return p(e,1/(200*s))}e.version="1.5.2";var t=/[, ]+/,n={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},r=/\{(\d+)\}/g,i="prototype",s="hasOwnProperty",o=document,u=window,a={was:Object[i][s].call(u,"Raphael"),is:u.Raphael},f=function(){this.customAttributes={}},l,c="appendChild",h="apply",p="concat",d="createTouch"in o,v="",m=" ",g=String,y="split",b="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend orientationchange touchcancel gesturestart gesturechange gestureend"[y](m),w={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},E="join",S="length",x=g[i].toLowerCase,T=Math,N=T.max,C=T.min,k=T.abs,L=T.pow,A=T.PI,O="number",M="string",_="array",D="toString",P="fill",H=Object[i][D],B={},j="push",F=/^url\(['"]?([^\)]+?)['"]?\)$/i,I=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i
,q={NaN:1,Infinity:1,"-Infinity":1},R=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,U=T.round,z="setAttribute",W=parseFloat,X=parseInt,V=" progid:DXImageTransform.Microsoft",$=g[i].toUpperCase,J={blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/",opacity:1,path:"M0,0",r:0,rotation:0,rx:0,ry:0,scale:"1 1",src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",translation:"0 0",width:0,x:0,y:0},K={along:"along",blur:O,"clip-rect":"csv",cx:O,cy:O,fill:"colour","fill-opacity":O,"font-size":O,height:O,opacity:O,path:"path",r:O,rotation:"csv",rx:O,ry:O,scale:"csv",stroke:"colour","stroke-opacity":O,"stroke-width":O,translation:"csv",width:O,x:O,y:O},Q="replace",G=/^(from|to|\d+%?)$/,Y=/\s*,\s*/,Z={hs:1,rg:1},et=/,?([achlmqrstvxz]),?/gi,tt=/([achlmqstvz])[\s,]*((-?\d*\.?\d*(?:e[-+]?\d+)?\s*,?\s*)+)/ig,nt=/(-?\d*\.?\d*(?:e[-+]?\d+)?)\s*,?\s*/ig,rt=/^r(?:\(([^,]+?)\s*,\s*([^\)]+?)\))?/,it=function(e,t){return e.key-t.key};e.type=u.SVGAngle||o.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML";if(e.type=="VML"){var st=o.createElement("div"),ot;st.innerHTML='<v:shape adj="1"/>',ot=st.firstChild,ot.style.behavior="url(#default#VML)";if(!ot||typeof ot.adj!="object")return e.type=null;st=null}e.svg=!(
e.vml=e.type=="VML"),f[i]=e[i],l=f[i],e._id=0,e._oid=0,e.fn={},e.is=function(e,t){return t=x.call(t),t=="finite"?!q[s](+e):t=="null"&&e===null||t==typeof e||t=="object"&&e===Object(e)||t=="array"&&Array.isArray&&Array.isArray(e)||H.call(e).slice(8,-1).toLowerCase()==t},e.angle=function(t,n,r,i,s,o){if(s==null){var u=t-r,a=n-i;return!u&&!a?0:((u<0)*180+T.atan(-a/-u)*180/A+360)%360}return e.angle(t,n,s,o)-e.angle(r,i,s,o)},e.rad=function(e){return e%360*A/180},e.deg=function(e){return e*180/A%360},e.snapTo=function(t,n,r){r=e.is(r,"finite")?r:10;if(e.is(t,_)){var i=t.length;while(i--)if(k(t[i]-n)<=r)return t[i]}else{t=+t;var s=n%t;if(s<r)return n-s;if(s>t-r)return n-s+t}return n},e.setWindow=function(e){u=e,o=u.document};var at=function(t){if(e.vml){var n=/^\s+|\s+$/g,r;try{var i=new ActiveXObject("htmlfile");i.write("<body>"),i.close(),r=i.body}catch(s){r=createPopup().document.body}var u=r.createTextRange();at=ht(function(e){try{r.style.color=g(e)[Q](n,v);var t=u.queryCommandValue("ForeColor");return t=(t&255)<<16|t&65280|(t&16711680)>>>16,"#"+("000000"+t[D](16)).slice(-6)}catch(i){return"none"}})}else{var a=o.createElement("i");a.title="Raphaël Colour Picker",a.style.display="none",o.body[c](a),at=ht(function(e){return a.style.color=e,o.defaultView.getComputedStyle(a,v).getPropertyValue("color")})}return at(t)},ft=function(){return"hsb("+[this.h,this.s,this.b]+")"},lt=function(){return"hsl("+[this.h,this.s,this.l]+")"},ct=function(){return this.hex};e.hsb2rgb=function(t,n,r,i){return e.is(t,"object")&&"h"in t&&"s"in t&&"b"in t&&(r=t.b,n=t.s,t=t.h,i=t.o),e.hsl2rgb(t,n,r/2,i)
},e.hsl2rgb=function(t,n,r,i){e.is(t,"object")&&"h"in t&&"s"in t&&"l"in t&&(r=t.l,n=t.s,t=t.h);if(t>1||n>1||r>1)t/=360,n/=100,r/=100;var s={},o=["r","g","b"],u,a,f,l,c,h;if(!n)s={r:r,g:r,b:r};else{r<.5?u=r*(1+n):u=r+n-r*n,a=2*r-u;for(var p=0;p<3;p++)f=t+1/3*-(p-1),f<0&&f++,f>1&&f--,f*6<1?s[o[p]]=a+(u-a)*6*f:f*2<1?s[o[p]]=u:f*3<2?s[o[p]]=a+(u-a)*(2/3-f)*6:s[o[p]]=a}return s.r*=255,s.g*=255,s.b*=255,s.hex="#"+(16777216|s.b|s.g<<8|s.r<<16).toString(16).slice(1),e.is(i,"finite")&&(s.opacity=i),s.toString=ct,s},e.rgb2hsb=function(t,n,r){n==null&&e.is(t,"object")&&"r"in t&&"g"in t&&"b"in t&&(r=t.b,n=t.g,t=t.r);if(n==null&&e.is(t,M)){var i=e.getRGB(t);t=i.r,n=i.g,r=i.b}if(t>1||n>1||r>1)t/=255,n/=255,r/=255;var s=N(t,n,r),o=C(t,n,r),u,a,f=s;if(o==s)return{h:0,s:0,b:s,toString:ft};var l=s-o;return a=l/s,t==s?u=(n-r)/l:n==s?u=2+(r-t)/l:u=4+(t-n)/l,u/=6,u<0&&u++,u>1&&u--,{h:u,s:a,b:f,toString:ft}},e.rgb2hsl=function(t,n,r){n==null&&e.is(t,"object")&&"r"in t&&"g"in t&&"b"in t&&(r=t.b,n=t.g,t=t.r);if(n==null&&e.is(t,M)){var i=e.getRGB(t);t=i.r,n=i.g,r=i.b}if(t>1||n>1||r>1)t/=255,n/=255,r/=255;var s=N(t,n,r),o=C(t,n,r),u,a,f=(s+o)/2,l;if(o==s)l={h:0,s:0,l:f};else{var c=s-o;a=f<.5?c/(s+o):c/(2-s-o),t==s?u=(n-r)/c:n==s?u=2+(r-t)/c:u=4+(t-n)/c,u/=6,u<0&&u++,u>1&&u--,l={h:u,s:a,l:f}}return l.toString=lt,l},e._path2string=function(){return this.join(",")[Q](et,"$1")},e.getRGB=ht(function(t){if(!t||!!((t=g(t)).indexOf("-")+1))return{r:-1,g:-1,b:-1,hex:"none",error:1};if(t=="none")return{r:-1,g:-1,b:-1,hex:"none"};!Z[s](t.toLowerCase().substring(0,2))&&t.charAt()!="#"&&(t=at(t));var n,r,i,o,u,a,
f,l=t.match(I);return l?(l[2]&&(o=X(l[2].substring(5),16),i=X(l[2].substring(3,5),16),r=X(l[2].substring(1,3),16)),l[3]&&(o=X((a=l[3].charAt(3))+a,16),i=X((a=l[3].charAt(2))+a,16),r=X((a=l[3].charAt(1))+a,16)),l[4]&&(f=l[4][y](Y),r=W(f[0]),f[0].slice(-1)=="%"&&(r*=2.55),i=W(f[1]),f[1].slice(-1)=="%"&&(i*=2.55),o=W(f[2]),f[2].slice(-1)=="%"&&(o*=2.55),l[1].toLowerCase().slice(0,4)=="rgba"&&(u=W(f[3])),f[3]&&f[3].slice(-1)=="%"&&(u/=100)),l[5]?(f=l[5][y](Y),r=W(f[0]),f[0].slice(-1)=="%"&&(r*=2.55),i=W(f[1]),f[1].slice(-1)=="%"&&(i*=2.55),o=W(f[2]),f[2].slice(-1)=="%"&&(o*=2.55),(f[0].slice(-3)=="deg"||f[0].slice(-1)=="°")&&(r/=360),l[1].toLowerCase().slice(0,4)=="hsba"&&(u=W(f[3])),f[3]&&f[3].slice(-1)=="%"&&(u/=100),e.hsb2rgb(r,i,o,u)):l[6]?(f=l[6][y](Y),r=W(f[0]),f[0].slice(-1)=="%"&&(r*=2.55),i=W(f[1]),f[1].slice(-1)=="%"&&(i*=2.55),o=W(f[2]),f[2].slice(-1)=="%"&&(o*=2.55),(f[0].slice(-3)=="deg"||f[0].slice(-1)=="°")&&(r/=360),l[1].toLowerCase().slice(0,4)=="hsla"&&(u=W(f[3])),f[3]&&f[3].slice(-1)=="%"&&(u/=100),e.hsl2rgb(r,i,o,u)):(l={r:r,g:i,b:o},l.hex="#"+(16777216|o|i<<8|r<<16).toString(16).slice(1),e.is(u,"finite")&&(l.opacity=u),l)):{r:-1,g:-1,b:-1,hex:"none",error:1}},e),e.getColor=function(e){var t=this.getColor.start=this.getColor.start||{h:0,s:1,b:e||.75},n=this.hsb2rgb(t.h,t.s,t.b);return t.h+=.075,t.h>1&&(t.h=0,t.s-=.2,t.s<=0&&(this.getColor.start={h:0,s:1,b:t.b})),n.hex},e.getColor.reset=function(){delete this.start},e.parsePathString=ht(function(t){if(!t)return null;var n={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},r=[];return e.is(t,_)&&e.is(t[0],_)&&(r=dt(t)),
r[S]||g(t)[Q](tt,function(e,t,i){var s=[],o=x.call(t);i[Q](nt,function(e,t){t&&s[j](+t)}),o=="m"&&s[S]>2&&(r[j]([t][p](s.splice(0,2))),o="l",t=t=="m"?"l":"L");while(s[S]>=n[o]){r[j]([t][p](s.splice(0,n[o])));if(!n[o])break}}),r[D]=e._path2string,r}),e.findDotsAtSegment=function(e,t,n,r,i,s,o,u,a){var f=1-a,l=L(f,3)*e+L(f,2)*3*a*n+f*3*a*a*i+L(a,3)*o,c=L(f,3)*t+L(f,2)*3*a*r+f*3*a*a*s+L(a,3)*u,h=e+2*a*(n-e)+a*a*(i-2*n+e),p=t+2*a*(r-t)+a*a*(s-2*r+t),d=n+2*a*(i-n)+a*a*(o-2*i+n),v=r+2*a*(s-r)+a*a*(u-2*s+r),m=(1-a)*e+a*n,g=(1-a)*t+a*r,y=(1-a)*i+a*o,b=(1-a)*s+a*u,w=90-T.atan((h-d)/(p-v))*180/A;return(h>d||p<v)&&(w+=180),{x:l,y:c,m:{x:h,y:p},n:{x:d,y:v},start:{x:m,y:g},end:{x:y,y:b},alpha:w}};var pt=ht(function(e){if(!e)return{x:0,y:0,width:0,height:0};e=St(e);var t=0,n=0,r=[],i=[],s;for(var o=0,u=e[S];o<u;o++){s=e[o];if(s[0]=="M")t=s[1],n=s[2],r[j](t),i[j](n);else{var a=Et(t,n,s[1],s[2],s[3],s[4],s[5],s[6]);r=r[p](a.min.x,a.max.x),i=i[p](a.min.y,a.max.y),t=s[5],n=s[6]}}var f=C[h](0,r),l=C[h](0,i);return{x:f,y:l,width:N[h](0,r)-f,height:N[h](0,i)-l}}),dt=function(t){var n=[];if(!e.is(t,_)||!e.is(t&&t[0],_))t=e.parsePathString(t);for(var r=0,i=t[S];r<i;r++){n[r]=[];for(var s=0,o=t[r][S];s<o;s++)n[r][s]=t[r][s]}return n[D]=e._path2string,n},vt=ht(function(t){if(!e.is(t,_)||!e.is(t&&t[0],_))t=e.parsePathString(t);var n=[],r=0,i=0,s=0,o=0,u=0;t[0][0]=="M"&&(r=t[0][1],i=t[0][2],s=r,o=i,u++,n[j](["M",r,i]));for(var a=u,f=t[S];a<f;a++){var l=n[a]=[],c=t[a];if(c[0]!=x.call(c[0])){l[0]=x.call(c[0]);switch(l[0]){case"a":l[1]=c[1],l[2]=c[2],l[3]=c[3],l[4]=c[4],l[5]=c[5],l[6]=+(c[6]-r).toFixed(3
),l[7]=+(c[7]-i).toFixed(3);break;case"v":l[1]=+(c[1]-i).toFixed(3);break;case"m":s=c[1],o=c[2];default:for(var h=1,p=c[S];h<p;h++)l[h]=+(c[h]-(h%2?r:i)).toFixed(3)}}else{l=n[a]=[],c[0]=="m"&&(s=c[1]+r,o=c[2]+i);for(var d=0,v=c[S];d<v;d++)n[a][d]=c[d]}var m=n[a][S];switch(n[a][0]){case"z":r=s,i=o;break;case"h":r+=+n[a][m-1];break;case"v":i+=+n[a][m-1];break;default:r+=+n[a][m-2],i+=+n[a][m-1]}}return n[D]=e._path2string,n},0,dt),mt=ht(function(t){if(!e.is(t,_)||!e.is(t&&t[0],_))t=e.parsePathString(t);var n=[],r=0,i=0,s=0,o=0,u=0;t[0][0]=="M"&&(r=+t[0][1],i=+t[0][2],s=r,o=i,u++,n[0]=["M",r,i]);for(var a=u,f=t[S];a<f;a++){var l=n[a]=[],c=t[a];if(c[0]!=$.call(c[0])){l[0]=$.call(c[0]);switch(l[0]){case"A":l[1]=c[1],l[2]=c[2],l[3]=c[3],l[4]=c[4],l[5]=c[5],l[6]=+(c[6]+r),l[7]=+(c[7]+i);break;case"V":l[1]=+c[1]+i;break;case"H":l[1]=+c[1]+r;break;case"M":s=+c[1]+r,o=+c[2]+i;default:for(var h=1,p=c[S];h<p;h++)l[h]=+c[h]+(h%2?r:i)}}else for(var d=0,v=c[S];d<v;d++)n[a][d]=c[d];switch(l[0]){case"Z":r=s,i=o;break;case"H":r=l[1];break;case"V":i=l[1];break;case"M":s=n[a][n[a][S]-2],o=n[a][n[a][S]-1];default:r=n[a][n[a][S]-2],i=n[a][n[a][S]-1]}}return n[D]=e._path2string,n},null,dt),gt=function(e,t,n,r){return[e,t,n,r,n,r]},yt=function(e,t,n,r,i,s){var o=1/3,u=2/3;return[o*e+u*n,o*t+u*r,o*i+u*n,o*s+u*r,i,s]},bt=function(e,t,n,r,i,s,o,u,a,f){var l=A*120/180,c=A/180*(+i||0),h=[],d,v=ht(function(e,t,n){var r=e*T.cos(n)-t*T.sin(n),i=e*T.sin(n)+t*T.cos(n);return{x:r,y:i}});if(!f){d=v(e,t,-c),e=d.x,t=d.y,d=v(u,a,-c),u=d.x,a=d.y;var m=T.cos(A/180*i),g=T.sin(A/180*i),b=(e-u)/2,w=(t-a)/2,x=b*b/(n*n)+
w*w/(r*r);x>1&&(x=T.sqrt(x),n=x*n,r=x*r);var N=n*n,C=r*r,L=(s==o?-1:1)*T.sqrt(k((N*C-N*w*w-C*b*b)/(N*w*w+C*b*b))),O=L*n*w/r+(e+u)/2,M=L*-r*b/n+(t+a)/2,_=T.asin(((t-M)/r).toFixed(9)),D=T.asin(((a-M)/r).toFixed(9));_=e<O?A-_:_,D=u<O?A-D:D,_<0&&(_=A*2+_),D<0&&(D=A*2+D),o&&_>D&&(_-=A*2),!o&&D>_&&(D-=A*2)}else _=f[0],D=f[1],O=f[2],M=f[3];var P=D-_;if(k(P)>l){var H=D,B=u,j=a;D=_+l*(o&&D>_?1:-1),u=O+n*T.cos(D),a=M+r*T.sin(D),h=bt(u,a,n,r,i,0,o,B,j,[D,H,O,M])}P=D-_;var F=T.cos(_),I=T.sin(_),q=T.cos(D),R=T.sin(D),U=T.tan(P/4),z=4/3*n*U,W=4/3*r*U,X=[e,t],V=[e+z*I,t-W*F],$=[u+z*R,a-W*q],J=[u,a];V[0]=2*X[0]-V[0],V[1]=2*X[1]-V[1];if(f)return[V,$,J][p](h);h=[V,$,J][p](h)[E]()[y](",");var K=[];for(var Q=0,G=h[S];Q<G;Q++)K[Q]=Q%2?v(h[Q-1],h[Q],c).y:v(h[Q],h[Q+1],c).x;return K},wt=function(e,t,n,r,i,s,o,u,a){var f=1-a;return{x:L(f,3)*e+L(f,2)*3*a*n+f*3*a*a*i+L(a,3)*o,y:L(f,3)*t+L(f,2)*3*a*r+f*3*a*a*s+L(a,3)*u}},Et=ht(function(e,t,n,r,i,s,o,u){var a=i-2*n+e-(o-2*i+n),f=2*(n-e)-2*(i-n),l=e-n,c=(-f+T.sqrt(f*f-4*a*l))/2/a,p=(-f-T.sqrt(f*f-4*a*l))/2/a,d=[t,u],v=[e,o],m;return k(c)>"1e12"&&(c=.5),k(p)>"1e12"&&(p=.5),c>0&&c<1&&(m=wt(e,t,n,r,i,s,o,u,c),v[j](m.x),d[j](m.y)),p>0&&p<1&&(m=wt(e,t,n,r,i,s,o,u,p),v[j](m.x),d[j](m.y)),a=s-2*r+t-(u-2*s+r),f=2*(r-t)-2*(s-r),l=t-r,c=(-f+T.sqrt(f*f-4*a*l))/2/a,p=(-f-T.sqrt(f*f-4*a*l))/2/a,k(c)>"1e12"&&(c=.5),k(p)>"1e12"&&(p=.5),c>0&&c<1&&(m=wt(e,t,n,r,i,s,o,u,c),v[j](m.x),d[j](m.y)),p>0&&p<1&&(m=wt(e,t,n,r,i,s,o,u,p),v[j](m.x),d[j](m.y)),{min:{x:C[h](0,v),y:C[h](0,d)},max:{x:N[h](0,v),y:N[h](0,d)}}}),St=ht(function(e,t){var n=mt(e),r=t&&mt(t),i={x:0,y:0,bx:0,by
:0,X:0,Y:0,qx:null,qy:null},s={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o=function(e,t){var n,r;if(!e)return["C",t.x,t.y,t.x,t.y,t.x,t.y];!(e[0]in{T:1,Q:1})&&(t.qx=t.qy=null);switch(e[0]){case"M":t.X=e[1],t.Y=e[2];break;case"A":e=["C"][p](bt[h](0,[t.x,t.y][p](e.slice(1))));break;case"S":n=t.x+(t.x-(t.bx||t.x)),r=t.y+(t.y-(t.by||t.y)),e=["C",n,r][p](e.slice(1));break;case"T":t.qx=t.x+(t.x-(t.qx||t.x)),t.qy=t.y+(t.y-(t.qy||t.y)),e=["C"][p](yt(t.x,t.y,t.qx,t.qy,e[1],e[2]));break;case"Q":t.qx=e[1],t.qy=e[2],e=["C"][p](yt(t.x,t.y,e[1],e[2],e[3],e[4]));break;case"L":e=["C"][p](gt(t.x,t.y,e[1],e[2]));break;case"H":e=["C"][p](gt(t.x,t.y,e[1],t.y));break;case"V":e=["C"][p](gt(t.x,t.y,t.x,e[1]));break;case"Z":e=["C"][p](gt(t.x,t.y,t.X,t.Y))}return e},u=function(e,t){if(e[t][S]>7){e[t].shift();var i=e[t];while(i[S])e.splice(t++,0,["C"][p](i.splice(0,6)));e.splice(t,1),l=N(n[S],r&&r[S]||0)}},a=function(e,t,i,s,o){e&&t&&e[o][0]=="M"&&t[o][0]!="M"&&(t.splice(o,0,["M",s.x,s.y]),i.bx=0,i.by=0,i.x=e[o][1],i.y=e[o][2],l=N(n[S],r&&r[S]||0))};for(var f=0,l=N(n[S],r&&r[S]||0);f<l;f++){n[f]=o(n[f],i),u(n,f),r&&(r[f]=o(r[f],s)),r&&u(r,f),a(n,r,i,s,f),a(r,n,s,i,f);var c=n[f],d=r&&r[f],v=c[S],m=r&&d[S];i.x=c[v-2],i.y=c[v-1],i.bx=W(c[v-4])||i.x,i.by=W(c[v-3])||i.y,s.bx=r&&(W(d[m-4])||s.x),s.by=r&&(W(d[m-3])||s.y),s.x=r&&d[m-2],s.y=r&&d[m-1]}return r?[n,r]:n},null,dt),xt=ht(function(t){var n=[];for(var r=0,i=t[S];r<i;r++){var s={},o=t[r].match(/^([^:]*):?([\d\.]*)/);s.color=e.getRGB(o[1]);if(s.color.error)return null;s.color=s.color.hex,o[2]&&(s.offset=o[2]+"%"),n[j](s)}for(r=1,i=n[S]-1;r<i;r++)if(!
n[r].offset){var u=W(n[r-1].offset||0),a=0;for(var f=r+1;f<i;f++)if(n[f].offset){a=n[f].offset;break}a||(a=100,f=i),a=W(a);var l=(a-u)/(f-r+1);for(;r<f;r++)u+=l,n[r].offset=u+"%"}return n}),Tt=function(t,n,r,i){var s;if(!e.is(t,M)&&!e.is(t,"object"))return{container:1,x:t,y:n,width:r,height:i};s=e.is(t,M)?o.getElementById(t):t;if(s.tagName)return n==null?{container:s,width:s.style.pixelWidth||s.offsetWidth,height:s.style.pixelHeight||s.offsetHeight}:{container:s,width:n,height:r}},Nt=function(e,t){var n=this;for(var r in t)if(t[s](r)&&!(r in e))switch(typeof t[r]){case"function":(function(t){e[r]=e===n?t:function(){return t[h](n,arguments)}})(t[r]);break;case"object":e[r]=e[r]||{},Nt.call(this,e[r],t[r]);break;default:e[r]=t[r]}},Ct=function(e,t){e==t.top&&(t.top=e.prev),e==t.bottom&&(t.bottom=e.next),e.next&&(e.next.prev=e.prev),e.prev&&(e.prev.next=e.next)},kt=function(e,t){if(t.top===e)return;Ct(e,t),e.next=null,e.prev=t.top,t.top.next=e,t.top=e},Lt=function(e,t){if(t.bottom===e)return;Ct(e,t),e.next=t.bottom,e.prev=null,t.bottom.prev=e,t.bottom=e},At=function(e,t,n){Ct(e,n),t==n.top&&(n.top=e),t.next&&(t.next.prev=e),e.next=t.next,e.prev=t,t.next=e},Ot=function(e,t,n){Ct(e,n),t==n.bottom&&(n.bottom=e),t.prev&&(t.prev.next=e),e.prev=t.prev,t.prev=e,e.next=t},Mt=function(e){return function(){throw new Error("Raphaël: you are calling to method “"+e+"” of removed object")}};e.pathToRelative=vt;if(e.svg){l.svgns="http://www.w3.org/2000/svg",l.xlink="http://www.w3.org/1999/xlink",U=function(e){return+e+(~~e===e)*.5};var _t=function(e,t){if(!t)return e=o.createElementNS(l.svgns
,e),e.style.webkitTapHighlightColor="rgba(0,0,0,0)",e;for(var n in t)t[s](n)&&e[z](n,g(t[n]))};e[D]=function(){return"Your browser supports SVG.\nYou are running Raphaël "+this.version};var Dt=function(e,t){var n=_t("path");t.canvas&&t.canvas[c](n);var r=new It(n,t);return r.type="path",Bt(r,{fill:"none",stroke:"#000",path:e}),r},Pt=function(e,t,n){var r="linear",i=.5,s=.5,u=e.style;t=g(t)[Q](rt,function(e,t,n){r="radial";if(t&&n){i=W(t),s=W(n);var o=(s>.5)*2-1;L(i-.5,2)+L(s-.5,2)>.25&&(s=T.sqrt(.25-L(i-.5,2))*o+.5)&&s!=.5&&(s=s.toFixed(5)-1e-5*o)}return v}),t=t[y](/\s*\-\s*/);if(r=="linear"){var a=t.shift();a=-W(a);if(isNaN(a))return null;var f=[0,0,T.cos(a*A/180),T.sin(a*A/180)],l=1/(N(k(f[2]),k(f[3]))||1);f[2]*=l,f[3]*=l,f[2]<0&&(f[0]=-f[2],f[2]=0),f[3]<0&&(f[1]=-f[3],f[3]=0)}var h=xt(t);if(!h)return null;var p=e.getAttribute(P);p=p.match(/^url\(#(.*)\)$/),p&&n.defs.removeChild(o.getElementById(p[1]));var d=_t(r+"Gradient");d.id=ut(),_t(d,r=="radial"?{fx:i,fy:s}:{x1:f[0],y1:f[1],x2:f[2],y2:f[3]}),n.defs[c](d);for(var m=0,b=h[S];m<b;m++){var w=_t("stop");_t(w,{offset:h[m].offset?h[m].offset:m?"100%":"0%","stop-color":h[m].color||"#fff"}),d[c](w)}return _t(e,{fill:"url(#"+d.id+")",opacity:1,"fill-opacity":1}),u.fill=v,u.opacity=1,u.fillOpacity=1,1},Ht=function(t){var n=t.getBBox();_t(t.pattern,{patternTransform:e.format("translate({0},{1})",n.x,n.y)})},Bt=function(n,r){var i={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},u=n.node,a=n.attrs,f=n.rotate(),l=function(
e,t){t=i[x.call(t)];if(t){var n=e.attrs["stroke-width"]||"1",s={round:n,square:n,butt:0}[e.attrs["stroke-linecap"]||r["stroke-linecap"]]||0,o=[],a=t[S];while(a--)o[a]=t[a]*n+(a%2?1:-1)*s;_t(u,{"stroke-dasharray":o[E](",")})}};r[s]("rotation")&&(f=r.rotation);var h=g(f)[y](t);h.length-1?(h[1]=+h[1],h[2]=+h[2]):h=null,W(f)&&n.rotate(0,!0);for(var p in r)if(r[s](p)){if(!J[s](p))continue;var d=r[p];a[p]=d;switch(p){case"blur":n.blur(d);break;case"rotation":n.rotate(d,!0);break;case"href":case"title":case"target":var b=u.parentNode;if(x.call(b.tagName)!="a"){var w=_t("a");b.insertBefore(w,u),w[c](u),b=w}p=="target"&&d=="blank"?b.setAttributeNS(n.paper.xlink,"show","new"):b.setAttributeNS(n.paper.xlink,p,d);break;case"cursor":u.style.cursor=d;break;case"clip-rect":var T=g(d)[y](t);if(T[S]>=4){n.clip&&n.clip.parentNode.parentNode.removeChild(n.clip.parentNode);var N=_t("clipPath"),C=_t("rect");N.id=ut(),_t(C,{x:T[0],y:T[1],width:T[2],height:T[3],r:T[4]||0,rx:T[4]||0,ry:T[4]||0}),N[c](C),n.paper.defs[c](N),_t(u,{"clip-path":"url(#"+N.id+")"}),n.clip=C}if(!d){var k=o.getElementById(u.getAttribute("clip-path")[Q](/(^url\(#|\)$)/g,v));k&&k.parentNode.removeChild(k),_t(u,{"clip-path":v}),delete n.clip}break;case"path":n.type=="path"&&_t(u,{d:d?a.path=mt(d):"M0,0"});break;case"width":u[z](p,d);if(!a.fx)break;p="x",d=a.x;case"x":a.fx&&(d=-a.x-(a.width||0));case"rx":if(p=="rx"&&n.type=="rect")break;case"cx":h&&(p=="x"||p=="cx")&&(h[1]+=d-a[p]),u[z](p,d),n.pattern&&Ht(n);break;case"height":u[z](p,d);if(!a.fy)break;p="y",d=a.y;case"y":a.fy&&(d=-a.y-(a.height||0));case"ry":if(p=="ry"&&n.type=="rect"
)break;case"cy":h&&(p=="y"||p=="cy")&&(h[2]+=d-a[p]),u[z](p,d),n.pattern&&Ht(n);break;case"r":n.type=="rect"?_t(u,{rx:d,ry:d}):u[z](p,d);break;case"src":n.type=="image"&&u.setAttributeNS(n.paper.xlink,"href",d);break;case"stroke-width":u.style.strokeWidth=d,u[z](p,d),a["stroke-dasharray"]&&l(n,a["stroke-dasharray"]);break;case"stroke-dasharray":l(n,d);break;case"translation":var L=g(d)[y](t);L[0]=+L[0]||0,L[1]=+L[1]||0,h&&(h[1]+=L[0],h[2]+=L[1]),kn.call(n,L[0],L[1]);break;case"scale":L=g(d)[y](t),n.scale(+L[0]||1,+L[1]||+L[0]||1,isNaN(W(L[2]))?null:+L[2],isNaN(W(L[3]))?null:+L[3]);break;case P:var A=g(d).match(F);if(A){N=_t("pattern");var O=_t("image");N.id=ut(),_t(N,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),_t(O,{x:0,y:0}),O.setAttributeNS(n.paper.xlink,"href",A[1]),N[c](O);var M=o.createElement("img");M.style.cssText="position:absolute;left:-9999em;top-9999em",M.onload=function(){_t(N,{width:this.offsetWidth,height:this.offsetHeight}),_t(O,{width:this.offsetWidth,height:this.offsetHeight}),o.body.removeChild(this),n.paper.safari()},o.body[c](M),M.src=A[1],n.paper.defs[c](N),u.style.fill="url(#"+N.id+")",_t(u,{fill:"url(#"+N.id+")"}),n.pattern=N,n.pattern&&Ht(n);break}var _=e.getRGB(d);if(!_.error)delete r.gradient,delete a.gradient,!e.is(a.opacity,"undefined")&&e.is(r.opacity,"undefined")&&_t(u,{opacity:a.opacity}),!e.is(a["fill-opacity"],"undefined")&&e.is(r["fill-opacity"],"undefined")&&_t(u,{"fill-opacity":a["fill-opacity"]});else if(({circle:1,ellipse:1}[s](n.type)||g(d).charAt()!="r")&&Pt(u,d,n.paper)){a.gradient=d,a.fill="none";break}_[s]("opacity")&&
_t(u,{"fill-opacity":_.opacity>1?_.opacity/100:_.opacity});case"stroke":_=e.getRGB(d),u[z](p,_.hex),p=="stroke"&&_[s]("opacity")&&_t(u,{"stroke-opacity":_.opacity>1?_.opacity/100:_.opacity});break;case"gradient":((({circle:1,ellipse:1}))[s](n.type)||g(d).charAt()!="r")&&Pt(u,d,n.paper);break;case"opacity":a.gradient&&!a[s]("stroke-opacity")&&_t(u,{"stroke-opacity":d>1?d/100:d});case"fill-opacity":if(a.gradient){var D=o.getElementById(u.getAttribute(P)[Q](/^url\(#|\)$/g,v));if(D){var H=D.getElementsByTagName("stop");H[H[S]-1][z]("stop-opacity",d)}break};default:p=="font-size"&&(d=X(d,10)+"px");var B=p[Q](/(\-.)/g,function(e){return $.call(e.substring(1))});u.style[B]=d,u[z](p,d)}}Ft(n,r),h?n.rotate(h.join(m)):W(f)&&n.rotate(f,!0)},jt=1.2,Ft=function(t,n){if(t.type!="text"||!(n[s]("text")||n[s]("font")||n[s]("font-size")||n[s]("x")||n[s]("y")))return;var r=t.attrs,i=t.node,u=i.firstChild&&i.firstChild.style["font-size"]!==""?X(o.defaultView.getComputedStyle(i.firstChild,v).getPropertyValue("font-size"),10):X(i.style["font-size"],10)||10;if(n[s]("text")){r.text=n.text;while(i.firstChild)i.removeChild(i.firstChild);var a=g(n.text)[y]("\n");for(var f=0,l=a[S];f<l;f++)if(a[f]){var h=_t("tspan");f&&_t(h,{dy:u*jt,x:r.x}),h[c](o.createTextNode(a[f])),i[c](h)}}else{a=i.getElementsByTagName("tspan");for(f=0,l=a[S];f<l;f++)f&&_t(a[f],{dy:u*jt,x:r.x})}_t(i,{y:r.y});var p=t.getBBox(),d=r.y-(p.y+p.height/2);d&&e.is(d,"finite")&&_t(i,{y:r.y+d})},It=function(t,n){var r=0,i=0;this[0]=t,this.id=e._oid++,this.node=t,t.raphael=this,this.paper=n,this.attrs=this.attrs||{},this.transformations=[],this
._={tx:0,ty:0,rt:{deg:0,cx:0,cy:0},sx:1,sy:1},!n.bottom&&(n.bottom=this),this.prev=n.top,n.top&&(n.top.next=this),n.top=this,this.next=null},qt=It[i];It[i].rotate=function(n,r,i){if(this.removed)return this;if(n==null)return this._.rt.cx?[this._.rt.deg,this._.rt.cx,this._.rt.cy][E](m):this._.rt.deg;var s=this.getBBox();return n=g(n)[y](t),n[S]-1&&(r=W(n[1]),i=W(n[2])),n=W(n[0]),r!=null&&r!==!1?this._.rt.deg=n:this._.rt.deg+=n,i==null&&(r=null),this._.rt.cx=r,this._.rt.cy=i,r=r==null?s.x+s.width/2:r,i=i==null?s.y+s.height/2:i,this._.rt.deg?(this.transformations[0]=e.format("rotate({0} {1} {2})",this._.rt.deg,r,i),this.clip&&_t(this.clip,{transform:e.format("rotate({0} {1} {2})",-this._.rt.deg,r,i)})):(this.transformations[0]=v,this.clip&&_t(this.clip,{transform:v})),_t(this.node,{transform:this.transformations[E](m)}),this},It[i].hide=function(){return!this.removed&&(this.node.style.display="none"),this},It[i].show=function(){return!this.removed&&(this.node.style.display=""),this},It[i].remove=function(){if(this.removed)return;Ct(this,this.paper),this.node.parentNode.removeChild(this.node);for(var e in this)delete this[e];this.removed=!0},It[i].getBBox=function(){if(this.removed)return this;if(this.type=="path")return pt(this.attrs.path);if(this.node.style.display=="none"){this.show();var e=!0}var t={};try{t=this.node.getBBox()}catch(n){}finally{t=t||{}}if(this.type=="text")try{t={x:t.x,y:Infinity,width:0,height:0};for(var r=0,i=this.node.getNumberOfChars();r<i;r++){var s=this.node.getExtentOfChar(r);s.y<t.y&&(t.y=s.y),s.y+s.height-t.y>t.height&&(t.height=s.y+s.height-t.y),s.
x+s.width-t.x>t.width&&(t.width=s.x+s.width-t.x)}}catch(n){}finally{t=t||{x:t.x,y:Infinity,width:0,height:0}}return e&&this.hide(),t},It[i].attr=function(t,n){if(this.removed)return this;if(t==null){var r={};for(var i in this.attrs)this.attrs[s](i)&&(r[i]=this.attrs[i]);return this._.rt.deg&&(r.rotation=this.rotate()),(this._.sx!=1||this._.sy!=1)&&(r.scale=this.scale()),r.gradient&&r.fill=="none"&&(r.fill=r.gradient)&&delete r.gradient,r}if(n==null&&e.is(t,M))return t=="translation"?kn.call(this):t=="rotation"?this.rotate():t=="scale"?this.scale():t==P&&this.attrs.fill=="none"&&this.attrs.gradient?this.attrs.gradient:this.attrs[t];if(n==null&&e.is(t,_)){var o={};for(var u=0,a=t.length;u<a;u++)o[t[u]]=this.attr(t[u]);return o}if(n!=null){var f={};f[t]=n}else t!=null&&e.is(t,"object")&&(f=t);for(var l in this.paper.customAttributes)if(this.paper.customAttributes[s](l)&&f[s](l)&&e.is(this.paper.customAttributes[l],"function")){var c=this.paper.customAttributes[l].apply(this,[][p](f[l]));this.attrs[l]=f[l];for(var h in c)c[s](h)&&(f[h]=c[h])}return Bt(this,f),this},It[i].toFront=function(){if(this.removed)return this;this.node.parentNode[c](this.node);var e=this.paper;return e.top!=this&&kt(this,e),this},It[i].toBack=function(){if(this.removed)return this;if(this.node.parentNode.firstChild!=this.node){this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),Lt(this,this.paper);var e=this.paper}return this},It[i].insertAfter=function(e){if(this.removed)return this;var t=e.node||e[e.length-1].node;return t.nextSibling?t.parentNode.insertBefore(this.node,t.nextSibling
):t.parentNode[c](this.node),At(this,e,this.paper),this},It[i].insertBefore=function(e){if(this.removed)return this;var t=e.node||e[0].node;return t.parentNode.insertBefore(this.node,t),Ot(this,e,this.paper),this},It[i].blur=function(e){var t=this;if(+e!==0){var n=_t("filter"),r=_t("feGaussianBlur");t.attrs.blur=e,n.id=ut(),_t(r,{stdDeviation:+e||1.5}),n.appendChild(r),t.paper.defs.appendChild(n),t._blur=n,_t(t.node,{filter:"url(#"+n.id+")"})}else t._blur&&(t._blur.parentNode.removeChild(t._blur),delete t._blur,delete t.attrs.blur),t.node.removeAttribute("filter")};var Rt=function(e,t,n,r){var i=_t("circle");e.canvas&&e.canvas[c](i);var s=new It(i,e);return s.attrs={cx:t,cy:n,r:r,fill:"none",stroke:"#000"},s.type="circle",_t(i,s.attrs),s},Ut=function(e,t,n,r,i,s){var o=_t("rect");e.canvas&&e.canvas[c](o);var u=new It(o,e);return u.attrs={x:t,y:n,width:r,height:i,r:s||0,rx:s||0,ry:s||0,fill:"none",stroke:"#000"},u.type="rect",_t(o,u.attrs),u},zt=function(e,t,n,r,i){var s=_t("ellipse");e.canvas&&e.canvas[c](s);var o=new It(s,e);return o.attrs={cx:t,cy:n,rx:r,ry:i,fill:"none",stroke:"#000"},o.type="ellipse",_t(s,o.attrs),o},Wt=function(e,t,n,r,i,s){var o=_t("image");_t(o,{x:n,y:r,width:i,height:s,preserveAspectRatio:"none"}),o.setAttributeNS(e.xlink,"href",t),e.canvas&&e.canvas[c](o);var u=new It(o,e);return u.attrs={x:n,y:r,width:i,height:s,src:t},u.type="image",u},Xt=function(e,t,n,r){var i=_t("text");_t(i,{x:t,y:n,"text-anchor":"middle"}),e.canvas&&e.canvas[c](i);var s=new It(i,e);return s.attrs={x:t,y:n,"text-anchor":"middle",text:r,font:J.font,"font-size":J["font-size"],stroke
:"none",fill:"#000"},s.type="text",Bt(s,s.attrs),s},Vt=function(e,t){return this.width=e||this.width,this.height=t||this.height,this.canvas[z]("width",this.width),this.canvas[z]("height",this.height),this},$t=function(){var t=Tt[h](0,arguments),n=t&&t.container,r=t.x,i=t.y,s=t.width,u=t.height;if(!n)throw new Error("SVG container not found.");var a=_t("svg");return r=r||0,i=i||0,s=s||512,u=u||342,_t(a,{xmlns:"http://www.w3.org/2000/svg",version:1.1,width:s,height:u}),n==1?(a.style.cssText="position:absolute;left:"+r+"px;top:"+i+"px",o.body[c](a)):n.firstChild?n.insertBefore(a,n.firstChild):n[c](a),n=new f,n.width=s,n.height=u,n.canvas=a,Nt.call(n,n,e.fn),n.clear(),n};l.clear=function(){var e=this.canvas;while(e.firstChild)e.removeChild(e.firstChild);this.bottom=this.top=null,this.desc=_t("desc"),e[c](this.desc),e[c](this.defs=_t("defs"))},l.remove=function(){this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var e in this)this[e]=Mt(e)}}if(e.vml){var Jt={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},Kt=/([clmz]),?([^clmz]*)/gi,Qt=/ progid:\S+Blur\([^\)]+\)/g,Gt=/-?[^,\s-]+/g,Yt=1e3+m+1e3,Zt=10,en={path:1,rect:1},tn=function(e){var t=/[ahqstv]/ig,n=mt;g(e).match(t)&&(n=St),t=/[clmz]/g;if(n==mt&&!g(e).match(t)){var r=g(e)[Q](Kt,function(e,t,n){var r=[],i=x.call(t)=="m",s=Jt[t];return n[Q](Gt,function(e){i&&r[S]==2&&(s+=r+Jt[t=="m"?"l":"L"],r=[]),r[j](U(e*Zt))}),s+r});return r}var i=n(e),s,o;r=[];for(var u=0,a=i[S];u<a;u++){s=i[u],o=x.call(i[u][0]),o=="z"&&(o="x");for(var f=1,l=s[S];f<l;f++)o+=U(s[f]*Zt)+(f!=l-1?",":v);r[j](o)}return r[E](m)};e[D]=function(
){return"Your browser doesn’t support SVG. Falling down to VML.\nYou are running Raphaël "+this.version},Dt=function(e,t){var n=rn("group");n.style.cssText="position:absolute;left:0;top:0;width:"+t.width+"px;height:"+t.height+"px",n.coordsize=t.coordsize,n.coordorigin=t.coordorigin;var r=rn("shape"),i=r.style;i.width=t.width+"px",i.height=t.height+"px",r.coordsize=Yt,r.coordorigin=t.coordorigin,n[c](r);var s=new It(r,n,t),o={fill:"none",stroke:"#000"};return e&&(o.path=e),s.type="path",s.path=[],s.Path=v,Bt(s,o),t.canvas[c](n),s},Bt=function(n,r){n.attrs=n.attrs||{};var i=n.node,u=n.attrs,a=i.style,f,l=(r.x!=u.x||r.y!=u.y||r.width!=u.width||r.height!=u.height||r.r!=u.r)&&n.type=="rect",h=n;for(var p in r)r[s](p)&&(u[p]=r[p]);l&&(u.path=nn(u.x,u.y,u.width,u.height,u.r),n.X=u.x,n.Y=u.y,n.W=u.width,n.H=u.height),r.href&&(i.href=r.href),r.title&&(i.title=r.title),r.target&&(i.target=r.target),r.cursor&&(a.cursor=r.cursor),"blur"in r&&n.blur(r.blur);if(r.path&&n.type=="path"||l)i.path=tn(u.path);r.rotation!=null&&n.rotate(r.rotation,!0),r.translation&&(f=g(r.translation)[y](t),kn.call(n,f[0],f[1]),n._.rt.cx!=null&&(n._.rt.cx+=+f[0],n._.rt.cy+=+f[1],n.setBox(n.attrs,f[0],f[1]))),r.scale&&(f=g(r.scale)[y](t),n.scale(+f[0]||1,+f[1]||+f[0]||1,+f[2]||null,+f[3]||null));if("clip-rect"in r){var d=g(r["clip-rect"])[y](t);if(d[S]>=4){d[2]=+d[2]+ +d[0],d[3]=+d[3]+ +d[1],d[4]||(d[4]=0);var m=i.clipRect||o.createElement("div"),b=m.style,w=i.parentNode;b.clip=e.format("rect({1}px {2}px {3}px {0}px)",d),i.clipRect||(b.position="absolute",b.top=0,b.left=0,b.width=n.paper.width+"px",b.height=n.paper
.height+"px",w.parentNode.insertBefore(m,w),m[c](w),i.clipRect=m)}r["clip-rect"]||i.clipRect&&(i.clipRect.style.clip=v)}n.type=="image"&&r.src&&(i.src=r.src),n.type=="image"&&r.opacity&&(i.filterOpacity=V+".Alpha(opacity="+r.opacity*100+")",a.filter=(i.filterMatrix||v)+(i.filterOpacity||v)),r.font&&(a.font=r.font),r["font-family"]&&(a.fontFamily='"'+r["font-family"][y](",")[0][Q](/^['"]+|['"]+$/g,v)+'"'),r["font-size"]&&(a.fontSize=r["font-size"]),r["font-weight"]&&(a.fontWeight=r["font-weight"]),r["font-style"]&&(a.fontStyle=r["font-style"]);if(r.opacity!=null||r["stroke-width"]!=null||r.fill!=null||r.stroke!=null||r["stroke-width"]!=null||r["stroke-opacity"]!=null||r["fill-opacity"]!=null||r["stroke-dasharray"]!=null||r["stroke-miterlimit"]!=null||r["stroke-linejoin"]!=null||r["stroke-linecap"]!=null){i=n.shape||i;var E=i.getElementsByTagName(P)&&i.getElementsByTagName(P)[0],x=!1;!E&&(x=E=rn(P));if("fill-opacity"in r||"opacity"in r){var T=((+u["fill-opacity"]+1||2)-1)*((+u.opacity+1||2)-1)*((+e.getRGB(r.fill).o+1||2)-1);T=C(N(T,0),1),E.opacity=T}r.fill&&(E.on=!0);if(E.on==null||r.fill=="none")E.on=!1;if(E.on&&r.fill){var k=r.fill.match(F);k?(E.src=k[1],E.type="tile"):(E.color=e.getRGB(r.fill).hex,E.src=v,E.type="solid",e.getRGB(r.fill).error&&(h.type in{circle:1,ellipse:1}||g(r.fill).charAt()!="r")&&Pt(h,r.fill)&&(u.fill="none",u.gradient=r.fill))}x&&i[c](E);var L=i.getElementsByTagName("stroke")&&i.getElementsByTagName("stroke")[0],A=!1;!L&&(A=L=rn("stroke"));if(r.stroke&&r.stroke!="none"||r["stroke-width"]||r["stroke-opacity"]!=null||r["stroke-dasharray"]||r["stroke-miterlimit"
]||r["stroke-linejoin"]||r["stroke-linecap"])L.on=!0;(r.stroke=="none"||L.on==null||r.stroke==0||r["stroke-width"]==0)&&(L.on=!1);var O=e.getRGB(r.stroke);L.on&&r.stroke&&(L.color=O.hex),T=((+u["stroke-opacity"]+1||2)-1)*((+u.opacity+1||2)-1)*((+O.o+1||2)-1);var M=(W(r["stroke-width"])||1)*.75;T=C(N(T,0),1),r["stroke-width"]==null&&(M=u["stroke-width"]),r["stroke-width"]&&(L.weight=M),M&&M<1&&(T*=M)&&(L.weight=1),L.opacity=T,r["stroke-linejoin"]&&(L.joinstyle=r["stroke-linejoin"]||"miter"),L.miterlimit=r["stroke-miterlimit"]||8,r["stroke-linecap"]&&(L.endcap=r["stroke-linecap"]=="butt"?"flat":r["stroke-linecap"]=="square"?"square":"round");if(r["stroke-dasharray"]){var _={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};L.dashstyle=_[s](r["stroke-dasharray"])?_[r["stroke-dasharray"]]:v}A&&i[c](L)}if(h.type=="text"){a=h.paper.span.style,u.font&&(a.font=u.font),u["font-family"]&&(a.fontFamily=u["font-family"]),u["font-size"]&&(a.fontSize=u["font-size"]),u["font-weight"]&&(a.fontWeight=u["font-weight"]),u["font-style"]&&(a.fontStyle=u["font-style"]),h.node.string&&(h.paper.span.innerHTML=g(h.node.string)[Q](/</g,"&#60;")[Q](/&/g,"&#38;")[Q](/\n/g,"<br>")),h.W=u.w=h.paper.span.offsetWidth,h.H=u.h=h.paper.span.offsetHeight,h.X=u.x,h.Y=u.y+U(h.H/2);switch(u["text-anchor"]){case"start":h.node.style["v-text-align"]="left",h.bbx=U(h.W/2);break;case"end":h.node.style["v-text-align"]="right",h.bbx=-U(h.W/2);break;default:h.node.style["v-text-align"]="center"}}},
Pt=function(e,t){e.attrs=e.attrs||{};var n=e.attrs,r,i="linear",s=".5 .5";e.attrs.gradient=t,t=g(t)[Q](rt,function(e,t,n){return i="radial",t&&n&&(t=W(t),n=W(n),L(t-.5,2)+L(n-.5,2)>.25&&(n=T.sqrt(.25-L(t-.5,2))*((n>.5)*2-1)+.5),s=t+m+n),v}),t=t[y](/\s*\-\s*/);if(i=="linear"){var o=t.shift();o=-W(o);if(isNaN(o))return null}var u=xt(t);if(!u)return null;e=e.shape||e.node,r=e.getElementsByTagName(P)[0]||rn(P),!r.parentNode&&e.appendChild(r);if(u[S]){r.on=!0,r.method="none",r.color=u[0].color,r.color2=u[u[S]-1].color;var a=[];for(var f=0,l=u[S];f<l;f++)u[f].offset&&a[j](u[f].offset+m+u[f].color);r.colors&&(r.colors.value=a[S]?a[E]():"0% "+r.color),i=="radial"?(r.type="gradientradial",r.focus="100%",r.focussize=s,r.focusposition=s):(r.type="gradient",r.angle=(270-o)%360)}return 1},It=function(t,n,r){var i=0,s=0,o=0,u=1;this[0]=t,this.id=e._oid++,this.node=t,t.raphael=this,this.X=0,this.Y=0,this.attrs={},this.Group=n,this.paper=r,this._={tx:0,ty:0,rt:{deg:0},sx:1,sy:1},!r.bottom&&(r.bottom=this),this.prev=r.top,r.top&&(r.top.next=this),r.top=this,this.next=null},qt=It[i],qt.rotate=function(e,n,r){return this.removed?this:e==null?this._.rt.cx?[this._.rt.deg,this._.rt.cx,this._.rt.cy][E](m):this._.rt.deg:(e=g(e)[y](t),e[S]-1&&(n=W(e[1]),r=W(e[2])),e=W(e[0]),n!=null?this._.rt.deg=e:this._.rt.deg+=e,r==null&&(n=null),this._.rt.cx=n,this._.rt.cy=r,this.setBox(this.attrs,n,r),this.Group.style.rotation=this._.rt.deg,this)},qt.setBox=function(e,t,n){if(this.removed)return this;var r=this.Group.style,i=this.shape&&this.shape.style||this.node.style;e=e||{};for(var o in e)e[s](o)&&(this.attrs
[o]=e[o]);t=t||this._.rt.cx,n=n||this._.rt.cy;var u=this.attrs,a,f,l,c;switch(this.type){case"circle":a=u.cx-u.r,f=u.cy-u.r,l=c=u.r*2;break;case"ellipse":a=u.cx-u.rx,f=u.cy-u.ry,l=u.rx*2,c=u.ry*2;break;case"image":a=+u.x,f=+u.y,l=u.width||0,c=u.height||0;break;case"text":this.textpath.v=["m",U(u.x),", ",U(u.y-2),"l",U(u.x)+1,", ",U(u.y-2)][E](v),a=u.x-U(this.W/2),f=u.y-this.H/2,l=this.W,c=this.H;break;case"rect":case"path":if(!this.attrs.path)a=0,f=0,l=this.paper.width,c=this.paper.height;else{var h=pt(this.attrs.path);a=h.x,f=h.y,l=h.width,c=h.height}break;default:a=0,f=0,l=this.paper.width,c=this.paper.height}t=t==null?a+l/2:t,n=n==null?f+c/2:n;var p=t-this.paper.width/2,d=n-this.paper.height/2,m;r.left!=(m=p+"px")&&(r.left=m),r.top!=(m=d+"px")&&(r.top=m),this.X=en[s](this.type)?-p:a,this.Y=en[s](this.type)?-d:f,this.W=l,this.H=c,en[s](this.type)?(i.left!=(m=-p*Zt+"px")&&(i.left=m),i.top!=(m=-d*Zt+"px")&&(i.top=m)):this.type=="text"?(i.left!=(m=-p+"px")&&(i.left=m),i.top!=(m=-d+"px")&&(i.top=m)):(r.width!=(m=this.paper.width+"px")&&(r.width=m),r.height!=(m=this.paper.height+"px")&&(r.height=m),i.left!=(m=a-p+"px")&&(i.left=m),i.top!=(m=f-d+"px")&&(i.top=m),i.width!=(m=l+"px")&&(i.width=m),i.height!=(m=c+"px")&&(i.height=m))},qt.hide=function(){return!this.removed&&(this.Group.style.display="none"),this},qt.show=function(){return!this.removed&&(this.Group.style.display="block"),this},qt.getBBox=function(){return this.removed?this:en[s](this.type)?pt(this.attrs.path):{x:this.X+(this.bbx||0),y:this.Y,width:this.W,height:this.H}},qt.remove=function(){if(this.removed)return;Ct(
this,this.paper),this.node.parentNode.removeChild(this.node),this.Group.parentNode.removeChild(this.Group),this.shape&&this.shape.parentNode.removeChild(this.shape);for(var e in this)delete this[e];this.removed=!0},qt.attr=function(t,n){if(this.removed)return this;if(t==null){var r={};for(var i in this.attrs)this.attrs[s](i)&&(r[i]=this.attrs[i]);return this._.rt.deg&&(r.rotation=this.rotate()),(this._.sx!=1||this._.sy!=1)&&(r.scale=this.scale()),r.gradient&&r.fill=="none"&&(r.fill=r.gradient)&&delete r.gradient,r}if(n==null&&e.is(t,"string"))return t=="translation"?kn.call(this):t=="rotation"?this.rotate():t=="scale"?this.scale():t==P&&this.attrs.fill=="none"&&this.attrs.gradient?this.attrs.gradient:this.attrs[t];if(this.attrs&&n==null&&e.is(t,_)){var o,u={};for(i=0,o=t[S];i<o;i++)u[t[i]]=this.attr(t[i]);return u}var a;n!=null&&(a={},a[t]=n),n==null&&e.is(t,"object")&&(a=t);if(a){for(var f in this.paper.customAttributes)if(this.paper.customAttributes[s](f)&&a[s](f)&&e.is(this.paper.customAttributes[f],"function")){var l=this.paper.customAttributes[f].apply(this,[][p](a[f]));this.attrs[f]=a[f];for(var c in l)l[s](c)&&(a[c]=l[c])}a.text&&this.type=="text"&&(this.node.string=a.text),Bt(this,a),a.gradient&&({circle:1,ellipse:1}[s](this.type)||g(a.gradient).charAt()!="r")&&Pt(this,a.gradient),(!en[s](this.type)||this._.rt.deg)&&this.setBox(this.attrs)}return this},qt.toFront=function(){return!this.removed&&this.Group.parentNode[c](this.Group),this.paper.top!=this&&kt(this,this.paper),this},qt.toBack=function(){return this.removed?this:(this.Group.parentNode.firstChild!=this.Group&&
(this.Group.parentNode.insertBefore(this.Group,this.Group.parentNode.firstChild),Lt(this,this.paper)),this)},qt.insertAfter=function(e){return this.removed?this:(e.constructor==On&&(e=e[e.length-1]),e.Group.nextSibling?e.Group.parentNode.insertBefore(this.Group,e.Group.nextSibling):e.Group.parentNode[c](this.Group),At(this,e,this.paper),this)},qt.insertBefore=function(e){return this.removed?this:(e.constructor==On&&(e=e[0]),e.Group.parentNode.insertBefore(this.Group,e.Group),Ot(this,e,this.paper),this)},qt.blur=function(t){var n=this.node.runtimeStyle,r=n.filter;r=r.replace(Qt,v),+t!==0?(this.attrs.blur=t,n.filter=r+m+V+".Blur(pixelradius="+(+t||1.5)+")",n.margin=e.format("-{0}px 0 0 -{0}px",U(+t||1.5))):(n.filter=r,n.margin=0,delete this.attrs.blur)},Rt=function(e,t,n,r){var i=rn("group"),s=rn("oval"),o=s.style;i.style.cssText="position:absolute;left:0;top:0;width:"+e.width+"px;height:"+e.height+"px",i.coordsize=Yt,i.coordorigin=e.coordorigin,i[c](s);var u=new It(s,i,e);return u.type="circle",Bt(u,{stroke:"#000",fill:"none"}),u.attrs.cx=t,u.attrs.cy=n,u.attrs.r=r,u.setBox({x:t-r,y:n-r,width:r*2,height:r*2}),e.canvas[c](i),u};function nn(t,n,r,i,s){return s?e.format("M{0},{1}l{2},0a{3},{3},0,0,1,{3},{3}l0,{5}a{3},{3},0,0,1,{4},{3}l{6},0a{3},{3},0,0,1,{4},{4}l0,{7}a{3},{3},0,0,1,{3},{4}z",t+s,n,r-s*2,s,-s,i-s*2,s*2-r,s*2-i):e.format("M{0},{1}l{2},0,0,{3},{4},0z",t,n,r,i,-r)}Ut=function(e,t,n,r,i,s){var o=nn(t,n,r,i,s),u=e.path(o),a=u.attrs;return u.X=a.x=t,u.Y=a.y=n,u.W=a.width=r,u.H=a.height=i,a.r=s,a.path=o,u.type="rect",u},zt=function(e,t,n,r,i){var s=rn("group"),o=rn("oval"
),u=o.style;s.style.cssText="position:absolute;left:0;top:0;width:"+e.width+"px;height:"+e.height+"px",s.coordsize=Yt,s.coordorigin=e.coordorigin,s[c](o);var a=new It(o,s,e);return a.type="ellipse",Bt(a,{stroke:"#000"}),a.attrs.cx=t,a.attrs.cy=n,a.attrs.rx=r,a.attrs.ry=i,a.setBox({x:t-r,y:n-i,width:r*2,height:i*2}),e.canvas[c](s),a},Wt=function(e,t,n,r,i,s){var o=rn("group"),u=rn("image");o.style.cssText="position:absolute;left:0;top:0;width:"+e.width+"px;height:"+e.height+"px",o.coordsize=Yt,o.coordorigin=e.coordorigin,u.src=t,o[c](u);var a=new It(u,o,e);return a.type="image",a.attrs.src=t,a.attrs.x=n,a.attrs.y=r,a.attrs.w=i,a.attrs.h=s,a.setBox({x:n,y:r,width:i,height:s}),e.canvas[c](o),a},Xt=function(t,n,r,i){var s=rn("group"),o=rn("shape"),u=o.style,a=rn("path"),f=a.style,l=rn("textpath");s.style.cssText="position:absolute;left:0;top:0;width:"+t.width+"px;height:"+t.height+"px",s.coordsize=Yt,s.coordorigin=t.coordorigin,a.v=e.format("m{0},{1}l{2},{1}",U(n*10),U(r*10),U(n*10)+1),a.textpathok=!0,u.width=t.width,u.height=t.height,l.string=g(i),l.on=!0,o[c](l),o[c](a),s[c](o);var h=new It(l,s,t);return h.shape=o,h.textpath=a,h.type="text",h.attrs.text=i,h.attrs.x=n,h.attrs.y=r,h.attrs.w=1,h.attrs.h=1,Bt(h,{font:J.font,stroke:"none",fill:"#000"}),h.setBox(),t.canvas[c](s),h},Vt=function(e,t){var n=this.canvas.style;return e==+e&&(e+="px"),t==+t&&(t+="px"),n.width=e,n.height=t,n.clip="rect(0 "+e+" "+t+" 0)",this};var rn;o.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!o.namespaces.rvml&&o.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),rn=function(
e){return o.createElement("<rvml:"+e+' class="rvml">')}}catch(sn){rn=function(e){return o.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}$t=function(){var t=Tt[h](0,arguments),n=t.container,r=t.height,i,s=t.width,u=t.x,a=t.y;if(!n)throw new Error("VML container not found.");var l=new f,p=l.canvas=o.createElement("div"),d=p.style;return u=u||0,a=a||0,s=s||512,r=r||342,s==+s&&(s+="px"),r==+r&&(r+="px"),l.width=1e3,l.height=1e3,l.coordsize=Zt*1e3+m+Zt*1e3,l.coordorigin="0 0",l.span=o.createElement("span"),l.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",p[c](l.span),d.cssText=e.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",s,r),n==1?(o.body[c](p),d.left=u+"px",d.top=a+"px",d.position="absolute"):n.firstChild?n.insertBefore(p,n.firstChild):n[c](p),Nt.call(l,l,e.fn),l},l.clear=function(){this.canvas.innerHTML=v,this.span=o.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas[c](this.span),this.bottom=this.top=null},l.remove=function(){this.canvas.parentNode.removeChild(this.canvas);for(var e in this)this[e]=Mt(e);return!0}}var on=navigator.userAgent.match(/Version\/(.*?)\s/);navigator.vendor=="Apple Computer, Inc."&&(on&&on[1]<4||navigator.platform.slice(0,2)=="iP")?l.safari=function(){var e=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});u.setTimeout(function(){e.remove()})}:l.safari=function(
){};var un=function(){this.returnValue=!1},an=function(){return this.originalEvent.preventDefault()},fn=function(){this.cancelBubble=!0},ln=function(){return this.originalEvent.stopPropagation()},cn=function(){if(o.addEventListener)return function(e,t,n,r){var i=d&&w[t]?w[t]:t,o=function(i){if(d&&w[s](t))for(var o=0,u=i.targetTouches&&i.targetTouches.length;o<u;o++)if(i.targetTouches[o].target==e){var a=i;i=i.targetTouches[o],i.originalEvent=a,i.preventDefault=an,i.stopPropagation=ln;break}return n.call(r,i)};return e.addEventListener(i,o,!1),function(){return e.removeEventListener(i,o,!1),!0}};if(o.attachEvent)return function(e,t,n,r){var i=function(e){return e=e||u.event,e.preventDefault=e.preventDefault||un,e.stopPropagation=e.stopPropagation||fn,n.call(r,e)};e.attachEvent("on"+t,i);var s=function(){return e.detachEvent("on"+t,i),!0};return s}}(),hn=[],pn=function(e){var t=e.clientX,n=e.clientY,r=o.documentElement.scrollTop||o.body.scrollTop,i=o.documentElement.scrollLeft||o.body.scrollLeft,s,u=hn.length;while(u--){s=hn[u];if(d){var a=e.touches.length,f;while(a--){f=e.touches[a];if(f.identifier==s.el._drag.id){t=f.clientX,n=f.clientY,(e.originalEvent?e.originalEvent:e).preventDefault();break}}}else e.preventDefault();t+=i,n+=r,s.move&&s.move.call(s.move_scope||s.el,t-s.el._drag.x,n-s.el._drag.y,t,n,e)}},dn=function(t){e.unmousemove(pn).unmouseup(dn);var n=hn.length,r;while(n--)r=hn[n],r.el._drag={},r.end&&r.end.call(r.end_scope||r.start_scope||r.move_scope||r.el,t);hn=[]};for(var vn=b[S];vn--;)(function(t){e[t]=It[i][t]=function(n,r){return e.is(n,"function")&&(this.events=
this.events||[],this.events.push({name:t,f:n,unbind:cn(this.shape||this.node||o,t,n,r||this)})),this},e["un"+t]=It[i]["un"+t]=function(e){var n=this.events||[],r=n[S];while(r--)if(n[r].name==t&&n[r].f==e)return n[r].unbind(),n.splice(r,1),!n.length&&delete this.events,this;return this}})(b[vn]);qt.hover=function(e,t,n,r){return this.mouseover(e,n).mouseout(t,r||n)},qt.unhover=function(e,t){return this.unmouseover(e).unmouseout(t)},qt.drag=function(t,n,r,i,s,u){return this._drag={},this.mousedown(function(a){(a.originalEvent||a).preventDefault();var f=o.documentElement.scrollTop||o.body.scrollTop,l=o.documentElement.scrollLeft||o.body.scrollLeft;this._drag.x=a.clientX+l,this._drag.y=a.clientY+f,this._drag.id=a.identifier,n&&n.call(s||i||this,a.clientX+l,a.clientY+f,a),!hn.length&&e.mousemove(pn).mouseup(dn),hn.push({el:this,move:t,end:r,move_scope:i,start_scope:s,end_scope:u})}),this},qt.undrag=function(t,n,r){var i=hn.length;while(i--)hn[i].el==this&&hn[i].move==t&&hn[i].end==r&&hn.splice(i,1);!hn.length&&e.unmousemove(pn).unmouseup(dn)},l.circle=function(e,t,n){return Rt(this,e||0,t||0,n||0)},l.rect=function(e,t,n,r,i){return Ut(this,e||0,t||0,n||0,r||0,i||0)},l.ellipse=function(e,t,n,r){return zt(this,e||0,t||0,n||0,r||0)},l.path=function(t){return t&&!e.is(t,M)&&!e.is(t[0],_)&&(t+=v),Dt(e.format[h](e,arguments),this)},l.image=function(e,t,n,r,i){return Wt(this,e||"about:blank",t||0,n||0,r||0,i||0)},l.text=function(e,t,n){return Xt(this,e||0,t||0,g(n))},l.set=function(e){return arguments[S]>1&&(e=Array[i].splice.call(arguments,0,arguments[S])),new On(e)},l.setSize=Vt,l.top=
l.bottom=null,l.raphael=e,qt.resetScale=function(){if(this.removed)return this;this._.sx=1,this._.sy=1,this.attrs.scale="1 1"},qt.scale=function(e,t,n,r){if(this.removed)return this;if(e==null&&t==null)return{x:this._.sx,y:this._.sy,toString:mn};t=t||e,!+t&&(t=e);var i,s,o,u,a=this.attrs;if(e!=0){var f=this.getBBox(),l=f.x+f.width/2,c=f.y+f.height/2,h=k(e/this._.sx),d=k(t/this._.sy);n=+n||n==0?n:l,r=+r||r==0?r:c;var g=this._.sx>0,y=this._.sy>0,b=~~(e/k(e)),w=~~(t/k(t)),x=h*b,T=d*w,N=this.node.style,C=n+k(l-n)*x*(l>n==g?1:-1),L=r+k(c-r)*T*(c>r==y?1:-1),A=e*b>t*w?d:h;switch(this.type){case"rect":case"image":var O=a.width*h,M=a.height*d;this.attr({height:M,r:a.r*A,width:O,x:C-O/2,y:L-M/2});break;case"circle":case"ellipse":this.attr({rx:a.rx*h,ry:a.ry*d,r:a.r*A,cx:C,cy:L});break;case"text":this.attr({x:C,y:L});break;case"path":var _=vt(a.path),D=!0,P=g?x:h,H=y?T:d;for(var B=0,j=_[S];B<j;B++){var F=_[B],I=$.call(F[0]);if(I=="M"&&D)continue;D=!1;if(I=="A")F[_[B][S]-2]*=P,F[_[B][S]-1]*=H,F[1]*=h,F[2]*=d,F[5]=+(b+w?!!+F[5]:!+F[5]);else if(I=="H")for(var q=1,R=F[S];q<R;q++)F[q]*=P;else if(I=="V")for(q=1,R=F[S];q<R;q++)F[q]*=H;else for(q=1,R=F[S];q<R;q++)F[q]*=q%2?P:H}var U=pt(_);i=C-U.x-U.width/2,s=L-U.y-U.height/2,_[0][1]+=i,_[0][2]+=s,this.attr({path:_})}if(this.type in{text:1,image:1}&&(b!=1||w!=1))this.transformations?(this.transformations[2]="scale("[p](b,",",w,")"),this.node[z]("transform",this.transformations[E](m)),i=b==-1?-a.x-(O||0):a.x,s=w==-1?-a.y-(M||0):a.y,this.attr({x:i,y:s}),a.fx=b-1,a.fy=w-1):(this.node.filterMatrix=V+".Matrix(M11="[p](b,", M12=0, M21=0, M22=",w,", Dx=0, Dy=0, sizingmethod='auto expand', filtertype='bilinear')"
),N.filter=(this.node.filterMatrix||v)+(this.node.filterOpacity||v));else if(this.transformations){this.transformations[2]=v;var W=this.transformations[E](m),X=/^\s+$/;X.test(W)||this.node[z]("transform",W),a.fx=0,a.fy=0}else this.node.filterMatrix=v,N.filter=(this.node.filterMatrix||v)+(this.node.filterOpacity||v);a.scale=[e,t,n,r][E](m),this._.sx=e,this._.sy=t}return this},qt.clone=function(){if(this.removed)return null;var e=this.attr();return delete e.scale,delete e.translation,this.paper[this.type]().attr(e)};var gn={},yn=function(t,n,r,i,s,o,u,a,f){var l=0,c=100,h=[t,n,r,i,s,o,u,a].join(),p=gn[h],d,v;!p&&(gn[h]=p={data:[]}),p.timer&&clearTimeout(p.timer),p.timer=setTimeout(function(){delete gn[h]},2e3);if(f!=null){var m=yn(t,n,r,i,s,o,u,a);c=~~m*10}for(var g=0;g<c+1;g++){p.data[f]>g?v=p.data[g*c]:(v=e.findDotsAtSegment(t,n,r,i,s,o,u,a,g/c),p.data[g]=v),g&&(l+=L(L(d.x-v.x,2)+L(d.y-v.y,2),.5));if(f!=null&&l>=f)return v;d=v}if(f==null)return l},bn=function(t,n){return function(r,i,s){r=St(r);var o,u,a,f,l="",c={},h,p=0;for(var d=0,v=r.length;d<v;d++){a=r[d];if(a[0]=="M")o=+a[1],u=+a[2];else{f=yn(o,u,a[1],a[2],a[3],a[4],a[5],a[6]);if(p+f>i){if(n&&!c.start){h=yn(o,u,a[1],a[2],a[3],a[4],a[5],a[6],i-p),l+=["C",h.start.x,h.start.y,h.m.x,h.m.y,h.x,h.y];if(s)return l;c.start=l,l=["M",h.x,h.y+"C",h.n.x,h.n.y,h.end.x,h.end.y,a[5],a[6]][E](),p+=f,o=+a[5],u=+a[6];continue}if(!t&&!n)return h=yn(o,u,a[1],a[2],a[3],a[4],a[5],a[6],i-p),{x:h.x,y:h.y,alpha:h.alpha}}p+=f,o=+a[5],u=+a[6]}l+=a}return c.end=l,h=t?p:n?c:e.findDotsAtSegment(o,u,a[1],a[2],a[3],a[4],a[5],a[6],1),h.alpha&&(h={x:h.
x,y:h.y,alpha:h.alpha}),h}},wn=bn(1),En=bn(),Sn=bn(0,1);qt.getTotalLength=function(){if(this.type!="path")return;return this.node.getTotalLength?this.node.getTotalLength():wn(this.attrs.path)},qt.getPointAtLength=function(e){if(this.type!="path")return;return En(this.attrs.path,e)},qt.getSubpath=function(e,t){if(this.type!="path")return;if(k(this.getTotalLength()-t)<"1e-6")return Sn(this.attrs.path,e).end;var n=Sn(this.attrs.path,t,1);return e?Sn(n,e).end:n},e.easing_formulas={linear:function(e){return e},"<":function(e){return L(e,3)},">":function(e){return L(e-1,3)+1},"<>":function(e){return e*=2,e<1?L(e,3)/2:(e-=2,(L(e,3)+2)/2)},backIn:function(e){var t=1.70158;return e*e*((t+1)*e-t)},backOut:function(e){e-=1;var t=1.70158;return e*e*((t+1)*e+t)+1},elastic:function(e){if(e==0||e==1)return e;var t=.3,n=t/4;return L(2,-10*e)*T.sin((e-n)*2*A/t)+1},bounce:function(e){var t=7.5625,n=2.75,r;return e<1/n?r=t*e*e:e<2/n?(e-=1.5/n,r=t*e*e+.75):e<2.5/n?(e-=2.25/n,r=t*e*e+.9375):(e-=2.625/n,r=t*e*e+.984375),r}};var xn=[],Tn=function(){var t=+(new Date);for(var n=0;n<xn[S];n++){var r=xn[n];if(r.stop||r.el.removed)continue;var i=t-r.start,o=r.ms,u=r.easing,a=r.from,f=r.diff,l=r.to,c=r.t,h=r.el,p={},d;if(i<o){var g=u(i/o);for(var y in a)if(a[s](y)){switch(K[y]){case"along":d=g*o*f[y],l.back&&(d=l.len-d);var b=En(l[y],d);h.translate(f.sx-f.x||0,f.sy-f.y||0),f.x=b.x,f.y=b.y,h.translate(b.x-f.sx,b.y-f.sy),l.rot&&h.rotate(f.r+b.alpha,b.x,b.y);break;case O:d=+a[y]+g*o*f[y];break;case"colour":d="rgb("+[Cn(U(a[y].r+g*o*f[y].r)),Cn(U(a[y].g+g*o*f[y].g)),Cn(U(a[y].b+g*o*f[y].b))][E](",")+")";break;
case"path":d=[];for(var w=0,x=a[y][S];w<x;w++){d[w]=[a[y][w][0]];for(var T=1,N=a[y][w][S];T<N;T++)d[w][T]=+a[y][w][T]+g*o*f[y][w][T];d[w]=d[w][E](m)}d=d[E](m);break;case"csv":switch(y){case"translation":var C=g*o*f[y][0]-c.x,k=g*o*f[y][1]-c.y;c.x+=C,c.y+=k,d=C+m+k;break;case"rotation":d=+a[y][0]+g*o*f[y][0],a[y][1]&&(d+=","+a[y][1]+","+a[y][2]);break;case"scale":d=[+a[y][0]+g*o*f[y][0],+a[y][1]+g*o*f[y][1],2 in l[y]?l[y][2]:v,3 in l[y]?l[y][3]:v][E](m);break;case"clip-rect":d=[],w=4;while(w--)d[w]=+a[y][w]+g*o*f[y][w]}break;default:var L=[].concat(a[y]);d=[],w=h.paper.customAttributes[y].length;while(w--)d[w]=+L[w]+g*o*f[y][w]}p[y]=d}h.attr(p),h._run&&h._run.call(h)}else l.along&&(b=En(l.along,l.len*!l.back),h.translate(f.sx-(f.x||0)+b.x-f.sx,f.sy-(f.y||0)+b.y-f.sy),l.rot&&h.rotate(f.r+b.alpha,b.x,b.y)),(c.x||c.y)&&h.translate(-c.x,-c.y),l.scale&&(l.scale+=v),h.attr(l),xn.splice(n--,1)}e.svg&&h&&h.paper&&h.paper.safari(),xn[S]&&setTimeout(Tn)},Nn=function(t,n,r,i,s){var o=r-i;n.timeouts.push(setTimeout(function(){e.is(s,"function")&&s.call(n),n.animate(t,o,t.easing)},i))},Cn=function(e){return N(C(e,255),0)},kn=function(e,t){if(e==null)return{x:this._.tx,y:this._.ty,toString:mn};this._.tx+=+e,this._.ty+=+t;switch(this.type){case"circle":case"ellipse":this.attr({cx:+e+this.attrs.cx,cy:+t+this.attrs.cy});break;case"rect":case"image":case"text":this.attr({x:+e+this.attrs.x,y:+t+this.attrs.y});break;case"path":var n=vt(this.attrs.path);n[0][1]+=+e,n[0][2]+=+t,this.attr({path:n})}return this};qt.animateWith=function(e,t,n,r,i){for(var s=0,o=xn.length;s<o;s++)xn[s].el.id==e.id&&(t
.start=xn[s].start);return this.animate(t,n,r,i)},qt.animateAlong=Ln(),qt.animateAlongBack=Ln(1),qt.onAnimation=function(e){return this._run=e||0,this},qt.animate=function(n,r,i,o){var u=this;u.timeouts=u.timeouts||[];if(e.is(i,"function")||!i)o=i||null;if(u.removed)return o&&o.call(u),u;var a={},f={},l=!1,c={};for(var h in n)if(n[s](h))if(K[s](h)||u.paper.customAttributes[s](h)){l=!0,a[h]=u.attr(h),a[h]==null&&(a[h]=J[h]),f[h]=n[h];switch(K[h]){case"along":var p=wn(n[h]),d=En(n[h],p*!!n.back),v=u.getBBox();c[h]=p/r,c.tx=v.x,c.ty=v.y,c.sx=d.x,c.sy=d.y,f.rot=n.rot,f.back=n.back,f.len=p,n.rot&&(c.r=W(u.rotate())||0);break;case O:c[h]=(f[h]-a[h])/r;break;case"colour":a[h]=e.getRGB(a[h]);var m=e.getRGB(f[h]);c[h]={r:(m.r-a[h].r)/r,g:(m.g-a[h].g)/r,b:(m.b-a[h].b)/r};break;case"path":var b=St(a[h],f[h]);a[h]=b[0];var w=b[1];c[h]=[];for(var E=0,x=a[h][S];E<x;E++){c[h][E]=[0];for(var T=1,N=a[h][E][S];T<N;T++)c[h][E][T]=(w[E][T]-a[h][E][T])/r}break;case"csv":var C=g(n[h])[y](t),k=g(a[h])[y](t);switch(h){case"translation":a[h]=[0,0],c[h]=[C[0]/r,C[1]/r];break;case"rotation":a[h]=k[1]==C[1]&&k[2]==C[2]?k:[0,C[1],C[2]],c[h]=[(C[0]-a[h][0])/r,0,0];break;case"scale":n[h]=C,a[h]=g(a[h])[y](t),c[h]=[(C[0]-a[h][0])/r,(C[1]-a[h][1])/r,0,0];break;case"clip-rect":a[h]=g(a[h])[y](t),c[h]=[],E=4;while(E--)c[h][E]=(C[E]-a[h][E])/r}f[h]=C;break;default:C=[].concat(n[h]),k=[].concat(a[h]),c[h]=[],E=u.paper.customAttributes[h][S];while(E--)c[h][E]=((C[E]||0)-(k[E]||0))/r}}if(!l){var L=[],A;for(var M in n)n[s](M)&&G.test(M)&&(h={value:n[M]},M=="from"&&(M=0),M=="to"&&(M=100),h.key=X(M,10),L.push(h));L.
sort(it),L[0].key&&L.unshift({key:0,value:u.attrs});for(E=0,x=L[S];E<x;E++)Nn(L[E].value,u,r/100*L[E].key,r/100*(L[E-1]&&L[E-1].key||0),L[E-1]&&L[E-1].value.callback);A=L[L[S]-1].value.callback,A&&u.timeouts.push(setTimeout(function(){A.call(u)},r))}else{var _=e.easing_formulas[i];if(!_){_=g(i).match(R);if(_&&_[S]==5){var D=_;_=function(e){return An(e,+D[1],+D[2],+D[3],+D[4],r)}}else _=function(e){return e}}xn.push({start:n.start||+(new Date),ms:r,easing:_,from:a,diff:c,to:f,el:u,t:{x:0,y:0}}),e.is(o,"function")&&(u._ac=setTimeout(function(){o.call(u)},r)),xn[S]==1&&setTimeout(Tn)}return this},qt.stop=function(){for(var e=0;e<xn.length;e++)xn[e].el.id==this.id&&xn.splice(e--,1);for(e=0,ii=this.timeouts&&this.timeouts.length;e<ii;e++)clearTimeout(this.timeouts[e]);return this.timeouts=[],clearTimeout(this._ac),delete this._ac,this},qt.translate=function(e,t){return this.attr({translation:e+" "+t})},qt[D]=function(){return"Raphaël’s object"},e.ae=xn;var On=function(e){this.items=[],this[S]=0,this.type="set";if(e)for(var t=0,n=e[S];t<n;t++)e[t]&&(e[t].constructor==It||e[t].constructor==On)&&(this[this.items[S]]=this.items[this.items[S]]=e[t],this[S]++)};On[i][j]=function(){var e,t;for(var n=0,r=arguments[S];n<r;n++)e=arguments[n],e&&(e.constructor==It||e.constructor==On)&&(t=this.items[S],this[t]=this.items[t]=e,this[S]++);return this},On[i].pop=function(){return delete this[this[S]--],this.items.pop()};for(var Mn in qt)qt[s](Mn)&&(On[i][Mn]=function(e){return function(){for(var t=0,n=this.items[S];t<n;t++)this.items[t][e][h](this.items[t],arguments);return this}}(Mn));On[i].attr=
function(t,n){if(t&&e.is(t,_)&&e.is(t[0],"object"))for(var r=0,i=t[S];r<i;r++)this.items[r].attr(t[r]);else for(var s=0,o=this.items[S];s<o;s++)this.items[s].attr(t,n);return this},On[i].animate=function(t,n,r,i){(e.is(r,"function")||!r)&&(i=r||null);var s=this.items[S],o=s,u,a=this,f;i&&(f=function(){!--s&&i.call(a)}),r=e.is(r,M)?r:f,u=this.items[--o].animate(t,n,r,f);while(o--)this.items[o]&&!this.items[o].removed&&this.items[o].animateWith(u,t,n,r,f);return this},On[i].insertAfter=function(e){var t=this.items[S];while(t--)this.items[t].insertAfter(e);return this},On[i].getBBox=function(){var e=[],t=[],n=[],r=[];for(var i=this.items[S];i--;){var s=this.items[i].getBBox();e[j](s.x),t[j](s.y),n[j](s.x+s.width),r[j](s.y+s.height)}return e=C[h](0,e),t=C[h](0,t),{x:e,y:t,width:N[h](0,n)-e,height:N[h](0,r)-t}},On[i].clone=function(e){e=new On;for(var t=0,n=this.items[S];t<n;t++)e[j](this.items[t].clone());return e},e.registerFont=function(e){if(!e.face)return e;this.fonts=this.fonts||{};var t={w:e.w,face:{},glyphs:{}},n=e.face["font-family"];for(var r in e.face)e.face[s](r)&&(t.face[r]=e.face[r]);this.fonts[n]?this.fonts[n][j](t):this.fonts[n]=[t];if(!e.svg){t.face["units-per-em"]=X(e.face["units-per-em"],10);for(var i in e.glyphs)if(e.glyphs[s](i)){var o=e.glyphs[i];t.glyphs[i]={w:o.w,k:{},d:o.d&&"M"+o.d[Q](/[mlcxtrv]/g,function(e){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[e]||"M"})+"z"};if(o.k)for(var u in o.k)o[s](u)&&(t.glyphs[i].k[u]=o.k[u])}}return e},l.getFont=function(t,n,r,i){i=i||"normal",r=r||"normal",n=+n||{normal:400,bold:700,lighter:300,bolder:800}[n]||400;if(!e.
fonts)return;var o=e.fonts[t];if(!o){var u=new RegExp("(^|\\s)"+t[Q](/[^\w\d\s+!~.:_-]/g,v)+"(\\s|$)","i");for(var a in e.fonts)if(e.fonts[s](a)&&u.test(a)){o=e.fonts[a];break}}var f;if(o)for(var l=0,c=o[S];l<c;l++){f=o[l];if(f.face["font-weight"]==n&&(f.face["font-style"]==r||!f.face["font-style"])&&f.face["font-stretch"]==i)break}return f},l.print=function(n,r,i,s,o,u,a){u=u||"middle",a=N(C(a||0,1),-1);var f=this.set(),l=g(i)[y](v),c=0,h=v,p;e.is(s,i)&&(s=this.getFont(s));if(s){p=(o||16)/s.face["units-per-em"];var d=s.face.bbox.split(t),m=+d[0],b=+d[1]+(u=="baseline"?d[3]-d[1]+ +s.face.descent:(d[3]-d[1])/2);for(var w=0,E=l[S];w<E;w++){var x=w&&s.glyphs[l[w-1]]||{},T=s.glyphs[l[w]];c+=w?(x.w||s.w)+(x.k&&x.k[l[w]]||0)+s.w*a:0,T&&T.d&&f[j](this.path(T.d).attr({fill:"#000",stroke:"none",translation:[c,0]}))}f.scale(p,p,m,b).translate(n-m,r-b)}return f},e.format=function(t,n){var i=e.is(n,_)?[0][p](n):arguments;return t&&e.is(t,M)&&i[S]-1&&(t=t[Q](r,function(e,t){return i[++t]==null?v:i[t]})),t||v},e.ninja=function(){return a.was?u.Raphael=a.is:delete Raphael,e},e.el=qt,e.st=On[i],a.was?u.Raphael=e:Raphael=e}(),SC.stringsFor("English",{"SC.Date.Era.AD.Abbreviated":"AD","SC.Date.Era.AD.Full":"Anno Domini","SC.Date.Era.AD.Letter":"A","SC.Date.Era.BC.Abbreviated":"BC","SC.Date.Era.BC.Full":"Before Christ","SC.Date.Era.BC.Letter":"B","SC.Date.Quarter.Q1.Abbreviated":"Q1","SC.Date.Quarter.Q1.Full":"1st quarter","SC.Date.Quarter.StandAlone.Q1.Abbreviated":"Q1","SC.Date.Quarter.StandAlone.Q1.Full":"1st Quarter","SC.Date.Quarter.Q2.Abbreviated":"Q2","SC.Date.Quarter.Q2.Full":"2nd quarter"
,"SC.Date.Quarter.StandAlone.Q2.Abbreviated":"Q2","SC.Date.Quarter.StandAlone.Q2.Full":"2nd Quarter","SC.Date.Quarter.Q3.Abbreviated":"Q3","SC.Date.Quarter.Q3.Full":"3rd quarter","SC.Date.Quarter.StandAlone.Q3.Abbreviated":"Q3","SC.Date.Quarter.StandAlone.Q3.Full":"3rd Quarter","SC.Date.Quarter.Q4.Abbreviated":"Q4","SC.Date.Quarter.Q4.Full":"4th quarter","SC.Date.Quarter.StandAlone.Q4.Abbreviated":"Q4","SC.Date.Quarter.StandAlone.Q4.Full":"4th Quarter","SC.Date.Month.January.Abbreviated":"Jan","SC.Date.Month.January.Full":"January","SC.Date.Month.January.Letter":"J","SC.Date.Month.StandAlone.January.Abbreviated":"Jan","SC.Date.Month.StandAlone.January.Full":"January","SC.Date.Month.StandAlone.January.Letter":"J","SC.Date.Month.February.Abbreviated":"Feb","SC.Date.Month.February.Full":"February","SC.Date.Month.February.Letter":"F","SC.Date.Month.StandAlone.February.Abbreviated":"Feb","SC.Date.Month.StandAlone.February.Full":"February","SC.Date.Month.StandAlone.February.Letter":"F","SC.Date.Month.March.Abbreviated":"Mar","SC.Date.Month.March.Full":"March","SC.Date.Month.March.Letter":"M","SC.Date.Month.StandAlone.March.Abbreviated":"Mar","SC.Date.Month.StandAlone.March.Full":"March","SC.Date.Month.StandAlone.March.Letter":"M","SC.Date.Month.April.Abbreviated":"Apr","SC.Date.Month.April.Full":"April","SC.Date.Month.April.Letter":"A","SC.Date.Month.StandAlone.April.Abbreviated":"Apr","SC.Date.Month.StandAlone.April.Full":"April","SC.Date.Month.StandAlone.April.Letter":"A","SC.Date.Month.May.Abbreviated":"May","SC.Date.Month.May.Full":"May","SC.Date.Month.May.Letter":"M","SC.Date.Month.StandAlone.May.Abbreviated"
:"May","SC.Date.Month.StandAlone.May.Full":"May","SC.Date.Month.StandAlone.May.Letter":"M","SC.Date.Month.June.Abbreviated":"Jun","SC.Date.Month.June.Full":"June","SC.Date.Month.June.Letter":"J","SC.Date.Month.StandAlone.June.Abbreviated":"Jun","SC.Date.Month.StandAlone.June.Full":"June","SC.Date.Month.StandAlone.June.Letter":"J","SC.Date.Month.July.Abbreviated":"Jul","SC.Date.Month.July.Full":"July","SC.Date.Month.July.Letter":"J","SC.Date.Month.StandAlone.July.Abbreviated":"Jul","SC.Date.Month.StandAlone.July.Full":"July","SC.Date.Month.StandAlone.July.Letter":"J","SC.Date.Month.August.Abbreviated":"Aug","SC.Date.Month.August.Full":"August","SC.Date.Month.August.Letter":"A","SC.Date.Month.StandAlone.August.Abbreviated":"Aug","SC.Date.Month.StandAlone.August.Full":"August","SC.Date.Month.StandAlone.August.Letter":"A","SC.Date.Month.September.Abbreviated":"Sep","SC.Date.Month.September.Full":"September","SC.Date.Month.September.Letter":"S","SC.Date.Month.StandAlone.September.Abbreviated":"Sep","SC.Date.Month.StandAlone.September.Full":"September","SC.Date.Month.StandAlone.September.Letter":"S","SC.Date.Month.October.Abbreviated":"Oct","SC.Date.Month.October.Full":"October","SC.Date.Month.October.Letter":"O","SC.Date.Month.StandAlone.October.Abbreviated":"Oct","SC.Date.Month.StandAlone.October.Full":"October","SC.Date.Month.StandAlone.October.Letter":"O","SC.Date.Month.November.Abbreviated":"Nov","SC.Date.Month.November.Full":"November","SC.Date.Month.November.Letter":"N","SC.Date.Month.StandAlone.November.Abbreviated":"Nov","SC.Date.Month.StandAlone.November.Full":"November"
,"SC.Date.Month.StandAlone.November.Letter":"N","SC.Date.Month.December.Abbreviated":"Dec","SC.Date.Month.December.Full":"December","SC.Date.Month.December.Letter":"D","SC.Date.Month.StandAlone.December.Abbreviated":"Dec","SC.Date.Month.StandAlone.December.Full":"December","SC.Date.Month.StandAlone.December.Letter":"D","SC.Date.Day.Monday.Abbreviated":"Mon","SC.Date.Day.Monday.Full":"Monday","SC.Date.Day.Monday.Letter":"M","SC.Date.Day.StandAlone.Monday.Abbreviated":"Mon","SC.Date.Day.StandAlone.Monday.Full":"Monday","SC.Date.Day.StandAlone.Monday.Letter":"M","SC.Date.Day.Tuesday.Abbreviated":"Tue","SC.Date.Day.Tuesday.Full":"Tuesday","SC.Date.Day.Tuesday.Letter":"T","SC.Date.Day.StandAlone.Tuesday.Abbreviated":"Tue","SC.Date.Day.StandAlone.Tuesday.Full":"Tuesday","SC.Date.Day.StandAlone.Tuesday.Letter":"T","SC.Date.Day.Wednesday.Abbreviated":"Wed","SC.Date.Day.Wednesday.Full":"Wednesday","SC.Date.Day.Wednesday.Letter":"W","SC.Date.Day.StandAlone.Wednesday.Abbreviated":"Wed","SC.Date.Day.StandAlone.Wednesday.Full":"Wednesday","SC.Date.Day.StandAlone.Wednesday.Letter":"W","SC.Date.Day.Thursday.Abbreviated":"Thu","SC.Date.Day.Thursday.Full":"Thursday","SC.Date.Day.Thursday.Letter":"R","SC.Date.Day.StandAlone.Thursday.Abbreviated":"Thu","SC.Date.Day.StandAlone.Thursday.Full":"Thursday","SC.Date.Day.StandAlone.Thursday.Letter":"R","SC.Date.Day.Friday.Abbreviated":"Fri","SC.Date.Day.Friday.Full":"Friday","SC.Date.Day.Friday.Letter":"F","SC.Date.Day.StandAlone.Friday.Abbreviated":"Fri","SC.Date.Day.StandAlone.Friday.Full":"Friday","SC.Date.Day.StandAlone.Friday.Letter":"F","SC.Date.Day.Saturday.Abbreviated"
:"Sat","SC.Date.Day.Saturday.Full":"Saturday","SC.Date.Day.Saturday.Letter":"S","SC.Date.Day.StandAlone.Saturday.Abbreviated":"Sat","SC.Date.Day.StandAlone.Saturday.Full":"Saturday","SC.Date.Day.StandAlone.Saturday.Letter":"S","SC.Date.Day.Sunday.Abbreviated":"Sun","SC.Date.Day.Sunday.Full":"Sunday","SC.Date.Day.Sunday.Letter":"S","SC.Date.Day.StandAlone.Sunday.Abbreviated":"Sun","SC.Date.Day.StandAlone.Sunday.Full":"Sunday","SC.Date.Day.StandAlone.Sunday.Letter":"S","SC.Date.Period.AM":"AM","SC.Date.Period.PM":"PM"}),SC.DateFormatter=function(e,t){if(!e)throw"No date passed to date formatter.";if(!e.getFullYear)throw"Object passed to date formatter was not a date!";if(!t)throw"No formatting string passed to date formatter. Date: "+e;var n=t.length,r=t[0],i;for(i=1;i<n;i++)if(t[i]!==r)throw"Invalid format string for a date; all characters must be the same: "+t+"; date: "+e;var s=SC.DateFormatter[r];if(!s)throw"No formatter `"+r+"` exists for date: "+e;return s(e,n)},SC.DateFormatter.G=function(e,t){var n="SC.Date.Era.";n+=e.getFullYear()>=0?"AD":"BC";if(t<=3)return(n+".Abbreviated").loc();if(t===4)return(n+".Full").loc();if(t===5)return(n+".Letter").loc();throw"Invalid era format: expected at most 5 digits; found "+t+"."},SC.DateFormatter.y=function(e,t){var n=e.getFullYear();t===1&&(t=n.length);var r=Math.abs(n).toString();while(r.length<t)r="0"+r;return r=r.substr(r.length-t),r},SC.DateFormatter.Y=function(e,t){return SC.DateFormatter.y(e,t)},SC.DateFormatter.u=function(e,t){var n=e.getFullYear();t===1&&(t=n.length);var r=n<0,i=Math.abs(n).toString();while(i.length<t)i="0"+
i;return i=i.substr(i.length-t),(r?"-":"")+i},SC.DateFormatter.Q=function(e,t,n){var r=e.getMonth(),i=Math.floor(r/3)+1,s="SC.Date.Quarter."+(n?"StandAlone.":"")+"Q"+i;if(t===1)return""+i;if(t===2)return"0"+i;if(t===3)return(s+".Abbreviated").loc();if(t==4)return(s+".Full").loc();throw"Unrecognized number of characters for quarter: "+t},SC.DateFormatter.q=function(e,t){return SC.DateFormatter.Q(e,t,YES)},SC.DateFormatter.ENGLISH_MONTH_NAMES=["January","February","March","April","May","June","July","August","September","October","November","December"],SC.DateFormatter.M=function(e,t,n){var r=e.getMonth(),i=""+(r+1),s="SC.Date.Month."+(n?n:"")+SC.DateFormatter.ENGLISH_MONTH_NAMES[r];if(t===1)return i;if(t===2)return i.length<2&&(i="0"+i),i;if(t===3)return(s+".Abbreviated").loc();if(t===4)return(s+".Full").loc();if(t===5)return(s+".Letter").loc();throw"The number of Ms or Ls must be from 1 to 5. Supplied: "+t},SC.DateFormatter.L=function(e,t){var n="StandAlone.";return SC.DateFormatter.M(e,t,n)},SC.DateFormatter.P=function(e,t){var n="Prepositional.";return SC.DateFormatter.M(e,t,n)},SC.DateFormatter.l=function(){throw"`l` date formatter not implemented."},SC.DateFormatter.w=function(e,t){throw"Week number currently not supported for date formatting."},SC.DateFormatter.W=function(e,t){throw"Week number currently not supported for date formatting."},SC.DateFormatter.d=function(e,t){var n=""+e.getDate();return t>n.length&&(n="0"+n),n},SC.DateFormatter.D=function(e,t){var n=new Date(e.getFullYear(),0,1),r=n.getTime(),i=e.getTime()-r,s=Math.floor(i/864e5)+1;s=""+s;while(s.length<t)
s="0"+s;return s},SC.DateFormatter.F=function(e,t){throw"Day of week in month (F) is not supported in date formatting"},SC.DateFormatter.g=function(e,t){throw"Julian day not supported in date formatting."},SC.DateFormatter.ENGLISH_DAY_NAMES=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],SC.DateFormatter.E=function(e,t){return t<3&&(t=3),SC.DateFormatter.e(e,t)},SC.DateFormatter.e=function(e,t,n){var r=e.getDay(),i=""+(r+1),s="SC.Date.Day."+(n?"StandAlone.":"")+SC.DateFormatter.ENGLISH_DAY_NAMES[r];if(t===1)return i;if(t===2)return i="0"+i,i;if(t===3)return(s+".Abbreviated").loc();if(t===4)return(s+".Full").loc();if(t===5)return(s+".Letter").loc();throw"Unrecognized number of `e`s, `c`s, or `E`s in date format string."},SC.DateFormatter.c=function(e,t){return SC.DateFormatter.e(e,t,YES)},SC.DateFormatter.a=function(e,t){if(t!==1)throw"`a` can only be included in a date format string once.";var n="SC.Date.Period."+(e.getHours()>11?"PM":"AM");return n.loc()},SC.DateFormatter._h=function(e,t,n,r){var i=e.getHours();n||(i%=12),r&&(n?i===0&&(i=24):i===0&&(i=12));var s=""+i;return s.length<t&&(s="0"+s),s},SC.DateFormatter.h=function(e,t){return SC.DateFormatter._h(e,t,NO,1)},SC.DateFormatter.H=function(e,t){return SC.DateFormatter._h(e,t,YES,0)},SC.DateFormatter.K=function(e,t){return SC.DateFormatter._h(e,t,NO,0)},SC.DateFormatter.k=function(e,t){return SC.DateFormatter._h(e,t,YES,1)},SC.DateFormatter.m=function(e,t){var n=""+e.getMinutes();return n.length<t&&(n="0"+n),n},SC.DateFormatter.s=function(e,t){var n=""+e.getSeconds();return n.length<t&&(n="0"+n
),n},SC.DateFormatter.S=function(e,t){var n=e.getMilliseconds()/1e3,r=Math.pow(10,t);n=Math.round(n*r),n=""+n;while(n.length<t)n="0"+n;return n},SC.DateFormatter.A=function(e,t){var n=(new Date(e.getFullYear(),e.getMonth(),e.getDay())).getTime(),r=e.getTime()-n;r=""+r;while(r.length<t)r="0"+r;return r},SC.DateFormatter.z=SC.DateFormatter.Z=SC.DateFormatter.v=SC.DateFormatter.V=function(e,t){throw"Timezone not supported in date format strings."},function(e,t){"use strict";typeof exports=="object"?module.exports=t(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains")):typeof define=="function"&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],t):e.URI=t(e.punycode,e.IPv6,e.SecondLevelDomains,e)}(this,function(e,t,n,r){"use strict";function s(e,t){var n=arguments.length>=1,r=arguments.length>=2;if(this instanceof s){if(e===undefined){if(n)throw new TypeError("undefined is not a valid argument for URI");typeof location!="undefined"?e=location.href+"":e=""}return this.href(e),t!==undefined?this.absoluteTo(t):this}return n?r?new s(e,t):new s(e):new s}function a(e){return e.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function f(e){return e===undefined?"Undefined":String(Object.prototype.toString.call(e)).slice(8,-1)}function l(e){return f(e)==="Array"}function c(e,t){var n={},r,i;if(f(t)==="RegExp")n=null;else if(l(t))for(r=0,i=t.length;r<i;r++)n[t[r]]=!0;else n[t]=!0;for(r=0,i=e.length;r<i;r++){var s=n&&n[e[r]]!==undefined||!n&&t.test(e[r]);s&&(e.splice(r,1),i--,r--)}return e}function h(e,t){var n,r;if(l(t)){for(n=0,r=t.length;n<r;n++)if(!h(e,t[n
]))return!1;return!0}var i=f(t);for(n=0,r=e.length;n<r;n++)if(i==="RegExp"){if(typeof e[n]=="string"&&e[n].match(t))return!0}else if(e[n]===t)return!0;return!1}function p(e,t){if(!l(e)||!l(t))return!1;if(e.length!==t.length)return!1;e.sort(),t.sort();for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function d(e){var t=/^\/+|\/+$/g;return e.replace(t,"")}function v(e){return escape(e)}function m(e){return encodeURIComponent(e).replace(/[!'()*]/g,v).replace(/\*/g,"%2A")}function E(e){return function(t,n){return t===undefined?this._parts[e]||"":(this._parts[e]=t||null,this.build(!n),this)}}function S(e,t){return function(n,r){return n===undefined?this._parts[e]||"":(n!==null&&(n+="",n.charAt(0)===t&&(n=n.substring(1))),this._parts[e]=n,this.build(!r),this)}}var i=r&&r.URI;s.version="1.18.1";var o=s.prototype,u=Object.prototype.hasOwnProperty;s._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:s.duplicateQueryParameters,escapeQuerySpace:s.escapeQuerySpace}},s.duplicateQueryParameters=!1,s.escapeQuerySpace=!0,s.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,s.idn_expression=/[^a-z0-9\.-]/i,s.punycode_expression=/(xn--)/i,s.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,s.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/
,s.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig,s.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/},s.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},s.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/,s.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},s.getDomAttribute=function(e){if(!e||!e.nodeName)return undefined;var t=e.nodeName.toLowerCase();return t==="input"&&e.type!=="image"?undefined:s.domAttributes[t]},s.encode=m,s.decode=decodeURIComponent,s.iso8859=function(){s.encode=escape,s.decode=unescape},s.unicode=function(){s.encode=m,s.decode=decodeURIComponent},s.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":"!","%24":"$","%27":"'"
,"%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},s.encodeQuery=function(e,t){var n=s.encode(e+"");return t===undefined&&(t=s.escapeQuerySpace),t?n.replace(/%20/g,"+"):n},s.decodeQuery=function(e,t){e+="",t===undefined&&(t=s.escapeQuerySpace);try{return s.decode(t?e.replace(/\+/g,"%20"):e)}catch(n){return e}};var g={encode:"encode",decode:"decode"},y,b=function(e,t){return function(n){try{return s[t](n+"").replace(s.characters[e][t].expression,function(n){return s.characters[e][t].map[n]})}catch(r){return n}}};for(y in g)s[y+"PathSegment"]=b("pathname",g[y]),s[y+"UrnPathSegment"]=b("urnpath",g[y]);var w=function(e,t,n){return function(r){var i;n?i=function(e){return s[t](s[n](e))}:i=s[t];var o=(r+"").split(e);for(var u=0,a=o.length;u<a;u++)o[u]=i(o[u]);return o.join(e)}};s.decodePath=w("/","decodePathSegment"),s.decodeUrnPath=w(":","decodeUrnPathSegment"),s.recodePath=w("/","encodePathSegment","decode"),s.recodeUrnPath=w(":","encodeUrnPathSegment","decode"),s.encodeReserved=b("reserved","encode"),s.parse=function(e,t){var n;return t||(t={}),n=e.indexOf("#"),n>-1&&(t.fragment=e.substring(n+1)||null,e=e.substring(0,n)),n=e.indexOf("?"),n>-1&&(t.query=e.substring(n+1)||null,e=e.substring(0,n)),e.substring(0,2)==="//"?(t.protocol=null,e=e.substring(2),e=s.parseAuthority(e,t)):(n=e.indexOf(":"),n>-1&&(t.protocol=e.substring(0,n)||null,t.protocol&&!t.protocol.match(s.protocol_expression)?t.protocol=undefined:e.substring(n+1,n+3)==="//"?(e=e.substring(n+3),e=s.parseAuthority
(e,t)):(e=e.substring(n+1),t.urn=!0))),t.path=e,t},s.parseHost=function(e,t){e=e.replace(/\\/g,"/");var n=e.indexOf("/"),r,i;n===-1&&(n=e.length);if(e.charAt(0)==="[")r=e.indexOf("]"),t.hostname=e.substring(1,r)||null,t.port=e.substring(r+2,n)||null,t.port==="/"&&(t.port=null);else{var s=e.indexOf(":"),o=e.indexOf("/"),u=e.indexOf(":",s+1);u!==-1&&(o===-1||u<o)?(t.hostname=e.substring(0,n)||null,t.port=null):(i=e.substring(0,n).split(":"),t.hostname=i[0]||null,t.port=i[1]||null)}return t.hostname&&e.substring(n).charAt(0)!=="/"&&(n++,e="/"+e),e.substring(n)||"/"},s.parseAuthority=function(e,t){return e=s.parseUserinfo(e,t),s.parseHost(e,t)},s.parseUserinfo=function(e,t){var n=e.indexOf("/"),r=e.lastIndexOf("@",n>-1?n:e.length-1),i;return r>-1&&(n===-1||r<n)?(i=e.substring(0,r).split(":"),t.username=i[0]?s.decode(i[0]):null,i.shift(),t.password=i[0]?s.decode(i.join(":")):null,e=e.substring(r+1)):(t.username=null,t.password=null),e},s.parseQuery=function(e,t){if(!e)return{};e=e.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"");if(!e)return{};var n={},r=e.split("&"),i=r.length,o,a,f;for(var l=0;l<i;l++){o=r[l].split("="),a=s.decodeQuery(o.shift(),t),f=o.length?s.decodeQuery(o.join("="),t):null;if(u.call(n,a)){if(typeof n[a]=="string"||n[a]===null)n[a]=[n[a]];n[a].push(f)}else n[a]=f}return n},s.build=function(e){var t="";return e.protocol&&(t+=e.protocol+":"),!e.urn&&(t||e.hostname)&&(t+="//"),t+=s.buildAuthority(e)||"",typeof e.path=="string"&&(e.path.charAt(0)!=="/"&&typeof e.hostname=="string"&&(t+="/"),t+=e.path),typeof e.query=="string"&&e.query&&(t+="?"+e.query),typeof e.fragment=="string"&&
e.fragment&&(t+="#"+e.fragment),t},s.buildHost=function(e){var t="";return e.hostname?(s.ip6_expression.test(e.hostname)?t+="["+e.hostname+"]":t+=e.hostname,e.port&&(t+=":"+e.port),t):""},s.buildAuthority=function(e){return s.buildUserinfo(e)+s.buildHost(e)},s.buildUserinfo=function(e){var t="";return e.username&&(t+=s.encode(e.username)),e.password&&(t+=":"+s.encode(e.password)),t&&(t+="@"),t},s.buildQuery=function(e,t,n){var r="",i,o,a,f;for(o in e)if(u.call(e,o)&&o)if(l(e[o])){i={};for(a=0,f=e[o].length;a<f;a++)e[o][a]!==undefined&&i[e[o][a]+""]===undefined&&(r+="&"+s.buildQueryParameter(o,e[o][a],n),t!==!0&&(i[e[o][a]+""]=!0))}else e[o]!==undefined&&(r+="&"+s.buildQueryParameter(o,e[o],n));return r.substring(1)},s.buildQueryParameter=function(e,t,n){return s.encodeQuery(e,n)+(t!==null?"="+s.encodeQuery(t,n):"")},s.addQuery=function(e,t,n){if(typeof t=="object")for(var r in t)u.call(t,r)&&s.addQuery(e,r,t[r]);else{if(typeof t!="string")throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(e[t]===undefined){e[t]=n;return}typeof e[t]=="string"&&(e[t]=[e[t]]),l(n)||(n=[n]),e[t]=(e[t]||[]).concat(n)}},s.removeQuery=function(e,t,n){var r,i,o;if(l(t))for(r=0,i=t.length;r<i;r++)e[t[r]]=undefined;else if(f(t)==="RegExp")for(o in e)t.test(o)&&(e[o]=undefined);else if(typeof t=="object")for(o in t)u.call(t,o)&&s.removeQuery(e,o,t[o]);else{if(typeof t!="string")throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");n!==undefined?f(n)==="RegExp"?!l(e[t])&&n.test(e[t])?e[t]=undefined:e[t]=c(e[t],n):e[t]!==String
(n)||!!l(n)&&n.length!==1?l(e[t])&&(e[t]=c(e[t],n)):e[t]=undefined:e[t]=undefined}},s.hasQuery=function(e,t,n,r){switch(f(t)){case"String":break;case"RegExp":for(var i in e)if(u.call(e,i)&&t.test(i)&&(n===undefined||s.hasQuery(e,i,n)))return!0;return!1;case"Object":for(var o in t)if(u.call(t,o)&&!s.hasQuery(e,o,t[o]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(f(n)){case"Undefined":return t in e;case"Boolean":var a=Boolean(l(e[t])?e[t].length:e[t]);return n===a;case"Function":return!!n(e[t],t,e);case"Array":if(!l(e[t]))return!1;var c=r?h:p;return c(e[t],n);case"RegExp":if(!l(e[t]))return Boolean(e[t]&&e[t].match(n));if(!r)return!1;return h(e[t],n);case"Number":n=String(n);case"String":if(!l(e[t]))return e[t]===n;if(!r)return!1;return h(e[t],n);default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},s.joinPaths=function(){var e=[],t=[],n=0;for(var r=0;r<arguments.length;r++){var i=new s(arguments[r]);e.push(i);var o=i.segment();for(var u=0;u<o.length;u++)typeof o[u]=="string"&&t.push(o[u]),o[u]&&n++}if(!t.length||!n)return new s("");var a=(new s("")).segment(t);return(e[0].path()===""||e[0].path().slice(0,1)==="/")&&a.path("/"+a.path()),a.normalize()},s.commonPath=function(e,t){var n=Math.min(e.length,t.length),r;for(r=0;r<n;r++)if(e.charAt(r)!==t.charAt(r)){r--;break}if(r<1)return e.charAt(0)===t.charAt(0)&&e.charAt(0)==="/"?"/":"";if(e.charAt(r)!=="/"||t.charAt(r)!=="/")r=e.substring(0,r).lastIndexOf("/")
;return e.substring(0,r+1)},s.withinString=function(e,t,n){n||(n={});var r=n.start||s.findUri.start,i=n.end||s.findUri.end,o=n.trim||s.findUri.trim,u=/[a-z0-9-]=["']?$/i;r.lastIndex=0;for(;;){var a=r.exec(e);if(!a)break;var f=a.index;if(n.ignoreHtml){var l=e.slice(Math.max(f-3,0),f);if(l&&u.test(l))continue}var c=f+e.slice(f).search(i),h=e.slice(f,c).replace(o,"");if(n.ignore&&n.ignore.test(h))continue;c=f+h.length;var p=t(h,f,c,e);e=e.slice(0,f)+p+e.slice(c),r.lastIndex=f+p.length}return r.lastIndex=0,e},s.ensureValidHostname=function(t){if(t.match(s.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-] and Punycode.js is not available');if(e.toASCII(t).match(s.invalid_hostname_characters))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]')}},s.noConflict=function(e){if(e){var t={URI:this.noConflict()};return r.URITemplate&&typeof r.URITemplate.noConflict=="function"&&(t.URITemplate=r.URITemplate.noConflict()),r.IPv6&&typeof r.IPv6.noConflict=="function"&&(t.IPv6=r.IPv6.noConflict()),r.SecondLevelDomains&&typeof r.SecondLevelDomains.noConflict=="function"&&(t.SecondLevelDomains=r.SecondLevelDomains.noConflict()),t}return r.URI===this&&(r.URI=i),this},o.build=function(e){if(e===!0)this._deferred_build=!0;else if(e===undefined||this._deferred_build)this._string=s.build(this._parts),this._deferred_build=!1;return this},o.clone=function(){return new s(this)},o.valueOf=o.toString=function(){return this.build(!1)._string},o.protocol=E("protocol"),o.username=E("username"),o.password=E("password"
),o.hostname=E("hostname"),o.port=E("port"),o.query=S("query","?"),o.fragment=S("fragment","#"),o.search=function(e,t){var n=this.query(e,t);return typeof n=="string"&&n.length?"?"+n:n},o.hash=function(e,t){var n=this.fragment(e,t);return typeof n=="string"&&n.length?"#"+n:n},o.pathname=function(e,t){if(e===undefined||e===!0){var n=this._parts.path||(this._parts.hostname?"/":"");return e?(this._parts.urn?s.decodeUrnPath:s.decodePath)(n):n}return this._parts.urn?this._parts.path=e?s.recodeUrnPath(e):"":this._parts.path=e?s.recodePath(e):"/",this.build(!t),this},o.path=o.pathname,o.href=function(e,t){var n;if(e===undefined)return this.toString();this._string="",this._parts=s._parts();var r=e instanceof s,i=typeof e=="object"&&(e.hostname||e.path||e.pathname);if(e.nodeName){var o=s.getDomAttribute(e);e=e[o]||"",i=!1}!r&&i&&e.pathname!==undefined&&(e=e.toString());if(typeof e=="string"||e instanceof String)this._parts=s.parse(String(e),this._parts);else{if(!r&&!i)throw new TypeError("invalid input");var a=r?e._parts:e;for(n in a)u.call(this._parts,n)&&(this._parts[n]=a[n])}return this.build(!t),this},o.is=function(e){var t=!1,r=!1,i=!1,o=!1,u=!1,a=!1,f=!1,l=!this._parts.urn;this._parts.hostname&&(l=!1,r=s.ip4_expression.test(this._parts.hostname),i=s.ip6_expression.test(this._parts.hostname),t=r||i,o=!t,u=o&&n&&n.has(this._parts.hostname),a=o&&s.idn_expression.test(this._parts.hostname),f=o&&s.punycode_expression.test(this._parts.hostname));switch(e.toLowerCase()){case"relative":return l;case"absolute":return!l;case"domain":case"name":return o;case"sld":return u;case"ip":return t
;case"ip4":case"ipv4":case"inet4":return r;case"ip6":case"ipv6":case"inet6":return i;case"idn":return a;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return f}return null};var x=o.protocol,T=o.port,N=o.hostname;o.protocol=function(e,t){if(e!==undefined&&e){e=e.replace(/:(\/\/)?$/,"");if(!e.match(s.protocol_expression))throw new TypeError('Protocol "'+e+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]")}return x.call(this,e,t)},o.scheme=o.protocol,o.port=function(e,t){if(this._parts.urn)return e===undefined?"":this;if(e!==undefined){e===0&&(e=null);if(e){e+="",e.charAt(0)===":"&&(e=e.substring(1));if(e.match(/[^0-9]/))throw new TypeError('Port "'+e+'" contains characters other than [0-9]')}}return T.call(this,e,t)},o.hostname=function(e,t){if(this._parts.urn)return e===undefined?"":this;if(e!==undefined){var n={},r=s.parseHost(e,n);if(r!=="/")throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');e=n.hostname}return N.call(this,e,t)},o.origin=function(e,t){if(this._parts.urn)return e===undefined?"":this;if(e===undefined){var n=this.protocol(),r=this.authority();return r?(n?n+"://":"")+this.authority():""}var i=s(e);return this.protocol(i.protocol()).authority(i.authority()).build(!t),this},o.host=function(e,t){if(this._parts.urn)return e===undefined?"":this;if(e===undefined)return this._parts.hostname?s.buildHost(this._parts):"";var n=s.parseHost(e,this._parts);if(n!=="/")throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},o.authority=
function(e,t){if(this._parts.urn)return e===undefined?"":this;if(e===undefined)return this._parts.hostname?s.buildAuthority(this._parts):"";var n=s.parseAuthority(e,this._parts);if(n!=="/")throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},o.userinfo=function(e,t){if(this._parts.urn)return e===undefined?"":this;if(e===undefined){var n=s.buildUserinfo(this._parts);return n?n.substring(0,n.length-1):n}return e[e.length-1]!=="@"&&(e+="@"),s.parseUserinfo(e,this._parts),this.build(!t),this},o.resource=function(e,t){var n;return e===undefined?this.path()+this.search()+this.hash():(n=s.parse(e),this._parts.path=n.path,this._parts.query=n.query,this._parts.fragment=n.fragment,this.build(!t),this)},o.subdomain=function(e,t){if(this._parts.urn)return e===undefined?"":this;if(e===undefined){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,n)||""}var r=this._parts.hostname.length-this.domain().length,i=this._parts.hostname.substring(0,r),o=new RegExp("^"+a(i));return e&&e.charAt(e.length-1)!=="."&&(e+="."),e&&s.ensureValidHostname(e),this._parts.hostname=this._parts.hostname.replace(o,e),this.build(!t),this},o.domain=function(e,t){if(this._parts.urn)return e===undefined?"":this;typeof e=="boolean"&&(t=e,e=undefined);if(e===undefined){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.match(/\./g);if(n&&n.length<2)return this._parts.hostname;var r=this._parts.hostname.length-this.tld(t).length-1;return r=this
._parts.hostname.lastIndexOf(".",r-1)+1,this._parts.hostname.substring(r)||""}if(!e)throw new TypeError("cannot set domain empty");s.ensureValidHostname(e);if(!this._parts.hostname||this.is("IP"))this._parts.hostname=e;else{var i=new RegExp(a(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(i,e)}return this.build(!t),this},o.tld=function(e,t){if(this._parts.urn)return e===undefined?"":this;typeof e=="boolean"&&(t=e,e=undefined);if(e===undefined){if(!this._parts.hostname||this.is("IP"))return"";var r=this._parts.hostname.lastIndexOf("."),i=this._parts.hostname.substring(r+1);return t!==!0&&n&&n.list[i.toLowerCase()]?n.get(this._parts.hostname)||i:i}var s;if(!e)throw new TypeError("cannot set TLD empty");if(e.match(/[^a-zA-Z0-9-]/)){if(!n||!n.is(e))throw new TypeError('TLD "'+e+'" contains characters other than [A-Z0-9]');s=new RegExp(a(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(s,e)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");s=new RegExp(a(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(s,e)}return this.build(!t),this},o.directory=function(e,t){if(this._parts.urn)return e===undefined?"":this;if(e===undefined||e===!0){if(!this._parts.path&&!this._parts.hostname)return"";if(this._parts.path==="/")return"/";var n=this._parts.path.length-this.filename().length-1,r=this._parts.path.substring(0,n)||(this._parts.hostname?"/":"");return e?s.decodePath(r):r}var i=this._parts.path.length-this.filename().length,o=this._parts.path.substring(0,i),u=new RegExp("^"+
a(o));return this.is("relative")||(e||(e="/"),e.charAt(0)!=="/"&&(e="/"+e)),e&&e.charAt(e.length-1)!=="/"&&(e+="/"),e=s.recodePath(e),this._parts.path=this._parts.path.replace(u,e),this.build(!t),this},o.filename=function(e,t){if(this._parts.urn)return e===undefined?"":this;if(e===undefined||e===!0){if(!this._parts.path||this._parts.path==="/")return"";var n=this._parts.path.lastIndexOf("/"),r=this._parts.path.substring(n+1);return e?s.decodePathSegment(r):r}var i=!1;e.charAt(0)==="/"&&(e=e.substring(1)),e.match(/\.?\//)&&(i=!0);var o=new RegExp(a(this.filename())+"$");return e=s.recodePath(e),this._parts.path=this._parts.path.replace(o,e),i?this.normalizePath(t):this.build(!t),this},o.suffix=function(e,t){if(this._parts.urn)return e===undefined?"":this;if(e===undefined||e===!0){if(!this._parts.path||this._parts.path==="/")return"";var n=this.filename(),r=n.lastIndexOf("."),i,o;return r===-1?"":(i=n.substring(r+1),o=/^[a-z0-9%]+$/i.test(i)?i:"",e?s.decodePathSegment(o):o)}e.charAt(0)==="."&&(e=e.substring(1));var u=this.suffix(),f;if(!u){if(!e)return this;this._parts.path+="."+s.recodePath(e)}else e?f=new RegExp(a(u)+"$"):f=new RegExp(a("."+u)+"$");return f&&(e=s.recodePath(e),this._parts.path=this._parts.path.replace(f,e)),this.build(!t),this},o.segment=function(e,t,n){var r=this._parts.urn?":":"/",i=this.path(),s=i.substring(0,1)==="/",o=i.split(r);e!==undefined&&typeof e!="number"&&(n=t,t=e,e=undefined);if(e!==undefined&&typeof e!="number")throw new Error('Bad segment "'+e+'", must be 0-based integer');s&&o.shift(),e<0&&(e=Math.max(o.length+e,0));if(t===undefined)return e===
undefined?o:o[e];if(e===null||o[e]===undefined){if(l(t)){o=[];for(var u=0,a=t.length;u<a;u++){if(!t[u].length&&(!o.length||!o[o.length-1].length))continue;o.length&&!o[o.length-1].length&&o.pop(),o.push(d(t[u]))}}else if(t||typeof t=="string")t=d(t),o[o.length-1]===""?o[o.length-1]=t:o.push(t)}else t?o[e]=d(t):o.splice(e,1);return s&&o.unshift(""),this.path(o.join(r),n)},o.segmentCoded=function(e,t,n){var r,i,o;typeof e!="number"&&(n=t,t=e,e=undefined);if(t===undefined){r=this.segment(e,t,n);if(!l(r))r=r!==undefined?s.decode(r):undefined;else for(i=0,o=r.length;i<o;i++)r[i]=s.decode(r[i]);return r}if(!l(t))t=typeof t=="string"||t instanceof String?s.encode(t):t;else for(i=0,o=t.length;i<o;i++)t[i]=s.encode(t[i]);return this.segment(e,t,n)};var C=o.query;return o.query=function(e,t){if(e===!0)return s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof e=="function"){var n=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace),r=e.call(this,n);return this._parts.query=s.buildQuery(r||n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this}return e!==undefined&&typeof e!="string"?(this._parts.query=s.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this):C.call(this,e,t)},o.setQuery=function(e,t,n){var r=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof e=="string"||e instanceof String)r[e]=t!==undefined?t:null;else{if(typeof e!="object")throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var i in e)u.call(e,i)&&(r[i]=
e[i])}return this._parts.query=s.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof e!="string"&&(n=t),this.build(!n),this},o.addQuery=function(e,t,n){var r=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return s.addQuery(r,e,t===undefined?null:t),this._parts.query=s.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof e!="string"&&(n=t),this.build(!n),this},o.removeQuery=function(e,t,n){var r=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return s.removeQuery(r,e,t),this._parts.query=s.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof e!="string"&&(n=t),this.build(!n),this},o.hasQuery=function(e,t,n){var r=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return s.hasQuery(r,e,t,n)},o.setSearch=o.setQuery,o.addSearch=o.addQuery,o.removeSearch=o.removeQuery,o.hasSearch=o.hasQuery,o.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},o.normalizeProtocol=function(e){return typeof this._parts.protocol=="string"&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!e)),this},o.normalizeHostname=function(n){return this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&t&&(this._parts.hostname=t.best(this._parts.hostname)),this._parts.hostname=this._parts
.hostname.toLowerCase(),this.build(!n)),this},o.normalizePort=function(e){return typeof this._parts.protocol=="string"&&this._parts.port===s.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!e)),this},o.normalizePath=function(e){var t=this._parts.path;if(!t)return this;if(this._parts.urn)return this._parts.path=s.recodeUrnPath(this._parts.path),this.build(!e),this;if(this._parts.path==="/")return this;t=s.recodePath(t);var n,r="",i,o;t.charAt(0)!=="/"&&(n=!0,t="/"+t);if(t.slice(-3)==="/.."||t.slice(-2)==="/.")t+="/";t=t.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),n&&(r=t.substring(1).match(/^(\.\.\/)+/)||"",r&&(r=r[0]));for(;;){i=t.search(/\/\.\.(\/|$)/);if(i===-1)break;if(i===0){t=t.substring(3);continue}o=t.substring(0,i).lastIndexOf("/"),o===-1&&(o=i),t=t.substring(0,o)+t.substring(i+3)}return n&&this.is("relative")&&(t=r+t.substring(1)),this._parts.path=t,this.build(!e),this},o.normalizePathname=o.normalizePath,o.normalizeQuery=function(e){return typeof this._parts.query=="string"&&(this._parts.query.length?this.query(s.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!e)),this},o.normalizeFragment=function(e){return this._parts.fragment||(this._parts.fragment=null,this.build(!e)),this},o.normalizeSearch=o.normalizeQuery,o.normalizeHash=o.normalizeFragment,o.iso8859=function(){var e=s.encode,t=s.decode;s.encode=escape,s.decode=decodeURIComponent;try{this.normalize()}finally{s.encode=e,s.decode=t}return this},o.unicode=function(){var e=s.encode,t=s.decode;s.encode=m,s.decode=unescape;try{this
.normalize()}finally{s.encode=e,s.decode=t}return this},o.readable=function(){var t=this.clone();t.username("").password("").normalize();var n="";t._parts.protocol&&(n+=t._parts.protocol+"://"),t._parts.hostname&&(t.is("punycode")&&e?(n+=e.toUnicode(t._parts.hostname),t._parts.port&&(n+=":"+t._parts.port)):n+=t.host()),t._parts.hostname&&t._parts.path&&t._parts.path.charAt(0)!=="/"&&(n+="/"),n+=t.path(!0);if(t._parts.query){var r="";for(var i=0,o=t._parts.query.split("&"),u=o.length;i<u;i++){var a=(o[i]||"").split("=");r+="&"+s.decodeQuery(a[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),a[1]!==undefined&&(r+="="+s.decodeQuery(a[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}n+="?"+r.substring(1)}return n+=s.decodeQuery(t.hash(),!0),n},o.absoluteTo=function(e){var t=this.clone(),n=["protocol","username","password","hostname","port"],r,i,o;if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");e instanceof s||(e=new s(e)),t._parts.protocol||(t._parts.protocol=e._parts.protocol);if(this._parts.hostname)return t;for(i=0;o=n[i];i++)t._parts[o]=e._parts[o];return t._parts.path?t._parts.path.substring(-2)===".."&&(t._parts.path+="/"):(t._parts.path=e._parts.path,t._parts.query||(t._parts.query=e._parts.query)),t.path().charAt(0)!=="/"&&(r=e.directory(),r=r?r:e.path().indexOf("/")===0?"/":"",t._parts.path=(r?r+"/":"")+t._parts.path,t.normalizePath()),t.build(),t},o.relativeTo=function(e){var t=this.clone().normalize(),n,r,i,o,u;if(t._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components")
;e=(new s(e)).normalize(),n=t._parts,r=e._parts,o=t.path(),u=e.path();if(o.charAt(0)!=="/")throw new Error("URI is already relative");if(u.charAt(0)!=="/")throw new Error("Cannot calculate a URI relative to another relative URI");n.protocol===r.protocol&&(n.protocol=null);if(n.username!==r.username||n.password!==r.password)return t.build();if(n.protocol!==null||n.username!==null||n.password!==null)return t.build();if(n.hostname!==r.hostname||n.port!==r.port)return t.build();n.hostname=null,n.port=null;if(o===u)return n.path="",t.build();i=s.commonPath(o,u);if(!i)return t.build();var a=r.path.substring(i.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return n.path=a+n.path.substring(i.length)||"./",t.build()},o.equals=function(e){var t=this.clone(),n=new s(e),r={},i={},o={},a,f,c;t.normalize(),n.normalize();if(t.toString()===n.toString())return!0;a=t.query(),f=n.query(),t.query(""),n.query("");if(t.toString()!==n.toString())return!1;if(a.length!==f.length)return!1;r=s.parseQuery(a,this._parts.escapeQuerySpace),i=s.parseQuery(f,this._parts.escapeQuerySpace);for(c in r)if(u.call(r,c)){if(!l(r[c])){if(r[c]!==i[c])return!1}else if(!p(r[c],i[c]))return!1;o[c]=!0}for(c in i)if(u.call(i,c)&&!o[c])return!1;return!0},o.duplicateQueryParameters=function(e){return this._parts.duplicateQueryParameters=!!e,this},o.escapeQuerySpace=function(e){return this._parts.escapeQuerySpace=!!e,this},s}),function(e,t){var n=e.prototype;n.baseEquals=function(t){var n=(new e(this)).normalize(),r=(new e(t)).normalize(),i=n.protocol()+"://"+n.domain()+":"+n.port(),s=r.protocol()+"://"+r.domain()+":"+
r.port();return i===s}}(window.URI),function(e,t){var n=e.prototype;n.sortQuery=function(){var t=this._parts.query;if(!t.length)this._parts.query=null;else{var n=e.parseQuery(t),r,i,s,o;this.query(null),o=CW.invertHash(n).sort();for(r=0,i=o.length;r<i;r++)s=o[r],this.addQuery(s,n[s])}return this}}(window.URI),SC.stringsFor("English",{"Uploader.fileTooBigDescription":"The file was too big","Uploader.wrongFiletypeDescription":"The file type is not supported"}),CW=SC.Object.create({NAMESPACE:"CW",VERSION:"1.0.0"}),CW.mixin({upperCaseUUID:function(){return this.UUID().toString().toUpperCase()},UUID:function(){var e=new Array(36),t=0,n=["8","9","a","b"];if(window.crypto&&window.crypto.getRandomValues){var r=new Uint8Array(18);crypto.getRandomValues(r);for(t=0;t<18;t++)e[t*2+1]=(r[t]>>4).toString(16),e[t*2]=(r[t]&15).toString(16);e[19]=n[r[9]>>6]}else{while(t<36)e[t]=(Math.random()*16|0).toString(16),t++;e[19]=n[Math.random()*4|0]}return e[8]=e[13]=e[18]=e[23]="-",e[14]="4",e.join("")},invertArray:function(e){e||CW.fatalError("invertArray():  You must specify an array to invert");var t,n,r,i={};for(t=0,n=e.length;t<n;++t)r=e[t],i[r]=!0;return i},invertArrayWithOrder:function(e){e||CW.fatalError("invertArrayWithOrder():  You must specify an array to invert");var t,n,r,i={};for(t=0,n=e.length;t<n;++t)r=e[t],i[r]=t;return i},invertHash:function(e,t){e||CW.fatalError("invertHash():  You must specify an hash to invert");var n,r,i=[];if(t)for(n in e)r=e[n],r&&i.push(parseInt(n,10));else for(n in e)r=e[n],r&&i.push(n);return i},combineHashes:function(e,t){var n=SC.clone(e),r;for(r in t)n
[r]=t[r];return n},hashDifferencesBreakdown:function(e,t,n){(!e||!t)&&CW.fatalError("hashDifferencesBreakdown() must be called with two hashes"),e===t&&CW.fatalError("hashDifferencesBreakdown() must be called with two different hashes");var r=[],i=[],s=[],o=[],u,a,f,l;n&&(u=this.invertArray(n));var c=CW.getSimpleTypes(),h={},p,d,v,m;for(a in e){h[a]=!0;if(u&&u[a])continue;p=e[a],d=t[a],d===undefined?s.push(a):(v=p===d,v||(m=SC.typeOf(p),c[m]?v=!1:v=CW.valuesAreEqual(p,d,m)),v?r.push(a):i.push(a))}for(a in t)h[a]||o.push(a);return{equal:r,different:i,firstHashOnly:s,secondHashOnly:o}},valuesAreEqual:function(e,t,n,r){if(e===t)return!0;n||(n=SC.typeOf(e));var i=CW.getSimpleTypes();if(i[n])return!1;r||(r=SC.typeOf(t));if(n!==r)return!1;if(n===SC.T_DATE)return e.getTime()===t.getTime();if(n===SC.T_REGEXP)return e.toString()===t.toString();if(n===SC.T_HASH){var s=0,o,u,a,f;for(o in e){++s,u=e[o],a=t[o];if(u!==a){f=SC.typeOf(u);if(i[f])return!1;if(!CW.valuesAreEqual(u,a,f))return!1}}for(o in t)--s;return s===0}if(n===SC.T_ARRAY){var l=e.length,c=t.length;if(l!==c)return!1;for(var h=l-1;h>=0;--h){u=e[h],a=t[h];if(u!==a){f=SC.typeOf(u);if(i[f])return!1;if(!CW.valuesAreEqual(u,a,f))return!1}}return!0}CW.fatalError("Unsupported type for CW.valuesAreEqual:  '%@'".fmt(n))},getSimpleTypes:function(){var e=CW._simpleTypes;return e||(e=CW._simpleTypes={},e[SC.T_STRING]=!0,e[SC.T_NUMBER]=!0,e[SC.T_BOOL]=!0,e[SC.T_UNDEFINED]=!0,e[SC.T_NULL]=!0),e},getUrlParameters:function(e){e||(e=location.search);var t=new URI.parse(e);return t.query?URI.parseQuery(t.query):{}},escapeRegexCharacters:function(
e){return e.replace(/[-[\]{}()*+?.,\\^$|#]/g,"\\$&")},formatNumber:function(e,t,n){if(SC.none(e))return"";SC.none(t)&&(t=","),SC.none(n)&&(n="."),e=e.toString();var r=e.split("."),i=r[0],s=r[1],o=/(\d+?)(?=(?:\d{3})+$)/g,u="$1"+t;return i=i.replace(o,u),s?i+n+s:i},preloadTargetImages:function(e){if(SC.APP_IMAGE_ASSETS)for(var t=0,n=SC.APP_IMAGE_ASSETS.length;t<n;t++)(!e||SC.APP_IMAGE_ASSETS[t].indexOf(e)!==-1)&&SC.imageQueue.loadImage(SC.APP_IMAGE_ASSETS[t])},guidForContents:function(e,t){var n=t|0,r="",i,s,o;if(CW.isArrayLike(e)){i=e.length;for(s=0;s<i;s++)s&&(r+=","),r+=CW.componentForValue(e[s],n);return"["+r+"]"}if(SC.kindOf(e,SC.Array)){i=e.get("length");for(s=0;s<i;s++)s&&(r+=","),r+=CW.componentForValue(e.objectAt(s),n);return"["+r+"]"}if(!CW.isPrimitive(e)){var u=[];for(o in e)e.hasOwnProperty(o)&&u.push(o);u.sort(),i=u.length;for(s=0;s<i;s++)o=u[s],s&&(r+=","),r+='"'+o+'":'+CW.componentForValue(e[o],n);return"{"+r+"}"}CW.fatalError("Object expected in call to `guidForContents`.",e)},componentForValue:function(e,t){return t>0&&!CW.isPrimitive(e)?CW.guidForContents(e,t-1):'"'+SC.guidFor(e)+'"'},isArrayLike:function(e){return Array.isArray(e)?!0:e&&""+e=="[object Arguments]"},isPrimitive:function(e){return e===null||typeof e!="object"&&typeof e!="function"},fontDetector:function(e,t){var n=t.delay||50,r=t.timeout||1e3,i=t.testString||"MMMMMMMIIIa%@!",s=t.testFontFamily||'"Comic Sans MS"',o=t.testFontSize||"300px",u=t.targetFontWeight||"500",a=t.fail,f=t.success,l=t.complete,c,h,p=document.createElement("canvas"),d=p.getContext("2d");d.font=u+" "+o+" "+s;var v=d.measureText
(i).width;h=window.setInterval(function(){d.font=u+" "+o+' "'+e+'", '+s,d.measureText(i).width!==v&&v!==0&&(window.clearInterval(h),window.clearTimeout(c),f&&SC.run(f()),l&&SC.run(l(!0)))},n),c=window.setTimeout(function(){window.clearInterval(h),a&&SC.run(a()),l&&SC.run(l(!1))},r)}}),SC.ready(function(){setTimeout(function(){CW.preloadTargetImages()},2e3)}),CW.mixin({fatalError:function(e,t){var n=this.recordStack(YES,YES),r;throw e instanceof Error?r=e:r=new Error(e),t&&SC.mixin(r,t),r.recordedStack=n,r},recordStack:function(e,t){if(t||!this.get("hasSymbolicated"))try{this.symbolicate()}catch(n){}var r=arguments.callee,i=r?r.caller:null,s=0,o=[],u={},a,f,l,c,h,p;i&&e&&(i=i.caller);while(i&&s<26){a=i.displayName,a||(a=i.name),a||(a=i.toString()),a.length>150&&(a=a.substring(0,150)),l={func:a},f=i.arguments;if(f){c=[];for(h=0;h<5;++h)p=f[h],p&&(p.toString?p=p.toString():p="(argument without .toString() method)"),c.push(p);l.args=c}o[s++]=l;if(u[a]){o[s++]="(Because "+a+" was called recursively, no more of the stack is available)";break}u[a]=!0,i=i.caller}return o},hasSymbolicated:NO,namespacesToSymbolicate:["SC"],symbolicate:function(){if(!SC.Object.toString()){SC.warn("Cannot yet properly symbolicate because SproutCore is not yet in a position to provide class names");return}this.hasSymbolicated||(this.hasSymbolicated=!0);if(!SC||!SC.typeOf)return;var e=SC.getCurrentTimeForPerformance();this._symbolicateClassAndSubclasses(SC.Object);var t=this.namespacesToSymbolicate,n=CW.invertArray(t),r,i,s,o,u,a,f,l,c,h;if(!t)return;for(r in window){if(n[r])continue;i=r.charAt(0);if(i.toUpperCase
()===i)try{f=window[r],f&&f.isObject&&t.push(r)}catch(p){}}for(u=0,a=t.length;u<a;++u){s=t[u],o=window[s];for(r in o){if(!o.hasOwnProperty(r))continue;f=o[r];if(!f)continue;if(f instanceof Function)f.displayName||(l=s+"."+r,f.displayName=l);else if(f instanceof Object&&!f.isClass)for(c in f){if(!f.hasOwnProperty(c))continue;try{h=f[c],h instanceof Function&&(h.displayName||(l=s+"."+r+"."+c,h.displayName=l))}catch(d){SC.warn("Can not symbolicate %@: %@",c,d)}}}}SC.info("Spent %@ ms symbolicating",SC.getCurrentTimeForPerformance()-e)},_symbolicateClassAndSubclasses:function(e){var t=e.toString(),n,r,i,s,o,u;if(!t)return;for(n in e){if(!e.hasOwnProperty(n))continue;r=e[n],r instanceof Function&&(r.displayName||(i=t+"."+n,r.displayName=i))}s=e.prototype;for(n in s){if(!s.hasOwnProperty(n))continue;r=s[n],r instanceof Function&&(r.displayName||(i=t+"#"+n,r.displayName=i))}o=e.subclasses;for(n in o)u=o[n],u&&u.isClass&&this._symbolicateClassAndSubclasses(u)}}),CW.FakeReply=SC.Object.extend({isFakeReply:YES,shouldProcessRequestNormally:NO,applyToBackgroundRequests:NO,status:undefined,statusText:undefined,responseText:undefined,urlFilter:undefined,delay:undefined,headers:undefined,readyState:undefined,_lowercaseHeaders:null,getAllResponseHeaders:function(){var e=this.get("headers"),t="";for(var n in e){var r=e[n];t+=n+": "+r+"\n"}return t},getResponseHeader:function(e){if(!e)return;var t=this._lowercaseHeaders;if(!t){t=this._lowercaseHeaders={};var n=this.get("headers");for(var r in n){var i=n[r];t[r.toLowerCase()]=i}}return t[e.toLowerCase()]},abort:function(){},toString:function()
{if(this.get("shouldProcessRequestNormally"))return"will be sent normally";var e=[],t=CW.FakeReply.allowableCreationParams,n,r,i,s;for(n=0,r=t.length;n<r;++n){i=t[n],s=this.get(i);if(s!==undefined){if(i==="applyToBackgroundRequests"&&!s)continue;SC.typeOf(s)===SC.T_STRING?e.push("%@=“%@”".fmt(i,s)):e.push("%@=%@".fmt(i,s))}}return e.join(",  ")}}),SC.mixin(CW.FakeReply,{allowableCreationParams:["applyToBackgroundRequests","status","statusText","responseText","responseHash","urlFilter","delay","headers"],_allowableCreationParamsHash:null,createFakeReply:function(e){var t=CW.FakeReply,n=t._allowableCreationParamsHash,r,i,s,o;if(!n){n=t._allowableCreationParamsHash={},i=t.allowableCreationParams;for(s=0,o=i.length;s<o;++s)r=i[s],n[r]=YES}if(e===null)return t.create({shouldProcessRequestNormally:YES});e||CW.fatalError("You must specify params for the fake reply");var u=NO;for(r in e)n[r]||(console.error&&console.error("Fake reply has an unrecognized parameter “%@”:".fmt(r),e),u=YES);u&&CW.fatalError("Unrecognized parameter in fake reply");var a=0,f=e.status;f===undefined?(console.error&&console.error("Fake reply does not include a status:",e),++a):f||(console.error&&console.error("Fake reply has an invalid status of 0:",e),++a);var l=e.responseText,c=e.responseHash;l===undefined&&!c?l=e.responseText="Fake reply with status "+f:l!==undefined&&c?(console.error&&console.error("Fake reply has both a responseText and a responseHash:",e),++a):l!==undefined&&SC.typeOf(l)!==SC.T_STRING?(console.error&&console.error("Fake reply has an invalid responseText (it should be a string):",e),++a
):c&&SC.typeOf(c)!==SC.T_HASH&&(console.error&&console.error("Fake reply has an invalid responseHash (it should be a hash):",e),++a);var h=e.urlFilter;h&&!(h instanceof RegExp)&&(SC.typeOf(h)===SC.T_STRING?e.urlFilter=new RegExp(h):(console.error&&console.error("Fake reply has an invalid urlFilter (it should be a string or a RegExp instance):",e),++a));if(c&&a===0){delete e.responseHash;try{e.responseText=SC.json.encode(c)}catch(p){console.error&&console.error("There was an error encoding JSON from the responseHash:  "+p+",  fake reply:",e),++a}}if(a===1)CW.fatalError("There was one error with the fake reply parameters");else{if(!(a>0))return t.create(e);CW.fatalError("There were %@ errors with the fake reply parameters".fmt(a))}}}),CW.mixin({requestLoggingLevel:null,fakeReplyQueue:null,addFakeReply:function(e,t){SC.typeOf(e)!==SC.T_ARRAY&&(e=SC.$A(e));var n=CW.FakeReply,r=[],i,s,o,u;for(i=0,s=e.length;i<s;++i){o=e[i],u=null;try{u=n.createFakeReply(o)}catch(a){}u&&r.push(u)}var f=e.length,l=r.length;if(f!==l){var c=f-l;c===1?CW.fatalError("Errors prevented your fake reply from being added.  The fake reply queue was not changed."):CW.fatalError("Errors prevented %@ of your %@ fake replies from being added.  The fake reply queue was not changed.".fmt(c,f))}var h=this.get("fakeReplyQueue");h||(h=[],this.set("fakeReplyQueue",h)),h.beginPropertyChanges();for(i=0,s=r.length;i<s;++i)u=r[i],h.pushObject(u);h.endPropertyChanges(),t||(console.log("The fake reply queue is now:"),this.listFakeReplyQueue())},listFakeReplyQueue:function(){var e=this.get("fakeReplyQueue");if(!e)console.log
("(no fake reply queue)");else{var t=[],n,r,i;for(n=0,r=e.length;n<r;++n)i=e[n],t.push("[%@]  %@".fmt(n,i));console.log(t.join("\n"))}},_recordingCount:0,_logRequestIfAppropriateFor:function(e){e||CW.fatalError("_logRequestIfAppropriateFor():  A response must be specified");var t=this.get("requestLoggingLevel"),n=++this._recordingCount,r,i,s,o,u,a,f;t&&(e._recordingID=n,e._sentAt=SC.getCurrentTimeForPerformance(),r=e.get("request"),i=r.get("type"),s=r.getFullAddress(),o=this._sortAndStringifyHeaders(r.get("headers")),u=r.get("cookies"),r.get("bodyShouldBeLogged")?(a=r.get("encodedBody"),a||(a="(empty)")):a="(omitted)",f="-->  Request "+n+":   "+i+" to "+s+",  headers: "+o+(u?",  cookies: "+u:"")+",  body: "+a,SC.Logger._handleMessage(t,NO,f))},_logResponseIfAppropriate:function(e){e||CW.fatalError("_logResponseIfAppropriateFor():  A response must be specified");var t=this.get("requestLoggingLevel"),n=SC.getCurrentTimeForPerformance(),r,i,s,o,u,a,f,l,c;if(t){r=e._recordingID,i=e._sentAt,s=e._receivedAtWhileSuspended,o=e.get("timedOut"),o?u="  (timed out)":s?u=i?"  ("+(s-i)+"ms, suspended for "+(n-s)+"ms)":"  (unknown)":u=i?"  ("+(n-i)+"ms)":"  (unknown)",a=e.get("status");try{f=this._sortAndStringifyHeaders(e.get("headers"))}catch(h){}e.get("bodyShouldBeLogged")?(l=e.get("encodedBody"),l||(l="(empty)")):l="(omitted)",c="<--  Response "+r+":  "+a+u+",  headers: "+f+"  body: "+l,SC.Logger._handleMessage(t,NO,c)}},_sortAndStringifyHeaders:function(e){var t,n,r,i,s,o=[];for(t in e)o.push(t);o.sort(),r="";for(i=0,s=o.length;i<s;++i)t=o[i],n=e[t],i!==0&&(r+=", "),r+=t+"="+n;return r
}}),CW.ButtonKeyHandlingHelpers={isDefault:NO,isCancel:NO,keyHandlersDidChange:function(){var e=null,t=this.get("isDefault"),n=this.get("isCancel");t?this.registerKeyboardShortcut("return",this,this.triggerActionFromKeyboardShortcut):this.deregisterKeyboardShortcut("return"),n?this.registerKeyboardShortcut("escape",this,this.triggerActionFromKeyboardShortcut):this.deregisterKeyboardShortcut("escape")}.observes("isDefault","isCancel"),initMixin:function(){this.get("isDefault")&&this.registerKeyboardShortcut("return",this,this.triggerActionFromKeyboardShortcut),this.get("isCancel")&&this.registerKeyboardShortcut("escape",this,this.triggerActionFromKeyboardShortcut)},triggerActionFromKeyboardShortcut:function(e){return this.triggerAction(),YES}},CW.ViewKeyHandlingHelpers={keyboardShortcuts:null,initMixin:function(){this._cwvkh_paneDidChange()},_cwvkh_paneDidChange:function(){var e,t,n,r,i,s=this,o;if(this.keyboardShortcuts&&this._cwvkh_lastPane!==this.get("pane")){n=this.get("pane"),e=this.get("keyboardShortcuts"),r=this._cwvkh_lastPane;if(r)for(t in e)r.deregisterKeyboardShortcut(t);if(n)for(t in e)i=e[t],typeof i=="string"||typeof i=="function"?o=i:(s=i.target,o=i.action),n.registerKeyboardShortcut(t,s,o);this._cwvkh_lastPane=n}}.observes("pane"),registerKeyboardShortcut:function(e,t,n){n||(n=t,t=this);var r=this.keyboardShortcuts,i=this.get("pane");r||(r=this.keyboardShortcuts={}),r[e]={target:t,action:n},i&&i.registerKeyboardShortcut(e,t,n)},deregisterKeyboardShortcut:function(e){var t=this.keyboardShortcuts,n=this.get("pane");t&&(delete this.keyboardShortcuts[e],n&&n.deregisterKeyboardShortcut
(e))}},function(e){function S(e){throw new RangeError(g[e])}function x(e,t){var n=e.length,r=[];while(n--)r[n]=t(e[n]);return r}function T(e,t){var n=e.split("@"),r="";n.length>1&&(r=n[0]+"@",e=n[1]),e=e.replace(m,".");var i=e.split("."),s=x(i,t).join(".");return r+s}function N(e){var t=[],n=0,r=e.length,i,s;while(n<r)i=e.charCodeAt(n++),i>=55296&&i<=56319&&n<r?(s=e.charCodeAt(n++),(s&64512)==56320?t.push(((i&1023)<<10)+(s&1023)+65536):(t.push(i),n--)):t.push(i);return t}function C(e){return x(e,function(e){var t="";return e>65535&&(e-=65536,t+=w(e>>>10&1023|55296),e=56320|e&1023),t+=w(e),t}).join("")}function k(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:o}function L(e,t){return e+22+75*(e<26)-((t!=0)<<5)}function A(e,t,n){var r=0;e=n?b(e/l):e>>1,e+=b(e/t);for(;e>y*a>>1;r+=o)e=b(e/y);return b(r+(y+1)*e/(e+f))}function O(e){var t=[],n=e.length,r,i=0,f=h,l=c,d,v,m,g,y,w,E,x,T;d=e.lastIndexOf(p),d<0&&(d=0);for(v=0;v<d;++v)e.charCodeAt(v)>=128&&S("not-basic"),t.push(e.charCodeAt(v));for(m=d>0?d+1:0;m<n;){for(g=i,y=1,w=o;;w+=o){m>=n&&S("invalid-input"),E=k(e.charCodeAt(m++)),(E>=o||E>b((s-i)/y))&&S("overflow"),i+=E*y,x=w<=l?u:w>=l+a?a:w-l;if(E<x)break;T=o-x,y>b(s/T)&&S("overflow"),y*=T}r=t.length+1,l=A(i-g,r,g==0),b(i/r)>s-f&&S("overflow"),f+=b(i/r),i%=r,t.splice(i++,0,f)}return C(t)}function M(e){var t,n,r,i,f,l,d,v,m,g,y,E=[],x,T,C,k;e=N(e),x=e.length,t=h,n=0,f=c;for(l=0;l<x;++l)y=e[l],y<128&&E.push(w(y));r=i=E.length,i&&E.push(p);while(r<x){for(d=s,l=0;l<x;++l)y=e[l],y>=t&&y<d&&(d=y);T=r+1,d-t>b((s-n)/T)&&S("overflow"),n+=(d-t)*T,t=d;for(l=0;l<x;++l){y=e[l],y<t&&++n>s&&S
("overflow");if(y==t){for(v=n,m=o;;m+=o){g=m<=f?u:m>=f+a?a:m-f;if(v<g)break;k=v-g,C=o-g,E.push(w(L(g+k%C,0))),v=b(k/C)}E.push(w(L(v,0))),f=A(n,T,r==i),n=0,++r}}++n,++t}return E.join("")}function _(e){return T(e,function(e){return d.test(e)?O(e.slice(4).toLowerCase()):e})}function D(e){return T(e,function(e){return v.test(e)?"xn--"+M(e):e})}var t=typeof exports=="object"&&exports&&!exports.nodeType&&exports,n=typeof module=="object"&&module&&!module.nodeType&&module,r=typeof global=="object"&&global;if(r.global===r||r.window===r||r.self===r)e=r;var i,s=2147483647,o=36,u=1,a=26,f=38,l=700,c=72,h=128,p="-",d=/^xn--/,v=/[^\x20-\x7E]/,m=/[\x2E\u3002\uFF0E\uFF61]/g,g={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},y=o-u,b=Math.floor,w=String.fromCharCode,E;i={version:"1.4.1",ucs2:{decode:N,encode:C},decode:O,encode:M,toASCII:D,toUnicode:_};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd)define("punycode",function(){return i});else if(t&&n)if(module.exports==t)n.exports=i;else for(E in i)i.hasOwnProperty(E)&&(t[E]=i[E]);else e.punycode=i}(CW),SHA1=SC.Object.create({hexcase:1,b64pad:"",hex_sha1:function(e){return this.rstr2hex(this.rstr_sha1(this.str2rstr_utf8(e)))},b64_sha1:function(e){return this.rstr2b64(this.rstr_sha1(this.str2rstr_utf8(e)))},sha1_vm_test:function(){return this.hex_sha1("abc").toLowerCase()==="a9993e364706816aba3e25717850c26c9cd0d89d"},rstr_sha1:function(e){return this.binb2rstr(this.binb_sha1(this.rstr2binb(e),e.length*8))},rstr2hex:function(
e){var t=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",n="",r;for(var i=0;i<e.length;i++)r=e.charCodeAt(i),n+=t.charAt(r>>>4&15)+t.charAt(r&15);return n},rstr2b64:function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="",r=e.length;for(var i=0;i<r;i+=3){var s=e.charCodeAt(i)<<16|(i+1<r?e.charCodeAt(i+1)<<8:0)|(i+2<r?e.charCodeAt(i+2):0);for(var o=0;o<4;o++)i*8+o*6>e.length*8?n+=b64pad:n+=t.charAt(s>>>6*(3-o)&63)}return n},str2rstr_utf8:function(e){var t="",n=-1,r,i;while(++n<e.length)r=e.charCodeAt(n),i=n+1<e.length?e.charCodeAt(n+1):0,55296<=r&&r<=56319&&56320<=i&&i<=57343&&(r=65536+((r&1023)<<10)+(i&1023),n++),r<=127?t+=String.fromCharCode(r):r<=2047?t+=String.fromCharCode(192|r>>>6&31,128|r&63):r<=65535?t+=String.fromCharCode(224|r>>>12&15,128|r>>>6&63,128|r&63):r<=2097151&&(t+=String.fromCharCode(240|r>>>18&7,128|r>>>12&63,128|r>>>6&63,128|r&63));return t},rstr2binb:function(e){var t,n=Array(e.length>>2);for(t=0;t<n.length;t++)n[t]=0;for(t=0;t<e.length*8;t+=8)n[t>>5]|=(e.charCodeAt(t/8)&255)<<24-t%32;return n},binb2rstr:function(e){var t="";for(var n=0;n<e.length*32;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t},binb_sha1:function(e,t){e[t>>5]|=128<<24-t%32,e[(t+64>>9<<4)+15]=t;var n=Array(80),r=1732584193,i=-271733879,s=-1732584194,o=271733878,u=-1009589776;for(var a=0;a<e.length;a+=16){var f=r,l=i,c=s,h=o,p=u;for(var d=0;d<80;d++){d<16?n[d]=e[a+d]:n[d]=this.bit_rol(n[d-3]^n[d-8]^n[d-14]^n[d-16],1);var v=this.safe_add(this.safe_add(this.bit_rol(r,5),this.sha1_ft(d,i,s,o)),this.safe_add(this.safe_add(u,n[d]),this.sha1_kt
(d)));u=o,o=s,s=this.bit_rol(i,30),i=r,r=v}r=this.safe_add(r,f),i=this.safe_add(i,l),s=this.safe_add(s,c),o=this.safe_add(o,h),u=this.safe_add(u,p)}return Array(r,i,s,o,u)},sha1_ft:function(e,t,n,r){return e<20?t&n|~t&r:e<40?t^n^r:e<60?t&n|t&r|n&r:t^n^r},sha1_kt:function(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514},safe_add:function(e,t){var n=(e&65535)+(t&65535),r=(e>>16)+(t>>16)+(n>>16);return r<<16|n&65535},bit_rol:function(e,t){return e<<t|e>>>32-t}}),function(){var e,t="",n,r,i;String.cssWidthData={};var s=String.cssWidthData,o=function(){r.parentNode||document.body.appendChild(r)};String.removeWidthContainer=function(){r.parentNode&&document.body.removeChild(r)};var u=String.removeWidthContainer;String.prototype.calculatedWidth=function(r,i){return r===undefined&&(r=""),r!==t&&(t=r,e.style.cssText=r||""),o(),e.innerHTML=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}.apply(this),e.offsetWidth},String.prototype.cachedWidth=function(t,n){var r=t||"nocss";n||(n=s[r]),n||(s[r]=n={});var i=n[this];if(i!==undefined)return i;var o;return n[this]=o=this.calculatedWidth(t,n),o},String.prototype.truncateMiddle=function(t,n){if(t>=this.length)return this;n===undefined&&(n="…");var r=Math.floor(t)/2;return this.substring(0,r)+n+this.substring(this.length-(t-r))},String.prototype.truncateEnd=function(t,n){return t>=this.length?this:(n===undefined&&(n="…"),this.substring(0,t-n.length)+n)},String.prototype.truncateStart=function(t,n){return t>=this.length?this:(n===undefined&&(n="…"),this.substring(n+(t-n.length),t))},
String.prototype.truncateToWidth=function(t,n,r,i){var s=0,o,u,a,f=undefined,l=undefined,c=0,h,p,d;i instanceof Function||(i=String.prototype.truncateEnd),h=t/"i".cachedWidth(r),c=t/"W".cachedWidth(r),p=this.calculatedWidth(r),a=o=this,d=p<t;while(!d){s++;if(c===f&&h===l||p==t){d=!0;continue}f=c,l=h,u=Math.floor((c+h)/2),a=i.call(o,u,n),p=a.calculatedWidth(r),p<t?c=u:h=u}return a},e=String.wcon=document.createElement("span"),SC.browser.isIE||(n=document.createElement("div"),n.style.position="absolute",n.style.left="-1000px",n.style.top="-1000px",n.style.visibility="hidden",n.appendChild(e)),SC.browser.isIE?r=e:r=n}(),CW.SpritePreloadEnforcement={hasSpritePreloadEnforcement:YES,extraRequiredSrcs:null,extraRequiredImages:null,didFinishWaitingForImages:function(){},initMixin:function(){this.didCreateLayer&&(this._user_didCreateLayer=this.didCreateLayer),this.didCreateLayer=function(){if(this._user_didCreateLayer)var e=this._user_didCreateLayer.apply(this,arguments);return this._preload_didCreateLayer(),e}},_preload_didCreateLayer:function(){if(this.constructor.prototype.__hasPreloadedSprites__){var e=this.constructor.prototype.__preloadedExtraRequiredImages__;e&&(this.extraRequiredImages=e),SC.debug("Creating another instance of "+this.constructor+": all sprite backgrounds are confirmed to have been downloaded. Performing no preload action."),this.hasPaneAnimationSupport&&(SC.debug("Because this is the first append, and this pane has PaneAnimationSupport, we now trigger animateShow() to perform the animation."),this._hasShownFromDidCreateLayer=!0,this.animateShow());return}this
.hideForPreload(),this.preloadBackgroundSprites(this.getPreloadElementList(),this.showForPreload,this)},getPreloadElementList:function(){return SC.$A(this.$("*"))},hideForPreload:function(){this.set("isVisible",NO)},showForPreload:function(){this.set("isVisible",YES),this.hasPaneAnimationSupport&&(this._hasShownFromDidCreateLayer=!0,this.animateShow())},preloadBackgroundSprites:function(e,t,n){this.__elements__=e,this.__callback__=t,this.__target__=n,this.invokeLast("_preloadBackgroundSprites",e,t,n)},_preloadBackgroundSprites:function(e,t,n){e=this.__elements__,t=this.__callback__,n=this.__target__,this.__target__=this.__callback__=this.__elements__=undefined;var r=CW._backgroundImageLoadedness||(CW._backgroundImageLoadedness={}),i,s=0,o=!1,u=this,a=undefined,f=this.get("extraRequiredSrcs"),l=this.extraRequiredImages=f?{}:null,c=function(){s--,SC.debug("Finished loading "+this._src_+". images remaining before callback: "+s),r[this._src_]=!0,l&&this._extraKey_&&(l[this._extraKey_]=this),s===0&&(SC.debug("All images are downloaded. Now running callback."),h())},h=function(e){a&&clearTimeout(a);if(o){SC.debug("Performing the callback for all images having finished loading, but it has already been performed. Aborting.");return}e||(u.constructor.prototype.__hasPreloadedSprites__=!0,l&&(u.constructor.prototype.__preloadedExtraRequiredImages__=l)),u.didFinishWaitingForImages(),o=!0,SC.run(function(){t.apply(n||u)})};e=SC.$A(e);for(var p=0,d,v,m,g;d=e[p];p++){m=jQuery(d).css("background-image");if(!m)continue;if(m.indexOf("http")===-1)continue;if(m.indexOf("url(")===-1)continue;m=m
.substring(4,m.length-1);if((v=m.charAt(0))==='"'||v==="'")m=m.substring(1);if((v=m.charAt(m.length-1))==='"'||v==="'")m=m.substring(0,m.length-1);if(r[m])continue;if(i&&i[m])continue;(i||(i={}))[m]=!0,s++,g=new Image,g.onload=c,SC.debug("Preloading "+m),g.src=g._src_=m}if(f)for(p in f){if(!f.hasOwnProperty(p))continue;m=f[p],s++,g=new Image,g.onload=c,SC.debug("Preloading explicitly-specified image "+m),g.src=g._src_=m,g._extraKey_=p}if(s===0)SC.debug("Preloading background images, but every image was already loaded. Running callback immediately."),h();else{var y=SC.buildMode==="debug"?3e3:1500;a=setTimeout(function(){SC.debug("Attempted to preload background images, but the loading is taking longer than "+y/1e3+" seconds. Now running callback regardless of image loadedness."),h(!0)},y)}}},CW.TouchApproximation={isTouchApproximationEnabled:YES,distanceThreshold:50,touchStart:function(e){var t=this.convertFrameFromView({x:e.pageX,y:e.pageY}),n=t.x,r=t.y,i,s,o=this.get("touchApproximationViews")||this.get("childViews"),u=this.get("distanceThreshold"),a=null,f=Infinity,l,c,h,p,d;p=o.get("length");for(h=0;h<p;h++){l=o[h];if(!l||!l.get("isVisible")||l.get("isDecorative"))continue;c=l.get("frame"),i=-1,s=-1,n<c.x?i=c.x-n:n>c.x+c.width&&(i=n-(c.x+c.width)),r<c.y?s=c.y-r:r>c.y+c.height&&(s=r-(c.y+c.height)),i!==-1&&s!==-1?i=(i+s)/2:s!==-1&&(i=s),i!==-1&&i<f&&i<u&&(a=l,f=i)}if(a){e.isProxied=YES,e.target=a.get("layer"),d=a.tryToPerform("touchStart",e);if(d)return this._foundChild=a,YES;this._foundChild=null}return NO},touchesDragged:function(e,t){var n=this._foundChild;return n?n.tryToPerform
("touchesDragged",e,t):NO},touchEnd:function(e){var t=this._foundChild;return t?(e.isProxied=YES,e.target=t.get("layer"),t.tryToPerform("touchEnd",e)):NO}},CW.mixin({encodeBase64:function(e){var t=this._b64,n=0,r=0,i="",s=[],o,u,a,f,l,c,h,p;if(!e)return e;e=this.encodeUTF8(e+"");do o=e.charCodeAt(n++),u=e.charCodeAt(n++),a=e.charCodeAt(n++),p=o<<16|u<<8|a,f=p>>18&63,l=p>>12&63,c=p>>6&63,h=p&63,s[r++]=t.charAt(f)+t.charAt(l)+t.charAt(c)+t.charAt(h);while(n<e.length);i=s.join("");switch(e.length%3){case 1:i=i.slice(0,-2)+"==";break;case 2:i=i.slice(0,-1)+"="}return i},decodeBase64:function(e){var t="",n=0,r=this._b64,i,s,o,u,a,f,l;if(!SC.empty(e)){e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(n<e.length)u=r.indexOf(e.charAt(n++)),a=r.indexOf(e.charAt(n++)),f=r.indexOf(e.charAt(n++)),l=r.indexOf(e.charAt(n++)),i=u<<2|a>>4,s=(a&15)<<4|f>>2,o=(f&3)<<6|l,t+=String.fromCharCode(i),f!==64&&(t+=String.fromCharCode(s)),l!==64&&(t+=String.fromCharCode(o));t=this.decodeUTF8(t)}else CW.fatalError("Cannot decode blank input");return t},encodeUTF8:function(e){e=e.replace(/\r\n/g,"\n");var t="",n,r,i;for(n=0,r=e.length;n<r;++n)i=e.charCodeAt(n),i<128?t+=String.fromCharCode(i):i<2048?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(i&63|128)):i<65536?(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(i&63|128)):(t+=String.fromCharCode(i>>18|240),t+=String.fromCharCode(i>>12&63|128),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(i&63|128));return t},decodeUTF8:function(e){var t="",n=0,r,i,s,o;r=i=s=o=0;var u=String.fromCodePoint||this
._fromCodePoint,a=String.fromCharCode;while(n<e.length)r=e.charCodeAt(n++),r<128?t+=String.fromCharCode(r):r>191&&r<224?(i=e.charCodeAt(n++),t+=a((r&31)<<6|i&63)):r>=224&&r<240?(i=e.charCodeAt(n++),s=e.charCodeAt(n++),t+=a((r&15)<<12|(i&63)<<6|s&63)):r>=240&&(i=e.charCodeAt(n++),s=e.charCodeAt(n++),o=e.charCodeAt(n++),t+=u((r&7)<<18|(i&63)<<12|(s&63)<<6|o&63));return t},_fromCodePoint:function(e){if(e<65536)return String.fromCharCode(e);var t=((e-=65536)>>10)+55296,n=e%1024+56320;return String.fromCharCode(t,n)},_b64:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}),CW.DATE_ONLY=0,CW.DATE_TIME=1,CW.DATE_TIME_TO_MIDNIGHT=3,CW.DATE_TIME_SEC=4,CW.DAY_MIN_DUR=1440,CW.DAY_MILLIS_DUR=864e5,CW.Date={value:null,dateType:CW.DATE_ONLY,timeFormat:null,fullDateFormat:null,dateFormat:null,_dateObj:null,_timezoneOffset:0,incrementSeconds:function(e){return this.seconds(this.seconds()+e),this},incrementMinutes:function(e){return this.minutes(this.minutes()+e),this},incrementHours:function(e){return this.hours(this.hours()+e),this},incrementDate:function(e){return this.date(this.date()+e),this},incrementMonth:function(e){return this.month(this.month()+e),this},incrementYear:function(e){return this.year(this.year()+e),this},now:function(){this._dateObj=new Date;var e=this._dateObj.getTime(),t=this._dateObj.getTimezoneOffset()*6e4;return this._dateObj.setTime(e-t),this._dateObj._isUsingUTC=!0,this._dateComponentDidChange(),this},dateComponent:function(){var e=this.value;return e?e[0]:null},date:function(e){return e!==undefined?(this._dateObj.setUTCDate(e),this._dateComponentDidChange
()):this.value[3]},dateObject:function(){return this._dateObj},day:function(){return this._dateObj.getUTCDay()},fullYear:function(e){return e!==undefined?(this._dateObj.setUTCFullYear(e),this._dateComponentDidChange()):this.value[1]},hours:function(e){return e!==undefined?(this._dateObj.setUTCHours(e),this._dateComponentDidChange()):this.value[4]},minutes:function(e){return e!==undefined?(this._dateObj.setUTCMinutes(e),this._dateComponentDidChange()):this.value[5]},seconds:function(e){return this.dateType===CW.DATE_TIME_SEC?e!==undefined?(this._dateObj.setUTCSeconds(e),this._dateComponentDidChange()):this.value[6]:0},month:function(e){return e!==undefined?(this._dateObj.setUTCMonth(e),this._dateComponentDidChange()):this._dateObj.getUTCMonth()},time:function(e){return e!==undefined?(this._dateObj.setTime(e),this._dateComponentDidChange()):this._dateObj.getTime()},timezoneOffset:function(e){return e!==undefined?(this.set("_timezoneOffset",e),this._dateComponentDidChange()):this.get("_timezoneOffset")},year:function(e){return this.fullYear(e)},changeDateType:function(e){return e===this.dateType?this:(e===CW.DATE_ONLY||e===CW.DATE_TIME||e===CW.DATE_TIME_TO_MIDNIGHT||e===CW.DATE_TIME_SEC?(this.dateType=e,this._dateComponentDidChange()):CW.fatalError("You must provide a valid date type."),this)},weekNumber:function(e){e=e?e:this._dateObj;var t=new Date(e.getUTCFullYear(),0,1),n=1,r=t.getUTCDay()-n,i=Math.floor((e.getTime()-t.getTime())/CW.DAY_MILLIS_DUR)+1,s,o,u,a,f;return r=r>=0?r:r+7,r<4?(s=Math.floor((i+r-1)/7)+1,s>52&&(o=new Date(e.getUTCFullYear()+1,0,1),u=o.getUTCDay()-n,u=
u>=0?u:u+7,s=u<4?1:53)):(a=Math.floor((i+r-1)/7),s=a===0?53:a),f=e.getUTCFullYear(),s===53&&e.getUTCMonth()===0?f--:s===1&&e.getUTCMonth()===11&&f++,[f,s]},weekNumberToDate:function(e,t){e=parseInt(e,0),t=parseInt(t,0);var n=new Date(t,0,10,12,0,0),r=new Date(t,0,4,12,0,0),i=new Date(r.getTime()-n.getUTCDay()*CW.DAY_MILLIS_DUR),s=new Date(i.getTime()+(e-1)*6048e5),o=new Date(s.getTime()+5184e5),u=[s,o];return u},dateRangeOfWeek:function(){var e=this._dateObj,t=e.getUTCDay(),n;t===0?n=6:n=t+1;var r=new Date(e.valueOf());r.setDate(e.getUTCDate()-n);var i=new Date(e.valueOf());return i.setDate(e.getUTCDate()+(7-e.getUTCDay())),[r,i]},daysInMonth:function(){var e=this.year(),t=this.month(),n=[31,28,31,30,31,30,31,31,30,31,30,31];return t===1&&(e%4===0&&e%100!==0||e%400===0)?29:n[t]},toTimeString:function(e){return e?this.format(e):this.timeFormat?this.format(this.timeFormat):this._dateObj.toString().substr(16,5)},toString:function(e){if(e)return this.format(e);if(this.fullDateFormat)return this.format(this.fullDateFormat);var t=this._dateObj;return t?t.toString():"null"},toDateString:function(e){return e?this.format(e):this.dateFormat?this.format(this.dateFormat):this._dateObj.toString().substr(0,15)},parse:function(e){var t=this._dateObj;return SC.typeOf(e)===SC.T_ARRAY?(isNaN(e[3])||t.setUTCDate(e[3]),isNaN(e[1])||t.setUTCFullYear(e[1]),isNaN(e[2])||t.setUTCMonth(e[2]-1),!isNaN(e[3])&&e[3]!==t.getUTCDate()&&t.setUTCDate(e[3]),this.dateType===CW.DATE_ONLY?(t.setUTCHours(12),t.setUTCMinutes(0)):(isNaN(e[4])||t.setUTCHours(e[4]),isNaN(e[5])||t.setUTCMinutes(e[5]),this.dateType===
CW.DATE_TIME_SEC&&(isNaN(e[6])||t.setUTCSeconds(e[6])))):e&&e.getTime&&(e._isUsingUTC?(t.setUTCFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),t.setUTCHours(e.getUTCHours()),t.setUTCMinutes(e.getUTCMinutes()),this.dateType===CW.DATE_TIME_SEC&&t.setUTCSeconds(e.getUTCSeconds())):(t.setUTCFullYear(e.getFullYear(),e.getMonth(),e.getDate()),t.setUTCHours(e.getHours()),t.setUTCMinutes(e.getMinutes()),this.dateType===CW.DATE_TIME_SEC&&t.setUTCSeconds(e.getSeconds()))),this.dateType!==CW.DATE_TIME_SEC&&t.setUTCSeconds(0),t.setUTCMilliseconds(0),t._isUsingUTC=!0,this._dateObj=t,this._dateComponentDidChange(),this},format:function(e,t){e+="",t&&(e=e.loc());var n=this._dateObj,r=this.value||{},i=e.length,s="",o=0,u="",a="",f=r[1]+"",l=r[2],c=r[3],h=n.getUTCDay(),p=r[4],d=r[5],v=n.getUTCSeconds(),m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_;f.length<3&&(f>=0&&f<=28?f=""+(f+2e3):f>=28&&f<=99&&(f=""+(f+1900))),r.y=""+f,r.yyyy=f,r.yy=f.substring(2,4),r.M=l,r.MM=LZ(l),r.MMM=MONTH_NAMES[l-1],r.NNN=MONTH_NAMES[l+11],r.d=c,r.dd=LZ(c),r.E=DAY_NAMES[h+7],r.EE=DAY_NAMES[h],r.H=p,r.HH=LZ(p),p===0?r.h=12:p>12?r.h=p-12:r.h=p,r.hh=LZ(r.h),p>11?r.K=p-12:r.K=p,r.k=p+1,r.KK=LZ(r.K),r.kk=LZ(r.k),p>11?r.a="SC.Date.Period.PM".loc():r.a="SC.Date.Period.AM".loc(),r.m=d,r.mm=LZ(d),r.s=v,r.ss=LZ(v);while(o<i){u=e.charAt(o),a="";while(e.charAt(o)==u&&o<i)a+=e.charAt(o++);M=r[a],SC.none(M)?s+=a:(_=M.toString().loc(),s+=_?_:M)}return s},done:function(){return CW.Date._pool.indexOf(this)===-1&&CW.Date._pool.push(this),this.timeFormat=this.fullTimeFormat=this.dateFormat=null,SC.clone(this.value)},components:function(
){return SC.clone(this.value)},clone:function(e){return CW.Date.create(SC.clone(this.value),e?e:this.dateType)},setValue:function(e){this.value=SC.clone(e),this._dateComponentDidChange()},_dateComponentDidChange:function(){var e=[0,0,0,0,0,0,0],t=this._dateObj;return e[1]=t.getUTCFullYear(),e[2]=t.getUTCMonth()+1,e[3]=t.getUTCDate(),e[0]=parseInt(e[1]+(e[2]<10?"0":"")+e[2]+(e[3]<10?"0":"")+e[3],0),this.dateType!==CW.DATE_ONLY&&(e[4]=t.getUTCHours(),e[5]=t.getUTCMinutes(),this.dateType===CW.DATE_TIME_SEC?e[6]=t.getUTCSeconds():e[6]=this.dateType===CW.DATE_TIME_TO_MIDNIGHT?CW.DAY_MIN_DUR-(e[4]*60+e[5]):e[4]*60+e[5]),this.value=e,this}},SC.mixin(CW.Date,{_pool:[],parseDate:function(e,t){var n=new Date;return SC.typeOf(e)!==SC.T_ARRAY?n:(n.setUTCFullYear(e[1]),n.setUTCMonth(e[2]),n.setUTCDate(e[3]),t||(n.setUTCHours(e[4]),n.setUTCMinutes(e[5])),n.setUTCSeconds(0),n.setUTCMilliseconds(0),n)},dateComponentsEqual:function(e,t){return SC.typeOf(e)!==SC.T_ARRAY&&SC.typeOf(t)===SC.T_ARRAY?NO:e[0]===t[0]},datesEqual:function(e,t){if(e===t)return YES;var n=SC.typeOf(e),r=SC.typeOf(t);return n!==r?NO:e.value[0]===t.value[0]},dateTimesEqual:function(e,t){return SC.typeOf(e)!==SC.T_ARRAY&&SC.typeOf(t)===SC.T_ARRAY?NO:e[0]===t[0]&&e[4]===t[4]&&e[5]===t[5]},create:function(e,t){var n;return CW.Date._pool.length>0?(n=CW.Date._pool.pop(),n.value=null,n.dateType=CW.DATE_ONLY):n=SC.beget(CW.Date),n._dateObj=new Date,n._dateObj._isUsingUTC=!0,e&&SC.typeOf(e)===SC.T_NUMBER&&(t=e,e=null),t!==undefined&&(n.dateType=t),n.parse(e),n},createFromDateObject:function(e,t){var n;return CW.Date._pool.length>0?
(n=CW.Date._pool.pop(),n.value=null,n.dateType=CW.DATE_ONLY):n=SC.beget(CW.Date),n._dateObj=e,n.dateType=t||CW.DATE_ONLY,n},createFromDateComponent:function(e){e||CW.fatalError("createFromDateComponent():  No date component was specified");var t=Math.floor(e/1e4),n=Math.floor(e/100)-t*100,r=e-t*1e4-n*100,i=[e,t,n,r],s=CW.Date.create(i,CW.DATE_ONLY);return s},areDatesInRange:function(e,t,n,r){return!e||!t?NO:t[0]===n[0]&&t[6]===1440?NO:e[0]>=n[0]&&e[0]<=r[0]||t[0]>=n[0]&&t[0]<=r[0]||e[0]<=n[0]&&t[0]>=r[0]},compareDates:function(e,t,n){if(!e||!t)return e||t;var r,i,s,o;return r=e._dateObj?e.components():e,i=t._dateObj?t.components():t,r[0]<i[0]?n?t:e:r[0]===i[0]?(s=r[4]*60+r[5],o=i[4]*60+i[5],s<o?n?t:e:s>o?n?e:t:null):n?e:t},greaterThan:function(e,t){SC.typeOf(e)===SC.T_ARRAY&&(e=CW.Date.create(e)),SC.typeOf(t)===SC.T_ARRAY&&(t=CW.Date.create(t));var n=this.compareDates(e,t,YES);return n===e?YES:NO}}),CW.DateParser={parseDate:function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w=["Sunday".loc().toLowerCase(),"Monday".loc().toLowerCase(),"Tuesday".loc().toLowerCase(),"Wednesday".loc().toLowerCase(),"Thursday".loc().toLowerCase(),"Friday".loc().toLowerCase()],E=e.toLowerCase(),S,x,T,N,C,k=SC.Locale.currentLocale.language,L;if(!isNaN(e)&&parseInt(e,10)>31)i=CW.Date.create(t),b=e.length,b===2?(n?(s=parseInt(e.charAt(1),10)-1,o=parseInt(e.charAt(0),10)):(s=parseInt(e.charAt(0),10)-1,o=parseInt(e.charAt(1),10)),u=(new Date).getFullYear()):b===3?(v=e,a=parseInt(e.charAt(0),10),c=parseInt(e.substr(0,2),10),h=parseInt(e.substr(1,2),10),l=parseInt(e.charAt(2),10),n?(s=h<=12?h-1:l-1,o=
h<=12?a:c):(s=c<=12?c-1:a-1,o=c<=12?l:h),u=(new Date).getFullYear()):b===4?(m=e,a=parseInt(e.charAt(0),10),c=parseInt(e.substr(0,2),10),p=parseInt(e.substr(2,2),10),f=parseInt(e.charAt(1),10),n?(s=h<=12?h-1:l-1,o=h<=12?a:c):(s=c<=12&&p<=31?c-1:a-1,o=c<=12&&p<=31?p:f,u=c<=12&&p<=31?(new Date).getFullYear():2e3+p)):b===5?(g=parseInt(e,10).toString(),a=parseInt(e.charAt(0),10),c=parseInt(e.substr(0,2),10),h=parseInt(e.substr(1,2),10),y=parseInt(e.substr(3,2),10),l=parseInt(e.substr(2,1),10),n?(s=h<=12?h-1:l-1,o=h<=12?a:c):(s=c<=12?c-1:a-1,o=c<=12?l:h),u=2e3+y):b>=6&&b<=8&&(c=parseInt(e.substr(0,2),10),p=parseInt(e.substr(2,2),10),l=parseInt(e.charAt(2),10),y=parseInt(e.substr(3,2),10),d=parseInt(e.substr(4),10),b===6&&p===20||b===7&&y===20?b===6&&p===20?n?(s=f-1,o=a):(s=a-1,o=f):b===7&&y===20&&(n?(s=h<=12?h-1:l-1,o=h<=12?a:c):(s=c<=12?c-1:a-1,o=c<=12?l:h)):(s=c<=12?c-1:p<=12&&c>=1&&c<=31?p-1:-1,o=p>=1&&p<=31&&s===c-1?p:c>=1&&c<=31&&s===p-1?c:-1,u=b>6?d:2e3+d)),s<0||s>=12||o<1||o>31||u<0?i=null:(i._dateObj.set({month:s,day:o,year:u}),i._dateComponentDidChange());else if(!isNaN(e)&&(L=parseInt(e,10))<31){i=CW.Date.create();var A=Date.parse(e);SC.none(A)?i=null:(i._dateObj=A,i._dateComponentDidChange())}return i}},CW.Response=SC.XHRResponse.extend({bodyShouldBeLogged:function(){var e=this.get("status");return!SC.none(e)&&e!==200}.property("status"),fakeReply:null,overallTimeoutTimer:null,addedToOutgoingQueueTimestamp:null,getFullAddress:function(){return this.get("request").getFullAddress()},notify:function(){var e=arguments.callee.base.apply(this,arguments),t=CW.RequestManagement
,n;return t&&(n=t.sharedInstance()),n&&n.removeOutstandingResponse(this),e},fire:function(e){var t=this.get("request"),n=t?t.get("source"):null;n&&n.willSend&&n.willSend(t,this),t.freeze(),this.get("isCancelled")||this.invokeTransport(e);var r=t.get("timeout");if(r){var i=SC.Timer.schedule({target:this,action:"timeoutReached",interval:r,repeats:NO});this.set("timeoutTimer",i)}!this.get("isCancelled")&&n&&n.didSend&&n.didSend(t,this)},timeoutReached:function(){var e=this.get("timeoutTimer");return e&&e.invalidate(),e=this.get("overallTimeoutTimer"),e&&e.invalidate(),arguments.callee.base.apply(this,arguments)},receive:function(e,t){var n=this.get("overallTimeoutTimer");return n&&n.invalidate(),arguments.callee.base.apply(this,arguments)},invokeTransport:function(){var e=this.get("fakeReply"),t;if(!e){var n=this.createRequest(),r,i,s;return this.set("rawRequest",n),s=!!this.getPath("request.isAsynchronous"),s&&(!SC.browser.msie&&!SC.browser.opera?SC.Event.add(n,"readystatechange",this,this.finishRequest,n):(r=this,i=function(){if(!r)return null;var e=r.finishRequest();return e&&(r=null),e},n.onreadystatechange=i)),n.open(this.get("type"),this.getFullAddress(),s),this.setRequestHeaders(),this.getPath("request.useCrossDomain")&&this.getPath("request.withCredentials")&&(n.withCredentials=!0),n.send(this.getPath("request.encodedBody")),s||this.finishRequest(),n}this.set("rawRequest",e),t=e.get("delay"),this.invokeLater(this._triggerFakeReply,t)},setRequestHeaders:function(){var e=this.get("rawRequest"),t=this.getPath("request.headers");for(var n in t)e.setRequestHeader(n,t[n])},cancelTransport
:function(){var e=this.get("fakeReply");if(e)return;return arguments.callee.base.apply(this,arguments)},_triggerFakeReply:function(){var e=this.get("fakeReply");e&&(e.set("readyState",4),this.finishRequest(undefined))}}),CW.IFramePostMessageResponse=CW.Response.extend({isCrossDomain:YES,requestId:-1,rawResponse:null,_activeRequests:{},destinationDomain:"",headers:function(){var e=this.get("rawResponse");if(!e)return{};var t=e.headers,n={};return t?(t.split("\n").forEach(function(e){var t=e.indexOf(":"),r,i;t>=0&&(r=e.slice(0,t),i=e.slice(t+1).trim(),n[r]=i)},this),n):n}.property("status").cacheable(),header:function(e){var t=this.get("headers");return t[e]||null},encodedBody:function(){var e=this.get("rawResponse");return e?e.responseText:""}.property("status").cacheable(),invokeTransport:function(e){var t=this.get("request"),n={requestId:e,url:t.getFullAddress(),type:t.get("type"),headers:t.get("headers"),body:t.get("body"),isAsynchronous:t.get("isAsynchronous")},r=SC.Request.manager.get("crossDomainIFrames")[t.get("destinationDomain")];try{r.contentWindow.postMessage(SC.json.encode(n),this.get("destinationDomain"))}catch(i){SC.debug('CW.IFramePostMessageResponse: iFrame not properly loaded from "%@". Maybe ajax_sender.html is missing?',r.src)}},finishRequest:function(e){var t=this.get("rawResponse"),n=t?t.readyState:null,r,i,s;return n===4&&!this.get("timedOut")?(this.receive(function(e){if(!e)return;i=-1;try{i=t.status||0}catch(n){}if(i<200||i>=300){try{s=t.statusText||""}catch(o){s=""}r=SC.$error(s||"HTTP Request failed","Request",i),r.set("errorValue",this),this.set("isError"
,YES),this.set("errorObject",r)}this.set("status",i)},this),!SC.browser.msie&&!SC.browser.opera?SC.Event.remove(t,"readystatechange",this,this.finishRequest):t.onreadystatechange=null,YES):NO},cancelTransport:function(){this.set("rawRequest",null)}}),CW.ImagePreloader=SC.Object.extend({images:null,callBack:null,init:function(){this.loadImages()},loadImages:function(){this._numLoaded=0,this._numProcessed=0,this._allImages=[],this._numImages=this.get("images").length;for(var e=0;e<this._numImages;e++)this.preload(this.get("images")[e])},preload:function(e){var t=new Image;this._allImages.push(t),theImage=this,t.onload=function(){theImage.onload.call(theImage)},t.onerror=function(){theImage.onerror.call(theImage)},t.onabort=function(){theImage.onabort.call(theImage)},t.sLoaded=!1,t.src=e},onComplete:function(){this._numProcessed++,this._numProcessed===this._numImages&&this.callBack(this._allImages,this._numLoaded)},onload:function(){this.sLoaded=!0,this._numLoaded++,this.onComplete()},onerror:function(){this.sError=!0,this.onComplete()},onabort:function(){this.sAbort=!0,this.onComplete()}}),CW.KeyResponder={_kr_init:function(){var e=this.keyboardShortcuts||{};e=SC.clone(e),this.keyboardShortcuts=e,this._kr_hasInited=YES},registerKeyboardShortcut:function(e,t,n){this._kr_hasInited||this._kr_init(),n?this.keyboardShortcuts[e]={target:t,action:n}:(n=t,this.keyboardShortcuts[e]=n)},deregisterKeyboardShortcut:function(e){this._kr_hasInited||this._kr_init(),delete this.keyboardShortcuts[e]},performKeyEquivalent:function(e,t){this._kr_hasInited||this._kr_init(),CW.LOG_KEYBOARD_SHORTCUTS&&
SC.Logger.log("Responder attempting to find keyboard shortcut for %s",e);var n=this.keyboardShortcuts[e];if(n){var r=n,i=this;return typeof n=="object"&&(i=n.target,r=n.action),typeof r!="string"?r.call(i,e,t):SC.RootResponder.responder.sendAction(r,i,this,e,t)}return NO}},SC.mixin(CW,{LOG_KEYBOARD_SHORTCUTS:NO,registerKeyboardShortcut:function(e,t,n){CW.globalKeyResponder.registerKeyboardShortcut(e,t,n)},deregisterKeyboardShortcut:function(e){CW.globalKeyResponder.deregisterKeyboardShortcut(e)},keyResponders:[],globalKeyResponder:SC.Object.create(CW.KeyResponder),addKeyResponder:function(e){this.keyResponders.push(e)},removeKeyResponder:function(e){this.keyResponders.removeObject(e)},performKeyEquivalent:function(e,t){CW.LOG_KEYBOARD_SHORTCUTS&&SC.Logger.log("Attempting to find keyboard shortcut for %s",e);var n=this.keyResponders,r,i=n.length;for(r=i-1;r>=0;r--)if(n[r].performKeyEquivalent(e,t))return YES;return NO},installKeyResponder:function(){var e=SC.RootResponder.prototype.attemptKeyEquivalent;SC.RootResponder.reopen({attemptKeyEquivalent:function(t){var n=e.apply(this,arguments);if(n)return n;var r=t.commandCodes()[0];return r?CW.performKeyEquivalent(r,t):NO}}),SC.View.reopen(CW.ViewKeyHandlingHelpers),SC.Pane.reopen(CW.KeyResponder),SC.ButtonView.reopen(CW.ButtonKeyHandlingHelpers)}}),CW.keyResponders.push(CW.globalKeyResponder),CW.LOG_NOTIFICATIONS=NO,CW.notificationCenter=SC.Object.create({_subscriptions:{},postNotification:function(e){var t=this._subscriptions;if(!t[e]){CW.LOG_NOTIFICATIONS&&SC.info("Notification Center: Could not find any subscribers for %@, returning."
.fmt(e));return}var n=t[e],r=n.length,i=SC.A(arguments).slice(1);i||(i=[]),CW.LOG_NOTIFICATIONS&&SC.info("Notification Center: Posting notification %@".fmt(e));for(var s=0;s<r;s++){var o=n[s];if(o){var u=o.action,a=o.target;u.apply(a,i)}}},_targetForTargetName:function(e){return SC.typeOf(e)===SC.T_STRING?SC.objectForPropertyPath(e):e},_methodForMethodNameInTarget:function(e,t){return SC.typeOf(e)===SC.T_STRING?SC.objectForPropertyPath(e,t):e},subscribeToNotification:function(e,t,n){t=this._targetForTargetName(t),n=this._methodForMethodNameInTarget(n,t);if(!n)throw"You must pass a action to subscribeToNotification()";var r=this._subscriptions,i=r[e];i||(i=r[e]=[]);var s=!1,o=i.length;for(var u=0;u<o;u++){var a=i[u];a.action===n&&a.target===t&&(s=!0)}s||(CW.LOG_NOTIFICATIONS&&SC.info("Notification Center: Subscribed to %@".fmt(e)),r[e].push({action:n,target:t}),this._subscriptions=r)},unsubscribeFromNotification:function(e,t,n){var r=this._subscriptions;t=this._targetForTargetName(t),n=this._methodForMethodNameInTarget(n,t);if(!n)throw"You must pass a action to subscribeToNotification()";var i=r[e];if(!i)return;var s=i.length,o=-1;for(var u=0;u<s;u++){var a=i[u];a.action===n&&a.target===t&&(o=u)}o!==-1&&(CW.LOG_NOTIFICATIONS&&SC.info("Notification Center: Subscribed to %@".fmt(e)),r[e].splice(o,1),this._subscriptions=r)}}),CW.Request=SC.Request.extend({COPY_KEYS:SC.Request.prototype.COPY_KEYS.concat(["overallTimeout","addressPrefix","useCrossDomain","withCredentials","id","isCancelled","destinationDomain","cycle","action","isBackgroundRequest","_crossDomainMethod","_queryParameters"
,"_isRead","isRead","isWrite","_isPending","_cycleWhenPended","_cycleWhenSent"]),responseClass:undefined,timeout:3e4,overallTimeout:null,addressPrefix:null,useCrossDomain:NO,withCredentials:NO,iFrameScriptLocation:"ajax_sender.html",id:null,isCancelled:NO,cycle:null,action:null,isBackgroundRequest:NO,isRead:function(e,t){if(t!==undefined)return this._isRead=t,t;var n=this._isRead;if(n!==undefined)return n;var r=this.get("type");if(!!r)return r.toLowerCase()==="get";CW.fatalError("No type was specified, so we don’t know whether this request is a read or a write.")}.property("type").cacheable(),isWrite:function(e,t){return t===undefined?!this.get("isRead"):(this.set("isRead",!t),t)}.property("isRead").cacheable(),bodyShouldBeLogged:NO,queryParameter:function(e,t){var n;if(SC.typeOf(e)===SC.T_STRING)return n=this._queryParameters,arguments.length===1?n?n[e]:null:(this.propertyWillChange("queryParameters"),n||(n=this._queryParameters={}),n[e]=t,this.propertyDidChange("queryParameters"),this);if(t===undefined){n=e,this.beginPropertyChanges();for(e in n){if(!n.hasOwnProperty(e))continue;this.queryParameter(e,n[e])}return this.endPropertyChanges(),this}return CW.fatalError("queryParameter():  You must pass in either a key or a hash of query parameters",{target:this}),this},clearQueryParameters:function(){this.propertyWillChange("queryParameters"),this._queryParameters={},this.propertyDidChange("queryParameters")},queryParameters:function(){return this._queryParameters}.property().cacheable(),addressWithQueryParameters:function(){var e=URI(this.get("address")).addQuery(this.get("queryParameters"
)).sortQuery().normalize().toString();return e}.property("address","queryParameters").cacheable(),send:function(e,t){this._determineResponseClassAndMethod();var n;this.get("isAsynchronous")===NO&&(n=this._crossDomainMethod,n&&n!=="cors"&&CW.fatalError("You cannot send a synchronous request using iframes with postMessage",{target:this}));var r=CW.RequestManagement,i=r?r.sharedInstance():null,s,o,u,a;this._isPending=NO,this._cycleWhenPended=null,this._cycleWhenSent=this.get("cycle"),o=this._getFakeReply();var f=this.get("timeout");if(f&&!this.get("isAsynchronous"))throw"Timeout values cannot be used with synchronous requests";if(f===0)throw"The timeout value must either not be specified or must be greater than 0";e&&this.set("body",e);var l=SC.clone(this._queryParameters);return a=this.copy()._prep(),a._queryParameters=l,o&&(a._fakeReplyToUse=o),s=SC.Request.manager.sendRequest(a),s&&i&&i.addOutstandingResponse(s),t&&i&&i.removePendingRequest(this),s},sendAfterDelay:function(e,t){t||CW.fatalError("sendAfterDelay():  You must specify a delay",{target:this});var n=CW.RequestManagement,r=n?n.sharedInstance():null;this._isPending=YES,this._cycleWhenPended=this.get("cycle"),r&&r.addPendingRequest(this),this.invokeLater(this.send,t,e,YES)},resend:function(e,t){var n=this._getFakeReply(),r,i,s,o;return i=this.get("source")?this:this.copy()._prep(),n&&(i._fakeReplyToUse=n),r=SC.Request.manager.sendRequest(i,e),r&&(s=CW.RequestManagement,o=s?s.sharedInstance():null,o&&o.addOutstandingResponse(r)),t&&o&&o.removePendingRequest(this),r},resendAfterDelay:function(e,t){t||CW.fatalError("resendAfterDelay():  You must specify a delay"
,{target:this});var n=CW.RequestManagement,r=n?n.sharedInstance():null;this._isPending=YES,this._cycleWhenPended=this.get("cycle"),r&&r.addPendingRequest(this),this.invokeLater(this.resend,t,e,YES)},getFullAddress:function(){var e=this.get("addressPrefix"),t=this.get("addressWithQueryParameters");return e&&(t=e+t),t},didSend:function(e,t){var n;CW._logRequestIfAppropriateFor(t),n=t.get("rawRequest"),n&&n.isFakeReply&&SC.info("Using fake reply (%@) for request:  %@",n,e)},didReceive:function(e,t){var n=CW.Request,r;n._responseSuspendCount>0?(t._receivedAtWhileSuspended=SC.getCurrentTimeForPerformance(),r=n._suspendedResponses,r?r.push(t):r=n._suspendedResponses=[t],t.get("isCancelled")||(t._receivedWhenSuspended=YES,t.set("isCancelled",YES))):CW._logResponseIfAppropriate(t)},destinationDomain:function(){var e=this.getFullAddress(),t=null,n,r;if(e){if(URI(e).protocol()===""||URI(e).host()==="")return SC.error("Malformed URL: "+e),null;t=URI(e).protocol()+"://"+URI(e).host()}return t}.property("addressPrefix","address"),cycleDidChange:function(){var e=CW.RequestManagement,t=e?e.sharedInstance():null,n,r;t&&(n=this.get("cycle"),this._isPending?n!==this._cycleWhenPended&&t.cycleDidChangeForPendingRequest():(r=this._cycleWhenSent,r&&n!==r&&t.cycleDidChangeForOutstandingResponse()))}.observes("cycle"),toString:function(){var e=arguments.callee.base.apply(this,arguments),t=this.get("address");return t&&(e+=" ("+t+")"),e},_crossDomainMethod:null,_queryParameters:null,_isPending:NO,_cycleWhenPended:null,_cycleWhenSent:null,_determineResponseClassAndMethod:function(){var e=SC.kindOf,t,
n;if(this.get("useCrossDomain")){t=this.get("responseClass"),t||(XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?t=CW.Response:this._isAppropriateForXDomainRequest()?t=CW.XDRResponse:window.postMessage?t=CW.IFramePostMessageResponse:SC.browser.msie&&SC.browser.version<=7&&(t=CW.IFrameDocumentDomainResponse));if(!this._crossDomainMethod){if(e(t,CW.IFramePostMessageResponse))n="postMessage";else if(e(t,CW.IFrameDocumentDomainResponse))n="documentDomain";else if(e(t,CW.Response)||e(t,CW.XDRResponse))n="cors";n&&(this._crossDomainMethod=n)}}else t=CW.Response;!this.get("responseClass")&&t&&this.set("responseClass",t)},_isAppropriateForXDomainRequest:function(){var e=this.get("headers"),t=YES,n;if(e)for(n in e)if(n.toLowerCase()!=="content-type"||e[n]!=="text/plain")t=NO;return t&&SC.browser.msie&&SC.browser.version<=9&&!this.get("withCredentials")?YES:NO},_getFakeReply:function(){var e=CW.get("fakeReplyQueue"),t=e?e.length:0,n=null,r,i,s,o,u,a;if(t>0){r=this.get("isBackgroundRequest"),i=null;for(s=0;s<t;++s){o=e[s];if(r&&!o.get("applyToBackgroundRequests"))continue;u=o.get("urlFilter");if(u){a=this.get("address");if(!a||!u.test(a))continue}e.removeAt(s,1),i=o;break}i&&(i.get("shouldProcessRequestNormally")||(n=i))}return n}}),CW.Request.mixin({suspendResponses:function(){++this._responseSuspendCount},resumeResponses:function(){var e=--this._responseSuspendCount,t,n,r,i,s,o;e<0&&(SC.warn("CW.Response.resumeResponses() was called without a paired suspendResponses() invocation; ignoring…"),this._responseSuspendCount=0);var u=function(){i.get("isCancelled")&&i._receivedWhenSuspended&&
(i.set("isCancelled",NO),s=i.get("request"),o=s.get("source"),o&&o.didReceive&&o.didReceive(s,i),i.get("isCancelled")||i.notify())};t=this._suspendedResponses,r=t?t.length:0;for(n=0;n<r;++n)i=t[n],SC.run(u)},_responseSuspendCount:0,_suspendedResponses:null}),SC.Request.manager.mixin({crossDomainIFrames:{},_requestId:0,_crossDomainXHRLoaderURL:"",shouldFireRequest:null,_createCrossDomainIFrame:function(e,t){e||CW.fatalError("_createCrossDomainIFrame():  A destination domain must be specified",{target:this}),t||CW.fatalError("_createCrossDomainIFrame():  An AJAX sender URL must be specified",{target:this,destinationDomain:e});var n=document.createElement("iframe"),r=this;t[0]!=="/"&&(t="/"+t),n.loaded=!1,n.onload=n.onreadystatechange=function(){!n.loaded&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")&&(n.loaded=!0,r.fireRequestIfNeeded())},e[e.length-1]==="/"&&(e=e.substr(0,e.length-1)),n.src=e+t,n.style.display="none",document.body.appendChild(n),n.className="crossdomain-iframe",SC.Event.add(window,"message",this,SC.RunLoop.wrapFunction(this._messageWasReceived),null,!0),this.get("crossDomainIFrames")[e]=n,this.notifyPropertyChange("crossDomainIFrames")},_messageWasReceived:function(e){var t=e.originalEvent,n=t.data,r;try{r=SC.json.decode(n)}catch(i){SC.warn("CW.Request cannot parse received message from iframe support: %@",n);return}if(!r.isIFramePostMessageResponse)return;var s=r.headers,o=this.get("inflight"),u,a,f;for(f=0,u=o.length;f<u;f++){a=o[f];if(a.requestId===r.requestId){if(!URI(t.origin).baseEquals(URI(a.get("destinationDomain")))){CW
.fatalError("Potential cross domain attack, postMessage from unknown origin, %@",t.origin);return}a.set("rawResponse",r),a.set("rawRequest",r),a.finishRequest();return}}},sendRequest:function(e,t){if(!e)return null;var n=this._requestId,r=e.get("responseClass").create({request:e,requestId:n}),i,s,o,u;if(r.get("isCrossDomain")){var a=e.get("destinationDomain"),f=e._crossDomainMethod;(f==="postMessage"||f==="documentDomain")&&!this.get("crossDomainIFrames")[a]&&this._createCrossDomainIFrame(a,e.get("iFrameScriptLocation")),r.set("destinationDomain",a)}return t&&r.set("retryOf",t),this._requestId=++n,r.set("addedToOutgoingQueueTimestamp",SC.getCurrentTimeForPerformance()),i=e._fakeReplyToUse,i&&(r.set("fakeReply",i),delete e._fakeReplyToUse),s=e.get("timeout"),o=e.get("overallTimeout"),o===null&&s&&(o=s,e.set("overallTimeout",s)),o&&(u=SC.Timer.schedule({target:r,action:"timeoutReached",interval:o,repeats:NO}),r.set("overallTimeoutTimer",u)),this.get("pending").pushObject(r),this.fireRequestIfNeeded(),r},fireRequestIfNeeded:function(){var e=this.get("pending"),t=this.get("inflight"),n=this.get("maxRequests"),r=e.length,i,s,o,u;if(r>0&&t.length<n){i=this.shouldFireRequest;if(i)for(u=0;u<r;++u){s=e.objectAt(u);if(i(s)){o=s,e.removeAt(u);break}}else o=e.shiftObject();if(!o)return;if(o.get("isCrossDomain")){var a=this.get("crossDomainIFrames")[o.get("destinationDomain")];if(!a||!a.loaded){SC.debug("CW.Request.manager: postponing the sending of %@ since the necessary iframe is not loaded…",o),e.unshift(o);return}}t.pushObject(o),this.set("inflight",t);var f=o.get("requestId");o.fire
(f)}this.propertyDidChange("inflight")}}),CW.RequestManagement=SC.Object.extend({pendingRequests:null,outstandingResponses:null,addPendingRequest:function(e){var t=this.get("pendingRequests");t.pushObject(e)},addOutstandingResponse:function(e){if(!e.getPath("request.isAsynchronous")){SC.debug("Skipping response registration for synchronous response %@…",e);return}var t=this.get("outstandingResponses");t.pushObject(e)},removePendingRequest:function(e){var t=this.get("pendingRequests"),n=t.indexOf(e);n!==-1&&t.removeAt(n,1)},removeOutstandingResponse:function(e){var t=this.get("outstandingResponses"),n=t.indexOf(e);n!==-1&&t.removeAt(n,1)},pendingRequestsForCycle:function(e){var t=this.get("pendingRequests"),n=null,r,i,s;for(r=0,i=t.length;r<i;++r)s=t[r],s.get("cycle")===e&&(n?n.push(s):n=[s]);return n},outstandingResponsesForCycle:function(e){var t=this.get("outstandingResponses"),n=null,r,i,s;for(r=0,i=t.length;r<i;++r)s=t[r],s.getPath("request.cycle")===e&&(n?n.push(s):n=[s]);return n},cycleDidChangeForPendingRequest:function(){this.get("pendingRequests").enumerableContentDidChange()},cycleDidChangeForOutstandingResponse:function(){this.get("outstandingResponses").enumerableContentDidChange()},numberOfPendingOrOutstandingReadsForCycle:function(e){return this.numberOfPendingReadRequestsForCycle(e)+this.numberOfOutstandingReadResponsesForCycle(e)},numberOfPendingReadRequestsForCycle:function(e){var t,n,r,i=0,s=this.pendingRequestsForCycle(e);if(s)for(t=0,n=s.length;t<n;++t)r=s[t],r.get("isRead")&&i++;return i},numberOfOutstandingReadResponsesForCycle:function(e){var t,n,r,i=0
,s=this.outstandingResponsesForCycle(e);if(s)for(t=0,n=s.length;t<n;++t)r=s[t],r.getPath("request.isRead")&&i++;return i},numberOfPendingOrOutstandingWritesForCycle:function(e){return this.numberOfPendingWriteRequestsForCycle(e)+this.numberOfOutstandingWriteResponsesForCycle(e)},numberOfPendingWriteRequestsForCycle:function(e){var t,n,r,i=0,s=this.pendingRequestsForCycle(e);if(s)for(t=0,n=s.length;t<n;++t)r=s[t],r.get("isWrite")&&i++;return i},numberOfOutstandingWriteResponsesForCycle:function(e){var t,n,r,i=0,s=this.outstandingResponsesForCycle(e);if(s)for(t=0,n=s.length;t<n;++t)r=s[t],r.getPath("request.isWrite")&&i++;return i},init:function(){var e=arguments.callee.base.apply(this,arguments);return this.pendingRequests=[],this.outstandingResponses=[],e}}),CW.RequestManagement.mixin({sharedInstance:function(){var e=this._singleton;return e||(e=this._singleton=CW.RequestManagement.create()),e},_singleton:null}),CW.mixin({CJK_UNICODE_RANGES:[[4352,4607],[11904,12031],[12032,12255],[12288,12351],[12352,12447],[12448,12543],[12544,12591],[12592,12687],[12688,12703],[12704,12735],[12800,13055],[13056,13311],[13312,19893],[19968,40959],[40960,42127],[42128,42191],[44032,55203],[63744,64255],[65072,65103]],characterCodeIsCJK:function(e){var t=this.CJK_UNICODE_RANGES,n;if(SC.none(e))return NO;for(var r=0,i=t.length;r<i;++r){n=t[r];if(e>=n[0]&&e<=n[1])return YES}return NO},stringIsCJK:function(e){e=e.trim();if(SC.empty(e))return NO;var t=0,n=e.length-1;while(t<=n)if(!this.characterCodeIsCJK(e.charCodeAt(t++))||!this.characterCodeIsCJK(e.charCodeAt(n--)))return NO;return YES}}),SC.time=
function(e){var t=SC.beget(fn);return t.value=e,t},function(){var e=new Date;SC.mixin(SC.time,{month:function(t,n){return e.setTime(t),n===undefined?e.getMonth():(e.setMonth(n),e.getTime())},utc:function(t){return e.setTime(t),t+e.getTimezoneOffset()*60*1e3},local:function(t){return e.setTime(t),t-e.getTimezoneOffset()*60*1e3},parse:function(e){},format:function(e){}})}(),SC.time.fmt=SC.time.format,SC.time.fn={done:function(){return this.value}},"month day year".split(" ").forEach(function(e){SC.time.fn[e]=function(t){return t===undefined?SC.time[e](this.value):(this.value=SC.time[e](this.value,t),this)}});var MONTH_NAMES=["January","February","March","April","May","June","July","August","September","October","November","December","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],DAY_NAMES=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sun","Mon","Tue","Wed","Thu","Fri","Sat"];SC.Locale.define("en",{longMonthNames:"January February March April May".split(" "),shortMonthNames:[],shortDateFormat:"dd/mm/yy",longDateFormat:""}),SC.mixin(Date,{isDate:function(e,t){var n=Date.getDateFromFormat(e,t);return n===0?!1:!0},compareDates:function(e,t,n,r){var i=Date.getDateFromFormat(e,t),s=Date.getDateFromFormat(n,r);return i===0||s===0?-1:i>s?1:0},getDateFromFormat:function(e,t){e+="",t+="";var n=0,r=0,i="",s="",o="",u,a,f=new Date,l=f.getFullYear(),c=f.getMonth()+1,h=1,p=f.getHours(),d=f.getMinutes(),v=f.getSeconds(),m="",g=SC.Locale.currentLocale;while(r<t.length){i=t.charAt(r),s="";while(t.charAt(r)==i&&r<t.length)s+=t.charAt(r++);if(
s==="yyyy"||s==="yy"||s==="y"){s==="yyyy"&&(u=4,a=4),s==="yy"&&(u=2,a=2),s==="y"&&(u=2,a=4),l=Date._getInt(e,n,u,a);if(l===null)return 0;n+=l.length,l.length===2&&(l>70?l=1900+(l-0):l=2e3+(l-0))}else if(s==="MMM"||s==="NNN"){c=0;for(var y=0;y<MONTH_NAMES.length;y++){var b=MONTH_NAMES[y];if(e.substring(n,n+b.length).toLowerCase()==b.toLowerCase())if(s==="MMM"||s==="NNN"&&y>11){c=y+1,c>12&&(c-=12),n+=b.length;break}}if(c<1||c>12)return 0}else if(s==="EE"||s==="E")for(y=0;y<DAY_NAMES.length;y++){var w=DAY_NAMES[y];if(e.substring(n,n+w.length).toLowerCase()==w.toLowerCase()){n+=w.length;break}}else if(s==="MM"||s==="M"){c=Date._getInt(e,n,s.length,2);if(c===null||c<1||c>12)return 0;n+=c.length}else if(s==="dd"||s==="d"){h=Date._getInt(e,n,s.length,2);if(h===null||h<1||h>31)return 0;n+=h.length}else if(s==="hh"||s==="h"){p=Date._getInt(e,n,s.length,2);if(p===null||p<1||p>12)return 0;n+=p.length}else if(s==="HH"||s==="H"){p=Date._getInt(e,n,s.length,2);if(p===null||p<0||p>23)return 0;n+=p.length}else if(s==="KK"||s==="K"){p=Date._getInt(e,n,s.length,2);if(p===null||p<0||p>11)return 0;n+=p.length}else if(s==="kk"||s==="k"){p=Date._getInt(e,n,s.length,2);if(p===null||p<1||p>24)return 0;n+=p.length,p--}else if(s==="mm"||s==="m"){d=Date._getInt(e,n,s.length,2);if(d===null||d<0||d>59)return 0;n+=d.length}else if(s==="ss"||s==="s"){v=Date._getInt(e,n,s.length,2);if(v===null||v<0||v>59)return 0;n+=v.length}else if(s==="a"){if(e.substring(n,n+2).toLowerCase()==="am")m="AM";else{if(e.substring(n,n+2).toLowerCase()!=="pm")return 0;m="PM"}n+=2}else{if(e.substring(n,n+s.length)!=s)return 0;n+=
s.length}}if(n!==e.length)return 0;if(c===2)if(l%4===0&&l%100!==0||l%400===0){if(h>29)return 0}else if(h>28)return 0;if(c===4||c===6||c===9||c===11)if(h>30)return 0;p<12&&m=="PM"?p=p-0+12:p>11&&m=="AM"&&(p-=12);var E=new Date(l,c-1,h,p,d,v);return E.getTime()},parseDate:function(e){var t=arguments.length==2?arguments[1]:!1,n=["E NNN dd HH:mm:ss UTC yyyy","y-M-d","y-M-d","MMM d, y","MMM d,y","y-MMM-d","d-MMM-y","MMM d","d MMM y","d.MMM.y","y MMM d","y.MMM.d"],r=["M/d/y","M-d-y","M.d.y","MMM-d","M/d","M-d"],i=["d/M/y","d-M-y","d.M.y","d-MMM","d/M","d-M"],s=t?n.concat(i,r):n.concat(r,i),o=null;o=0;var u=(new Date).getTime();switch(e.toLowerCase()){case SC.String.loc("yesterday"):o=u-864e5;break;case SC.String.loc("today"):case SC.String.loc("now"):o=u;break;case SC.String.loc("tomorrow"):o=u+864e5}if(o>0)return new Date(o);for(var a=0;a<s.length;a++){o=Date.getDateFromFormat(e,s[a]),o===0&&(o=Date.getDateFromFormat(e,s[a]+" H:m:s")),o===0&&(o=Date.getDateFromFormat(e,s[a]+" h:m:s a"));if(o!==0)return new Date(o)}return null},_isInteger:function(e){var t="1234567890";for(var n=0;n<e.length;n++)if(t.indexOf(e.charAt(n))==-1)return!1;return!0},_getInt:function(e,t,n,r){for(var i=r;i>=n;i--){var s=e.substring(t,t+i);if(s.length<n)return null;if(Date._isInteger(s))return s}return null}}),SC.mixin(Date.prototype,{format:function(e){e+="";var t=this,n="",r=0,i="",s="",o=t.getFullYear()+"",u=t.getMonth()+1,a=t.getDate(),f=t.getDay(),l=t.getHours(),c=t.getMinutes(),h=t.getSeconds(),p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L={};o.length<4&&(o=""+(o-0+1900)),L.y=""+o,L.yyyy=o,L.yy=o.substring(2,4),L
.M=u,L.MM=LZ(u),L.MMM=MONTH_NAMES[u-1],L.NNN=MONTH_NAMES[u+11],L.d=a,L.dd=LZ(a),L.E=DAY_NAMES[f+7],L.EE=DAY_NAMES[f],L.H=l,L.HH=LZ(l),l===0?L.h=12:l>12?L.h=l-12:L.h=l,L.hh=LZ(L.h),l>11?L.K=l-12:L.K=l,L.k=l+1,L.KK=LZ(L.K),L.kk=LZ(L.k),l>11?L.a="PM":L.a="AM",L.m=c,L.mm=LZ(c),L.s=h,L.ss=LZ(h);while(r<e.length){i=e.charAt(r),s="";while(e.charAt(r)==i&&r<e.length)s+=e.charAt(r++);SC.none(L[s])?n+=s:n+=L[s]}return n},utcFormat:function(){var e=new Date(this.getTime()+this.getTimezoneOffset()*60*1e3);return e.format("E NNN dd HH:mm:ss UTC yyyy")}}),CW.UPLOADER_READY=0,CW.UPLOADER_INCOMPATIBLE_FILE_TYPE=1,CW.UPLOADER_FILE_TOO_BIG=2,CW.UPLOADER_MISSING_XHR=3,CW.Uploader=SC.Object.extend({isUploader:YES,uploadURL:null,maximumFileSize:2048e3,allowedFileTypes:"png jpeg bmp jpg gif".w(),shouldUploadFile:function(e){return YES},encloseFileWithinForm:NO,formFieldName:"X-data",withCredentials:NO,willUploadFile:function(e,t){var n=this;t.upload.onprogress=function(e){SC.run(function(){this.logIfRawRequestEvtNotNull(t,e,"rawRequest:upload:progess - ");if(!this.uploadProgressDidChange){SC.warn("No function called uploadProgressDidChange found in %@ object",this.toString());return}this.uploadProgressDidChange(t,e)},n)},t.onload=function(e){SC.run(function(){this.logIfRawRequestEvtNotNull(t,e,"rawRequest:onload - ");if(!this.didUploadFile){SC.warn("No function called didUploadFile found in %@ object",this.toString()),this.uploadDidFail&&this.uploadDidFail(t,e);return}this.didUploadFile(t,e)},n)},t.onerror=function(e){SC.run(function(){this.logIfRawRequestEvtNotNull(t,e,"rawRequest:onerror - ");if(!
this.uploadDidFail){SC.warn("No function called uploadDidFail found in %@ object",this.toString());return}this.uploadDidFail(t,e)},n)},t.onreadystatechange=function(e){t.readyState===4&&t.status!==200&&SC.run(function(){n.uploadDidFail(t,e)})}},logIfRawRequestEvtNotNull:function(e,t,n){var r=NO;n||(n=""),e||(n+="Raw Request was not found.",r=YES),t||(n+="Evt was not found.",r=YES),r&&SC.warn(n)},setRequestHeaders:function(e,t){t.setRequestHeader("X-File-Name",encodeURIComponent(e.fileName)),t.setRequestHeader("X-File-Size",e.fileSize);var n=this.get("_xhrHeaders");for(var r in n)n.hasOwnProperty(r)&&t.setRequestHeader(r,n[r])},uploadProgressDidChange:function(e,t){},didUploadFile:function(e,t){},uploadDidFail:function(e,t){},uploadFiles:function(e){var t=[];for(var n=e.length-1;n>=0;n--){var r=e[n],i=this._fileIsAcceptableToUpload(r);if(i!==CW.UPLOADER_READY)t.push(this._errorForFile(r,i));else if(this.shouldUploadFile(r))try{this._createAndSendUploadRequest(r)}catch(s){console.warn(s.toString())}}return t},_xhrHeaders:function(){var e={"If-Modified-Since":"Mon, 26 Jul 1997 05:00:00 GMT","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"};return this.get("encloseFileWithinForm")||(e["Content-Type"]="text/plain"),e}.property("encloseFileWithinForm").cacheable(),_fileTooBigDescription:"Uploader.fileTooBigDescription".loc(),_wrongFileTypeDescription:"Uploader.wrongFiletypeDescription".loc(),_createAndSendUploadRequest:function(e){var t=this.get("uploadURL");if(!t)throw"%@: Can't upload file if uploadURL is not set.".fmt(this);var n=this.get("encloseFileWithinForm"),
r;n?(r=new FormData,r.append(this.get("formFieldName"),e)):r=e;var i=new XMLHttpRequest;if(!i)throw this._errorForFile(e,CW.UPLOADER_MISSING_XHR);this.willUploadFile(e,i),i.open("POST",t,!0),this.setRequestHeaders(e,i),this.get("withCredentials")&&(i.withCredentials=YES),i.send(r)},_fileIsAcceptableToUpload:function(e){var t=CW.UPLOADER_READY,n=this.get("maximumFileSize"),r=this.get("allowedFileTypes"),i=e.type.split("/")[1];return e.fileSize>n&&(t=CW.UPLOADER_FILE_TOO_BIG),r.indexOf(i)===-1&&(t=CW.UPLOADER_INCOMPATIBLE_FILE_TYPE),t},_errorForFile:function(e,t){var n="",r="";switch(t){case CW.UPLOADER_INCOMPATIBLE_FILE_TYPE:n=this._wrongFileTypeDescription;break;case CW.UPLOADER_FILE_TOO_BIG:n=this._fileTooBigDescription}return SC.$error(n,r,e,t)}}),CW.XDRResponse=CW.Response.extend({createRequest:function(){var e=new XDomainRequest,t=this;return e.timeout=null,e.onerror=function(){if(!t)return null;var e=t.finishRequest();return e&&(t=null),e},e.onload=function(){if(!t)return null;var e=t.finishRequest(200);return e&&(t=null),e},e},setRequestHeaders:function(){},finishRequest:function(e){var t=this.get("rawRequest");return t.readyState=4,t.status=e,arguments.callee.base.apply(this,arguments)}}),SC.Validator.CalDate=SC.Validator.extend({format:"M/d/yyyy",currentValue:null,fieldValueForObject:function(e,t,n){var r=CW.Date.create(e,CW.DATE_ONLY);return e=this._date=r.format(this.get("format")),e},objectForFieldValue:function(e,t,n){var r=CW.DATE_ONLY,i=this.get("format"),s=["M/d/yyyy","M.d.yyyy","M-d-yyyy"],o=s.indexOf(i)===-1,u=o?[i]:null,a,f,l=n.get("value"),c=this.get("currentValue"
);return e=e.replace(/\s/g,""),f=Date.parseDate(e,u),f?e=CW.Date.create(f,r).done():Date.isDate(e,"yyyy/MM/dd")?e=CW.Date.create(new Date(Date.getDateFromFormat(e,"yyyy/MM/dd")),r).done():Date.isDate(e,"yyyy.MM.dd")?e=CW.Date.create(new Date(Date.getDateFromFormat(e,"yyyy.MM.dd")),r).done():Date.isDate(e,"yyyy/M/dd")?e=CW.Date.create(new Date(Date.getDateFromFormat(e,"yyyy/M/dd")),r).done():Date.isDate(e,"yyyy.M.dd")?e=CW.Date.create(new Date(Date.getDateFromFormat(e,"yyyy.M.dd")),r).done():Date.isDate(e,"yyyy/MM/d")?e=CW.Date.create(new Date(Date.getDateFromFormat(e,"yyyy/MM/d")),r).done():Date.isDate(e,"yyyy.MM.d")?e=CW.Date.create(new Date(Date.getDateFromFormat(e,"yyyy.MM.d")),r).done():Date.isDate(e,"yyyy.M.d")?e=CW.Date.create(new Date(Date.getDateFromFormat(e,"yyyy.M.d")),r).done():Date.isDate(e,"yyyy/M/d")?e=CW.Date.create(new Date(Date.getDateFromFormat(e,"yyyy/M/d")),r).done():Date.isDate(e,"MM/yyyy")?e=CW.Date.create(new Date(Date.getDateFromFormat(e,"MM/yyyy")),r).done():Date.isDate(e,"MM.yyyy")?e=CW.Date.create(new Date(Date.getDateFromFormat(e,"MM.yyyy")),r).done():Date.isDate(e,"MM-yyyy")?e=CW.Date.create(new Date(Date.getDateFromFormat(e,"MM-yyyy")),r).done():Date.isDate(e,"yyyy/MM")?e=CW.Date.create(new Date(Date.getDateFromFormat(e,"yyyy/MM")),r).done():Date.isDate(e,"yyyy.MM")?e=CW.Date.create(new Date(Date.getDateFromFormat(e,"yyyy.MM")),r).done():Date.isDate(e,"yyyy-MM")?e=CW.Date.create(new Date(Date.getDateFromFormat(e,"yyyy-MM")),r).done():Date.isDate(e,"dd.MM")?e=CW.Date.create(new Date(Date.getDateFromFormat(e,"dd.MM")),r).done():Date.isDate(e,"MM.dd"
)?e=CW.Date.create(new Date(Date.getDateFromFormat(e,"MM.dd")),r).done():Date.isDate(e,"yyyy.MM.dd.")?e=CW.Date.create(new Date(Date.getDateFromFormat(e,"yyyy.MM.dd.")),r).done():(a=CW.DateParser.parseDate(e,l,o,c),e=a?a.done():l),e}}),SC.Validator.Email=SC.Validator.extend({validate:function(e,t){var n=t.get("fieldValue")||"",r,i=n.match(/@/g);if(!i||i.length>1)r=NO;else{var s=CW.punycode.toASCII(n);r=/^(?:[^()<>\[\]:;@\\,*\s])*(?:[^()<>\[\]:;@\\,.*\s])+\@(?:xn--)?[A-Z0-9]+(?:[\-][A-Z0-9]+)*(?:\.(?:xn--)?[A-Z0-9\-]+){1,8}$/i.test(s)}return r},validateError:function(e,t){var n=t.get("errorLabel")||"Field";return SC.$error("Invalid.Email(%@)".loc(n),n)}}),SC.Validator.IsDate=SC.Validator.Date.extend({validate:function(e,t){var n=t.get("fieldValue"),r=!!n;return r&&n.length&&(r=Date.isDate(n)),r},validateError:function(e,t){var n=t.get("errorLabel")||"Field";return SC.$error("Invalid.Date(%@)".loc(),t.get("errorLabel"))}}),SC.Validator.CalTime=SC.Validator.extend({format:"hh:mm",separator:":",timeFormat:24,fieldValueForObject:function(e,t,n){return e},objectForFieldValue:function(e,t,n){var r=this.get("format"),i=n.get("value"),s=this.get("timeFormat"),o=s===12?13:24,u,a,f,l,c,h=["a","am","p","pm"],p=e.charAt(e.length-1),d=e.substr(e.length-2),v=h.indexOf(p)!==-1?p:h.indexOf(d)!==-1?d:null,m=h.indexOf(v)>=2,g=e,y=g.length;if(!isNaN(e)&&(e<0||e>=o))return[i,s];Date.isDate(e,"h:m")?l=new Date(Date.getDateFromFormat(e,"h:m")):Date.isDate(e,"h.m")&&(l=new Date(Date.getDateFromFormat(e,"h:m"))),Date.isDate(e,"h")&&(l=new Date(Date.getDateFromFormat(e,"h")),l.setMinutes(0)),Date.isDate
(e,"h:")?(l=new Date(Date.getDateFromFormat(e,"h:")),l.setMinutes(0)):Date.isDate(e,"h.")&&(l=new Date(Date.getDateFromFormat(e,"h.")),l.setMinutes(0)),Date.isDate(e,":m")?(l=new Date(Date.getDateFromFormat(e,":m")),l.setHours(0)):Date.isDate(e,".m")&&(l=new Date(Date.getDateFromFormat(e,".m")),l.setHours(0)),Date.isDate(e,"H:m")?l=new Date(Date.getDateFromFormat(e,"H:m")):Date.isDate(e,"H.m")&&(l=new Date(Date.getDateFromFormat(e,"H.m"))),Date.isDate(e,"H:")?(l=new Date(Date.getDateFromFormat(e,"H:")),l.setMinutes(0)):Date.isDate(e,"H.")&&(l=new Date(Date.getDateFromFormat(e,"H.")),l.setMinutes(0)),Date.isDate(e,"H")&&(l=new Date(Date.getDateFromFormat(e,"H")),l.setMinutes(0));if(!SC.none(l))u=e.split(this.get("separator")).objectAt(0),a=u.toString().charAt(0)==="0"?parseInt(u.toString().charAt(1),10):parseInt(u,10),u.toString().charAt(0)==="0"||a>12?s=24:r==="H:mm"&&(a===12||a===11||a===10)&&(s=24),i=l.format(r);else if(e.toLowerCase()==="Now".loc().toLowerCase())c=CW.Date.create(null,CW.DATE_TIME),c._dateObj=Date.parse(e),c.parse(Date.parse(e)),i=c.format(r),s=24;else if(e.toLowerCase()==="Midnight".loc().toLowerCase())c=CW.Date.create(null,CW.DATE_TIME),c.hours(0).minutes(0),i=c.format(r),s=24;else if(e.toLowerCase()==="Noon".loc().toLowerCase())c=CW.Date.create(null,CW.DATE_TIME),c.hours(12).minutes(0),i=c.format(r),s=24;else{var b,w,E,S,x;v&&(g=e.substr(0,e.indexOf(v)),y=g.length);if(!isNaN(g)){if(g<0||g>=o)return[i,s];b=parseInt(e.charAt(0),10),E=parseInt(e.charAt(1),10),w=parseInt(e.substr(0,2),10),S=parseInt(e.substr(2,2),10),x=parseInt(e.substr(1,2),10);switch(y){case 1
:u=b,f=0;break;case 2:u=w<=23?w:b,f=w<=23?0:E;break;case 3:u=b,f=x;break;case 4:u=w,f=S}u<12&&m&&(u+=12),u===12&&!m&&(u=0);if(f>=0&&f<=59&&u>=0&&u<=23){c=CW.Date.create(null,CW.DATE_TIME);var T=new Date;T.setHours(parseInt(u,10)),T.setMinutes(parseInt(f,10)),T.setSeconds(0),T.setMilliseconds(0),c._dateObj=T,c._dateComponentDidChange(),s=24,i=c.format(r)}}}return[i,s]}}),window.CW||(window.CW={}),function(){var e=CW.Animator=CW.Anim={fps:60,fpsModifier:65/60,tasks:[],speedMultiplier:1,frameCount:0,isActive:!1,isInFrame:!1,extraStatus:{},ENABLE_OLD_IE:!0,_runningCWAguid:0,_hasSC:!!(window.SC&&SC.RunLoop&&SC.Object),_frameTimeNoiseLevelingWindowSize:30,_frameNoiseLevelerLog:[],_movingAverageFrameTime:function(){for(var t=0,n=e._frameNoiseLevelerLog,r=0,i=n.length;t<i;t++)r+=n[t];return Math.round(10*r/(i||1))/10},init:function(){e.prepareObject(),e.stop(),e.useRAF=e.IS_MOBILE&&window.requestAnimationFrame&&window.cancelRequestAnimationFrame,e.lock16=e.IS_MOBILE&&!e.useRAF},nextFrame:function(t,n){var r,i=e._frameNoiseLevelerLog,s=e._frameTimeNoiseLevelingWindowSize,o,u,a=0;e.isInFrame=e._canAddLastSecondTasks=!0,o=e._lastFrameTime===-1?(new Date).valueOf():e._lastFrameTime,e._lastFrameTime=(new Date).valueOf(),u=o=e._lastFrameTime-o,e.now=e._lastFrameTime,e.firstActiveFrame&&(o=0),o>=300&&o>=(r=Math.max(e._movingAverageFrameTime(),60))*5?(o=0,i.unshift(r/2)):i.unshift(o),i.length<=s||(i.length=s),e.frameTime=o;var f=!e._hasSC||SC.RunLoop.isRunLoopInProgress();if(!e.shouldSkipFrame||!e.shouldSkipFrame()){f||(SC.RunLoop.begin(),e._SCLoopBegan()),e.trigger("preframe");for(var l=0,
c;c=e.tasks[l];l++)c.running&&c.elapse(o*e.speedMultiplier);e._canAddLastSecondTasks=!1;for(l=0;c=e.tasks[l];l++)c.running?c&&(c.fps||e.fps)>a&&(a=c.fps||e.fps):(c._inCWATasks=!1,e.tasks.splice(l--,1));e.trigger("frame"),f||(SC.RunLoop.end(),e._SCLoopEnded()),e.isActive=!!e.tasks.length,e.frameCount++}else e._canAddLastSecondTasks=!1;e.frameRate=Math.round(1e5/u)/100,e.computeTime=(new Date).valueOf()-e.now;var h=Math.round(1e3/(a*e.fpsModifier));e.timeoutWaitTime=Math.max(0,h-e.computeTime),e.clearNextTimeout(),!n&&e.isActive?e.useRAF?e._timeout=window.requestAnimationFrame(e.nextFrame,document.body):e._timeout=setTimeout(e.nextFrame,e.lock16?16:e.timeoutWaitTime):e.stop(),e.firstActiveFrame&&(e.firstActiveFrame=!1),e.isInFrame=!1,e._alreadyExpeditedNextFrame=!1},start:function(){if(e.isActive){e._canAddLastSecondTasks||e.expediteNextFrame();return}e.firstActiveFrame=!0,e.isActive=!0,e._lastFrameTime=-1,e.frameTime=1e3/e.fps,e.frameRate=1e3/e.frameTime,e.computeTime=0,e.trigger("start"),e.nextFrame()},stop:function(){e.isActive=!1,e.frameTime=Infinity,e.frameRate=0,e.computeTime=NaN,e.timeoutWaitTime=NaN,e.clearNextTimeout(),e.trigger("stop")},clearNextTimeout:function(){if(!e._timeout)return;e.useRAF?window.cancelRequestAnimationFrame(e._timeout):clearTimeout(e._timeout),e._timeout=0},expediteNextFrame:function(){if(e._alreadyExpeditedNextFrame||!e.isActive)return;e._alreadyExpeditedNextFrame=!0,e.clearNextTimeout(),e._timeout=setTimeout(e.nextFrame,0)},handleTask:function(t){if(!t||t.isDestroyed)return;if(!t._inCWATasks){if(t.name)for(var n=0,r=e.tasks,i;i=r[n];n++)i.name===
t.name&&i.stop();e.tasks.push(t)}t._inCWATasks=!0,e.start()},tellStop:function(){arguments._isArgs_=!0,this.performMethodOn("stop",arguments)},tellFinish:function(){arguments._isArgs_=!0,this.performMethodOn("finish",arguments)},performMethodOn:function(e,t){var n=1,r=arguments;t&&t._isArgs_&&(n=0,r=t);for(var i=n,s,o=r.length;i<o;i++)(s=r[i])&&s[e]&&s[e]()},trigger:function(e,t){if(this.isDestroyed)return;var n,r;(n=this["on"+e]||this["on"+e.charAt(0).toUpperCase()+e.substring(1)])instanceof Function&&n.call(this,t);if(!(r=this["__"+e+"Listeners__"]))return;for(var i=0,s;i<r.length;i++){if(!((s=r[i])instanceof Function))continue;s.call(this,t)}},clearTrigger:function(e){var t=this["__"+e+"Listeners__"];if(!t)return;t.length=0},listen:function(e,t){if(!e)return;if(!t){t=e;var n=t._listens;if(n)for(var r=0;e=n[r];r++)this.listen(e,t);return}var i="__"+e+"Listeners__";if(!this.hasOwnProperty(i))if(!this[i])this[i]=[];else{for(var s=[],o=0,u=this[i].length;o<u;o++)s.push(this[i][o]);this[i]=s}this[i].push(t)},unlisten:function(e,t){if(!e)return;if(!t){t=e;var n=t._listens;if(n)for(var r=0;e=n[r];r++)this.unlisten(e,t);return}var i="__"+e+"Listeners__";if(!this[i])return;if(!this.hasOwnProperty(i)){for(var s=[],o=0,u=this[i].length;o<u;o++)s.push(this[i][o]);this[i]=s}for(var a=0,f=this[i],l=f.length;a<l;a++)f[a]===t&&(f[a]=undefined)},setIfChanged:function(e,t){var n=this[e];return this[e]=t,t!==n&&this.trigger(e),t},get:function(e){return this[e]},set:function(e,t){return this[e]=t,this.trigger(e),t},cloneFunction:function(e){var t=e.clonedFrom;if(t)return t.clone();var n=function(
){var e=arguments.callee.clonedFrom,t=e.base,n;return e.base=arguments.callee.base,n=arguments.callee.clonedFrom.apply(this,arguments),e.base=t,n};for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return n.clonedFrom=e,n.toString=function(){return"Clone of "+this.clonedFrom.toString()},n},toString:function(){return"[The CoreWeb Animator]"},prepareObject:function(){var t=Function.prototype;t.listens=function(){var e=!this._listens,t=this._listens||(this._listens=[]);e&&(t.length=0);for(var n=0,r=arguments.length;n<r;n++)t.push(arguments[n]);return this},t.observes||(t.observes=t.listens),e.Object=e._hasSC?e.prepareSCObject():e.prepareOwnObject()},prepareOwnObject:function(){var t=function(){};return t.prototype={className:"Object",init:function(){this._cwaguid=++e._runningCWAguid},mixin:function(t){if(!arguments.length)return this;for(var n=0,r=arguments.length,i,s,o,u,a,f,l,c,h,p;n<r;n++){o=arguments[n],l=o.isMixin;for(f in o){h=this.suffixes;if(!o.hasOwnProperty(f)||f==="isMixin")continue;u=this[f],a=o[f],(c=this[f+"Override"])&&(c instanceof Function||(c=this[c])instanceof Function)&&(a=c.call(this,a,u,f));for(i=0;p=h&&h[i];i++)f.slice(-p.length)===p&&(c=this["*"+p+"Override"])&&(c instanceof Function||(c=this[c])instanceof Function)&&(a=c.call(this,a,u,f));u instanceof Function&&(l&&a instanceof Function&&(a=e.cloneFunction(a)),a.base=u,u._listens&&this.unlisten(u)),a instanceof Function&&a._listens&&this.listen(a),this[f]=a}}return this},trigger:e.trigger,listen:e.listen,unlisten:e.unlisten,clearTrigger:e.clearTrigger,toString:e._objectToString,get:e.get,set:e.set,setIfChanged
:e.setIfChanged},t.isClass=!0,t.create=function(){var e;return arguments.length?e=new(this.extend.apply(this,arguments)):e=new this,e._type=this,e.init(),e},t.extend=function(){var e=function(){},t=new this;t.mixin.apply(t,arguments);for(var n in this){if(!this.hasOwnProperty(n))continue;e[n]=this[n]}return e.prototype=t,e},t},prepareSCObject:function(){var t=SC.Object.extend({className:"CW.Anim.Object",init:function(){arguments.callee.base.call(this),this._cwaguid=++e._runningCWAguid},trigger:e.trigger,listen:e.listen,unlisten:e.unlisten,clearTrigger:e.clearTrigger,toString:e._objectToString,setIfChanged:e.setIfChanged}),n=function(e,t){for(var n,r,i,s,o=0;n=e[o];o++){if(typeof n!="object")continue;for(i in n){if(!n.hasOwnProperty(i))continue;if(!((r=n[i])instanceof Function)||!r._listens)continue;t.listen(r)}}},r=function(){var e=arguments.callee.base.apply(this,arguments);return e.prototype._type=this,n(arguments,e.prototype),e};r.base=t.extend,t.extend=r;var i=function(){var e=arguments.callee.base.apply(this,arguments);return n(arguments,e),e};return i.base=t.create,t.create=i,t},_objectToString:function(){return"["+this.className+(this._cwaguid?":"+this._cwaguid:"")+"]"},asHTML:function(e){return e.split("\n").join("<BR>").split("  ").join(" &nbsp;")},toCamel:function(e,t){for(var n=0,r=e.length;n<r;n++){if(e.charAt(n)!=="-"||n==r-1)continue;e=e.substring(0,n)+e.charAt(n+1).toUpperCase()+e.substring(n+2),r--}return t?e.charAt(0).toUpperCase()+e.substring(1):e},toDashed:function(e){for(var t=0,n=e.length;t<n;t++){var r=e.charAt(t);if(r.toLowerCase()===r||t==n-1)continue;
e=e.substring(0,t)+"-"+e.charAt(t).toLowerCase()+e.substring(t+1),n++}return e},getStyle:function(t,n){if(t.currentStyle)return t.currentStyle[e.toCamel(n)];if(t.initialStyle)return t.initialStyle.getPropertyValue(n);var r;if((r=document.defaultView)&&(r=r.getComputedStyle))return(t.initialStyle=r(t,null)).getPropertyValue(n)},IS_MOBILE:!!(/ipad/.test(navigator.userAgent.toLowerCase())||/iphone/.test(navigator.userAgent.toLowerCase())||/ipod/.test(navigator.userAgent.toLowerCase())||/android/.test(navigator.userAgent.toLowerCase())),getOpacity:function(t){if(!t)return-1;var n;return(n=t.cwa$opacity||t.getAttribute("cwa$opacity"))&&(n=parseFloat(n))||n===0?n:(n=t.style.opacity||e.getStyle(t,"opacity"))&&(n=parseFloat(n))||n===0?parseFloat(n):1},setOpacity:function(e,t){return e?(t=Math.max(0,Math.min(1,t)),t>.9999||isNaN(t)?this.removeOpacity(e):(e.cwa$opacity=t,e.style.opacity=t,t)):-1},removeOpacity:function(e){return e?(e.cwa$opacity=1,e.style.opacity="",1):-1},encodeColor:function(e,t,n){if(typeof e=="object"&&typeof e.r=="number"&&typeof e.g=="number"&&typeof e.b=="number")t=e.g,n=e.b,e=e.r;else if(typeof e=="object")t=e[1],n=e[2],e=e[0];else if(typeof e=="string"){if(e.charAt(0)=="#"&&e.length===7)return e;e=CW.Anim.decodeColor(e),t=e[1],n=e[2],e=e[0]}return e=Math.round(Math.max(0,Math.min(255,e))).toString(16),e.length==1&&(e="0"+e),t=Math.round(Math.max(0,Math.min(255,t))).toString(16),t.length==1&&(t="0"+t),n=Math.round(Math.max(0,Math.min(255,n))).toString(16),n.length==1&&(n="0"+n),("#"+e+t+n).toUpperCase()},decodeColor:function(t){e.colors&&e.colors[t]&&(t=e.colors
[t]);var n,r,i,s;if((n=typeof t)=="number"||n=="object")return undefined;t=t.replace(/\s+/g,"");if(t.charAt(0)=="#")t.length==4&&(t="#"+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2)+t.charAt(3)+t.charAt(3)),r=parseInt(t.substring(1,3),16),i=parseInt(t.substring(3,5),16),s=parseInt(t.substring(5,7),16);else{var o;if(t.indexOf("rgba(")!=-1)o=5;else{if(t.indexOf("rgb(")==-1)return undefined;o=4}t=t.substring(o,t.length-1).split(","),r=parseInt(t[0],10),i=parseInt(t[1],10),s=parseInt(t[2],10)}return[r,i,s]},colors:{red:"#ff0000","orange red":"#ff4500",orange:"#ff7f00",yellow:"#ffff00",green:"#00ff00","forest green":"#228b22",cyan:"#00ffff","light sea green":"#20b2aa",blue:"#0000ff","cornflower blue":"#6495ed","medium blue":"#3232cd",purple:"#a020f0","hot pink":"#ff69b4",magenta:"#ff00ff",white:"#ffffff","light gray":"#d3d3d3",gray:"#bebebe","dark gray":"#a9a9a9","dim gray":"#696969",black:"#000000"},initRandom:function(e,t,n){return{isInitRandom:!0,lo:e,hi:t,round:n}},_improveSCCompatibility:function(){if(!e._hasSC)return;e._runLoopedTrigger=function(){var t=SC.RunLoop.isRunLoopInProgress();t||SC.RunLoop.begin(),e._inSCLoop=!0;var n=e._coreTrigger.apply(this,arguments);return e._inSCLoop=!1,t||SC.RunLoop.end(),n},e._coreTrigger=e.trigger,e.trigger=e._runLoopedTrigger},_SCLoopBegan:function(){e._inSCLoop=!0,e.trigger=e.Object.prototype.trigger=e._coreTrigger},_SCLoopEnded:function(){e._inSCLoop=!1,e.trigger=e.Object.prototype.trigger=e._runLoopedTrigger}}}(),CW.Anim.init(),CW.Anim._improveSCCompatibility(),CW.Anim.Task=CW.Anim.Object.extend({className:"CW.Anim.Task",running:!1,
speedMultiplier:1,frameCount:0,elapsedTime:0,ticked:!1,tickCount:0,start:function(){return this.running?this:(this.running=!0,this.elapsedTime=this.frameCount=this.tickCount=0,this.trigger("start"),CW.Anim.handleTask(this),this)},stop:function(){return this.running?(this.running=!1,this.trigger("stop"),this):this},elapse:function(e,t){if(this.isDestroyed)return this.running=!1,this;if(!t&&this.shouldSkipFrame&&this.shouldSkipFrame())return this;this._forcedZeroes&&(e=0,this._forcedZeroes--),e*=this.speedMultiplier,this.trigger("preframe"),this.elapsedTime+=e;if(!this.ticked)this.trigger("pretick"),this.run instanceof Function&&this.run(e),this.tickCount++,this.trigger("tick");else for(var n=this.ticked===!0?1e3/CW.Anim.fps:this.ticked,r=1+Math.floor(this.elapsedTime/n),i=r-this.tickCount,s=0;s<i;s++)this.trigger("pretick"),this.run instanceof Function&&this.run(n,s<i-1),this.running&&this.trigger("tick"),this.tickCount++;return this.running&&(this.trigger("frame"),this.trigger("frame"+this.frameCount)),this.trigger("postFrame"),this.clearTrigger("postFrame"),this.frameCount++,this},destroy:function(){return arguments.callee.base&&arguments.callee.base.apply(this,arguments),this.isDestroyed=!0,this}}),CW.Anim.Task.initiate=function(){var e=this.create.apply(this,arguments);return e.start(),e},CW.Anim.tweens={make:function(e){var t=[];for(var n=1,r=arguments.length;n<r;n++)t.push(arguments[n]);return function(){var n=t;n.l=n.length;var r=CW.Anim.tweens[e]||CW.Anim.tweens.LINEAR;return function(e){return n[n.l]=e,r.apply(this,n)}}()},compound:function(){var e=arguments.length,t=
arguments[e-1];for(var n=0,r;n<e-1&&(r=arguments[n]);n++)typeof r=="string"?t=CW.Anim.tweens[r].call(this,t):t=r.call(this,t);return t},LINEAR:function(e){return e},BOUNCE:function(e){var t;e=1-e;for(var n=0,r=1;1;n+=r,r/=2)if(e>=(7-4*n)/11){t=r*r-Math.pow((11-6*n-11*e)/4,2);break}return 1-t},SINE_IN_OUT:function(e){return.5-.5*Math.cos(Math.PI*e)},multiSineInOut:function(e,t){var n=e%1;e=Math.floor(e);for(var r=0;r<e;r++)t=.5-.5*Math.cos(Math.PI*t);return n&&(t=(1-n)*t+n*(.5-.5*Math.cos(Math.PI*t))),t},QUADRATIC_IN:function(e){return e*e},QUADRATIC_OUT:function(e){return 1-(e=1-e)*e},WEBKIT_EASE:function(e){return CW.Anim.tweens.cubicBezier(.25,.1,.25,1,e)},WEBKIT_LINEAR:function(e){return e},WEBKIT_EASE_IN:function(e){return CW.Anim.tweens.cubicBezier(.42,0,1,1,e)},WEBKIT_EASE_OUT:function(e){return CW.Anim.tweens.cubicBezier(0,0,.58,1,e)},WEBKIT_EASE_IN_OUT:function(e){return CW.Anim.tweens.cubicBezier(.42,0,.58,1,e)},cubicBezier:function(e,t,n,r,i){var s=5,o=3*e,u=3*(n-e)-o,a=1-o-u,f=3*t,l=3*(r-t)-f,c=1-f-l,h=1/(200*s),p,d,v,m,g,y;for(v=i,y=0;y<8;y++){m=((a*v+u)*v+o)*v-i;if(Math.abs(m)<h)return((c*v+l)*v+f)*v;g=(3*a*v+2*u)*v+o;if(Math.abs(g)<1e-6)break;v-=m/g}p=0,d=1,v=i;if(v<p)return((c*p+l)*p+f)*p;if(v>d)return((c*d+l)*d+f)*d;while(p<d){m=((a*v+u)*v+o)*v;if(Math.abs(m-i)<h)return((c*v+l)*v+f)*v;i>m?p=v:d=v,v=(d-p)*.5+p}return((c*v+l)*v+f)*v},linearInterpolation:function(e,t){var n=e._length_||(e._length=e.length),r=t*n/n*(n-1),i=Math.floor(r),s=e[i],o=r-i;if(o===0)return s;var u=e[Math.ceil(r)];return s*(1-o)+u*o}},CW.Anim.Animation=CW.Animation=CW.Anim.Task.extend({className
:"CW.Animation",isAnimation:!0,init:function(){arguments.callee.base.call(this),this.hasOwnProperty("animateOldIE")||(this.animateOldIE=CW.Anim.ENABLE_OLD_IE),SC.browser.isIE8OrLower&&!this.animateOldIE&&(this.disabled=!0);var e,t,n,r,i,s=this._type.prototype.freevars;typeof this.freevars=="string"&&(this.freevars=this.freevars.split(/\s+/)),this.freevars&&!this.freevars.length&&(this.freevars=[this.freevars]);if(this.freevars&&s&&this.freevars===s){i=[];for(t=0;t<(r||(r=this.freevars.length));t++)i.push(this.freevars[t]);this.freevars=i}this.freevars&&this.speed===undefined&&this.duration===undefined&&!this.signal&&(this.duration=0);for(t=-1,r=!!this.freevars&&this.freevars.length;t<r;t++)e=t===-1?this:this.freevars[t],typeof e=="string"&&(this[e].key=e,this.freevars[t]=e=this[e]),e=this.makeFreevarFromHash(e),e!==this&&(this.freevars[t]=e,e.key&&(this[e.key]=e))},makeFreevarFromHash:function(e){if(e._isFreevar)return e;var t=CW.Animation.defaultFreevar,n,r,i,s,o,u,a,f=e===this?this:{};for(i in e){if(!e.hasOwnProperty(i))continue;(s=e[i])&&s.isInitRandom===!0?(a=s.round,s=Math.random()*(s.hi-s.lo)+s.lo,a&&(s=Math.round(s/a)*a),f[i]=s):f!==e&&(f[i]=e[i])}if(f===this)for(i in t)f[i]===undefined&&(f[i]=t[i]);else for(i in t)f.hasOwnProperty(i)||(f[i]=t[i]);if(f.signal)f.tween=undefined,n=this._returnExtendedFreevar(f,CW.Animation._signalFreevar),n._unsignaledCurrent=n.from;else if(f.inertia){f.tween=undefined,n=this._returnExtendedFreevar(f,CW.Animation._inertiaFreevar),n._undampedCurrent=n.from,n.inertia!==!0||(n.inertia=CW.Animation._inertiaFreevar.prototype.inertia),r=[];for(
i=0;i<f.inertia-1;i++)r[i]=n._undampedCurrent;n.inertiaChain=r}else n=this._returnExtendedFreevar(f,CW.Animation._tweenFreevar),n._untweenedCurrent=f.from,typeof n.speed=="number"&&(n.duration=undefined);return n._isFreevar=!0,n.freevarRun(0),n},_returnExtendedFreevar:function(e,t){if(e===this){for(var n in t.prototype)this[n]===undefined&&(this[n]=t.prototype[n]);return this}return new t(e)},addFreevar:function(e){if(!e)return;return e.key&&this[e.key]?!1:(e=this.makeFreevarFromHash(e),e.key&&(this[e.key]=e),(this.freevars||(this.freevars=[])).push(e),this)},removeFreevar:function(e){typeof e=="string"&&(e=this[e]);if(!e||!e._isFreevar)return null;if(!this.freevars||!this.freevars.length)return null;e.key&&(this[e.key]=undefined);for(var t=0;t<this.freevars.length;t++)this.freevars[t]===e&&this.freevars.splice(t--,1);return e},allFreevarsDo:function(e,t){var n,r,i=arguments.callee.args||(arguments.callee.args=[]);i.length=0;for(var s=1,o=arguments.length;s<o;s++)i.push(arguments[s]);this[e].apply(this,i);if(!(n=this.freevars))return this;for(s=0;r=n[s];s++)r[e].apply(r,i);return this},forceAll:function(e){return this.allFreevarsDo("force",e),this},resetAll:function(){return this.allFreevarsDo("reset"),this},reverseAll:function(e){return this.allFreevarsDo("reverse"),this},run:function(e,t){var n=!0,r=1,i=Infinity,s;for(var o=-1,u=!!this.freevars&&this.freevars.length||0;o<u;o++)s=this.freevars&&this.freevars[o]||this,s.freevarRun(e)||(n=!1),s.progress<r&&(r=s.progress),s.tweenedProgress<i&&(i=s.tweenedProgress);this.freevars&&(this.progress=r,this.tweenedProgress=i),t||this
.update(),n&&this.listen("postFrame",this._finishNaturally)},start:function(){if(this.running)return this;this.disabled&&this.allFreevarsDo("zeroOutDuration");if(CW.Animator._hasSC){var e=SC.RunLoop.isRunLoopInProgress();e||SC.RunLoop.begin()}var t=arguments.callee.base.apply(this,arguments);return CW.Anim.isActive&&(this.update(),this.trigger("tick"),this.trigger("frame")),!e&&CW.Animator._hasSC&&SC.RunLoop.end(),t},finish:function(e,t){if(!this.running)return this;e||(this.allFreevarsDo("force"),t||(this.update(),this.trigger("tick"),this.trigger("frame")));var n=this.stop();return this.trigger("finish"),this.repeat>0&&(this.repeat--,this.reverseOnRepeat?this.reverse():this.reset(),this.start()),n},_finishNaturally:function(){this.finish(!0)},update:function(){},toString:function(){var e=arguments.callee.base.apply(this,arguments);return e=e.substring(0,e.length-1)+(this.name?" "+this.name:"")+(this.running?" running":"")+(this.fps?" fps="+this.fps:"")+(this.freevars||this.inertia?"":" "+this.from+"-to-"+this.to+" "+this.duration+"ms "+Math.round(this.progress*100)+"%")+"]",e},destroy:function(){var e=arguments.callee.base.apply(this,arguments);return this.update=this.run=this.finish=function(){},e},recycle:function(){this.tickCount=this.frameCount=this.elapsedTime=this._forcedZeroes=0}}),CW.Animation.defaultFreevar={tween:CW.Anim.tweens.WEBKIT_EASE,discreteness:0},CW.Animation._tweenFreevar=function(){var e=function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])};return e.prototype={from:0,to:1,duration:1e3,importants:undefined,isAlmostFinished:function(e){return Math
.abs(this.to-this.current)<e},reverse:function(){var e=this.to;return this.to=this.from,this.from=e,this.freevarRun(0),this},reset:function(){return this._untweenedCurrent=this.from,this.freevarRun(0),this},redirectTo:function(e){return this.from=this.current,this.to=e,this._untweenedCurrent=this.from,this.freevarRun(0),this},redirectFrom:function(e){return this.from=this._untweenedCurrent=e,this.freevarRun(0),this},zeroOutDuration:function(){return!this.duration||(this.duration=0),!this.speed||(this.speed=Infinity),this},force:function(e){return typeof e=="number"&&(this.to=e),this._untweenedCurrent=this.to,this.freevarRun(0),this},freevarRun:function(e){if(this.duration===0||this.speed===Infinity)this._untweenedCurrent=this.to;var t=this,n=t._untweenedCurrent<t.to,r=t.isFinished=t._untweenedCurrent===t.to,i=t.importants?t.importants[t._impSpot||0]||undefined:undefined,s=i!==undefined?t._untweenedCurrent<i:undefined,o,u;if(t.to===t.from)return t.current=t._untweenedCurrent=t.to,t.isFinished=!0;if(!r){u=t.speed||1e3/t.duration*Math.abs(t.to-t.from),o=Math.abs(u*e/1e3),n?t._untweenedCurrent+=o:t._untweenedCurrent-=o;if(s===!0&&t._untweenedCurrent>i||s===!1&&t._untweenedCurrent<i)t._untweenedCurrent=i,t._impSpot=(t._impSpot||0)+1;if(t.isFinished=n&&t._untweenedCurrent>=t.to||!n&&t._untweenedCurrent<=t.to)t._untweenedCurrent=t.to}return t.from!==undefined&&t.to!==undefined?(t.progress=(t._untweenedCurrent-t.from)/(t.to-t.from),t.tween instanceof Function&&t.from!=t.to&&(t.from===0&&t.to===1?t.current=t.tweenedProgress=t.tween.call(this,t._untweenedCurrent):t.current=(t.tweenedProgress=
t.tween.call(this,t.progress))*(t.to-t.from)+t.from)):t.current=t._untweenedCurrent,t.discreteness&&Math.abs(t.to/t.discreteness)%1<1e-8&&(t.current=Math.round(t.current/t.discreteness)*t.discreteness),t.isFinished}},e._freevarPrototype=e,e}(),CW.Animation._inertiaFreevar=function(){var e=function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])};return e.prototype={from:0,to:1,speed:1,inertia:3,headStart:.01,isAlmostFinished:function(e){return Math.abs(this.to-this.current)<e},reverse:function(){var e=this.to;return this.to=this.from,this.from=e,this},reset:function(){var e=this.to;return this.force(this.from),this.to=e,this},redirectTo:function(e){return this.from=this.current,this.to=e,this},redirectFrom:function(e){var t=e-this.current;this.from=e,this._undampedCurrent+=t;for(var n=0,r=this.inertiaChain.length;n<r;n++)this.inertiaChain[n]+=t;return this.freevarRun(0),this},zeroOutDuration:function(){return this.speed=Infinity,this},force:function(e){typeof e=="number"&&(this.to=e),this._undampedCurrent=this.current=this.to;for(var t=0,n=this.inertiaChain.length;t<n;t++)this.inertiaChain[t]=this.to;return this},freevarRun:function(e){this.speed===Infinity&&this.force();var t,n=this,r,i,s=n.speed,o=n.inertiaChain,u,a,f;for(t=0;t<n.inertia;t++){t===0?(r=n._undampedCurrent,i=n.to):t===1?(r=o[0],i=n._undampedCurrent):(r=o[t-1],i=o[t-2]);if(r===i)continue;u=r<i,a=e/1e3*s*Math.abs(i+n.headStart*(2*u-1)-r),u?r+=a:r-=a;if(f=u&&r>=i||!u&&r<=i)r=i;t===0?n._undampedCurrent=r:o[t-1]=r}return n.current=r,n.discreteness&&Math.abs(n.to/n.discreteness)%1<1e-8&&(n.current=Math.round(
n.current/n.discreteness)*n.discreteness),n.isFinished=n.to===n.current,n.progress=NaN,n.isFinished}},e._freevarPrototype=e,e}(),CW.Animation._signalFreevar=function(){var e=function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])};return e.prototype={speed:1,from:0,signal:function(e){return.5+.5*Math.sin(e*Math.PI*2)},persistent:!0,isAlmostFinished:function(e){return!this.persistent},reverse:function(){return this.speed=-this.speed,this},reset:function(){return this._unsignaledCurrent=this.from,this},redirectTo:function(){return this},force:function(){return this},advance:function(e){this._unsignaledCurrent+=e},zeroOutDuration:function(){return this},freevarRun:function(e){return this._unsignaledCurrent+=e/1e3*this.speed,this.current=this.signal(this._unsignaledCurrent),this.discreteness&&(this.current=Math.round(this.current/this.discreteness)*this.discreteness),this.isFinished=!this.persistent,this.progress=NaN,this.isFinished}},e._freevarPrototype=e,e}(),CW.Anim.Fader=CW.Fader=CW.Animation.extend({className:"CW.Fader",update:function(){CW.Anim.setOpacity(this.element,this.current)},init:function(){this.from===undefined&&(this._untweenedCurrent=this.from=CW.Anim.getOpacity(this.element)),arguments.callee.base.apply(this,arguments)},_removeOnFinish:function(){if(!this.REMOVE_ON_FINISH)return;this.element.parentNode&&this.element.parentNode.removeChild(this.element)}.listens("finish"),saveSelf:function(){var e=this.element._cwaFader;e&&e.stop(),this.element._cwaFader=this}.listens("start"),killSelf:function(){this.element._cwaFader=undefined}.listens("stop")}),CW.Anim
.DisplayNoneAtZero={isMixin:!0,setDisplayNone:function(){this.to===0&&(this.element.style.display="none")}.listens("finish"),removeDisplayNone:function(){this.element.style.display=""}.listens("start")},CW.Anim.ColorFader=CW.ColorFader=CW.Animation.extend({className:"CW.ColorFader",style:"color",init:function(){this.colorKey="_cwa"+this.style+"color",this.saveKey="_cwa"+this.style+"Fader";var e;if(this.sR===undefined||this.sG===undefined||this.sB===undefined)(e=CW.Anim.getStyle(this.element,this.style))?e=CW.Anim.decodeColor(e):e=this.element[this.colorKey]||(this.element[this.colorKey]=[0,0,0]),this.sR=e[0],this.sG=e[1],this.sB=e[2];arguments.callee.base.apply(this,arguments)},update:function(){if(!this.element||!this.style)return;var e=this.current,t=1-e,n,r,i,s=this.element[this.colorKey]||(this.element[this.colorKey]=[]);s[0]=n=this.tR*e+this.sR*t,s[1]=r=this.tG*e+this.sG*t,s[2]=i=this.tB*e+this.sB*t,this.element.style[this.style]=(this.cssBeforeColor||"")+CW.Anim.encodeColor(n,r,i)+(this.cssAfterColor||"")},saveSelf:function(){var e=this.element[this.saveKey];e&&e.stop(),this.element[this.saveKey]=this}.listens("start"),killSelf:function(){this.element[this.saveKey]=undefined}.listens("stop")}),CW.Anim.Mover=CW.Mover=CW.Animation.extend({className:"CW.Mover",getOmittedPositions:function(){var e,t,n,r;if(this.fromX===undefined||this.anchorX===undefined)n="left",e=parseInt(CW.Anim.getStyle(this.element,n),10),isNaN(e)&&(n="right",e=parseInt(CW.Anim.getStyle(this.element,n),10)),isNaN(e)&&(n="left"),this.anchorX!==undefined||(this.anchorX=n),this.fromX!==undefined||(this.fromX=
e);if(this.fromY===undefined||this.anchorY===undefined)r="top",t=parseInt(CW.Anim.getStyle(this.element,r),10),isNaN(t)&&(r="bottom",t=parseInt(CW.Anim.getStyle(this.element,r),10)),isNaN(t)&&(n="top"),this.anchorY!==undefined||(this.anchorY=r),this.fromY!==undefined||(this.fromY=t);if(isNaN(this.fromX)||isNaN(this.fromY))this.anchorX="left",this.anchorY="top",this.fromX=this.element.offsetLeft,this.fromY=this.element.offsetTop,this.element.style.position="absolute";this.toX===undefined&&(this.toX=this.fromX),this.toY===undefined&&(this.toY=this.fromY)}.listens("start"),update:function(){var e=this.element.style,t=this.current,n=1-t;e[this.anchorX]=Math.round(t*this.toX+n*this.fromX)+"px",e[this.anchorY]=Math.round(t*this.toY+n*this.fromY)+"px"}}),CW.Animatability={ENABLE_OLD_IE:YES,hasAnimatability:!0,mustKeepLayoutSync:YES,isAnimating:NO,isAnimatingInWindow:NO,isAnimatingWithParent:NO,recomputeIsAnimatingBooleans:function(){var e=this.get("isAnimatingInWindow"),t=!1,n=this,r=this._animCount>0,i;while(n=n.get("parentView"))if(n.hasAnimatability&&n.get("isAnimating")){t=!0;break}i=t||r,this.isAnimating!==r&&this.set("isAnimating",r),this.isAnimatingInWindow!==i&&this.set("isAnimatingInWindow",i),this.isAnimatingWithParent!==t&&this.set("isAnimatingWithParent",t),i!==e&&this._recomputeChildrenIsAnimatingBooleans()},_recomputeChildrenIsAnimatingBooleans:function(){for(var e=0,t=this.get("childViews"),n;n=t[e];e++)n.hasAnimatability?n.recomputeIsAnimatingBooleans():CW.Animatability._recomputeChildrenIsAnimatingBooleans.apply(n)},incrementAnimationCount:function(){this._animCount=
(this._animCount||0)+1,this.recomputeIsAnimatingBooleans()},decrementAnimationCount:function(){this._animCount=Math.max(this._animCount-1,0),this.recomputeIsAnimatingBooleans()},animateProperty:function(e,t,n){return this.animateProperties.apply(this,arguments)},animateProperties:function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L=SC.A(arguments),A=this._currentlyAnimatingProperties,O=this.get("mustKeepLayoutSync");if(o=typeof e=="string")(s={})[e]=t,e=s,t=L[2];if(!e){SC.warn("When using .animateProperties(, either a property name (string)or a hash, keyed by property name, full of destinations (or full freevar optionshashes) must be supplied as the first argument. Aborting the call.");return}e=SC.clone(e);if(t)for((n=o?2:1)&&(i=L.length)&&!(t=undefined);n<i;n++){if(typeof (N=L[n])!="object")continue;for(r in N)(t||(t={}))[r]=N[r]}t||(t=this.___emptyHash),typeof (u=t.duration)=="number"&&delete t.duration,(a=t.tween)&&delete t.tween,(f=t.speed)&&delete t.speed,(l=t.inertia)&&delete t.inertia,(c=t.headStart)&&delete t.headStart,(globalDiscreteness=t.discreteness)&&delete t.discreteness,m=!0;for(n in t){if(!t.hasOwnProperty(n))continue;y=t[n],b=typeof y;if(b==="object"||b==="function")m=!1;(g||(g=[])).push(n)}t.canReuse=m=m||t.canReuse,g&&(t.extraKeys=g);for(n in e){if(SC.none(h=e[n]))continue;p=(d=A[n])?((S||(S={}))[n]=d).removeProperty(n,!0):undefined,typeof h=="number"&&(h=e[n]={to:h}),h.from===undefined&&(h.isLayoutProperty?(p?h.from=p.current:h.from=(this._previousLayout||this.get("layout"))[n],typeof h.from!="number"&&(h.from=this._DEFAULT_LAYOUT_FROMS
[n]||0)):h.from=this.getPath(n)),typeof u=="number"&&h.duration===undefined&&h.inertia===undefined&&h.speed===undefined&&(h.duration=u),a&&h.tween===undefined&&h.inertia===undefined&&(h.tween=a),f&&h.speed===undefined&&h.duration===undefined&&h.tween===undefined&&(h.speed=f),l&&h.inertia===undefined&&h.tween===undefined&&(h.inertia=l),c&&h.headStart===undefined&&(h.headStart=c),globalDiscreteness&&h.discreteness===undefined&&(h.discreteness=globalDiscreteness),p&&p.inertia&&h.inertia===p.inertia&&(h.speed&&(p.speed=h.speed),h.headStart&&(p.headStart=h.headStart),p.from=h.from,p.to=h.to,h.discreteness!==undefined&&(p.discreteness=h.discreteness),e[n]=h=p),e[n].propertyName=n}E=0,T=0,C=!this.get("animateOldIE")&&SC.browser.msie&&SC.browser.msie<=8;for(n in e){if(!(h=e[n]))continue;C&&(!h.duration||(h.duration=0),!h.speed||(h.speed=Infinity)),(h.duration||0)>E&&(E=h.duration),O||this.adjust(h.propertyName,h.to),h.to===h.from?(O&&this.adjust(h.propertyName,h.to),delete e[n]):T++}if(T===0)m||(k=CW.Animation.create({view:this,duration:E||u||0},t).start());else if(m&&(w=this._bestMatchAnimationForProperties(e)||this._animationFromPool())){for(n in e)w.addProperty(e[n]);for(n in t)w[n]=t[n];k=w.start()}else{v={freevars:[],properties:[]};for(n in e)v.freevars.push(n),v.properties.push(n);v.view=this,w=CW.MultiPropertyAnimation.create(v,e,t);for(n in e)A[n]=w;k=w.start()}if(S){for(n in S){if(!S.hasOwnProperty(n))continue;x=S[n];if(x.__checked__)continue;x.__checked__=!0,x.stopIfNoProperties()}for(n in S){if(!S.hasOwnProperty(n))continue;S[n].__checked__=!1}}return k},_bestMatchAnimationForProperties
:function(e){var t,n,r,i,s,o,u=this._currentlyAnimatingProperties;for(t in u){if(!(i=u[t])||i.___matchCheck)continue;i.___matchCheck=!0,r=i.properties.length,s=0;for(n=0;n<r;n++)s+=e[i.properties[n]]?2:1;i.___matchCount=s}s=0;for(t in u){if(!(i=u[t])||!i.matchCheck)continue;i.___matchCheck=undefined,i.___matchCount>s&&(s=i.___matchCount,o=i),i.___matchCount=undefined}return o||this._animationFromPool()},_propertyAnimPool:null,_addAnimationToPool:function(e){if(!e)return;var t=this._propertyAnimPool;for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return;t.push(e)},_animationFromPool:function(){var e=this._propertyAnimPool,t=e.length,n=e[t-1];return n&&(e.length=t-1),n},animate:function(e,t){var n,r,i,s,o,u,a,f=SC.A(arguments);if(u=typeof e=="string")(n={})[e]=t,e=n,t=f[2];if(!e){SC.warn("When using .animate(, either a property name (string)or a hash, keyed by property name, full of destinations (or full freevar optionshashes) must be supplied as the first argument. Aborting the call.");return}e=SC.clone(e);if(t)for((i=u?2:1)&&(s=f.length)&&!(t=undefined);i<s;i++){if(typeof (a=f[i])!="object")continue;for(r in a)(t||(t={}))[r]=a[r]}typeof (n=e.duration)=="number"&&((t||(t={})).duration=n,delete e.duration);if(n=e.tween)(t||(t={})).tween=n,delete e.tween;if(n=e.speed)(t||(t={})).speed=n,delete e.speed;if(n=e.inertia)(t||(t={})).inertia=n,delete e.inertia;if(n=e.headStart)(t||(t={})).headStart=n,delete e.headStart;t||(t=this.___emptyHash);for(i in e)o=e[i],typeof o=="number"&&(o=e[i]={to:o}),o.isLayoutProperty=!0;return this.animateProperties(e,t)},adjust:function(e){return SC.View.prototype
.adjust.apply(this,arguments)},stopAnimation:function(){this._forSaidPropertyAnimationsDo("removeProperty",arguments)},finishAnimation:function(){this._forSaidPropertyAnimationsDo("finishProperty",arguments)},updateToAnimation:function(){this._forSaidPropertyAnimationsDo("updateToProperty",arguments)},_forSaidPropertyAnimationsDo:function(e,t){var n=this._currentlyAnimatingProperties;if(!e||!n)return;var r=this.___keysForDoAll||(this.___keysForDoAll=[]),i=t[0],s,o,u,a;r.length=0,i||(i=n);if(i instanceof Array){o=i.length;for(s=0;s<o;s++)r[s]=i[s]}else if(typeof i=="object")for(s in i)i.hasOwnProperty(s)&&i[s]!==undefined&&r.push(s);else if(typeof i=="string"){o=t.length;for(s=0;s<o;s++)r[s]=t[s]}o=r.length;for(s=0;s<o;s++){a=n[u=r[s]];if(!a)continue;a[e](u)}},_canAvoidAdjust:function(){return this.get("mustKeepLayoutSync")?!1:!0},_quickAdjust:function(e,t){if(!this._isQuickAdjusting)return this.adjust.apply(this,arguments)},_isQuickAdjusting:!1,_quickAdjustment:null,_beginQuickAdjustment:function(){this._isQuickAdjusting=!0;var e=this._quickAdjustment||(this._quickAdjustment={}),t=this._previousLayout||this.get("layout");for(var n in e)t.hasOwnProperty(n)||delete e[n];for(n in t)e[n]=t[n]},_commitQuickAdjustment:function(){this._isQuickAdjusting=!1},_renderQuickAdjustment:function(){},_currentlyAnimatingProperties:null,___emptyHash:{},initMixin:function(){this._currentlyAnimatingProperties={},this._propertyAnimPool=[],this.hasOwnProperty("animateOldIE")||this.set("animateOldIE",CW.Animatability.ENABLE_OLD_IE)},_DEFAULT_LAYOUT_FROMS:{opacity:1,scale:1},discreteForOutsideUnitInterval
:{left:YES,top:YES,width:YES,height:YES,right:YES,bottom:YES,centerX:YES,centerY:YES}},CW.MultiPropertyAnimation=CW.Animation.extend({view:null,properties:null,ticked:SC.platform.touch?5:0,stopIfNoProperties:function(){this.properties.length===0&&this.stop()},finishProperty:function(e,t){var n=this.freevarForProperty(e);if(!n)return;n.force(),t||this.update(),this.removeProperty(e)},removeProperty:function(e,t){for(var n=0,r;r=this.properties[n];n++)r===e&&(this.properties.splice(n,1),n--);this.view._currentlyAnimatingProperties[e]=undefined,t||this.stopIfNoProperties();var i=this.removeFreevar(this.freevarForProperty(e));return i},addProperty:function(e){var t;if(!e||!(t=e.propertyName))return;e.key=e.propertyName;for(var n=0,r;r=this.properties[n];n++)r===t&&(this.removeProperty(t,!0),n--);this.properties.push(t),this.view._currentlyAnimatingProperties[t]=this,this.addFreevar(e)},updateToProperty:function(e){var t=CW.Animatability.discreteForOutsideUnitInterval,n=e,r=this.view;r._updatingAnimatedProperty=!0,typeof n=="string"&&(n=this.freevarForProperty(n)),e=n.propertyName,n.isLayoutProperty?(n.discreteness||(n.discreteness=t[e]&&(n.to>1||n.from>1||n.to<0||n.from<0)?1:1e-6),r.get("mustKeepLayoutSync")?r.adjust(e,n.current):r.$().css(e,n.current)):this.view[e]!==n.current&&r.set(e,n.current),r._updatingAnimatedProperty=!1},freevarForProperty:function(e){return this[e]},update:function(){for(var e=0,t,n;t=this.freevars[e];e++)this.updateToProperty(t)},releaseProperties:function(){for(var e=0,t;t=this.properties[e];e++)this.view._currentlyAnimatingProperties[t]=undefined}.listens
("stop"),poolAnimation:function(){if(!this.canReuse)return;while(this.properties.length)this.removeProperty(this.properties[0],!0);this.properties.length=0;if(this.extraKeys){for(var e in this.extraKeys)delete this[e];delete this.extraKeys}this.recycle(),this.view._addAnimationToPool(this)}.listens("stop"),markView:function(){this.view.incrementAnimationCount()}.listens("start"),unmarkView:function(){this.view.decrementAnimationCount()}.listens("stop")}),CW.PaneAnimationSupport={hasPaneAnimationSupport:YES,hiddenState:{opacity:0},showingState:{opacity:1},duration:350,showDuration:null,hideDuration:null,tween:CW.Anim.tweens.WEBKIT_EASE,showTween:null,hideTween:null,firstShowDelay:0,hideDelay:0,append:function(e){(!this.hasSpritePreloadEnforcement||this._hasShownFromDidCreateLayer)&&this.animateShow(),e()}.enhance(),animateShow:function(){if(SC.browser.isIE8OrLower){this.paneWillShow(),this.paneDidShow();return}this._hideAnim&&this._hideAnim.finish(),this._showAnim&&this._showAnim.finish(),this._showTimer&&(this._showTimer.invalidate(),this._showTimer=null),this._hideTimer&&(this._hideTimer.invalidate(),this._hideTimer=null),this._animatingShow=YES,this.paneWillShow(),this.invokeLast(function(){this._animatingShow=YES,this.adjust(this.get("hiddenState"));var e=this.get("showDuration"),t=[this.get("showingState"),{duration:typeof e=="number"?e:this.get("duration"),tween:this.get("showTween")||this.get("tween"),notifyFrame:function(){this.view.didFrame(this),this.view.showDidFrame(this)}.listens("frame"),completed:function(){this.view._showAnim=null,this.view.paneDidShow(this)}.
listens("finish")}];!this._hasAppendedOnce&&this.get("firstShowDelay")!==0?(this._showTimer=this._delayedFirstShowTimer=this.invokeLater(function(){this._showTimer=this._delayedFirstShowTimer=null,this._showAnim=this.animate.apply(this,t)},this.get("firstShowDelay")),this._hasAppendedOnce=YES):this._showTimer=this.invokeLast(function(){this._showTimer=null,this._showAnim=this.animate.apply(this,t)}),this._animatingShow=NO}),this._animatingShow=NO},remove:function(e){if(SC.browser.isIE8OrLower){this.paneWillHide(),e(),this.paneDidHide();return}var t;this.get("isPanelPane")&&this._isShowingModal&&(this._isShowingModal=NO,(t=this._modalPane())&&t.paneDidRemove(this)),this._hideAnim&&this._hideAnim.finish(),this._showAnim&&this._showAnim.finish(),this._showTimer&&(this._showTimer.invalidate(),this._showTimer=null),this._hideTimer&&(this._hideTimer.invalidate(),this._hideTimer=null),this._animatingHide=YES,this.paneWillHide(),this.invokeLast(function(){this._animatingHide=YES;var t=this.get("hideDuration"),n=[this.get("hiddenState"),{duration:typeof t=="number"?t:this.get("duration"),tween:this.get("hideTween")||this.get("tween"),notifyFrame:function(){this.view.didFrame(this),this.view.hideDidFrame(this)}.listens("frame"),enableClickThrough:function(){this.view.$().css("pointerEvents","none")}.listens("start"),removeClickThrough:function(){this.view.$().css("pointerEvents","auto")}.listens("stop"),completed:function(){this.view._hideAnim=null,e(),this.view.paneDidHide(this)}.listens("finish")}];this.get("hideDelay")!==0?this._hideTimer=this.invokeLater(function(){this._hideTimer=
null,this._hideAnim=this.animate.apply(this,n)},this.get("hideDelay")):this._hideTimer=this.invokeLast(function(){this._hideTimer=null,this._hideAnim=this.animate.apply(this,n)}),this._animatingHide=NO}),this._animatingHide=NO}.enhance(),didFrame:function(e){},showDidFrame:function(e){},hideDidFrame:function(e){},paneDidHide:function(e){},paneWillHide:function(){},paneDidShow:function(e){},paneWillShow:function(){}},CW.PaneFadingSupport=SC.clone(CW.PaneAnimationSupport),SC.mixin(CW.PaneFadingSupport,{paneFadeInDuration:100,paneFadeOutDuration:350,showDuration:function(){return this.get("paneFadeInDuration")}.property("paneFadeInDuration").cacheable(),hideDuration:function(){return this.get("paneFadeOutDuration")}.property("paneFadeOutDuration").cacheable(),showingState:function(){return{opacity:this.get("paneOpacity")||1}}.property("paneOpacity").cacheable(),paneDidHide:function(){return this.paneDidFadeOut()},paneDidFadeOut:function(){}}),SC.stringsFor("en-us",{monthHeading:"%@1 %@2",year:"%@",Month:"Month",January:"January",February:"February",March:"March",April:"April",May:"May",June:"June",July:"July",August:"August",September:"September",October:"October",November:"November",December:"December",Jan:"Jan",Feb:"Feb",Mar:"Mar",Apr:"Apr",Jun:"Jun",Jul:"Jul",Aug:"Aug",Sep:"Sep",Oct:"Oct",Nov:"Nov",Dec:"Dec",Sunday:"Sunday",Monday:"Monday",Tuesday:"Tuesday",Wednesday:"Wednesday",Thursday:"Thursday",Friday:"Friday",Saturday:"Saturday",Sun:"Sun",Mon:"Mon",Tue:"Tue",Wed:"Wed",Thu:"Thu",Fri:"Fri",Sat:"Sat",Yesterday:"Yesterday",Today:"Today",Tomorrow:"Tomorrow",Midnight:"Midnight"
,Now:"Now",Noon:"Noon",Next:"Next",Last:"Last",English:"English",French:"French",German:"German",Japanese:"Japanese","Button.OK":"OK","Button.Cancel":"Cancel","Button.Reload":"Reload","Button.Save":"Save","Button.Accept":"Accept","Button.Decline":"Decline","Button.Maybe":"Maybe","Button.TryAgain":"Try Again","Status.Loading":"Loading…","Status.Sharing":"Sharing…","Toolbar.Message.Actions":"Actions","Dialog.Error.Details":"Details","Color.Picker.Custom.Color":"Custom color…","CW.DropTarget.SafariWindowsNotSupported.Title":"Drag and drop not supported.","CW.DropTarget.SafariWindowsNotSupported.Description":"Drag and drop of files into this browser is not currently supported."}),CW.CANVAS_BUTTON_HEIGHT=26,CW.TOOLBAR_BUTTON_HEIGHT=26,CW.SQUARE_BUTTON_REGULAR_HEIGHT=27,CW.IOS_BUTTON_REGULAR_HEIGHT=30,CW.IOSMINI_BUTTON_REGULAR_HEIGHT=24,CW.IOSBIG_BUTTON_REGULAR_HEIGHT=46,CW.SELECT_BUTTON_REGULAR_HEIGHT=27,CW.POPUP_BUTTON_REGULAR_HEIGHT=27,CW.SQUARE_BUTTON_REGULAR_MIN_WIDTH=68,CW.SQUARE_BUTTON_SMALL_MIN_WIDTH=56,CW.SQUARE_BUTTON_TINY_MIN_WIDTH=52,CW.HELP_BUTTON_REGULAR_MIN_WIDTH=26,CW.HELP_BUTTON_SMALL_MIN_WIDTH=22,CW.HELP_BUTTON_TINY_MIN_WIDTH=18,CW.CHECKBOX_REGULAR_HEIGHT=18,CW.PROGRESS_REGULAR_HEIGHT=20,CW.PROGRESS_CAPSULE_HEIGHT=19,CW.PROGRESS_CAPSULE_ANIMATED_BACKGROUND_MATRIX=[171,19,31],CW.PROGRESS_REGULAR_OFFSETRANGE=32,CW.PROGRESS_CAPSULE_OFFSETRANGE=20,CW.TEXT_FIELD_TINY_HEIGHT=18,CW.TEXT_FIELD_SMALL_HEIGHT=22,CW.TEXT_FIELD_REGULAR_HEIGHT=26,CW.TEXT_FIELD_LARGE_HEIGHT=30,CW.TEXT_FIELD_LARGE_TALL_HEIGHT=31,CW.TEXT_FIELD_HUGE_HEIGHT=31,CW.SLIDER_REGULAR_HEIGHT=25,CW.DOCK_HEIGHT=46
,CW.SOURCE_LIST_WIDTH=171,CW.TINY_CONTROL_SIZE=SC.TINY_CONTROL_SIZE,CW.SMALL_CONTROL_SIZE=SC.SMALL_CONTROL_SIZE,CW.REGULAR_CONTROL_SIZE=SC.REGULAR_CONTROL_SIZE,CW.LARGE_CONTROL_SIZE=SC.LARGE_CONTROL_SIZE,CW.LARGE_TALL_CONTROL_SIZE="me-large-tall-size",CW.XLARGE_CONTROL_SIZE=SC.HUGE_CONTROL_SIZE,CW.DropTarget={isDropTarget:YES,acceptsFileDrags:YES,dragStarted:function(e,t){},dragEntered:function(e,t){},dragUpdated:function(e,t){},dragExited:function(e,t){},dragEnded:function(e,t){},computeDragOperations:function(e,t){return SC.DRAG_NONE},acceptDragOperation:function(e,t){return YES},performDragOperation:function(e,t){return SC.DRAG_NONE},_isCurrentlyHovered:NO,renderMixin:function(e,t){t&&SC.browser.isWebkit&&this.get("acceptsFileDrags")&&e.push('<div class="cw-drop-target-container"><input class="cw-drop-target-file" type="file" multiple="multiple"></div>')},didCreateLayer:function(e){e();if(!this.get("acceptsFileDrags"))return;var t=this.$().children(".cw-drop-target-container").children()[0]||null;if(SC.browser.isWebkit&&t)SC.Event.add(t,"change",this,this._handleDrop);else if(SC.browser.mozilla){var n=this.get("layer");SC.Event.add(n,"drop",this,this._handleDrop)}}.enhance(),_changeFileElementClickability:function(e){if(SC.browser.isWebkit&&this.get("acceptsFileDrags")){var t=this.$().children(".cw-drop-target-container").children()[0]||null,n=e?"block":"none";t&&n!==t.style.display&&(t.style.display=n)}},_handleDragEnter:function(e){if(CW.DropTarget.dealWithSafariWindows())return;if(SC.browser.isWebkit&&!(e&&e.target&&e.target.className&&e.target.className.indexOf&&e.target
.className.indexOf("cw-drop-target-file")>-1)){this._isCurrentlyHovered=YES;return}var t=e.dragOperation;this._isFileEvent(e)&&this._changeFileElementClickability(YES),this.computeDragOperations(t,e)&SC.DRAG_DATA&&(this.dragEntered(t,e),this._isCurrentlyHovered=YES)},_handleDragOver:function(e){var t=e.dragOperation;this._isFileEvent(e)&&this._changeFileElementClickability(YES);if(CW.DropTarget.dealWithSafariWindows())return;this.computeDragOperations(t,e)&SC.DRAG_DATA&&(this._isCurrentlyHovered?this.dragUpdated(t,e):(this.dragEntered(t,e),this._isCurrentlyHovered=YES))},_handleDrop:function(e){var t=e.dragOperation;t||(t=this._dragOperationForEvent(e)),this._changeFileElementClickability(NO);if(CW.DropTarget.dealWithSafariWindows())return;if(this.acceptDragOperation(t,SC.DRAG_DATA)){var n=e.dataTransfer.files;if(n&&n.length>0){t.data=n;for(var r=0,i=n.length;r<i;++r){var s=n[r];SC.none(s.fileName)&&s.name&&(s.fileName=s.name)}}this.performDragOperation(t,SC.DRAG_DATA)}},_handleDragExit:function(e){if(SC.browser.isWebkit&&!(e&&e.target&&e.target.className&&e.target.className.indexOf&&e.target.className.indexOf("cw-drop-target-file")>-1))return;var t=e.dragOperation,n=e.originalEvent.target;n.type&&n.type==="file"&&this._changeFileElementClickability(NO);if(CW.DropTarget.dealWithSafariWindows())return;this.dragExited(t,e)},_isFileEvent:function(e){var t=e.dataTransfer;if(t){var n=t.types;if(SC.none(n))return YES;for(var r=0,i=n.length;r<i;++r){var s=n[r];if(s==="text/uri-list"&&SC.browser.isMozilla)return NO;if(s==="Files")return YES}}return NO},_notifyTargetViewsOfEvent:function(
e,t){var n=SC.RootResponder.responder,r=n.targetViewForEvent(t);return this._isFileEvent(t)?(t.stopPropagation(),t.preventDefault()):t.allowDefault(),SC.browser.isWindows&&SC.browser.isSafari?NO:(t.dragOperation=this._dragOperationForEvent(t,r),n.sendEvent(e,t,r))},_dragOperation:null,_dragOperationForEvent:function(e,t){var n=CW.DropTarget._dragOperation;if(n)return n;var r=SC.Drag.start({event:e,source:t,ghost:NO,slideBack:NO,sourceIsDraggable:NO});return CW.DropTarget._dragOperation=r,r},_dragEndedOnDropTargets:function(e,t){if(CW.DropTarget.dealWithSafariWindows())return;t=e.dragOperation||t;if(!t)return;var n=t._dropTargets();for(var r=0,i=n.length;r<i;r++){var s=n[r];s.tryToPerform("dragEnded",this,e);if(s&&s.get("acceptsFileDrags")){s._isCurrentlyHovered=NO,s._changeFileElementClickability(NO);if(SC.browser.isWebkit&&s.isVisibleInWindow){var o=s.$().children(".cw-drop-target-container").children()[0]||null;o&&(o.value=null)}}}CW.DropTarget._dragOperation=null}},SC.RootResponder.reopen({init:function(e){e(),SC.browser.isIE9OrLower||this.listenFor("dragenter dragover dragleave drop".w(),document,null,!0)}.enhance(),_dropTargetViewForEvent:function(e){var t=this.targetViewForEvent(e),n=CW.DropTarget._isFileEvent(e);while(YES){if(SC.none(t))return t;if(t.isDropTarget&&(!n||t.get("acceptsFileDrags")))return t;t=t.get("parentView")}},dragenter:function(e){this.set("_lastDragEnterTarget",e.target),this._setupDragOverTimer(e);if(SC.browser.isMozilla||SC.browser.msie&&!SC.browser.isIE9OrLower){var t=this._lastEvent;this._lastEvent=e;if(t){if(this._dropTargetViewForEvent(e)===this
._dropTargetViewForEvent(t))return;CW.DropTarget._notifyTargetViewsOfEvent("_handleDragExit",t)}else CW.DropTarget._notifyTargetViewsOfEvent("_handleDragEnter",e)}else CW.DropTarget._notifyTargetViewsOfEvent("_handleDragEnter",e)},_setupDragOverTimer:function(e){var t=this.get("_dragOverTimer");this.set("_lastDragOverEvent",e),t&&t.invalidate(),t=SC.Timer.schedule({target:this,action:function(){var e=this.get("_lastDragOverEvent");e&&(this._lastEvent=undefined,CW.DropTarget._dragEndedOnDropTargets(e))},interval:500,repeats:NO}),this.set("_dragOverTimer",t)},dragover:function(e){this._setupDragOverTimer(e),CW.DropTarget._notifyTargetViewsOfEvent("_handleDragOver",e)},dragleave:function(e){if(SC.browser.isMozilla||SC.browser.msie&&!SC.browser.isIE9OrLower){var t=this._lastEvent;this._lastEvent=e;if(t){if(this._dropTargetViewForEvent(t)===this._dropTargetViewForEvent(e))return;CW.DropTarget._notifyTargetViewsOfEvent("_handleDragEnter",t)}else CW.DropTarget._notifyTargetViewsOfEvent("_handleDragExit",e)}else CW.DropTarget._notifyTargetViewsOfEvent("_handleDragExit",e)},drop:function(e){if(CW.DropTarget.eliminateDoubleDrops){if(CW.DropTarget._droppedRecently)return;CW.DropTarget._droppedRecently=YES,setTimeout(function(){CW.DropTarget._droppedRecently=undefined},1e3)}var t=CW.DropTarget._notifyTargetViewsOfEvent("_handleDrop",e);t||CW.DropTarget._dragEndedOnDropTargets(e)}}),CW.DropTarget.dealWithSafariWindows=function(){return SC.browser.isWindows&&SC.browser.isSafari?(CW.Alert.show({message:"CW.DropTarget.SafariWindowsNotSupported.Title".loc(),description:"CW.DropTarget.SafariWindowsNotSupported.Description"
.loc()}),YES):NO},CW.Alert=SC.PanelPane.extend({message:"",classNameBindings:["readyToShow:animate-show","notReadyToShow:before-animate-show","isCompact:compact"],readyToShow:YES,notReadyToShow:function(){return!this.get("readyToShow")}.property("readyToShow").cacheable(),messageViewPaddingBottom:7,description:null,descriptionViewPadding:{top:0,bottom:4},descriptionViewMinHeight:9,caption:null,captionViewPadding:{top:4,bottom:7},captionViewMinHeight:0,image:"icon-icloud",rightButton:"OK",middleButton:null,leftButton:null,extraView:null,extraViewPadding:{top:12,bottom:3},extraViewMinHeight:0,escapeHTML:NO,layout:{centerX:0,width:450,centerY:-10,height:181},isCompact:NO,originalLayout:null,classNames:["cw-alert"],ariaRole:"alertdialog",init:function(){this.get("pane").set("readyToShow",NO),this.get("extraWide")&&this.adjust("width",500),arguments.callee.base.apply(this,arguments)},modalPane:SC.ModalPane.extend(CW.Animatability,CW.PaneFadingSupport,{classNames:"cw-modal".w(),paneFadeInDuration:350,paneFadeOutDuration:function(){return this.get("paneFadeInDuration")}.property(),paneOpacity:1,init:function(){arguments.callee.base.apply(this,arguments);var e=SC.RootResponder.responder.mainPane;if(e){var t=e.layout.minWidth,n=e.layout.minHeight;t&&this.adjust("minWidth",t),n&&this.adjust("minHeight",n)}}}),contentView:SC.View.design({layout:{left:0,right:0,top:0,bottom:0},escapeHTMLBinding:"*parentView.escapeHTML",separatorView:SC.View.design({layout:{height:1,right:0,left:0,bottom:52},classNames:["separator"]}),createChildViews:function(){SC.Binding.flushPendingChanges();var e=this
.get("escapeHTML"),t=this.get("pane"),n=t.get("message"),r=t.get("description"),i=t.get("caption"),s=t.get("image"),o=t.get("extraView"),u=t.get("rightButton"),a=t.get("middleButton"),f=t.get("leftButton"),l=t.get("isCompact"),c=this.childViews,h=CW.Alert,p="Trying to create a CW.Alert with a %@ button that is neither a string, nor a button view.",d,v,m,g,y,b,w;return s&&(SC.typeOf(s)===SC.T_STRING?this.iconView=h.IconView.extend({classNames:s.w()}):s.value?this.iconView=h.IconView.extend({classNames:s.value.w()}):CW.fatalError("Trying to create a CW.Alert with improper an invalid image hash."),c.push("iconView")),n||CW.fatalError("Trying to create a CW.Alert without a message."),this.messageView=h.MessageView.extend({value:n,escapeHTML:e}),c.push("messageView"),r&&(this.descriptionView=h.DescriptionView.extend({value:r,escapeHTML:e}),c.push("descriptionView")),i&&(this.captionView=h.CaptionView.extend({value:i,escapeHTML:e}),c.push("captionView")),o&&(this.extraView=o,c.push("extraView")),f&&(SC.typeOf(f)===SC.T_STRING?d={title:f,action:"remove",target:t}:SC.typeOf(f)===SC.T_HASH?d=f:CW.fatalError(p.fmt("left")),this.leftButtonView=h.LeftButtonView.extend(d),c.push("separatorView"),c.push("leftButtonView")),a&&(SC.typeOf(a)===SC.T_STRING?(v=a,m="remove",g=t):SC.typeOf(a)===SC.T_HASH?(v=a.title?a.title:"Cancel",m=a.action?a.action:null,g=a.target?a.target:t):CW.fatalError(p.fmt("middle"))),u||CW.fatalError("Trying to create a CW.Alert without a right button."),SC.typeOf(u)===SC.T_STRING?(y=u,b="remove",w=t):SC.typeOf(u)===SC.T_HASH?(y=u.title?u.title:"OK",b=u.action?u.action
:null,w=u.target?u.target:t):CW.fatalError(p.fmt("right")),this.mainButtonsView=h.MainButtonsView.extend({middleButtonIsVisible:a?YES:NO,middleButtonTitle:v,middleButtonAction:m,middleButtonTarget:g,rightButtonTitle:y,rightButtonAction:b,rightButtonTarget:w}),c.push("mainButtonsView"),arguments.callee.base.apply(this,arguments)},extraViewFrameDidChange:function(){if(this._resizingExtraView){this._resizingExtraView=NO;return}this.performLayout()},didCreateLayer:function(){var e=this.get("pane"),t=this.get("extraView");t&&t.isAutoResizingExtraView&&t.addObserver("frame",this,this.extraViewFrameDidChange);var n=this;requestAnimationFrame(function(){SC.run(function(){n.performLayout()})})},performLayout:function(){var e=this.get("pane"),t=this.messageView,n=this.descriptionView,r=e.get("descriptionViewMinHeight")||0,i=this.captionView,s=e.get("captionViewMinHeight")||0,o=this.extraView,u=e.get("extraViewMinHeight")||0,a=this.iconView,f=e.get("image"),l=t.getPath("layout.top"),c=e.get("isCompact"),h=c?25:106,p=this.mainButtonsView,d=CW.Alert,v=d.MIN_ALERT_HEIGHT,m=e.getPath("layout.maxHeight"),g,y,b,w=0,E,S,x,T,N,C,k,L,A,O=SC.Locale.getPath("currentLocale.isRTL")?"right":"left";a&&a.set("isVisible",c?NO:YES),t&&t.adjust(O,h),n&&n.adjust(O,h),i&&i.adjust(O,h),o&&o.adjust(O,h),e.set("ariaLabelledBy",SC.guidFor(t)),e.set("ariaDescribedBy",SC.guidFor(n)),g=t.get("value"),y=t.get("layer"),S=t.get("frame").width+"px",y.style.maxWidth=S,b=SC.metricsForString(g,y,null,!this.get("escapeHTML")).height,t.adjust("height",b),l+=b,A=e.get("messageViewPaddingBottom"),A&&(l+=A),n?(k=e.get("descriptionViewPadding"
),k&&(L=k.top)&&(l+=L),n.adjust("top",l),g=n.get("value"),y=n.get("layer"),y.style.maxWidth=S,b=SC.metricsForString(g,y,null,!this.get("escapeHTML")).height,b<r&&(b=r),n.adjust("height",b),l+=b,k&&(A=k.bottom)&&(l+=A)):l+=r,i?(k=i.get("padding"),k&&(L=k.top)&&(l+=L),i.adjust("top",l),g=i.get("value"),y=i.get("layer"),y.style.maxWidth=S,b=SC.metricsForString(g,y,null,!this.get("escapeHTML")).height,b<s&&(b=s),i.adjust("height",b),l+=b,k&&(A=k.bottom)&&(l+=A)):l+=s,o?(this._resizingExtraView=YES,k=e.get("extraViewPadding"),k&&(L=k.top)&&(l+=L),o.adjust("top",l),b=undefined,o.isAutoResizingExtraView&&(b=o.computeHeight()),SC.none(b)&&(b=o.get("frame").height),SC.none(b)&&CW.fatalError("Trying to create a CW.Alert with an extraView which does not have its height specified."),b<u&&(b=u),l+=b,k&&(A=k.bottom)&&(l+=A)):l+=u;if(a){var w=f.width,b=f.height;w&&b&&(a.adjust("width",w),a.adjust("height",b))}l+=c?d.BUTTONS_AND_SEPARATOR_COMPACT_HEIGHT:d.BUTTONS_AND_SEPARATOR_HEIGHT,l<v&&(l=v),l>m&&(l=m),x=p.middleButton,T=p.rightButton,this.leftButtonView&&(C=this.leftButtonView.get("frame"),C&&(w=C.width)),x&&(C=x.get("frame"),C&&(w+=C.width)),T&&(C=T.get("frame"),C&&(w+=C.width)),e.adjust("height",l),N=d.BUTTONS_REGULAR_PADDING+d.BUTTONS_MIN_PADDING_MIDDLE_AND_LEFT+d.BUTTONS_SIDE_PADDING*2,w+N>e.get("frame").width&&!c&&(e.adjust("width",w+N),this.performLayout()),this._resizingExtraView=NO,e.set("readyToShow",YES);var M=this.$(".def");M&&M.length&&setTimeout(function(){M[0].focus()},500)},isAlertCompactChanged:function(){this.get("isVisibleInWindow")&&this.performLayout()}.observes("pane.isCompact"
)})}),CW.Alert.BUTTONS_REGULAR_PADDING=8,CW.Alert.BUTTONS_MIN_PADDING_MIDDLE_AND_LEFT=15,CW.Alert.BUTTONS_SIDE_PADDING=20,CW.Alert.BUTTONS_AND_SEPARATOR_HEIGHT=70,CW.Alert.BUTTONS_AND_SEPARATOR_COMPACT_HEIGHT=60,CW.Alert.MIN_ALERT_HEIGHT=112,CW.Alert.MessageView=SC.LabelView.extend(SC.RTLSupport,{layoutRecipe:{top:25,start:106,end:25},classNames:["title-label"],controlSize:SC.LARGE_CONTROL_SIZE,ariaRole:"heading"}),CW.Alert.DescriptionView=SC.LabelView.extend(SC.RTLSupport,{layoutRecipe:{start:106,end:25},classNames:["description"]}),CW.Alert.CaptionView=SC.LabelView.extend(SC.RTLSupport,{layoutRecipe:{start:106,end:25},classNames:["caption"]}),CW.Alert.IconView=SC.View.extend(SC.RTLSupport,{layoutRecipe:{top:19,width:68,height:68,start:25},classNames:["cw-alert-image-view"]}),CW.Alert.MainButtonsView=SC.View.extend(SC.RTLSupport,{layoutRecipe:{height:44,bottom:4,start:0,end:0},classNames:["main-buttons"],childViews:["middleButton","rightButton"],middleButtonIsVisible:YES,middleButtonTitle:"Cancel",middleButtonAction:null,middleButtonTarget:null,rightButtonTitle:"Ok",rightButtonAction:null,rightButtonTarget:null,init:function(e){e(),this.middleButton.set("title",this.middleButtonTitle),this.middleButton.set("isVisible",this.middleButtonIsVisible),this.middleButton.set("action",this.middleButtonAction),this.middleButton.set("target",this.middleButtonTarget),this.rightButton.set("title",this.rightButtonTitle),this.rightButton.set("action",this.rightButtonAction),this.rightButton.set("target",this.rightButtonTarget)}.enhance(),middleButton:SC.ButtonView.extend(SC.RTLSupport,{isCancel
:YES,themeName:"borderless",classNames:["middle-button","button-in-between"],useStaticLayout:YES,layoutRecipe:{top:0,width:"auto",bottom:0,start:0}}),rightButton:SC.ButtonView.extend(SC.RTLSupport,{isDefault:YES,themeName:"borderless",classNames:["right-button"],useStaticLayout:YES,layoutRecipe:{top:0,width:"auto",bottom:0,start:0},render:function(e){return e.attr("tabindex","0"),arguments.callee.base.apply(this,arguments)}})}),CW.Alert.LeftButtonView=SC.ButtonView.extend(SC.RTLSupport,{useStaticLayout:YES,title:"Other...",themeName:"borderless",classNames:["left-button"],layoutRecipe:{height:44,bottom:4,width:"auto",start:0}}),CW.Alert.ExtraViewAutoResizingSupport={isAutoResizingExtraView:YES,computeHeight:function(){var e=this.get("autoResizeLayer")||this.get("layer"),t=this.getPath("frame.width"),n=this.get("autoResizeText")||"",r=this.get("autoResizePadding")||0,i;return SC.none(e)||SC.empty(n)?0:(e.style.maxWidth=t+"px",i=SC.metricsForString(n,e,this.get("classNames"),!this.get("escapeHTML")),i.height+r)}},CW.Alert.show=function(e){if(SC.typeOf(e)===SC.T_HASH){var t=this.create(e);return t.append(),t}return CW.fatalError("Attempted to show a CW.Alert without options."),null},CW.AlertPaneListItemView=SC.View.extend(SC.Control,SC.StaticLayout,{useStaticLayout:YES,layout:{height:45},childViews:["message","label"],message:SC.LabelView.design(SC.StaticLayout,{useStaticLayout:YES,layout:{top:8,height:"auto"},escapeHTML:NO,controlSize:SC.TINY_CONTROL_SIZE,classNames:["message"],valueBinding:"*owner.content.message"}),label:SC.LabelView.design(SC.StaticLayout,{useStaticLayout:YES
,controlSize:SC.TINY_CONTROL_SIZE,classNames:["label"],layout:{top:10,height:"auto"},valueBinding:"*owner.content.label"})}),CW.AlertPaneDetailView=SC.StackedView.extend({layout:{left:0,top:0,right:0,bottom:0},isSelectable:NO,classNames:"alert-pane-list".w(),exampleView:CW.AlertPaneListItemView,contentBinding:"*parentView.owner.pane.alertDetails"}),CW.ErrorPicker=SC.PickerPane.extend({layout:{left:0,top:0,height:20,right:0,minWidth:36},classNames:["error-picker"],errorText:"Please fill in required info",escapeHTML:YES,pointerOffset:[10,20,-17,19],preferType:SC.PICKER_POINTER,acceptsKeyPane:NO,acceptsFirstResponder:NO,isModal:NO,contentView:SC.LabelView.extend(SC.AutoResize,{displayProperties:["value"],layout:{bottom:0,top:0,minWidth:36,centerX:0},classNames:["error-picker-label"],valueBinding:"*parentView.errorText",escapeHTMLBinding:"*parentView.escapeHTML",textAlign:SC.ALIGN_CENTER,measuredSizeDidChange:function(e){e();var t=this.get("measuredSize"),n=this.get("calculatedWidth")||t.width,r=this.get("calculatedHeight")||t.height,i=this.get("parentView");i.adjust({width:n+20,height:r}).updateLayout(),i.positionPane()}.enhance()}),preferMatrix:[2,3,2,2,2],render:function(e,t){var n=this.get("pointerPos");if(e.needsContent)this.renderChildViews(e,t),e.push("<div class='top-left-edge'></div>","<div class='top-edge'></div>","<div class='top-right-edge'></div>"),n.indexOf(SC.POINTER_LAYOUT[2])!==-1?e.push('<div class="top-middle-edge" style="margin-top: '+this.get("pointerPosY")+'px"></div>'):n.indexOf(SC.POINTER_LAYOUT[3])!==-1&&e.push('<div class="bottom-middle-edge" style="margin-top: '+
this.get("pointerPosY")+'px"></div>');else{var r=this.$(".sc-pointer");n===SC.POINTER_LAYOUT[2]?(r.attr("class","top-middle-edge"),r.attr("style","margin-top: "+this.get("pointerPosY")+"px")):n===SC.POINTER_LAYOUT[3]&&(r.attr("class","bottom-middle-edge"),r.attr("style","margin-top: "+this.get("pointerPosY")+"px"))}e.addClass(n)}}),CW.ErrorPicker.showError=function(e,t){var n=this.create({errorText:t});return n.popup(e,SC.PICKER_POINTER),n},CW.BottomPaneView=SC.View.extend(SC.StaticLayout,{useStaticLayout:NO,childViews:["leftView","rightView"],buttonOne:SC.outlet("rightView.okButton"),buttonTwo:SC.outlet("rightView.cancelButton"),buttonThree:SC.outlet("leftView.extraButton"),leftButtonsContainerWidth:null,rightButtonsContainerWidth:null,leftViewLayout:function(){return{bottom:0,height:44,width:this.get("leftButtonsContainerWidth"),left:0}}.property("leftButtonsContainerWidth").cacheable(),rightViewLayout:function(){return{bottom:0,height:44,width:this.get("rightButtonsContainerWidth"),right:0}}.property("rightButtonsContainerWidth").cacheable(),delegate:null,action:null,buttonOneHash:{useStaticLayout:YES,actionKey:SC.BUTTON1_STATUS,localize:YES,layout:{right:0,height:44,width:"auto",bottom:0},title:"Button.OK",classNames:["button-aligned-right","bar-before"],icon:null,action:"dismiss",isDefault:YES,themeName:"borderless"},buttonTwoHash:{useStaticLayout:YES,actionKey:SC.BUTTON2_STATUS,localize:YES,layout:{right:5,height:44,width:"auto",bottom:0},title:"Button.Cancel",classNames:["button-in-between"],icon:null,action:"dismiss",isVisible:YES,isCancel:YES,themeName:"borderless"}
,buttonThreeHash:{useStaticLayout:YES,actionKey:SC.BUTTON3_STATUS,localize:YES,layout:{left:0,height:44,width:"auto",bottom:0},title:"Extra",classNames:["button-aligned-left"],icon:null,action:"dismiss",isVisible:NO,themeName:"borderless"},rightView:SC.View.extend({layoutBinding:"*owner.rightViewLayout",classNames:["text-align-right"],buttonOneHashBinding:"*parentView.buttonOneHash",buttonTwoHashBinding:"*parentView.buttonTwoHash",cancelButton:SC.ButtonView.extend(),okButton:SC.ButtonView.extend(),buttonHashObserver:function(){var e,t;e=this.okButton=SC.ButtonView.create(this.get("buttonOneHash")),t=this.cancelButton=SC.ButtonView.create(this.get("buttonTwoHash")),this.replaceAllChildren([t,e])}.observes("buttonOneHash","buttonTwoHash")}),leftView:SC.View.extend({layoutBinding:"*owner.leftViewLayout",classNames:["text-align-left"],isVisible:YES,buttonThreeHashBinding:"*parentView.buttonThreeHash",extraButton:SC.ButtonView.extend(),buttonHashObserver:function(){var e;e=this.extraButton=SC.ButtonView.create(this.get("buttonThreeHash")),this.replaceAllChildren([e])}.observes("buttonThreeHash")})}),CW.ScrollView=SC.ScrollView.extend({horizontalScrollerView:CW.ScrollerView,verticalScrollerView:CW.ScrollerView,didCreateLayer:function(e){this._thumbHidden=YES,this.invokeLater(this.fadeIn,400).set("isPooled",!0),this.invokeLater(this.fadeAway,1300).set("isPooled",!0),arguments.callee.base.apply(this,arguments)},verticalOverlay:YES,horizontalOverlay:YES,thumbElem:function(){return this.$(".thumb")}.property(),fadeAway:function(){var e=CW.ScrollView;return this._fade(e.BOTH_SCROLLERS,
e.DIM_OPACITY,e.DIM_ANIMATION_DURATION,function(){var e=this.get("verticalScrollerView"),t=this.get("horizontalScrollerView");e&&(e.set("isBeingFadedOut",!1),e.set("isBeingShown",!1)),t&&(t.set("isBeingFadedOut",!1),t.set("isBeingShown",!1))}.bind(this))},fadeIn:function(){var e=CW.ScrollView;return this._fade(e.BOTH_SCROLLERS,e.VISIBLE_OPACITY,e.VISIBLE_ANIMATION_DURATION,function(){var e=this.get("verticalScrollerView"),t=this.get("horizontalScrollerView");e&&(e.set("isBeingShown",!0),e.set("isBeingFadedIn",!1)),t&&(t.set("isBeingShown",!0),t.set("isBeingFadedIn",!1))}.bind(this))},_scroll_verticalScrollOffsetDidChange:function(){arguments.callee.base.apply(this,arguments),this._scrollOffsetDidChange(CW.ScrollView.VERTICAL_SCROLLER)}.observes("verticalScrollOffset"),_scroll_horizontalScrollOffsetDidChange:function(){arguments.callee.base.apply(this,arguments),this._scrollOffsetDidChange(CW.ScrollView.HORIZONTAL_SCROLLER)}.observes("horizontalScrollOffset"),_verticalScrollerViewHoverDidChange:function(){this._hoverDidChange(CW.ScrollView.VERTICAL_SCROLLER)}.observes(".verticalScrollerView.hoveredScroll"),_hover_horizontalScrollDidChange:function(){this._hoverDidChange(CW.ScrollView.HORIZONTAL_SCROLLER)}.observes(".horizontalScrollerView.hoveredScroll"),_scrollOffsetDidChange:function(e){var t=CW.ScrollView,n,r,i,s;e===t.VERTICAL_SCROLLER?(n=this.get("verticalScrollerView"),r="verticalTimer",i=this[r],s="_fadeOutVerticalScrollerIfNotAlready"):e===t.HORIZONTAL_SCROLLER?(n=this.get("horizontalScrollerView"),r="horizontalTimer",i=this[r],s="_fadeOutHorizontalScrollerIfNotAlready"
):CW.fatalError("_scrollOffsetDidChange(): Invalid `scrollerConstant` specified");if(!n)return;this._fadeInScrollerViewIfNotAlready(n),i&&i.invalidate(),n&&!n.get("hoveredScroll")?(i=this.invokeLater(s,t.DIM_AFTERSCROLLTIME),i.set("isPooled",!0)):i=null,this[r]=i},_hoverDidChange:function(e){var t=CW.ScrollView,n,r,i,s;e===t.VERTICAL_SCROLLER?(n=this.get("verticalScrollerView"),r="verticalTimer",i=this[r],s="_fadeOutVerticalScrollerIfNotAlready"):e===t.HORIZONTAL_SCROLLER?(n=this.get("horizontalScrollerView"),r="horizontalTimer",i=this[r],s="_fadeOutHorizontalScrollerIfNotAlready"):CW.fatalError("_hoverDidChange(): Invalid `scrollerConstant` specified");if(!n)return;i&&i.invalidate(),n.get("hoveredScroll")?(this._fadeInScrollerViewIfNotAlready(n),i=null):(i=this.invokeLater(s,t.DIM_AFTERSCROLLTIME),i.set("isPooled",!0)),this[r]=i},_fadeInScrollerViewIfNotAlready:function(e){var t=CW.ScrollView;!e.get("isBeingShown")&&!e.get("isBeingFadedIn")&&(e.set("isBeingFadedIn",!0),this._fade(e,t.VISIBLE_OPACITY,t.VISIBLE_ANIMATION_DURATION,function(){e.set("isBeingFadedIn",!1),e.set("isBeingShown",!0)}))},_fadeOutVerticalScrollerIfNotAlready:function(){this._fadeOutScrollerIfNotAlready(this.get("verticalScrollerView"))},_fadeOutHorizontalScrollerIfNotAlready:function(){this._fadeOutScrollerIfNotAlready(this.get("horizontalScrollerView"))},_fadeOutScrollerIfNotAlready:function(e){var t=CW.ScrollView;e.get("isBeingShown")&&!e.get("isBeingFadedOut")&&(e.set("isBeingFadedOut",!0),this._fade(e,t.DIM_OPACITY,t.DIM_ANIMATION_DURATION,function(){e.set("isBeingFadedOut",!1),e.set("isBeingShown"
,!1)}))},_fade:function(e,t,n,r){var i,s;n||(n=350),e===CW.ScrollView.BOTH_SCROLLERS?(i=this.get("thumbElem"),s=this._bothScrollersThumbAnim):(i=e.$(".thumb"),s=e.get("currentThumbAnimation")),s&&CW.Anim.tellStop(s);var o=this;this._thumbAnim=CW.Animation.create({from:parseFloat(i.css("opacity")),to:t,duration:n,update:function(){i.css("opacity",this.current)},finish:function(e,t){return r&&r.apply(o),arguments.callee.base.apply(this,arguments)}}).start()},_fadeOutVerticalScrollerTimer:null,_fadeOutHorizonalScrollerTimer:null}),SC.mixin(CW.ScrollView,{HORIZONTAL_SCROLLER:0,VERTICAL_SCROLLER:1,BOTH_SCROLLERS:2,VISIBLE_OPACITY:1,DIM_OPACITY:.001,DIM_AFTERSCROLLTIME:750,VISIBLE_ANIMATION_DURATION:50,DIM_ANIMATION_DURATION:350}),SC.ScrollView=CW.ScrollView,CW.FallOffScrollView=SC.ScrollView.extend({fallOffWidth:null,fallOffSize:SC.REGULAR_CONTROL_SIZE,classNames:["falloff-scroll"],showGradientOnlyIfScrollerVisible:NO,scrollerViewOffset:function(){return this.get("isVerticalScrollerVisible")&&!this.get("verticalOverlay")?this.getPath("verticalScrollerView.scrollbarThickness"):0}.property("isVerticalScrollerVisible"),applyScrollerViewOffset:function(){var e=this._falloffTop,t=this._falloffBottom;if(!SC.none(this.get("falloffWidth"))||!e||!t)return;var n=this._cssHash||(this._cssHash={});n.right=this.get("scrollerViewOffset"),e.css(n),t.css(n)}.observes("scrollerViewOffset"),calculateFalloffVisibility:function(){var e,t,n=this.get("verticalScrollOffset"),r=this.get("maximumVerticalScrollOffset");!this.get("isVerticalScrollerVisible")&&this.get("showGradientOnlyIfScrollerVisible")?(
e=NO,t=NO):(e=n!==0,t=n!==r),this.setIfChanged("showingTopFalloff",e),this.setIfChanged("showingBottomFalloff",t)},_calculateFalloffVisibilityOnce:function(){this.invokeOnce(this.calculateFalloffVisibility)}.observes("isVerticalScrollerVisible","verticalScrollOffset","showGradientOnlyIfScrollerVisible","maximumVerticalScrollOffset"),showingTopFalloff:NO,showOrHideTopFalloff:function(){var e=this.$(".falloff.top")[0];if(!e)return;var t=SC.browser.isIE8OrLower?0:300,n=this.get("showingTopFalloff")?1:0,r=this._wasShowingTopFalloff?1:0;this._wasShowingTopFalloff=this.get("showingTopFalloff");if(this._cwfs_topFalloffAnimation)this._cwfs_topFalloffAnimation.redirectTo(n);else{n>0&&(e.style.display="block");var i=this;this._cwfs_topFalloffAnimation=CW.Animation.create({duration:t,from:r,to:n,update:function(){e.style.opacity=this.current},cleanup:function(){this.to<1&&(e.style.display="none"),i._cwfs_topFalloffAnimation=null}.listens("finish")}),this._cwfs_topFalloffAnimation.start()}}.observes("showingTopFalloff"),showingBottomFalloff:NO,showOrHideBottomFalloff:function(){var e=this.$(".falloff.bottom")[0];if(!e)return;var t=SC.browser.isIE8OrLower?0:300,n=this.get("showingBottomFalloff")?1:0,r=this._wasShowingBottomFalloff?1:0;this._wasShowingBottomFalloff=this.get("showingBottomFalloff");if(this._cwfs_bottomFalloffAnimation)this._cwfs_bottomFalloffAnimation.redirectTo(n);else{n>0&&(e.style.display="block");var i=this;this._cwfs_bottomFalloffAnimation=CW.Animation.create({duration:t,from:r,to:n,update:function(){e.style.opacity=this.current},cleanup:function(){this.to<1&&(e.style
.display="none"),i._cwfs_bottomFalloffAnimation=null}.listens("finish")}),this._cwfs_bottomFalloffAnimation.start()}}.observes("showingBottomFalloff"),render:function(e,t){arguments.callee.base.apply(this,arguments);if(SC.platform.touch)return;if(t){var n=this.get("fallOffWidth"),r=this.get("fallOffSize"),i="",s=this.get("showingTopFalloff"),o=this.get("showingBottomFalloff"),u,a,f=r===SC.SMALL_CONTROL_SIZE?"small":r===SC.REGULAR_CONTROL_SIZE?"regular":"large",l='<span class="right"/><span class="middle"/><span class="left"/>';SC.none(n)?i+="right: %@px;".fmt(this.get("scrollerViewOffset")):i+="width: %@px;".fmt(n),s?u=i:u=i+"display: none; opacity: 0;",this._wasShowingTopFalloff=s,o?a=i:a=i+"display: none; opacity: 0;",this._wasShowingBottomFalloff=o,e.push('<div class="falloff %@1 top" style="%@2">%@4</div><div class="falloff %@1 bottom" style="%@3">%@4</div>'.fmt(f,u,a,l))}},didCreateLayer:function(e){this._falloffBottom=this.$(".falloff.bottom"),this._falloffTop=this.$(".falloff.top"),e()}.enhance()}),CW.PICKER_BOTTOM_BORDER_HEIGHT=28,CW.PICKER_MARGIN_TOP_FROM_WINDOW=30,CW.DEFAULT_POINTER_POSITION_FROM_TOP=33,CW.ADJUST_PARENT_DEBUGGING=NO,CW.PopOver=SC.PickerPane.extend({classNames:["pop-over"],innerScrollView:SC.outlet("contentView.wellView.contentView"),innerTitleView:SC.outlet("contentView.titleView"),innerContentOfScrollView:SC.outlet("contentView.wellView.contentView.contentView"),innerContent:SC.outlet("contentView.wellView.contentView"),innerBottomView:SC.outlet("contentView.bottomView"),contentViewHasScrollerView:NO,titleView:null,hasBottomView:NO,bottomViewWidthDistribution
:null,leftButtonsContainerWidth:function(){return this.bottomViewWidthDistribution?this.bottomViewWidthDistribution.leftButtonsContainerWidth:".30"}.property("bottomViewWidthDistribution").cacheable(),rightButtonsContainerWidth:function(){return this.bottomViewWidthDistribution?this.bottomViewWidthDistribution.rightButtonsContainerWidth:".70"}.property("bottomViewWidthDistribution").cacheable(),delegate:null,action:null,verticalOverlay:YES,setInitialLayout:YES,popup:function(){arguments.callee.base.apply(this,arguments)},bottomView:CW.BottomPaneView.extend({layout:{height:32,left:0,right:0,bottom:-4},leftButtonsContainerWidthBinding:"*parentView.parentView.leftButtonsContainerWidth",rightButtonsContainerWidthBinding:"*parentView.parentView.rightButtonsContainerWidth",delegateBinding:"*parentView.delegate",actionBinding:"*parentView.action"}),initialLayout:null,wellViewLayout:{top:10,left:12,right:12,bottom:10},wellView:SC.WellView.extend({}),contentViewLayout:{top:4,left:0,right:0,bottom:4},alwaysPositionTop:NO,alwaysPositionBottom:NO,adjustLayout:YES,isLoading:NO,loadingText:null,isVerticalScrollerVisible:function(){if(this.get("contentViewHasScrollerView")){var e=this.get("innerScrollView");return e.get("isVerticalScrollerVisible")}return NO}.property(),render:function(e,t){var n=this.get("pointerPosY"),r=this.get("pointerPos"),i=0,s;if(r===SC.POINTER_LAYOUT[0])i=0;else if(r===SC.POINTER_LAYOUT[1])s=this.get("layout"),i=s?s.width:0;else if(r===SC.POINTER_LAYOUT[2]||r===SC.POINTER_LAYOUT[3])s=this.get("layout"),i=s?s.width/2:0;r!==SC.POINTER_LAYOUT[3]&&r!==SC.POINTER_LAYOUT
[2]&&(n+=CW.DEFAULT_POINTER_POSITION_FROM_TOP),e.addClass("popme"),SC.none(e.styles()["-webkit-transform-origin"])||e.removeStyle("-webkit-transform-origin"),SC.none(e.styles()["-moz-transform-origin"])||e.removeStyle("-moz-transform-origin"),e.addStyle("-webkit-transform-origin","%@px %@px".fmt(i,n)),e.addStyle("-moz-transform-origin","%@px %@px".fmt(i,n));var o=arguments.callee.base.apply(this,arguments);return o},contentView:SC.View.extend({classNames:["picker-contentView"],layout:{top:0,left:0,right:0,bottom:0},createChildViews:function(){var e=[],t=this.parentView,n=t.innerContentView,r=t.scrollView,i=t.titleView,s=t.contentViewLayout,o=t.hasBottomView,u=t.bottomView,a=t.get("contentViewHasScrollerView"),f=t.get("wellView"),l=t.get("wellViewLayout"),c=this.parentView.get("verticalOverlay");i&&(i=this.titleView=this.createChildView(i),this.childViews.pushObject(i)),o&&(this.bottomView=u=this.createChildView(u),this.childViews.pushObject(u)),a?(this.wellView=f=this.createChildView(f,{layout:l,contentLayout:s,contentView:CW.FallOffScrollView.extend({classNames:["pop-over-scroll"],fallOffSize:SC.REGULAR_CONTROL_SIZE,verticalOverlay:c,hasHorizontalScroller:NO,verticalScrollerLayout:{right:4,top:3,bottom:4},verticalScrollerView:CW.CaplessMiniScrollerView,contentView:n,showGradientOnlyIfScrollerVisible:YES,delaysContentTouches:NO})}),this.childViews.pushObject(f)):(this.wellView=f=this.createChildView(f,{layout:l,contentLayout:s,contentView:n}),this.childViews.pushObject(f))}}),paneDidAttach:function(){arguments.callee.base.apply(this,arguments),this.set("initialLayout",this.get
("layout"))},getContentView:function(){return this.get("contentViewHasScrollerView")?this.get("innerContentOfScrollView"):this.get("innerContent")},remove:function(){var e=this.get("initialLayout"),t=this.get("setInitialLayout");e&&t&&this.set("layout",e),arguments.callee.base.apply(this,arguments)},dismiss:function(e){var t=this.get("delegate"),n=this.get("action");t&&n?SC.RootResponder.responder.sendAction(n,t,e.get("actionKey")):CW.fatalError("Delegate and action were not provided")},name:"Pop Over",readableName:function(){return this.name||this.toString()}.property("name").cacheable(),updateHeight:function(e,t){var n=this.get("frame").height,r=n+e;CW.ADJUST_PARENT_DEBUGGING&&(CW.debug("%@ current height ---> %@",this,n),CW.debug("%@ pickerHeightChange ---> %@",this,r)),this.adjust({height:r}),t&&this.adjustChildViewsLayout(e,t),this.windowSizeDidChange(null,SC.RootResponder.responder.computeWindowSize())},fitPositionToScreenPointer:function(e,t,n){if(this.get("alwaysPositionBottom")){var r=n.height>12?0:1,i=n.height>12?0:3,s,o=[[n.x+n.width+(7+r),n.y+parseInt(n.height/2,0)-40],[n.x-t.width-(7+r),n.y+parseInt(n.height/2,0)-40],[n.x+parseInt(n.width/2-t.width/2,0),n.y-t.height-(17+i)],[n.x+parseInt(n.width/2-t.width/2,0),n.y+n.height+(17+i)]],u=[[n.x+n.width+t.width+(7+r),n.y+parseInt(n.height/2,0)+t.height-24],[n.x-(7+r),n.y+parseInt(n.height/2,0)+t.height-24],[n.x+parseInt(n.width/2-t.width/2,0)+t.width,n.y-(17+i)],[n.x+parseInt(n.width/2-t.width/2,0)+t.width,n.y+n.height+t.height+(17+i)]],a=[[o[0][1]>0?0:0-o[0][1],u[0][0]<e.width?0:u[0][0]-e.width,u[0][1]<e.height?0:u[0
][1]-e.height,o[0][0]>0?0:0-o[0][0]],[o[1][1]>0?0:0-o[1][1],u[1][0]<e.width?0:u[1][0]-e.width,u[1][1]<e.height?0:u[1][1]-e.height,o[1][0]>0?0:0-o[1][0]],[o[2][1]>0?0:0-o[2][1],u[2][0]<e.width?0:u[2][0]-e.width,u[2][1]<e.height?0:u[2][1]-e.height,o[2][0]>0?0:0-o[2][0]],[o[3][1]>0?0:0-o[3][1],u[3][0]<e.width?0:u[3][0]-e.width,u[3][1]<e.height?0:u[3][1]-e.height,o[3][0]>0?0:0-o[3][0]]];(!this.preferMatrix||this.preferMatrix.length!==5)&&this.set("preferMatrix",[0,1,2,3,0]);var f=this.preferMatrix;f[4]===-1?(t.x=n.x+parseInt(n.width/2,0),t.y=n.y+parseInt(n.height/2,0)-parseInt(t.height/2,0),this.set("pointerPos",SC.POINTER_LAYOUT[0]+" fallback"),this.set("pointerPosY",parseInt(t.height/2,0)-40)):(t.x=o[f[4]][0],t.y=o[f[4]][1],this.set("pointerPos",SC.POINTER_LAYOUT[f[4]]),this.set("pointerPosY",0)),this.set("pointerPosX",0),s=f[0],t.x=o[s][0],t.y=o[s][1],this.set("pointerPosY",0),this.set("pointerPos",SC.POINTER_LAYOUT[s])}else t=arguments.callee.base.apply(this,arguments);return t},windowSizeDidChange:function(e,t){var n=this.get("innerScrollView"),r=this.get("alwaysPositionTop"),i=this.get("alwaysPositionBottom"),s,o,u,a,f,l,c,h,p;if(!this.get("isPaneAttached"))return;if(e&&t&&e.height===t.height&&e.width===t.width)return this;if((r||i)&&this.get("contentViewHasScrollerView")&&this.get("adjustLayout")){SC.RunLoop.begin(),SC.RunLoop.end(),s=n.get("containerView").get("frame").height,o=n.get("contentView").get("frame").height,u=o-s,a=t.height,pickerFrame=this.get("frame"),h=pickerFrame.height,p=pickerFrame.y;if(i)l=a-(p+h+CW.PICKER_BOTTOM_BORDER_HEIGHT),l=u>l?l:u,c=h+l;else if(r
){var d=this.getPath("innerTitleView.frame.height")||0,v=this.getPath("innerBottomView.frame.height")||0,m=14,g=o+d+v+m,y=p>b,b=this.get("pickerMarginFromWindow")||CW.PICKER_MARGIN_TOP_FROM_WINDOW;if(!y||y&&g>h)c=h+p-b,c=c>g?g:c}this.adjust("height",c)}return this.positionPane(e===null?YES:NO),this},setButtonHash:function(e,t,n){var r=["buttonOne","buttonTwo","buttonThree"],i=this.get("hasBottomView");i||CW.fatalError("there is no bottomView provided"),r.indexOf(n)===-1&&CW.fatalError("buttonNumber provided is invalid");var s=SC.clone(this.getPath("pane.innerBottomView."+n+"Hash"));s[e]=t,this.getPath("pane.innerBottomView").set(n+"Hash",s)},setHash:function(e,t){var n=["buttonOne","buttonTwo","buttonThree"],r=this.get("hasBottomView");r||CW.fatalError("there is no bottomView provided"),n.indexOf(t)===-1&&CW.fatalError("buttonNumber provided is invalid"),this.getPath("pane.innerBottomView").set(t+"Hash",e)},addViewToTheContentView:function(e){var t=this.get("contentViewHasScrollerView"),n;t?n=this.get("innerContentOfScrollView"):n=this.get("innerContent"),n.appendChild(e)},removeViewFromTheContentView:function(e){var t=this.get("contentViewHasScrollerView"),n;t?n=this.get("innerContentOfScrollView"):n=this.get("innerContent"),n.removeChild(e)},isLoadingObserver:function(){var e=this.get("loadingText"),t=this.get("isLoading"),n=this.get("loadingView"),r=this.getPath("contentView.wellView").get("frame");t?(n=CW.LoadingView.show(r.width-4,r.height-4,e,"overlay-loading-view"),this.set("loadingView",n),this.getPath("contentView.wellView").appendChild(n)):n?this.getPath("contentView.wellView"
).removeChild(n):SC.error("There is no Loading View")}.observes("isLoading"),adjustHeightAndPositionPane:function(e){return e&&e>0&&this.adjust({height:e}).positionPane(),this},positionPane:function(e){var t=this.get("anchorElement"),n=this.get("anchorView"),r=this.get("preferType"),i=this.get("preferMatrix"),s=this.get("layout"),o,u,a,f,l;if(t){var c=this._originCached,h=this._anchorCached;if(!e||e&&(!c||!h)){n&&(u=n.get("frame"),a=u.width,f=u.height),t=this.computeAnchorRect(t,a,f);if(t.x===0&&t.y===0)return;o=SC.cloneRect(t);if(r)switch(r){case SC.PICKER_MENU:case SC.PICKER_FIXED:(!i||i.length!==3)&&this.set("preferMatrix",[1,4,3]),o.x+=(this.preferMatrix[2]===0?o.width:0)+this.preferMatrix[0],o.y+=(this.preferMatrix[2]===3?o.height:0)+this.preferMatrix[1];break;default:o.y+=o.height}else o.y+=o.height;c=o,h=t}else o=c,t=h;o&&t&&(l=this.fitPositionToScreen(o,this.get("frame"),t),this.adjust({width:l.width,height:l.height,left:l.x,top:l.y}))}else this.adjust({width:s.width,height:s.height,centerX:0,centerY:0});return this.updateLayout(),this}}),CW.SquareMenuPane=SC.MenuPane.extend({classNames:"me-square-menu",itemHeight:31,itemSeparatorHeight:7,menuHeightPadding:6}),CW.ScrollerView=SC.ScrollerView.extend({hasButtons:NO,capLength:0,capOverlap:-2,buttonLength:0,buttonOverlap:-2,scrollbarThickness:9,minimumThumbLength:32,hoveredScroll:!1,isBeingShown:undefined,isBeingFadedIn:undefined,isBeingFadedOut:undefined,currentThumbAnimation:undefined,mouseDown:function(){return this._MouseDown=YES,arguments.callee.base.apply(this,arguments)},mouseUp:function(){return this._MouseDown=NO
,this.set("hoveredScroll",!1),arguments.callee.base.apply(this,arguments)},mouseEntered:function(){this.set("hoveredScroll",!0)},mouseExited:function(){this._MouseDown||this.set("hoveredScroll",!1)}}),SC.mixin(SC.ScrollView.prototype,{horizontalScrollerView:CW.ScrollerView,verticalScrollerView:CW.ScrollerView}),CW.CaplessMiniScrollerView=CW.ScrollerView.extend({hasButtons:NO,classNames:"me-capless-mini-scroller-view",capLength:0,capOverlap:0,buttonLength:0,buttonOverlap:0,scrollbarThickness:8}),CW.CaplessScrollerView=CW.ScrollerView.extend({classNames:"me-capless-scroller-view",hasButtons:NO,capLength:0,capOverlap:0,buttonLength:0,buttonOverlap:0}),CW.DetailsDisclosureView=SC.View.extend(CW.Alert.ExtraViewAutoResizingSupport,SC.RTLSupport,{layoutRecipe:{start:106,end:25},contentView:SC.TextFieldView.design({layout:{height:90},isVisible:NO}),caption:null,isExpanded:NO,disclosureTitle:"Details",verticalPadding:15,classNames:["cw-details"],childViews:["contentView","disclosureButtonView"],disclosureButtonView:SC.DisclosureView.design({valueBinding:"*owner.isExpanded",titleBinding:"*owner.disclosureTitle",layout:{height:30},controlSize:SC.LARGE_CONTROL_SIZE}),init:function(e){e();var t=this.get("contentView");t&&t.set("isVisible",this.get("isExpanded"))}.enhance(),_isExpandedDidChange:function(){var e=this.get("isExpanded"),t=this.get("captionView"),n=t?t.getPath("frame.height"):undefined,r=this.get("contentView"),i=r.getPath("frame.height")+this.get("verticalPadding"),s=this.getPath("frame.height");e?(r.set("isVisible",YES),t&&t.adjust("top",n+i),this.adjust("height",s+i)):(r.set
("isVisible",NO),t&&t.adjust("top",n-i),this.adjust("height",s-i))}.observes("isExpanded"),createChildViews:function(){var e=this.get("caption");return e&&(this.captionView=CW.DetailsDisclosureView.CaptionView.extend({value:e}),this.childViews.push("captionView")),arguments.callee.base.apply(this,arguments)},computeHeight:function(){var e=this.get("disclosureButtonView"),t=this.get("contentView"),n=this.get("captionView"),r=this.get("isExpanded"),i=e.getPath("frame.height"),s=this.getPath("pane.isCompact"),o,u;t.adjust("top",i),r?i+=t.getPath("frame.height")+(s?0:22):i+=5;if(n)if(!s||!r){var a=n.get("value");n.adjust("top",i),u=n.get("layer"),u.style.maxWidth=n.getPath("frame.width")+"px",o=SC.metricsForString(a,u,"",YES).height,n.adjust("height",o),i+=o,n.set("isVisible",YES)}else n.set("isVisible",NO);return this.adjust("height",i),i}}),CW.DetailsDisclosureView.CaptionView=SC.LabelView.design({escapeHTML:NO,classNames:["cw-caption"],layout:{top:0,left:0,right:0,height:0}}),CW.FadingCaplessScrollerView=CW.ScrollerView.extend({hasButtons:NO,classNames:"sc-fading-capless-scroller-view".w(),capLength:0,capOverlap:-2,buttonLength:0,buttonOverlap:-2,scrollbarThickness:10,minimumThumbLength:32,isVisibleDidChange:function(){if(!this.get("isVisible"))return;this.$(".sc-scroller-view").addClass("sc-fading-capless-scroller-view-invisible")}.observes("isVisible")}),CW.FadingCaplessScrollerViewSupport={_thumbHidden:NO,didCreateLayer:function(e){this.$(".sc-scroller-view").addClass("sc-fading-capless-scroller-view-invisible"),this._thumbHidden=YES,e()}.enhance(),verticalOverlay:YES,horizontalOverlay
:YES,mouseExited:function(){if(this._thumbHidden)return;var e=this.get("verticalScrollerView"),t=this.get("horizontalScrollerView");if(e&&!e._thumbDragging||t&&!t._thumbDragging)this.$(".sc-scroller-view").addClass("sc-fading-capless-scroller-view-invisible"),this._thumbHidden=YES},mouseMoved:function(){if(!this._thumbHidden)return;this._thumbView||(this._thumbView=this.$(".thumb")),this.$(".sc-scroller-view").removeClass("sc-fading-capless-scroller-view-invisible"),this._thumbHidden=NO}},CW.LoadingView=SC.View.extend({classNames:"",layout:null,icon:"",text:"",adjustParent:NO,render:function(e,t,n){e(t,n),t.push('<table border="0" width="100%" height="100%" valign="center">',"<tr>",'<td align="center">','<span class="spinner-box" style="text-align: middle">','<span style="vertical-align: middle; display: inline-block; float: none;" class="%@ spinner message"/>'.fmt(this.get("icon")),'<span style="vertical-align: middle;" class="me-loading-app text">',this.get("text"),"</span>","</span>","</td>","</tr>","</table>")}.enhance()}),CW.LoadingView.show=function(e,t,n,r,i){var s=this.create({layout:{width:e,height:t},classNames:[r||"content-loading-view"],text:n||"Status.Loading".loc(),icon:i||"spinner-32px-f3f5f5"});return s},CW.PrefsTheme=SC.BaseTheme.create({name:"prefs-theme"}),SC.Theme.addTheme(CW.PrefsTheme),CW.PrefsSegmentedView=SC.SegmentedView.extend(SC.Control,{themeName:"prefs-theme",align:SC.ALIGN_LEFT}),CW.PrefsTheme.buttonRenderDelegate=SC.RenderDelegate.create({name:"button",render:function(e,t){var n=e.get("title"),r=e.get("icon");t.push('<span class="sc-button-inner"><div class="sc-button-label">'
,'<img src="',SC.BLANK_IMAGE_URL,'" alt="" class="icon '+r+'"/>','<div class="sc-button-title">',n,"</div></div></span>")},update:function(e,t){}}),CW.SpinnerView=SC.View.extend({layout:{left:0,top:0},frequency:1.5,size:NaN,assetFrameCount:NaN,assetIsAlways2x:NO,asset:"/applications/mail/1808Project39/frameworks/coreweb/views/1808Project39/en-us/source/resources/images/spinner.png",innerElement:null,innerClassNames:null,init:function(){return this.innerClassNames&&(this.innerElement||(this.innerElement=document.createElement("div")),this.innerElement.className+=" "+this.innerClassNames.join(" ")),this.innerElement&&(this.assetIsAlways2x=NO),arguments.callee.base.apply(this,arguments)},didCreateLayer:function(){var e=this.get("layer"),t=this;if(!e)return;var n=this.get("innerElement");n?(n.style.right=n.style.bottom="",this.invokeOnce("fillInUnknownValuesUsingInnerElement")):(this.set("innerElement",n=new Image),n.onload=function(){this.style.display="",t.invokeOnce("fillInUnknownValuesUsingInnerElement")},n._isAutomaticImage=YES,n.style.display="none",n.src=this.get("asset")),n.parentNode&&n.parentNode!==e&&n.parentNode.removeChild(n),n.parentNode||e.appendChild(n),n.style.position="absolute",n.style.left=n.style.top="0px"},fillInUnknownValuesUsingInnerElement:function(){var e=this.get("layer");if(!e)return;this._imageLoaded=YES;var t=this.get("innerElement"),n=this.get("assetIsAlways2x")?2:window.devicePixelRatio||1,r=t._isAutomaticImage?t.width:t.offsetWidth||parseInt(CW.Anim.getStyle(t,"width"),10),i=t._isAutomaticImage?t.height:t.offsetHeight||parseInt(CW.Anim.getStyle(t
,"height"),10),s=this.get("assetFrameCount"),o=this.get("size");isNaN(s)&&this.set("assetFrameCount",s=Math.round(i/r)),isNaN(o)&&this.set("size",o=Math.round(r/n)),this.renderSize(),this._startStopSpin(),SC.browser.isIE8OrLower&&s===3&&SC.warn("Warning: IE8 cannot use three-framed spinner images, because it cannot rotate. Please provide a 12-framed spinner for IE8."),s!==3&&s!==12&&SC.warn("Warning: CW.SpinnerView:"+SC.guidFor(this)+" has an invalid assetFrameCount of "+s+". It must resolve to either 3 or 12 instead. Unpredictable rendering may occur.")},_startStopSpin:function(){var e=this.get("layout"),t=this.get("isVisibleInWindow")&&this._imageLoaded&&(SC.none(e.opacity)||e.opacity>0);t?this._startSpin():this._stopSpin()}.observes("isVisibleInWindow","layout"),_renderSizeObserver:function(){this.renderSize()}.observes("size"),renderSize:function(e,t,n,r){e||(e=this.get("size")),t||(t=this.get("assetFrameCount")),n||(n=this.get("innerElement"));if(isNaN(e))return;r?r.style.width=r.style.height=e+"px":this.adjust({width:e,height:e}),n.style.width=e+"px",n.style.height=e*t+"px",r||this.renderPosition()},_startSpin:function(){if(this._interval)return;var e=this;this._interval=setInterval(function(){e._rotateStep()},1e3/this.get("frequency")/12)},_stopSpin:function(){if(!this._interval)return;clearInterval(this._interval),this._interval=null},_rotateStep:function(){this._pos=((this._pos||0)+1)%12,this.renderPosition()},renderPosition:function(e,t,n,r){e===undefined&&(e=this._pos||0),t||(t=this.get("size")||0),n||(n=this.get("assetFrameCount"));var i=(r||this.get("innerElement"
)).style,s=e%n,o,u,a,f,l;if(n===12){i.top=-t*s+"px";return}o=Math.floor(e/3),f=o%2!==0,l=Math.floor(o/2)===1?1:-1,u=f?t*-l*s+l*t:0,a=(f?0:t*l*s)-(o!==0?t:0)-(o===2?t:0),i[SC.platform.domCSSPrefix+"Transform"]=i.transform="translateX("+u+"px) translateY("+a+"px) rotate("+o*90+"deg)"}}),CW.SpinnerView.renderPosition=CW.SpinnerView.prototype.renderPosition,CW.SpinnerView.renderSize=CW.SpinnerView.prototype.renderSize,SC.stringsFor("en-us",{"Name.Display.FirstAndFamilyNames":"%{firstName} %{familyName}","Toolbar.Button.Action.Help":"Help and Support","Toolbar.Tooltip.App.Switcher":"Change App","Toolbar.Button.Action.UserAction":"iCloud Settings & Sign Out"}),CK=SC.Object.create({NAMESPACE:"CK",VERSION:"1.0.0",LOAD_REASON_USER_CLICK:1,LOAD_REASON_LOCATION_HASH:2,LOAD_REASON_APP_SWITCH:3,LOAD_REASON_NOTIFICATION:4,LOAD_REASON_RELOAD:5,LOAD_REASON_SHARE_ACCEPTED:6,LOAD_REASON_APP_REPLACED:7,EXIT_NON_FATAL:0,EXIT_FATAL_ERROR:1,EXIT_STARTUP_ERROR:2,EXIT_PCS_MISSING:3,EXIT_PCS_INVALID:4,RPC_RESPONSE:"RPC_RESPONSE",currentApplication:null,isLoadedByCloudOS:!!CW.getUrlParameters().isLoadedByCloudOS,isReloading:NO,isWWW:window.location.hostname==="www.icloud.com"?YES:NO,isBeta:window.location.hostname==="beta.icloud.com"?YES:NO,isFuture:window.location.hostname==="future.icloud.com"?YES:NO,isCarry:window.location.hostname==="carry.icloud.com"?YES:NO,initiatedCloudKitJSLoading:!1,init:function(){SC.ready(function(){CK.redirectToCloudOSIfNeeded()})},redirectToCloudOSIfNeeded:function(){if(!CK.currentApplication)return;var e=window.location.pathname,t;window===window.top&&SC.buildMode==="production"&&
e!=="/"&&(t=e.match(/\/applications\/(.*?)\//),t&&t[1]&&(window.location="https://"+window.location.hostname+"/#"+t[1]))},queryParamsToOmitForStartupCaching:["clientId","clientBuildNumber","clientMasteringNumber"],startupUrlsAreEqual:function(e,t){return this.removeQueryParamsToOmitForStartupCaching(e)===this.removeQueryParamsToOmitForStartupCaching(t)},removeQueryParamsToOmitForStartupCaching:function(e){if(!e)return e;var t=URI(e),n=CK.queryParamsToOmitForStartupCaching,r,i;for(r=0,i=n.length;r<i;r++)t.removeSearch(n[r]);return t.toString()},reloadWithReason:function(e,t){CK.setValueInSessionStorage("reloadReason",e),window.COS&&COS.authController.get("environment")!=="PROD"&&CK.setValueInSessionStorage("preReloadLogMessages",SC.Logger.stringifyRecordedLogMessages());var n=!1;n&&CW.getUrlParameters().debugReloads?SC.error("\n\n\n\nReloaded for reason: "+e+"\n\n\n\n"):(t?window.location=t:window.location.reload(),CK.set("isReloading",YES))},getValidateToken:function(){return CK.readCookie("X-APPLE-WEBAUTH-VALIDATE")},carryPartitions:["p97","p98"],isURLInCarryPartition:function(e){var t,n;return e?(t=URI.parse(e).hostname,t?(n=t.split("-")[0],this.get("carryPartitions").indexOf(n)!==-1):NO):NO},loadCloudKitJS:function(e){var t=this.get("initiatedCloudKitJSLoading");if(!window.CloudKit&&!t){var n=e?e:window.VERSIONS.cloudkitjs,r=CK.isCarry,i="https://",s="cdn.apple-cloudkit.com";r&&(s="carry.icloud.com");var o="/ck/"+n+"/cloudkit.js",u=i+s+o,a=document.createElement("script");a.onerror=a.onabort=function(){var e=window.document.createEvent("Event");e.initEvent("cloudkitloadfailure"
,!0,!0),window.document.dispatchEvent(e)},a.setAttribute("src",u),document.head.appendChild(a),this.set("initiatedCloudKitJSLoading",!0)}}}),function(){var e=window.parent,t=e;if(e&&window!==e&&e.postMessage){var n=e.parent;n&&e!==n&&n.postMessage&&(t=n);var r=window.location.pathname.match(/(?:\/applications)?\/(.*?)\/current/)[1],i=function(e){t.postMessage(JSON.stringify({isCloudOSMessage:!0,methodName:"recordApplicationMessage",appName:r,args:e}),"*")};window.addEventListener("error",SC.RunLoop.wrapFunction(function(e){var t=e.error,n="not available",r=e.message||n,s=e.filename||n,o=e.lineno||n,u=t&&t.stack?t.stack:n;SC.warn("onerror exception: "+r+" Script: "+s+" Line: "+o);var a={applicationBuildNumber:SC.buildNumber,applicationMasteringNumber:SC.masteringNumber,error:r,url:s,lineNumber:o,stack:u};i(["OnErrorException",a])})),i(["OnErrorExceptionHandlerWasConfigured"])}}(),CK.AuthenticationStateEnum={NOT_AUTHENTICATED:0,PARTIALLY_AUTHENTICATED_HSA:1,AUTHENTICATED:2,PARTIALLY_AUTHENTICATED_MANAGED_APPLE_ID:3},CK.mixin({getCurrentLocaleInISOFormat:function(){var e=String.preferredLanguage,t=null;return e&&(t=e.substr(0,2).toLowerCase()+"_"+e.substr(3,5).toUpperCase()),t},userLocalPreferenceIsCJK:function(){var e=["ja-jp","zh-cn","zh-tw","ko-kr"],t=String.preferredLanguage;return e.contains(t)}.property("String.preferredLanguage").cacheable(),computeBestAvailableLocale:function(e,t){var n=function(e,t){var n=t;for(;;){if(e.indexOf(n)>-1)return n;var r=n.lastIndexOf("-");if(r<0)return;r>=2&&n.charAt(r-2)=="-"&&(r-=2),n=n.substring(0,r)}},r=function(e){return e.replace(/_/g
,"-").toLowerCase()},i=r(t),s=CK.SUPPLEMENTARY_LOCALE_DATA.likelySubtags;for(var o in s){var u=r(o);if(i===u){i=r(s[o]);break}}var a=CK.SUPPLEMENTARY_LOCALE_DATA.metadata.alias.languageAlias;for(var f in a){var l=r(f);i.indexOf(l)===0&&(i=a[f]._replacement+i.substr(l.length))}var c=e.map(r),h=n(c,i);if(h===undefined)return;var p=e[c.indexOf(h)];return p},displayNameFor:function(e,t,n,r,i){var s;return e&&t?CW.stringIsCJK(e)&&CW.stringIsCJK(t)?s=t+e:s="Name.Display.FirstAndFamilyNames".loc({firstName:e,familyName:t}):e?s=e:t?s=t:r?s=r:i&&(s=i),s||(s=n||""),s},matchesFormatOfAppleId:function(e){return CK.matchesFormatOfEmailAddress(e)||CK.matchesFormatOfPhoneNumberAppleId(e)},matchesFormatOfEmailAddress:function(e){return/^([A-Z0-9\.\-\_\+])*([A-Z0-9\+\-\_])+\@[A-Z0-9]+([\-][A-Z0-9]+)*([\.][A-Z0-9\-]+){1,8}$/i.test(e)},matchesFormatOfPhoneNumberAppleId:function(e){return/^\+?[0-9]{5,}$/.test(e)},matchesFormatOfPhoneNumber:function(e){var t=this._phoneNumberRegex;if(!t){var n="0-9\\uff10-\\uff19\\u0660-\\u0669\\u06F0-\\u06F9\\u0966-\\u096F\\u09E6-\\u09FF\\u0E50-\\u0E59",r="\\(\\)\\s\\-\\+\\.\\,\\#";this._phoneNumberRegexAllDigits=new RegExp("^s*\\+?(["+n+"]+)s*$","gi"),t=this._phoneNumberRegex=new RegExp("^s*([+\\(])?((["+n+"]+)(["+r+"]{1,3}|x|ext))+(["+n+"]+)s*$","gi")}var i=this._phoneNumberRegexAllDigits;return t.lastIndex=0,i.lastIndex=0,t.test(e)||i.test(e)},normalizePhoneNumber:function(e){return e&&e.replace(/[^0-9]/g,"")},redirectTo:function(e){window.location.href=e},readCookie:function(e,t){var n=document.cookie,r,i,s;if(n.length>0){t&&(s=n.match(new RegExp("("+e+")="
)),s&&(e=s[1])),r=n.indexOf(e+"=");if(r!==-1)return r=r+e.length+1,i=n.indexOf(";",r),i===-1&&(i=n.length),window.unescape(n.substring(r,i))}return null},writeCookie:function(e,t,n,r,i,s){var o,u,a;if(!e)return undefined;if(t===undefined||t===null)t="",u="expires=Thu, 01-Jan-1970 00:00:01 GMT;";return i&&(a=i*1e3*60*60,u="expires="+(new Date((new Date).getTime()+a)).toGMTString()),s&&(u+=";Secure"),n||(n="/"),r||(r="."+window.location.hostname),o=document.cookie=e+"="+t+";path="+n+";domain="+r+";"+u,o||SC.info('Not able to set cookie "%@" with "%@"',e,t),o},formatNumberWithLocale:function(e){return CW.formatNumber(e,"Numbers.ThousandsSeparator".loc(),"Numbers.DecimalSeparator".loc())},getLegacyLprojNameForLocale:function(e){var t={"en-us":"English","ja-jp":"Japanese","fr-fr":"French","de-de":"German","es-es":"Spanish","zh-cn":"zh_CN","nl-nl":"Dutch","it-it":"Italian","ko-kr":"ko","zh-tw":"zh_TW","pt-pt":"pt_PT","pt-br":"pt","sv-se":"sv","pl-pl":"pl","cs-cz":"cs","da-dk":"da","hu-hu":"hu","no-no":"no","fi-fi":"fi","tr-tr":"tr","ru-ru":"ru","uk-ua":"uk"},n=t[e];return n||(n="English"),n+".lproj"},hasLocalizedStringForKey:function(e){return e&&e.loc()!==e?YES:NO},addRootDomainQueryParameterHackAsAppropriate:function(e){e||CW.fatalError("You must specify a URL");var t;window.CloudOS&&(CloudOS.isBeta&&(t="beta"),CloudOS.isCarry&&(t="carry"),CloudOS.isFuture&&(t="future"));var n;return CK.isBeta&&(n="beta"),CK.isCarry&&(n="carry"),CK.isFuture&&(n="future"),e instanceof URI||(e=new URI(e)),t&&t!==n&&e.addQuery("rootDomain",t),e.href()},persistAfterLogoutSuffix:".persist",getValueFromSessionStorage
:function(e){return this._getValueFromStorage("sessionStorage",e)},setValueInSessionStorage:function(e,t){return this._setValueInStorage("sessionStorage",e,t)},removeValueInSessionStorage:function(e){return this._removeValueInStorage("sessionStorage",e)},getKeysInSessionStorage:function(){return this._getKeysInStorage("sessionStorage")},clearSessionStorage:function(){return this._clearStorage("sessionStorage")},getValueFromLocalStorage:function(e,t){return this._getValueFromStorage("localStorage",e,t)},setValueInLocalStorage:function(e,t,n){return this._setValueInStorage("localStorage",e,t,n)},removeValueInLocalStorage:function(e,t){return t&&(e+=this.get("persistAfterLogoutSuffix")),this._removeValueInStorage("localStorage",e)},getKeysInLocalStorage:function(){return this._getKeysInStorage("localStorage")},clearLocalStorage:function(){return this._clearStorage("localStorage",YES)},_getStorageObject:function(e){try{return window[e]}catch(t){SC.warn("Could not get storage object for %@: %@",e,t)}},_getValueFromStorage:function(e,t,n){var r=null,i=this._getStorageObject(e),s,o;if(i&&i.getItem){o=CK.currentApplication,s=o?o.get("name"):"iCloud",s&&(t=s+"."+t),n&&(t+=this.get("persistAfterLogoutSuffix"));try{r=i.getItem(t)}catch(u){SC.warn('Could not get value for key "%@" in %@: %@',t,e,u)}}return r},_setValueInStorage:function(e,t,n,r){var i=NO,s=this._getStorageObject(e),o,u;if(s&&s.setItem){u=CK.currentApplication,o=u?u.get("name"):"iCloud",o&&(t=o+"."+t),r&&(t+=this.get("persistAfterLogoutSuffix"));try{s.setItem(t,n),i=YES}catch(a){}}return i},_getKeysInStorage:function(e){
var t=[],n=this._getStorageObject(e),r,i,s,o;if(n){r=CK.currentApplication,i=r?r.get("name"):"iCloud",i&&(i+="."),s=i?i.length:0;for(o in n)o.indexOf(i)===0&&t.push(o.substring(s))}return t},_removeValueInStorage:function(e,t){var n=NO,r=this._getStorageObject(e),i,s;if(r&&r.removeItem){s=CK.currentApplication,i=s?s.get("name"):"iCloud",i&&(t=i+"."+t);try{r.removeItem(t),n=YES}catch(o){}}return n},_clearStorage:function(e,t){var n=YES,r=this._getStorageObject(e),i,s,o,u,a,f,l;if(r&&t)try{i={},s=this.get("persistAfterLogoutSuffix"),o=s.length;for(u=0,a=r.length;u<a;++u){try{f=r.key(u),l=f.indexOf(s),l!==-1&&l===f.length-o&&(i[f]=r.getItem(f))}catch(c){}r.length!==a&&(i={},u=-1,a=r.length)}}catch(h){}if(r)if(!r.clear)n=NO;else try{r.clear()}catch(p){n=NO}if(t)try{for(f in i)r.setItem(f,i[f])}catch(d){}return n},isStringBase64Encoded:function(e){return e.match(new RegExp("^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{4}|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)$"))}}),CK.servicesController=SC.Object.create({getServiceInfoFor:function(e){e||SC.warn("getServiceInfoFor():  A service name must be specified");var t=this._servicesInfo;return t?t[e]:null},getServiceUrlFor:function(e,t){var n=this.getServiceInfoFor(e),r=null,i;return n?(r=n.get("url")||null,r||(i="getServiceUrlFor():  Could not find the URL for “%@”".fmt(e))):i="getServiceUrlFor():  Could not find service information for “%@”".fmt(e),i&&(t?CW.fatalError(i):SC.error(i)),r},getServiceStatusFor:function(e,t){var n=this.getServiceInfoFor(e),r=null,i;return n?(r=n.get("status")||null,r||(i="getServiceStatusFor():  Could not find the status for “%@”"
.fmt(e))):i="getServiceStatusFor():  Could not find service information for “%@”".fmt(e),i&&(t?CW.fatalError(i):SC.error(i)),r},servicesInfoHasBeenReceived:function(){return this._servicesInfo!==null}.property("_servicesInfo"),_setupFromBag:function(e){e||CW.fatalError("_parseInformationFromBag():  The bag must be supplied");var t=e.webservices,n,r,i;if(t){n={};for(r in t)i=SC.clone(t[r],YES),i.name=r,n[r]=CK.ServiceInfo.create(i);this.set("_servicesInfo",n)}else SC.error("CK.servicesController:  The bag does not contain any services information")},_servicesInfo:null}),CK.errorCatcher=SC.Object.create({enabledInDevMode:NO,bubbleErrorsToCloudOS:YES,callback:null,namespacesToSymbolicate:null,isReporting:NO,shouldReloadIfFatal:NO,init:function(){arguments.callee.base.apply(this,arguments),this.get("enabledInDevMode")||SC.buildMode==="production"?(this.set("enabled",YES),SC.ExceptionHandler=this):SC.ExceptionHandler=null},reportBadRequest:function(e){return e||(e={}),e.type="badRequest",this._handleError(e)},reportServerError:function(e,t){e||(e={}),e.type="server";if(SC.kindOf(t,SC.Response)){var n=["server error"],r=t.get("request");r._getServiceName&&n.push("service: "+r._getServiceName()),n.push("status: "+t.get("status")),e.error=n.join(", "),e.serverHostname=URI(t.getFullAddress()).hostname(),e.urlPath=t.getPath("request.reportPath")}return this._handleError(e)},report:function(e){return e||(e={}),e.type||(e.type="generic"),this._handleError(e)},mostCommonErrorMessages:["null","undefined","Syntax","defined"],handleException:function(e){try{e.recordedStack=e.recordedStack||
CW.recordStack(YES,YES)}catch(t){}var n=e.message,r=e.stack,i=e.recordedStack,s=this.get("mostCommonErrorMessages"),o=s.length,u,a="";if(r&&r.length>0){var f=r.toString().split("http")[0];a=f.replace(n,"").replace("\n","")}else i&&i.length>0&&(a=i[1].func);if(n)for(u=0;u<o;u++)if(n.indexOf(s[u])!==-1){n+=". The calling function is "+a;break}return e.message=n,this._handleError({exception:e,isFatal:YES,type:"exception"})},_handleError:function(e){if(!e)return SC.error("Warning: No parameters were specified in _handleError"),YES;if(this.get("isReporting"))return YES;SC.debug("CloudKit: ErrorCatcher dialog invoked.");var t=CK.currentApplication,n=e.applicationName,r,i,s=window.CloudOS&&CloudOS.getUser?CloudOS.getUser():null,o;n||(t?n=t.get("name"):n="cloudos"),e.applicationName||(e.applicationName=n);if(s&&(o=s._auth_bag)){var u=o.requestInfo,a,f;u&&(a=u.region,f=u.country,f&&(e.userRegion=a?a+", "+f:f))}if(!e.appStatechart){var l,c;n==="cloudos"?c=CloudOS.get("statechartPath"):t&&(c=t.get("statechartPath")),c&&(l=SC.getPath(c))&&l.toStringWithDetails&&(e.appStatechart=l.toStringWithDetails())}r=e.exception,r&&(i=this._hashForException(r),e=SC.mixin(i,e));var h=this.get("callback")||this.get("exceptionCallback");if(h)try{h.call(this,e)}catch(p){}if(e.isFatal&&t&&this.get("bubbleErrorsToCloudOS")===YES&&CloudOS&&!CloudOS.isSimulator&&!CloudOS.isCloudOSLite){var d=SC.Logger.stringifyRecordedLogMessages();return e.applicationBuildNumber=SC.buildNumber,e.applicationMasteringNumber=SC.masteringNumber,CloudOS.handleApplicationCrash(e,d),NO}return e.exception?SC.RunLoop.kill():SC.RunLoop
.end(),e.exception=null,!e.applicationLog&&!CloudOS.isCloudOSClient&&(e.applicationLog=SC.Logger.stringifyRecordedLogMessages()),SC.Module.loadModule("cloudkit/error_catcher","CK.errorCatcher","moduleDidLoad",e),this.set("isReporting",YES),YES},_hashForException:function(e){var t={},n=null,r,i,s,o,u,a,f,l,c,h,p,d,v;e&&(n=e.message?e.message:e.toString()),t.error=n,t.file=e.fileName||e.sourceURL||"Unknown",t.line=e.lineNumber||e.line||"Unknown";var m=CW.invertArray(["message","fileName","sourceURL","lineNumber","line","stack","recordedStack"]),g=function(){if(typeof e=="string")return e;var t="";for(p in e){if(m[p])continue;d=e[p],d===undefined?v="(undefined)":d===null?v="(null)":v=p+":  "+d.toString(),t+="   "+v+"\n"}return t}();g.trim().length>0&&(t.exceptionInfo=g),r=e.stack,r&&(t.stack=r.toString()),r=e.recordedStack;if(r){i="";for(s=0,o=r.length;s<o;++s){u=r[s];if(typeof u=="string"){i+=u+"\n";break}i+=u.func+"\n",a=u.args;if(a){i+="  >  args:  ";for(l=0,f=a.length;l<f;++l)c=a[l],h=this._prettyValue(c),l>0&&(i+=",  "),i+=h;i+="\n"}}t.mostRecentStack=i}return t},_shouldReload:function(e,t){return e&&CK.currentApplication?YES:e&&t==="cloudos"?YES:NO},_prettyValue:function(e){var t;return e===undefined?t="undefined":e===null?t="null":(e instanceof Function&&(t=e.displayName,t||(t=e.name)),t||(t=e.toString())),t}}),CK.AccountPreferences=SC.Object.extend({hasInitialized:NO,timeZone:"US/Pacific",timezoneName:"City.Cupertino - U.S.",locale:null,secondaryLocale:null,regionFormat:null}),CK.AppInfo=SC.Object.extend({name:null,capitalizedName:function(){var e=this.get("name");return e&&
(e.charAt(0)!=="i"?e=e.capitalize():e="i"+e.substring(1).capitalize()),e}.property("name").cacheable(),displayName:null,supportedFileExtensions:null,isDisabled:NO,isUnqualified:NO}),CK.AppInfo.mixin({_properties:["name","displayName","supportedFileExtensions","isDisabled","isUnqualified","supportedLocales"],serializeAsHash:function(e){var t=CK.AppInfo._properties,n={};for(var r=0;r<t.length;r++){var i=t[r];n[i]=e.get(i)}return n}}),CK.QuotaInfo=SC.Object.extend({storageUsageByMedia:null,familyStorageUsageInfo:null,totalStorageInBytes:null,commerceStorageInBytes:null,usedStorageInBytes:null,compStorageInBytes:null,overQuota:null,paidQuota:null,freeStorageInBytes:function(){return this.get("totalStorageInBytes")-this.get("usedStorageInBytes")}.property("usedStorageInBytes","totalStorageInBytes"),isAlmostOverQuota:function(){return this.get("almostOverQuota")||this.get("almostFull")||this.get("almost-full")}.property("almost-full","almostOverQuota","almostFull")}),CK.ServiceInfo=SC.Object.extend({name:undefined,url:undefined,isEnabled:undefined,pcsRequired:undefined,isServiceInCarryPartition:function(){return CK.isURLInCarryPartition(this.get("url"))}.property("url")}),CK.User=SC.Object.extend({statusCode:null,firstName:null,lastName:null,primaryEmail:null,isPaidDeveloper:NO,hsaEnabled:NO,hsaVersion:null,notificationId:null,isManagedAppleID:NO,brMigrated:NO,SafariBookmarksHasMigratedToCloudKit:NO,canShare:NO,countryCode:null,locale:null,idmsLocale:function(){var e=this.get("locale"),t=e.indexOf("_");return t===-1?e:e.substr(0,t)}.property("locale").cacheable(),isChineseAccount:
function(){return this.get("countryCode")==="CHN"}.property("countryCode").cacheable(),isHSA1Enabled:function(){return this.get("hsaEnabled")&&this.get("hsaVersion")===1}.property("hsaEnabled","hsaVersion"),isHSA2Enabled:function(){return this.get("hsaEnabled")&&this.get("hsaVersion")===2}.property("hsaEnabled","hsaVersion"),primaryEmailIsVerified:function(){return this.get("primaryEmailVerified")}.property(),displayName:function(){var e=this.get("firstName"),t=this.get("lastName"),n=this.get("displayablePrimaryAppleId");return CK.displayNameFor(e,t,n)}.property("firstName","lastName","displayablePrimaryAppleId"),isLiteAccount:function(){return this.get("statusCode")===CK.User.LITE}.property("statusCode"),appleId:function(e,t){var n=this.get("appleIdEntries");if(!n)return arguments.length===2&&(this._appleId=t),this._appleId;var r=this._getPrimaryAppleIdFromEntries(n);return r&&(r.type===CK.User.AppleIdEntryType.PHONE_NUMBER?r.formattedValue:r.value)||""}.property("appleIdEntries").cacheable(),normalizedPrimaryAppleId:function(){var e=this.get("appleIdEntries");if(!e)return this.get("appleId");var t=this._getPrimaryAppleIdFromEntries(e);return t&&(t.type===CK.User.AppleIdEntryType.PHONE_NUMBER?t.canonicalValue:t.value)||""}.property("appleIdEntries","appleId").cacheable(),displayablePrimaryAppleId:function(){var e=this.get("appleIdEntries");if(!e)return this.get("appleId");var t=this._getPrimaryAppleIdFromEntries(e);return t&&(t.type===CK.User.AppleIdEntryType.PHONE_NUMBER?t.formattedValue:t.value)||""}.property("appleIdEntries","appleId").cacheable(),primaryAppleIdType:function(
){var e=this.get("appleIdEntries");if(!e){var t=this.get("normalizedPrimaryAppleId");return CK.matchesFormatOfEmailAddress(t)?CK.User.AppleIdEntryType.EMAIL:CK.matchesFormatOfPhoneNumber(t)?CK.User.AppleIdEntryType.PHONE_NUMBER:undefined}var n=this._getPrimaryAppleIdFromEntries(e);return n&&n.type}.property("appleIdEntries").cacheable(),isPrimaryAppleIdTypePhoneNumber:function(){return this.get("primaryAppleIdType")===CK.User.AppleIdEntryType.PHONE_NUMBER}.property("primaryAppleIdType"),isPrimaryAppleIdTypeEmail:function(){return this.get("primaryAppleIdType")===CK.User.AppleIdEntryType.EMAIL}.property("primaryAppleIdType"),appleIdAlias:null,iCloudAppleIdAlias:null,appleIdEntries:null,dsid:null,isMyEmailAddressOrPhoneNumber:function(e){if(SC.empty(e))return!1;e=(e||"").toLowerCase();var t=this.get("_appleIdEmailsLookupTable");if(t[e])return!0;if(!CK.matchesFormatOfPhoneNumber(e))return!1;e=CK.normalizePhoneNumber(e);var n=this.get("_appleIdPhoneNumbersLookupTable");return n[e]?!0:!1},_appleIdEmailsLookupTable:function(){return this._buildAppleIdLookupTable(CK.User.AppleIdEntryType.EMAIL)}.property("appleId","primaryEmail","appleIdAliases","appleIdEntries").cacheable(),_appleIdPhoneNumbersLookupTable:function(){return this._buildAppleIdLookupTable(CK.User.AppleIdEntryType.PHONE_NUMBER)}.property("appleId","primaryEmail","appleIdAliases","appleIdEntries").cacheable(),hasEmailAddress:function(){var e=this.get("_appleIdEmailsLookupTable");return Object.keys(e).length>0}.property("_appleIdEmailsLookupTable").cacheable(),_buildAppleIdLookupTable:function(e){var t={},n=this.get("appleIdEntries"
);if(n){for(var r=0,i=n.length;r<i;++r){var s=n[r];if(e&&s.type!==e)continue;var o=(s.type===CK.User.AppleIdEntryType.PHONE_NUMBER?s.canonicalValue:s.value)||"";t[o.toLowerCase()]=!0}return t}if(e===CK.User.AppleIdEntryType.PHONE_NUMBER)return t;var u=this.get("appleId"),a=this.get("primaryEmail"),f=this.get("appleIdAliases");u&&(t[u.toLowerCase()]=!0),a&&(t[a.toLowerCase()]=!0);for(var r=0,i=f.length;r<i;++r){var l=f[r];l&&(t[l.toLowerCase()]=!0)}return t},_getPrimaryAppleIdFromEntries:function(e){for(var t=0,n=e&&e.length||0;t<n;++t){var r=e[t];if(r.isPrimary)return r}},updateAuthBag:function(e){var t=e&&e.dsInfo;if(!t)return;this._auth_bag=e,this.set(t)},_auth_bag:null,destroy:function(){var e=this._preferences_cache;return e&&e.destroy(),this._preferences_cache=null,arguments.callee.base.apply(this,arguments)}}),CK.User.mixin({PAID_LAPSED:-3,PAID_NOT_CREATED_YET:-2,FREE_NOT_CREATED_YET:-1,INACTIVE:0,PAID_ACTIVE:1,FREE_QUALIFIED:2,FREE_NOT_QUALIFIED:3,LITE:4,AppleIdEntryType:{PHONE_NUMBER:"PHONE_NUMBER",EMAIL:"EMAIL"},createFromAuthBag:function(e){var t=e&&e.dsInfo;if(!t)return;var n=CK.User.create();return n._auth_bag=e,n.set(t),n}}),String.prototype.startsWith||function(){"use strict";var e=function(){try{var e={},t=Object.defineProperty,n=t(e,e,e)&&t}catch(r){}return n}(),t={}.toString,n=function(e){if(this==null)throw TypeError();var n=String(this);if(e&&t.call(e)=="[object RegExp]")throw TypeError();var r=n.length,i=String(e),s=i.length,o=arguments.length>1?arguments[1]:undefined,u=o?Number(o):0;u!=u&&(u=0);var a=Math.min(Math.max(u,0),r);if(s+a>r)return!1;var f=-1;while(++
f<s)if(n.charCodeAt(a+f)!=i.charCodeAt(f))return!1;return!0};e?e(String.prototype,"startsWith",{value:n,configurable:!0,writable:!0}):String.prototype.startsWith=n}(),CK.RequestReporting={reportRequest:NO,reportPath:null,reportType:null,willSend:function(){var e=arguments.callee.base.apply(this,arguments);return window.CloudOS&&CloudOS.requestSent(),e},willReceive:function(e,t){var n=arguments.callee.base.apply(this,arguments);if(window.CloudOS){var r,i,s=URI(e.getFullAddress()),o=t.get("rawRequest"),u=o?o.response:undefined,a=o?o.status:undefined,f=this.get("reportRequest");if(!a||a>=500)i=t.get("encodedBody"),f||(this.set("reportPath",null),f=YES);f&&(r={httpMethod:this.get("reportType")||this.get("type"),statusCode:o?o.status:999,serverHostname:s.hostname(),urlPath:this.get("reportPath")||s.path(),clientTiming:SC.getCurrentTimeForPerformance()-t.get("addedToOutgoingQueueTimestamp"),uncompressedResponseSize:u?u.length:undefined}),CloudOS.requestReceived(r,a,e.getFullAddress(),i)}return n}},CK.SUPPLEMENTARY_LOCALE_DATA={likelySubtags:{aa:"aa-Latn-ET",ab:"ab-Cyrl-GE",ace:"ace-Latn-ID",ach:"ach-Latn-UG",ady:"ady-Cyrl-RU",af:"af-Latn-ZA",agq:"agq-Latn-CM",ak:"ak-Latn-GH",alt:"alt-Cyrl-RU",am:"am-Ethi-ET",amo:"amo-Latn-NG",aoz:"aoz-Latn-ID",ar:"ar-Arab-EG",as:"as-Beng-IN",asa:"asa-Latn-TZ",ast:"ast-Latn-ES",atj:"atj-Latn-CA",av:"av-Cyrl-RU",awa:"awa-Deva-IN",ay:"ay-Latn-BO",az:"az-Latn-AZ","az-Arab":"az-Arab-IR","az-IR":"az-Arab-IR","az-RU":"az-Cyrl-RU",ba:"ba-Cyrl-RU",bal:"bal-Arab-PK",ban:"ban-Latn-ID",bap:"bap-Deva-NP",bas:"bas-Latn-CM",bax:"bax-Bamu-CM",bbc:"bbc-Latn-ID",bbj
:"bbj-Latn-CM",be:"be-Cyrl-BY",bem:"bem-Latn-ZM",bez:"bez-Latn-TZ",bfd:"bfd-Latn-CM",bfq:"bfq-Taml-IN",bft:"bft-Arab-PK",bfy:"bfy-Deva-IN",bg:"bg-Cyrl-BG",bgx:"bgx-Grek-TR",bhb:"bhb-Deva-IN",bho:"bho-Deva-IN",bi:"bi-Latn-VU",bik:"bik-Latn-PH",bin:"bin-Latn-NG",bjj:"bjj-Deva-IN",bkm:"bkm-Latn-CM",bku:"bku-Latn-PH",bm:"bm-Latn-ML",bmq:"bmq-Latn-ML",bn:"bn-Beng-BD",bo:"bo-Tibt-CN",bqv:"bqv-Latn-CI",br:"br-Latn-FR",bra:"bra-Deva-IN",brx:"brx-Deva-IN",bs:"bs-Latn-BA",bss:"bss-Latn-CM",bto:"bto-Latn-PH",btv:"btv-Deva-PK",bua:"bua-Cyrl-RU",buc:"buc-Latn-YT",bug:"bug-Latn-ID",bum:"bum-Latn-CM",bvb:"bvb-Latn-GQ",bya:"bya-Latn-ID",byn:"byn-Ethi-ER",byv:"byv-Latn-CM",bze:"bze-Latn-ML",ca:"ca-Latn-ES",cch:"cch-Latn-NG",ccp:"ccp-Beng-IN",ce:"ce-Cyrl-RU",ceb:"ceb-Latn-PH",cgg:"cgg-Latn-UG",ch:"ch-Latn-GU",chk:"chk-Latn-FM",chm:"chm-Cyrl-RU",chp:"chp-Latn-CA",chr:"chr-Cher-US",cja:"cja-Arab-KH",cjm:"cjm-Cham-VN",ckb:"ckb-Arab-IQ",co:"co-Latn-FR",cr:"cr-Cans-CA",crj:"crj-Cans-CA",crk:"crk-Cans-CA",crl:"crl-Cans-CA",crm:"crm-Cans-CA",cs:"cs-Latn-CZ",csb:"csb-Latn-PL",csw:"csw-Cans-CA",cu:"cu-Cyrl-RU",cv:"cv-Cyrl-RU",cy:"cy-Latn-GB",da:"da-Latn-DK",dar:"dar-Cyrl-RU",dav:"dav-Latn-KE",de:"de-Latn-DE",den:"den-Latn-CA",dgr:"dgr-Latn-CA",dje:"dje-Latn-NE",dnj:"dnj-Latn-CI",doi:"doi-Arab-IN",dsb:"dsb-Latn-DE",dtm:"dtm-Latn-ML",dua:"dua-Latn-CM",dv:"dv-Thaa-MV",dyo:"dyo-Latn-SN",dyu:"dyu-Latn-BF",dz:"dz-Tibt-BT",ebu:"ebu-Latn-KE",ee:"ee-Latn-GH",efi:"efi-Latn-NG",el:"el-Grek-GR",en:"en-Latn-US",eo:"eo-Latn-001",es:"es-Latn-ES",et:"et-Latn-EE",eu:"eu-Latn-ES",ewo:"ewo-Latn-CM",fa:"fa-Arab-IR",fan:"fan-Latn-GQ"
,ff:"ff-Latn-SN",fi:"fi-Latn-FI",fil:"fil-Latn-PH",fit:"fit-Latn-SE",fj:"fj-Latn-FJ",fo:"fo-Latn-FO",fon:"fon-Latn-BJ",fr:"fr-Latn-FR",fur:"fur-Latn-IT",fy:"fy-Latn-NL",ga:"ga-Latn-IE",gaa:"gaa-Latn-GH",gag:"gag-Latn-MD",gbm:"gbm-Deva-IN",gcr:"gcr-Latn-GF",gd:"gd-Latn-GB",gez:"gez-Ethi-ET",ggn:"ggn-Deva-NP",gil:"gil-Latn-KI",gjk:"gjk-Arab-PK",gju:"gju-Arab-PK",gl:"gl-Latn-ES",gn:"gn-Latn-PY",gon:"gon-Telu-IN",gor:"gor-Latn-ID",gos:"gos-Latn-NL",grt:"grt-Beng-IN",gsw:"gsw-Latn-CH",gu:"gu-Gujr-IN",gub:"gub-Latn-BR",guz:"guz-Latn-KE",gv:"gv-Latn-IM",gvr:"gvr-Deva-NP",gwi:"gwi-Latn-CA",ha:"ha-Latn-NG","ha-CM":"ha-Arab-CM","ha-SD":"ha-Arab-SD",haw:"haw-Latn-US",he:"he-Hebr-IL",hi:"hi-Deva-IN",hil:"hil-Latn-PH",hnd:"hnd-Arab-PK",hne:"hne-Deva-IN",hnn:"hnn-Latn-PH",ho:"ho-Latn-PG",hoc:"hoc-Deva-IN",hoj:"hoj-Deva-IN",hr:"hr-Latn-HR",hsb:"hsb-Latn-DE",ht:"ht-Latn-HT",hu:"hu-Latn-HU",hy:"hy-Armn-AM",ia:"ia-Latn-FR",ibb:"ibb-Latn-NG",id:"id-Latn-ID",ig:"ig-Latn-NG",ii:"ii-Yiii-CN",ik:"ik-Latn-US",ilo:"ilo-Latn-PH","in":"in-Latn-ID",inh:"inh-Cyrl-RU",is:"is-Latn-IS",it:"it-Latn-IT",iu:"iu-Cans-CA",iw:"iw-Hebr-IL",ja:"ja-Jpan-JP",jgo:"jgo-Latn-CM",ji:"ji-Hebr-UA",jmc:"jmc-Latn-TZ",jml:"jml-Deva-NP",jv:"jv-Latn-ID",jw:"jw-Latn-ID",ka:"ka-Geor-GE",kaa:"kaa-Cyrl-UZ",kab:"kab-Latn-DZ",kaj:"kaj-Latn-NG",kam:"kam-Latn-KE",kao:"kao-Latn-ML",kbd:"kbd-Cyrl-RU",kcg:"kcg-Latn-NG",kck:"kck-Latn-ZW",kde:"kde-Latn-TZ",kdt:"kdt-Thai-TH",kea:"kea-Latn-CV",ken:"ken-Latn-CM",kfo:"kfo-Latn-CI",kfr:"kfr-Deva-IN",kg:"kg-Latn-CD",kge:"kge-Latn-ID",kgp:"kgp-Latn-BR",kha:"kha-Latn-IN",khb:"khb-Talu-CN",khq:"khq-Latn-ML"
,kht:"kht-Mymr-IN",khw:"khw-Arab-PK",ki:"ki-Latn-KE",kj:"kj-Latn-NA",kjg:"kjg-Laoo-LA",kk:"kk-Cyrl-KZ","kk-AF":"kk-Arab-AF","kk-Arab":"kk-Arab-CN","kk-CN":"kk-Arab-CN","kk-IR":"kk-Arab-IR","kk-MN":"kk-Arab-MN",kkj:"kkj-Latn-CM",kl:"kl-Latn-GL",kln:"kln-Latn-KE",km:"km-Khmr-KH",kmb:"kmb-Latn-AO",kn:"kn-Knda-IN",ko:"ko-Kore-KR",koi:"koi-Cyrl-RU",kok:"kok-Deva-IN",kos:"kos-Latn-FM",kpe:"kpe-Latn-LR",krc:"krc-Cyrl-RU",kri:"kri-Latn-SL",krl:"krl-Latn-RU",kru:"kru-Deva-IN",ks:"ks-Arab-IN",ksb:"ksb-Latn-TZ",ksf:"ksf-Latn-CM",ksh:"ksh-Latn-DE",ku:"ku-Latn-TR","ku-Arab":"ku-Arab-IQ","ku-LB":"ku-Arab-LB",kum:"kum-Cyrl-RU",kv:"kv-Cyrl-RU",kvr:"kvr-Latn-ID",kvx:"kvx-Arab-PK",kw:"kw-Latn-GB",kxp:"kxp-Arab-PK",ky:"ky-Cyrl-KG","ky-Arab":"ky-Arab-CN","ky-CN":"ky-Arab-CN","ky-Latn":"ky-Latn-TR","ky-TR":"ky-Latn-TR",la:"la-Latn-VA",lag:"lag-Latn-TZ",lah:"lah-Arab-PK",lb:"lb-Latn-LU",lbe:"lbe-Cyrl-RU",lbw:"lbw-Latn-ID",lcp:"lcp-Thai-CN",lep:"lep-Lepc-IN",lez:"lez-Cyrl-RU",lg:"lg-Latn-UG",li:"li-Latn-NL",lif:"lif-Deva-NP",lis:"lis-Lisu-CN",lki:"lki-Arab-IR",lkt:"lkt-Latn-US",lmn:"lmn-Telu-IN",lmo:"lmo-Latn-CH",ln:"ln-Latn-CD",lo:"lo-Laoo-LA",lol:"lol-Latn-CD",loz:"loz-Latn-ZM",lt:"lt-Latn-LT",lu:"lu-Latn-CD",lua:"lua-Latn-CD",luo:"luo-Latn-KE",luy:"luy-Latn-KE",luz:"luz-Arab-IR",lv:"lv-Latn-LV",lwl:"lwl-Thai-TH",mad:"mad-Latn-ID",maf:"maf-Latn-CM",mag:"mag-Deva-IN",mai:"mai-Deva-IN",mak:"mak-Latn-ID",man:"man-Latn-GM","man-GN":"man-Nkoo-GN","man-Nkoo":"man-Nkoo-GN",mas:"mas-Latn-KE",maz:"maz-Latn-MX",mdf:"mdf-Cyrl-RU",mdh:"mdh-Latn-PH",mdr:"mdr-Latn-ID",men:"men-Latn-SL",mer:"mer-Latn-KE",mfe:"mfe-Latn-MU"
,mg:"mg-Latn-MG",mgh:"mgh-Latn-MZ",mgo:"mgo-Latn-CM",mgp:"mgp-Deva-NP",mgy:"mgy-Latn-TZ",mh:"mh-Latn-MH",mi:"mi-Latn-NZ",min:"min-Latn-ID",mk:"mk-Cyrl-MK",ml:"ml-Mlym-IN",mn:"mn-Cyrl-MN","mn-CN":"mn-Mong-CN","mn-Mong":"mn-Mong-CN",mni:"mni-Beng-IN",mnw:"mnw-Mymr-MM",moe:"moe-Latn-CA",mos:"mos-Latn-BF",mr:"mr-Deva-IN",mrd:"mrd-Deva-NP",mrj:"mrj-Cyrl-RU",ms:"ms-Latn-MY","ms-CC":"ms-Arab-CC","ms-ID":"ms-Arab-ID",mt:"mt-Latn-MT",mua:"mua-Latn-CM",mvy:"mvy-Arab-PK",mwk:"mwk-Latn-ML",mwr:"mwr-Deva-IN",mxc:"mxc-Latn-ZW",my:"my-Mymr-MM",myv:"myv-Cyrl-RU",na:"na-Latn-NR",nap:"nap-Latn-IT",naq:"naq-Latn-NA",nb:"nb-Latn-NO",nch:"nch-Latn-MX",nd:"nd-Latn-ZW",nds:"nds-Latn-DE",ne:"ne-Deva-NP","new":"new-Deva-NP",ng:"ng-Latn-NA",nhe:"nhe-Latn-MX",nhw:"nhw-Latn-MX",nij:"nij-Latn-ID",niu:"niu-Latn-NU",nl:"nl-Latn-NL",nmg:"nmg-Latn-CM",nn:"nn-Latn-NO",nnh:"nnh-Latn-CM",no:"no-Latn-NO",nod:"nod-Lana-TH",nr:"nr-Latn-ZA",nsk:"nsk-Cans-CA",nso:"nso-Latn-ZA",nus:"nus-Latn-SD",nv:"nv-Latn-US",nxq:"nxq-Latn-CN",ny:"ny-Latn-MW",nym:"nym-Latn-TZ",nyn:"nyn-Latn-UG",oc:"oc-Latn-FR",om:"om-Latn-ET",or:"or-Orya-IN",os:"os-Cyrl-GE",pa:"pa-Guru-IN","pa-Arab":"pa-Arab-PK","pa-PK":"pa-Arab-PK",pag:"pag-Latn-PH",pam:"pam-Latn-PH",pap:"pap-Latn-AW",pau:"pau-Latn-PW",pcm:"pcm-Latn-NG",pko:"pko-Latn-KE",pl:"pl-Latn-PL",pon:"pon-Latn-FM",prd:"prd-Arab-IR",prg:"prg-Latn-001",ps:"ps-Arab-AF",pt:"pt-Latn-BR",puu:"puu-Latn-GA",qu:"qu-Latn-PE",raj:"raj-Latn-IN",rcf:"rcf-Latn-RE",rej:"rej-Latn-ID",ria:"ria-Latn-IN",rjs:"rjs-Deva-NP",rkt:"rkt-Beng-BD",rm:"rm-Latn-CH",rmf:"rmf-Latn-FI",rmo:"rmo-Latn-CH",rmt:"rmt-Arab-IR"
,rmu:"rmu-Latn-SE",rn:"rn-Latn-BI",rng:"rng-Latn-MZ",ro:"ro-Latn-RO",rob:"rob-Latn-ID",rof:"rof-Latn-TZ",ru:"ru-Cyrl-RU",rue:"rue-Cyrl-UA",rw:"rw-Latn-RW",rwk:"rwk-Latn-TZ",ryu:"ryu-Kana-JP",sa:"sa-Deva-IN",saf:"saf-Latn-GH",sah:"sah-Cyrl-RU",saq:"saq-Latn-KE",sas:"sas-Latn-ID",sat:"sat-Latn-IN",saz:"saz-Saur-IN",sbp:"sbp-Latn-TZ",scn:"scn-Latn-IT",sco:"sco-Latn-GB",scs:"scs-Latn-CA",sd:"sd-Arab-PK","sd-Deva":"sd-Deva-IN",sdh:"sdh-Arab-IR",se:"se-Latn-NO",sef:"sef-Latn-CI",seh:"seh-Latn-MZ",ses:"ses-Latn-ML",sg:"sg-Latn-CF",shi:"shi-Tfng-MA",shn:"shn-Mymr-MM",si:"si-Sinh-LK",sid:"sid-Latn-ET",sk:"sk-Latn-SK",sl:"sl-Latn-SI",sm:"sm-Latn-WS",sma:"sma-Latn-SE",smj:"smj-Latn-SE",smn:"smn-Latn-FI",sms:"sms-Latn-FI",sn:"sn-Latn-ZW",snk:"snk-Latn-ML",so:"so-Latn-SO",sq:"sq-Latn-AL",sr:"sr-Cyrl-RS","sr-ME":"sr-Latn-ME","sr-RO":"sr-Latn-RO","sr-RU":"sr-Latn-RU","sr-TR":"sr-Latn-TR",srn:"srn-Latn-SR",srr:"srr-Latn-SN",srx:"srx-Deva-IN",ss:"ss-Latn-ZA",ssy:"ssy-Latn-ER",st:"st-Latn-ZA",su:"su-Latn-ID",suk:"suk-Latn-TZ",sus:"sus-Latn-GN",sv:"sv-Latn-SE",sw:"sw-Latn-TZ",swb:"swb-Arab-YT",swc:"swc-Latn-CD",sxn:"sxn-Latn-ID",syl:"syl-Beng-BD",syr:"syr-Syrc-IQ",ta:"ta-Taml-IN",taj:"taj-Deva-NP",tbw:"tbw-Latn-PH",tcy:"tcy-Knda-IN",tdd:"tdd-Tale-CN",tdg:"tdg-Deva-NP",tdh:"tdh-Deva-NP",te:"te-Telu-IN",tem:"tem-Latn-SL",teo:"teo-Latn-UG",tet:"tet-Latn-TL",tg:"tg-Cyrl-TJ","tg-Arab":"tg-Arab-PK","tg-PK":"tg-Arab-PK",th:"th-Thai-TH",thl:"thl-Deva-NP",thq:"thq-Deva-NP",thr:"thr-Deva-NP",ti:"ti-Ethi-ET",tig:"tig-Ethi-ER",tiv:"tiv-Latn-NG",tk:"tk-Latn-TM",tkl:"tkl-Latn-TK",tkt:"tkt-Deva-NP",tl:"tl-Latn-PH"
,tmh:"tmh-Latn-NE",tn:"tn-Latn-ZA",to:"to-Latn-TO",tpi:"tpi-Latn-PG",tr:"tr-Latn-TR",trv:"trv-Latn-TW",ts:"ts-Latn-ZA",tsf:"tsf-Deva-NP",tsg:"tsg-Latn-PH",tsj:"tsj-Tibt-BT",tt:"tt-Cyrl-RU",ttj:"ttj-Latn-UG",tts:"tts-Thai-TH",tum:"tum-Latn-MW",tvl:"tvl-Latn-TV",twq:"twq-Latn-NE",ty:"ty-Latn-PF",tyv:"tyv-Cyrl-RU",tzm:"tzm-Latn-MA",udm:"udm-Cyrl-RU",ug:"ug-Arab-CN","ug-Cyrl":"ug-Cyrl-KZ","ug-KZ":"ug-Cyrl-KZ","ug-MN":"ug-Cyrl-MN",uk:"uk-Cyrl-UA",uli:"uli-Latn-FM",umb:"umb-Latn-AO",und:"en-Latn-US","und-002":"en-Latn-NG","und-003":"en-Latn-US","und-005":"pt-Latn-BR","und-009":"en-Latn-AU","und-011":"en-Latn-NG","und-013":"es-Latn-MX","und-014":"en-Latn-KE","und-015":"ar-Arab-EG","und-017":"sw-Latn-CD","und-018":"en-Latn-ZA","und-019":"en-Latn-US","und-021":"en-Latn-US","und-029":"es-Latn-CU","und-030":"zh-Hans-CN","und-034":"hi-Deva-IN","und-035":"id-Latn-ID","und-039":"it-Latn-IT","und-053":"en-Latn-AU","und-054":"en-Latn-PG","und-057":"en-Latn-KI","und-061":"sm-Latn-WS","und-142":"zh-Hans-CN","und-143":"uz-Latn-UZ","und-145":"ar-Arab-SA","und-150":"ru-Cyrl-RU","und-151":"ru-Cyrl-RU","und-154":"en-Latn-GB","und-155":"de-Latn-DE","und-419":"es-Latn-419","und-AD":"ca-Latn-AD","und-AE":"ar-Arab-AE","und-AF":"fa-Arab-AF","und-AL":"sq-Latn-AL","und-AM":"hy-Armn-AM","und-AO":"pt-Latn-AO","und-AQ":"und-Latn-AQ","und-AR":"es-Latn-AR","und-AS":"sm-Latn-AS","und-AT":"de-Latn-AT","und-AW":"nl-Latn-AW","und-AX":"sv-Latn-AX","und-AZ":"az-Latn-AZ","und-Arab":"ar-Arab-EG","und-Arab-CC":"ms-Arab-CC","und-Arab-CN":"ug-Arab-CN","und-Arab-GB":"ks-Arab-GB","und-Arab-ID":"ms-Arab-ID","und-Arab-IN":"ur-Arab-IN"
,"und-Arab-KH":"cja-Arab-KH","und-Arab-MN":"kk-Arab-MN","und-Arab-MU":"ur-Arab-MU","und-Arab-NG":"ha-Arab-NG","und-Arab-PK":"ur-Arab-PK","und-Arab-TJ":"fa-Arab-TJ","und-Arab-TR":"zza-Arab-TR","und-Arab-YT":"swb-Arab-YT","und-Armi":"arc-Armi-IR","und-Armn":"hy-Armn-AM","und-Avst":"ae-Avst-IR","und-BA":"bs-Latn-BA","und-BD":"bn-Beng-BD","und-BE":"nl-Latn-BE","und-BF":"fr-Latn-BF","und-BG":"bg-Cyrl-BG","und-BH":"ar-Arab-BH","und-BI":"rn-Latn-BI","und-BJ":"fr-Latn-BJ","und-BL":"fr-Latn-BL","und-BN":"ms-Latn-BN","und-BO":"es-Latn-BO","und-BQ":"pap-Latn-BQ","und-BR":"pt-Latn-BR","und-BT":"dz-Tibt-BT","und-BV":"und-Latn-BV","und-BY":"be-Cyrl-BY","und-Bali":"ban-Bali-ID","und-Bamu":"bax-Bamu-CM","und-Batk":"bbc-Batk-ID","und-Beng":"bn-Beng-BD","und-Bopo":"zh-Bopo-TW","und-Brah":"pra-Brah-IN","und-Brai":"und-Brai-FR","und-Bugi":"bug-Bugi-ID","und-Buhd":"bku-Buhd-PH","und-CD":"sw-Latn-CD","und-CF":"fr-Latn-CF","und-CG":"fr-Latn-CG","und-CH":"de-Latn-CH","und-CI":"fr-Latn-CI","und-CL":"es-Latn-CL","und-CM":"fr-Latn-CM","und-CN":"zh-Hans-CN","und-CO":"es-Latn-CO","und-CP":"und-Latn-CP","und-CR":"es-Latn-CR","und-CU":"es-Latn-CU","und-CV":"pt-Latn-CV","und-CW":"pap-Latn-CW","und-CY":"el-Grek-CY","und-CZ":"cs-Latn-CZ","und-Cakm":"ccp-Cakm-BD","und-Cans":"cr-Cans-CA","und-Cari":"xcr-Cari-TR","und-Cham":"cjm-Cham-VN","und-Cher":"chr-Cher-US","und-Copt":"cop-Copt-EG","und-Cprt":"grc-Cprt-CY","und-Cyrl":"ru-Cyrl-RU","und-Cyrl-AL":"mk-Cyrl-AL","und-Cyrl-BA":"sr-Cyrl-BA","und-Cyrl-GE":"ab-Cyrl-GE","und-Cyrl-GR":"mk-Cyrl-GR","und-Cyrl-MD":"uk-Cyrl-MD","und-Cyrl-PL":"be-Cyrl-PL","und-Cyrl-RO":"bg-Cyrl-RO"
,"und-Cyrl-SK":"uk-Cyrl-SK","und-Cyrl-TR":"kbd-Cyrl-TR","und-Cyrl-XK":"sr-Cyrl-XK","und-DE":"de-Latn-DE","und-DJ":"aa-Latn-DJ","und-DK":"da-Latn-DK","und-DO":"es-Latn-DO","und-DZ":"ar-Arab-DZ","und-Deva":"hi-Deva-IN","und-Deva-BT":"ne-Deva-BT","und-Deva-MU":"bho-Deva-MU","und-Deva-PK":"btv-Deva-PK","und-EA":"es-Latn-EA","und-EC":"es-Latn-EC","und-EE":"et-Latn-EE","und-EG":"ar-Arab-EG","und-EH":"ar-Arab-EH","und-ER":"ti-Ethi-ER","und-ES":"es-Latn-ES","und-ET":"am-Ethi-ET","und-EU":"en-Latn-GB","und-Egyp":"egy-Egyp-EG","und-Ethi":"am-Ethi-ET","und-FI":"fi-Latn-FI","und-FM":"chk-Latn-FM","und-FO":"fo-Latn-FO","und-FR":"fr-Latn-FR","und-GA":"fr-Latn-GA","und-GE":"ka-Geor-GE","und-GF":"fr-Latn-GF","und-GH":"ak-Latn-GH","und-GL":"kl-Latn-GL","und-GN":"fr-Latn-GN","und-GP":"fr-Latn-GP","und-GQ":"es-Latn-GQ","und-GR":"el-Grek-GR","und-GS":"und-Latn-GS","und-GT":"es-Latn-GT","und-GW":"pt-Latn-GW","und-Geor":"ka-Geor-GE","und-Glag":"cu-Glag-BG","und-Goth":"got-Goth-UA","und-Grek":"el-Grek-GR","und-Grek-TR":"bgx-Grek-TR","und-Gujr":"gu-Gujr-IN","und-Guru":"pa-Guru-IN","und-HK":"zh-Hant-HK","und-HM":"und-Latn-HM","und-HN":"es-Latn-HN","und-HR":"hr-Latn-HR","und-HT":"ht-Latn-HT","und-HU":"hu-Latn-HU","und-Hang":"ko-Hang-KR","und-Hani":"zh-Hani-CN","und-Hano":"hnn-Hano-PH","und-Hans":"zh-Hans-CN","und-Hant":"zh-Hant-TW","und-Hebr":"he-Hebr-IL","und-Hebr-CA":"yi-Hebr-CA","und-Hebr-GB":"yi-Hebr-GB","und-Hebr-SE":"yi-Hebr-SE","und-Hebr-UA":"yi-Hebr-UA","und-Hebr-US":"yi-Hebr-US","und-Hira":"ja-Hira-JP","und-IC":"es-Latn-IC","und-ID":"id-Latn-ID","und-IL":"he-Hebr-IL","und-IN":"hi-Deva-IN","und-IQ"
:"ar-Arab-IQ","und-IR":"fa-Arab-IR","und-IS":"is-Latn-IS","und-IT":"it-Latn-IT","und-Ital":"ett-Ital-IT","und-JO":"ar-Arab-JO","und-JP":"ja-Jpan-JP","und-Java":"jv-Java-ID","und-Jpan":"ja-Jpan-JP","und-KG":"ky-Cyrl-KG","und-KH":"km-Khmr-KH","und-KM":"ar-Arab-KM","und-KP":"ko-Kore-KP","und-KR":"ko-Kore-KR","und-KW":"ar-Arab-KW","und-KZ":"ru-Cyrl-KZ","und-Kali":"eky-Kali-MM","und-Kana":"ja-Kana-JP","und-Khar":"pra-Khar-PK","und-Khmr":"km-Khmr-KH","und-Knda":"kn-Knda-IN","und-Kore":"ko-Kore-KR","und-Kthi":"bh-Kthi-IN","und-LA":"lo-Laoo-LA","und-LB":"ar-Arab-LB","und-LI":"de-Latn-LI","und-LK":"si-Sinh-LK","und-LS":"st-Latn-LS","und-LT":"lt-Latn-LT","und-LU":"fr-Latn-LU","und-LV":"lv-Latn-LV","und-LY":"ar-Arab-LY","und-Lana":"nod-Lana-TH","und-Laoo":"lo-Laoo-LA","und-Latn-AF":"tk-Latn-AF","und-Latn-AM":"az-Latn-AM","und-Latn-BG":"tr-Latn-BG","und-Latn-CN":"za-Latn-CN","und-Latn-CY":"tr-Latn-CY","und-Latn-DZ":"fr-Latn-DZ","und-Latn-ET":"en-Latn-ET","und-Latn-GE":"ku-Latn-GE","und-Latn-GR":"tr-Latn-GR","und-Latn-IL":"ro-Latn-IL","und-Latn-IR":"tk-Latn-IR","und-Latn-KM":"fr-Latn-KM","und-Latn-KZ":"de-Latn-KZ","und-Latn-LB":"fr-Latn-LB","und-Latn-MA":"fr-Latn-MA","und-Latn-MK":"sq-Latn-MK","und-Latn-MO":"pt-Latn-MO","und-Latn-MR":"fr-Latn-MR","und-Latn-RU":"krl-Latn-RU","und-Latn-SY":"fr-Latn-SY","und-Latn-TN":"fr-Latn-TN","und-Latn-TW":"trv-Latn-TW","und-Latn-UA":"pl-Latn-UA","und-Lepc":"lep-Lepc-IN","und-Limb":"lif-Limb-IN","und-Linb":"grc-Linb-GR","und-Lisu":"lis-Lisu-CN","und-Lyci":"xlc-Lyci-TR","und-Lydi":"xld-Lydi-TR","und-MA":"ar-Arab-MA","und-MC":"fr-Latn-MC","und-MD":"ro-Latn-MD"
,"und-ME":"sr-Latn-ME","und-MF":"fr-Latn-MF","und-MG":"mg-Latn-MG","und-MK":"mk-Cyrl-MK","und-ML":"bm-Latn-ML","und-MM":"my-Mymr-MM","und-MN":"mn-Cyrl-MN","und-MO":"zh-Hant-MO","und-MQ":"fr-Latn-MQ","und-MR":"ar-Arab-MR","und-MT":"mt-Latn-MT","und-MU":"mfe-Latn-MU","und-MV":"dv-Thaa-MV","und-MX":"es-Latn-MX","und-MY":"ms-Latn-MY","und-MZ":"pt-Latn-MZ","und-Mand":"myz-Mand-IR","und-Merc":"xmr-Merc-SD","und-Mero":"xmr-Mero-SD","und-Mlym":"ml-Mlym-IN","und-Mong":"mn-Mong-CN","und-Mtei":"mni-Mtei-IN","und-Mymr":"my-Mymr-MM","und-Mymr-IN":"kht-Mymr-IN","und-Mymr-TH":"mnw-Mymr-TH","und-NA":"af-Latn-NA","und-NC":"fr-Latn-NC","und-NE":"ha-Latn-NE","und-NI":"es-Latn-NI","und-NL":"nl-Latn-NL","und-NO":"nb-Latn-NO","und-NP":"ne-Deva-NP","und-Nkoo":"man-Nkoo-GN","und-OM":"ar-Arab-OM","und-Ogam":"sga-Ogam-IE","und-Olck":"sat-Olck-IN","und-Orkh":"otk-Orkh-MN","und-Orya":"or-Orya-IN","und-Osma":"so-Osma-SO","und-PA":"es-Latn-PA","und-PE":"es-Latn-PE","und-PF":"fr-Latn-PF","und-PG":"tpi-Latn-PG","und-PH":"fil-Latn-PH","und-PK":"ur-Arab-PK","und-PL":"pl-Latn-PL","und-PM":"fr-Latn-PM","und-PR":"es-Latn-PR","und-PS":"ar-Arab-PS","und-PT":"pt-Latn-PT","und-PW":"pau-Latn-PW","und-PY":"gn-Latn-PY","und-Phag":"lzh-Phag-CN","und-Phli":"pal-Phli-IR","und-Phnx":"phn-Phnx-LB","und-Plrd":"hmd-Plrd-CN","und-Prti":"xpr-Prti-IR","und-QA":"ar-Arab-QA","und-QO":"en-Latn-IO","und-RE":"fr-Latn-RE","und-RO":"ro-Latn-RO","und-RS":"sr-Cyrl-RS","und-RU":"ru-Cyrl-RU","und-RW":"rw-Latn-RW","und-Rjng":"rej-Rjng-ID","und-Runr":"non-Runr-SE","und-SA":"ar-Arab-SA","und-SC":"fr-Latn-SC","und-SD":"ar-Arab-SD","und-SE":"sv-Latn-SE"
,"und-SI":"sl-Latn-SI","und-SJ":"nb-Latn-SJ","und-SK":"sk-Latn-SK","und-SM":"it-Latn-SM","und-SN":"fr-Latn-SN","und-SO":"so-Latn-SO","und-SR":"nl-Latn-SR","und-ST":"pt-Latn-ST","und-SV":"es-Latn-SV","und-SY":"ar-Arab-SY","und-Samr":"smp-Samr-IL","und-Sarb":"xsa-Sarb-YE","und-Saur":"saz-Saur-IN","und-Shaw":"en-Shaw-GB","und-Shrd":"sa-Shrd-IN","und-Sinh":"si-Sinh-LK","und-Sora":"srb-Sora-IN","und-Sund":"su-Sund-ID","und-Sylo":"syl-Sylo-BD","und-Syrc":"syr-Syrc-IQ","und-TD":"fr-Latn-TD","und-TF":"fr-Latn-TF","und-TG":"fr-Latn-TG","und-TH":"th-Thai-TH","und-TJ":"tg-Cyrl-TJ","und-TK":"tkl-Latn-TK","und-TL":"pt-Latn-TL","und-TM":"tk-Latn-TM","und-TN":"ar-Arab-TN","und-TO":"to-Latn-TO","und-TR":"tr-Latn-TR","und-TV":"tvl-Latn-TV","und-TW":"zh-Hant-TW","und-TZ":"sw-Latn-TZ","und-Tagb":"tbw-Tagb-PH","und-Takr":"doi-Takr-IN","und-Tale":"tdd-Tale-CN","und-Talu":"khb-Talu-CN","und-Taml":"ta-Taml-IN","und-Tavt":"blt-Tavt-VN","und-Telu":"te-Telu-IN","und-Tfng":"zgh-Tfng-MA","und-Tglg":"fil-Tglg-PH","und-Thaa":"dv-Thaa-MV","und-Thai":"th-Thai-TH","und-Thai-CN":"lcp-Thai-CN","und-Thai-KH":"kdt-Thai-KH","und-Thai-LA":"kdt-Thai-LA","und-Tibt":"bo-Tibt-CN","und-UA":"uk-Cyrl-UA","und-UG":"sw-Latn-UG","und-UY":"es-Latn-UY","und-UZ":"uz-Latn-UZ","und-Ugar":"uga-Ugar-SY","und-VA":"la-Latn-VA","und-VE":"es-Latn-VE","und-VN":"vi-Latn-VN","und-VU":"bi-Latn-VU","und-Vaii":"vai-Vaii-LR","und-WF":"fr-Latn-WF","und-WS":"sm-Latn-WS","und-XK":"sq-Latn-XK","und-Xpeo":"peo-Xpeo-IR","und-Xsux":"akk-Xsux-IQ","und-YE":"ar-Arab-YE","und-YT":"fr-Latn-YT","und-Yiii":"ii-Yiii-CN",unr:"unr-Beng-IN","unr-Deva":"unr-Deva-NP"
,"unr-NP":"unr-Deva-NP",unx:"unx-Beng-IN",ur:"ur-Arab-PK",uz:"uz-Latn-UZ","uz-AF":"uz-Arab-AF","uz-Arab":"uz-Arab-AF","uz-CN":"uz-Cyrl-CN",vai:"vai-Vaii-LR",ve:"ve-Latn-ZA",vi:"vi-Latn-VN",vic:"vic-Latn-SX",vo:"vo-Latn-001",vun:"vun-Latn-TZ",wa:"wa-Latn-BE",wae:"wae-Latn-CH",wal:"wal-Ethi-ET",war:"war-Latn-PH",wo:"wo-Latn-SN",xav:"xav-Latn-BR",xh:"xh-Latn-ZA",xog:"xog-Latn-UG",xsr:"xsr-Deva-NP",yao:"yao-Latn-MZ",yap:"yap-Latn-FM",yav:"yav-Latn-CM",ybb:"ybb-Latn-CM",yi:"yi-Hebr-UA",yo:"yo-Latn-NG",yua:"yua-Latn-MX",za:"za-Latn-CN",zea:"zea-Latn-NL",zgh:"zgh-Tfng-MA",zh:"zh-Hans-CN","zh-AU":"zh-Hant-AU","zh-BN":"zh-Hant-BN","zh-CN":"zh-Hans-CN","zh-GB":"zh-Hant-GB","zh-GF":"zh-Hant-GF","zh-HK":"zh-Hant-HK","zh-Hant":"zh-Hant-TW","zh-ID":"zh-Hant-ID","zh-MO":"zh-Hant-MO","zh-MY":"zh-Hant-MY","zh-PA":"zh-Hant-PA","zh-PF":"zh-Hant-PF","zh-PH":"zh-Hant-PH","zh-SR":"zh-Hant-SR","zh-TH":"zh-Hant-TH","zh-TW":"zh-Hant-TW","zh-US":"zh-Hant-US","zh-VN":"zh-Hant-VN",zmi:"zmi-Latn-MY",zu:"zu-Latn-ZA",zza:"zza-Arab-TR"},metadata:{alias:{languageAlias:{"aa-SAAHO":{_replacement:"ssy",_reason:"deprecated"},aar:{_replacement:"aa",_reason:"overlong"},abk:{_replacement:"ab",_reason:"overlong"},afr:{_replacement:"af",_reason:"overlong"},aju:{_replacement:"jrb",_reason:"macrolanguage"},aka:{_replacement:"ak",_reason:"overlong"},als:{_replacement:"sq",_reason:"macrolanguage"},amh:{_replacement:"am",_reason:"overlong"},ara:{_replacement:"ar",_reason:"overlong"},arb:{_replacement:"ar",_reason:"macrolanguage"},arg:{_replacement:"an",_reason:"overlong"},"art-lojban":{_replacement:"jbo",_reason:"deprecated"
},asm:{_replacement:"as",_reason:"overlong"},ava:{_replacement:"av",_reason:"overlong"},ave:{_replacement:"ae",_reason:"overlong"},aym:{_replacement:"ay",_reason:"overlong"},ayr:{_replacement:"ay",_reason:"macrolanguage"},aze:{_replacement:"az",_reason:"overlong"},azj:{_replacement:"az",_reason:"macrolanguage"},bak:{_replacement:"ba",_reason:"overlong"},bam:{_replacement:"bm",_reason:"overlong"},bcc:{_replacement:"bal",_reason:"macrolanguage"},bcl:{_replacement:"bik",_reason:"macrolanguage"},bel:{_replacement:"be",_reason:"overlong"},ben:{_replacement:"bn",_reason:"overlong"},bih:{_replacement:"bh",_reason:"overlong"},bis:{_replacement:"bi",_reason:"overlong"},bod:{_replacement:"bo",_reason:"overlong"},bos:{_replacement:"bs",_reason:"overlong"},bre:{_replacement:"br",_reason:"overlong"},bul:{_replacement:"bg",_reason:"overlong"},bxk:{_replacement:"luy",_reason:"macrolanguage"},bxr:{_replacement:"bua",_reason:"macrolanguage"},cat:{_replacement:"ca",_reason:"overlong"},ces:{_replacement:"cs",_reason:"overlong"},cha:{_replacement:"ch",_reason:"overlong"},che:{_replacement:"ce",_reason:"overlong"},chu:{_replacement:"cu",_reason:"overlong"},chv:{_replacement:"cv",_reason:"overlong"},cld:{_replacement:"syr",_reason:"macrolanguage"},cmn:{_replacement:"zh",_reason:"macrolanguage"},cor:{_replacement:"kw",_reason:"overlong"},cos:{_replacement:"co",_reason:"overlong"},cre:{_replacement:"cr",_reason:"overlong"},cwd:{_replacement:"cr",_reason:"macrolanguage"},cym:{_replacement:"cy",_reason:"overlong"},dan:{_replacement:"da",_reason:"overlong"},deu:{_replacement:"de",_reason:"overlong"},dgo
:{_replacement:"doi",_reason:"macrolanguage"},dhd:{_replacement:"mwr",_reason:"macrolanguage"},dik:{_replacement:"din",_reason:"macrolanguage"},diq:{_replacement:"zza",_reason:"macrolanguage"},div:{_replacement:"dv",_reason:"overlong"},dzo:{_replacement:"dz",_reason:"overlong"},ekk:{_replacement:"et",_reason:"macrolanguage"},ell:{_replacement:"el",_reason:"overlong"},emk:{_replacement:"man",_reason:"macrolanguage"},eng:{_replacement:"en",_reason:"overlong"},epo:{_replacement:"eo",_reason:"overlong"},esk:{_replacement:"ik",_reason:"macrolanguage"},est:{_replacement:"et",_reason:"overlong"},eus:{_replacement:"eu",_reason:"overlong"},ewe:{_replacement:"ee",_reason:"overlong"},fao:{_replacement:"fo",_reason:"overlong"},fas:{_replacement:"fa",_reason:"overlong"},fat:{_replacement:"ak",_reason:"macrolanguage"},fij:{_replacement:"fj",_reason:"overlong"},fin:{_replacement:"fi",_reason:"overlong"},fra:{_replacement:"fr",_reason:"overlong"},fry:{_replacement:"fy",_reason:"overlong"},fuc:{_replacement:"ff",_reason:"macrolanguage"},ful:{_replacement:"ff",_reason:"overlong"},gaz:{_replacement:"om",_reason:"macrolanguage"},gbo:{_replacement:"grb",_reason:"macrolanguage"},gla:{_replacement:"gd",_reason:"overlong"},gle:{_replacement:"ga",_reason:"overlong"},glg:{_replacement:"gl",_reason:"overlong"},glv:{_replacement:"gv",_reason:"overlong"},gno:{_replacement:"gon",_reason:"macrolanguage"},grn:{_replacement:"gn",_reason:"overlong"},gug:{_replacement:"gn",_reason:"macrolanguage"},guj:{_replacement:"gu",_reason:"overlong"},gya:{_replacement:"gba",_reason:"macrolanguage"},hat:{_replacement:"ht"
,_reason:"overlong"},hau:{_replacement:"ha",_reason:"overlong"},hbs:{_replacement:"sr-Latn",_reason:"overlong"},hdn:{_replacement:"hai",_reason:"macrolanguage"},hea:{_replacement:"hmn",_reason:"macrolanguage"},heb:{_replacement:"he",_reason:"overlong"},her:{_replacement:"hz",_reason:"overlong"},him:{_replacement:"srx",_reason:"macrolanguage"},hin:{_replacement:"hi",_reason:"overlong"},hmo:{_replacement:"ho",_reason:"overlong"},hrv:{_replacement:"hr",_reason:"overlong"},hun:{_replacement:"hu",_reason:"overlong"},hye:{_replacement:"hy",_reason:"overlong"},"i-ami":{_replacement:"ami",_reason:"deprecated"},"i-bnn":{_replacement:"bnn",_reason:"deprecated"},"i-hak":{_replacement:"hak",_reason:"deprecated"},"i-klingon":{_replacement:"tlh",_reason:"deprecated"},"i-lux":{_replacement:"lb",_reason:"deprecated"},"i-navajo":{_replacement:"nv",_reason:"deprecated"},"i-pwn":{_replacement:"pwn",_reason:"deprecated"},"i-tao":{_replacement:"tao",_reason:"deprecated"},"i-tay":{_replacement:"tay",_reason:"deprecated"},"i-tsu":{_replacement:"tsu",_reason:"deprecated"},ibo:{_replacement:"ig",_reason:"overlong"},ido:{_replacement:"io",_reason:"overlong"},iii:{_replacement:"ii",_reason:"overlong"},ike:{_replacement:"iu",_reason:"macrolanguage"},iku:{_replacement:"iu",_reason:"overlong"},ile:{_replacement:"ie",_reason:"overlong"},"in":{_replacement:"id",_reason:"deprecated"},ina:{_replacement:"ia",_reason:"overlong"},ind:{_replacement:"id",_reason:"overlong"},ipk:{_replacement:"ik",_reason:"overlong"},isl:{_replacement:"is",_reason:"overlong"},ita:{_replacement:"it",_reason:"overlong"},iw:{_replacement
:"he",_reason:"deprecated"},jav:{_replacement:"jv",_reason:"overlong"},ji:{_replacement:"yi",_reason:"deprecated"},jpn:{_replacement:"ja",_reason:"overlong"},jw:{_replacement:"jv",_reason:"deprecated"},kal:{_replacement:"kl",_reason:"overlong"},kan:{_replacement:"kn",_reason:"overlong"},kas:{_replacement:"ks",_reason:"overlong"},kat:{_replacement:"ka",_reason:"overlong"},kau:{_replacement:"kr",_reason:"overlong"},kaz:{_replacement:"kk",_reason:"overlong"},khk:{_replacement:"mn",_reason:"macrolanguage"},khm:{_replacement:"km",_reason:"overlong"},kik:{_replacement:"ki",_reason:"overlong"},kin:{_replacement:"rw",_reason:"overlong"},kir:{_replacement:"ky",_reason:"overlong"},kmr:{_replacement:"ku",_reason:"macrolanguage"},knc:{_replacement:"kr",_reason:"macrolanguage"},kng:{_replacement:"kg",_reason:"macrolanguage"},knn:{_replacement:"kok",_reason:"macrolanguage"},kom:{_replacement:"kv",_reason:"overlong"},kon:{_replacement:"kg",_reason:"overlong"},kor:{_replacement:"ko",_reason:"overlong"},kpv:{_replacement:"kv",_reason:"macrolanguage"},kua:{_replacement:"kj",_reason:"overlong"},kur:{_replacement:"ku",_reason:"overlong"},lao:{_replacement:"lo",_reason:"overlong"},lat:{_replacement:"la",_reason:"overlong"},lav:{_replacement:"lv",_reason:"overlong"},lbk:{_replacement:"bnc",_reason:"macrolanguage"},lim:{_replacement:"li",_reason:"overlong"},lin:{_replacement:"ln",_reason:"overlong"},lit:{_replacement:"lt",_reason:"overlong"},ltz:{_replacement:"lb",_reason:"overlong"},lub:{_replacement:"lu",_reason:"overlong"},lug:{_replacement:"lg",_reason:"overlong"},lvs:{_replacement:"lv",_reason
:"macrolanguage"},mah:{_replacement:"mh",_reason:"overlong"},mal:{_replacement:"ml",_reason:"overlong"},mar:{_replacement:"mr",_reason:"overlong"},mhr:{_replacement:"chm",_reason:"macrolanguage"},mkd:{_replacement:"mk",_reason:"overlong"},mlg:{_replacement:"mg",_reason:"overlong"},mlt:{_replacement:"mt",_reason:"overlong"},mnk:{_replacement:"man",_reason:"macrolanguage"},mo:{_replacement:"ro-MD",_reason:"deprecated"},mol:{_replacement:"ro-MD",_reason:"overlong"},mon:{_replacement:"mn",_reason:"overlong"},mri:{_replacement:"mi",_reason:"overlong"},msa:{_replacement:"ms",_reason:"overlong"},mup:{_replacement:"raj",_reason:"macrolanguage"},mya:{_replacement:"my",_reason:"overlong"},nau:{_replacement:"na",_reason:"overlong"},nav:{_replacement:"nv",_reason:"overlong"},nbl:{_replacement:"nr",_reason:"overlong"},nde:{_replacement:"nd",_reason:"overlong"},ndo:{_replacement:"ng",_reason:"overlong"},nep:{_replacement:"ne",_reason:"overlong"},nld:{_replacement:"nl",_reason:"overlong"},nno:{_replacement:"nn",_reason:"overlong"},no:{_replacement:"nb",_reason:"legacy"},"no-BOKMAL":{_replacement:"nb",_reason:"deprecated"},"no-NYNORSK":{_replacement:"nn",_reason:"deprecated"},"no-bok":{_replacement:"nb",_reason:"deprecated"},"no-nyn":{_replacement:"nn",_reason:"deprecated"},nob:{_replacement:"nb",_reason:"overlong"},nor:{_replacement:"nb",_reason:"overlong"},npi:{_replacement:"ne",_reason:"macrolanguage"},nya:{_replacement:"ny",_reason:"overlong"},oci:{_replacement:"oc",_reason:"overlong"},ojg:{_replacement:"oj",_reason:"macrolanguage"},oji:{_replacement:"oj",_reason:"overlong"},ori:{_replacement
:"or",_reason:"overlong"},orm:{_replacement:"om",_reason:"overlong"},ory:{_replacement:"or",_reason:"macrolanguage"},oss:{_replacement:"os",_reason:"overlong"},pan:{_replacement:"pa",_reason:"overlong"},pbu:{_replacement:"ps",_reason:"macrolanguage"},pes:{_replacement:"fa",_reason:"macrolanguage"},pli:{_replacement:"pi",_reason:"overlong"},plt:{_replacement:"mg",_reason:"macrolanguage"},pnb:{_replacement:"lah",_reason:"macrolanguage"},pol:{_replacement:"pl",_reason:"overlong"},por:{_replacement:"pt",_reason:"overlong"},pus:{_replacement:"ps",_reason:"overlong"},que:{_replacement:"qu",_reason:"overlong"},qxp:{_replacement:"qu",_reason:"macrolanguage"},rmy:{_replacement:"rom",_reason:"macrolanguage"},roh:{_replacement:"rm",_reason:"overlong"},ron:{_replacement:"ro",_reason:"overlong"},run:{_replacement:"rn",_reason:"overlong"},rus:{_replacement:"ru",_reason:"overlong"},sag:{_replacement:"sg",_reason:"overlong"},san:{_replacement:"sa",_reason:"overlong"},"sgn-BE-FR":{_replacement:"sfb",_reason:"deprecated"},"sgn-BE-NL":{_replacement:"vgt",_reason:"deprecated"},"sgn-CH-DE":{_replacement:"sgg",_reason:"deprecated"},sh:{_replacement:"sr-Latn",_reason:"legacy"},sin:{_replacement:"si",_reason:"overlong"},slk:{_replacement:"sk",_reason:"overlong"},slv:{_replacement:"sl",_reason:"overlong"},sme:{_replacement:"se",_reason:"overlong"},smo:{_replacement:"sm",_reason:"overlong"},sna:{_replacement:"sn",_reason:"overlong"},snd:{_replacement:"sd",_reason:"overlong"},som:{_replacement:"so",_reason:"overlong"},sot:{_replacement:"st",_reason:"overlong"},spa:{_replacement:"es",_reason:"overlong"
},spy:{_replacement:"kln",_reason:"macrolanguage"},sqi:{_replacement:"sq",_reason:"overlong"},src:{_replacement:"sc",_reason:"macrolanguage"},srd:{_replacement:"sc",_reason:"overlong"},srp:{_replacement:"sr",_reason:"overlong"},ssw:{_replacement:"ss",_reason:"overlong"},sun:{_replacement:"su",_reason:"overlong"},swa:{_replacement:"sw",_reason:"overlong"},swe:{_replacement:"sv",_reason:"overlong"},swh:{_replacement:"sw",_reason:"macrolanguage"},tah:{_replacement:"ty",_reason:"overlong"},tam:{_replacement:"ta",_reason:"overlong"},tat:{_replacement:"tt",_reason:"overlong"},tel:{_replacement:"te",_reason:"overlong"},tgk:{_replacement:"tg",_reason:"overlong"},tgl:{_replacement:"fil",_reason:"overlong"},tha:{_replacement:"th",_reason:"overlong"},tir:{_replacement:"ti",_reason:"overlong"},tl:{_replacement:"fil",_reason:"legacy"},ton:{_replacement:"to",_reason:"overlong"},tsn:{_replacement:"tn",_reason:"overlong"},tso:{_replacement:"ts",_reason:"overlong"},ttq:{_replacement:"tmh",_reason:"macrolanguage"},tuk:{_replacement:"tk",_reason:"overlong"},tur:{_replacement:"tr",_reason:"overlong"},tw:{_replacement:"ak",_reason:"macrolanguage"},twi:{_replacement:"ak",_reason:"overlong"},uig:{_replacement:"ug",_reason:"overlong"},ukr:{_replacement:"uk",_reason:"overlong"},umu:{_replacement:"del",_reason:"macrolanguage"},urd:{_replacement:"ur",_reason:"overlong"},uzb:{_replacement:"uz",_reason:"overlong"},uzn:{_replacement:"uz",_reason:"macrolanguage"},ven:{_replacement:"ve",_reason:"overlong"},vie:{_replacement:"vi",_reason:"overlong"},vol:{_replacement:"vo",_reason:"overlong"},wln:{_replacement
:"wa",_reason:"overlong"},wol:{_replacement:"wo",_reason:"overlong"},xho:{_replacement:"xh",_reason:"overlong"},xpe:{_replacement:"kpe",_reason:"macrolanguage"},xsl:{_replacement:"den",_reason:"macrolanguage"},ydd:{_replacement:"yi",_reason:"macrolanguage"},yid:{_replacement:"yi",_reason:"overlong"},yor:{_replacement:"yo",_reason:"overlong"},zai:{_replacement:"zap",_reason:"macrolanguage"},"zh-guoyu":{_replacement:"zh",_reason:"deprecated"},"zh-hakka":{_replacement:"hak",_reason:"deprecated"},"zh-min":{_reason:"deprecated"},"zh-min-nan":{_replacement:"nan",_reason:"deprecated"},"zh-xiang":{_replacement:"hsn",_reason:"deprecated"},zha:{_replacement:"za",_reason:"overlong"},zho:{_replacement:"zh",_reason:"overlong"},zsm:{_replacement:"ms",_reason:"macrolanguage"},zul:{_replacement:"zu",_reason:"overlong"},zyb:{_replacement:"za",_reason:"macrolanguage"}}}}},CK.SUPPORTED_REGION_FORMATS=["af","af-na","af-za","agq","agq-cm","ak","ak-gh","am","am-et","ar","ar-001","ar-ae","ar-bh","ar-dj","ar-dz","ar-eg","ar-eh","ar-er","ar-il","ar-iq","ar-jo","ar-km","ar-kw","ar-lb","ar-ly","ar-ma","ar-mr","ar-om","ar-ps","ar-qa","ar-sa","ar-sd","ar-so","ar-ss","ar-sy","ar-td","ar-tn","ar-ye","as","as-in","asa","asa-tz","az","az-cyrl","az-cyrl-az","az-latn","az-latn-az","bas","bas-cm","be","be-by","bem","bem-zm","bez","bez-tz","bg","bg-bg","bm","bm-ml","bn","bn-bd","bn-in","bo","bo-cn","bo-in","br","br-fr","brx","brx-in","bs","bs-cyrl","bs-cyrl-ba","bs-latn","bs-latn-ba","ca","ca-ad","ca-es","ca-fr","ca-it","cgg","cgg-ug","chr","chr-us","ckb","cs","cs-cz","cy","cy-gb","da","da-dk","da-gl","dav","dav-ke"
,"de","de-at","de-be","de-ch","de-de","de-li","de-lu","dje","dje-ne","dua","dua-cm","dyo","dyo-sn","dz","dz-bt","ebu","ebu-ke","ee","ee-gh","ee-tg","el","el-cy","el-gr","en","en-001","en-150","en-ad","en-ag","en-ai","en-al","en-as","en-at","en-au","en-ba","en-bb","en-be","en-bm","en-bs","en-bw","en-bz","en-ca","en-cc","en-ch","en-ck","en-cm","en-cx","en-cy","en-cz","en-de","en-dg","en-dk","en-dm","en-ee","en-er","en-es","en-fi","en-fj","en-fk","en-fm","en-fr","en-gb","en-gd","en-gg","en-gh","en-gi","en-gm","en-gu","en-gy","en-hk","en-hr","en-hu","en-ie","en-im","en-in","en-io","en-is","en-it","en-je","en-jm","en-ke","en-ki","en-kn","en-ky","en-lc","en-lr","en-ls","en-lt","en-lu","en-lv","en-me","en-mg","en-mh","en-mo","en-mp","en-ms","en-mt","en-mu","en-mw","en-na","en-nf","en-ng","en-nl","en-no","en-nr","en-nu","en-nz","en-pg","en-ph","en-pk","en-pl","en-pn","en-pr","en-pt","en-pw","en-ro","en-ru","en-rw","en-sb","en-sc","en-sd","en-se","en-sg","en-sh","en-si","en-sk","en-sl","en-ss","en-sx","en-sz","en-tc","en-tk","en-to","en-tr","en-tt","en-tv","en-tz","en-ug","en-um","en-us","en-us-posix","en-vc","en-vg","en-vi","en-vu","en-ws","en-za","en-zm","en-zw","eo","es","es-419","es-ar","es-bo","es-cl","es-co","es-cr","es-cu","es-do","es-ea","es-ec","es-es","es-gq","es-gt","es-hn","es-ic","es-mx","es-ni","es-pa","es-pe","es-ph","es-pr","es-py","es-sv","es-us","es-uy","es-ve","et","et-ee","eu","eu-es","ewo","ewo-cm","fa","fa-af","fa-ir","ff","ff-sn","fi","fi-fi","fil","fil-ph","fo","fo-fo","fr","fr-be","fr-bf","fr-bi","fr-bj","fr-bl","fr-ca","fr-cd","fr-cf","fr-cg","fr-ch","fr-ci"
,"fr-cm","fr-dj","fr-dz","fr-fr","fr-ga","fr-gf","fr-gn","fr-gp","fr-gq","fr-ht","fr-km","fr-lu","fr-ma","fr-mc","fr-mf","fr-mg","fr-ml","fr-mq","fr-mr","fr-mu","fr-nc","fr-ne","fr-pf","fr-pm","fr-re","fr-rw","fr-sc","fr-sn","fr-sy","fr-td","fr-tg","fr-tn","fr-vu","fr-wf","fr-yt","ga","ga-ie","gl","gl-es","gsw","gsw-ch","gsw-li","gu","gu-in","guz","guz-ke","gv","gv-im","ha","ha-latn","ha-latn-gh","ha-latn-ne","ha-latn-ng","haw","haw-us","he","he-il","hi","hi-in","hr","hr-ba","hr-hr","hu","hu-hu","hy","hy-am","id","id-id","ig","ig-ng","ii","ii-cn","is","is-is","it","it-ch","it-it","it-sm","iu","iu-cans","iu-cans-ca","ja","ja-jp","jgo","jgo-cm","jmc","jmc-tz","ka","ka-ge","kab","kab-dz","kam","kam-ke","kde","kde-tz","kea","kea-cv","khq","khq-ml","ki","ki-ke","kk","kk-cyrl","kk-cyrl-kz","kkj","kkj-cm","kl","kl-gl","kln","kln-ke","km","km-kh","kn","kn-in","ko","ko-kp","ko-kr","kok","kok-in","ks","ks-arab","ks-arab-in","ksb","ksb-tz","ksf","ksf-cm","kw","kw-gb","ky","ky-cyrl","ky-cyrl-kg","lag","lag-tz","lg","lg-ug","lkt","lkt-us","ln","ln-ao","ln-cd","ln-cf","ln-cg","lo","lo-la","lt","lt-lt","lu","lu-cd","luo","luo-ke","luy","luy-ke","lv","lv-lv","mas","mas-ke","mas-tz","mer","mer-ke","mfe","mfe-mu","mg","mg-mg","mgh","mgh-mz","mgo","mgo-cm","mk","mk-mk","ml","ml-in","mn","mn-cyrl","mn-cyrl-mn","mr","mr-in","ms","ms-arab","ms-arab-bn","ms-arab-my","ms-latn","ms-latn-bn","ms-latn-my","ms-latn-sg","mt","mt-mt","mua","mua-cm","my","my-mm","naq","naq-na","nb","nb-no","nb-sj","nd","nd-zw","ne","ne-in","ne-np","nl","nl-aw","nl-be","nl-bq","nl-cw","nl-nl","nl-sr","nl-sx","nmg","nmg-cm"
,"nn","nn-no","nnh","nnh-cm","nus","nus-sd","nyn","nyn-ug","om","om-et","om-ke","or","or-in","pa","pa-arab","pa-arab-pk","pa-guru","pa-guru-in","pl","pl-pl","ps","ps-af","pt","pt-ao","pt-br","pt-cv","pt-gw","pt-mo","pt-mz","pt-pt","pt-st","pt-tl","rm","rm-ch","rn","rn-bi","ro","ro-md","ro-ro","rof","rof-tz","ru","ru-by","ru-kg","ru-kz","ru-md","ru-ru","ru-ua","rw","rw-rw","rwk","rwk-tz","saq","saq-ke","sbp","sbp-tz","seh","seh-mz","ses","ses-ml","sg","sg-cf","shi","shi-latn","shi-latn-ma","shi-tfng","shi-tfng-ma","si","si-lk","sk","sk-sk","sl","sl-si","sn","sn-zw","so","so-dj","so-et","so-ke","so-so","sq","sq-al","sq-mk","sq-xk","sr","sr-cyrl","sr-cyrl-ba","sr-cyrl-me","sr-cyrl-rs","sr-cyrl-xk","sr-latn","sr-latn-ba","sr-latn-me","sr-latn-rs","sr-latn-xk","sv","sv-ax","sv-fi","sv-se","sw","sw-ke","sw-tz","sw-ug","swc","swc-cd","ta","ta-in","ta-lk","ta-my","ta-sg","te","te-in","teo","teo-ke","teo-ug","tg","tg-cyrl","tg-cyrl-tj","th","th-th","ti","ti-er","ti-et","tk","tk-latn","tk-latn-tm","to","to-to","tr","tr-cy","tr-tr","twq","twq-ne","tzm","tzm-latn","tzm-latn-ma","ug","ug-arab","ug-arab-cn","uk","uk-ua","ur","ur-in","ur-pk","uz","uz-arab","uz-arab-af","uz-cyrl","uz-cyrl-uz","uz-latn","uz-latn-uz","vai","vai-latn","vai-latn-lr","vai-vaii","vai-vaii-lr","vi","vi-vn","vun","vun-tz","xog","xog-ug","yav","yav-cm","yo","yo-bj","yo-ng","zgh","zgh-ma","zh","zh-hans","zh-hans-cn","zh-hans-hk","zh-hans-mo","zh-hans-sg","zh-hant","zh-hant-hk","zh-hant-mo","zh-hant-tw","zu","zu-za"],CW.INVALID_LAYOUT_QUALITY=-2,CW.BAD_LAYOUT_QUALITY=-1,CW.OKAY_LAYOUT_QUALITY=0,CW.GOOD_LAYOUT_QUALITY=1
,CW.PERFECT_LAYOUT_QUALITY=2,CW.PickerLayout=SC.Object.extend({owner:null,renderDelegateName:"panelRenderDelegate",theme:null,themeBinding:SC.Binding.oneWay("*owner.renderTheme"),controlSize:null,controlSizeBinding:SC.Binding.oneWay("*owner.controlSize"),renderDelegate:function(){var e=this.get("theme");return e?e[this.get("renderDelegateName")]:null}.property("theme","renderDelegateName"),renderDelegateProxy:function(){return this}.property().cacheable(),pointAtRectangle:{left:0,top:0,width:0,height:0},pointAtRectangleBinding:SC.Binding.oneWay("*owner.pointAtRectangle"),pointAtPoint:function(){var e=this.get("pointAtRectangle");return{left:e.left+e.width/2,top:e.top+e.height/2}}.property("pointAtRectangle").cacheable(),availableSpace:{width:0,height:0},availableSpaceBinding:SC.Binding.oneWay("*owner.availableSpace"),desiredSize:{width:320,height:400},desiredSizeBinding:SC.Binding.oneWay("*owner.desiredSize"),minimumSize:{width:320,height:200},minimumSizeBinding:SC.Binding.oneWay("*owner.minimumSize"),layout:{top:0,left:0,width:100,height:100},layoutQuality:CW.INVALID_LAYOUT_QUALITY,layoutNeedsUpdate:NO,reasonsForRelayout:SC.CoreSet.create(),init:function(){arguments.callee.base.apply(this,arguments),this._reasonsForRelayout=SC.CoreSet.create()},scheduleRedraw:function(){if(!this.get("owner"))return;this.get("owner").pickerLayoutNeedsRedraw(this)},layoutDidChange:function(){var e=this.get("layout"),t=this._previousLayout||{};(e.left!==t.left||e.top!==t.top||e.width!==t.width||e.height!==t.height)&&this.scheduleRedraw(),this._previousLayout=e}.observes("layout"),scheduleLayout
:function(e){this.set("layoutNeedsUpdate",YES);if(!e)return;typeof e=="string"&&(e=[e]),this._reasonsForRelayout.addEach(e)},computeLayout:function(){this.set("reasonsForRelayout",this._reasonsForRelayout),this._reasonsForRelayout=SC.CoreSet.create(),this.set("layoutNeedsUpdate",NO)},computeLayoutIfNeeded:function(){if(!this.get("layoutNeedsUpdate"))return;this.computeLayout()},_scpl_layoutNeedsUpdateDidChange:function(){if(!this.get("layoutNeedsUpdate"))return;var e=this.get("owner");if(!e)return;e.pickerLayoutNeedsUpdate(this)}.observes("layoutNeedsUpdate"),render:function(e){var t=this.get("renderDelegate");t&&(e.addClass(t.className),e.addClass(this.get("theme").classNames),t.render(this.get("renderDelegateProxy"),e))},update:function(e){var t=this.get("renderDelegate");t&&(e.addClass(t.className),e.addClass(this.get("theme").classNames),t.update(this.get("renderDelegateProxy"),e))},isBetterThanLayout:function(e){return this.get("layoutQuality")>e.get("layoutQuality")}}),CW.LEFT_SIDE="left",CW.RIGHT_SIDE="right",CW.TOP_SIDE="top",CW.BOTTOM_SIDE="bottom",CW.RELAYOUT_FOR_WINDOW="window",CW.RELAYOUT_FOR_TARGET="target",CW.RELAYOUT_FOR_DESIRED_SIZE="desired-size",CW.RELAYOUT_FOR_MINIMUM_SIZE="minimum-size",CW.PickerLayout.OnSide=CW.PickerLayout.extend({renderDelegateName:"cwPickerBackgroundRenderDelegate",pointAtSide:CW.RIGHT_SIDE,requiresSlices:NO,pointAtPoint:function(){var e=this.get("pointAtRectangle"),t=this.get("pointAtSide"),n,r;return t===CW.RIGHT_SIDE||t===CW.LEFT_SIDE?(r=Math.round(e.top+e.height/2),n=e.left,t===CW.RIGHT_SIDE&&(n+=e.width)):(n=Math.round(e.left+e.width/2
),r=e.top,t===CW.BOTTOM_SIDE&&(r+=e.height)),{left:n,top:r}}.property("pointAtSide","pointAtRectangle"),distanceFromRectangle:SC.propertyFromRenderDelegate("pickerDistanceFromRectangle",10),distanceFromEdge:SC.propertyFromRenderDelegate("pickerDistanceFromEdge",15),pointerCanMove:SC.propertyFromRenderDelegate("pointerCanMove",YES),validPointerLayouts:SC.propertyFromRenderDelegate("validPointerLayouts",[]),pointerDistanceFromTop:function(){return this.get("pointAtPoint").top-this.get("layout").top}.property("layout").cacheable(),pointerDistanceFromBottom:function(){var e=this.get("layout");return e.top+e.height-this.get("pointAtPoint").top}.property("layout").cacheable(),pointerDistanceFromLeft:function(){return this.get("pointAtPoint").left-this.get("layout").left}.property("layout").cacheable(),pointerDistanceFromRight:function(){var e=this.get("layout");return e.left+e.width-this.get("pointAtPoint").left}.property("layout").cacheable(),pointerLayout:null,layoutPropertyDidChange:function(e,t){t==="availableSpace"?this.scheduleLayout(CW.RELAYOUT_FOR_WINDOW):t==="pointAtPoint"?this.scheduleLayout(CW.RELAYOUT_FOR_TARGET):t==="desiredSize"?this.scheduleLayout(CW.RELAYOUT_FOR_DESIRED_SIZE):t==="minimumSize"?this.scheduleLayout(CW.RELAYOUT_FOR_MINIMUM_SIZE):(t==="validPointerLayouts"||t==="pointerCanMove")&&this.scheduleLayout(CW.RELAYOUT_FOR_TARGET)}.observes("availableSpace","pointAtPoint","desiredSize","minimumSize","validPointerLayouts","pointerCanMove"),pointerLayoutPropertyDidChange:function(){this.scheduleRedraw()}.observes("pointerDistanceFromLeft","pointerDistanceFromRight"
,"pointerDistanceFromBottom","pointerDistanceFromTop"),t_pointAtPoint:function(){var e=this.get("pointAtPoint"),t=this.get("pointAtSide");return t===CW.LEFT_SIDE||t===CW.RIGHT_SIDE?e:{left:e.top,top:e.left}}.property("pointAtPoint","pointAtSide"),t_validPointerLayouts:function(){var e=this.get("validPointerLayouts"),t,n=e.length,r,i,s=this.get("pointAtSide"),o=[];for(t=0;t<n;t++){r=e[t];if(r.top!=null||r.bottom!=null||r.minimumDistanceFromTop!=null||r.minimumDistanceFromBottom!=null||r.maximumDistanceFromTop!=null||r.maximumDistanceFromBottom!=null){if(s!==CW.LEFT_SIDE&&s!==CW.RIGHT_SIDE)continue;if(r.side&&r.side===s)continue;i={name:r.name},r.top!=null?i.maximumDistanceFromTop=i.minimumDistanceFromTop=r.top:r.bottom!=null?i.maximumDistanceFromBottom=i.minimumDistanceFromBottom=r.bottom:(i.maximumDistanceFromTop=r.maximumDistanceFromTop,i.minimumDistanceFromTop=r.minimumDistanceFromTop,i.maximumDistanceFromBottom=r.maximumDistanceFromBottom,i.minimumDistanceFromBottom=r.minimumDistanceFromBottom),i.original=r,o.push(i)}else if(r.left!=null||r.right!=null||r.minimumDistanceFromLeft!=null||r.minimumDistanceFromRight!=null||r.maximumDistanceFromLeft!=null||r.maximumDistanceFromRight!=null){if(s!==CW.TOP_SIDE&&s!==CW.BOTTOM_SIDE)continue;if(r.side&&r.side===s)continue;i={name:r.name},r.left!=null?i.maximumDistanceFromTop=i.minimumDistanceFromTop=r.left:r.right!=null?i.maximumDistanceFromBottom=i.minimumDistanceFromBottom=r.right:(i.maximumDistanceFromTop=r.maximumDistanceFromLeft,i.minimumDistanceFromTop=r.minimumDistanceFromLeft,i.maximumDistanceFromBottom=r.maximumDistanceFromRight
,i.minimumDistanceFromBottom=r.minimumDistanceFromRight),i.original=r,o.push(i)}}return o}.property("validPointerLayouts","pointAtSide").cacheable(),t_pointerMinimumDistanceFromTop:function(){var e=this.get("pointAtSide");return e===CW.LEFT_SIDE||e===CW.RIGHT_SIDE?this.get("pointerMinimumDistanceFromTop"):this.get("pointerMinimumDistanceFromLeft")}.property("pointerMinimumDistanceFromTop","pointerMinimumDistanceFromLeft","pointAtSide").cacheable(),t_pointerMinimumDistanceFromBottom:function(){var e=this.get("pointAtSide");return e===CW.LEFT_SIDE||e===CW.RIGHT_SIDE?this.get("pointerMinimumDistanceFromBottom"):this.get("pointerMinimumDistanceFromRight")}.property("pointerMinimumDistanceFromBottom","pointerMinimumDistanceFromRight","pointAtSide"),t_availableSpace:function(){var e=this.get("availableSpace"),t=this.get("pointAtSide");return t===CW.LEFT_SIDE||t===CW.RIGHT_SIDE?e:{width:e.height,height:e.width}}.property("availableSpace","pointAtSide").cacheable(),t_desiredSize:function(){var e=this.get("desiredSize"),t=this.get("pointAtSide");return t===CW.LEFT_SIDE||t===CW.RIGHT_SIDE?e:{width:e.height,height:e.width}}.property("desiredSize","pointAtSide").cacheable(),t_minimumSize:function(){var e=this.get("minimumSize"),t=this.get("pointAtSide");return t===CW.LEFT_SIDE||t===CW.RIGHT_SIDE?e:{width:e.height,height:e.width}}.property("minimumSize","pointAtSide").cacheable(),t_pointAtSide:function(){var e=this.get("pointAtSide");return e===CW.TOP_SIDE?CW.LEFT_SIDE:e===CW.BOTTOM_SIDE?CW.RIGHT_SIDE:e}.property("pointAtSide").cacheable(),computeLayout:function(){this.centerPicker(),this
.repositionToFit(),this.repositionForPointer(),this.resizeToFit(),this.resizeForPointer(),this.resizeSecondaryDimension(),this.applyMinimumSize(),this.repositionToFit(),this.repositionForPointer(),this.gradeLayout();var e=this.get("pointAtSide"),t=this.get("t_layout"),n=t.pointerLayout;delete t.pointerLayout;if(e===CW.TOP_SIDE||e===CW.BOTTOM_SIDE)t={left:t.top,top:t.left,width:t.height,height:t.width};this.set("layout",t),this.set("pointerLayout",n),arguments.callee.base.apply(this,arguments)},centerPicker:function(){var e=this.get("t_pointAtPoint"),t=this.get("t_desiredSize"),n=this.get("distanceFromRectangle"),r={left:e.left,top:Math.round(e.top-t.height/2),width:t.width,height:t.height};this.get("t_pointAtSide")===CW.RIGHT_SIDE?r.left+=n:r.left=r.left-n-t.width,this.set("t_layout",r)},repositionToFit:function(){if(!this.get("pointerCanMove"))return;var e=this.get("t_layout"),t=this.get("distanceFromEdge"),n=this.get("t_availableSpace"),r=t,i=n.height-t;e.top+e.height>i&&(e.top=i-e.height),e.top<r&&(e.top=r)},repositionForPointer:function(){var e=this.get("t_layout"),t=this.get("t_pointAtPoint").top,n=this.get("t_validPointerLayouts"),r=n.length,i,s,o,u,a=null,f,l;o=null;for(i=0;i<r;i++){s=n[i],f=e.top;var c=s.minimumDistanceFromTop,h=s.maximumDistanceFromTop,p=s.minimumDistanceFromBottom,d=s.maximumDistanceFromBottom;c!=null&&f>t-c&&(f=t-c),h!=null&&f<t-h&&(f=t-h),p!=null&&f+e.height<t+p&&(f=t+p-e.height),d!=null&&f+e.height>t+d&&(f=t+d-e.height),l=Math.abs(f-e.top);if(o==null||l<u)o=f,u=l,a=s.original}e.pointerLayout=a,o!=null&&(e.top=o)},resizeToFit:function(){if(!this.
get("pointerCanMove"))return;var e=this.get("t_layout"),t=this.get("t_availableSpace"),n=t.height-this.get("distanceFromEdge");e.top+e.height>n&&(e.height=n-e.top)},resizeForPointer:function(){var e=this.get("t_layout"),t=this.get("t_pointAtPoint").top,n=this.get("t_validPointerLayouts"),r=n.length,i,s,o,u,a=null,f,l;o=null;for(i=0;i<r;i++){s=n[i],f=e.height;var c=s.minimumDistanceFromTop,h=s.maximumDistanceFromTop,p=s.minimumDistanceFromBottom,d=s.maximumDistanceFromBottom;p!=null&&e.top+f<t+p&&(f=t+p-e.top),d!=null&&e.top+f>t+d&&(f=t+d-e.top),l=Math.abs(f-e.height);if(o==null||l<u)o=f,u=l,a=s.original}e.pointerLayout=a,o!=null&&(e.height=o)},resizeSecondaryDimension:function(){var e=this.get("t_layout"),t=this.get("t_availableSpace"),n=this.get("distanceFromEdge"),r=n,i=t.width-n,s=this.get("t_pointAtSide");if(s===CW.RIGHT_SIDE)e.left+e.width>i&&(e.width=i-e.left);else if(e.left<r){var o=e.left+e.width;e.left=r,e.width=o-r}},applyMinimumSize:function(){var e=this.get("t_layout"),t=this.get("t_minimumSize");e.width<t.width&&(e.width=t.width),e.height<t.height&&(e.height=t.height)},gradeLayout:function(){var e=CW.PERFECT_LAYOUT_QUALITY,t=this.get("t_layout"),n=this.get("t_pointAtSide"),r=this.get("t_availableSpace"),i=this.get("distanceFromEdge"),s=this.get("distanceFromRectangle"),o=this.get("t_desiredSize"),u=this.get("t_pointAtPoint").left,a=this.get("t_pointAtPoint").top,f=this.get("t_pointerMinimumDistanceFromTop"),l=this.get("t_pointerMinimumDistanceFromBottom");if(t.top>a-f)e=CW.INVALID_LAYOUT_QUALITY;else if(t.top+t.height<a-l)e=CW.INVALID_LAYOUT_QUALITY;else if(n===
CW.LEFT_SIDE&&t.left+t.width+s!==u)e=CW.INVALID_LAYOUT_QUALITY;else if(n===CW.RIGHT_SIDE&&t.left-s!==u)e=CW.INVALID_LAYOUT_QUALITY;else if(t.top<0||t.left<0)e=CW.BAD_LAYOUT_QUALITY;else if(t.top+t.height>r.height||t.left+t.width>r.width)e=CW.BAD_LAYOUT_QUALITY;else if(t.top<i||t.left<i)e=CW.OKAY_LAYOUT_QUALITY;else if(t.top+t.height>r.height-i||t.left+t.width>r.width-i)e=CW.OKAY_LAYOUT_QUALITY;else if(t.height<o.height||t.width<o.width)e=CW.GOOD_LAYOUT_QUALITY;this.set("layoutQuality",e)},isBetterThanLayout:function(e){var t=this.get("layoutQuality"),n=e.get("layoutQuality");if(t>n)return YES;if(t<n)return NO;var r=this.get("layout"),i=e.get("layout"),s=this.get("desiredSize");return s.width-r.width<s.width-i.width?YES:s.height-r.height<s.height-i.height?YES:NO}}),CW.PickerLayout.ON_LEFT=CW.PickerLayout.OnSide.extend({pointAtSide:CW.LEFT_SIDE}),CW.PickerLayout.ON_RIGHT=CW.PickerLayout.OnSide.extend({pointAtSide:CW.RIGHT_SIDE}),CW.PickerLayout.ON_BOTTOM=CW.PickerLayout.OnSide.extend({pointAtSide:CW.BOTTOM_SIDE}),CW.PickerLayout.ON_TOP=CW.PickerLayout.OnSide.extend({pointAtSide:CW.TOP_SIDE}),CW.PickerPane=SC.PanelPane.extend({classNames:"sc-picker".w(),layouts:"onRight onBottom onLeft onTop".w(),onRight:CW.PickerLayout.ON_RIGHT,onLeft:CW.PickerLayout.ON_LEFT,onTop:CW.PickerLayout.ON_TOP,onBottom:CW.PickerLayout.ON_BOTTOM,shouldLayoutAutomatically:YES,shouldDismissAutomatically:YES,shouldBeStable:NO,dismissAction:null,dismissTarget:null,repositionOnWindowResize:YES,desiredSize:{width:320,height:400},minimumSize:function(e,t){return t&&(this._scpp_setMinimumSize=t),this._scpp_setMinimumSize?
this._scpp_setMinimumSize:this.get("desiredSize")}.property("desiredSize").cacheable(),currentLayout:undefined,pointAtRectangle:{left:0,top:0,width:0,height:0},pointAtView:null,pointAtViewFrame:null,pointAtViewFrameBinding:"*pointAtView.frame",pointAtRectangleForView:function(e){var t=this.get("parentView")||null,n=e.get("parentView"),r=e.get("frame");return n&&r?n.convertFrameToView(r,t):undefined},_scpv_pointAtViewFrameDidChange:function(){this.recomputePointAtRectangle()}.observes("pointAtViewFrame"),recomputePointAtRectangle:function(){var e=this.get("pointAtView"),t;e&&(t=this.pointAtRectangleForView(this.get("pointAtView")))&&(t.left===undefined&&(t.left=t.x),t.top===undefined&&(t.top=t.y),this.set("pointAtRectangle",t))},modalPane:SC.ModalPane.extend({classNames:"for-cw-picker"}),renderDelegateName:"cwPickerRenderDelegate",init:function(){arguments.callee.base.apply(this,arguments),this.set("desiredSize",SC.clone(this.desiredSize)),this.createLayouts()},popup:function(e,t){this.recomputePointAtRectangle(),t&&(this.set("layouts",t),this.createLayouts());if(e)if(e.isView)this.set("pointAtView",e);else if(e.left!==undefined&&e.top!==undefined&&e.width!==undefined&&e.height!==undefined)this.set("pointAtView",null),this.set("pointAtRectangle",e);else if(!e.nodeType)throw"Invalid argument supplied to SC.PickerPane#popup: "+e.toString();this.windowSizeDidChange(),this.append()},dismiss:function(){var e=this.get("dismissAction"),t=this.get("dismissTarget")||null,n=this.get("rootResponder");e&&n.sendAction(e,t,this,this,null,this),this.get("shouldDismissAutomatically")&&this.remove
()},adjustDesiredSize:function(e,t){var n=this.get("desiredSize");n={width:n.width,height:n.height},typeof e=="object"?SC.mixin(n,e):n[e]=t,this.set("desiredSize",n)},adjustMinimumSize:function(e,t){var n=this.get("minimumSize");n={width:n.width,height:n.height},typeof e=="object"?SC.mixin(n,e):n[e]=t,this.set("minimumSize",n)},createLayouts:function(){var e=this.get("layouts"),t=[],n,r,i=e.length,s;for(r=0;r<i;r++)n=e[r],s=undefined,typeof n=="string"&&(s=n,n=this[n]),n.isClass?n=n.create({owner:this}):n.set("owner",this),t.push(n),s&&this.set(s,n);this.set("layouts",t),this.computeLayoutIfNeeded()},_cwpp_layoutsDidChange:function(){var e=this.get("layouts");e.indexOf(this.get("currentLayout"))<0&&this.set("currentLayout",undefined)}.observes("layouts"),computeLayout:function(){var e=this.get("layouts"),t,n=e.length,r;for(t=0;t<n;t++)r=e[t],r.computeLayoutIfNeeded();var i=this.pickBestLayout();this.set("currentLayout",i),this.applyLayout(i),this.set("layoutNeedsUpdate",NO)},applyLayout:function(e){var t;e?t=e.get("layout"):t={left:0,top:0,width:100,height:100},this.set("layout",t)},pickBestLayout:function(){var e=this.get("layouts"),t,n=e.length,r,i=this.get("shouldBeStable")?this.get("currentLayout"):undefined;for(t=0;t<n;t++){r=e[t];if(!i||r.isBetterThanLayout(i))i=r}return i},computeLayoutIfNeeded:function(){if(!this.get("shouldLayoutAutomatically"))return;if(!this.get("layoutNeedsUpdate"))return;this.computeLayout()},pickerLayoutNeedsUpdate:function(){this.set("layoutNeedsUpdate",YES),this.invokeOnce("computeLayoutIfNeeded")},parentViewDidResize:function(){this.notifyPropertyChange
("availableSpace")},windowSizeDidChange:function(){this.notifyPropertyChange("availableSpace"),this.get("repositionOnWindowResize")&&this.recomputePointAtRectangle()},parentDidChange:function(){arguments.callee.base.apply(this,arguments),this.notifyPropertyChange("availableSpace")},availableSpace:function(){if(this.get("parentView")){var e=this.getPath("parentView.frame");return{width:e.width,height:e.height}}var t=SC.RootResponder.responder.get("currentWindowSize");return{width:t.width,height:t.height}}.property().cacheable(),modalPaneDidClick:function(e){var t=this.get("frame");return this.get("parentView")&&(t=this.get("parentView").convertFrameToView(t,null)),e.pageX>=t.x&&e.pageY>=t.y&&e.pageX<=t.x+t.width&&e.pageY<=t.y+t.height?NO:(this.dismiss(),YES)},click:function(e){return this.modalPaneDidClick(e)},displayProperties:"currentLayout".w(),pickerLayoutNeedsRedraw:function(e){if(e!==this.get("currentLayout"))return;this.displayDidChange()},render:function(e){e=e.begin("div").addClass("_scpv_background");var t=this.get("currentLayout");t&&t.render(e),this._scpp_lastRenderedLayout=t,e=e.end(),this.get("renderDelegate")&&this.get("renderDelegate").render(this.get("renderDelegateProxy"),e)},update:function(e){var t=e.find("._scpv_background"),n=t[0];if(!n)return;var r=this.get("currentLayout");if(!r)return;t.resetClassNames().addClass("_scpv_background");if(this._scpp_lastRenderedLayout!==r){var i=SC.RenderContext(n);r.render(i),i.update(),this._scpp_lastRenderedLayout=r}else r.update(t);this.get("renderDelegate")&&this.get("renderDelegate").update(this.get("renderDelegateProxy"
),e)}}),CW.MenuPane=CW.PickerPane.extend({desiredSize:{width:100,height:100},minimumSize:{width:100,height:0},classNames:["cw-menu"],modalPane:SC.ModalPane,ariaRole:"menu",items:[],controlSize:SC.REGULAR_CONTROL_SIZE,minimumCroppedMenuHeight:SC.propertyFromRenderDelegate("minimumCroppedHeight"),itemHeight:SC.propertyFromRenderDelegate("itemHeight",20),itemSeparatorHeight:SC.propertyFromRenderDelegate("itemSeparatorHeight",9),menuHeight:0,menuHeightPadding:SC.propertyFromRenderDelegate("menuHeightPadding",6),submenuOffsetX:SC.propertyFromRenderDelegate("submenuOffsetX",2),selectedItem:null,exampleView:SC.MenuItemView,anchor:null,isSubMenu:NO,localize:YES,acceptsMenuPane:YES,isContextMenuEnabled:NO,layouts:[CW.PickerLayout.ON_BOTTOM,CW.PickerLayout.ON_TOP],popup:function(e,t){this.beginPropertyChanges(),this.adjustDesiredSize("height",this.get("menuHeight"));var n=Math.min(this.get("menuHeight"),this.get("minimumCroppedMenuHeight"));this.adjustMinimumSize("height",n),arguments.callee.base.apply(this,arguments),this.set("defaultResponder",this),this.endPropertyChanges()},remove:function(){var e=this.get("parentMenu");return this.set("currentMenuItem",null),this.closeOpenMenus(),this.resignMenuPane(),e&&e.becomeMenuPane(),arguments.callee.base.apply(this,arguments)},itemTitleKey:"title",itemIsEnabledKey:"isEnabled",itemValueKey:"value",itemIconKey:"icon",itemHeightKey:"height",itemSubMenuKey:"subMenu",itemSeparatorKey:"separator",itemTargetKey:"target",itemActionKey:"action",itemCheckboxKey:"checkbox",itemShortCutKey:"shortcut",itemKeyEquivalentKey:"keyEquivalent",itemDisableMenuFlashKey
:"disableMenuFlash",itemLayerIdKey:"layerId",itemExampleViewKey:"exampleView",menuItemKeys:["itemTitleKey","itemValueKey","itemIsEnabledKey","itemIconKey","itemSeparatorKey","itemActionKey","itemCheckboxKey","itemShortCutKey","itemHeightKey","itemSubMenuKey","itemKeyEquivalentKey","itemTargetKey","itemLayerIdKey"],isModal:YES,_menuView:null,init:function(){return arguments.callee.base.apply(this,arguments)},displayProperties:["controlSize"],renderStyle:"menu",renderDelegateName:"cwMenuRenderDelegate",createChildViews:function(){var e,t,n;return e=this.createChildView(SC.MenuScrollView,{borderStyle:SC.BORDER_NONE,controlSize:this.get("controlSize")}),t=this._menuView=SC.View.create({parentViewDidResize:function(){this.notifyPropertyChange("frame")},viewDidResize:function(){}}),n=this.get("menuItemViews"),t.set("layout",{top:0,left:0,height:this.get("menuHeight")}),t.replaceAllChildren(n),e.set("contentView",t),this.childViews=[e],this},paneDidAttach:function(){var e=this.rootResponder=SC.RootResponder.responder;return e.panes.add(this),this.set("currentWindowSize",e.computeWindowSize()),this.set("isPaneAttached",YES),this.parentViewDidChange(),this._notifyDidAppendToDocument(),this.becomeMenuPane(),this},becomeMenuPane:function(){return this.rootResponder&&this.rootResponder.makeMenuPane(this),this},resignMenuPane:function(){return this.rootResponder&&this.rootResponder.makeMenuPane(null),this},menuItemViews:function(){return this.createMenuItemViews()}.property("displayItems","controlSize").cacheable(),createMenuItemViews:function(){var e=[],t=this.get("displayItems"),n=this
.get("exampleView"),r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E;if(!t)return e;u=this.get("itemHeightKey"),a=this.get("itemSeparatorKey"),v=this.get("itemExampleViewKey"),f=this.get("itemHeight"),p=this.get("itemKeyEquivalentKey"),l=this.get("itemSeparatorHeight"),b=this.get("itemLayerIdKey"),h=Math.floor(this.get("menuHeightPadding")/2),c=h,largestItemHeight=0,g=this.menuItemKeys.map(CW._menu_fetchKeys,this),E=t.get("length");for(y=0;y<E;y++)r=t[y],o=r.get(u),o||(o=r.get(a)?l:f),w={layout:{height:o,top:c},contentDisplayProperties:g,content:r,parentMenu:this},r.get(b)&&(w.layerId=r.get(b)),m=r.get(v),m?i=m:i=n,s=this._menuView.createChildView(i,w),e[y]=s,c+=o,largestItemHeight=Math.max(largestItemHeight,o),d=r.get(p),d&&(SC.typeOf(d)===SC.T_ARRAY?d.forEach(function(e){this._keyEquivalents[e]=s},this):this._keyEquivalents[d]=s);return this.set("menuHeight",c+h),this.set("largestItemHeight",largestItemHeight),e},menuItemViewForContentIndex:function(e){var t=this.get("menuItemViews");return t?t.objectAt(e):undefined},_keyEquivalents:{},rootMenu:function(){return this.get("isSubMenu")?this.getPath("parentMenu.rootMenu"):this}.property("isSubMenu").cacheable(),windowSizeDidChange:function(e,t){return e&&t&&this.remove(),arguments.callee.base.apply(this,arguments)},displayItems:function(){var e=this.get("items"),t=this.get("localize"),n=this.get("itemHeight"),r,i=[],s,o,u;if(!e)return null;r=e.get("length");for(s=0;s<r;s++){o=e.objectAt(s);if(!o)continue;u=SC.typeOf(o),u===SC.T_STRING?o=SC.Object.create({title:o,value:o,isEnabled:YES}):u===SC.T_HASH?o=SC.Object.create(o):u===SC.T_ARRAY&&
(o=this.convertArrayMenuItemToObject(o)),o.contentIndex=s,i.push(o)}return i}.property("items").cacheable(),_sc_menu_itemsDidChange:function(){var e=this.get("menuItemViews");this._menuView.replaceAllChildren(e),this._menuView.adjust("height",this.get("menuHeight"))}.observes("menuItemViews"),convertArrayMenuItemToObject:function(e){SC.Logger.warn("Support for Array-based menu items has been deprecated.  Please update your menus to use a hash.");var t,n=CW._menu_fetchKeys,r=CW._menu_fetchItem,i,s=SC.Object.create(),o,u;return t=this.menuItemKeys.map(n,this),s[t[0]]=e[0],s[t[1]]=e[1],s[t[2]]=e[2],s[t[3]]=e[3],s[t[4]]=e[4],s[t[5]]=e[5],s[t[6]]=e[6],s[t[7]]=e[7],s[t[8]]=e[8],s[t[9]]=e[9],s[t[10]]=e[10],s[t[11]]=e[11],s[t[12]]=e[12],s},currentMenuItem:function(e,t){return t!==undefined?(this._currentMenuItem!==null&&this.set("previousMenuItem",this._currentMenuItem),this._currentMenuItem=t,this.setPath("rootMenu.targetMenuItem",t),t):this._currentMenuItem}.property().cacheable(),_sc_menu_currentMenuItemDidChange:function(){var e=this.get("currentMenuItem"),t=this.get("previousMenuItem");t&&(!t.get("hasSubMenu")||e!==null)&&(t.resignFirstResponder(),this.closeOpenMenusFor(t)),e&&e.get("isEnabled")&&e.scrollToVisible()}.observes("currentMenuItem"),closeOpenMenusFor:function(e){if(!e)return;var t=e.get("parentMenu");while(t&&e)t=e.get("subMenu"),t&&(t.remove(),e.resignFirstResponder(),e=t.get("previousMenuItem"))},closeOpenMenus:function(){this.closeOpenMenusFor(this.get("previousMenuItem"))},mouseDown:function(e){return this.modalPaneDidClick(e),YES},mouseEntered:function(e){this.
set("mouseHasEntered",YES)},keyUp:function(e){var t=this.interpretKeyEvents(e);return t?t:NO},moveUp:function(){var e=this.get("currentMenuItem"),t=this.get("menuItemViews"),n,r,i;if(!e)i=t.get("length")-1;else{n=e.getPath("content.contentIndex");if(n===0)return YES;i=n-1}while(i>=0){if(t[i].get("isEnabled")){this.set("currentMenuItem",t[i]),t[i].becomeFirstResponder();break}i--}return YES},moveDown:function(){var e=this.get("currentMenuItem"),t=this.get("menuItemViews"),n=t.get("length"),r,i,s;if(!e)s=0;else{r=e.getPath("content.contentIndex");if(r===n)return YES;s=r+1}while(s<n){if(t[s].get("isEnabled")){this.set("currentMenuItem",t[s]),t[s].becomeFirstResponder();break}s++}return YES},insertText:function(e,t){var n=this._timer,r=this._keyBuffer;return n&&n.invalidate(),n=this._timer=SC.Timer.schedule({target:this,action:"clearKeyBuffer",interval:500,isPooled:NO}),r=r||"",r+=e.toUpperCase(),this.selectMenuItemForString(r),this._keyBuffer=r,YES},performKeyEquivalent:function(e,t,n){if(!n&&!this.get("isVisibleInWindow"))return NO;var r=this._keyEquivalents[e];return r?(r.performAction(YES),YES):e==="escape"||e==="return"?(this.remove(),YES):NO},selectMenuItemForString:function(e){var t=this.get("menuItemViews"),n,r,i,s,o;if(!t)return;o=e.length,s=t.get("length");for(i=0;i<s;i++){n=t.objectAt(i),r=n.get("title");if(!r)continue;r=r.replace(/ /g,"").substr(0,o).toUpperCase();if(r===e){this.set("currentMenuItem",n),n.becomeFirstResponder();break}}},clearKeyBuffer:function(){this._keyBuffer=""},modalPaneDidClick:function(e){return this.remove(),YES}}),CW._menu_fetchKeys=function(
e){return this.get(e)},CW._menu_fetchItem=function(e){return e?this.get?this.get(e):this[e]:null},CW.AutoResizingMenuItemView=SC.MenuItemView.extend(SC.AutoResize,{supportsAutoResize:YES,shouldAutoResize:NO,shouldMeasureSize:NO,autoResizePadding:0,getShortCutWidth:function(){var e=this.getContentProperty("itemShortCutKey"),t=this.get("layer"),n=this.get("_cachedShortCutWidth"),r=this.get("_previousShortCut"),i;return r&&r===e?i=n:e&&t&&(i=SC.metricsForString(e,t,"",YES).width,this.set("_cachedShortCutWidth",i).set("_previousShortCut",e)),i||0},autoResizeText:function(){return this.get("title")}.property("title"),autoResizeLayer:function(){return this.$(".value")[0]}.property("layer").cacheable(),batchResizeId:function(){return"menu-"+SC.guidFor(this.parentMenu)}.property().cacheable(),didUpdateLayer:function(){this.notifyPropertyChange("autoResizeLayer"),this.scheduleMeasurement()},_cachedShortCutWidth:null,_previousShortCut:null}),CW.AutoResizingMenuPane=CW.MenuPane.extend({shouldAutoResize:YES,exampleView:CW.AutoResizingMenuItemView,minimumMenuWidth:SC.propertyFromRenderDelegate("minimumMenuWidth",0),menuWidthPadding:SC.propertyFromRenderDelegate("menuWidthPadding",0),init:function(){arguments.callee.base.apply(this,arguments),this.get("shouldAutoResize")&&this.invokeOnce("_updateMenuWidth")},createMenuItemViews:function(){var e=arguments.callee.base.apply(this,arguments),t,n=e.length,r;if(this.get("shouldAutoResize"))for(t=0;t<n;t++)r=e[t],r.set("shouldMeasureSize",YES),r.addObserver("measuredSize",this,this._menuItemMeasuredSizeDidChange);return e},_menuItemViewsDidChange
:function(){this.get("shouldAutoResize")&&this.invokeOnce("_updateMenuWidth")}.observes("menuItemViews"),_menuItemMeasuredSizeDidChange:function(e){this.invokeOnce("_updateMenuWidth")},_menuMinimumMenuWidthDidChange:function(){this.invokeOnce("_updateMenuWidth")}.observes("minimumMenuWidth"),_updateMenuWidth:function(){var e=this.get("menuItemViews");if(!e)return;var t=e.length,n=this.get("minimumMenuWidth"),r=this.get("menuWidthPadding"),i,s,o,u,a;for(var f=0;f<t;f++)i=e[f],s=i.getShortCutWidth(),o=i.get("measuredSize"),u=o?o.width:0,a=u+s+r,n=Math.max(n,a);this.adjustDesiredSize("width",n)}}),CW.CalloutPicker=CW.PickerPane.extend(CW.Animatability,CW.PaneFadingSupport,{desiredSize:{width:215,height:43},minimumSize:{width:150,height:43},renderStyle:"iOS.callout",layouts:[CW.PickerLayout.ON_TOP],titleValue:"Callout title",detailValue:"Callout detail",escapeTitle:YES,escapeDetail:YES,target:"",action:"",preferType:SC.PICKER_POINTER,acceptsKeyPane:NO,acceptsFirstResponder:NO,isModal:NO,repositionOnWindowResize:NO,contentView:SC.View.extend({childViews:["title","detail","button"],title:SC.LabelView.extend({layout:{top:0,height:25,left:9,right:35},classNames:"title",escapeHTMLBinding:"*parentView.parentView.escapeTitle",valueBinding:"*parentView.parentView.titleValue"}),detail:SC.LabelView.extend({layout:{top:20,left:9,height:15},classNames:"detail",escapeHTMLBinding:"*parentView.parentView.escapeDetail",valueBinding:"*parentView.parentView.detailValue"}),button:SC.ImageButtonView.extend({layout:{top:7,height:30,right:5,width:30},image:"info_button",targetBinding:"*parentView.parentView.target"
,actionBinding:"*parentView.parentView.action"})}),didCreateLayer:function(){this.invokeLater(this.recomputeDesiredSize,0)},recomputeDesiredSize:function(){var e=this.$(".title")[0],t=this.$(".detail")[0];if(SC.none(e)||SC.none(t))return;var n=SC.metricsForString(this.get("titleValue"),e,null,NO),r=SC.metricsForString(this.get("detailValue"),t,null,NO),i=(n.width>r.width?n.width:r.width)+55;i=i%2?i-1:i,this.adjustDesiredSize({width:Math.max(this.get("minimumSize").width,i)})},showCalloutInContainer:function(e){this._hideOverflow(),this.appendTo(e)},valuesObserver:function(){this.recomputeDesiredSize()}.observes("detailValue","titleValue","layer"),modalPaneDidClick:function(){return NO}}),CW.ErrorCalloutPicker=CW.PickerPane.extend({themeName:"errorCallout",renderStyle:"errorCallout",minimumSize:{width:120,height:29},errorText:"Please fill in required info",layouts:["onTop","onBottom"],acceptsFirstResponder:NO,acceptsKeyPane:NO,isModal:NO,contentView:SC.LabelView.extend(SC.AutoResize,{classNames:["error-picker-label"],valueBinding:".parentView.errorText",measuredSizeDidChange:function(){var e=this.get("measuredSize");e&&e.width&&e.height&&this.parentView.set("desiredSize",{width:e.width,height:e.height})}.observes("measuredSize")})}),CW.SelectMenuLayout={Aligned:CW.PickerLayout.extend({renderDelegateName:"cwPickerBackgroundRenderDelegate",distanceFromEdge:SC.propertyFromRenderDelegate("distanceFromEdge",15),desiredPosition:{left:0,top:0},desiredPositionBinding:SC.Binding.oneWay("*owner.desiredPosition"),layoutPropertyDidChange:function(e,t){t==="availableSpace"?this.scheduleLayout
(CW.RELAYOUT_FOR_WINDOW):t==="pointAtPoint"?this.scheduleLayout(CW.RELAYOUT_FOR_TARGET):t==="desiredSize"?this.scheduleLayout(CW.RELAYOUT_FOR_DESIRED_SIZE):t==="minimumSize"&&this.scheduleLayout(CW.RELAYOUT_FOR_MINIMUM_SIZE)}.observes("availableSpace","desiredSize","minimumSize","desiredPosition"),computeLayout:function(){var e=this.get("desiredPosition"),t=this.get("desiredSize"),n=this.get("minimumSize"),r=this.get("availableSpace"),i=this.get("distanceFromEdge"),s={top:e.top,left:e.left,width:t.width,height:t.height};s.top<i&&(s.height=s.height-(i-s.top),s.top=i),s.top+s.height>r.height-i&&(s.height=r.height-i-s.top),s.height<n.height&&(s.height=n.height),s.top+s.height>r.height-i&&(s.top=r.height-i-s.height),s.left<i&&(s.left=i),s.left+s.width>r.width-i&&(s.left=r.width-i-s.width),s.left<i&&(s.left=i,s.width=r.width-s.left-i),this.set("layout",s),arguments.callee.base.apply(this,arguments)}})},CW.SelectViewMenuPane=CW.AutoResizingMenuPane.extend({desiredPosition:{top:20,left:20},classNames:"select-menu",layouts:[CW.SelectMenuLayout.Aligned],selectView:null,value:null,valueBinding:".selectView.value",renderDelegateName:"cwSelectMenuRenderDelegate",renderStyle:"menu.cw-no-pointers",shouldDropDown:SC.propertyFromRenderDelegate("shouldDropDown",NO),valueDidChange:function(){var e=this.get("menuItemViews"),t,n=e.length,r;for(t=0;t<n;t++)r=e[t],r._lastIsChecked&&r.notifyPropertyChange("isChecked"),r.get("isChecked")&&r.notifyPropertyChange("isChecked")}.observes("value"),_svm_selectedMenuItemView:function(){var e=this.get("menuItemViews"),t=this.get("value"),n,r;if(!e)return undefined
;r=e.length;for(n=0;n<r;n++)if(t===e[n].get("content").get(this.get("itemValueKey")))return e[n];return undefined}.property("value","menuItemViews").cacheable(),exampleView:CW.AutoResizingMenuItemView.extend({isChecked:function(){return this._lastIsChecked=this.getContentProperty("itemValueKey")===this.getPath("parentMenu.rootMenu.value"),this._lastIsChecked}.property(),displayProperties:["isChecked"]}),desiredPosition:function(){var e=this.get("pointAtRectangle");return this.get("shouldDropDown")?{left:e.left+this.get("menuLeftOffset"),top:e.top+e.height+this.get("menuTopOffset")}:{left:e.left+this.get("menuLeftOffset"),top:e.top-this._svm_positionForValue(this.get("value"))+this.get("menuTopOffset")}}.property("pointAtRectangle","value","menuItemViews","isDropDown"),_svm_positionForValue:function(e){var t=this.get("_svm_selectedMenuItemView");return t?t.get("layout").top:0},menuLeftOffset:SC.propertyFromRenderDelegate("menuLeftOffset",0),menuTopOffset:SC.propertyFromRenderDelegate("menuTopOffset",0),menuMinimumWidthOffset:SC.propertyFromRenderDelegate("menuMinimumWidthOffset",0),minimumMenuWidth:function(){var e=this.get("pointAtRectangle");return e.width+this.get("menuMinimumWidthOffset")}.property("pointAtRectangle","menuMinimumWidthOffset").cacheable(),applyLayout:function(){arguments.callee.base.apply(this,arguments);var e=this.get("_svm_selectedMenuItemView");e&&e.scrollToVisible()},_svm_theme:null,_svm_themeBinding:"*selectView.theme",baseTheme:function(){return this.get("_svm_theme")||arguments.callee.base.apply(this,arguments)}.property("_svm_theme").cacheable(),_svm_bindToProperties
:["items","itemTitleKey","itemIsEnabledKey","itemValueKey","itemIconKey","itemHeightKey","itemSubMenuKey","itemSeparatorKey","itemTargetKey","itemActionKey","itemCheckboxKey","itemShortCutKey","itemKeyEquivalentKey","itemDisableMenuFlashKey","controlSize"],_svm_setupBindings:function(){var e=this.get("selectView");if(!e)return;var t=this._svm_bindToProperties,n,r=t.length,i;for(n=0;n<r;n++)i=t[n],this[i+"Binding"]=this.bind(i,e,i);this._svm_isBoundTo=e},_svm_clearBindings:function(){var e=this._svm_isBoundTo;if(!e)return;var t=this._svm_bindToProperties,n,r=t.length,i;for(n=0;n<r;n++)i=t[n],this[i+"Binding"].disconnect()},_svm_selectViewDidChange:function(){this._svm_clearBindings(),this._svm_setupBindings()}.observes("selectView"),initMixin:function(){this._svm_setupBindings()},destroyMixin:function(){this._svm_clearBindings()}}),SC.BaseTheme.cwPickerBackgroundRenderDelegate=SC.RenderDelegate.create({className:"cw-picker-background",pickerDistanceFromRectangle:12,validPointerLayouts:[{name:"left-or-right-position",classNames:"calculated-pointer",minimumDistanceFromTop:60,minimumDistanceFromBottom:60,needsGap:YES},{name:"top-or-bottom-position",classNames:"calculated-pointer",minimumDistanceFromLeft:60,minimumDistanceFromRight:60,needsGap:YES},{classNames:"bottom-left-corner-pointer corner-pointer".w(),name:"point-left-on-bottom",bottom:20,needsGap:NO,side:CW.LEFT_SIDE},{classNames:"top-left-corner-pointer corner-pointer".w(),name:"point-left-on-top",top:20,needsGap:NO,side:CW.LEFT_SIDE},{classNames:"top-left-corner-pointer corner-pointer".w(),name:"point-up-on-left",left:20
,needsGap:NO,side:CW.TOP_SIDE},{classNames:"top-right-corner-pointer corner-pointer".w(),name:"point-up-on-right",right:20,needsGap:NO,side:CW.TOP_SIDE},{classNames:"bottom-left-corner-pointer corner-pointer".w(),name:"point-down-on-left",left:20,needsGap:NO,side:CW.BOTTOM_SIDE},{classNames:"bottom-right-corner-pointer corner-pointer".w(),name:"point-down-on-right",right:20,needsGap:NO,side:CW.BOTTOM_SIDE},{classNames:"bottom-right-corner-pointer corner-pointer".w(),name:"point-right-on-bottom",bottom:20,needsGap:NO,side:CW.BOTTOM_SIDE},{classNames:"top-right-corner-pointer corner-pointer".w(),name:"point-right-on-top",top:20,needsGap:NO,side:CW.BOTTOM_SIDE}],render:function(e,t){this.addSizeClassName(e,t);var n=e.get("pointAtSide")||"right",r=e.get("pointerLayout"),i=r?r.needsGap:NO,s,o,u=e.get("pointerDistanceFromTop")||0,a=e.get("pointerDistanceFromBottom")||0,f=e.get("pointerDistanceFromLeft")||0,l=e.get("pointerDistanceFromRight")||0,c,h,p,d,v=e.get("requiresSlices"),m;v&&(m=["top-left","bottom-left","top-right","bottom-right","middle"]),n==="right"?(c="top",h="bottom",p=u,m&&(d=a,o="left",m.push("right"),m.push("top"),m.push("bottom")),s="sc-point-left"):n==="left"?(c="top",h="bottom",p=u,m&&(d=a,o="right",m.push("left"),m.push("top"),m.push("bottom")),s="sc-point-right"):n==="top"?(c="left",h="right",p=f,m&&(d=l,o="bottom",m.push("top"),m.push("left"),m.push("right")),s="sc-point-down"):(c="left",h="right",p=f,m&&(d=l,o="top",m.push("bottom"),m.push("left"),m.push("right")),s="sc-point-up"),r&&r.classNames&&t.addClass(r.classNames),r&&r.name&&t.addClass(r.name),t.setClass
("needs-gap",i),m&&this.includeSlices(e,t,m),t.begin("div").addClass("sc-pointer").addClass(s).css(c,p).end(),m&&(t.begin("div").addClass(o).addClass("sc-before-pointer").css(h,i?d:null).end(),t.begin("div").addClass(o).addClass("sc-after-pointer").css(c,i?p:null).end())},update:function(e,t){this.updateSizeClassName(e,t);var n=e.get("pointAtSide"),r=e.get("pointerDistanceFromTop"),i=e.get("pointerDistanceFromBottom"),s=e.get("pointerDistanceFromLeft"),o=e.get("pointerDistanceFromRight"),u,a,f,l,c=e.get("pointerLayout"),h=c?c.needsGap:NO;n==="right"||n==="left"?(u="top",a="bottom",f=r,l=i):(u="left",a="right",f=s,l=o),t.find(".sc-pointer").css(u,f),t.find(".sc-before-pointer").css(a,h?l:null),t.find(".sc-after-pointer").css(u,h?f:null),c&&c.classNames&&t.addClass(c.classNames),c&&c.name&&t.addClass(c.name),t.setClass("needs-gap",h)}}),require("render_delegates/picker_background"),SC.BaseTheme.Callout=SC.BaseTheme.create({name:"callout"}),SC.BaseTheme.addTheme(SC.BaseTheme.Callout),SC.BaseTheme.Callout.cwPickerBackgroundRenderDelegate=SC.BaseTheme.cwPickerBackgroundRenderDelegate.create({validPointerLayouts:[{name:"top-position",classNames:"calculated-pointer",minimumDistanceFromLeft:30,minimumDistanceFromRight:30,needsGap:YES}]}),SC.BaseTheme.cwPickerRenderDelegate=SC.RenderDelegate.create({className:"cw-picker",render:function(e,t){},update:function(){}}),SC.BaseTheme.cwMenuRenderDelegate=SC.BaseTheme.cwPickerRenderDelegate.create({className:"cw-menu",render:function(e,t){this.addSizeClassName(e,t)},update:function(e,t){this.updateSizeClassName(e,t)},minimumCroppedHeight:200
,itemHeight:27,itemSeparatorHeight:9,menuHeightPadding:0,menuWidthPadding:34,minimumMenuWidth:34,submenuOffsetX:2,verticalOffset:23,"sc-tiny-size":{itemHeight:10,itemSeparatorHeight:2,menuHeightPadding:0,submenuOffsetX:0},"sc-small-size":{itemHeight:27,itemSeparatorHeight:9,menuHeightPadding:0,submenuOffsetX:2},"sc-large-size":{itemHeight:31,itemSeparatorHeight:9,menuHeightPadding:0,submenuOffsetX:4},"sc-huge-size":{itemHeight:20,itemSeparatorHeight:9,menuHeightPadding:0,submenuOffsetX:0}}),require("render_delegates/picker_background"),SC.BaseTheme.Menu=SC.BaseTheme.create({name:"menu"}),SC.BaseTheme.addTheme(SC.BaseTheme.Menu),SC.BaseTheme.Menu.cwPickerBackgroundRenderDelegate=SC.BaseTheme.cwPickerBackgroundRenderDelegate.create({"sc-small-size":{pickerDistanceFromRectangle:8},"sc-regular-size":{pickerDistanceFromRectangle:12},"sc-large-size":{pickerDistanceFromRectangle:16},validPointerLayouts:[{name:"top-or-bottom-position",classNames:"calculated-pointer",minimumDistanceFromLeft:20,minimumDistanceFromRight:20,needsGap:NO},{classNames:"top-left-corner-pointer corner-pointer".w(),name:"point-up-on-left",left:15,needsGap:NO,side:CW.TOP_SIDE},{classNames:"top-right-corner-pointer corner-pointer".w(),name:"point-up-on-right",right:15,needsGap:NO,side:CW.TOP_SIDE},{classNames:"bottom-left-corner-pointer corner-pointer".w(),name:"point-down-on-left",left:15,needsGap:NO,side:CW.BOTTOM_SIDE},{classNames:"bottom-right-corner-pointer corner-pointer".w(),name:"point-down-on-right",right:15,needsGap:NO,side:CW.BOTTOM_SIDE}]}),require("render_delegates/menu_background"),SC.BaseTheme.NoPointers=
SC.BaseTheme.Menu.create({name:"cw-no-pointers"}),SC.BaseTheme.addTheme(SC.BaseTheme.NoPointers),SC.BaseTheme.NoPointers.cwPickerBackgroundRenderDelegate=SC.RenderDelegate.create({className:"cw-picker-background",distanceFromEdge:20,render:function(e,t){this.addSizeClassName(e,t),this.includeSlices(e,t,SC.NINE_SLICE)},update:function(e,t){this.updateSizeClassName(e,t)}}),SC.BaseTheme.DropDown=SC.BaseTheme.create({name:"dropdown"}),SC.BaseTheme.addTheme(SC.BaseTheme.DropDown),SC.BaseTheme.DropDown.cwMenuRenderDelegate=SC.BaseTheme.cwMenuRenderDelegate.create({menuLeftOffset:-3,menuTopOffset:7,menuMinimumWidthOffset:-18,shouldDropDown:YES}),SC.BaseTheme.DropDown.cwPickerBackgroundRenderDelegate=SC.BaseTheme.NoPointers.cwPickerBackgroundRenderDelegate,SC.BaseTheme.ErrorCallout=SC.BaseTheme.create({name:"errorCallout"}),SC.BaseTheme.ErrorCallout.cwPickerBackgroundRenderDelegate=SC.BaseTheme.cwPickerBackgroundRenderDelegate.create({pickerDistanceFromRectangle:10,validPointerLayouts:[{name:"top-position",classNames:"calculated-pointer",minimumDistanceFromLeft:30,minimumDistanceFromRight:30,needsGap:NO}]}),SC.BaseTheme.cwPopupButtonRenderDelegate=SC.BaseTheme.buttonRenderDelegate.create({render:function(e,t){t.attr("aria-haspopup","true"),arguments.callee.base.apply(this,arguments)},update:function(e,t){arguments.callee.base.apply(this,arguments)}}),SC.BaseTheme.PopUp=SC.BaseTheme.create({name:"popup"}),SC.BaseTheme.addTheme(SC.BaseTheme.PopUp),SC.BaseTheme.PopUp.cwMenuRenderDelegate=SC.BaseTheme.cwMenuRenderDelegate.create({shouldDropDown:NO}),SC.BaseTheme.PopUp.cwPickerBackgroundRenderDelegate=
SC.BaseTheme.NoPointers.cwPickerBackgroundRenderDelegate,SC.BaseTheme.cwSelectRenderDelegate=SC.BaseTheme.buttonRenderDelegate.create({}),SC.BaseTheme.cwSelectMenuRenderDelegate=SC.BaseTheme.cwMenuRenderDelegate.create({menuLeftOffset:-21,menuTopOffset:0,menuMinimumWidthOffset:16,"sc-small-size":{itemHeight:27,itemSeparatorHeight:7,menuHeightPadding:0,submenuOffsetX:2,menuTopOffset:-1,menuLeftOffset:-20},"sc-large-size":{itemHeight:30,itemSeparatorHeight:5,menuHeightPadding:0,submenuOffsetX:4}}),CW.PopupButtonView=SC.ButtonView.extend({renderDelegateName:"cwPopupButtonRenderDelegate",menu:CW.MenuPane,shouldLoadInBackground:NO,_menuIsLoaded:NO,isActive:NO,acceptsFirstResponder:YES,init:function(){arguments.callee.base.apply(this,arguments),this._currentMenu=null,this.invokeOnce("scheduleMenuSetupIfNeeded")},scheduleMenuSetupIfNeeded:function(){var e=this.get("menu");e&&e.isClass&&this.get("shouldLoadInBackground")&&SC.backgroundTaskQueue.push(CW.PopupButtonView.InstantiateMenuTask.create({popupButton:this}))},menuDidChange:function(){var e=this.get("menu");if(e===this._currentMenu)return;this.invokeOnce("scheduleMenuSetupIfNeeded")}.observes("menu"),setupMenu:function(){var e=this.get("menu");if(e===this._currentMenu)return;this._currentMenu&&(this.isActiveBinding.disconnect(),this._currentMenu.destroy(),this._currentMenu=null),e&&e.isClass&&(e=this.createMenu(e)),this._currentMenu=e,this.set("menu",e),e.set("owner",this),this.isActiveBinding=this.bind("isActive",e,"isVisibleInWindow")},createMenu:function(e){return e.create()},showMenu:function(){this.setupMenu(),this.invokeLast
("_showMenu")},hideMenu:function(){var e=this.get("menu");e&&!e.isClass&&e.remove()},_showMenu:function(){var e=this.get("menu");e.popup(this)},mouseDown:function(e){if(!this.get("isEnabled"))return YES;this.set("_mouseDown",YES),this.showMenu(),this._mouseDownTimestamp=null;var t=this;return t._mouseDownTimestamp=0,setTimeout(function(){t._mouseDownTimestamp=SC.getCurrentTimeForPerformance()},1),this.becomeFirstResponder(),YES},mouseUp:function(e){var t=this.get("menu"),n,r;return t&&this.get("_mouseDown")&&(n=t.getPath("rootMenu.targetMenuItem"),this._mouseDownTimestamp===0&&(this._mouseDownTimestamp=SC.getCurrentTimeForPerformance()),SC.getCurrentTimeForPerformance()-this._mouseDownTimestamp>400&&(n&&t.get("mouseHasEntered")&&this._mouseDownTimestamp?n.performAction()||t.remove():t.remove())),this._mouseDownTimestamp=undefined,YES},keyDown:function(e){return e.which==13?(this.showMenu(),YES):arguments.callee.base.apply(this,arguments)},touchStart:function(e){return this.mouseDown(e)},touchEnd:function(e){return this.mouseUp(e)}}),CW.PopupButtonView.InstantiateMenuTask=SC.Task.extend({popupButton:null,run:function(e){this.popupButton.setupMenu()}}),CW.SelectView=CW.PopupButtonView.extend({themeName:"dropdown",renderDelegateName:"cwSelectRenderDelegate",items:null,itemsBindingDefault:SC.Binding.multiple(),itemTitleKey:"title",itemSortKey:null,itemValueKey:"value",itemIconKey:"icon",itemSeparatorKey:"separator",itemIsEnabledKey:"isEnabled",menu:CW.SelectViewMenuPane,selectedItem:null,selectedItemBinding:"*menu.rootMenu.selectedItem",supportsFocusRing:YES,init:function(){arguments
.callee.base.apply(this,arguments),this._scsv_updateTitle(),this._scsv_valueDidChange()},_scsv_getValueForMenuItem:function(e){var t=this.get("itemValueKey")||"value";return SC.typeOf(e)===SC.T_STRING?e:e.get?e.get(t):e[t]},_scsv_selectedItemDidChange:function(){var e=this.get("selectedItem"),t=this._scsv_lastSelection,n=this.get("itemTitleKey")||"title",r=this.get("itemValueKey")||"value";e&&this.setIfChanged("value",this._scsv_getValueForMenuItem(e)),t&&t.addObserver&&e!==t&&(t.removeObserver(n,this,this._scsv_selectedItemPropertyDidChange),t.removeObserver(r,this,this._scsv_selectedItemPropertyDidChange)),e&&e.addObserver&&e!==t&&(e.addObserver(n,this,this._scsv_selectedItemPropertyDidChange),e.addObserver(r,this,this._scsv_selectedItemPropertyDidChange)),this._scsv_lastSelection=e}.observes("selectedItem"),_scsv_selectedItemPropertyDidChange:function(e){this._scsv_updateTitle(),this.set("value",e.get(this.get("itemValueKey")||"value"))},defaultTitle:"",_scsv_updateTitle:function(){var e=this.get("selectedItem"),t,n;e?e.get?(t=e.get(this.get("itemTitleKey")||"title"),n=e.get(this.get("itemIconKey")||"icon")):SC.typeOf(e)==SC.T_HASH?(t=e[this.get("itemTitleKey")||"title"],n=e[this.get("itemIconKey")||"icon"]):t=e:t=this.get("defaultTitle"),t&&this.set("title",t),this.set("icon",n)}.observes("selectedItem"),_scsv_valueDidChange:function(){var e=this.get("value");if(!this.get("items"))return;var t=this.get("items"),n=t.get?t.get("length"):t.length,r,i;for(r=0;r<n;r++){i=t.objectAt?t.objectAt(r):t[r];if(this._scsv_getValueForMenuItem(i)===e){this.setIfChanged("selectedItem",i
);return}}this.setIfChanged("selectedItem",null)}.observes("value"),_scsv_itemsDidChange:function(){this._scsv_valueDidChange()}.observes("items","items.[]"),createMenu:function(e){var t={selectView:this,selectedItem:this.get("selectedItem")};return e.create(t)},keyDown:function(e){if(this.interpretKeyEvents(e))return YES;if(e.keyCode===13)return NO;arguments.callee.base.apply(this,arguments)},interpretKeyEvents:function(e){if(e){if(e.keyCode===38||e.keyCode===40)return this.showMenu(),YES;if(e.keyCode===27)return this.resignFirstResponder(),YES}return arguments.callee.base.apply(this,arguments)},acceptsFirstResponder:function(){return this.get("isEnabled")}.property("isEnabled").cacheable()}),window.CW||(CW=SC.Object.create()),SC.REGULAR_BUTTON_HEIGHT=27,CW.CANVAS_BUTTON_HEIGHT=26,CW.TOOLBAR_BUTTON_HEIGHT=26,CW.SQUARE_BUTTON_LARGE_HEIGHT=30,CW.SQUARE_BUTTON_REGULAR_HEIGHT=27,CW.SELECT_BUTTON_REGULAR_HEIGHT=27,CW.POPUP_BUTTON_REGULAR_HEIGHT=27,CW.SQUARE_BUTTON_REGULAR_MIN_WIDTH=68,CW.SQUARE_BUTTON_SMALL_MIN_WIDTH=56,CW.SQUARE_BUTTON_TINY_MIN_WIDTH=52,CW.HELP_BUTTON_REGULAR_MIN_WIDTH=26,CW.HELP_BUTTON_SMALL_MIN_WIDTH=22,CW.HELP_BUTTON_TINY_MIN_WIDTH=18,AppleThemeV4=SC.BaseTheme.create({name:"atv4"}),SC.ButtonView.reopen({isBorderless:YES}),SC.Theme.addTheme(AppleThemeV4),SC.defaultTheme="atv4",AppleThemeV4.iOS=AppleThemeV4.subtheme("iOS"),AppleThemeV4.iOS.blue=AppleThemeV4.iOS.subtheme("iOSBlue"),AppleThemeV4.ErrorCallout&&AppleThemeV4.addTheme(AppleThemeV4.ErrorCallout),require("theme"),AppleThemeV4.menuRenderDelegate=SC.BaseTheme.menuRenderDelegate.create({itemHeight:27,itemSeparatorHeight
:7,menuHeightPadding:6,"sc-small-size":{itemHeight:27,itemSeparatorHeight:7,menuHeightPadding:6,submenuOffsetX:2},"sc-large-size":{itemHeight:31,itemSeparatorHeight:9,menuHeightPadding:8,submenuOffsetX:4}}),CW.SQUARE_MENU_ITEM_HEIGHT=31,CW.SQUARE_MENU_ITEM_SEPARATOR_HEIGHT=7,CW.SQUARE_MENU_HEIGHT_PADDING=6,AppleThemeV4.iOS.cwPickerBackgroundRenderDelegate&&(AppleThemeV4.iOS.cwPickerBackgroundRenderDelegate=AppleThemeV4.iOS.cwPickerBackgroundRenderDelegate.create({validPointerLayouts:[{name:"left-or-right-position",classNames:"calculated-pointer",minimumDistanceFromLeft:60,minimumDistanceFromRight:60,needsGap:YES},{name:"top-or-bottom-position",classNames:"calculated-pointer",minimumDistanceFromTop:60,minimumDistanceFromBottom:60,needsGap:YES}]})),AppleThemeV4.PreferencesTheme=AppleThemeV4.subtheme("preferences"),AppleThemeV4.PreferencesTheme.buttonRenderDelegate=SC.RenderDelegate.create({name:"button",render:function(e,t){var n=e.get("title"),r=e.get("icon");t.push('<img src="',SC.BLANK_IMAGE_URL,'" alt="" class="icon '+r+'"/>'),t.push('<div class = "title">'+n+"</div>"),t.push('<img src="',SC.BLANK_IMAGE_URL,'" alt="" class="pointer"/>')}}),AppleThemeV4.buttonRenderDelegate=SC.RenderDelegate.create({className:"button","sc-small-size":{height:18,autoResizePadding:{width:15,height:0}},"sc-regular-size":{height:24,autoResizePadding:{width:20,height:0}},"sc-huge-size":{height:30,autoResizePadding:{width:30,height:0}},"sc-jumbo-size":{height:44,autoResizePadding:{width:50,height:0}},render:function(e,t){this.addSizeClassName(e,t);var n,r=e.get("toolTip"),i=e.get("value"),s=e.get
("isSelected")||NO,o=e.get("isActive")||NO,u=e.get("isDefault")||NO,a=e.get("isCancel")||NO,f=e.get("isToggle")||NO,l=SC.guidFor(e)+"-label",c=e.get("isBorderless")||NO;t.setClass({icon:!!e.get("icon"),def:u,cancel:a&&!u,active:o,sel:s}),r&&(t.attr("title",r),t.attr("alt",r)),c||this.includeSlices(e,t,SC.THREE_SLICE),e.get("isSegment")?t.attr("aria-selected",s.toString()):f&&t.attr("aria-pressed",o.toString()),i?t.attr("aria-labelledby",l):r&&t.attr("aria-label",r),t=t.begin("label").addClass("sc-button-label").id(l),e.get("theme").labelRenderDelegate.render(e,t),t=t.end()},update:function(e,t){var n=e.get("buttonBehavior")===SC.TOGGLE_BEHAVIOR;this.updateSizeClassName(e,t),e.get("isActive")&&t.addClass("active");var r=e.get("isDefault"),i=e.get("isCancel");e.get("isSegment")?t.attr("aria-selected",e.get("isSelected").toString()):n&&t.attr("aria-pressed",e.get("isActive").toString()),t.attr("title",e.get("toolTip")),t.setClass("icon",!!e.get("icon")),t.setClass("def",!!r),t.setClass("cancel",!!i&&!r),e.get("theme").labelRenderDelegate.update(e,t.find("label"))},getRenderedAutoResizeLayer:function(e,t){return t.find(".sc-button-label")[0]}}),SC.stringsFor("en-us",{"AccountMenu.SignOut":"Sign Out"}),CK.MicroResourceContainer={_cacheSizeHighWaterMark:200,_cacheSizeLowWaterMark:150,containerInit:function(){this._queue=[],this._status={},this._cache={},this._cacheSize=0,this._cacheLRU={},this._alreadyPendingCallbacks={},this._cacheLRUCounter=0},containerLoad:function(e,t){if(e===null||e===undefined)return t(undefined,undefined);if(e in this._cache)return t(undefined,this.containerGet
(e));if(this._status[e]===CK.MicroResourceContainer.LoadStatus.PENDING){var n=this._alreadyPendingCallbacks[e]||(this._alreadyPendingCallbacks[e]=[]);n.push(t);return}this._queue.push({key:e,callback:t}),this._status[e]=CK.MicroResourceContainer.LoadStatus.PENDING,this._hasInvokeLast||(this._hasInvokeLast=!0,this.invokeLast(function(){delete this._hasInvokeLast;var e=this._queue;e&&e.length&&(this._queue=[],this.containerFlush(e))}))},containerStoreResults:function(e,t,n,r){var i=this;e&&e.forEach(function(e,r){var s=t[r];n?i.containerSetStatus(e,CK.MicroResourceContainer.LoadStatus.FAILED):(i.containerSetStatus(e,CK.MicroResourceContainer.LoadStatus.LOADED),i.containerPut(e,s));var o=i._alreadyPendingCallbacks[e];o&&(o.forEach(function(e){e(n,s)}),delete i._alreadyPendingCallbacks[e])}),r.forEach(function(e){e.callback(n,i._cache[e.key])})},_containerPurge:function(){var e=this._cacheLRU,t=this._cache,n=this._status,r=Object.keys(t).sort(function(t,n){var r=e[t],i=e[n];return r<i?-1:r>i?1:0}),i=r.length,s=Math.min(this._cacheSize-this._cacheSizeLowWaterMark,i),o=0;for(var u=0;u<i;++u){var a=r[u];u<s?(delete t[a],delete e[a],delete n[a]):e[a]=o++}this.cacheLRUCounter=o,this._cacheSize-=s},containerGetStatus:function(e){return this._status[e]},containerSetStatus:function(e,t){this._status[e]=t},containerPut:function(e,t){var n=e in this._cache;this._cache[e]=t,this._cacheLRU[e]=this._cacheLRUCounter++,!n&&++this._cacheSize>this._cacheSizeHighWaterMark&&this._containerPurge()},containerGet:function(e){return this._cacheLRU[e]=this._cacheLRUCounter++,this._cache[e]},containerFlush
:function(e){CW.fatalError("Developer must provide a containerFlush method")}},CK.MicroResourceContainer.LoadStatus={NOT_LOADED:undefined,PENDING:"pending",LOADED:"loaded",FAILED:"failed"},CK.MicroResourceContainerServerError=SC.Object.extend({message:"",failedInputs:[]}),CK.iCloudMembershipController=SC.Object.extend(CK.MicroResourceContainer,{init:function(e){arguments.callee.base.apply(this,arguments),this.containerInit()},getICloudMemberState:function(e){return this.containerGetStatus(e)},getICloudMemberValue:function(e){return this.containerGet(e)},isICloudMember:function(e,t){this.containerLoad(e,t)},containerFlush:function(e){var t=this,n=[],r={};e&&e.forEach(function(e){var i=e.key;!r[i]&&!t._cache[i]&&(n.push({type:CK.matchesFormatOfEmailAddress(i)?"email":"phoneNumber",value:i}),r[i]=!0)});if(!n.length){this._flushResult(e,n);return}var i=CK.Request.postUrl("/ws/v1/autocomplete/membershipInfo");return i.set("serviceName","cksharews"),i.set("withCredentials",YES),i.set("isJSON",!0),i.set("timeout",3e4),i.notify(200,null,function(r){var i=r&&r.get("body"),s=i&&i.results;return!s||!s.forEach?t._flushResult(e,n,null):t._flushResult(e,n,s),YES}),i.notify(0,null,function(r){return t._flushResult(e,n,null),YES}),i.send({lookupInfos:n})},_flushResult:function(e,t,n){var r=this,i,s=[],o=[];if(n)n.forEach(function(e){s.push(e.value),o.push(e.isInNetwork)});else{var s=t.map(function(e){return e.value});i=CK.MicroResourceContainerServerError.create({message:"Server error: failed to validate iCloud membership.",failedInputs:s})}r.containerStoreResults(s,o,i,e)}}),CK.iCloudMembershipController
.sharedInstance=function(){return CK.iCloudMembershipController._sharedInstance||(CK.iCloudMembershipController._sharedInstance=CK.iCloudMembershipController.create())},CK.meCardController=SC.Object.create({NO_PHOTO_SRC:window.devicePixelRatio>1?"/applications/mail/1808Project39/frameworks/cloudkit/foundation/1808Project39/en-us/source/resources/images/no_photo@2x.png":"/applications/mail/1808Project39/frameworks/cloudkit/foundation/1808Project39/en-us/source/resources/images/no_photo.png",photoChanged:NO,meCardUrl:function(){var e=CK.servicesController.getServiceUrlFor("contacts")+"/co/mecard/";return e}.property(),meCard:null,meCardRequirementSatisfied:NO,imgLoadError:NO,shouldCreateMeCard:NO,getMeCard:function(e){if(!CK.servicesController.getServiceInfoFor("contacts")){SC.debug("meCardController: not requesting me-card since contacts is disabled."),this.set("meCardRequirementSatisfied",YES),e instanceof Function&&e(1);return}var t=this.get("meCardUrl"),n=CK.Request.getUrl(t,null),r=this;n.set("reportRequest",YES),n.notify(200,this,function(t){var n=t.get("body");return typeof n=="string"&&(n=JSON.parse(n)),!n||!n.contacts?(SC.debug("no me-card is set"),r.set("shouldCreateMeCard",YES),r.set("meCard",{})):(SC.debug("meCardController: me-card received"),r.set("meCard",n.contacts[0])),e instanceof Function&&e(0),r.set("meCardRequirementSatisfied",YES),YES}),n.notify(0,this,function(t){SC.debug("meCardController: problem receiving me-card");if(CloudOS.getEnvironment()==="DEMO"){SC.debug("meCardController: using appleseed me-card in DEMO");var n="/applications/mail/1808Project39/frameworks/cloudkit/foundation/1808Project39/en-us/source/resources/images/appleseed_small.jpg"
;r.set("meCard",{photo:{url:n,crop:{height:165,width:165,y:22,x:11}}})}else r.set("shouldCreateMeCard",YES);return e instanceof Function&&e(1),r.set("meCardRequirementSatisfied",YES),YES}),SC.debug("Sending me card GET request to %@",t),n.send()},storeMeCard:function(e,t){var n=this.get("meCard");if(!CK.servicesController.getServiceInfoFor("contacts")){SC.debug("meCardController: not storing me-card since contacts is disabled.");return}var r=this.get("shouldCreateMeCard"),i=r?"POST":"PUT",s=this.get("meCardUrl")+"?method="+i,o=CK.Request.postUrl(s,null),u=this,a,f;o.set("isJSON",YES),o.set("reportRequest",YES),a=n?n:{};if(e)for(f in e){if(!e.hasOwnProperty(f))continue;a[f]=e[f]}o.notify(200,this,function(e){var n=e.get("body");return n.contacts?(u.set("shouldCreateMeCard",NO),SC.debug("me-card received"),this.set("meCard",n.contacts[0])):SC.debug("no me-card is set"),t instanceof Function&&t(0),YES}),o.notify(0,this,function(e){return SC.debug("problem storing me-card"),t instanceof Function&&t(1),YES});if(r){a.contactId=CW.upperCaseUUID();var l=CloudOS.authController,c=l.get("user"),h=c.get("isPrimaryAppleIdTypeEmail"),p=c.get("isPrimaryAppleIdTypePhoneNumber"),d=c.get("displayablePrimaryAppleId"),v=[{field:d}];a.firstName=c.get("firstName"),a.lastName=c.get("lastName"),h?(v[0].label="home",a.emailAddresses=v):p&&(v[0].label="mobile",a.phones=v)}var m={contacts:[a]};SC.debug("Sending me card GET request to %@",s),o.send(m)},completePhotoPicker:function(e){var t={url:e.photoUrl,crop:e.photoCrop,signature:e.photoSignature};this.set("photo",t),this.set("photoChanged",YES)},meCardPosted
:function(){this.getMeCard()},photoUrl:function(e,t){if(t===undefined)return this.getPath("photo.url")||null;var n=this.get("photo");n.url=t}.property("photo"),photoCrop:function(e,t){if(t===undefined)return this.getPath("photo.crop")||null;var n=this.get("photo");n.crop=t}.property("photo"),photoSignature:function(e,t){if(t===undefined)return this.getPath("photo.signature");var n=this.get("photo");n.signature=t}.property("photo"),photo:function(e,t){if(t===undefined)return this.getPath("meCard.photo");var n=this.get("meCard");n&&(n.photo=t)}.property("meCard"),isPhotoUrlValid:function(){return!this.get("imgLoadError")&&!!this.get("photoUrl")}.property("photoUrl","imgLoadError"),deletePhoto:function(){this.set("photo",null),this.set("photoChanged",YES)},reset:function(){this.set("meCard",null),this.set("meCardRequirementSatisfied",NO)}}),SC.mixin(CK,{OFFLINE_TYPE_SESSION_STORAGE:"SessionStorage",OFFLINE_TYPE_LOCAL_STORAGE:"LocalStorage",OFFLINE_TYPE_SQL_DATABASE:"SQLDatabase",OFFLINE_REASON_NETWORKING_ERROR:"NetworkingError",OFFLINE_REASON_TIMEOUT:"Timeout",OFFLINE_REASON_SERVER_ERROR:"ServerError",OFFLINE_REASON_STARTUP_WAIT:"StartupWait"}),CK.offlineController=SC.Object.create({isOfflineEnabled:NO,offlineType:null,isOffline:function(){var e=NO,t;return this.get("isOfflineEnabled")&&this.get("offlineType")&&(t=this.get("offlineReasons"),t&&t.get("length")>0&&(e=YES)),e}.property("isOfflineEnabled","offlineType","offlineReasons").cacheable(),offlineReason:function(){var e="",t;return this.get("isOfflineEnabled")&&this.get("offlineType")&&(t=this.get("offlineReasons"),t&&t.get
("length")>0&&(t.contains(CK.OFFLINE_REASON_NETWORKING_ERROR)?e="NetworkingError":t.contains(CK.OFFLINE_REASON_TIMEOUT)?e="Timeout":t.contains(CK.OFFLINE_REASON_SERVER_ERROR)?e="ServerError":e=t.get("firstObject"),e=("Dock."+e).loc()!=="Dock."+e?e:"")),e}.property("offlineReasons").cacheable(),offlineReasons:null,addOfflineReason:function(e){var t=this.get("offlineReasons");t?t.add(e):(t=SC.Set.create([e]),this.set("offlineReasons",t),t.addObserver("[]",this,this.offlineReasonsContentDidChange))},removeOfflineReason:function(e){var t=this.get("offlineReasons");t&&t.contains(e)&&t.remove(e)},hasOfflineReasonOtherThan:function(e){if(!this.get("isOffline"))return NO;var t=this.get("offlineReasons");return t.contains(e)?t.get("length")!==1:t.get("length")>=1},offlineReasonsContentDidChange:function(){this.notifyPropertyChange("isOffline"),this.notifyPropertyChange("offlineReason")},deviceStateDidChange:function(){var e=SC.device.get("isOffline"),t=CK.OFFLINE_REASON_NETWORKING_ERROR;e?this.addOfflineReason(t):this.removeOfflineReason(t)}.observes("SC.device.isOffline"),init:function(){this.deviceStateDidChange()},toString:function(){var e=arguments.callee.base.apply(this,arguments);return e&&(e="Offline controller ("+e+")"),e}}),CK.StatsController=SC.Object.extend({_statsQueue:[],statSessionId:null,STAT_COALESCING_WINDOW:8e3,includedParams:{},recordStat:function(e,t,n){var r,i,s=this.get("includedParams"),o=e+t,u=window.CloudOS&&!CloudOS.isCloudOSClient,a=u&&CloudOS.getClientId?CloudOS.getClientId():this.get("statSessionId");r={statName:o,statSessionId:a,hostname:window.location.
hostname,buildNumber:SC.buildNumber,platform:window.CloudOSBootstrap&&CloudOSBootstrap.isOnSupportedMobile?"mobile":"desktop"};if(!n||!n.appName)r.appName=e;for(var f in s)r[f]=s[f];i=SC.merge(n,r);try{SC.json.encode(i)}catch(l){CW.fatalError("'%@' stat from '%@' cannot be encoded, possibly a circular reference.".fmt(t,e))}this._statsQueue.push(i),this.invokeOnceLater(this.sendStats,this.STAT_COALESCING_WINDOW)},_benchmarkStats:{},getStat:function(e,t){return this._getBenchmark(e,t)},beginStat:function(e,t,n){if(this.getStat(e,t)){SC.warn("%@ stat already exists for %@",t,e);return}n=n||{},n._startTime=SC.getCurrentTimeForPerformance(),this._recordBenchmark(e,t,n)},endStat:function(e,t,n,r,i){var s=this.getStat(e,t);if(!s){SC.warn("%@ stat does not exist for %@",t,e);return}r=r?r:"duration",s[r]=SC.getCurrentTimeForPerformance()-s._startTime,delete s._startTime;var o=SC.merge(n,s);i?this.recordLocationStat(e,t,o):this.recordStat(e,t,o),this._clearBenchmark(e,t)},cancelStat:function(e,t){var n=this._getBenchmark(e,t);n&&this._clearBenchmark(e,t)},_getBenchmark:function(e,t){var n=this._benchmarkStats;if(!n[e]||!n[e][t])return;return n[e][t]},_clearBenchmark:function(e,t){var n=this._benchmarkStats;delete n[e][t]},_recordBenchmark:function(e,t,n){var r=this._benchmarkStats;r[e]||(r[e]={}),r[e][t]=n},endAllBenchmarkStats:function(e){var t=this._benchmarkStats,n,r,i;for(n in t){if(e&&n!==e)continue;for(r in t[n])i=t[n][r],this.endStat(n,r,i)}},sendStats:function(e,t){var n=this._statsQueue;if(!n||n.length===0)return;var r=CW.Request.postUrl("/reportStats");r.set("addressPrefix","https://feedbackws.icloud.com"
),r.set("useCrossDomain",YES),r.set("isJSON",YES),r.set("attachIdentifyingHeaders",NO),r.set("isAsynchronous",e===undefined?YES:e),r.set("timeout",null),r.header("Content-Type","text/plain"),r.notify(200,this,function(e){return SC.info("Successfully sent stats to feedbackws"),t&&t.call(undefined,e),YES}),r.notify(0,this,function(e){return SC.warn("Error sending stats to feedbackws"),t&&t.call(undefined,e),YES}),SC.debug("Sending stats to feedbackws"),r.send({stats:n}),this._statsQueue=[]},flushStats:function(){this.endAllBenchmarkStats(),this.sendStats(NO)},recordLocationStat:function(e,t,n){n||(n={});var r=window.COS;if(!r){SC.warn("recordLocationStat() is only available to icloud.com authenticated applications.");return}this.recordStat(e,t,this.includeLocationAndBrowserLocale(n))},includeLocationAndBrowserLocale:function(e){var t=COS.authController.get("requestInfo");t&&(e.region=t.region,e.country=t.country),e.time=(new Date).toString()+"        ("+Math.floor(new Date)+")";var n=(new Date).toString().match(/.*?\((.*?)\).*/);return n&&n.length===2&&(e.timezone=n[1]),e.browserLocale=(navigator.language||navigator.browserLanguage).toLowerCase(),e}}),CK.CloudOSGetterSupport={getUser:function(){var e=this.get("appInstance"),t=e?e._cloudOSState:null;if(!e||!t)return window.COS&&COS.authController?COS.authController.get("user"):null;var n=t.authBag;return!e._cos_user_cache&&n?(SC.debug("Creating local CK.User object"),e._cos_user_cache=CK.User.createFromAuthBag(n)):n||SC.warn("Cannot getUser() before authenticating."),e._cos_user_cache},isUserNotAuthenticated:function(){if(window
.COS&&COS.authController)return COS.authController.get("isNotAuthenticated");if(CK.currentApplication){var e=this.get("appInstance");if(e&&e._cloudOSState)return e._cloudOSState.userAuthenticationState===CK.AuthenticationStateEnum.NOT_AUTHENTICATED}return undefined},isUserPartiallyAuthenticated:function(){if(window.COS&&COS.authController)return COS.authController.get("isPartiallyAuthenticated");if(CK.currentApplication){var e=this.get("appInstance");if(e&&e._cloudOSState)return e._cloudOSState.userAuthenticationState===CK.AuthenticationStateEnum.PARTIALLY_AUTHENTICATED_HSA}return undefined},isUserAuthenticated:function(){if(window.COS&&COS.authController)return COS.authController.get("isAuthenticated");if(CK.currentApplication){var e=this.get("appInstance");if(e&&e._cloudOSState)return e._cloudOSState.userAuthenticationState===CK.AuthenticationStateEnum.AUTHENTICATED}return undefined},userIsAuthenticated:function(){return this.isUserAuthenticated()},getAccountPreferences:function(){if(window.COS&&COS.authController)return COS.authController.accountPreferences();if(CK.currentApplication){var e=this.get("appInstance");if(!e._cos_account_preferences_cache){SC.debug("Creating local CK.AccountPreferences object");var t=e._cloudOSState.accountPreferences;if(!t){SC.warn("Cannot getAccountPreferences() before authenticating.");return}e._cos_account_preferences_cache=CK.AccountPreferences.create(t)}return e._cos_account_preferences_cache}return null},getAppInfo:function(e){var t=this.getAppInfoList();for(var n=0;n<t.length;n++){if(!t[n])return undefined;if(t[n].get("name")===e)return t
[n]}},getAppInfoList:function(){var e=[],t;if(CK.currentApplication)t=this.get("appInstance"),t&&t._cloudOSState&&(e=t._cloudOSState.appsInfo||e,e=e.map(function(e){return COS.AppInfo.create(e)}));else if(window.COS&&COS.appsController){var n=COS.apps,r;for(r in n)e.push(COS.appsController.getAppInfoFor(r))}return e},getUserRegionFormat:function(){var e=this.getAccountPreferences(),t;return e?t=e.get("regionFormat")||e.get("locale"):t=String.preferredLanguage,t&&(t=CK.computeBestAvailableLocale(CK.SUPPORTED_REGION_FORMATS,t)),t},getAppDisplayName:function(){var e=this.get("appInstance"),t=e?e._cloudOSState:null;return t?t.displayName:null},getAccountMenu:function(){var e=this.get("appInstance"),t=e?e._cloudOSState:null;return t?t.accountMenu:null},getAccountMenuItems:function(){var e=this.getAccountMenu(),t;return e&&e.items?t=e.items:t=[{title:"AccountMenu.SignOut".loc(),target:"CloudOS",action:"performLogout"}],t=t.map(function(e){var t=e.action,n=SC.objectForPropertyPath(e.target)||CloudOS;return e.action=function(){n&&n[t]&&n[t].call(n)},delete e.target,e}),t},getAccountMenuWidth:function(){var e=this.getAccountMenu();return e&&e.width?e.width:200},getUrlForServiceName:function(e,t){var n=this.get("appInstance");return e=SC.typeOf(e)===SC.T_STRING?e:n.get("name"),CK.servicesController.getServiceUrlFor(e,!!t)},getStatusForServiceName:function(e,t){var n=this.get("appInstance");return e=SC.typeOf(e)===SC.T_STRING?e:n.get("name"),CK.servicesController.getServiceStatusFor(e,!!t)},getAppLoadReason:function(){return this.get("loadReason")},getCurrentlyActiveApplication:function(
){var e=this.get("appInstance");return e._cloudOSState.currentlyActiveApplication},getRoute:function(){var e=this.get("appInstance");return e._cloudOSState.route},getAppPreferences:function(e){if(!CK.isLoadedByCloudOS&&window.COS&&COS.prefsController){var t=SC.clone(COS.prefsController.allAppPreferencesHash());return e?t[e]:t}if(CK.currentApplication){var n=this.get("appInstance"),r=n.get("name"),i;e=e?e:r,i=SC.clone(n._cloudOSState.appPreferences[e],YES);if(!i){SC.warn("Failed to getAppPreferences() for %@",e);return}return e===r?(n._cos_app_preferences_cache||(n._cos_app_preferences_cache=i),n._cos_app_preferences_cache):i}},getRequestedStartupUrl:function(){var e=this.get("appInstance");return e._cloudOSState.requestedStartupUrl},getRequestedStartupInfo:function(){var e=this.get("appInstance");return e._cloudOSState.requestedStartupInfo},getEnvironment:function(){if(this.isCloudOSClient)return COS.authController.get("environment");var e=this.get("appInstance");return e._cloudOSState.environment},getClientId:function(){var e=this.get("appInstance");return e._cloudOSState.clientId},sessionIsExtendedLogin:function(){var e=this.get("appInstance");return e._cloudOSState.authBag.isExtendedLogin},getHostname:function(){var e=this.get("appInstance");return e._cloudOSState.hostname},getAvailableLocales:function(){var e=this.get("appInstance");return e._cloudOSState.availableLocales},getLocalesSupportedByAllApps:function(){var e=this.get("appInstance");return e._cloudOSState.localesSupportedByAllApps},mailTo:function(e,t,n,r,i,s){var o=this.get("appInstance"),u="",a,f,l={to:e?e:"",
subject:t?t:"",body:n?n:"",cc:r?r:"",bcc:i?i:"",attachments:s?s:null,appName:CK.currentApplication.get("capitalizedName")};u="&willPM=true";if(CK.servicesController.getServiceInfoFor("mail")){var c=CloudOS.getAccountPreferences(),h=c.get("locale"),p=c.get("secondaryLocale")||"en-us",d=CloudOS.getLocalesSupportedByAllApps().map(function(e){return e.locale}),v=!1,m=d.length;for(var g=0;g<m;g++)if(d[g]===h){v=!0;break}var y=v?h:p,b=CK.openWindowApplication("https://%@/message/current/%@/index.html#compose?%@".fmt(window.location.hostname,y,u),"","width=810,height=644,resizable=yes,scrollbars=auto,status=no,menubar=no,toolbar=no,location=no,directories=no");CK.passWindowApplicationMessage(b,"populateFields",l)}else{var w=[];r&&w.push("cc="+r),i&&w.push("bcc="+i),n&&w.push("body="+encodeURI(n)),t&&w.push("subject="+encodeURI(t)),CK.redirectTo("mailto:%@?%@".fmt(e,w.join("&")))}},openIWorkDocument:function(e,t,n){var r={fileName:e,url:t,source:this.get("appInstance").get("name")},i=CloudOS.getUser(),s=location.protocol+"//"+location.hostname,o=i&&i.get("brMigrated")?s+"/"+n+"/open_from_source":"/iw/#open_from_source/"+n,u=CK.openWindowApplication(o,"_blank");CK.passWindowApplicationMessage(u,"openFromSource",r)},getOpenersForDocument:function(e){var t=CK.FilenameUtils.normalizedExtension(e),n;return n=this._appsForExtension(t),n},_appsForExtension:function(e){var t=this.getAppInfoList(),n=[],r,i,s;for(var o=0;o<t.length;o++)i=t[o],s=i.get("supportedFileExtensions"),s&&s.contains(e)&&n.push(i);return n},openICloudDriveFile:function(e,t,n){var r=NO;n||(n=this.getOpenersForDocument(t
.name)[0]);if(n){var i=n.get("name");if(i==="pages"||i==="numbers"||i==="keynote")r=this._openIWorkDriveFile(e,t,i)}return r},_openIWorkDriveFile:function(e,t,n){var r,i,s,o,u,a=NO;return t.name&&(r=CK.FilenameUtils.baseName(t.name),r=r.replace(/[\s\/\u0085\u00a0\u1680\u180e\u2000-\u200d\u2028\u2029\u202f\u205f\u2060\u3000\ufeff]/g,"_"),t.sharingToken?(i=t.sharingToken,u="//www.icloud.com/%@/%@#%@".fmt(n,i,r)):t.documentId&&(s=CloudOS.getUser().get("dsid"),o=t.documentId,u="//www.icloud.com/%@/docws:%@:%@:%@#%@".fmt(n,s,e,o,r)),u&&(a=CK.openWindowApplication(u,"_blank"))),a},showHelp:function(e){var t=this.get("appInstance");CK.HelpUtils.open(t&&t.get("name"),e)},requestMeCard:function(){var e=this.appInstance,t=this.isCloudOSClient,n=e?e.isWindowApplication:!1,r=CK.meCardController,i=function(t,n){var r=!!t.photo,i={prefix:t.prefix,firstName:t.firstName,lastName:t.lastName,suffix:t.suffix,photoUrl:r?t.photo.url:null,photoCrop:r?t.photo.crop:null,photoSignature:r?t.photo.signature:null};if(n)return i;e.receiveMeCard(i)},s,o;t?(s=r.get("meCard"),s?o=!1:o=!0):n?(s=e._cloudOSState.meCard,s||(s=r.get("meCard")),s?o=!1:o=!0):(s=e._cloudOSState.meCard,o=!1);if(!!s)return i(s,t);if(!o)return;r.getMeCard(function(){s=r.get("meCard");if(!!s)return i(s,t);SC.debug("requestMeCard: No meCard present")})},windowApplicationHasInitialized:function(e,t,n){CK.windowApplicationDidInitialize(e);if(!n){var r;if(CK.currentApplication){var i=this.get("appInstance"),s=CK.currentApplication;r=i._cloudOSState}else r=COS.cloudOSStateForApp(t);CK.passWindowApplicationMessage(e,"_applicationShouldInvokeMain"
,CloudOS._cloudOSAPIMethodNames,r)}CK.passPendingWindowApplicationMessages(e)},windowApplicationIsKnown:function(e){return CK.windowApplicationIsRegistered(e)},windowApplicationWillClose:function(e){var t=CK.getBackwardCompatibleInstanceId(e);CK.windowApplication[t]=null},exit:function(e,t){var n;if(CK.currentApplication)e=arguments[0],t=arguments[1],n=this.getPath("appInstance.name"),!t&&e!==CK.EXIT_NON_FATAL&&(t=SC.Logger.stringifyRecordedLogMessages());else{var r=arguments[0];e=arguments[2],t=arguments[3],n=r.get("name")}if(e===undefined||n===undefined){SC.warn("statusCode and appName must be provided for exit()");return}this.invokeLast(function(){CK.currentApplication?this.get("appInstance").invokeMethodOnCloudOS(n,"exit",[e,t]):this.appController.exitApplication(n,e,t)})},passMessageToOpenerApplication:function(e){var t=CloudOS.getOpenerWithCloudOS();if(t){var n=this.get("appInstance"),r=SC.$A(arguments);r.shift(),n.invokeMethodOnCloudOS(n.get("name"),e,r,t)}},getOpenerWithCloudOS:function(){var e,t;CK.currentApplication?e=this.getPath("appInstance.cloudOSWindow"):e=window;try{e&&e.opener&&e.opener.CloudOS&&(t=e.opener,SC.info("Found an openers CloudOS instance"))}catch(n){SC.info("No opener found, or not allow to get reference to its CloudOS")}return t},hasOpenerWithCloudOS:function(){return!!CloudOS.getOpenerWithCloudOS()},setAppBanner:function(){var e=SC.$A(arguments);if(CK.currentApplication){var t=this.getPath("appInstance.name");if(e.length!==1){SC.warn("setAppBanner expects exactly 1 argument.");return}e.push(t),this.get("appInstance").invokeMethodOnCloudOS(this.
getPath("appInstance.name"),"setAppBanner",e)}else{if(e.length<4){SC.warn("There are not enough arguments for function setAppBanner.");return}CloudOS.bannerManager.setAppBanner(e[2],e[3])}},currentAppName:function(){var e;return CK.currentApplication?e=this.getPath("appInstance.name"):e=CloudOS.appController.getPath("currentApp.name"),e},getQuotaData:function(){var e=this.get("appInstance");if(!e||!e._cloudOSState)return window.COS&&COS.authController?COS.authController.get("quotaInfo"):null;var t=e._cloudOSState.quotaData;return!e._cos_quota_cache&&t?(SC.debug("Creating local CK.QuotaInfo object"),e._cos_quota_cache=CK.QuotaInfo.create(t)):t||SC.warn("Cannot set Quota Data."),e._cos_quota_cache},isUserOverQuota:function(){var e=this.getQuotaData();return e?e.get("overQuota"):null},refreshQuotaData:function(){CK.currentApplication?this.get("appInstance").invokeMethodOnCloudOS(this.getPath("appInstance.name"),"refreshQuotaData"):window.COS&&COS.authController&&COS.authController.getQuotaData()},isHSAChallengeRequired:function(){var e=this.get("appInstance");if(!e||!e._cloudOSState)return window.COS&&COS.authController?COS.authController.get("hsaChallengeRequired"):null;var t=e._cloudOSState;return t.authBag.hsaChallengeRequired},resolveCKShortGUID:function(){if(CK.currentApplication)this.get("appInstance").invokeMethodOnCloudOS(this.getPath("appInstance.name"),"resolveCKShortGUID",SC.$A(arguments));else if(window.COS&&COS.authController){var e=arguments[0].get("name"),t=arguments[2],n="#"+e+"/"+t;window.location.hash===n?CloudOS.statechart.sendAction("goToSharingState",{shortGUID
:t,appNameFromUrl:e}):window.location.hash="#"+e+"/"+t}},replaceCurrentApp:function(){if(CK.currentApplication)this.get("appInstance").invokeMethodOnCloudOS(this.getPath("appInstance.name"),"replaceCurrentApp",SC.$A(arguments));else if(window.CloudOS&&CloudOS.isCloudOSClient){var e=arguments[0],t=e.get("name"),n=arguments[2],r=CloudOS.appManagerFor(n),i=CloudOS.appController,s=CloudOS.authController._auth_bag.apps,o=function(){r=CloudOS.appManagerFor(n),CloudOS.appController.set("pendingApp",r),r.set("loadReason",CK.LOAD_REASON_APP_REPLACED),CloudOS.statechart.sendAction("globalAppSwitchWasRequested"),CW.notificationCenter.subscribeToNotification("App Loaded",this,function(t,r){t===n&&(e.teardown(YES),i.removeOmittedApps(s))})};i.replaceOrAddApp(s,t,n),i.addAppsReplaced(t,n),r?o():(CW.notificationCenter.subscribeToNotification("receivedInfoForDynamicApp",this,function(t,r){t===n&&(i.notifyPropertyChange("appList"),r?(e.teardown(YES),i.removeOmittedApps(s)):o())}),i.detectAndLoadAdditionalApps(s))}},getWindowMinimumSize:function(){if(window.COS)return{minWidth:COS.MIN_WIDTH,minHeight:COS.MIN_HEIGHT};var e=this.get("appInstance");if(e&&e._cloudOSState)return e._cloudOSState.mininumWindowSize},isOnSupportedMobile:function(){if(window.CloudOSBootstrap)return CloudOSBootstrap.isOnSupportedMobile;var e=this.get("appInstance");if(e&&e._cloudOSState)return e._cloudOSState.isOnSupportedMobile},getSecureChannelInfo:function(){var e=this.get("appInstance"),t=e?e._cloudOSState:null;if(!e||!t)return window.COS&&COS.authController?COS.authController.get("secureChannelInfo"):null;var n=t.secureChannelInfoData
;return!e._secure_channel_info_cache&&n?(SC.debug("Creating local CK.SecureChannelInfo object"),e._secure_channel_info_cache=CK.SecureChannelInfo.create(n)):n||SC.warn("No secure Channel Info object. The user might not have used the secure channel route for logging in."),e._secure_channel_info_cache}},CK.RequestDelegate={isCKRequestDelegate:YES,getUrlForServiceName:function(e){return null},didReceiveSpecialResponse:function(e,t,n){}},CK.Application=SC.Application.extend(SC.DelegateSupport,{isCloudKitApplication:YES,name:null,primaryServiceName:null,statechartPath:null,usesAuth:YES,requiresAuth:YES,usesPush:YES,_rpcCallbacks:{},postMessageTargetOrigin:function(){var e="https://"+CloudOS.getHostname();return e}.property(),cloudOSWindow:function(){return window.parent}.property(),capitalizedName:function(){var e=this.get("name");return e&&(e.charAt(0)!=="i"?e=e.capitalize():e="i"+e.substring(1).capitalize()),e}.property("name").cacheable(),isReadyToTerminate:YES,isReadyToTerminateDidChange:function(){CloudOS.isReadyToTerminateDidChange(this.get("isReadyToTerminate"))}.observes("isReadyToTerminate"),delegate:null,init:function(){arguments.callee.base.apply(this,arguments),SC.Logger.set("outputMessagePrefix",this.get("capitalizedName")+":  "),CK.currentApplication=this,SC.suppressMain=YES,SC.Event.add(window,"message",this,SC.RunLoop.wrapFunction(this._messageWasReceived),null,!0)},setupBeforeUnloadHandler:function(){SC.Event.add(window,"unload",this,function(){CloudOS.appWillUnload(SC.Logger.stringifyRecordedLogMessages())})},_messageWasReceived:function(e){var t=e.originalEvent
,n=t.data,r;try{r=SC.typeOf(n)!==SC.T_STRING?n:SC.json.decode(n)}catch(i){SC.warn(i);return}if(r&&r.methodName===CK.RPC_RESPONSE){var s=r.args,o=s.shift(),u=this._rpcCallbacks[o];delete this._rpcCallbacks.rpcID,u.apply(u,s);return}if(e.isProxyMessage){this.passMessage(r);return}if(!r||!r.isCloudOSMessage)return;var a=URI(t.origin);if(a.protocol()!=="https"||a.domain()!=="icloud.com"){SC.warn("postMessage coming from untrusted domain");return}var s=r.args||[],f=[this.get("delegate"),r.methodName],l,c;for(l=0,c=s.length;l<c;l++)f.push(s[l]);this.invokeDelegateMethod.apply(this,f)},applicationWillBecomeActive:function(){SC.debug("APPLICATION: Received applicationWillBecomeActive")},applicationDidBecomeActive:function(e){SC.debug("APPLICATION: Received applicationDidBecomeActive")},applicationWillSuspend:function(){SC.debug("APPLICATION: Received applicationWillSuspend")},applicationDidSuspend:function(){SC.debug("APPLICATION: Received applicationDidSuspend")},secondaryAuthDidSucceed:function(){SC.debug("APPLICATION: Received secondaryAuthDidSucceed")},secondaryAuthDidFail:function(){SC.debug("APPLICATION: Received secondaryAuthDidFail")},didFetchStartup:function(e,t,n){SC.debug("APPLICATION: Received didFetchStartup")},didReceiveNotification:function(e){SC.debug("APPLICATION: Received didReceiveNotification")},didLaunchWithNotification:function(e){SC.debug("APPLICATION: Received didLaunchWithNotification")},applicationShouldRefresh:function(e){SC.debug("APPLICATION: Received applicationShouldRefresh")},accountPreferencesDidChange:function(){SC.debug("APPLICATION: Received accountPreferencesDidChange"
)},appPreferencesDidChange:function(){SC.debug("APPLICATION: Received appPreferencesDidChange")},userDidRevalidate:function(){SC.Request.manager.resumeAllServices()},routeDidChange:function(e){SC.debug("APPLICATION: Received routeDidChange")},miniSpringboardDismissed:function(){SC.debug("APPLICATION: Received miniSpringboardDismissed"),CW.notificationCenter.postNotification("miniSpringboardDismissed")},quotaDataDidChange:function(){SC.debug("APPLICATION: Received quotaDataDidChange")},_applicationShouldInvokeMain:function(e,t,n,r){SC.run(function(){!e&&!CK.currentApplication?CW.fatalError("No methodNames, we cannot continue."):e||(e=[]);var i=this.get("name"),s=t.authBag,o=t.regionFormattingRules,u=CK.region,a,f,l;o&&u&&u.registerRegionFormat(o),this._cloudOSState=t,s&&CK.servicesController._setupFromBag(s);var c=t.additionalClassNamesForBody;c&&(window.document.body.className+=" "+c);var h=window.CloudOS||SC.Object.create({isCloudOSProxy:YES});if(!h.hasBeenInitialized){h.mixin(CK.CloudOSGetterSupport),h.set("appInstance",this),h.set("loadReason",n),h.isBeta=t.isBeta,h.isCarry=t.isCarry,h.isCarryUser=t.isCarryUser,h.isFuture=t.isFuture,h._cloudOSAPIMethodNames=e,h.hasBeenInitialized=YES,window.CloudOS||(window.CloudOS=h);var p=this;for(a=0,f=e.length;a<f;a++){l=e[a];if(window.CloudOS[l]!==undefined)continue;window.CloudOS[l]=function(){var e=l;return function(){var t=SC.$A(arguments);return p.invokeMethodOnCloudOS(i,e,t)}}()}}this.setupBeforeUnloadHandler(),window.main(n,r)},this)},invokeMethodOnCloudOS:function(e,t,n,r){var i,s=n.length-1,o=n[s],u=typeof o=="function";if(u)
{var a=n.splice(s)[0];i=CW.upperCaseUUID(),this._rpcCallbacks[i]=a}var f=this._createMessage(e,t,n),l;i&&(f.id=i);try{l=JSON.stringify(f)}catch(c){SC.warn("There was a problem stringifying the message when sending message %@, %@",t,c);if(t!=="handleApplicationCrash")return undefined;f.args=null,l=JSON.stringify(f)}return this.passMessage(l,r)},_createMessage:function(e,t,n){return{isCloudOSMessage:!0,methodName:t,appName:e,buildNumber:SC.buildNumber,masteringNumber:SC.masteringNumber,args:n}},passMessage:function(e,t){return t=t?t:this.get("cloudOSWindow"),t.postMessage(e,this.get("postMessageTargetOrigin"))},_cloudOSStateChange:function(e){var t=e.authBag,n=e.quotaData,r=e.accountPreferences,i=e.accountMenu,s=e.appPreferences,o=e.userAuthenticationState,u=e.route,a=this._cloudOSState||{};t&&(CK.servicesController._setupFromBag(t),this._cos_user_cache=null,a.authBag=t),n&&(this._cos_quota_cache=null,a.quotaData=n),r&&(this._cos_account_preferences_cache=null,a.accountPreferences=r);if(s){var f=a.appPreferences||{},l;for(l in s)f[l]=s[l],l===this.get("name")&&(this._cos_app_preferences_cache=null,this.tryToPerform("appPreferencesDidChange"));a.appPreferences=f}if(i){var c=a.accountMenu||{};for(var h in i)c[h]=i[h];a.accountMenu=c}u!==undefined&&(a.route=u),o!==undefined&&(a.userAuthenticationState=o),this._cloudOSState=a},_clearUserState:function(){var e=this._cloudOSState;e&&(e.authBag=null,e.quotaData=null,e.appPreferences=null,e.accountPreferences=null),this._cos_user_cache=null,this._cos_account_preferences_cache=null},_sleepCount:0,_sleep:function(){var e=this._sleepCount++
;e===0&&(CW.Request.suspendResponses(),SC.backgroundTaskQueue.suspend(),SC.Module.suspend())},_wake:function(){var e=--this._sleepCount;e<0?(SC.warn("CK.Application._wake() was called without a paired _sleep() invocation; ignoring…"),this._sleepCount=0):e===0&&(SC.Module.resume(),SC.backgroundTaskQueue.resume(),CW.Request.resumeResponses())},_hasReceivedFocus:function(){var e=window.$('[role="button"]');try{var t=e[0];t&&(t.setAttribute("tabindex","0"),t.blur(),t.focus())}catch(n){SC.info("_hasReceivedFocus(): Could not find a button on the page to focus: %@",n)}},_mouseMove:function(e){var t=SC.RootResponder;t=t&&t.responder;if(!t)return;e.allowDefault=function(){},e.stopPropagation=function(){},t.mousemove(SC.Event.create(e))},_mouseUp:function(e){var t=SC.RootResponder;t=t&&t.responder;if(!t)return;e.allowDefault=function(){},e.stopPropagation=function(){},t.mouseup(SC.Event.create(e))},willResolveCKShortGUID:function(e){},didResolveCKShortGUID:function(e,t){},didFailToResolveCKShortGUID:function(e,t){},didResolveCKShortGUIDWithoutAcceptance:function(e,t){},ckShortGUIDDidChange:function(e){CloudOS.resolveCKShortGUID(e)}}),CK.CKJSRequest={},CK.CKJSRequest.fetch=function(e,t){var n=e.substr(0,7),r=n==="http://"||n==="https:/",i=t.method||"GET",s=t.headers||{},o=t.body||"",u=CK.CKJSRequest._createQueryParamMapForUrl(e),a=e.split("?");a.length>1&&(e=a[0]);var f={withCredentials:YES,type:i,headers:s,address:e,body:o,reportRequest:YES};t&&t.credentials&&t.credentials.toLowerCase()==="omit"&&(f.withCredentials=NO),r||(f.serviceName="ckdatabasews");var l=CK.Request.create(f),c=Object
.keys(u);for(var h=0;h<c.length;h++){var p=c[h];l.queryParameter(p,u[p])}var d=new Promise(function(e,t){l.notify(200,this,function(n){return CK.CKJSRequest.handleSuccess(n,e,t),YES}.bind(this)),l.notify(0,this,function(n){return CK.CKJSRequest.handleFailure(n,e,t),YES}.bind(this)),l.send()}.bind(this));return d},CK.CKJSRequest.handleSuccess=function(e,t,n){var r=e.getPath("request.addressPrefix")+e.getPath("request.address"),i={status:e.get("status"),type:"default",headers:e.get("headers"),url:r,text:function(){var t=e.get("encodedBody"),n=Promise.resolve(t);return n},json:function(){var t=e.get("encodedBody"),n=JSON.parse(t),r=Promise.resolve(n);return r}};t(i)},CK.CKJSRequest.handleFailure=function(e,t,n){var r=e.get("encodedBody"),i=new TypeError(r);n(i)},CK.CKJSRequest._createQueryParamMapForUrl=function(e){var t={},n=e.split("?");if(n.length>1){var r=n[1].split("&");for(var i=0;i<r.length;i++){var s=r[i],o=s.split("="),u=o[0],a=o[1];t[u]=a}}return t},CK.FilenameUtils={baseName:function(e){var t=e;if(e){var n=e.lastIndexOf(".");n!=-1&&(t=e.substr(0,n))}return t},extension:function(e){var t="";if(e){var n=e.indexOf(".");n!=-1&&(t=e&&e.split(".").pop())}return t},normalizedExtension:function(e){return this.extension(e).toLowerCase()}},CK.HelpUtils={open:function(e,t){var n=CloudOS.getUser(),r=n?n.isLiteAccount():NO,i=this.getHelpLanguageCodeForLocale(String.preferredLanguage),s=i==="en"?"":"?lang="+i,o="https://help.apple.com/"+(r?"icloudwebonly":"icloud")+"/"+s,u=SC.browser.chrome?705:675;t&&(o+="#"+t),window.open(o,"help","height="+u+",width=875,location=0,status=0,scrollbars=0"
)},getHelpLanguageCodeForLocale:function(e){var t=e.split("-"),n=["zh","pt"],r;return n.indexOf(t[0])!==-1?r=e:r=t[0],r}},CK.keyResponder=SC.Object.create({performKeyEquivalent:function(e){return!window.CloudOS||CloudOS.isCloudOSClient?NO:CloudOS.relayKeyboardShortcut(e)}}),CK.appSwitcherKeyResponder=SC.Object.create(CW.KeyResponder,{keyboardShortcuts:{shift_escape:"showAppSwitcher"},_appSwitchers:[],registerAppSwitcher:function(e){this._appSwitchers.pushObject(e)},deregisterAppSwitcher:function(e){this._appSwitchers.removeObject(e)},showAppSwitcher:function(){var e=this._appSwitchers,t,n=e.length,r;for(t=0;t<n;t++){r=e[t];if(r.showAppSwitcherFromKeyboardShortcut())return YES}return NO}}),SC.ready(function(){CW.installKeyResponder(),CW.keyResponders.unshift(CK.appSwitcherKeyResponder),CW.keyResponders.unshift(CK.keyResponder)}),SC.RootResponder.reopen({mousemove:function(e,t){return window.CloudOS&&CloudOS.relayMouseMove(t.clientX,t.clientY),e(t)}.enhance()}),CK.Request=CW.Request.extend(SC.DelegateSupport,CK.RequestReporting,{serviceName:null,useCrossDomain:YES,withCredentials:YES,attachIdentifyingHeaders:NO,contentType:undefined,delegate:null,requestDelegate:function(){var e=this.get("delegate")||window.CloudOS;return e||CW.fatalError("A CK.Request must have a delegate",{target:this}),e}.property("delegate").cacheable(),addressPrefix:function(){var e=null,t,n,r;if(this.get("useCrossDomain")){t=this.get("requestDelegate"),n=this.get("address")||"",r=this._getServiceName();if(n.toLowerCase().indexOf("http")<0){var i;window.CloudOS&&(i=CloudOS.getUser());if(!i&&t===window.CloudOS
)return"https://"+r+".icloud.com:443";e=t.getUrlForServiceName(r,NO),e&&(e[e.length-1]==="/"?n[0]==="/"&&(e=e.slice(0,-1)):n[0]!=="/"&&(e+="/"))}}return e}.property("useCrossDomain"),COPY_KEYS:CW.Request.prototype.COPY_KEYS.concat(["serviceName","delegate"]),init:function(){var e,t,n,r,i,s;arguments.callee.base.apply(this,arguments);if(!this.get("source")){this.get("useCrossDomain")&&(e=this.get("contentType"),e===undefined&&(e="text/plain",this.set("contentType",e))),e||(e=this.get("contentType")),e&&this.header("Content-Type",e),t=this._specialResponseStatuses;if(t){s=this._specialResponseWasReceived;for(n=0,r=t.length;n<r;++n)i=t[n],this.notify(i,this,s)}}},willSend:function(e,t){var n=window.CloudOS&&!CloudOS.isCloudOSClient,r=n&&CloudOS.getUser?CloudOS.getUser():COS.authController.get("user"),i=r?r.get("dsid"):null;i&&e.queryParameter("dsid",i),e.queryParameter("clientId",n&&CloudOS.getClientId?CloudOS.getClientId():COS.CLIENT_ID),e.queryParameter("clientBuildNumber",SC.buildNumber),e.queryParameter("clientMasteringNumber",SC.masteringNumber)},_specialResponseStatuses:[330,401,403,421,503],_specialResponseWasReceived:function(e){SC.debug("Received special response:  %@",e);var t=this.get("requestDelegate"),n=e.get("status"),r=e.get("request"),i=r._getServiceName(),s=r.get("overallTimeout"),o=e.get("addedToOutgoingQueueTimestamp"),u=YES,a=NO,f=NO,l=e.get("body"),c,h,p,d,v;if(SC.typeOf(l)===SC.T_STRING)try{var m=SC.json.decode(l);l=m}catch(g){}if(n===330){var y=this.get("address");if(i&&i!=="keyvalue"){var b=URI(y);b.protocol()&&(SC.info("Removing hostname from %@ so we can pick up the new location"
,b),this.set("address",b.path()+b.search()+b.hash())),SC.Request.manager.suspendService(i)}else SC.error("We received a response with status 330 but the request (%@) was not annotated with a service name",r);a=YES}else if(n===403){v=NO;for(c in l)if(c.match(/^auth[ _\-]?mismatch$/i)){v=YES;break}v||(u=NO)}else if(n===503){if(l)for(c in l)if(c.match(/^retry[ _\-]?after$/i)){h=l[c];break}h&&(h=parseInt(h,10)),h&&(h*=1e3,s&&o&&(p=SC.getCurrentTimeForPerformance()-o,SC.debug("The server is telling us to retry after %@ms, it has been %@ms, and our overall timeout is %@ms",h,p,s),p+h+5e3<s?(SC.debug("  -  it looks like we can make it so automatically retrying request %@…",r),a=YES,u=NO):(SC.debug("  -  it doesn’t look like we can make it so not automatically retrying request %@",r),a=NO,u=YES,d={retryAfter:h/1e3})))}return a&&(s&&o&&(p=SC.getCurrentTimeForPerformance()-o,p<s&&(r=r.copy()._prep(),r.set("overallTimeout",s-p))),this.invokeLater(function(){r.resend(e)},h),f=YES),d||(d={}),d.serviceName=i,u&&t.didReceiveSpecialResponse(n,e.get("encodedBody"),d),f},_getServiceName:function(){var e=this.get("serviceName"),t;return e||(t=CK.currentApplication,e=t?t.get("primaryServiceName")||t.get("name"):null),e}}),SC.Request.manager.mixin({serviceIsSuspended:function(e){e||CW.fatalError("serviceIsSuspended():  A service name must be specified",{target:this});var t=this._suspendedServices;return t&&t[e]},suspendService:function(e){e||CW.fatalError("suspendService():  A service name must be specified",{target:this});var t=this._suspendedServices;t||(t=this._suspendedServices={}),t[e]||SC.
debug("Suspending requests to “%@” service…",e),t[e]=YES},resumeService:function(e){e||CW.fatalError("resumeService():  A service name must be specified",{target:this});var t=this._suspendedServices;t&&(t[e]&&SC.debug("Resuming requests to “%@” service…",e),delete t[e]),SC.Request.manager.fireRequestIfNeeded()},resumeAllServices:function(){var e=this._suspendedServices,t;if(e)for(t in e)e[t]&&this.resumeService(t);SC.Request.manager.fireRequestIfNeeded()},_suspendedServices:null}),SC.Request.manager.mixin({shouldFireRequest:function(e){e||CW.fatalError("shouldFireRequest():  A response must be specified",{target:this});var t=e.get("request"),n=t._getServiceName?t._getServiceName():null;return n?!SC.Request.manager.serviceIsSuspended(n):YES}}),CK.StyleSheet={styles:null,styleSheet:null,setStyleString:function(e){if(e){var t=e.join("");this.styles=e;if(this.styleSheet.styleSheet)this.styleSheet.styleSheet.cssText=t;else{var n=this.styleSheet.childNodes[0],r=document.createTextNode(t);n?this.styleSheet.replaceChild(r,n):this.styleSheet.appendChild(r)}}return this.styles}},SC.mixin(CK.StyleSheet,{create:function(e){var t=SC.beget(CK.StyleSheet),n=document.getElementsByTagName("head")[0],r=document.createElement("style");return r.type="text/css",n.appendChild(r),t.styleSheet=r,t.setStyleString(e?e:[]),t}}),CK.WindowApplication=CK.Application.extend({isWindowApplication:YES,cloudOSWindow:null,requiresAuth:NO,supportsAuthUI:NO,usesPush:NO,init:function(){arguments.callee.base.apply(this,arguments);if(!window.COS){SC.warn("CK.WindowApplication: core_cloudos required to run CK.WindowApplication independently"
);return}var e=null,t=this;try{window.opener&&window.opener.CloudOS&&(e=window.opener.CloudOS,SC.info("CK.WindowApplication: Found an openers CloudOS instance"))}catch(n){SC.info("CK.WindowApplication: No opener found, or not allow to get reference to its CloudOS")}window.CloudOS=COS.CloudOSLite.create({usesPush:t.get("usesPush"),validateDidSucceed:function(e){var n=arguments.callee.base.apply(this,arguments);return t.tryToPerform("validateDidSucceed",e),n},validateDidFail:function(e){var n=arguments.callee.base.apply(this,arguments);return t.tryToPerform("validateDidFail",e),n},loginDidSucceed:function(e){var n=arguments.callee.base.apply(this,arguments);return t.tryToPerform("loginDidSucceed",e),n},loginDidFail:function(e){var n=arguments.callee.base.apply(this,arguments);return t.tryToPerform("loginDidFail",e),n},logoutDidSucceed:function(){var e=arguments.callee.base.apply(this,arguments);return t.tryToPerform("logoutDidSucceed"),e},logoutDidFail:function(){var e=arguments.callee.base.apply(this,arguments);return t.tryToPerform("logoutDidFail"),e},userDidLogout:function(e){var n=arguments.callee.base.apply(this,arguments);return t.tryToPerform("userDidLogout",e),n},userDidNotAuthenticate:function(e){var n=arguments.callee.base.apply(this,arguments);return t.tryToPerform("userDidNotAuthenticate",!!e),n},userDidPartiallyAuthenticate:function(e){var n=arguments.callee.base.apply(this,arguments);return t.tryToPerform("userDidPartiallyAuthenticate",!!e),n},userDidAuthenticate:function(e){var n=arguments.callee.base.apply(this,arguments);return t.tryToPerform("userDidAuthenticate"
,!!e),n}}),SC.info("CK.WindowApplication: Created CloudOSLite instance"),COS.prefsController.set("delegate",window.CloudOS),this.invokeLast(function(){SC.ready(function(){var n=window.location.hash.split("instanceId=")[1];if(n){var r=window.location,i=r.hash;i=i.split("&instanceId=")[0],i=i.split("#instanceId=")[0];var s=window.history;s&&s.replaceState?s.replaceState(null,null,"https://"+r.hostname+r.pathname+r.search+i):r.hash=i}e&&e.windowApplicationIsKnown(n||window)?(SC.info("CK.WindowApplication: Asking parent CloudOS to be initialized"),e.windowApplicationHasInitialized(n||window,t.get("name"))):(SC.info("CK.WindowApplication: Starting stand-alone"),COS.authController.validateUser(function(){var e=COS.authController;e.get("isAuthenticated")&&CloudOS.userDidAuthenticate(YES),e.get("isPartiallyAuthenticated")&&CloudOS.userDidPartiallyAuthenticate(YES)}));var o={accountLocale:String.preferredLanguage,browserLocale:(navigator.language||navigator.browserLanguage).toLowerCase(),appName:CK.currentApplication.name,appPath:window.location.pathname,duration:SC.getCurrentTimeForPerformance()-SC.benchmarkPreloadEvents.headStart};if(window.CloudOS&&CloudOS.getAccountPreferences&&CloudOS.getUser){var u=CloudOS.getAccountPreferences(),a=CloudOS.getUser();if(u){var f=u.get("secondaryLocale");f&&(o.accountSecondaryLocale=f)}a&&(o.idmsLocale=a.get("idmsLocale"))}COS.statsController.recordStat("cloudos","LoadWindowApplication",o)})}),this.set("cloudOSWindow",window)},setupBeforeUnloadHandler:function(){var e=this;SC.Event.add(window,"beforeunload",this,function(){try{e.get("cloudOSWindow"
).CloudOS.windowApplicationWillClose(window)}catch(t){SC.warn("CK.WindowApplication: beforeunload handler could not call parent, maybe it is gone?"),SC.warn(t)}})},passMessage:function(e){var t=this.get("cloudOSWindow"),n=SC.json.decode(e),r=n.methodName;this.invokeLast(function(){try{t.CK.currentApplication.passMessage(e)}catch(n){SC.warn("CK.WindowApplication: DOMWindow for CloudOS is gone? Cant deliver %@",r),SC.warn(n)}})},_createMessage:function(e,t,n){return CloudOS.isCloudOSLite?arguments.callee.base.apply(this,arguments):{isCloudOSMessage:!0,isProxyMessage:!0,methodName:t,appName:e,buildNumber:SC.buildNumber,masteringNumber:SC.masteringNumber,args:n}},_windowMessageWasReceived:function(e){SC.RunLoop.end();var t={originalEvent:{data:e,origin:"https://"+window.location.host}};SC.run(function(){this._messageWasReceived(t)},this)},_applicationShouldInvokeMain:function(e,t,n,r){var i=COS.authController,s=t.authBag;i.saveAuthBag(s),COS.prefsController.setPreferences(t.accountPreferences,t.appPreferences),i.monitorForUsernameChange(),this._didInvokeMain=YES,arguments.callee.base.apply(this,arguments)},populateFields:function(e){},applicationWillBecomeActive:function(){},applicationDidBecomeActive:function(e){},applicationWillSuspend:function(){},applicationDidSuspend:function(){}}),CK.mixin({windowApplications:{},openWindowApplication:function(e,t,n){var r=this._getNextWindowId(),e=this._addInstanceIdToURL(e,r),i;return n?i=window.open(e,t,n):i=window.open(e,t),this.windowApplications[r]={window:i},r},_addInstanceIdToURL:function(e,t){var n="&";return e.indexOf("#")===-1&&(
n="#"),e+n+"instanceId="+t},instanceIdForWindowApplication:function(e){var t=SC.guidFor(e),n=this.windowApplications,r;if(n[t])return t;for(r in n)if(n[r]&&n[r].window===e)return r;return t},windowCount:0,_getNextWindowId:function(){return"window_"+this.windowCount++},windowApplicationIsRegistered:function(e){var t=this.getBackwardCompatibleInstanceId(e);return!!this.windowApplications[t]},passWindowApplicationMessage:function(e,t){var n=this.getBackwardCompatibleInstanceId(e),r=this.windowApplications[n];if(!r){SC.warn("Could not find a CK.WindowApplication with instanceId %@",n);return}var i=SC.$A(arguments);i=i.slice(2,i.length);if(!r.didInitialize){this._registerWindowApplicationMessage(e,t,i);return}var s={isCloudOSMessage:!0,methodName:t,args:i,isWindowApplicationMessage:!0};try{var o=r.window.CK.currentApplication;o?o._windowMessageWasReceived(SC.clone(s)):CK.currentApplication.passMessage(s,r.window)}catch(u){SC.warn("postMessage: CK.WindowApplication %@ not properly loaded?",n),SC.warn(u)}},windowApplicationDidInitialize:function(e){var t=this.getBackwardCompatibleInstanceId(e),n=this.windowApplications[t];n?n.didInitialize=YES:SC.warn("There is no windowApplication for %@",t)},passPendingWindowApplicationMessages:function(e){var t=this.getBackwardCompatibleInstanceId(e),n=this.windowApplications[t],r,i,s,o;if(!n)return;r=n.messages;if(!r)return;for(i=0,s=r.length;i<s;i++){o=r[i];var u=[e,o.method];this.passWindowApplicationMessage.apply(this,u.concat(o.args))}},_registerWindowApplicationMessage:function(e,t,n){var r=this.getBackwardCompatibleInstanceId(e),i=this.windowApplications
[r],s;if(!i)return;s=i.messages,s||(s=[],i.messages=s),s.push({method:t,args:n})},getBackwardCompatibleInstanceId:function(e){return typeof e!="string"?this.instanceIdForWindowApplication(e):e}}),CK.ICloudControlsTheme=AppleThemeV4.subtheme("icloud-controls"),SC.Theme.addTheme(CK.ICloudControlsTheme),CK.AccountButtonView=CW.PopupButtonView.extend({themeName:"borderless",classNames:["account-menu","large-display-text"],attributeBindings:["aria-owns"],menuId:null,"aria-owns":function(){return this.get("menuId")}.property("menuId"),controlSize:SC.HUGE_CONTROL_SIZE,shouldAutoResize:NO,escapeHTML:YES,itemsOverride:null,availableTitles:function(){var e=[],t,n,r=window.CloudOS&&CloudOS.getUser?CloudOS.getUser():null;if(r){t=r.get("displayName");var i=r.get("firstName"),s=r.get("lastName");!CW.stringIsCJK(i)&&!CW.stringIsCJK(s)&&(n=r.get("firstName"))}return t=t||"AccountMenu.FallbackTitle".loc(),n&&e.push(n),e.push(t),e}.property().cacheable(),title:function(){var e=this.get("frame"),t=e.width,n=this.get("availableTitles"),r=this.get("measuredSizes"),i,s,o,u=n.length;for(o=0;o<u;o++){i=n[o],s=r[i];if(!s)return i;if(s.width<=t)return i}return i}.property("availableTitles","frame","measuredSizes").cacheable(),measuredSize:function(){var e=this.get("title"),t=this.get("measuredSizes"),n=t[e];return n||(n={width:0,height:0}),n}.property("measuredSizes","title").cacheable(),smallestNonTruncatedWidth:function(){var e=this.get("measuredSizes"),t,n=this.get("availableTitles"),r,i=n.length,s=Infinity;if(i===0)return 0;for(r=0;r<i;r++)t=e[n[r]],t?s=Math.min(s,t.width):s=0;return s}.property("availableTitles"
,"measuredSizes").cacheable(),preferredWidth:function(){var e=this.get("measuredSizes"),t=this.get("availableTitles")[0],n=e[t];return n?n.width:0}.property("availableTitles","measuredSizes").cacheable(),measuredSizes:function(){var e=this.get("availableTitles"),t,n=e.length,r={},i=this.$(".sc-button-label")[0],s;if(!i)return r;SC.prepareStringMeasurement(i);for(t=0;t<n;t++)s=e[t],r[s]=SC.measureString(s,NO,NO);return SC.teardownStringMeasurement(),r}.property("availableTitles","layer").cacheable(),menu:CW.AutoResizingMenuPane.extend({minimumSize:{width:130},shouldCloseMenu:NO,anchorView:null,popup:function(e){e.set("menuId",this.get("layerId")),this.set("anchorView",e),arguments.callee.base.apply(this,arguments)},assignMenuItemIndicator:function(){var e=this.get("menuItemViews"),t=e.length;e&&this.get("items").length===t&&(this.menuItemViewForContentIndex(0).set("isFirstItemInList",YES),this.menuItemViewForContentIndex(t-1).set("isLastItemInList",YES))}.observes("menuItemViews"),shouldCloseMenuDidChange:function(){this.get("shouldCloseMenu")&&this.removeIfOpen()}.observes("shouldCloseMenu"),init:function(e){arguments.callee.base.apply(this,arguments),CW.notificationCenter.subscribeToNotification("preparingForAppTransition",this,"removeIfOpen")},keyDown:function(e){var t=this.get("currentSelectedMenuItem");if(e.which===SC.Event.KEY_TAB)if(t&&t.get("isFirstItemInList")||!t){if(e.shiftKey)return this.set("shouldCloseMenu",YES)}else t&&t.get("isLastItemInList")&&(e.shiftKey||this.set("shouldCloseMenu",YES));return arguments.callee.base.apply(this,arguments)},_focusCurrentItem:function(
){var e=this.get("currentMenuItem");e&&e.get("isFirstResponder")&&e.get("layer").focus()},moveDown:function(){return arguments.callee.base.apply(this,arguments),this._focusCurrentItem(),YES},moveUp:function(){return arguments.callee.base.apply(this,arguments),this._focusCurrentItem(),YES},itemsOverride:null,itemsOverrideBinding:".owner.itemsOverride",items:function(){var e=this.get("itemsOverride"),t;return SC.none(e)?t=CloudOS.getAccountMenuItems():t=e,t.forEach(function(e){var t=e.disableWhenCurrentApp;!SC.none(t)&&t===CloudOS.currentAppName()&&(e.isEnabled=NO)}),t}.property("itemsOverride").cacheable(),pointAtRectangleForView:function(e){var t=arguments.callee.base.apply(this,arguments),n=Math.min(e.get("measuredSize").width,t.width);return t=SC.clone(t),t.x=t.x+t.width-n,t.width=n,t},removeIfOpen:function(){var e=this.getPath("anchorView.layer");this.isVisibleInWindow&&(this.remove(),e&&e.focus()),this.get("shouldCloseMenu")&&this.set("shouldCloseMenu",NO)},paneDidAttach:function(){arguments.callee.base.apply(this,arguments),this.get("layer").focus()},themeName:"atv4",preferType:SC.PICKER_MENU_POINTER,controlSize:SC.REGULAR_CONTROL_SIZE,acceptsFirstResponder:YES})}),function(){var e=44,t=55,n=300;CK.AccountMenuView=SC.View.extend({shouldAutoResize:YES,calculatedWidth:100,accountMenuItems:null,layout:{right:2,top:0,bottom:0},CloudOSStateBinding:SC.Binding.oneWay("CloudOS.workspaceController.nowShowing"),isVisible:!window.CloudOSBootstrap||!CloudOSBootstrap.isOnSupportedMobile,init:function(){arguments.callee.base.apply(this,arguments),CW.notificationCenter.subscribeToNotification
("relocalize",this,"relocalize")},relocalize:function(){var e=this.accountButton;this.notifyPropertyChange("accountMenuItems"),e.notifyPropertyChange("availableTitles"),e.notifyPropertyChange("toolTip"),this.helpButton.notifyPropertyChange("toolTip")},childrenShouldAcceptFirstResponder:function(){var e=this.get("CloudOSState");return!e||e<CloudOS.AUTH?NO:e===CloudOS.AUTH?this.get("isInAuthPane")?YES:NO:this.get("isEnabled")||this.get("isVisible")?YES:NO}.property("CloudOSState"),themeName:"icloud-controls",classNames:["account-menu"],childViews:["accountButton","dividerView","helpButton"],accountButton:CK.AccountButtonView.design(SC.RTLSupport,{layoutRecipe:{top:-5,bottom:0,end:t},itemsOverrideBinding:".owner.accountMenuItems",toolTip:"Toolbar.Button.Action.UserAction".loc(),ariaLabel:"Toolbar.Button.Action.UserAction".loc(),acceptsFirstResponder:function(){return this.getPath("parentView.childrenShouldAcceptFirstResponder")}.property("parentView.childrenShouldAcceptFirstResponder"),displayProperties:["acceptsFirstResponder"],render:function(e,t){arguments.callee.base.apply(this,arguments),t&&e.push('<div class="chevron"></div>'),this.get("isVisible")?e.attr("aria-hidden",NO):e.attr("aria-hidden",YES)}}),dividerView:SC.View.design(SC.RTLSupport,{classNames:["account-menu-divider"],layoutRecipe:{centerY:0,width:1,height:22,end:e}}),helpButton:SC.ImageButtonView.design(SC.RTLSupport,{layoutRecipe:{top:0,bottom:0,width:e,end:0},image:"help-icon",targetBinding:"CK.currentApplication",action:"showHelp",toolTip:"Toolbar.Button.Action.Help",localize:YES,acceptsFirstResponder:function(
){return this.getPath("parentView.accountButton.acceptsFirstResponder")}.property("parentView.accountButton"),render:function(e,t){arguments.callee.base.apply(this,arguments),this.get("isVisible")?e.attr("aria-hidden",NO):e.attr("aria-hidden",YES)},click:function(e){var t=this.get("layer");if(!t)return;return SC.Event.trigger(t,"mousedown"),SC.Event.trigger(t,"mouseup"),YES},keyDown:function(e){return e.which===SC.Event.KEY_RETURN||e.which===32?this.click():NO}}),buttonWidthDidChange:function(){var e=this.get("preferredWidth");this.set("calculatedWidth",e),this.get("shouldAutoResize")&&this.adjust("width",e)}.observes("preferredWidth"),accountButtonPreferredWidth:0,accountButtonPreferredWidthBinding:".accountButton.preferredWidth",accountButtonSmallestNonTruncatedWidth:0,accountButtonSmallestNonTruncatedWidthBinding:".accountButton.smallestNonTruncatedWidth",preferredWidth:function(){var e=SC.browser.isIE||SC.browser.isEdge?1:0;return Math.min(this.get("accountButtonPreferredWidth")+t+e,n)}.property("accountButtonPreferredWidth").cacheable(),smallestNonTruncatedWidth:function(){return Math.min(this.get("accountButtonSmallestNonTruncatedWidth")+t,n)}.property("accountButtonSmallestNonTruncatedWidth").cacheable()})}(),CK.AddDeleteButton=SC.ImageButtonView.extend({layout:{left:0,height:17,centerY:0,width:17},acceptsFirstResponder:NO,classNames:["add-delete"],action:"buttonClicked",isEmpty:YES}),function(){var e=13,t=82;CK.AppSwitcherView=SC.View.extend({calculatedWidth:0,shouldAutoResize:YES,title:null,useLightText:NO,themeName:"icloud-controls",classNames:["app-switcher"],childViews
:["buttonView"],buttonWidthDidChange:function(){var n=t+e+this.getPath("buttonView.measuredSize").width;this.set("calculatedWidth",n),this.get("shouldAutoResize")&&this.adjust("width",n)}.observes("buttonView.measuredSize"),targetFrame:function(){var e=SC.clone(this.getPath("buttonView.frame"));return e=this.convertFrameToView(e,null),e.left=e.x,e.top=e.y,e}.property(),buttonView:SC.ButtonView.design(SC.AutoResize,{init:function(){arguments.callee.base.apply(this,arguments),CK.appSwitcherKeyResponder.registerAppSwitcher(this),CW.notificationCenter.subscribeToNotification("miniSpringboardDismissed",this,this.miniSpringboardDismissed),this.watchForSizeChange()},showAppSwitcherFromKeyboardShortcut:function(){if(!this.get("isVisibleInWindow")||!this.getPath("pane.isKeyPane")||SC.RootResponder.responder.get("menuPane"))return;return this.triggerActionFromKeyboardShortcut(),YES},shouldAutoResize:NO,layout:{left:e,top:-6,bottom:0},classNames:["large-display-text"],controlSize:SC.HUGE_CONTROL_SIZE,themeName:"borderless",acceptsFirstResponder:NO,watchForSizeChange:function(){if(!SC.browser.isSafari&&!SC.browser.isWindows)return;var e=SC.Timer.schedule({interval:100,repeats:YES,target:this,action:function(){this.measureSize();var t=this.getPath("layer.clientWidth"),n=CK.getPath("currentApplication.isActive");(n||this._previousWidth&&t!==this._previousWidth)&&e.invalidate(),this._previousWidth=t}})},render:function(e,t){arguments.callee.base.apply(this,arguments);if(t){var n=this.getPath("parentView.useLightText");e.push('<div class="icloud-text image'+(n?" light":"")+'"></div>'),this.
get("isEnabled")&&!CloudOS.isOnSupportedMobile()&&e.push('<div class="chevron"></div>')}},mouseUp:function(){var e=arguments.callee.base.apply(this,arguments);return this.set("isActive",YES),e},action:function(){CloudOS.isOnSupportedMobile()||CloudOS.showAppSwitcher(this.getPath("parentView.targetFrame"))},title:function(){var e=this.getPath("owner.title");return e?e.loc():CloudOS.getAppDisplayName()}.property("owner.title").cacheable(),toolTip:"Toolbar.Tooltip.App.Switcher".loc(),miniSpringboardDismissed:function(){this.set("isActive",NO)}})})}(),CK.logoutAlert=function(e,t,n){return CW.Alert.show({classNames:["logout-alert"],message:"HSA.SignoutDialog.Title".loc(),image:"icon-icloud",descriptionViewMinHeight:5,extraWide:YES,extraViewPadding:{top:0,bottom:3},hsaTrustedBrowser:n,rightButton:{title:"HSA.SignoutDialog.SignoutButton".loc(),action:function(){var t=this.get("pane");t.remove(),e&&e(t.get("hsaTrustedBrowser"))}},middleButton:{title:"Button.Cancel".loc(),action:function(){this.get("pane").remove(),t&&t()}},extraView:SC.CheckboxView.design(CW.Alert.ExtraViewAutoResizingSupport,SC.RTLSupport,{autoResizePadding:0,controlSize:SC.CUSTOM_CONTROL_SIZE,layoutRecipe:{start:105,end:10},title:"HSA.SignoutDialog.CheckboxTitle".loc(),valueBinding:"*pane.hsaTrustedBrowser"})})},function(){var e="cloudkit/error_catcher";if(!SC.MODULE_INFO)throw"SC.MODULE_INFO is not defined!";if(SC.MODULE_INFO[e])return;SC.MODULE_INFO[e]=SC.Object.create({dependencies:[],styles:["/applications/mail/1808Project39/frameworks/cloudkit/error_catcher/1808Project39/en-us/stylesheet.css"],styles2x:["/applications/mail/1808Project39/frameworks/cloudkit/error_catcher/1808Project39/en-us/stylesheet.css"
],scriptURL:"/applications/mail/1808Project39/frameworks/cloudkit/error_catcher/1808Project39/en-us/javascript.js",stringURL:"/applications/mail/1808Project39/frameworks/cloudkit/error_catcher/1808Project39/en-us/javascript-strings.js"})}(),CK.Statechart={EVT_ENTER_SIG:"enter",EVT_EXIT_SIG:"exit",EVT_INIT_SIG:"defaultTransition"},SC.mixin(CK.Statechart,{EVT_ENTER:{sig:CK.Statechart.EVT_ENTER_SIG},EVT_EXIT:{sig:CK.Statechart.EVT_EXIT_SIG},EVT_INIT:{sig:CK.Statechart.EVT_INIT_SIG},EVT_IGNORED_RES:"cloudkit-statechart-evt-ignored-res",EVT_HANDLED_RES:"cloudkit-statechart-evt-handled-res",EVT_TRANSITION_RES:"cloudkit-statechart-evt-transition-res",EVT_TERMINATE_RES:"cloudkit-statechart-evt-terminate-res",STATE_CHART_TRACE_ENABLED:NO}),SC.mixin(CK.Statechart,{handled:function(){return CK.Statechart.EVT_HANDLED_RES},terminate:function(){return CK.Statechart.EVT_TERMINATE_RES}}),SC.mixin(Function.prototype,{state:function(e){return this.superstateKey=e,this.isState=YES,this}}),CK.Statechart._DISPATCH_PATH=[],SC.mixin(SC.Object.prototype,{stateKey:"state",dispatch:function(e){if(this._isDispatching)return this.shouldTrace()&&SC.debug('%@ ignored event "%@": already dispatching an event',this,e.sig),NO;this._isDispatching=YES;var t=this.get("stateKey"),n=CK.Statechart._DISPATCH_PATH,r,i,s,o,u,a,f,l;n.length=0,r=this[t];if(!r)return this._isDispatching=NO,NO;this._ck_statechart_dispatch(e);var c=this._ck_state_depth;a=this._ck_statechart_event(this[t],e,c);if(!a){o=this[r].superstateKey;while(o){a=this._ck_statechart_event(o,e,--c);if(a){s=o;break}o=this[o].superstateKey}}if(!a)return this
._isDispatching=NO,NO;if(a===CK.Statechart.EVT_TRANSITION_RES){i=this[t],n[0]=this[i].superstateKey;if(s&&r!=this[s]){this._ck_statechart_exit(r),o=this[r].superstateKey;while(o&&o!==s)this._ck_statechart_exit(o),o=this[o].superstateKey}s&&(r=s);e:do{if(r===i){this._ck_statechart_exit(r),f=0;break e}if(this[i].superstateKey===r){f=0;break e}if(this[r].superstateKey===this[i].superstateKey){this._ck_statechart_exit(r),f=0;break e}if(this[r].superstateKey===i){this._ck_statechart_exit(r),f=-1;break e}f=1,o=n[1]=this[i].superstateKey,o&&(o=this[o].superstateKey);while(o!==undefined){n[++f]=o;if(o===r){--f;break e}o=this[o].superstateKey}this._ck_statechart_exit(r),s=this[r].superstateKey;if(!s)break e;r=s,l=f;do{u=n[l];if(u&&r===u){f=l-1;break e}--l}while(l>0);for(;;){this._ck_statechart_exit(s),s=this[r].superstateKey;if(!s){f=0;break e}r=s;var l=f;do{u=n[l];if(u&&r===u){f=l-1;break e}o=this[r].superstateKey,r=o||null,--l;if(!r){f=-1;break}}while(l>=0);if(!r){f=-1;break}}}while(NO);if(f>0)do this._ck_statechart_enter(n[f]);while(--f>0);f===0&&this._ck_statechart_enter(this[t]),r=this[t];while(this._ck_statechart_init(this[t])===CK.Statechart.EVT_TRANSITION_RES){i=this[t],f=0;if(i!==r){i=n[++f]=this[i].superstateKey;if(i!==r)while(i!==r)i=n[++f]=this[i].superstateKey;--f}if(f>0)do this._ck_statechart_enter(n[f]);while(--f>0);f===0&&(this._ck_statechart_enter(this[t]),r=this[t])}return this.notifyPropertyChange(t),this._isDispatching=NO,YES}return this._isDispatching=NO,YES},_ck_statechart_dispatch:function(e){},_ck_statechart_enter:function(e){return this[e](CK.Statechart.EVT_ENTER
)},_ck_statechart_exit:function(e){return this[e](CK.Statechart.EVT_EXIT)},_ck_statechart_init:function(e){return this[e](CK.Statechart.EVT_INIT)},_ck_statechart_event:function(e,t,n){return this[e](t)}}),SC.mixin(SC.Object.prototype,{_object_init:function(e){var t,n=e?e.length:0;for(t=0;t<n;t++)SC._object_extend(this,e[t]);SC.generateGuid(this),this.init();var r=this.initMixin;n=r?r.length:0;for(t=0;t<n;t++)r[t].call(this);if(this.initial&&this.initStatechart){var i=this;SC.isReady?this.initStatechart():SC.ready(function(){i.initStatechart()})}return this},initialStateKey:"initial",initStatechart:function(){var e=this.get("initialStateKey"),t=this.get("stateKey"),n=CK.Statechart._DISPATCH_PATH,r,i,s,o,u,a,f;r=this[e];if(!r||!this[r]||!this[r].isState)return this;this[t]=r,this.hasStatechart=YES,this._ck_state_depth=0,this._ck_statechart_initStatechart(),o=this[r].superstateKey;if(o!==undefined){a=0;while(o)n[++a]=o,o=this[o].superstateKey;do this._ck_statechart_enter(n[a]);while(--a>0)}this._ck_statechart_enter(this[t]);while(this._ck_statechart_init(this[t])===CK.Statechart.EVT_TRANSITION_RES){i=this[t],a=0;while(r!==i){o=this[i].superstateKey;if(o===undefined)break;i=n[++a]=o}--a;if(a!==0)do this._ck_statechart_enter(n[a]);while(--a>0);a===0&&this._ck_statechart_enter(this[t]),r=this[t]}return this},shouldTrace:function(){var e=this.get("trace");return SC.none(e)?CK.Statechart.STATE_CHART_TRACE_ENABLED:e},destroyStatechart:function(){},_ck_statechart_initStatechart:function(){}}),SC.mixin(SC.Object.prototype,{addStatechartObserver:function(e,t){var n=function(e,t,n,r){this
.dispatch({sig:"propertyChanged",target:e,key:t,revision:r})};return this.addObserver(e,t,n),n},removeStatechartObserver:function(e,t,n){return this.hasObserverFor(e)&&this.removeObserver(e,t,n),this}}),SC.mixin(SC.View.prototype,{performKeyEquivalent:function(e,t){var n=null,r=this.get("childViews"),i,s=r.length,o=-1;while(!n&&++o<s)i=r[o],i.hasStatechart&&(t.sig=e,n=this.dispatch(t)),n||(n=i.performKeyEquivalent(e,t));return n}}),SC.mixin(SC.Pane.prototype,{performKeyEquivalent:function(e,t){var n=null,r=this.get("childViews"),i,s=r.length,o=-1;while(!n&&++o<s)i=r[o],i.hasStatechart&&(t.sig=e,n=i.dispatch(t)),n||(n=i.performKeyEquivalent(e,t));if(!n){var u=this.get("defaultResponder");u&&(u.hasStatechart&&(t.sig=e,n=u.dispatch(t)),n||(n=u.performKeyEquivalent(e,t)))}return n}}),CK.LOG_MOUSE_EVENTS=NO;var _ck_log=function(e){SC.debug(e)},_ck_alert=function(e){SC.warn(e),alert(e)};SC.mixin(SC.Object.prototype,{_ck_statechart_initStatechart:function(){if(this.shouldTrace()){var e=this.get("ck_singleStep")?_ck_alert:_ck_log;e.call(this,"%@:initStatechart()".fmt(this))}},_ck_statechart_dispatch:function(e){if(this.shouldTrace()){var t=e.sig;if(!CK.LOG_MOUSE_EVENTS&&t.match(/^mouse+/))return;var n=this.get("ck_singleStep")?_ck_alert:_ck_log;n.call(this,"%@:dispatch('%@')".fmt(this,t))}},_ck_statechart_enter:function(e){var t=this._ck_state_depth++,n="";while(--t>=0)n+="  ";if(this.shouldTrace()){var r=this.get("ck_singleStep")?_ck_alert:_ck_log;r.call(this,n+'-> entering "'+e+'"')}var i=this[this.stateKey],s=this[e](CK.Statechart.EVT_ENTER),o;if(this[this.stateKey]!==i)throw o='\nENTER STATE INVARIANT FAILURE\nYou MUST NOT CALL ck_transition() during the \'enter\' event. Your "%@" state\'s \'enter\' handler (or code somewhere else) called ck_transition("%@") while transitioning to "%@".'
,o.fmt(e,this[this.stateKey],i);if(s!==CK.Statechart.EVT_HANDLED_RES&&s!==undefined)throw o="\nENTER STATE INVARIANT FAILURE\nThe only valid response from the 'enter' event is: \"return ck_handled() ;\" (or nothing at all). Your \"%@\" state's 'enter' handler returned: %@",o.fmt(e,s);return s},_ck_statechart_exit:function(e){var t=this._ck_state_depth--,n="";while(--t>0)n+="  ";if(this.shouldTrace()){var r=this.get("ck_singleStep")?_ck_alert:_ck_log;r.call(this,n+'<- leaving  "'+e+'"')}var i=this[this.stateKey],s=this[e](CK.Statechart.EVT_EXIT),o;if(this[this.stateKey]!==i)throw o='\nEXIT STATE INVARIANT FAILURE\nYou MUST NOT CALL ck_transition() during the \'exit\' event. Your "%@" state\'s \'exit\' handler (or code somewhere else) called ck_transition("%@") while transitioning to "%@".',o.fmt(e,this[this.stateKey],i);if(s!==CK.Statechart.EVT_HANDLED_RES&&s!==undefined)throw o="\nEXIT STATE INVARIANT FAILURE\nThe only valid response from the 'exit' event is: \"return ck_handled() ;\" (or nothing at all). Your \"%@\" state's 'exit' handler returned: %@",o.fmt(e,s);return s},_ck_statechart_init:function(e){var t=this._ck_state_depth,n="";while(--t>0)n+="  ";var r=this[e](CK.Statechart.EVT_INIT),i=this.get("stateKey");if(this.shouldTrace()&&r===CK.Statechart.EVT_TRANSITION_RES){var s=this.get("ck_singleStep")?_ck_alert:_ck_log;s.call(this,n+'  (taking default transition to "'+this[i]+'")')}return r},_ck_statechart_event:function(e,t,n){if(t.sig.match(/^mouse(Down|Dragged|Up|Over|Out|Moved)/)&&!CK.LOG_MOUSE_EVENTS)return;var r="";while(--n>0)r+="  ";var i=this[e](t),s=this.get("stateKey"
);if(this.shouldTrace()){var o=this.get("ck_singleStep")?_ck_alert:_ck_log,u,a=t.sig==="keyDown"&&(u=t.getCharString())?"%@(%@)".fmt(t.sig,u):t.sig;i?i===CK.Statechart.EVT_HANDLED_RES?o.call(this,r+'"'+e+"\" handled event '"+a+"' (no transition)"):i===CK.Statechart.EVT_TRANSITION_RES&&o.call(this,r+'"'+e+"\" handled event '"+a+"' with a transition to \""+this[s]+'"'):o.call(this,r+'"'+e+"\" ignored event '"+a+"'")}return i}}),SC.mixin(SC.Object.prototype,{tryToPerform:function(e,t,n){var r;return this.hasStatechart&&(t&&t instanceof SC.Event?(t.sig=e,r=this.dispatch(t)):r=this.dispatch({sig:e,arg1:t,arg2:n})),!r&&this.respondsTo(e)&&(r=this[e](t,n)!==NO),r}}),CK.Photo=SC.Object.create({PHOTOPICKER_DRAGPHOTOTEXT_XPOS:110,PHOTOPICKER_DRAGPHOTOTEXT_YPOS:140,CANVAS_IMG_HEIGHT:290,CANVAS_IMG_WIDTH:220,CANVAS_INITIAL_HEIGHT:200,CANVAS_INITIAL_WIDTH:200,CANVAS_DEFAULT_LAYOUT_HEIGHT:290,CANVAS_DEFAULT_LAYOUT_WIDTH:220,CONTACT_PHOTO_HEIGHT:290,CONTACT_PHOTO_WIDTH:220,PHOTO_ICON_IMAGE_HEIGHT:92,PHOTO_ICON_IMAGE_WIDTH:92,PHOTO_ICON_INITIAL_HEIGHT:92,PHOTO_ICON_INITIAL_WIDTH:92,PHOTO_ICON_DIMENSIONS_HEIGHT:92,PHOTO_ICON_DIMENSIONS_WIDTH:92,PHOTO_NO_ERROR:0,PHOTO_INVALID_FORMAT:1,PHOTO_SIZE_TOO_BIG:2,PHOTO_SERVER_ERROR:3,PHOTO_INSTALL_PLUGIN:4,PHOTO_LOAD_ERROR:5,isFileDroppedAValidImage:function(e,t){if(!e||SC.typeOf(t)!==SC.T_ARRAY)return;var n=e.fileType||e.type;return n=n&&n.indexOf("/")!==-1?n.split("/")[1]:n,n&&t.indexOf(n)!==-1},displayUploaderErrors:function(e){if(!e)return;var t;switch(e){case 1:t="invalidFormat";break;case 2:t="photoIsTooBig"}PhotoPicker.statechart.sendEvent(t)}
,isPhotoPickerOpen:function(){return window.PhotoPicker&&PhotoPicker.get("statechart")?PhotoPicker.statechart.stateIsEntered("photoPickerLoadedState"):NO}}),CK.Photo.CanvasImage={imgHeight:CK.Photo.PHOTO_ICON_IMAGE_HEIGHT,imgWidth:CK.Photo.PHOTO_ICON_IMAGE_WIDTH,dimensions:{width:CK.Photo.PHOTO_ICON_DIMENSIONS_HEIGHT,height:CK.Photo.PHOTO_ICON_DIMENSIONS_WIDTH},innerCircleRect:{x:0,y:0,width:CK.Photo.PHOTO_ICON_DIMENSIONS_HEIGHT,height:CK.Photo.PHOTO_ICON_DIMENSIONS_WIDTH},boundaryRadius:3,editView:null,staticImage:null,editViewIsVisible:NO,editShadeImage:null,hasBorder:YES,borderColor:"#000",borderOpacity:"0.6",initialDimensions:function(e,t){var n=this._initialDimensions;if(t===undefined){if(!n){var r=this.get("innerCircleRect"),i=this.get("dimensions"),s={};r?(s.width=r.width,s.height=r.height):s=i,n=s}}else n=t;return this._initialDimensions=n,n}.property("innerCircleRect","dimensions"),repositionImage:function(){var e=this.get("imgHeight"),t=this.get("imgWidth"),n=this.get("imgLoadError")?null:this.get("value"),r=n?n:this.get("staticImage"),i=n?this.get("photoCrop"):null,s=this.get("initialDimensions"),o=s.width,u=s.height,a=this.get("dimensions"),f=this.get("editShadeImage"),l=this.get("editView"),c=this.get("innerBoundaryRect"),h=this.get("boundaryRadius"),p=this.get("innerCircleRect"),d=p.x,v=p.y,m=p.width,g=p.height;i&&(i.x+i.width>t&&(i.x=0,i.width=t),i.y+i.height>e&&(i.y=0,i.height=e));var y=i&&n?i.width:null,b=i&&n?i.height:null,w=y?p.width/y:o/t,E=b?p.height/b:u/e,S=n?Math.round(t*w):p.width,x=n?Math.round(e*E):p.height,T=n&&i,N=this.get("raphael"),C=this.get("img"
),k,L;T?(k=-i.x*w+d,L=-(x-i.y*E-g)+v):(k=(a.width-o)/2,L=(a.height-u)/2),t=t>o?t:S,e=e>u?e:x,this.set("imgWidth",t),this.set("imgHeight",e);if(N){this.set("moveX",k),this.set("moveY",L),S===0&&(S=o,SC.error("The photo crop properties got are wrong. crop-width = %@".fmt(y))),x===0&&(x=u,SC.error("The photo crop properties got are wrong. crop-height = %@".fmt(b)));var A=this.getClipRect();C?(C.scale(1,1),C.attr({width:o,height:u,x:k*o/S,y:L*u/x,src:r}),C.attr("clip-rect")||C.attr({"clip-rect":A}),i||this.set("zoomLevel",0)):(C=N.image(r,k*o/S,L*u/x,o,u),C.attr({r:h,"clip-rect":A,crossorigin:"use-credentials"}),this.set("img",C));if(i){var O=this.get("zoomLevel"),M=O;t!==o?M=Math.round((S-o)*100/(t-o)):M=0,M===O?this.notifyPropertyChange("zoomLevel"):this.set("zoomLevel",M)}C.show(),this.createInnerBoundaryRect(N),n?l&&(f=this.createEditView(N,a,h),f?this.get("editViewIsVisible")&&C.toBack():SC.error("The Edit View provided does not have the properties image and rect")):n||f&&f.hide()}},computedForRaphael:function(e,t,n){return Math.ceil((t-e-n)*n/t)},setImageWidthAndHeight:function(e,t,n,r){var i=document.createElement("img");i.crossOrigin="use-credentials",i.onload=function(){t.get("value")===e&&(t.set("imgHeight",this.height||this.naturalHeight),t.set("imgWidth",this.width||this.naturalWidth),t.set("imgLoadError",NO),n&&t.tryToPerform(n,e)),this.parentNode&&this.parentNode.removeChild(this)};var s=function(){if(this.naturalHeight===0||this.naturalWidth===0)t.get("value")===e&&(t.resetInitialValues&&t.resetInitialValues(),t.set("imgLoadError",YES),r&&t.tryToPerform(r,e)),this
.parentNode&&this.parentNode.removeChild(this)};SC.$(i).bind("error",s),i.style.cssText="top:-10000px; left: -10000px;  position: absolute;",i.src=e,i.id="dummyImg",document.body.appendChild(i)},setupInitialDimensions:function(e,t,n){var r=this.get("dimensions"),i=this.get("innerCircleRect"),s,o,u=e,a=t,f=this.get("photoCrop"),l,c,h=e/t,p=r.width,d=r.height,v=i.width,m=i.height;n&&(u*=2,a*=2,h>1?a<m&&(a=m,u=a*h):u<v&&(u=v,a=u*h),this.set("imgWidth",u),this.set("imgHeight",a),this.set("convertToSmallerSizeRatio",c=u/e),f&&(l={x:f.x*c,y:f.y*c,width:f.width*c,height:f.height*c},this.set("photoCrop",l))),o=u>=a?m:Math.round(a*m/u),s=a>=u?v:Math.round(u*v/a),this.set("initialDimensions",{width:s,height:o})},horizontalScale:function(){var e=this.get("imgWidth"),t=this.get("initialDimensions").width;return e&&t&&e>=t?(e-t)/100:0}.property("imgWidth","initialDimensions"),verticalScale:function(){var e=this.get("imgHeight"),t=this.get("initialDimensions").height;return e&&t&&e>=t?(e-t)/100:0}.property("imgHeight","initialDimensions"),imageIsSmallerThenCanvas:function(){var e=this.get("verticalScale"),t=this.get("horizontalScale");return e===0||t===0}.property("verticalScale","horizontalScale"),zoomLevelDidChange:function(){var e=this.get("raphael"),t=this.get("img"),n=this.get("horizontalScale"),r=this.get("verticalScale"),i=this.get("zoomLevel"),s=this.get("initialDimensions").height,o=this.get("initialDimensions").width,u=this.get("dimensions"),a=t?t.attr("width"):0,f=t?t.attr("height"):0,l=this.get("moveX"),c=this.get("moveY"),h=this.get("innerCircleRect"),p=h.width,d=h.height,v=h
.x,m=h.y;if(t){t.scale(o/p,s/d),t.scale((o+n*i)/o,(s+r*i)/s),l!==null&&(t.attr("x",l),this.set("moveX",null)),c!==null&&(t.attr("y",c),this.set("moveY",null));var g=t.getBBox();if(g.width===0||g.height===0)return;g.x>v&&t.attr({x:v}),g.y>m&&t.attr({y:m}),v+p-(g.x+g.width)>1&&t.attr({x:u.width-g.width}),m+d-(g.y+g.height)>1&&t.attr({y:u.height-g.height}),SC.browser.isWebkit&&e.canvas.setAttributeNS(null,"width",u.width)}}.observes("zoomLevel"),resetInitialValues:function(){var e=this.get("dimensions");e&&(this.set("imgWidth",e.width),this.set("imgHeight",e.height)),this.set("initialDimensions",null)},createEditView:function(e,t,n){var r=this.get("editView"),i=this.get("editShadeImage"),s=this.get("editViewIsVisible");if(r&&r.image&&r.rect&&!i){var o=r.image,u=r.rect;i=e.image(o,u.x,u.y,u.width,u.height),i.attr({"clip-rect":this.getClipRect()}),this.set("editShadeImage",i)}return i&&(s?(i.show(),i.toFront()):i.hide()),i},createInnerBoundaryRect:function(e){var t=this.get("boundaryRadius"),n=this.get("dimensions"),r=this.get("innerBoundaryRect"),i=SC.browser.isWebkit,s=n.width,o=n.height,u,a,f;r||(u=this.get("hasBorder"),a=u?this.get("borderColor"):"none",f=u?this.get("borderOpacity"):"0",r=e.rect(0,0,s,o,t),r.attr({"clip-rect":this.getClipRect(),"class":"innerBoundaryRect",stroke:a,"stroke-opacity":f}),this.set("innerBoundaryRect",r)),r.show(),r.toFront()},editViewIsVisibleObserver:function(){var e=this.get("editShadeImage"),t=this.get("editViewIsVisible"),n=this.get("imgLoadError");e&&(t&&!n?(e.show(),e.toFront()):e.hide())}.observes("editViewIsVisible"),resetRaphaelViews:function(
){var e=this.get("img"),t=this.get("innerBoundaryRect"),n=this.get("editShadeImage");e&&(e.remove(),this.set("img",null)),t&&(t.remove(),this.set("innerBoundaryRect",null)),n&&(n.remove(),this.set("editShadeImage",null))},getClipRect:function(){var e=this.get("dimensions"),t=this.get("boundaryRadius"),n=e.width,r=e.height,i=0,s=0,o=[i,s,n,r,t];return o}},CK.Photo.PhotoIconCanvasView=SC.View.extend(CK.Photo.CanvasImage,{status:null,zoomLevel:0,childViews:["spinner"],staticImage:SC.BLANK_IMAGE_URL,spinner:SC.View.extend({layout:{centerX:0,centerY:0,width:24,height:24},classNames:["spinner-24px-f3f5f5"],isVisibleBinding:"*parentView.isLoading"}),hasBorder:NO,didCreateLayer:function(e){e(),this.createRaphael(),this.invokeLater(function(){this.valueObserver()},50)}.enhance(),resetValues:function(){this.getPath("pane.isPaneAttached")&&(this.set("currentValue",null),this.set("currentPhotoCrop",null),this.set("currentStaticImage",null))}.observes("*pane.isPaneAttached"),createRaphael:function(){if(this.get("raphael"))return;try{var e=this.get("frame"),t=new Raphael(this.$()[0],e.width,e.height);this.set("raphael",t)}catch(n){SC.error("Exception in creating Raphael is "+n)}},valueObserver:function(){var e=this.get("value"),t=this.get("photoCrop"),n=this.get("staticImage"),r=this.get("currentValue"),i=this.get("currentPhotoCrop"),s=this.get("currentStaticImage"),o=this.get("raphael");if(!o)return;if(r===e&&CW.valuesAreEqual(t,i)&&n===s)return;e?(this.invokeLater(function(){this.get("status")||this.set("status","loading")},300),this.set("status",null),this.setImageWidthAndHeight(e,this
,"afterImageLoaded","afterImageLoadingFailed")):(this.set("status","loaded"),this.resetInitialValues(),this.repositionImage()),this.set("currentValue",e),this.set("currentPhotoCrop",t),this.set("currentStaticImage",n)}.observes("value","photoCrop","staticImage"),afterImageLoaded:function(e){this.setupInitialDimensions(this.get("imgWidth"),this.get("imgHeight")),this.repositionImage(),this.set("status","loaded")},afterImageLoadingFailed:function(e){this.set("status","failed"),this.repositionImage()},isLoading:function(){var e=this.get("status"),t=this.get("img");return e==="loading"?(t&&t.hide(),YES):NO}.property("status")}),SC.stringsFor("English",{"CK.Token.Drag.MultipleTokens":"%@1"}),CK.Tokens=SC.Object.create({}),CK.Token=SC.Object.extend({name:"",emailId:"",phoneNumber:"",isValid:YES,originalValue:"",parsedValue:"",toHash:function(){return{name:this.get("name"),emailId:this.get("emailId"),isValid:this.get("isValid"),originalValue:this.get("originalValue"),parsedValue:this.get("parsedValue")}}}),CK.TokensController=SC.ArrayController.extend({nextIndex:0,content:null,init:function(){arguments.callee.base.apply(this,arguments),this.set("content",[])},commitTokens:function(e){var t=CK.tokensParser.parseEmailAddressList(e),n=t.get("length"),r=this.get("nextIndex");SC.Benchmark.start("CK.TokensController.commitTokens"),this.beginPropertyChanges();if(r===null||r===this.get("length"))this.pushObjects(t),r=this.get("length");else for(var i=0;i<n;i++)this.insertAt(r,t[i]),r++;this.set("nextIndex",r),this.endPropertyChanges(),SC.Benchmark.end("CK.TokensController.commitTokens")},escapeCurlyQuotesFromEmailAddress
:function(e){var t=e.match(/"/g);return t&&t.get("length")>2&&(e=e.replace(/"/g,'\\"'),e=e.replace('\\"','"'),e=e.replace(/\\"([^\\"]*)$/,'"$1')),e}}),CK.tokensParser=SC.Object.create({_validator:null,parseEmailAddressList:function(e,t){var n=[];if(SC.none(e)===YES)return SC.warn("CK.tokensParser.parseEmailAddressList: emailAddrList is null."),n;var r=e.length;for(var i=0;i<=r;){var s=NO,o=NO,u=YES,a;for(var f=i;f<r;f++){var l=e.charAt(f);if((l===","||l===";")&&s===NO&&o===NO){u=NO;break}if(l==='"'&&a!=="\\")s=!s;else if(l==="(")o=YES;else if(l===")")o=NO;else if(l==="\n"&&a!=="\r"){u=NO;break}a=l}var c=e.substr(i,f-i);if(c.length!==0){var h=this._parse(c,t);h&&(h.name||h.emailId||h.phoneNumber)&&n.push(h)}i=f+1}return n},parseEmailAddress:function(e){if(e){e=e.trim();if(e.charAt(0)!=='"'){var t=/([^,;<>]*[,;<>].*)( <[^<]*)$/;e=e.replace(t,'"$1"$2')}}return this.parseEmailAddressList(e)[0]},_parse:function(e,t){if(SC.none(e))return null;var n=e;e=e.replace(/\\"/g,'"');var r=e.trim(),i=r.length;if(i<=0)return null;var s="",o="",u=null,a=r.match(/"/g);a&&a.length%2!==0&&(r=r.replace(/\\*"/g," ")),r.charAt(0)==='"'?r.lastIndexOf('"')<r.lastIndexOf("<")?u=1.1:u=1:r.charAt(0)==="("?r.lastIndexOf(")")<r.search("<")?u=2.1:u=2:r.match("@")&&!r.match("<")&&!r.match('"')?r.indexOf("@")<r.indexOf("(")<r.indexOf(")")?u=3.1:u=3:r.match("<")?u=4:r.indexOf("@")>1&&r.indexOf('"')>-1&&r.indexOf("@")<r.indexOf('"')?r.indexOf("@")<r.indexOf("(")&&r.indexOf("(")<r.indexOf('"')&&r.lastIndexOf('"')<r.indexOf(")")?u=3.1:u=5:r.indexOf("@")===-1&&r.indexOf('"')>-1&&(u=6);switch(u){case 1:s=r.substring
(1,r.lastIndexOf('"')).trim(),o=r.substring(r.lastIndexOf('"')+1,i).trim();break;case 1.1:s=r.substring(1,r.lastIndexOf('"')).trim(),o=r.substring(r.lastIndexOf("<")+1,r.lastIndexOf(">")).trim();break;case 2:s=r.substring(1,r.lastIndexOf(")")).trim(),o=r.substring(r.lastIndexOf(")")+1,i).trim();break;case 2.1:s=r.substring(1,r.lastIndexOf(")")).trim(),o=r.substring(r.lastIndexOf("<")+1,r.lastIndexOf(">")).trim();break;case 3:o=r;break;case 3.1:s=r.substring(r.indexOf("(")+1,r.lastIndexOf(")")).trim(),o=r.substring(0,r.indexOf("(")).trim();break;case 4:s=r.substring(0,r.lastIndexOf("<")).trim(),o=r.substring(r.lastIndexOf("<")+1,r.lastIndexOf(">")).trim();break;case 5:s=r.substring(r.indexOf('"')+1,r.lastIndexOf('"')).trim(),o=r.substring(0,r.indexOf('"')).trim();break;case 6:s=r.substring(r.indexOf('"')+1,r.lastIndexOf('"')).trim(),o=r.substring(0,r.indexOf('"'));break;default:o=r}if(s.length>0){s=s.replace(/\\*"/g,"");var f=/[(\[):;.,<@>\\\]]/;f.test(s)&&(s='"'+s+'"')}s?e=s+"<"+o+">":e=o,this._validator||(this._validator=SC.Validator.Email.create());var l=SC.Object.create({fieldValue:o}),c=this._validator.validate(null,l),h=undefined;return t&&!c&&CK.matchesFormatOfPhoneNumber(o)&&(h=o,o=undefined),CK.Token.create({emailId:o,phoneNumber:h,name:s,isValid:c,originalValue:n,parsedValue:e})},getFirstAndLastNames:function(e){var t="",n="",r=e.indexOf(" ");return r!==-1?(t=e.substring(0,r).trim(),n=e.substring(r+1,e.length).trim()):t=e,{firstName:t,lastName:n}}}),CK.Tokens.metrics=SC.Object.create({TOKEN_VIEW_RIGHT_MARGIN:25,CHEVRON_WIDTH:14,LEFT_ACCESSORY_WIDTH:14}),CK.TokenItemView=
SC.View.design(SC.AutoResize,{layout:{height:23},supportsAutoResize:YES,autoResizeLayer:function(){return this.get("layer")}.property("layer").cacheable(),spellCheckEnabled:YES,isAutocorrectEnabled:YES,isLeftAccessoryVisible:NO,isRightAccessoryVisible:NO,rightAccessoryWidth:0,autoResizeText:null,autoResizeTextBinding:".value",isSelected:function(){var e=this.get("parentView");if(e){var t=e.get("selection").contains(this.get("content"));return t}}.property(),autoResizePadding:function(){var e=2,t=this.get("value");if(t&&t.length>0){var n=this.get("isLeftAccessoryVisible"),r=this.get("isRightAccessoryVisible");this.get("isEditing")===YES?e=0:n||r?(n?e=11:e=0,r&&(e+=13)):e=4}return e}.property("value","isLeftAccessoryVisible","isRightAccessoryVisible","isEditing").cacheable(),scheduleMeasurement:function(){if(!this.get("shouldMeasureSize")||!this.get("isVisibleInWindow")||this.get("autoResizeText")===this._lastMeasuredText&&this.get("isLeftAccessoryVisible")===this._prevIsLeftAccessoryVisible&&this.get("isRightAccessoryVisible")===this._prevIsRightAccessoryVisible)return;SC.AutoResizeManager.scheduleMeasurementForView(this)}.observes("isVisibleInWindow","shouldMeasureSize","autoResizeText","isLeftAccessoryVisible","isRightAccessoryVisible"),classNames:["ck-token-item"],displayProperties:["isEditing","valueInCommitMode","isItemSelected","maxWidth","isLeftAccessoryVisible","isRightAccessoryVisible"],tagName:"span",acceptsFirstResponder:YES,escapeHTML:YES,isEditing:NO,content:null,icon:null,isItemSelected:NO,isTokenHidden:NO,isInIMEInputMode:NO,_isMoveRightAndModify:NO,value:function(
e,t){var n=this.get("content"),r=this.get("isEditing"),i;if(!SC.none(t))i=t;else if(r===YES)i=n.get("originalValue");else{var s=n.get("name");!SC.none(s)&&s.length>0?(i=s,i&&n.get("isValid")&&(i=i.replace(/\s+/g," "))):i=n.get("emailId")}return i}.property("isEditing","content.name","content.emailId").cacheable(),valueInCommitMode:null,_textarea:null,_label:null,_domElement:null,isNewEditingToken:NO,_isEscKeyPressed:NO,delegate:null,init:function(){arguments.callee.base.apply(this,arguments)},domElement:function(){return this._domElement}.property("_domElement").cacheable(),render:function(e,t){var n=this.get("value"),r=this.get("content"),i=this.get("isLeftAccessoryVisible"),s=this.get("isRightAccessoryVisible"),o=this.get("icon");if(this.get("isEditing")===YES){this._setMaxWidth(),e.hasClass("token-commit")===YES&&e.removeClass("token-commit");var u=this.get("spellCheckEnabled")?' spellcheck="true"':' spellcheck="false"',a=this.get("isAutocorrectEnabled")?"":' autocorrect="off"';e.push('<textarea rows="1" wrap="off"'+u+a+">"+SC.RenderContext.escapeHTML(n).replace(/"/g,"&quot;")+"</textarea>")}else{var f=CK.Tokens.metrics,l=this.get("rightAccessoryWidth"),c=f.LEFT_ACCESSORY_WIDTH,h="left-accessory"+(o?" "+o:""),p=SC.BLANK_IMAGE_URL,d='<img class="%@ sc-view" src="%@" />'.fmt(h,p),v='<img class="right-accessory" style="width:%@;" src="%@"/>'.fmt(l,p),m=this.get("valueInCommitMode"),g,y;if(t){var b=this.get("frame");if(b){var w=b.width;w>0&&(g=w-f.TOKEN_VIEW_RIGHT_MARGIN,g>0&&(this.set("maxWidth",g),this._prevMaxWidth=g))}e.addClass("token-commit"),i&&o&&e.push(d);var E="";g&&
(y=g,i&&(y-=c),s&&(y-=l),E='style="max-width: '+y+'px;"');var S='<span class="token-span"><label '+E+' class="token-value">%@</label>';e.push(S.fmt(SC.RenderContext.escapeHTML(n))),s&&e.push(v),e.push("</span>"),this.get("isTokenHidden")===YES&&e.addClass("token-hidden")}else{this.get("isItemSelected")===YES?e.addClass("focus"):e.hasClass("focus")===YES&&e.removeClass("focus"),e.hasClass("token-commit")===NO&&e.addClass("token-commit"),m!==this._prevValueInCommitMode&&this.$(".token-value").text(SC.RenderContext.escapeHTML(m));var x=this._domElement;i&&x.has(".left-accessory").length===0&&x.prepend(d),s&&x.has(".right-accessory").length===0?this.$(".token-span").append(v):s||this.$("img").remove(".right-accessory"),g=this.get("maxWidth");if(g!==this._prevMaxWidth||i!==this._prevIsLeftAccessoryVisible||s!==this._prevIsRightAccessoryVisible)y=g,i&&(y-=c),s&&(y-=l),this.$(".token-value").css("max-width",y+"px")}this.get("isTokenHidden")&&e.addClass("token-hidden"),r&&r.get("isValid")===NO&&e.addClass("token-invalid"),i===YES&&e.addClass("has-left-accessory"),this._prevValueInCommitMode=m,this._prevIsLeftAccessoryVisible=i,this._prevIsRightAccessoryVisible=s}},didCreateLayer:function(){this.get("isEditing")===YES&&(this._textarea=this.$("textarea")[0]),this._label||(this._label=this.$("label")[0]),SC.none(this._domElement)&&(this._domElement=this.$())},didUpdateLayer:function(){this.get("isEditing")===YES?(this._textarea=this.$("textarea")[0],this._textarea&&(SC.Event.add(this._textarea,"input",this,this._html5input),SC.Event.add(this._textarea,"paste",this,this._handlePasteEvent
),SC.Event.add(this._textarea,"compositionstart",this,this._handleCompositionStartEvent),SC.Event.add(this._textarea,"compositionend",this,this._handleCompositionEndEvent))):(this._textarea=null,this._label||(this._label=this.$("label")[0])),SC.none(this._domElement)&&(this._domElement=this.$())},willDestroyLayer:function(){this._textarea&&(SC.Event.remove(this._textarea,"input",this,this._html5input),SC.Event.remove(this._textarea,"paste",this,this._handlePasteEvent),SC.Event.remove(this._textarea,"compositionstart",this,this._handleCompositionStartEvent),SC.Event.remove(this._textarea,"compositionend",this,this._handleCompositionEndEvent))},_html5input:function(){this._isEscKeyPressed===NO?(SC.browser.mozilla?this.updateValue():this.invokeLater(this.updateValue,10),this.adjustEditorWidth()):this._isEscKeyPressed=NO},_handlePasteEvent:function(){var e=this.get("parentView");this.updateValue(),this.invokeLater(function(){var t=this._textarea.value;SC.empty(t)?SC.warn("CK.TokenItemView._handlePasteEvent: The clipBoard is empty"):(t.length>1&&t.charCodeAt(0)===8203&&t.charCodeAt(1)===10&&(this._textarea.value=t.substring(2,t.length),this.updateValue()),this.commitEditing(),e&&e.createEditingToken())},10)},_handleCompositionStartEvent:function(){this.set("isInIMEInputMode",YES)},_handleCompositionEndEvent:function(){this.set("isInIMEInputMode",NO)},isEditingDidChange:function(){var e=SC.browser;if(e.isIE===YES||e.isEdge){var t=this.get("mouseDragged");this._mouseDragged||(this._mouseDragged=t),this.get("isEditing")===YES?this.set("mouseDragged",undefined):t===undefined&&this.set
("mouseDragged",this._mouseDragged)}}.observes("isEditing"),mouseDown:function(e){this._mouseDownInfo=e;var t=this.get("parentView");t&&t.set("shouldSelectAllTokens",NO);var n=this.get("isEditing");return n===YES?e.allowDefault():n===NO&&e.clickCount===2&&this.beginEditing(),YES},mouseUp:function(e){var t=this.get("parentView"),n=t.get("tokensController"),r=n.indexOf(this.get("content")),i=r>=0?r:-1,s=t.get("selection"),o=s.get("length"),u=s.toArray(),a;if(this.get("isEditing")===NO){if($(e.target).hasClass("right-accessory"))a=YES;else if(SC.browser.isMac&&e.metaKey===YES||SC.browser.isWindows&&e.ctrlKey===YES)this.get("isSelected")===YES?t.deselect(i):t.select(i);else if(e.shiftKey===YES){var f=n.indexOf(u[o-1]),l,c;if(o>0)if(this.get("isSelected")===NO){f<i?(l=f,c=i):(l=i,c=f),this.beginPropertyChanges();for(var h=l;h<=c;h++)t.select(h);this.endPropertyChanges()}else{var p=t.getSortedSelectedTokens(),d=p.toArray(),v=d[o-1],m=n.indexOf(v);if(m!==i){l=i+1,c=m,this.beginPropertyChanges();for(var g=l;g<=c;g++)t.deselect(g);this.endPropertyChanges()}else t.deselect(i)}else t.select(i)}else a=YES;if(a){this.beginPropertyChanges();for(var y=0;y<o;y++)t.deselect(n.indexOf(u[y]));this.endPropertyChanges(),!this.getPath("content.isValid")&&!e.shiftKey?this.beginEditing():t.select(i)}}return NO},click:function(e){var t=NO;if($(e.target).hasClass("right-accessory")){var n=this.get("delegate");n&&(t=n.tryToPerform("rightAccessoryViewClicked",this))}return t},keyDown:function(e){var t=this.interpretKeyEvents(e)||NO,n=e.which;if(e.metaKey&&e.which===86){var r=this.get("parentView");if(this
.get("isEditing")===NO){var i=r.getHiddenTextArea();i.value="",i.focus(),this.invokeLater(function(){var e=i.value;if(!SC.empty(e)){var t=r.get("tokensController");r.deleteTokens(),t.commitTokens(e)}else SC.warn("CK.TokenItemView.keyDown: The clipBoard is empty")},20)}}return n!==SC.Event.KEY_ESC&&this.invokeLater(this.updateValue,10),t},insertText:function(e,t){var n=this.get("parentView"),r=t.charCode,i=r===44?YES:NO,s=r===59?YES:NO;if(this.get("isEditing")&&!t.metaKey&&!t.altKey&&!t.shiftKey&&(i||s)){var o=this._textarea.value,u=this.getTextSelection(),a=u.start,f=u.end;if(i&&a===0&&f===0)return YES;if(a===o.length){if((o.match(/"/g)||[]).length%2===0)return this.commitEditing(),n.createEditingToken(),YES}else if(i&&o.charAt(a-1)===",")return YES}return NO},selectAll:function(){if(this.get("isEditing")){var e=this._textarea;if(e&&e.value!=="")return e.select(),YES}return NO},moveRightAndModifySelection:function(e,t){return this._isMoveRightAndModify=YES,this.modifySelection(e,t)},moveLeftAndModifySelection:function(e,t){return this._isMoveRightAndModify=NO,this.modifySelection(e,t)},modifySelection:function(e,t){var n=this.get("parentView"),r,i;if(!n)return YES;r=n.get("tokensController"),this._isMoveRightAndModify?i=r.indexOf(this.get("content"))+1:i=r.indexOf(this.get("content"))-1;if(this.get("isEditing")===YES){if(this.get("value")!==""){if(!t){if(!e)return NO;t=e}return t.allowDefault(),YES}if(this._isMoveRightAndModify)n.deselect(i-1),n.select(i);else{n.deselect(i+1),n.select(i);if(SC.browser.mozilla)return YES}}return NO},insertNewline:function(){var e=this.get("parentView"
);if(this.get("isEditing")){if(this.get("value")==="")return this.insertTab(),YES;var t=e.get("tokensController"),n=t.indexOf(this.get("content"));t.set("nextIndex",n+1),e.createEditingToken()}else{var r=e.get("selection"),i=r.get("length");i===1&&this.beginEditing()}return YES},insertTab:function(e){var t=this.get("parentView");return t?t.insertTabInChildView(e):NO},insertBacktab:function(e){var t=this.get("parentView");return t?t.insertBacktabInChildView(e):NO},deleteBackward:function(e){var t=this.get("parentView");if(!t)return SC.warn("CK.TokenItemView.deleteBackward: Token item view has no parent."),NO;var n=t.get("tokensController"),r=this.get("content");if(this.get("isEditing")===YES){var i=this._textarea.value,s=this.getTextSelection(),o=s.start,u=s.end,a=t.get("childViews"),f=n.indexOf(r);if(i.length===0){if(f>0)return t.deselect(f),t.select(f-1),e.preventDefault(),YES}else if(o===0&&u===0&&f!==0){n.set("nextIndex",f),this.commitEditing();var l=f-1;return a.objectAt(l).becomeFirstResponder(),t.select(l),e.preventDefault(),YES}return SC.browser.mozilla&&e.allowDefault(),NO}return t.deleteTokens(),YES},cancel:function(){var e;return this._isEscKeyPressed=YES,this.get("isEditing")&&this.get("value")!==""?(this.discardEditing(),e=YES):e=NO,e},moveRight:function(){var e=this.get("parentView");if(!e)return SC.warn("CK.TokenItemView.moveRight: Token item view has no parent."),NO;var t=e.get("tokensController"),n=t.indexOf(this.get("content")),r,i=e.get("selection"),s=i.toArray(),o=i.get("length");if(this.get("isEditing")!==YES)return t.set("nextIndex",t.indexOf(s[o-1])+1),
e.createEditingToken(),YES;var u=this._textarea.value.length,a=this.getTextSelection().start;return a===u?(u===0?n!==t.get("length")-1&&(r=n+1,e.select(r)):(t.set("nextIndex",n+1),e.createEditingToken()),YES):NO},moveLeft:function(){var e=this.get("parentView");if(!e)return SC.warn("CK.TokenItemView.moveLeft: Token item view has no parent."),NO;var t=e.get("tokensController"),n=t.indexOf(this.get("content")),r,i=e.get("selection"),s=i.toArray(),o=i.get("length");if(this.get("isEditing")){var u=this.getTextSelection(),a=u.start,f=u.end;return this._textarea.value?a===f&&a===0?(t.set("nextIndex",n),e.createEditingToken(),YES):NO:n===0?YES:(r=n-1,e.deselect(n),e.select(r),YES)}return t.set("nextIndex",t.indexOf(s[o-1])),e.createEditingToken(),YES},updateValue:function(){this.get("isEditing")===YES&&this._textarea&&this.set("value",this._textarea.value)},beginEditing:function(){var e=this.get("parentView"),t=e.get("tokensController"),n=e.get("selection"),r=n.toArray(),i=n.get("length"),s=e.get("isKeyPressed");this.beginPropertyChanges();for(var o=0;o<i;o++)e.deselect(t.indexOf(r[o]));this.endPropertyChanges(),this.becomeFirstResponder(),this.set("isEditing",YES),this.invokeLater(function(){var t=this._textarea;if(t){var n=t.value;!SC.empty(n)&&SC.$(t).is(":visible")&&t.select();if(SC.browser.isMozilla&&n!==""||s)if(SC.$(t).is(":visible")){var r=n.length;try{t.setSelectionRange(r,r)}catch(i){SC.warn("CK.TokenItemView.beginEditing: Exception while trying to set text selection"),SC.warn(i)}}t.focus(),s&&e.set("isKeyPressed",NO)}})},commitEditing:function(){var e=this.get("parentView"
);if(!e){SC.error(this+".commitEditing: Token item view has no parent. NOOP");return}var t=e.get("tokensController"),n=this.get("value").trim(),r=this.get("content"),i=t.indexOf(r);if(this.get("isEditing")===NO)return;this.set("isEditing",NO),t.removeObject(r),SC.empty(n)===NO&&(t.set("nextIndex",i),t.commitTokens(n))},discardEditing:function(){var e=this.get("parentView"),t=this.get("content"),n,r,i;if(e){n=e.get("tokensController");if(n){r=n.indexOf(t),n.removeObject(t),t&&(i=t.get("originalValue"));if(this.get("isNewEditingToken")===NO&&i)n.set("nextIndex",r),n.commitTokens(i);else if(this.get("isNewEditingToken")===YES){var s=e.get("previousSelectedTokensValue");s?(n.commitTokens(s),e.set("previousSelectedTokensValue",null)):n.set("nextIndex",r)}e.createEditingToken()}}},valueDidChange:function(){this._textarea&&this.get("isEditing")===YES&&this.adjustEditorWidth();var e=this.get("value");this.get("isEditing")||this.set("valueInCommitMode",e);var t=this.get("parentView");t&&(t.childTokenItemValueDidChange(this._previousValue,e),this._previousValue=e)}.observes("value"),adjustEditorWidth:function(){var e=this._textarea,t=e.value,n,r;t.length>0?(n=SC.metricsForString(t,e),r=n.width+14+"px"):r="1px",SC.none(this._domElement)||(this._domElement[0].style.width=r)},didBecomeFirstResponder:function(){this._parentView||(this._parentView=this.get("parentView")),this._parentView.setIfChanged("isActive",YES)},willLoseFirstResponder:function(){this.get("isEditing")===YES&&this.commitEditing(),this._parentView.setIfChanged("isActive",NO)},mouseDragged:function(e){if(this._mouseDownInfo
.button===2||this._mouseDownInfo.metaKey&&this._mouseDownInfo.button===0)return YES;var t=this.get("parentView");if(this.get("isEditing")===YES||!t)return;var n=t.get("selection"),r=n.get("length"),i,s=NO;if(this.get("isSelected")===NO)i=this;else if(r===1)i=this;else{i=CK.TokenDragView.create({});var o=t.getSortedSelectedTokens();i.set("content",o),i.createLayer(),s=YES}return SC.Drag.start({event:e,source:t,dragView:i,ghost:NO,ghostActsLikeCursor:s,slideBack:YES,dataSource:t,sourceIsDraggable:YES}),YES},getTextSelection:function(){var e=this._textarea,t=0,n=0;if(e){t=null,n=null;if(!e.value)t=n=0;else{"selectionStart"in e&&(t=e.selectionStart),"selectionEnd"in e&&(n=e.selectionEnd);if(t===null||n===null){var r=document.selection;if(r){var i=r.type;if(i&&(i==="None"||i==="Text")){var s=r.createRange(),o=s.duplicate();o.moveToElementText(e),o.setEndPoint("EndToStart",s),t=o.text.length,n=t+s.text.length}}}}}return{start:t,end:n}},selectStart:function(){return YES},parentViewDidResize:function(){this.get("isEditing")===YES&&this._setMaxWidth(),arguments.callee.base.apply(this,arguments)},_setMaxWidth:function(){var e=this.getPath("parentView.frame");if(e){var t=e.width,n=CK.Tokens.metrics.TOKEN_VIEW_RIGHT_MARGIN;if(t>n){var r=t-n;this.get("maxWidth")<r&&(this.adjust("maxWidth",r),this.set("maxWidth",r))}}}}),CK.TokenDragView=SC.View.extend(SC.AutoResize,{classNames:"ck-token-drag".w(),layout:function(){var e=this.get("content");if(e){var t=e.get("length");return t<10?{height:18,width:18}:t<100?{height:18,width:30}:{height:18,width:38}}}.property("content").cacheable(),displayProperties
:["content"],supportsAutoResize:YES,autoResizeLayer:function(){return this.get("layer")}.property("layer").cacheable(),autoResizeText:function(){return this.get("dragLabelText")}.property("dragLabelText").cacheable(),render:function(e){var t='<label class= "sc-view drag-count">%@</label>';return e.addClass(this.get("badgeClass")),e.push("<span class='left'></span>"),e.push("<span class='middle'></span>"),e.push("<span class='right'></span>"),e.push(t.fmt(SC.RenderContext.escapeHTML(this.get("dragLabelText")))),arguments.callee.base.apply(this,arguments)},dragLabelText:function(){var e=this.get("content");if(e)return"CK.Token.Drag.MultipleTokens".loc(e.get("length"))}.property("content"),badgeClass:function(){var e=this.get("dragLabelText"),t;return e<10?t="drag-badge-one-digit":e<100?t="drag-badge-two-digit":t="drag-badge-three-digit",t}.property()}),CK.TokenView=SC.View.extend(SC.FlowedLayout,{useStaticLayout:YES,defaultFlowSpacing:{left:4,top:5,right:6},classNames:["ck-token-view"],tokensController:CK.TokensController,contentBinding:".tokensController.arrangedObjects",selectionBinding:".tokensController.selection",acceptsFirstResponder:YES,focusEventMakesFirstResponder:NO,_shouldShowScroller:NO,exampleView:CK.TokenItemView,_TMP_ATTRS:{},isActive:NO,isKeyPressed:NO,_isMoveRightAndModifySelection:NO,_map:null,shouldSelectAllTokens:YES,previousSelectedTokensValue:null,init:function(){var e=this.get("tokensController");e&&e.isClass&&(e=e.create()),this.set("tokensController",e),arguments.callee.base.apply(this,arguments)},_scfl_calculatedSizeDidChange:function(){if(this.get("autoResize"
)){var e=this.get("shouldResizeHeight"),t=this.get("shouldResizeWidth");if(this.get("layoutDirection")===SC.LAYOUT_VERTICAL)e&&this.adjust("minHeight",this.get("_scfl_maximumCollapsedRowLength")),t&&this.adjust("minWidth",this.get("_scfl_totalCollapsedRowSize"));else{t&&this.adjust("minWidth",this.get("_scfl_maximumCollapsedRowLength"));if(e){var n=this.get("_scfl_totalCollapsedRowSize");n===0&&(n=30),n>30&&(n+=4),this.adjust("minHeight",n)}}}},render:function(e,t){t&&e.push('<textarea class= "hidden-text"></textarea>')},mouseDown:function(e){var t=this.get("tokensController"),n={x:e.pageX,y:e.pageY},r;return r=this.calculateNewTokenIndex(n),t.set("nextIndex",r),this.set("shouldSelectAllTokens",NO),this.createEditingToken(),YES},createEditingToken:function(e){var t=this.get("tokensController");if(SC.none(t)===YES){SC.warn("CK.TokenView.createEditingToken: "+this+" has no controller");return}var n=CK.Token.create(),r=t.get("nextIndex"),i=t.get("length");r>i&&(r=i),t.insertAt(r,n),this.invokeLast(function(){var t=this._map[SC.guidFor(n)];e&&(this.set("isKeyPressed",YES),n.set("originalValue",e)),t.set("isNewEditingToken",YES),t.beginEditing()})},createItemView:function(e,t){return e.create(t)},contentDidChange:function(){var e={},t=this._map||{},n=[],r=this.get("content"),i=r.get("length"),s,o,u,a;this.beginPropertyChanges();for(var f=0;f<i;f++){s=r.objectAt(f),o=SC.guidFor(s),u=t[o];if(!u){var l=this.get("exampleView"),c=this._TMP_ATTRS;c.content=s,u=this.createItemView(l,c),this.appendChild(u)}s===this._spacingToken&&(a=u),n.push(u),e[o]=u}this.endPropertyChanges(),this.beginPropertyChanges
();for(o in t)t.hasOwnProperty(o)&&!e[o]&&t[o].destroy();this.endPropertyChanges(),this._map=e,this.reorder(n),a&&a.set("isTokenHidden",YES),r.getEach("parsedValue").removeObject("").toString()!==""&&this.getChildViewInEditMode()&&this.tokenViewContentDidChange(),this.notifyPropertyChange("frame")}.observes("content","content.[]"),selectAll:function(e){this.selectAllTokens(),e.preventDefault()},keyDown:function(e){var t=this.interpretKeyEvents(e)||NO;return e.metaKey&&e.which===88&&(e.allowDefault(),this.invokeLater(function(){var e=this.get("selection");e&&this.deleteTokens()},10)),t},insertText:function(e,t){var n=this.getSortedSelectedTokens();return!t.metaKey&&!t.altKey&&n.get("length")>0&&(this.set("previousSelectedTokensValue",this._textarea.value),this.deleteTokens(String.fromCharCode(t.charCode))),NO},deleteTokens:function(e){var t=this.get("tokensController"),n=this.get("selection"),r=n.get("length"),i=n.toArray(),s,o=-1;if(r>0){for(var u=0;u<r;u++){var a=t.indexOf(i[u]);a>o&&(o=a)}o=o-r+1}this.beginPropertyChanges();for(var f=0;f<r;f++)s=i[f],t.removeObject(s);this.tokenViewContentDidChange(),this.endPropertyChanges(),o===-1&&(o=0),t.set("nextIndex",o),this.createEditingToken(e)},moveLeftAndModifySelection:function(e,t){this._isMoveRightAndModifySelection=NO,this.modifySelection(e,t)},moveRightAndModifySelection:function(e,t){this._isMoveRightAndModifySelection=YES,this.modifySelection(e,t)},modifySelection:function(){var e=this.get("tokensController"),t=e.get("length"),n=this.get("selection"),r=n.get("length"),i=n.toArray();if(r>0){var s=e.indexOf(i[r-1]),o;this._isMoveRightAndModifySelection?
o=s+1:o=s-1,n.containsObject(e.objectAt(o))?this.deselect(s):(this._isMoveRightAndModifySelection&&o!==t||!this._isMoveRightAndModifySelection)&&this.select(o)}},select:function(e){var t=this.get("selection"),n=this.get("content"),r=this.get("childViews"),i;SC.typeOf(e)===SC.T_NUMBER&&(e=SC.IndexSet.create(e,1)),t?t=t.copy():t=SC.SelectionSet.create(),i=e.get("length");if(i===1){var s=e.get("firstObject"),o=r.objectAt(s);t.addObject(n.objectAt(s)),o&&(o.set("isItemSelected",YES),t.get("length")===1&&o.becomeFirstResponder())}return this.set("selection",t.freeze()),this.setSelectedTokensToHiddenTxt(),this},deselect:function(e){var t=this.get("selection"),n=this.get("content"),r=this.get("childViews"),i;SC.typeOf(e)===SC.T_NUMBER&&(e=SC.IndexSet.create(e,1)),i=e.get("length");if(i===1){var s=e.get("firstObject"),o=r.objectAt(s);t=t.copy().removeObject(n.objectAt(s)),o.set("isItemSelected",NO)}return this.set("selection",t.freeze()),this.setSelectedTokensToHiddenTxt(),this},selectAllTokens:function(){var e=this.get("selection"),t=this.get("content"),n=this.get("childViews").filterProperty("isEditing",NO),r=n.get("length");e?e=e.copy():e=SC.SelectionSet.create();var i;this.beginPropertyChanges();for(var s=0;s<r;s++)i=n.objectAt(s),i.get("isSelected")===NO&&(e.addObject(t.objectAt(s)),i.set("isItemSelected",YES),e.get("length")===1&&i.becomeFirstResponder());this.endPropertyChanges(),this.set("selection",e.freeze()),this.setSelectedTokensToHiddenTxt()},deselectAllTokens:function(){var e=this.get("selection"),t=this.get("tokensController"),n=t.get("length"),r=this.get("childViews"
),i=e.toArray(),s,o,u;this.beginPropertyChanges();for(var a=0;a<n;a++)s=i[a],u=t.indexOf(s),u>=0&&(e=e.copy().removeObject(s),o=r.objectAt(u),o.set("isItemSelected",NO));return this.endPropertyChanges(),this.set("selection",e.freeze()),this.setSelectedTokensToHiddenTxt(),this},didBecomeFirstResponder:function(){if(this.get("isFirstResponder")){var e=this.get("childViews"),t,n=this.get("shouldSelectAllTokens");e&&(t=e.get("length")),n===NO||t===0?this.createEditingToken():this.selectAllTokens()}this.setIfChanged("isActive",YES)},willLoseFirstResponder:function(){var e=this.get("tokensController"),t=this.get("selection");this.beginPropertyChanges();if(t){var n=t.get("length"),r=t.toArray();for(var i=0;i<n;i++)this.deselect(e.indexOf(r[i]))}this.setIfChanged("isActive",NO),this.set("shouldSelectAllTokens",YES),this.endPropertyChanges()},isDropTarget:YES,dragDataTypes:[CK.TokenItemView],_dropIndex:null,_prevHeight:null,_MAX_HEIGHT:112,_maxFrameHeight:113,_spacingToken:CK.Token.create({emailId:"spacingtoken"}),computeDragOperations:function(){return SC.DRAG_MOVE},acceptDragOperation:function(){return this._shouldAcceptDragOperation},dragStarted:function(e){var t=e.dragView;if(t&&t.kindOf(CK.TokenItemView)){var n=e.getPath("ghostView");if(n){var r=n.$();r&&r.hasClass("ck-token-ghost")===NO&&r.addClass("ck-token-ghost");var i=n.getPath("layout.width");n.adjust("width",i+10)}}},dragUpdated:function(e){var t=this.get("tokensController"),n=e.dragView,r=this.calculateNewTokenIndex(e.get("location")),i=r-1,s=t.objectAt(i),o=this._dropIndex,u=n.get("content"),a=this._spacingToken,f=YES;if(
o===r)return;if(!s||s!==a){var l=t.indexOf(a);t.removeObject(a),l>=0&&l<r&&r--;if(r<=t.get("length")){var c=t.objectAt(r),h=t.get("content");if(u.get("isSelectionSet")){var p=u.get("length"),d=r-p;if(s&&u.contains(h,i,2)||u.contains(h,r,p)||d>=0&&u.contains(h,d,p))f=NO}else if(u===c||s&&u===s)f=NO;f&&(t.set("nextIndex",r),n&&n.kindOf(CK.TokenItemView)&&(a.set("displayName",u.get("displayName")),a.set("name",u.get("name")),a.set("emailId",u.get("emailId"))),t.insertAt(r,a))}}this._dropIndex=r,this._shouldAcceptDragOperation=f},dragExited:function(){this.get("tokensController").removeObject(this._spacingToken),this._dropIndex=null},performDragOperation:function(e){var t=this.get("tokensController"),n=e.dragView,r=n.get("content"),i=e.get("location"),s,o,u=e.source,a,f;u&&(a=u.get("tokensController"));if(n&&n.kindOf(CK.TokenItemView))a&&(f=a.indexOf(r),f>=0&&a.removeAt(f));else{var l=r.get("length"),c=r.toArray(),h;for(o=0;o<l;o++)a&&(h=a.indexOf(c[o]),h>=0&&a.removeAt(h))}s=this.calculateNewTokenIndex(i),this.beginPropertyChanges();if(n&&n.kindOf(CK.TokenItemView))t.insertAt(s,r);else{var p=r.get("length"),d,v=r.toArray();for(d=0;d<p;d++)t.insertAt(s,v[d]),s++}return this.endPropertyChanges(),SC.DRAG_MOVE},clippingFrame:function(){var e=this.get("frame");return e?{x:0,y:0,width:e.width,height:e.height}:{x:0,y:0,width:0,height:0}}.property("frame"),viewDidResize:function(){arguments.callee.base.apply(this,arguments);var e=this.get("layout"),t=e.minHeight,n=this.get("layer"),r=this.get("tokensController"),i=NO;if(!n)return;var s=n.style;if(t!==this._prevHeight){if(t>this._MAX_HEIGHT
){this._shouldShowScroller=YES,t=this._maxFrameHeight;var o=this.getChildViewInEditMode();o&&r.indexOf(o.get("content"))===r.get("length")-1&&(i=YES)}else this._shouldShowScroller=NO;e.minHeight=t}this._shouldShowScroller===YES?(s.overflowY="auto",s.overflowX="hidden",this.set("flowPadding",{left:0,bottom:0,right:20,top:0})):(s.overflowY="hidden",s.overflowX="hidden",this.set("flowPadding",{left:0,bottom:0,right:0,top:0})),i===YES&&this.invokeLast(function(){n.scrollTop=n.scrollHeight}),this._prevHeight=t},_scfl_frameDidChange:function(){var e=this.get("frame"),t=this._scfl_lastFrameSize||{};if(!e)return;this._scfl_lastFrameSize=SC.clone(e);if(t.width===e.width&&t.height===e.height)return;this._scfl_tileOnce()}.observes("frame"),flowSpacingForChild:function(e,t){var n;return t.get("value")===""||t.get("isEditing")?(this.set("shouldResizeWidth",NO),n={left:-2,right:0,bottom:0,top:5}):t.get("isLeftAccessoryVisible")===YES&&(n={left:4,top:5,right:11}),SC.none(n)===YES&&(n=this.get("defaultFlowSpacing")||0),SC.typeOf(n)===SC.T_NUMBER?n={left:n,right:n,bottom:n,top:n}:(n.left=n.left||0,n.right=n.right||0,n.top=n.top||0,n.bottom=n.bottom||0),n},getChildViewInEditMode:function(){var e=this.get("childViews");if(!e||e.get("length")===0)return null;for(var t=e.get("length")-1;t>=0;t--)if(e[t].get("isEditing")===YES)return e[t];return null},childTokenItemValueDidChange:function(){},insertTabInChildView:function(){this.resignFirstResponder();var e=this.get("nextValidKeyView");return e&&e.becomeFirstResponder&&e.becomeFirstResponder(),YES},insertBacktabInChildView:function(){this.resignFirstResponder
();var e=this.get("previousValidKeyView");return e&&e.becomeFirstResponder&&e.becomeFirstResponder(),YES},getSortedSelectedTokens:function(){var e=this.get("content"),t,n,r=[],i,s,o,u=this.get("selection"),a=u.get("length"),f=SC.SelectionSet.create();u=u.toArray();for(t=0;t<a;t++)s=u.objectAt(t),o=e.indexOf(s),r.push(o);r=r.sort(function(e,t){return e-t});for(n=0,i=r.length;n<i;n++)f.addObject(e.objectAt(r[n]));return f},setSelectedTokensToHiddenTxt:function(){var e=this.getSortedSelectedTokens(),t=e.toArray(),n,r,i=[],s,o=this.get("tokensController");if(e){for(n=0,r=e.get("length");n<r;n++)s=t[n].parsedValue,s=o.escapeCurlyQuotesFromEmailAddress(s),n>0&&s.charAt(0)!==" "&&(s=" "+s),i.push(s);if(i&&i.get("length")>0){var u=this.getHiddenTextArea();u.focus(),u.value=i.toString(),u.select()}}},selectStart:function(){return YES},getHiddenTextArea:function(){return this._textarea||(this._textarea=this.$("textarea")[0]),this._textarea},calculateNewTokenIndex:function(e){var t=this.get("childViews"),n=t.get("length"),r,i,s,o,u,a,f,l=e.x,c=e.y,h;for(var p=0;p<n;p++){r=t.objectAt(p),h=r.get("domElement");if(SC.none(h)===YES){SC.warn("CK.TokenView.calculateNewTokenIndex: No DOM element for "+r);continue}i=r.get("layout"),s=h.offset(),o=s.left+i.width,u=s.top+i.height+parseInt(h.css("borderTopWidth"),10);if(l<=o&&c<=u||l>o&&u>a&&c<=a){f=p;break}a=u}return p===n&&(f=n),f},tokenViewContentDidChange:function(){}}),SC.metricsFor("en-us",{"CK.Autocomplete.Menu.SingleLine.WithCategories.minWidth":400,"CK.Autocomplete.Menu.SingleLine.NoCategories.minWidth":300,"CK.Autocomplete.Menu.DoubleLine.minWidth"
:250}),SC.stringsFor("English",{"CK.Autocomplete.Error.Internal":"Internal error","CK.Autocomplete.Error.Generic":"Couldn’t load contacts because of a server error.","CK.Autocomplete.Error.NotFound":"Couldn’t load contacts because the server could not be found.","CK.Autocomplete.SearchingProgress":"Searching for “%@”…","CK.Autocomplete.GroupSecondaryLabel.Multiple":"%@ contacts","CK.Autocomplete.GroupSecondaryLabel.Single":"1 contact","CK.Autocomplete.GroupMembers":"%{emailAddresses} & %{lastEmailAddress}","CK.Autocomplete.Recents.Delete.Title":"Remove From Recents","CK.Autocomplete.Recents.Delete.Recipient.Text":"Are you sure you want to remove this recent recipient?","CK.Autocomplete.Recents.Delete.Group.Text":"Are you sure you want to remove this recent group?","CK.Autocomplete.Category.WORK":"work","CK.Autocomplete.Category.HOME":"home","CK.Autocomplete.Category.MOBILE":"mobile","CK.Autocomplete.Category.MAIN":"main","CK.Autocomplete.Category.HOMEFAX":"home fax","CK.Autocomplete.Category.WORKFAX":"work fax","CK.Autocomplete.Category.PAGER":"pager","CK.Autocomplete.Category.OTHER":"other","CK.Autocomplete.Category.CUSTOM":"custom","CK.Autocomplete.Category.RECENTS":"recents","CK.Autocomplete.Category.IPHONE":"iPhone"}),CK.Autocomplete=SC.Object.create({isRecentsEnabled:YES,isRecentsGroupsEnabled:NO,includePhoneNumbers:!1,showiCloudMembership:!1,isRecentsDataAvailable:function(){return CloudOS.getUrlForServiceName("mail")&&CK.Autocomplete.get("isRecentsEnabled")?YES:NO}.property().cacheable(),localizedCategory:function(e){return e?("CK.Autocomplete.Category."+e).locWithDefault
(e):null}}),CK.AutocompleteResult=SC.Object.extend({value:null,primaryLabel:null,category:null,localizedCategory:function(){return CK.Autocomplete.localizedCategory(this.get("category"))}.property("category").cacheable(),secondaryLabel:null,previewValue:null,matchChunks:null,isContactsGroup:NO,isRecentsGroup:NO,recentsGuid:null,isEnabled:YES,disableMenuFlash:YES}),CK.ContactsAutocompleteRequest=CK.Request.extend({contact:null,COPY_KEYS:CK.Request.prototype.COPY_KEYS.concat(["contact"])}),CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_CONTACTS=5,CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_LOOKUP=6,CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_ADD_CONTACT=7,CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_RECENT_RECIPIENTS=8,CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_DELETE_RECENTS=9,CK.CONTACTS_AUTOCOMPLETE_DEFAULT_INPUT_MINIMUM_CHARACTERS=2,CK.CONTACTS_AUTOCOMPLETE_IME_INPUT_MINIMUM_CHARACTERS=1,CK.CONTACTS_AUTOCOMPLETE_SORT_ORDER_FIRST_LAST="first,last",CK.CONTACTS_AUTOCOMPLETE_SORT_ORDER_LAST_FIRST="last,first",CK.CONTACTS_AUTOCOMPLETE_NAME_DISPLAY_ORDER_FIRST_LAST="first,last",CK.CONTACTS_AUTOCOMPLETE_NAME_DISPLAY_ORDER_LAST_FIRST="last,first",CK.CONTACTS_AUTOCOMPLETE_CONTACT_MATCH_FIELDS=["firstName","phoneticFirstName","middleName","lastName","phoneticLastName","nickName","companyName","emailAddresses"],CK.CONTACTS_AUTOCOMPLETE_GROUP_MATCH_FIELDS=["name"],CK.CONTACTS_AUTOCOMPLETE_RECENT_RECIPIENTS_MATCH_FIELDS=["address","name","names"],CK.CONTACTS_AUTOCOMPLETE_DEBUG_REPLY_LATENCY=0,CK.ContactsAutocompleteDataSource=SC.DataSource.extend({delegate:null,recentsRequestIsOutstanding:NO,recentsRequestHasCompleted
:NO,recentsDataIsLoaded:NO,contactsRequestIsOutstanding:NO,contactsRequestHasCompleted:NO,contactsDataIsLoaded:NO,addContactRequestHasCompleted:NO,addContactDidError:NO,uploadVCardRequestHasCompleted:NO,uploadVCardDidError:NO,uploadVCardFailureErrorCode:null,isSearchable:function(){return this.get("contactsDataIsLoaded")||this.get("recentsDataIsLoaded")}.property("contactsDataIsLoaded","recentsDataIsLoaded").cacheable(),allDataIsLoadedForQuery:null,syncInterval:0,syncTokenInUse:NO,dataRefreshNeeded:NO,__dummy_prefix__:"__dummy_prefix__",clearLoadedData:function(){this.set("recentsRequestIsOutstanding",NO),this.set("recentsRequestHasCompleted",NO),this.set("contactsRequestIsOutstanding",NO),this.set("contactsRequestHasCompleted",NO),this.set("addContactRequestHasCompleted",NO),this.set("addContactRequestHasFailed",NO),this.set("recentsDataIsLoaded",NO),this.set("contactsDataIsLoaded",NO),this.set("uploadVCardDidError",NO),this.set("uploadVCardRequestHasCompleted",NO),this.set("uploadVCardFailureErrorCode",null),this.set("outstandingAutocompletionRequestQuery",NO),this.set("allDataIsLoadedForQuery",NO),this._dataCache=null,this._groupsToResolve=[],this._storedRecords=[],this._lastSearchedPrefix=null,this._lastSearchedDataCache=null,this._mostRecentAutocompletionQuery=null,this._pendingAddContacts=[],this._lastSyncToken=null,this._lastPrefToken=null,this.set("dataRefreshNeeded",YES)},findCompletionsInLoadedData:function(e){var t=this._dataCache;if(!t)return[];var n=this._lastSearchedPrefix;n&&e.indexOf(n)===0&&(t=this._lastSearchedDataCache);var r=e.split(" "),i=[],s=r.length,o
,u;for(o=0;o<s;++o)u=r[o],u&&i.push(u);var a={},f,l,c,h,p=i.length,d,v,m,g,y,b,w;for(o=0;o<p;++o){var E={},S=i[o],x=S.removeDiacritics().toLowerCase(),T=x;for(l=0;l<3;++l){var N,C,k;switch(l){case 0:N="recents",C=CK.CONTACTS_AUTOCOMPLETE_RECENT_RECIPIENTS_MATCH_FIELDS,k="guid";break;case 1:N="contacts",C=CK.CONTACTS_AUTOCOMPLETE_CONTACT_MATCH_FIELDS,k="contactId";break;case 2:N="groups",C=CK.CONTACTS_AUTOCOMPLETE_GROUP_MATCH_FIELDS,k="groupId";if(o!==0)continue;p>1&&(x=e.removeDiacritics().toLowerCase())}d=t[N],s=C.length;for(c=0;c<s;++c){v=C[c],m=d[v],g=m.values;if(p>1&&v==="companyName"){if(o!==0)continue;x=e.removeDiacritics().toLowerCase()}var L=this._indexForString(g,x),A=x.length-1,O=x.substr(0,A),M=x.charCodeAt(A);O+=String.fromCharCode(M+1);var _=this._indexForString(g,O),D=g.length;if(L<D&&L<_){var P=v==="emailAddresses",H=m.records.slice(L,_),B=H.length;for(h=0;h<B;++h){y=H[h];if(!y)continue;var j=y.length;for(var F=0;F<j;++F){var I,q;b=I=q=null,P?(I=y[F],q=I.idx,b=I.rec):b=y[F];var R=b[k];if(R){var U=a[R];U||(a[R]={fields:{},rec:b}),E[R]=YES;if(!P){var z=S;if(N==="groups"||v==="companyName")z=e;a[R].fields[v]=z}else{var W=a[R].fields,X=W[v];X||(W[v]={},X=W[v]),X[q]=S}}}}}x!==T&&(x=T)}}for(f in a)w=a[f],a.hasOwnProperty(f)&&!E[f]&&(o===0||!w.rec.groupId&&!w.fields.companyName)&&delete a[f];y=[];var V={};V.contacts=[],V.groups=[],V.result=[];for(f in a)a.hasOwnProperty(f)&&(b=a[f].rec,b.address||b.members?V.result.push(b):b.contactId?V.contacts.push(b):b.groupId&&V.groups.push(b));t=this.generateDataCache(V,!0),this._resultsCache=t}var $=this._autocompleteResultsForMatches
(t,a);return this._lastSearchedPrefix=e,this._lastSearchedDataCache=t,$},loadRecentRecipients:function(){if(!CK.Autocomplete.get("isRecentsDataAvailable")){this.set("recentsDataIsLoaded",YES),this.set("recentsRequestHasCompleted",YES);return}this.sendRecentRecipientsRequest({method:"list",type:CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_RECENT_RECIPIENTS})},loadContacts:function(){this.sendContactsRequest()},sendRecentRecipientsRequest:function(e){this.set("recentsRequestIsOutstanding",YES),this.set("recentsRequestHasCompleted",NO),this.set("recentsDataIsLoaded",null);var t={onComplete:"recentRecipientsRequestCompleted",onSuccess:"recentRecipientsRequestSucceeded",type:e.type},n="/wm/recents",r=new Date;this._recentsReqCount||(this._recentsReqCount=1);var i={jsonrpc:"2.0",id:r.getTime()+"/"+this._recentsReqCount++,method:e.method};e&&e.recentsGuid&&(i.params={guids:[e.recentsGuid]});var s=CK.Request.postUrl(n,i);s.set("serviceName","mail"),s.set("useCrossDomain",YES),s.set("isJSON",YES),s.set("reportRequest",YES),s.timeoutAfter(this.INTERVAL_XHR_TIMEOUT_FOR_RECENTS_REQUEST),s.notify(0,this,this.requestDidComplete,t).send()},sendContactsRequest:function(e){this.set("contactsRequestIsOutstanding",YES),this.set("contactsRequestHasCompleted",NO),this.set("contactsDataIsLoaded",null);var t="/co/addressbook/?",n=[];CK.Autocomplete.get("includePhoneNumbers")&&n.push("includePhoneNumbers=true"),this._lastSyncToken!==null&&this._lastPrefToken!==null?(n.push("syncToken="+this._lastSyncToken),n.push("prefToken="+this._lastPrefToken),this.set("syncTokenInUse",YES)):(this.set("syncTokenInUse",
NO),SC.debug("ContactsAutocompleteDataSource sending contacts start up request."));var r={onComplete:"contactsRequestCompleted",onSuccess:"contactsRequestSucceeded",type:CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_CONTACTS};if(this.get("syncTokenInUse")&&e===YES){var i=this.get("syncInterval");if(this._skipSyncCount<i){this.invokeLater(function(){this.set("contactsRequestIsOutstanding",NO),this.set("contactsRequestHasCompleted",YES),this.set("contactsDataIsLoaded",YES),this._haveDelegatePerform("requestDidSucceed",CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_CONTACTS)},1),this._skipSyncCount++;return}SC.debug("ContactsAutocompleteDataSource sending data sync request.")}var s=this.get("delegate"),o;if(s){var u=s.get("nameDisplayOrder");u&&(this._nameDisplayOrder=u);var a=s.get("contactsSortOrder");a&&(this._sortOrder=a),o=s.get("locale")}o||(o="en_US"),n.push("order="+this._sortOrder),n.push("locale="+o),t+=n.join("&");var f=CK.CONTACTS_AUTOCOMPLETE_DEBUG_CONTACTS_FAKE_REPLY;if(f){var l=SC.Response.create(f);this.invokeLater(this.requestDidComplete,1,l,r)}else{var c=CK.ContactsAutocompleteRequest.getUrl(t);c.set("serviceName","contacts"),c.set("isJSON",NO),c.notify(0,this,this.requestDidComplete,r).send()}this._skipSyncCount=0},addContactRequest:function(e,t){this.set("contactsRequestIsOutstanding",YES),this.set("addContactRequestHasCompleted",NO);if(this._dataCache===null)this._enqueuePendingContact(e),this.sendContactsRequest();else{var n=this._buildAddContactRequest(e,t);n.send()}},_generateGUID:function(){var e=CW.UUID(),t=this._dataCache.guidToRecordMapping;while(t[e])e=CW.UUID();return e
},_buildAddContactRequestURL:function(e){var t="/co/contacts/";return e?t+=e+"/?":t+="?",this._lastSyncToken!==null&&this._lastPrefToken!==null?(this.set("syncTokenInUse",YES),t+="syncToken="+this._lastSyncToken+"&prefToken="+this._lastPrefToken):this.set("syncTokenInUse",NO),t},_buildAddContactRequest:function(e,t){var n=this._generateGUID();e.contactId=n;var r={contacts:[e]},i=this._buildAddContactRequestURL(t),s=CK.ContactsAutocompleteRequest.postUrl(i,SC.json.encode(r));s.set("serviceName","contacts"),s.set("contact",e),s.set("isJSON",NO);var o={onError:"addContactRequestFailed",onComplete:"contactsRequestCompleted",onSuccess:"addContactRequestSucceeded",type:CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_ADD_CONTACT};return s.notify(0,this,this.requestDidComplete,o),s},_sendPendingContactRequests:function(){if(this._pendingAddContacts.get("length")>0){var e=this._pendingAddContacts.popObject();this.addContactRequest(e)}},_enqueuePendingContact:function(e){this._pendingAddContacts.pushObject(e)},uploadVCard:function(e){this.set("uploadVCardDidError",NO),this.set("uploadVCardRequestHasCompleted",NO),this.set("uploadVCardFailureErrorCode",null);var t={onError:"uploadVCardRequestFailed",onComplete:"contactsRequestCompleted",onSuccess:"uploadVCardRequestSucceeded",type:CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_ADD_CONTACT},n="/co/import/card/?";this._lastSyncToken!==null&&this._lastPrefToken!==null?(this.set("syncTokenInUse",YES),n+="syncToken="+this._lastSyncToken+"&prefToken="+this._lastPrefToken):this.set("syncTokenInUse",NO);var r=CK.Request.postUrl(n);r.set("serviceName","contacts")
,r.set("isJSON",NO),r.set("body",e),r.set("reportRequest",YES),r.notify(0,this,this.requestDidComplete,t).send()},uploadVCardRequestSucceeded:function(e,t){this.set("uploadVCardRequestHasCompleted",YES),this.sendContactsRequest(),this._haveDelegatePerform("requestDidSucceed",t)},uploadVCardRequestFailed:function(e){this.set("uploadVCardDidError",YES),this.set("uploadVCardFailureErrorCode",e.get("status")),this.set("uploadVCardRequestHasCompleted",YES)},_dataCache:null,_groupsToResolve:[],_storedRecords:[],_lastSearchedPrefix:null,_lastSearchedDataCache:null,_mostRecentAutocompletionQuery:null,_sortOrder:CK.CONTACTS_AUTOCOMPLETE_SORT_ORDER_LAST_FIRST,_nameDisplayOrder:CK.CONTACTS_AUTOCOMPLETE_NAME_DISPLAY_ORDER_FIRST_LAST,_lastSyncToken:null,_lastPrefToken:null,_pendingAddContacts:[],_skipSyncCount:0,_redirectCountForTimeout:0,_redirectCount:0,MAX_REDIRECT:4,MAX_REDIRECT_FOR_TIMEOUT:1,REDIRECT_RESPONSE_TEXT:"<h1>Redirect</h1>",INTERVAL_XHR_TIMEOUT_FOR_RECENTS_REQUEST:3e4,contactsRequestCompleted:function(){this.set("contactsRequestIsOutstanding",NO)},recentRecipientsRequestCompleted:function(){this.set("recentsRequestIsOutstanding",NO)},recentRecipientsRequestSucceeded:function(e,t){this.set("recentsRequestHasCompleted",YES);if(t===CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_RECENT_RECIPIENTS){if(e&&e.result){var n=this.generateDataCache(e);this._dataCache=n}this.set("recentsDataIsLoaded",YES),this.set("allDataIsLoadedForQuery",YES),this._haveDelegatePerform("requestDidSucceed",t),this._broadcastToDataListeners(t,e)}else this.set("recentsRequestHasCompleted",NO),this._haveDelegatePerform
("deleteRecentsRequestDidSucceed",t),this._lastSearchedPrefix=null,this._lastSearchedDataCache=null},_broadcastToDataListeners:function(e,t){var n=this._dataListeners;if(n)for(var r=0,i=n.length;r<i;r++){var s=n[r];s(e,t)}},contactsRequestSucceeded:function(e,t){this.set("contactsRequestHasCompleted",YES);if(e&&e.contacts){var n=this.generateDataCache(e);this._dataCache=n,this.resolveGroupsMembershipAsPossibleWithLoadedData(n)}this.set("contactsDataIsLoaded",YES),this.set("allDataIsLoadedForQuery",YES),this._sendPendingContactRequests(),this._haveDelegatePerform("requestDidSucceed",t),this._broadcastToDataListeners(t,e)},_dataListeners:null,addDataUpdateListener:function(e){var t=this._dataListeners;t||(t=this._dataListeners=[]),t.push(e)},addContactRequestSucceeded:function(e,t){this.set("addContactDidError",NO),this.set("addContactRequestHasCompleted",YES),this.sendContactsRequest(),this._haveDelegatePerform("requestDidSucceed",t)},addContactRequestFailed:function(e,t,n){var r=e.get("status");if(r===420||r===422){var i=e.get("request"),s=i.get("contact");s&&this._enqueuePendingContact(s)}else this.set("addContactDidError",YES),this.set("addContactRequestHasCompleted",YES),n||(n=e.encodedBody()),SC.error("Autocomplete request failed with error %@",n)},requestDidComplete:function(e,t){var n=CK.CONTACTS_AUTOCOMPLETE_DEBUG_REPLY_LATENCY;n?this.invokeLater(this._requestDidComplete,n,e,t):this._requestDidComplete(e,t)},_requestDidComplete:function(e,t){var n=t.type,r=t.onComplete;r&&this.tryToPerform(r,e,n),this._haveDelegatePerform("requestDidComplete",n);var i=NO,s=e.get("status"
),o=NO,u,a,f;if(n===CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_RECENT_RECIPIENTS||n===CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_DELETE_RECENTS){var l=e.rawRequest,c=l?l.responseText:"Oops...rawRequest is "+l,h=l?l.status:0;a=e.get("body");var p=SC.typeOf(a),d=Math.floor(h/100),v=e.get("request");h===200&&(this.REDIRECT_RESPONSE_TEXT===l.responseText||p===SC.T_ERROR)&&this._redirectCount<this.MAX_REDIRECT||d===5&&this._redirectCount<this.MAX_REDIRECT||h===0&&this._redirectCountForTimeout<this.MAX_REDIRECT_FOR_TIMEOUT?(this._redirectCount++,h===0&&this._redirectCountForTimeout++,SC.warn("REJECTING SERVER RESPONSE ContactAutocompleteDataSource._requestDidComplete:\n						Status:%@\n						Request:%@\n						Wmsid:%@\n						Redirect Count:%@\n						Timeout Redirect Count:%@\n						ResponseText:%@\n						".fmt(h,v.get("address"),CK.readCookie("wmsid"),this._redirectCount,this._redirectCountForTimeout,c)),e.cancel(),v.send()):((h===200&&(this.REDIRECT_RESPONSE_TEXT===l.responseText||p===SC.T_ERROR)&&this._redirectCount===this.MAX_REDIRECT||d===5&&this._redirectCount===this.MAX_REDIRECT||h===0&&this._redirectCountForTimeout>=this.MAX_REDIRECT_FOR_TIMEOUT)&&SC.error("GIVING UP ON RETRIES, ContactAutocompleteDataSource._requestDidComplete: \nresponseText: %@, \nthis._redirectCount: %@".fmt(c,this._redirectCount)),this._redirectCount=0,this._redirectCountForTimeout=0)}var m=Math.floor(s/100)*100;if(m!==200){i=YES;if(n===CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_CONTACTS)switch(s){case 420:o=YES,SC.debug("Contacts request syncToken out of date, data refresh needed.");break;case 422:o=YES,SC.debug("Contacts request prefToken out of date, data refresh needed."
)}else n===CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_RECENT_RECIPIENTS}e.setPath("request.isJSON",YES),u=e.get("encodedBody");if(u)if(u.indexOf("<")===0)i=YES,f="CK.Autocomplete.Error.Generic";else if(o)f=u;else if(u==="not found")i=YES,f="CK.Autocomplete.Error.NotFound";else{try{a=e.get("body")}catch(g){i=YES}a?a.errorValue&&(f=a.message,i=YES):i=YES}else i=YES;if(n===CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_CONTACTS&&!i){var y=this.get("syncTokenInUse");a.syncToken?(this._lastSyncToken=a.syncToken,a.prefToken?this._lastPrefToken=a.prefToken:(i=YES,this._lastPrefToken=null,SC.warn("Autocomplete contacts response error: no prefToken found."))):y&&u==="{}"?SC.debug("ContactsAutocompleteDataSource sync response: dataCache in sync"):(i=YES,this._lastSyncToken=null,SC.warn("Autocomplete  contacts response error:  no sync token found.")),!y&&this._lastSyncToken&&this._lastPrefToken&&this.sendContactsRequest()}if(i)if(o)this._lastSyncToken=null,this._lastPrefToken=null,this.sendContactsRequest();else{f||(f="CK.Autocomplete.Error.Generic"),a&&SC.warn("Autocomplete server error:  %@",a.statusString);var b=t.onError;b?this.tryToPerform(b,e,n,f):this.requestDidError(e,n,f)}else{var w=t.onSuccess;w?this.tryToPerform(w,a,n):this.requestDidSucceed(n)}},requestDidSucceed:function(e){this._haveDelegatePerform("requestDidSucceed",e)},requestDidError:function(e,t,n){var r="Contacts";this.set("currentAutocompletionQuery",null),t===CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_RECENT_RECIPIENTS?(this.set("recentsDataIsLoaded",NO),r="Recents"):this.set("contactsDataIsLoaded",NO);var i=n;if(!i)try{i=e.get("body"
)}catch(s){i="CK.Autocomplete.Error.Generic"}var o=this._haveDelegatePerform("requestDidError",t,i);o||SC.error(r+" Autocomplete request failed with error %@",i)},generateDataCache:function(e,t){var n,r=this.__dummy_prefix__;n=this.initializeDataCache(),this._dataCache&&!t&&(e.contacts?n.recents=this._dataCache.recents:e.result&&(n.contacts=this._dataCache.contacts,n.groups=this._dataCache.groups));var i=YES,s=this.getPath("delegate.autocompleteField");s&&(i=s.get("shouldMatchGroups")),e.result&&(n=this._processRecentsRecords(e.result,n,t)),e.contacts&&(n=this._processContactsRecords(e.contacts,"Contact",n)),e.groups&&(n=this._processContactsRecords(e.groups,"ContactsGroup",n)),n.guidToRecordMapping=SC.merge(n.recents.guidToRecordMapping,n.contacts.guidToRecordMapping,n.groups.guidToRecordMapping);var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;for(o=0;o<3;++o){switch(o){case 0:p="recents",c=CK.CONTACTS_AUTOCOMPLETE_RECENT_RECIPIENTS_MATCH_FIELDS;break;case 1:p="contacts",c=CK.CONTACTS_AUTOCOMPLETE_CONTACT_MATCH_FIELDS;break;case 2:p="groups",c=CK.CONTACTS_AUTOCOMPLETE_GROUP_MATCH_FIELDS}f=n[p],d=c.length;for(u=0;u<d;++u){h=c[u],l=f[h],v=l.values,g=l.temp;if(!g)continue;v.sort(),y=[],b=v.length;for(a=0;a<b;++a)m=v[a],w=g[r+m],y.push(w);l.records=y,delete l.temp}}return n},_processContactsRecords:function(e,t,n){if(!SC.isArray(e))return SC.debug("Invalid %@ records found, cannot process.",t),n;var r=e.length,i,s,o,u,a,f,l,c,h,p,d,v,m,g=this.__dummy_prefix__;for(i=0;i<r;++i){u=e.objectAt(i),d=null;if(SC.typeOf(u)!==SC.T_HASH){SC.debug("Invalid %@ record found, skipping.",t);continue}if(t==="Contact"
){var y=u.emailAddresses,b=u.phones;for(var w=y&&y.length||0;w--;)SC.empty(y[w].field)&&y.splice(w,1);for(var w=b&&b.length||0;w--;)SC.empty(b[w].field)&&b.splice(w,1);if((!y||y.length<1)&&(!b||b.length<1))continue;d=u.normalized,a=n.contacts,l=CK.CONTACTS_AUTOCOMPLETE_CONTACT_MATCH_FIELDS,p=u.contactId}else if(t==="ContactsGroup"){if(!u.contactIds)continue;a=n.groups,l=CK.CONTACTS_AUTOCOMPLETE_GROUP_MATCH_FIELDS,p=u.groupId,h=u.name,h&&(d=h.removeDiacritics().toLowerCase()+":")}if(!d)continue;p&&(a.guidToRecordMapping[p]=u),v=d.split(":"),m=l.length;var E,S;for(s=0;s<m;++s){c=l[s];var x=u[c];if(x)if(c==="emailAddresses"){var T=x.length;for(o=0;o<T;++o){d=v[s+o];if(!d||d==="NULL")continue;f=a[c],E=f.temp,E||(E={},f.temp=E),S=E[g+d],S?S.push({idx:o,rec:u}):(E[g+d]=[{idx:o,rec:u}],f.values.push(d))}}else{d=v[s];if(!d||d==="NULL")continue;f=a[c],E=f.temp,E||(E={},f.temp=E),S=E[g+d],S?S.push(u):(E[g+d]=[u],f.values.push(d))}}}return n},_processRecentsRecords:function(e,t,n){if(!SC.isArray(e))return SC.debug("Invalid %@ records found, cannot process.","Recents"),t;var r,i,s,o,u,a,f,l,c=t.recents,h=CK.CONTACTS_AUTOCOMPLETE_RECENT_RECIPIENTS_MATCH_FIELDS,p,d,v,m=[],g,y,b,w,E,S,x,T,N,C,k=[],L,A,O="",M,_,D=this.__dummy_prefix__;if(!n){M=e.filterProperty("type","CoreMail.RecentRecipient"),_=e.filterProperty("type","CoreMail.RecentGroup"),r=M.length;for(s=0;s<r;s++){l=M[s],d=l.guid,p=l.name,A=l.address;if(!A)continue;l.recentsGuid=d,d=D+A.toLowerCase(),l.guid=d,p=p.replace(/["|“|”]/g,"").replace(/,/g," "),k=p.split(/\s+/),k.length===1&&(k=p.split(/,/)),l.names=k,c.guidToRecordMapping[d
]=l}i=_.length;for(s=0;s<i;s++){l=_[s],d=l.guid,p=l.name,y=l.members;if(y){E=y.length;for(a=0;a<E;a++){b=y[a],p=b.name,w=b.address;if(!w){SC.debug("ContactsAutocompleteDataSource: No email address found for recents group member, skipping");continue}v=D+w.toLowerCase(),b.guid=v,k=p.replace(/["|“|”]/g,"").split(/\s+/),b.isMemberOf=[{guid:d,memberName:p,memberNames:k}],T=c.guidToRecordMapping[v],T?T.isMemberOf?(T.isMemberOf.push({guid:d,memberName:p,memberNames:k}),T.names.concat(p)):T.isMemberOf=[{guid:d,memberName:p,memberNames:k}]:(b.timestamps=l.timestamps,b.names=k,b.isGroupMemberOnly=YES,M.push(b),c.guidToRecordMapping[v]=b),c.guidToRecordMapping[d]=l}}}}else M=e;S=M.length;for(a=0;a<S;a++){x=M[a],g=h.length,m=x.normalizedValues;if(!m){A=x.address,O=x.name;if(!A)continue;A=A.removeDiacritics().toLowerCase(),m=[A],this._addRecentsRecipientFieldToLookupTable("address",A,x,c);if(O){O=O.replace(/["|“|”]/g," ").trim(),x.name=O,k=O.split(/\s/),L=k.length,L===1&&(k=O.split(/,/),L=k.length);for(f=0;f<L;f++)O=k[f],m.indexOf(O)===-1&&(O=O.removeDiacritics().toLowerCase(),m.push(O),this._addRecentsRecipientFieldToLookupTable("names",O,x,c))}x.normalizedValues=m}else{for(o=0;o<g;o++){N=h[o];if(N==="names"){var P=x.names,H=P.length;for(u=0;u<H;++u)C=m[o+u],C&&this._addRecentsRecipientFieldToLookupTable("names",C,x,c)}else C=m[o],C&&this._addRecentsRecipientFieldToLookupTable(N,C,x,c)}d=x.guid,c.guidToRecordMapping[d]=x}}return t},_addRecentsRecipientFieldToLookupTable:function(e,t,n,r){var i,s,o,u=this.__dummy_prefix__;return i=r[e],s=i.temp,s||(s={},i.temp=s),o=s[u+t],o?o.push(n):(s[
u+t]=[n],i.values.push(t)),t},initializeDataCache:function(){var e={recents:{},contacts:{},groups:{},guidToRecordMapping:{},lastMatch:null};for(var t=0;t<3;++t){var n,r;switch(t){case 0:n="recents",r=CK.CONTACTS_AUTOCOMPLETE_RECENT_RECIPIENTS_MATCH_FIELDS;break;case 1:n="contacts",r=CK.CONTACTS_AUTOCOMPLETE_CONTACT_MATCH_FIELDS;break;case 2:n="groups",r=CK.CONTACTS_AUTOCOMPLETE_GROUP_MATCH_FIELDS}var i=e[n],s=r.length;for(var o=0;o<s;++o){var u=r[o];i[u]={values:[],records:[]}}i.guidToRecordMapping={}}return e},resolveGroupsMembershipAsPossibleWithLoadedData:function(e){var t=e.guidToRecordMapping;t||(t={});var n=e.groups;if(n){var r,i,s,o,u,a,f;for(r in n)if(n.hasOwnProperty(r)){i=n[r].records;if(i){s=i.length;for(a=s-1;a>=0;--a){o=i[a],u=o.length;for(f=u-1;f>=0;--f){var l=o[f];this.resolveGroupMembershipAsPossibleWithLoadedData(l,t),l.resolvedContacts.length<=0&&(delete t[l.groupId],o.splice(f,1))}}}}}},resolveGroupMembershipAsPossibleWithLoadedData:function(e,t,n){var r=e.resolvedContacts;if(r&&r!==-1)return;n||(n=0),r=[];var i={},s=e.contactIds,o;if(s){var u=s.length;for(o=u-1;o>=0;--o){var a=s[o],f=t[a];f?i[a]||(r.push(f),i[a]=YES):s.splice(o,1)}}e.resolvedContacts=r},resolveRecentRecipientWithLoadedContacts:function(e,t){if(!e)return[];var n,r,i,s;i=e.length,s=t.length;if(i<1||s<1)return[];for(n=0;n<i;n++)for(r=0;r<s;r++)if(e[n].secondaryLabel===t[r].secondaryLabel){e[n].previewValue=t[r].previewValue,e[n].primaryLabel=t[r].primaryLabel,e[n].secondaryLabel=t[r].secondaryLabel,e[n].value=t[r].value,t.splice(r,1),s=t.length;break}},_haveDelegatePerform:function(e,t,n){var r=
this.get("delegate");return r?r.tryToPerform(e,t,n):NO},_indexForString:function(e,t){var n,r=!1,i,s=0,o=e.length-1;while(!r&&s<=o){n=!1,i=Math.floor((s+o)/2);var u=e[i];u===t?r=!0:u<t?(s=i+1,n=!0):o=i-1}var a=i;return n&&++a,a},_sortRecentsResultsByTimeStamp:function(e){return e.length>1&&e.sort(function(e,t){var n=e.timestamps.length,r=t.timestamps.length;if(n>r)return-1;if(n<r)return 1;e.timestamps.sort(function(e,t){return t-e}),t.timestamps.sort(function(e,t){return t-e});var i=e.timestamps[n-1],s=t.timestamps[r-1];return i===s?0:i>s?-1:1}),e},_autocompleteResultsForMatches:function(e,t){var n=[],r=[],i=[],s={},o,u,a,f,l,c=YES,h=this.getPath("delegate.autocompleteField");h&&(c=h.get("shouldMatchGroups"));var p=e.guidToRecordMapping,d,v,m,g,y,b;for(d in t)if(t.hasOwnProperty(d)){y=t[d].rec,m=t[d].fields,y.address?(b="Recents",p=e.recents.guidToRecordMapping):y.contactId?(b="Contact",p=e.contacts.guidToRecordMapping):y.groupId&&(b="ContactsGroup",p=e.groups.guidToRecordMapping),g=p[d];if(g){v=null;if(b==="Recents"){g.isGroupMemberOnly||(v=this._autocompleteResultsForMatchedRecent(g,m),r.push(v));if(CK.Autocomplete.get("isRecentsGroupsEnabled")===YES){o=g.isMemberOf;if(o&&o.length>0){u=o.length;for(l=0;l<u;l++)a=o[l].guid,f={address:g.address,rec:g,matchedFields:m},s[a]||(s[a]=[]),s[a].push(f)}}}else if(b==="Contact"){var w=0,E=g.emailAddresses,S,x,T,N;for(N in m)m.hasOwnProperty(N)&&++w;var C=m.emailAddresses;if(w===1&&C)for(x in C)C.hasOwnProperty(x)&&(T=C[x],S=E[x],v=this._autocompleteResultsForMatchedContact(g,m,CK.ContactsAutocompleteResult.MatchType.EMAIL,S.field,S.label
,T),n.push(v));else for(l=E&&E.length||0;l--;)S=E[l],T=C?C[l]:null,v=this._autocompleteResultsForMatchedContact(g,m,CK.ContactsAutocompleteResult.MatchType.EMAIL,S.field,S.label,T),n.push(v);var k=g.phones;for(l=k&&k.length||0;l--;){var L=k[l];v=this._autocompleteResultsForMatchedContact(g,m,CK.ContactsAutocompleteResult.MatchType.PHONE,L.field,L.label,null),n.push(v)}}else{if(!c||b!=="ContactsGroup")continue;v=this._autocompleteResultsForMatchedGroup(g,m),n.push(v)}}}for(a in s)s.hasOwnProperty(a)&&(v=this._autocompleteResultForMatchedRecentsGroup(s[a],a),v&&i.push(v));return this.resolveRecentRecipientWithLoadedContacts(r,n),r.length>0&&(r=this._sortRecentsResultsByTimeStamp(r),n=r.concat(n)),i.length>0&&(i=this._sortRecentsResultsByTimeStamp(i),n=n.concat(i)),n},_autocompleteResultsForMatchedContact:function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m=e.firstName,g=e.lastName,y=e.middleName,b=e.nickname,w=e.companyName;m||(m=""),g||(g=""),b||(b=""),w||(w="");var E=t.firstName,S=t.lastName,x=t.nickname,T=t.middleName,N=t.companyName,C=E?E.length:0,k=S?S.length:0,L=x?x.length:0,A=T?T.length:0,O=N?N.length:0,M=s?s.length:0;this._nameDisplayOrder===CK.CONTACTS_AUTOCOMPLETE_NAME_DISPLAY_ORDER_LAST_FIRST&&(d=m,m=g,g=d,d=E,E=S,S=d,d=C,C=k,k=d);var _=NO;CW.stringIsCJK(m)&&CW.stringIsCJK(g)&&(_=YES);var D;e.isCompany?D=YES:D=NO;if(D){o=w,u=r,a="%@ <%@>",l=[w,r];if(O)f="%@ (%@ %@) <%@>",c=[N+w.substr(O),m,g,r];else if(C)f="%@ %@ (%@) <%@>",c=[E+m.substr(C),g,w,r];else if(k)f="%@ %@ (%@) <%@>",c=[S+g.substr(k),m,w,r];else if(L)f="%@ (%@ %@) (%@) <%@>",c=[x+b.substr(L),m,g,w,r];else if(M)
f="%@ %@ (%@ %@)",c=[s+r.substr(M),w,m,g];else if(A)f="%@ (%@ %@) (%@) <%@>",c=[T+y.substr(A),m,g,w,r];else{SC.warn("Don't know what was matched in autocomplete. This case should be handled better."),f="",c=[];for(v in t)t.hasOwnProperty(v)&&(f+="%@ ",c.push(t[v]));f+="(%@)",c.push(w)}}else{m?g?_?o=m+g:o=m+" "+g:o=m:g?o=g:o=r,o!==r&&o.indexOf(",")!==-1&&(o="“"+o+"”"),u=r,_?a="%@%@ <%@>":a="%@ %@ <%@>",l=[m,g,r];if(C&&C===m.length&&k)f="%@ %@ <%@>",c=[E,S+g.substr(k),r];else if(k&&k===g.length&&C)f="%@ %@ <%@>",c=[S,E+m.substr(C),r];else if(L&&L===b.length&&k)f="%@ %@ <%@>",c=[x+b.substr(L),S+g.substr(k),r];else if(C)f="%@ %@ <%@>",c=[E+m.substr(C),g,r];else if(k)f="%@ %@ <%@>",c=[S+g.substr(k),m,r];else if(L)f="%@ (%@ %@) <%@>",c=[x+b.substr(L),m,g,r];else if(O)f="%@ (%@ %@) <%@>",c=[N+w.substr(O),m,g,r];else if(M)f="%@ (%@ %@)",c=[s+r.substr(M),m,g];else if(A)f="%@ (%@ %@) <%@>",c=[T+y.substr(A),m,g,r];else{SC.warn("Don't know what was matched in autocomplete. This case should be handled better."),f="",c=[];for(v in t)t.hasOwnProperty(v)&&(f+="%@ ",c.push(t[v]));f=f.trim()}}h=String.prototype.fmt.apply(a,l),p=String.prototype.fmt.apply(f,c),h=h.replace("“”",""),p=p.replace("“”",""),h=h.replace(/\(\s*\)/g,""),p=p.replace(/\(\s*\)/g,""),h=h.replace(/\s+/g," "),p=p.replace(/\s+/g," "),h=h.replace(/"/g,'\\"');var P=/([^,<>]*[,<>].*)( <[^<]*)$/;h=h.replace(P,'"$1"$2');var H=CK.ContactsAutocompleteResult.create({primaryLabel:o,secondaryLabel:u,value:h,previewValue:p,matchType:n,matchValue:r,matchRecord:e,matchRecordType:CK.ContactsAutocompleteResult.MatchRecordType.CONTACT,category
:i});return H},_autocompleteResultsForMatchedRecent:function(e,t){var n,r=CK.ContactsAutocompleteResult.MatchType.EMAIL,i=e.address;SC.isArray(e.timestamps)||(e.timestamps=[]);var s,o,u,a,f,l,c,h,p,d=e.name;d.indexOf(",")===-1&&(d=d.replace(/^"/,"").replace(/"$/,"")),d||(d=""),s=d,o=i;var v=t.name;t.names&&(v=t.names);var m=v?v.length:0,g=t.address,y=g?g.length:0;d||(d=i,s=i),v?(p=this._matchedNameLabelFromMatchedNamePrefix(d,v),a="%@ <%@>",l=[v+p.substr(m),i]):(a="%@ (%@)",l=[g+i.substr(y),d]),u="%@ <%@>",f=[d,i],c=String.prototype.fmt.apply(u,f),h=String.prototype.fmt.apply(a,l),c=c.replace("“”",""),h=h.replace("“”",""),c=c.replace(/\(\s*\)/g,""),h=h.replace(/\(\s*\)/g,""),c=c.replace(/\s+/g," "),h=h.replace(/\s+/g," ");var b=/([^,<>]*[,<>].*)( <[^<]*)$/;return c=c.replace(b,'"$1"$2'),n=CK.ContactsAutocompleteResult.create({primaryLabel:s,secondaryLabel:o,value:c,previewValue:h,timestamps:e.timestamps,category:"CK.Autocomplete.Category.RECENTS".loc(),matchType:r,matchValue:i,matchRecord:e,matchRecordType:CK.ContactsAutocompleteResult.MatchRecordType.RECENT,recentsGuid:e.recentsGuid}),n},_autocompleteResultForMatchedRecentsGroup:function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p=[],d="",v=0,m,g,y=[],b,w,E,S,x,T,N,C,k,L,A,O,M=[],_,D,P,H=this._dataCache.guidToRecordMapping;n=H[t];if(!n)return null;SC.isArray(n.timestamps)||(n.timestamps=[]),o=e.length,s=n.members,a=s.length,i=e[0],m=i.matchedFields,c=i.rec,g=c.name,E=c.address,g=g.replace(/"/g,""),m.address?g!==""?g=E+" ("+g+")":g=E:(r=m.name?m.name:m.names,g=this._matchedNameLabelFromMatchedNamePrefix(g,r)),y.push(g);for(D=1;D<o;D++)
c=e[D].rec,m=e[D].matchedFields,g=c.name,E=c.address,g===""&&(g=E),g=g.replace(/"/g,""),y.push(g);b=y.join(", "),u=e.getEach("address");for(D=0;D<a;D++){f=s[D],x=f.name,T=f.address,N=H[f.guid],N&&N.names&&N.names[0]!==""?d=N.names[0]:x===""?d=T:d=x,u.indexOf(T)===-1&&(d=d.replace(/"/g,"").replace(/,/g,""),p.push(d),v++),x=x.replace(/^"/,"").replace(/"$/,""),C="%@ <%@>",k=[x,T],h=String.prototype.fmt.apply(C,k),h=h.replace("“”",""),h=h.replace(/\(\s*\)/g,""),h=h.replace(/\s+/g," ");var B=/([^,<>]*[,<>].*)( <[^<]*)$/;h=h.replace(B,'"$1"$2').trim(),M.push(h)}return p.length>0?(p.length>1&&(b+=", "),l=p.pop(),w="CK.Autocomplete.GroupMembers".loc({emailAddresses:p.join(", "),lastEmailAddress:l})):(l=y.pop(),b="CK.Autocomplete.GroupMembers".loc({emailAddresses:y.join(", "),lastEmailAddress:l}),w=""),L=b+w,_=L,O=M.join(", "),S=[b,w],P=CK.ContactsAutocompleteResult.create({matchChunks:S,primaryLabel:L,secondaryLabel:A,value:O,previewValue:_,timestamps:c.timestamps,isRecentsGroup:YES,recentsGuid:t,matchType:CK.ContactsAutocompleteResult.MatchType.GROUP,matchValue:O,matchRecord:c,matchRecordType:CK.ContactsAutocompleteResult.MatchRecordType.RECENT_GROUP}),P},_matchedNameLabelFromMatchedNamePrefix:function(e,t){t=CW.escapeRegexCharacters(t);var n,r,i,s=new RegExp(t,"i"),o=new RegExp("[\\s,]"+t,"i");if(e.search(s)===0)return e;var u=e.search(o);return u>-1?(r=e.substring(0,u),i=e.substring(u+1),n=i+" "+r):n=t+" ("+e+")",n},_autocompleteResultsForMatchedGroupLabelScores:{main:3,home:2,work:1},_autocompleteResultsForMatchedGroup:function(e,t){var n=t.name,r=n.length,i=e.name,s=e.contactIds
.length,o=null,u=e.resolvedContacts;if(u){var a=[],f=u.length;for(var l=0;l<f;++l){var c=u[l],h=c.firstName||"",p=c.lastName||"",d="",v=-1,m=c.emailAddresses,g=this._autocompleteResultsForMatchedGroupLabelScores;for(var y=m&&m.length||0;y--;){var b=m[y],w=b.label||"",E=g[w.toLowerCase()]||0;E>v&&(v=E,d=b.field)}var S=c.phones;for(var y=!d&&S&&S.length||0;y--;){var x=S[y],w=x.label||"",E=g[w.toLowerCase()]||0;E>v&&(v=E,d=x.field)}var T="%@ %@ <%@>".fmt(h,p,d);this._nameDisplayOrder===CK.CONTACTS_AUTOCOMPLETE_NAME_DISPLAY_ORDER_LAST_FIRST&&(T="%@ %@ <%@>".fmt(p,h,d)),T=T.replace("“”",""),T=T.replace(/\(\s*\)/g,""),T=T.replace(/\s+/g," "),a.push(T)}o=a.join(", ")}var N=CK.ContactsAutocompleteResult.create({primaryLabel:i,secondaryLabel:s===1?"CK.Autocomplete.GroupSecondaryLabel.Single".loc():"CK.Autocomplete.GroupSecondaryLabel.Multiple".loc(s),category:null,value:o,previewValue:n+i.substr(r)+" ("+s+")",matchValue:o,matchRecord:e,matchType:CK.ContactsAutocompleteResult.MatchType.GROUP,matchRecordType:CK.ContactsAutocompleteResult.MatchRecordType.GROUP,isContactsGroup:YES});return N}}),CK.ContactsAutocompleteDataSource.sharedInstance=function(){var e=CK.ContactsAutocompleteDataSource._sharedInstance;return e||(e=CK.ContactsAutocompleteDataSource.create(),CK.ContactsAutocompleteDataSource._sharedInstance=e),e},CK.ContactsAutocompleteController=SC.Object.extend({dataSource:CK.ContactsAutocompleteDataSource,autocompleteField:null,autocompleteItemsBinding:"*autocompleteField.autocompleteItems",autocompleteCandidateValueBinding:"*autocompleteField.autocompleteCandidateValue",excludeCurrentUserBinding
:"*autocompleteField.excludeCurrentUser",minimumCharacters:CK.CONTACTS_AUTOCOMPLETE_DEFAULT_INPUT_MINIMUM_CHARACTERS,autocompletionDelay:100,progressDisplayDelay:1e3,nameDisplayOrder:null,contactsSortOrder:CK.CONTACTS_AUTOCOMPLETE_SORT_ORDER_LAST_FIRST,keepDataInSync:YES,trace:NO,initial:"CA Initial","CA Initial":function(e){var t;switch(e.sig){case"autocompleteFieldBecameVisible":return this[this.stateKey]="CA At Least One Field Visible",CK.Statechart.EVT_TRANSITION_RES;case"autocompleteFieldWasFocused":return t=e.arg1,this.set("autocompleteField",t),CK.Statechart.handled()}return undefined}.state(),"CA At Least One Field Visible":function(e){var t,n=CK.Autocomplete.get("isRecentsDataAvailable");switch(e.sig){case"enter":return t=this.get("dataSource"),t&&(n&&!t.get("recentsRequestHasCompleted")&&!t.get("recentsRequestIsOutstanding")&&t.sendRecentRecipientsRequest({method:"list",type:CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_RECENT_RECIPIENTS}),!t.get("contactsRequestHasCompleted")&&!t.get("contactsRequestIsOutstanding")&&t.sendContactsRequest()),CK.Statechart.handled();case"defaultTransition":return t=this.get("dataSource"),t?t.get("isSearchable")?(this[this.stateKey]="CA Necessary Data Loaded",CK.Statechart.EVT_TRANSITION_RES):(this[this.stateKey]="CA Necessary Data Not Loaded",CK.Statechart.EVT_TRANSITION_RES):(SC.error("Cannot process autocomplete requests because there is no data source"),this.displayError("CK.Autocomplete.Error.Internal"),this[this.stateKey]="CA Unrecoverable Error",CK.Statechart.EVT_TRANSITION_RES);case"autocompleteFieldWasFocused":var r=e.arg1;return this
.set("autocompleteField",r),CK.Statechart.handled()}return undefined}.state(),"CA Unrecoverable Error":function(e){this.clearProgressIfDisplayed();switch(e.sig){case"autocompleteFieldWasBlurred":return this.clearErrorIfDisplayed(),CK.Statechart.handled();case"autocompleteFieldWasFocused":var t=e.arg1;return this.set("autocompleteField",t),this[this.stateKey]="CA At Least One Field Visible",CK.Statechart.EVT_TRANSITION_RES}return undefined}.state(),"CA Necessary Data Loaded":function(e){var t,n,r=this.get("dataSource");switch(e.sig){case"enter":return this.clearProgressIfDisplayed(),t=this.get("autocompleteCandidate"),t&&(this.get("_autocompletionTimer")||this.scheduleLookupTimer()),r&&CK.Autocomplete.get("isRecentsDataAvailable")&&(!r.get("recentsRequestHasCompleted")&&!r.get("recentsRequestIsOutstanding")&&r.sendRecentRecipientsRequest({method:"list",type:CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_RECENT_RECIPIENTS}),!r.get("contactsRequestHasCompleted")&&!r.get("contactsRequestIsOutstanding")&&r.sendContactsRequest()),CK.Statechart.handled();case"autocompleteFieldWasFocused":return r&&this.get("keepDataInSync")&&!r.get("contactsRequestIsOutstanding")&&r.sendContactsRequest(YES),n=e.arg1,this.set("autocompleteField",n),this[this.stateKey]="CA At Least One Field Visible",CK.Statechart.EVT_TRANSITION_RES;case"searchNarrowed":return t=this.get("autocompleteCandidate"),t&&(this.invalidateScheduledLookupTimer(),this.scheduleLookupTimer()),CK.Statechart.handled();case"searchWidened":return this.invalidateScheduledLookupTimer(),t=this.get("autocompleteCandidate"),t&&this.scheduleLookupTimer
(),CK.Statechart.handled();case"lookupTimerFired":return this[this.stateKey]="CA Searching Loaded Data",CK.Statechart.EVT_TRANSITION_RES}return undefined}.state("CA At Least One Field Visible"),"CA Searching Loaded Data":function(e){var t,n;switch(e.sig){case"enter":return this.invalidateScheduledLookupTimer(),this.performSearchOfLoadedData(),CK.Statechart.handled();case"searchNarrowed":return this.performSearchOfLoadedData(),CK.Statechart.handled();case"searchWidened":this.invalidateScheduledLookupTimer(),t=this.get("autocompleteField"),t&&t.hideAutocompleteMenuPane(),this.set("autocompleteItems",null),n=this.get("dataSource");if(n){if(n.get("isSearchable"))return this[this.stateKey]="CA Necessary Data Loaded",CK.Statechart.EVT_TRANSITION_RES;var r=n.get("allDataIsLoadedForQuery"),i=this.get("autocompleteCandidate");if(i){i=i.removeDiacritics().toLowerCase().split(" ")[0];if(i.indexOf(r)===0)return this[this.stateKey]="CA Searching Loaded Data",CK.Statechart.EVT_TRANSITION_RES}}return this[this.stateKey]="CA Necessary Data Not Loaded",CK.Statechart.EVT_TRANSITION_RES;case"autocompleteFieldWasFocused":return t=e.arg1,this.set("autocompleteField",t),CK.Statechart.handled();case"deleteRecentsButtonWasPressed":var s=e.arg1;return n=this.get("dataSource"),n&&s&&n.sendRecentRecipientsRequest({method:"delete",recentsGuid:s,type:CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_DELETE_RECENTS}),CK.Statechart.handled();case"deleteRecentsRequestDidSucceed":return this[this.stateKey]="CA Necessary Data Not Loaded",CK.Statechart.EVT_TRANSITION_RES}return undefined}.state("CA Necessary Data Loaded"
),"CA Necessary Data Not Loaded":function(e){var t=this.get("dataSource"),n=CK.Autocomplete.get("isRecentsDataAvailable"),r,i,s,o,u,a;t&&(r=t.get("recentsRequestHasCompleted"),i=t.get("recentsRequestIsOutstanding"),s=t.get("contactsRequestHasCompleted"),o=t.get("contactsRequestIsOutstanding"));switch(e.sig){case"enter":if(t)return n&&!r&&!i&&t.sendRecentRecipientsRequest({method:"list",type:CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_RECENT_RECIPIENTS}),!s&&!o&&t.sendContactsRequest(),CK.Statechart.handled();return u=this.get("autocompleteCandidate"),u&&(this.get("_autocompletionTimer")||this.scheduleLookupTimer()),CK.Statechart.handled();case"searchNarrowed":return u=this.get("autocompleteCandidate"),u&&(this.invalidateScheduledLookupTimer(),this.scheduleLookupTimer()),CK.Statechart.handled();case"searchWidened":return this.invalidateScheduledLookupTimer(),u=this.get("autocompleteCandidate"),u&&this.scheduleLookupTimer(),CK.Statechart.handled();case"lookupTimerFired":u=this.get("autocompleteCandidate");if(u){var f=this.getPath("dataSource.allDataIsLoadedForQuery");u=u.removeDiacritics().toLowerCase().split(" ")[0];if(f&&u.indexOf(f)===0)return this[this.stateKey]="CA Necessary Data Loaded",CK.Statechart.EVT_TRANSITION_RES}return CK.Statechart.handled();case"autocompleteFieldWasFocused":var l=e.arg1;return this.set("autocompleteField",l),this[this.stateKey]="CA Necessary Data Not Loaded",CK.Statechart.EVT_TRANSITION_RES;case"requestDidSucceed":a=e.arg1;if(a===CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_CONTACTS)return t=this.get("dataSource"),t?t.get("isSearchable")?(this[this.stateKey]="CA Necessary Data Loaded"
,CK.Statechart.EVT_TRANSITION_RES):CK.Statechart.handled():(SC.error("Cannot process autocomplete requests because there is no data source"),this.displayError("CK.Autocomplete.Error.Internal"),this[this.stateKey]="CA Unrecoverable Error",CK.Statechart.EVT_TRANSITION_RES);if(a!==CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_RECENT_RECIPIENTS)return a===CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_LOOKUP?(SC.error("We should never receive a reply to a lookup request while in the 'CA Necessary Data Not Loaded' state"),this[this.stateKey]="CA Unrecoverable Error",CK.Statechart.EVT_TRANSITION_RES):(SC.error("Unknown autocomplete request type:  “%@”",a),this[this.stateKey]="CA Unrecoverable Error",CK.Statechart.EVT_TRANSITION_RES);t=this.get("dataSource");if(t)return t.get("isSearchable")?(this[this.stateKey]="CA Necessary Data Loaded",CK.Statechart.EVT_TRANSITION_RES):CK.Statechart.handled();return CK.Statechart.handled();case"requestDidError":a=e.arg1;if(a===CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_CONTACTS){if(n&&r)return this[this.stateKey]="CA Necessary Data Loaded",CK.Statechart.EVT_TRANSITION_RES;if(!n||!i)return this.displayError(e.arg2),this[this.stateKey]="CA Unrecoverable Error",CK.Statechart.EVT_TRANSITION_RES}else{if(a===CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_LOOKUP)return SC.error("We should never receive an error report for a lookup request while in the 'CA Necessary Data Not Loaded' state"),this[this.stateKey]="CA Unrecoverable Error",CK.Statechart.EVT_TRANSITION_RES;if(a!==CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_RECENT_RECIPIENTS)return SC.error("Unknown autocomplete request type:  “%@”"
,a),this[this.stateKey]="CA Unrecoverable Error",CK.Statechart.EVT_TRANSITION_RES;if(s)return this[this.stateKey]="CA Necessary Data Loaded",CK.Statechart.EVT_TRANSITION_RES;if(!o)return SC.error("Recents recipients request error."),this[this.stateKey]="CA Unrecoverable Error",CK.Statechart.EVT_TRANSITION_RES}return CK.Statechart.handled()}return undefined}.state("CA At Least One Field Visible"),_previousAutocompleteCandidateValue:null,_lastSentAutocompletionCandidate:null,_autocompletionTimer:null,init:function(){arguments.callee.base.apply(this,arguments);var e=this.get("dataSource");e&&e.isClass&&(e=e.create(),this.set("dataSource",e),e.set("delegate",this));var t=CloudOS.getAppPreferences("contacts"),n=CK.getCurrentLocaleInISOFormat(),r,i;n||(n="en_US"),t&&(t.displayOrderBy&&(i=t.displayOrderBy),t.displayFields?(r=t.displayFields,r!==CK.CONTACTS_AUTOCOMPLETE_NAME_DISPLAY_ORDER_LAST_FIRST&&r!==CK.CONTACTS_AUTOCOMPLETE_NAME_DISPLAY_ORDER_FIRST_LAST&&(r=CK.CONTACTS_AUTOCOMPLETE_NAME_DISPLAY_ORDER_FIRST_LAST)):n==="ja_JP"||n==="ko_KR"||n==="zh_CN"||n==="zh_TW"||n==="hu_HU"?(i=CK.CONTACTS_AUTOCOMPLETE_SORT_ORDER_FIRST_LAST,r=CK.CONTACTS_AUTOCOMPLETE_NAME_DISPLAY_ORDER_LAST_FIRST):(i=CK.CONTACTS_AUTOCOMPLETE_SORT_ORDER_LAST_FIRST,r=CK.CONTACTS_AUTOCOMPLETE_NAME_DISPLAY_ORDER_FIRST_LAST)),this.set("contactsSortOrder",i),this.set("nameDisplayOrder",r),this.set("locale",n),SC.debug("ContactsAutocomplete name order preference set: '%@'",r)},autocompleteFieldDidChange:function(){this.set("_previousAutocompleteCandidateValue",null),this.set("_autocompletionTimer",null),this.set("_lastSentAutocompletionCandidate"
,null),this.notifyPropertyChange("autocompleteCandidateValue")}.observes("autocompleteField"),autocompleteCandidate:function(){var e=this.get("autocompleteCandidateValue"),t=this.get("minimumCharacters");return e&&e.length>=t?e:null}.property("autocompleteCandidateValue","minimumCharacters").cacheable(),autocompleteCandidateValueDidChange:function(){var e=this.get("autocompleteCandidateValue"),t=this.get("_previousAutocompleteCandidateValue");t?e&&t.length<e.length&&e.indexOf(t)===0?this.tryToPerform("searchNarrowed"):e&&t.indexOf(e)===-1&&e.indexOf(t)===-1?this.tryToPerform("searchNarrowed"):this.tryToPerform("searchWidened"):e&&e.length>0&&this.tryToPerform("searchNarrowed"),this.set("_previousAutocompleteCandidateValue",e)}.observes("autocompleteCandidateValue"),scheduleLookupTimer:function(){this.get("_autocompletionTimer")&&SC.warn("Scheduling a new autocompletion timer even though a previous timer was scheduled");var e=SC.Timer.schedule({target:this,action:"lookupTimerDidFire",interval:this.get("autocompletionDelay"),repeats:NO});this.set("_autocompletionTimer",e)},invalidateScheduledLookupTimer:function(){var e=this.get("_autocompletionTimer");e&&e.invalidate(),this.set("_autocompletionTimer",null)},scheduleProgressDisplayTimer:function(){SC.Timer.schedule({target:this,action:"progressDisplayTimerFired",interval:this.get("progressDisplayDelay"),repeats:NO})},displayError:function(e){var t;e&&(SC.typeOf(e)===SC.T_STRING?t=e.loc():e.kindOf&&e.kindOf(SC.Error)?(t=e.get("description"),t||(t="CK.Autocomplete.Error.Generic"),t=t.loc()):e.toString&&(t=e.toString().loc())),t||
(t="CK.Autocomplete.Error.Generic".loc());var n=this.get("autocompleteField");n&&n.set("errorMessage",t)},clearErrorIfDisplayed:function(){var e=this.get("autocompleteField");e&&e.set("errorMessage",null)},displayProgress:function(){var e=null,t=this.get("autocompleteCandidateValue"),n;t&&(e="CK.Autocomplete.SearchingProgress".loc(t)),n=this.get("autocompleteField"),n&&(n.setIfChanged("progressMessage",e),n.setIfChanged("progressIndicatorIsVisible",!!e))},progressIsDisplayed:function(){return!!this.getPath("autocompleteField.progressMessage")},updateProgressIfDisplayed:function(){this.progressIsDisplayed()&&this.displayProgress()},clearProgressIfDisplayed:function(){var e=this.get("autocompleteField");e&&(e.set("progressMessage",null),e.set("progressIndicatorIsVisible",NO))},lookupTimerDidFire:function(e){if(this.get("_autocompletionTimer")!==e){SC.warn("Ignoring lookup timer that is not current:  %@",e);return}this.set("_autocompletionTimer",null);var t=this.get("autocompleteField");t&&(t.get("isProcessingKeyEvent")?(this.invalidateScheduledLookupTimer(),this.scheduleLookupTimer()):SC.RootResponder.responder.sendAction("lookupTimerFired",this))},performSearchOfLoadedData:function(){var e=this.get("autocompleteCandidateValue");if(e){var t=this.get("dataSource"),n,r,i,s;if(t){i=t.findCompletionsInLoadedData(e);var o=CloudOS.getUser();if(this.get("excludeCurrentUser")&&i&&o){s=i.length;for(n=0;n<s;n++){r=i[n];var u=r.get("matchValue")||"";o.isMyEmailAddressOrPhoneNumber(u.toLowerCase())&&(i.splice(n--,1),--s,SC.debug("%@: Omitted '%@' from autocomplete search results",this,r.value
))}}this.set("autocompleteItems",i)}}},lookupTimerFired:function(){},progressDisplayTimerFired:function(){}}),CK.ContactsAutocompleteController.sharedInstance=function(){var e=CK.ContactsAutocompleteController._sharedInstance;return e||(e=CK.ContactsAutocompleteController.create(),CK.ContactsAutocompleteController._sharedInstance=e),e},CK.ContactsAutocompleteController.sharedController=CK.ContactsAutocompleteController.sharedInstance,CK.KnownContactsController=SC.Object.extend({emailOrPhoneNumberIsKnown:function(e){if(!this.get("isDataLoaded"))return undefined;e=(e||"").toLowerCase();var t=this.get("_knownEmails");if(t[e])return!0;if(this.isKnownPhoneNumber(e))return!0;var n=e.lastIndexOf("@"),r=e.substring(0,n),i=e.substring(n+1);return i==="icloud.com"?!!t[r+"@mac.com"]||!!t[r+"@me.com"]:i==="mac.com"?!!t[r+"@icloud.com"]||!!t[r+"@me.com"]:i==="me.com"?!!t[r+"@icloud.com"]||!!t[r+"@mac.com"]:undefined},isKnownPhoneNumber:function(e){e=CK.normalizePhoneNumber(e);if(!CK.matchesFormatOfPhoneNumber(e))return!1;var t=this.get("_knownPhoneNumbers");if(t[e])return!0;var n=CK.PhoneNumbers.CountryCode;if(!n)return!1;for(var r in n)if(e.startsWith(r)){var i=e.substr(r.length);if(CK.matchesFormatOfPhoneNumber(i)&&t[i])return!0}return!1},loadData:function(){var e=this.get("dataSource");e.loadContacts(),e.loadRecentRecipients()},isDataLoaded:NO,dataSource:null,handleDataUpdates:function(e,t){var n=this._knownEmails||(this._knownEmails={}),r=this._knownPhoneNumbers||(this._knownPhoneNumbers={}),i=t.result,s=t.contacts,o=CK.Autocomplete.get("includePhoneNumbers");if(e===CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_RECENT_RECIPIENTS&&
i)for(var u=0,a=i.length;u<a;u++){var f=i[u];f.type==="CoreMail.RecentRecipient"?n[(f.address||"").toLowerCase()]=!0:f.type==="CoreMail.RecentGroup"&&f.members.forEach(function(e){n[(e.address||"").toLowerCase()]=!0})}else if(e===CK.CONTACTS_AUTOCOMPLETE_REQUEST_TYPE_CONTACTS&&s&&t.encodedBody!=="{}")for(var u=0,l=s.length;u<l;u++){var c=s[u],h=c.emailAddresses;if(h)for(var p=0,d=h.length;p<d;p++){var v=h[p];n[v.field]=!0}var m=c.phones;if(m&&o)for(var p=m.length;p--;){var g=m[p];g=CK.normalizePhoneNumber(g&&g.field),CK.matchesFormatOfPhoneNumber(g)&&(r[g]=!0)}}var y=this.get("dataSource");y&&y.get("recentsDataIsLoaded")&&y.get("contactsDataIsLoaded")&&this.set("isDataLoaded",YES)},_knownEmails:null,_knownPhoneNumbers:null}),CK.KnownContactsController.sharedInstance=function(){var e=CK.KnownContactsController._sharedInstance;if(!e){e=CK.KnownContactsController.create();var t=CK.ContactsAutocompleteDataSource.sharedInstance();t.addDataUpdateListener(e.handleDataUpdates.bind(e)),e.set("dataSource",t),CK.KnownContactsController._sharedInstance=e}return e},CK.AutocompleteActionDelegate={autocompleteMenuItemWasChosen:function(e){}},CK.AutocompleteMenuItemView=SC.MenuItemView.extend({classNames:["ck-ac-menu-item"],isAutocompleteMenuItem:YES,isDeleteButtonActive:NO,menuType:function(){return this.getPath("parentMenu.currentMenuType")}.property(".parentMenu.currentMenuType").cacheable(),showCategory:function(){return this.getPath("parentMenu.showCategories")}.property(".parentMenu.Categories").cacheable(),acceptsFirstResponder:NO,isSelected:NO,isDeleteRecentInProgress:NO,displayProperties
:["isSelected","showCategory","isDeleteRecentInProgress","isDeleteButtonActive","content.isICloudMember"],render:function(e){arguments.callee.base.apply(this,arguments),this.get("isSelected")&&e.addClass("focus");var t=this.get("content");if(!t)return;var n=!1;t.get("isICloudMemberState")===CK.MicroResourceContainer.LoadStatus.LOADED&&(n=t.get("isICloudMember")),e.setClass("is-icloud-member",n);var r=t.get("category");if(CK.Autocomplete.get("isRecentsGroupsEnabled")){e.addClass("has-border");var i,s;if(t.get("isRecentsGroup")||r==="CK.Autocomplete.Category.RECENTS".loc())s="recents-delete-button",e.addClass("has-delete-button"),this.get("isDeleteButtonActive")===YES?s+=" active":s+=" hide-delete-button",i='<div role="button" tabindex="0" class="'+s+'" style="right: 5px; width: 35px; top: 4px; height: 25px">',s="img delete-item",this.get("isDeleteRecentInProgress")===YES&&(s+=" ck-ac-progress-indicator"),i+='<div class="'+s+'"></div></div>',e.push(i)}(!this.get("showCategory")||!r)&&e.addClass("no-category")},renderLabel:function(e){var t=this.get("content"),n=t.get("localizedCategory"),r=t.get("isRecentsGroup"),i="value primary-label",s=SC.RenderContext.escapeHTML,o,u,a,f,l,c,h,p,d;r&&(i="value recents-group-label",h=YES),l=t.get("matchChunks");if(l){f="<span class='"+i+"'>",h=YES;for(p=0,d=l.length;p<d;++p)c=l.objectAt(p),c&&(c=s(c),h?f+="<strong>"+c+"</strong>":f+=c),h=!h;f+="</span>",e.push(f)}else(o=t.get("primaryLabel"))?(o=s(o),e.push("<span class='"+i+"'>"+o+"</span>")):(a=t.get("title"),a&&(a=s(a),e.push("<span class='"+i+"'>"+a+"</span>")));n&&(n=s(n),e.push("<span class='category'>"+
n+"</span>")),u=t.get("secondaryLabel"),u&&(u=s(u),e.push("<span class='secondary-label'>"+u+"</span>"))},mouseEntered:function(){var e=this.get("parentMenu");e&&e.get("mouseIsDown")===YES&&this.get("isEnabled")&&!this.isSeparator()&&e.set("currentMenuItem",this);var t=this.$(".recents-delete-button");return t&&(t.removeClass("hide-delete-button"),t.addClass("show-delete-button")),YES},mouseExited:function(){var e=this.$(".recents-delete-button");return e&&(e.removeClass("show-delete-button"),e.addClass("hide-delete-button")),YES},mouseMoved:function(e){if(this._isMouseDownOnDeleteButton===YES){var t=e.target,n=t.className;n&&n.indexOf("delete-item")===-1?this.set("isDeleteButtonActive",NO):this.set("isDeleteButtonActive",YES)}return YES},mouseDown:function(e){if(!this.get("isEnabled"))return NO;var t=this.get("parentMenu"),n=e.target,r=n.className;return t&&(r&&(r.indexOf("delete-item")>-1||r.indexOf("recents-delete-button")>-1)?(this.set("isDeleteButtonActive",YES),this._isMouseDownOnDeleteButton=YES):(t.set("mouseIsDown",YES),t.set("currentMenuItem",this))),YES},mouseUp:function(e){var t=this.get("parentMenu"),n=e.target,r=n.className,i;if(t){if(this._isMouseDownOnDeleteButton===YES)return this.$().within(n)&&r&&(r.indexOf("delete-item")>-1||r.indexOf("recents-delete-button")>-1)&&t.removeRecentsMenuItem(this),this.set("isDeleteButtonActive",NO),this._isMouseDownOnDeleteButton=NO,YES;t.set("mouseIsDown",NO)}return i=this.getPath("parentMenu.rootMenu.targetMenuItem"),i&&i.performAction(YES),YES}}),CK.AUTOCOMPLETE_MODE_SINGLE=1,CK.AUTOCOMPLETE_MODE_MULTIPLE=2,CK.AUTOCOMPLETE_MENU_TYPE_AUTO=11
,CK.AUTOCOMPLETE_MENU_TYPE_SINGLE_LINE=12,CK.AUTOCOMPLETE_MENU_TYPE_DOUBLE_LINE=13,CK.AutocompleteMenuPane=CW.SquareMenuPane.extend({classNames:["ck-ac-menu"],delegate:null,menuType:CK.AUTOCOMPLETE_MENU_TYPE_AUTO,showCategories:YES,exampleView:CK.AutocompleteMenuItemView,width:null,singleLineItemHeight:35,doubleLineItemHeight:47,localize:NO,action:"menuItemChosen",acceptsMenuPane:NO,acceptsKeyPane:NO,mouseIsDown:NO,layout:{top:30,left:30,bottom:30,right:30},currentMenuType:null,displayProperties:["currentMenuType"],menuItemPreloadPageSize:8,menuItemPreloadLookAround:4,currentMenuTypeDidChange:function(){this._updateMenuItemsAndLayoutIfNeeded()}.observes("currentMenuType"),_updateMenuItemsAndLayoutIfNeeded:function(){var e=this._previousMenuType,t=this.get("currentMenuType");this._previousMenuType=t;if(e===t&&this.get("displayItemsHaveRecentsGroups")===NO)return;var n=this.get("items");if(!n||n.length===0)return;var r=this.get("menuItemViews"),i=this.get("currentMenuItem"),s=this.getPath("childViews.0");if(s){if(i){var o=r.indexOf(i);o!==-1&&(this._beforeTypeChangeSelectedItemIndex=o)}this._beforeTypeChangeVerticalScrollOffset=s.get("verticalScrollOffset")}this.notifyPropertyChange("menuItemViews"),this._sc_menu_itemsDidChange(),this.menuItemsVisibilityDidChange()},itemHeight:function(){var e=this.get("currentMenuType");return e===CK.AUTOCOMPLETE_MENU_TYPE_DOUBLE_LINE?this.get("doubleLineItemHeight"):this.get("singleLineItemHeight")}.property("currentMenuType").cacheable(),showCategoriesDidChange:function(){var e=this.get("menuItemViews"),t,n,r;for(t=0,n=e.length;t<n;++t)r=e[
t],r.notifyPropertyChange("showCategory")}.observes("showCategories"),displayItemsHaveRecentsGroups:function(){if(CK.Autocomplete.get("isRecentsGroupsEnabled")){var e=this.get("displayItems");if(e)for(var t=0,n=e.get("length");t<n;t++)if(e[t].get("isRecentsGroup")===YES)return YES}return NO}.property("displayItems").cacheable(),menuItemsVisibilityDidChange:function(){var e=this.get("scrollView"),t=e.get("verticalScrollOffset"),n=this.$().height(),r=this.get("itemHeight"),i=this.get("items"),s=i&&i.get("length")||0,o=Math.floor(t/r),u=Math.ceil((t+n)/r),a=this.get("menuItemPreloadLookAround");o=Math.max(o-a,0),u=Math.min(u+a,s);var f=this.get("menuItemPreloadPageSize")||1;o=Math.max(o-o%f,0),u=Math.min(u-u%f+f,s);var l=this._menuItemVisibilityMinIndex,c=this._menuItemVisibilityMaxIndex;this._menuItemVisibilityMinIndex=o,this._menuItemVisibilityMaxIndex=u;if(l===undefined||c===undefined){for(var h=o;h<u;++h)this.menuItemWillShow(i.objectAt(h),h);return}for(var h=l;h<o;++h)this.menuItemWillHide(i.objectAt(h),h);for(var h=o;h<l;++h)this.menuItemWillShow(i.objectAt(h),h);for(var h=c;h<u;++h)this.menuItemWillShow(i.objectAt(h),h);for(var h=u;h<c;++h)this.menuItemWillHide(i.objectAt(h),h)},menuItemWillShow:function(e,t){},menuItemWillHide:function(e,t){},didScroll:function(){this.menuItemsVisibilityDidChange()}.observes("scrollView.verticalScrollOffset"),didAppendToDocument:function(){this.menuItemsVisibilityDidChange()},init:function(){arguments.callee.base.apply(this,arguments),this.set("target",this),this.menuTypeDidChange()},render:function(e){arguments.callee.base.apply(this,arguments
);var t=this.get("currentMenuType");t===CK.AUTOCOMPLETE_MENU_TYPE_SINGLE_LINE?e.addClass("single-line"):t===CK.AUTOCOMPLETE_MENU_TYPE_DOUBLE_LINE?e.addClass("double-line"):(SC.error("Unexpected autocomplete menu type:  %@",t),e.addClass("single-line"))},menuTypeDidChange:function(){var e=this.get("menuType");e!==CK.AUTOCOMPLETE_MENU_TYPE_AUTO&&this.set("currentMenuType",e),this.get("isVisibleInWindow")&&this.positionPane()}.observes("menuType"),createChildViews:function(){var e,t,n;return e=this.createChildView(SC.ScrollView.extend({hasHorizontalScroller:NO,autohidesVerticalScroller:YES,hasVerticalScroller:YES,borderStyle:SC.BORDER_NONE,verticalScrollerView:CW.FadingCaplessScrollerView})),t=this._menuView=SC.View.create(),n=this.get("menuItemViews"),t.set("layout",{top:0,left:0,height:this.get("menuHeight")}),t.replaceAllChildren(n),e.set("contentView",t),this.set("scrollView",e),this.childViews=[e],this},menuItemViews:function(){return!this.get("currentMenuType")&&this.get("menuType")===CK.AUTOCOMPLETE_MENU_TYPE_AUTO?[]:arguments.callee.base.apply(this,arguments)}.property("displayItems").cacheable(),createMenuItemViews:function(){if(this.get("displayItemsHaveRecentsGroups")){var e=this.get("displayItems"),t;e=e.filterProperty("isRecentsGroup",YES);var n=51,r=this.get("itemHeight");t="max-width: "+(this.get("anchorWidth")-n)+"px;",SC.prepareStringMeasurement(t,"recents-group-label-string-measure");for(var i=0,s=e.get("length"),o,u,a,f,l,c=SC.RenderContext.escapeHTML,h;i<s;i++){o=e[i],u="",a=o.matchChunks,l=a.length;if(l>0){f=YES;for(var p=0,d;p<l;p++)d=a[p],d=c(d),f?u=u+"<strong>"+
d+"</strong>":u+=d,f=!f}else u=c(o.primaryLabel);h=SC.measureString(u,YES).height,h>r?o.height=h:o.hasOwnProperty("height")&&delete o.height}SC.teardownStringMeasurement()}return arguments.callee.base.apply(this,arguments)},menuItemViewsDidChange:function(){var e=this.get("menuItemViews");if(e&&e.length>0){var t=this._beforeTypeChangeVerticalScrollOffset;t&&this.setPath("childViews.0.verticalScrollOffset",t),this._beforeTypeChangeVerticalScrollOffset=null;var n=this._beforeTypeChangeSelectedItemIndex;n?this.selectMenuItemAtIndexIfAppropriate(n):this.selectMenuItemAtIndexIfAppropriate(0)}this._beforeTypeChangeVerticalScrollOffset=undefined,this._beforeTypeChangeSelectedItemIndex=undefined}.observes("menuItemViews"),menuHeightDidChange:function(){var e=this.get("menuHeight"),t=this._previousMenuHeight;e!==t&&(this.get("isVisibleInWindow")&&this.positionPane(),this._previousMenuHeight=e)}.observes("menuHeight"),selectMenuItemAtIndexIfAppropriate:function(e){var t=this.get("menuItemViews");if(t&&t.length>0){var n=t.objectAt(e);n.get("isEnabled")&&this.set("currentMenuItem",n)}},currentMenuItemObserver:function(){if(!this.get("currentMenuType"))return;var e=this.get("currentMenuItem");if(!e)return;var t=this.get("previousMenuItem");t&&e!==t&&t.set("isSelected",NO),e.set("isSelected",YES);var n=this.get("childViews");if(n){var r=n[0];r&&r.scrollToVisible&&r.scrollToVisible(e)}this.invokeLast(this._notifyDelegateThatSelectedMenuItemChanged)}.observes("currentMenuItem"),_notifyDelegateThatSelectedMenuItemChanged:function(){var e=this.get("delegate"),t=this.getPath("currentMenuItem.content"
);e&&e.tryToPerform("selectedMenuItemDidChange",t)},menuItemChosen:function(e){var t=this.get("delegate");if(t){var n=e.get("selectedItem");t.tryToPerform("menuItemWasChosen",n)}},remove:function(){arguments.callee.base.apply(this,arguments);var e=this.get("delegate");e&&e.tryToPerform("autocompleteMenuWasHidden")},removeRecentsMenuItem:function(e){var t="CK.Autocomplete.Recents.Delete.Title".loc(),n=e.get("content"),r=n.get("recentsGuid"),i=this.get("delegate"),s={},o;n.get("isRecentsGroup")===YES?o="CK.Autocomplete.Recents.Delete.Group.Text":o="CK.Autocomplete.Recents.Delete.Recipient.Text",o=o.loc(),s.rightButton={title:t,action:function(){e.set("isDeleteRecentInProgress",YES),i.removeRecentsItem(r);var t=this.get("pane");t&&t.remove()}},s.middleButton="Button.Cancel".loc(),s.message=t,s.description=o,s.escapeHTML=YES,CW.Alert.show(s)},modalPaneDidClick:function(){var e=this.get("delegate");return e&&e.tryToPerform("chooseSelectedAutocompleteItemIfAppropriate"),arguments.callee.base.apply(this,arguments)},popup:function(e){this.set("anchor",e),arguments.callee.base.apply(this,arguments)},positionPane:function(){if(this._currentlyPositioning)return this;this._currentlyPositioning=YES;var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y=this.get("anchor");if(y){y.isView?y.get("useStaticLayout")||y.getPath("parentView.useStaticLayout")?s=this.computeAnchorRect(y.get("layer")):(g=y.get("parentView"),s=g?g.convertFrameToView(y.get("frame"),null):y.get("frame")):s=this.computeAnchorRect(y),o=SC.cloneRect(s),t=this.get("currentWindowSize")||SC.RootResponder.responder.computeWindowSize(),n=
t.width,r=t.height,f=this.get("width"),f||(f=s.width||0),this.set("anchorWidth",f),l=1,c=4,f-=2,u=o.x,u+=l,h=n-(u+f+c),h<0&&(f+=h),e=this.get("menuType"),e===CK.AUTOCOMPLETE_MENU_TYPE_AUTO&&(f<=440?this.set("currentMenuType",CK.AUTOCOMPLETE_MENU_TYPE_DOUBLE_LINE):this.set("currentMenuType",CK.AUTOCOMPLETE_MENU_TYPE_SINGLE_LINE),this._updateMenuItemsAndLayoutIfNeeded()),e=this.get("currentMenuType"),e===CK.AUTOCOMPLETE_MENU_TYPE_SINGLE_LINE?p=this.get("showCategories")?"CK.Autocomplete.Menu.SingleLine.WithCategories.minWidth".locMetric():"CK.Autocomplete.Menu.SingleLine.NoCategories.minWidth".locMetric():p="CK.Autocomplete.Menu.DoubleLine.minWidth".locMetric(),h=n-(p+l+c),h<0&&(p+=h),a=f>p?f:p,h=n-(u+a+c),h<0&&(u+=h);var b=this.get("itemHeight"),w=this.get("menuHeightPadding"),E=3*b+w,S=10*b+w,x=this.get("menuItemViews"),T=0,N=0;x&&(N=x.get("length"),N&&(T=N)),m=this.get("menuHeight"),m=m<=S?m:S;var C=s.y,k=SC.maxY(s),L=2,A,O;k+E<r?A=YES:C>r-k?A=NO:A=YES,A?(o.y=k,r-k>=m?O=m:(d=r-k-w-L,i=Math.floor(d/b),O=i*b)):(m<C?O=m:(d=C-L-w,i=Math.floor(d/b),O=i*b),v=O+w+L,o.y=C-v+w+L),o.height=O;var M={width:a,height:o.height,left:u,top:o.y};this.adjust(M)}else SC.warn("Cannot position autocomplete menu without an anchor element.");return this._currentlyPositioning=NO,this},windowSizeDidChange:function(){SC.Pane.prototype.windowSizeDidChange.call(this),this.positionPane()},mouseExited:function(){return YES}}),CK.AutocompleteField={autocompleteDelegate:CK.ContactsAutocompleteController,autocompleteItems:null,autocompleteMenuClass:CK.AutocompleteMenuPane,autocompleteActionDelegate:null,autocompleteMode
:CK.AUTOCOMPLETE_MODE_MULTIPLE,shouldMatchGroups:YES,progressIndicatorIsVisible:NO,progressMessage:null,errorMessage:null,isProcessingKeyEvent:NO,spellCheckEnabled:NO,excludeCurrentUser:NO,autocompleteMenuIsVisible:function(){var e=this.get("autocompleteMenuPane");return e?e.get("isVisibleInWindow"):NO}.property(),init:function(){arguments.callee.base.apply(this,arguments);var e=this.get("autocompleteDelegate");if(e&&e.isClass){var t=e.sharedInstance;t?e=t():e=e.create(),this.set("autocompleteDelegate",e)}this.autocompleteItemsDidChange()},destroy:function(){this.destroyAutocompleteMenuPane(),arguments.callee.base.apply(this,arguments)},messageObserver:function(){this.updateAutocompleteMenuPane(),this.updateIndicatorViews()}.observes("progressIndicatorIsVisible","progressMessage","errorMessage"),updateAutocompleteMenuPane:function(){if(!this.get("isVisibleInWindow"))return;var e,t,n,r=this.get("progressMessage");r?(t={item:r,title:r,isEnabled:NO},n=[t]):n=this.get("autocompleteItems");if(n&&n.length>0){e=this.get("autocompleteMenuPane");if(!e){var i=this.get("autocompleteMenuClass");e=i.create({delegate:this}),this.set("autocompleteMenuPane",e)}e.set("items",n),this.showAutocompleteMenuPane()}else e=this.get("autocompleteMenuPane"),e&&this.destroyAutocompleteMenuPane()},hideAutocompleteMenuPane:function(){if(this.get("autocompleteMenuIsVisible")){this.propertyWillChange("autocompleteMenuIsVisible");var e=this.get("autocompleteMenuPane");e&&e.remove(),this.propertyDidChange("autocompleteMenuIsVisible")}},autocompleteMenuWasHidden:function(){var e=this.get("autocompleteDelegate"
);e&&e.tryToPerform("autocompleteMenuWasHidden")},destroyAutocompleteMenuPane:function(){var e=this.get("autocompleteMenuPane");e&&(e.get("isVisibleInWindow")&&this.hideAutocompleteMenuPane(),e.removeObserver("isVisibleInWindow",this,this.autocompleteMenuPaneObserver),e.set("textField",null),e.destroy(),this.set("autocompleteMenuPane",null))},previewFullString:NO,updateIndicatorViews:function(){this._updateIndicatorView("progress","progressIndicatorIsVisible"),this._updateIndicatorView("error","errorMessage")},_updateIndicatorView:function(e,t){var n="_"+e+"IndicatorView",r,i=this.get(t);if(i){if(!this[n]){var s,o,u;e==="error"&&(s=i,o=this,u=function(){return o.set("errorMessage",null),YES});var a={centerY:0,right:3,width:19,height:16};r=SC.ImageView.create({value:"ck-ac-"+e+"-indicator",layout:a,acceptsFirstResponder:NO,toolTip:s,mouseDown:u}),this.set("rightAccessoryView",r),this[n]=r}}else r=this[n],r&&(this.get("rightAccessoryView")===r&&this.set("rightAccessoryView",null),this[n]=null)},isVisibleInWindowDidChange:function(){var e=this._previousIsVisibleInWindow,t=this.get("isVisibleInWindow"),n;e!==t&&(this._previousIsVisibleInWindow=t,t?(n=this.get("autocompleteDelegate"),n&&n.tryToPerform("autocompleteFieldBecameVisible",this),this.updateAutocompleteMenuPane(),this.updateIndicatorViews()):this.destroyAutocompleteMenuPane())}.observes("isVisibleInWindow"),autocompleteItemsDidChange:function(){var e=this._autocompleteItems;e&&e.removeObserver("[]",this,this.autocompleteItemContentDidChange),e=this._autocompleteItems=this.get("autocompleteItems"),e&&e.addObserver("[]",this
,this.autocompleteItemContentDidChange),this.autocompleteItemContentDidChange()}.observes("autocompleteItems"),autocompleteItemContentDidChange:function(){this.updateAutocompleteMenuPane()},autocompleteMenuPane:null,interpretKeyEvents:function(e){var t=e.which?e.which:e.keyCode,n=SC.browser.isMozilla,r=e.charCode;if(!(e.metaKey||e.shiftKey||e.altKey)&&(t===44||t===188&&(!n||e.charCode!==8804))||t===9&&this.get("nextValidKeyView")===this)if(this.chooseSelectedAutocompleteItemIfAppropriate())return e.preventDefault(),YES;return arguments.callee.base.apply(this,arguments)},moveUp:function(e){var t=this.get("autocompleteMenuPane"),n;return t?(n=t.moveUp(),n&&(this.set("isProcessingKeyEvent",NO),e.preventDefault()),n):NO},moveDown:function(e){var t=this.get("autocompleteMenuPane"),n;return t?(n=t.moveDown(),n&&(this.set("isProcessingKeyEvent",NO),e.preventDefault()),n):NO},didBecomeFirstResponder:function(e){e();var t=this.get("autocompleteDelegate");t&&t.tryToPerform("autocompleteFieldWasFocused",this)}.enhance(),chooseSelectedAutocompleteItemIfAppropriate:function(){var e=this.get("autocompleteMenuPane"),t;if(e&&e.get("isVisible")&&e.get("isPaneAttached")){var n=e.get("currentMenuItem");n&&(n.performAction(YES),t=YES),this.reset()}return t||(t=NO),t},dismissAutocompleteMenuIfAppropriate:function(){var e=this.get("autocompleteMenuPane");return e&&e.get("isVisible")?(this.destroyAutocompleteMenuPane(),YES):NO},removeRecentsItem:function(e){var t=this.get("autocompleteDelegate");t&&t.tryToPerform("deleteRecentsButtonWasPressed",e)},reset:function(){this.set("progressIndicatorIsVisible"
,NO),this.set("progressMessage",null),this.set("errorMessage",null),this.dismissAutocompleteMenuIfAppropriate()}},CK.ContactsAutocompleteResult=CK.AutocompleteResult.extend({matchType:undefined,matchValue:undefined,matchRecord:undefined,matchRecordType:undefined,isPhoneNumber:function(){return CK.matchesFormatOfPhoneNumber(this.get("matchValue"))}.property("matchValue").cacheable(),isICloudMemberState:function(){if(!CK.Autocomplete.get("showiCloudMembership"))return undefined;var e=this.get("matchValue");if(CK.PhoneNumbers&&this.get("isPhoneNumber")){var t=CK.MicroResourceContainer.LoadStatus,n=this.get("canonicalizedPhoneNumberState");switch(n){case t.NOT_LOADED:case t.FAILED:case t.PENDING:return n}e=CK.PhoneNumbers.CanonicalizationController.sharedInstance().getCanonicalizePhoneNumberValue(e)}return CK.iCloudMembershipController.sharedInstance().getICloudMemberState(e)}.property("matchValue","isICloudMember","canonicalizedPhoneNumberState"),isICloudMember:function(){if(!CK.Autocomplete.get("showiCloudMembership"))return undefined;var e;this.get("isPhoneNumber")?e=this.get("canonicalizedPhoneNumber"):e=this.get("matchValue");if(!e)return undefined;var t=CK.MicroResourceContainer.LoadStatus,n=CK.iCloudMembershipController.sharedInstance();switch(this.get("isICloudMemberState")){case t.PENDING:case t.FAILED:return undefined;case t.LOADED:return n.getICloudMemberValue(e)}var r=this;n.isICloudMember(e,function(e,t){r.notifyPropertyChange("isICloudMember")})}.property("matchValue","isPhoneNumber","canonicalizedPhoneNumber"),canonicalizedPhoneNumberState:function(){if(!CK.PhoneNumbers
)return;var e=CK.PhoneNumbers.CanonicalizationController.sharedInstance();return e.getCanonicalizePhoneNumberState(this.get("matchValue"))}.property("matchValue","canonicalizedPhoneNumber"),canonicalizedPhoneNumber:function(){var e=this.get("matchValue");if(!CK.PhoneNumbers)return e;var t=CK.MicroResourceContainer.LoadStatus,n=CK.PhoneNumbers.CanonicalizationController.sharedInstance();switch(this.get("canonicalizedPhoneNumberState")){case t.PENDING:case t.FAILED:return undefined;case t.LOADED:return n.getCanonicalizePhoneNumberValue(e)}var r=this;n.canonicalizePhoneNumber(e,function(e,t){r.notifyPropertyChange("canonicalizedPhoneNumber")})}.property("matchValue")}),CK.ContactsAutocompleteResult.MatchType={EMAIL:"EMAIL",PHONE:"PHONE",GROUP:"GROUP"},CK.ContactsAutocompleteResult.MatchRecordType={CONTACT:"CONTACT",RECENT:"RECENT",GROUP:"GROUP",RECENT_GROUP:"RECENT_GROUP"},CK.ContactsAutocompleteMenuPane=CK.AutocompleteMenuPane.extend({menuItemWillShow:function(e,t){if(!CK.Autocomplete.get("showiCloudMembership"))return;var n=e.get("isICloudMemberState");n===undefined&&e.get("isICloudMember")}}),CK.AutocompleteTextFieldView=SC.TextFieldView.extend(CK.AutocompleteField,{classNames:["ck-ac-text-field-view"],autocompleteCandidateValue:function(){var e=this._candidateValueBeforeUpdating;if(e)return e;var t=this.get("value");if(!t)return"";var n=this.get("selection");if(!n)return"";var r=n.get("start");if(r<0)return"";var i=n.get("end");if(r===i){var s=t.charAt(n.get("end"));if(s&&s!==",")return""}var o=null,u=t.lastIndexOf(",",r),a=t.lastIndexOf(">",r),f=u>a?u:a;return f===-1?o=t.substr
(0,r):f===r-1?o="":o=t.substr(f+1,r-f-1),o=o.trimLeft(),o}.property("value","selection").cacheable(),showAutocompleteMenuPane:function(){if(!this.get("autocompleteMenuIsVisible")){this.propertyWillChange("autocompleteMenuIsVisible");var e=this.get("autocompleteMenuPane");e&&e.popup(this),this.propertyDidChange("autocompleteMenuIsVisible")}},selectedMenuItemDidChange:function(e){if(!e||this.isProcessingKeyEvent)return;SC.Binding.flushPendingChanges();var t=e.get("previewValue"),n=this.get("autocompleteCandidateValue"),r=t.toLowerCase().indexOf(n.toLowerCase()),i=this.get("previewFullString");if(n&&r!==0)return;!i&&n&&(t=t.substring(n.length));var s=this.get("value"),o=this.get("selection"),u=o?o.get("start"):0,a=o?o.get("end"):0,f=u+t.length,l=s?s.substring(0,i&&r>=0?r:u):"";if(!s)return;l+=t,this._candidateValueBeforeUpdating=this.get("autocompleteCandidateValue"),this.set("value",l),this.set("selection",SC.TextSelection.create({start:u,end:f})),this._candidateValueBeforeUpdating=null},menuItemWasChosen:function(e){if(!e)return;var t=e.get("value");if(!t)return;var n=e.get("primaryLabel"),r=e.get("secondaryLabel");n===r&&(t=r);var i=this.get("value"),s=this.get("selection"),o=s.get("start");if(o<0)return;var u="",a=i?i.lastIndexOf(",",o):0,f=i?i.lastIndexOf(">",o):0,l=a>f?a:f;l>=0&&l<o-1&&(a>f?u=i?i.substr(0,l):"":u=i?i.substr(0,l+1):""),u&&(u+=", ");var c=i?i.substr(s.get("end")):"",h=u+t;if(this.get("autocompleteMode")===CK.AUTOCOMPLETE_MODE_MULTIPLE||c!=="")h+=", ";var p=h+c;this._candidateValueBeforeUpdating=this.get("autocompleteCandidateValue"),this.set("value",p),o=h.
length,parseInt(SC.browser.msie,10)===7?this.invokeLater(function(){this._setCaretPosition(o,p)},100):this._setCaretPosition(o,p),this._candidateValueBeforeUpdating=null;var d=this.get("autocompleteActionDelegate");d&&d.tryToPerform("autocompleteMenuItemWasChosen",this)},_scrollTextFieldToEnd:function(){var e=this.$input()[0];e&&(e.scrollLeft=e.scrollWidth-e.clientWidth)},_setCaretPosition:function(e,t){this.set("selection",SC.TextSelection.create({start:e,end:e})),e>=t.length&&this._scrollTextFieldToEnd()},keyDown:function(e){return this.set("isProcessingKeyEvent",YES),this.interpretKeyEvents(e)?(e.cancelled||e.allowDefault(),YES):arguments.callee.base.apply(this,arguments)},keyUp:function(e){var t=this._isKeyDown;return SC.browser.mozilla&&e.keyCode===13&&!t&&this.fieldValueDidChange(),this.notifyPropertyChange("selection"),t&&this._updateFieldValueAfterKeyUp(),this._isKeyDown=NO,e.allowDefault(),YES},_updateFieldValueAfterKeyUp:function(){this.fieldValueDidChange(YES),this.set("isProcessingKeyEvent",NO)},moveLeft:function(e){var t=this.dismissAutocompleteMenuIfAppropriate();return t?(e.preventDefault(),YES):NO},moveRight:function(e){var t=this.chooseSelectedAutocompleteItemIfAppropriate();return t?(e.preventDefault(),YES):NO},insertNewline:function(e){if(e.isIMEInput)return YES;var t=this.chooseSelectedAutocompleteItemIfAppropriate();return t?(e.preventDefault(),YES):NO},cancel:function(e){var t=this.dismissAutocompleteMenuIfAppropriate();return t?(e.preventDefault(),YES):NO},deleteBackward:function(e){return this.dismissAutocompleteMenuIfAppropriate(),NO},willLoseFirstResponder
:function(){arguments.callee.base.apply(this,arguments),SC.browser.msie?this.invokeLast(this.dismissAutocompleteMenuIfAppropriate):this.chooseSelectedAutocompleteItemIfAppropriate();var e=this.get("fieldValue");e&&(e=e.replace(/[, ]*$/g,""),this.set("value",e)),this.set("autocompleteItems",null);var t=this.get("autocompleteDelegate");t&&t.tryToPerform("autocompleteFieldWasBlurred",this),this.reset()},insertText:function(e,t){return null},insertTab:function(e){var t=this.get("nextValidKeyView");return t?(t.becomeFirstResponder(),e.preventDefault()):e.allowDefault(),YES},insertBacktab:function(e){var t=this.get("previousValidKeyView");return t?(t.becomeFirstResponder(),e.preventDefault()):e.allowDefault(),YES}}),CK.AutocompleteInlineTextFieldView=CK.AutocompleteTextFieldView.extend(SC.DelegateSupport,{isInvalid:NO,displayProperties:["isInvalid"],render:function(e,t){arguments.callee.base.apply(this,arguments),this.get("isInvalid")&&e.addClass("cloudkit-errorfill")},commitEditing:function(){var e=this.get("value");return e&&(e=e.replace(/[, ]*$/g,""),this.set("value",e)),SC.InlineTextFieldView.prototype.commitEditing.call(this)},isEditing:NO,mouseDown:function(e){return arguments.callee.base.call(this,e),this.get("isEditing")},keyDown:function(e){this.set("isProcessingKeyEvent",YES);var t=this.interpretKeyEvents(e);return t&&this.fieldValueDidChange(YES),this._isKeyDown=YES,t?t:NO},insertText:null,fieldValueDidChange:function(e){SC.InlineTextFieldView.prototype.fieldValueDidChange.call(this,e),arguments.callee.base.apply(this,arguments)},cancel:function(){var e=this.dismissAutocompleteMenuIfAppropriate
();return e?YES:SC.InlineTextFieldView.prototype.cancel.call(this)},insertNewline:function(e){if(!e.isIMEInput)return YES;var t=this.chooseSelectedAutocompleteItemIfAppropriate();return t?YES:SC.InlineTextFieldView.prototype.insertNewline.call(this,e)},deleteForward:function(e){return this.dismissAutocompleteMenuIfAppropriate(),SC.InlineTextFieldView.prototype.deleteForward.call(this,e)},deleteBackward:function(e){return this.dismissAutocompleteMenuIfAppropriate(),SC.InlineTextFieldView.prototype.deleteBackward.call(this,e)},beginEditing:SC.InlineTextFieldView.prototype.beginEditing,discardEditing:SC.InlineTextFieldView.prototype.discardEditing}),SC.supplement(CK.AutocompleteInlineTextFieldView.prototype,SC.InlineTextFieldView.prototype),CK.TokenItemView&&(CK.AutocompleteTokenItemView=CK.TokenItemView.extend(CK.AutocompleteField,{isAutocorrectEnabled:NO,isInIMEInputMode:NO,minimumCharactersBinding:"*autocompleteDelegate.minimumCharacters",autocompleteCandidateValue:function(){if(this.get("isEditing")===NO||!this._textarea)return;if(this.get("isInIMEInputMode")&&(!SC.browser.isWindows||!SC.browser.isChrome))return;var e=this._candidateValueBeforeUpdating;if(e)return e;var t=this.get("value");t.length<this.get("minimumCharacters")&&(t=null);if(!t)return"";var n=this.getTextSelection(),r=n.start,i=n.end;if(r<0)return"";if(r===i){var s=t.charAt(i);if(s&&s!==",")return""}var o=null,u=t.lastIndexOf(",",r),a=t.lastIndexOf(">",r),f=u>a?u:a;return f===-1?o=t.substr(0,r):f===r-1?o="":o=t.substr(f+1,r-f-1),o=o.trimLeft(),o}.property("value").cacheable(),showAutocompleteMenuPane:function(
){if(!this.get("autocompleteMenuIsVisible")){this.propertyWillChange("autocompleteMenuIsVisible");var e=this.get("autocompleteMenuPane");e&&e.popup(this.get("parentView")),this.propertyDidChange("autocompleteMenuIsVisible")}},hideAutocompleteMenuPane:function(){this._lastCandidateValue=null},selectedMenuItemDidChange:function(e){if(!e)return;var t=this.get("autocompleteCandidateValue");if(SC.empty(t)===YES||this.get("isProcessingKeyEvent")===YES&&t===this._lastCandidateValue)return;this._lastCandidateValue=t;var n=e.get("previewValue"),r=n.toLowerCase().indexOf(t.toLowerCase()),i=this.get("previewFullString"),s;if(r!==0)return;i||(n=n.substring(t.length));var o=this.get("value"),u=this.getTextSelection(),a=u.start,f=u.end,l=a+n.length,c=o?o.substring(0,i&&r>=0?r:a):"";if(!o)return;c+=n,this._candidateValueBeforeUpdating=this.get("autocompleteCandidateValue"),this._textarea.value=c,this.updateValue();var h=this._textarea;h&&(h.setSelectionRange?h.setSelectionRange(a,l):(s=h.createTextRange(),s.move("character",a),s.moveEnd("character",l-a),s.select())),this._candidateValueBeforeUpdating=null},menuItemWasChosen:function(e){if(!e)return;var t=e.get("value");if(!t)return;var n=this.get("parentView");if(!n)return;n.tryToPerform("menuItemWasChosenInTokenItemView",e);var r=e.get("primaryLabel"),i=e.get("secondaryLabel");r===i&&(t=i);var s=this.get("value"),o=this.getTextSelection(),u=o.start;if(u<0)return;var a="",f=s?s.lastIndexOf(",",u):0,l=s?s.lastIndexOf(">",u):0,c=f>l?f:l;c>=0&&c<u-1&&(f>l?a=s?s.substr(0,c):"":a=s?s.substr(0,c+1):""),a&&(a+=", ");var h;SC.browser.isChrome&&o.start===
o.end?h="":h=s?s.substr(o.end):"";var p=a+t;if(this.get("autocompleteMode")===CK.AUTOCOMPLETE_MODE_MULTIPLE||h!=="")p+=", ";var d=p+h;this._candidateValueBeforeUpdating=this.get("autocompleteCandidateValue"),this.set("value",d),this._candidateValueBeforeUpdating=null;var v=this.get("autocompleteActionDelegate");v&&v.tryToPerform("autocompleteMenuItemWasChosen",this);var m=this.get("parentView"),g=m.get("tokensController"),y=g.indexOf(this.get("content"));g.set("nextIndex",y+1),m.createEditingToken()},keyDown:function(e){return e.isIMEInput?(this.set("minimumCharacters",CK.CONTACTS_AUTOCOMPLETE_IME_INPUT_MINIMUM_CHARACTERS),this.notifyPropertyChange("autocompleteCandidateValue")):this.set("minimumCharacters",CK.CONTACTS_AUTOCOMPLETE_DEFAULT_INPUT_MINIMUM_CHARACTERS),this.set("isProcessingKeyEvent",YES),this._isKeyDown=YES,arguments.callee.base.apply(this,arguments)},keyUp:function(e){var t=this._isKeyDown;return t&&this._updateFieldValueAfterKeyUp(),this._isKeyDown=NO,e.allowDefault(),YES},_updateFieldValueAfterKeyUp:function(){this.set("isProcessingKeyEvent",NO)},isInIMEInputModeDidChange:function(){if(this.get("isInIMEInputMode")){var e=SC.browser;(e.isMozilla||e.isWindows&&e.isChrome)&&this.set("minimumCharacters",CK.CONTACTS_AUTOCOMPLETE_IME_INPUT_MINIMUM_CHARACTERS)}else this.notifyPropertyChange("autocompleteCandidateValue")}.observes("isInIMEInputMode"),moveLeft:function(e){var t=this.dismissAutocompleteMenuIfAppropriate();return t?(e.preventDefault(),YES):arguments.callee.base.apply(this,arguments)},moveRight:function(e){var t=this.chooseSelectedAutocompleteItemIfAppropriate
();return t?(e.preventDefault(),YES):arguments.callee.base.apply(this,arguments)},insertNewline:function(e){if(e.isIMEInput)return YES;var t=this.chooseSelectedAutocompleteItemIfAppropriate();return t?(e.preventDefault(),YES):arguments.callee.base.apply(this,arguments)},cancel:function(e){var t=this.dismissAutocompleteMenuIfAppropriate();return t?(e.preventDefault(),YES):arguments.callee.base.apply(this,arguments)},deleteBackward:function(e){return this.dismissAutocompleteMenuIfAppropriate(),arguments.callee.base.apply(this,arguments)},willLoseFirstResponder:function(){arguments.callee.base.apply(this,arguments),SC.browser.msie?this.invokeLast(this.dismissAutocompleteMenuIfAppropriate):this.chooseSelectedAutocompleteItemIfAppropriate();var e=this.get("value");e&&(e=e.replace(/[, ]*$/g,""),this.set("value",e)),this.set("autocompleteItems",null);var t=this.get("autocompleteDelegate");t&&t.tryToPerform("autocompleteFieldWasBlurred",this),this.reset()},commitEditing:function(){var e=this.get("autocompleteMenuPane");if(e){var t=e.get("currentMenuItem");t&&this.set("value",t.getPath("content.value"))}arguments.callee.base.apply(this,arguments)}})),CK.TokenView&&(CK.AutocompleteTokenView=CK.TokenView.extend({exampleView:CK.AutocompleteTokenItemView,menuItemWasChosenInTokenItemView:function(e){},viewDidResize:function(){var e=this._prevHeight,t;arguments.callee.base.apply(this,arguments),t=this._prevHeight;if(e>0&&e!==t){var n=this.getChildViewInEditMode();if(n&&n.get("autocompleteMenuIsVisible")){var r=n.get("autocompleteMenuPane");r&&this.invokeLast(function(){r.positionPane()})}}
}})),SC.SplitChild={isSplitDivider:NO,minimumSize:100,maximumSize:undefined,size:undefined,position:0,positionOffset:SC.propertyFromRenderDelegate("splitPositionOffset",0),sizeOffset:SC.propertyFromRenderDelegate("splitSizeOffset",0),canCollapse:NO,collapseAtSize:undefined,autoResizeStyle:undefined,compensatesForMovement:YES,allowsIndirectAdjustments:YES,_scsvc_positionOrSizeDidChange:function(){this.invokeOnce("splitChildLayoutDidChange")}.observes("position","size"),splitChildLayoutDidChange:function(){var e=this.get("splitView");if(!e)return;var t=this.get("position")+this.get("positionOffset"),n=this.get("size")+this.get("sizeOffset");e.get("layoutDirection")===SC.LAYOUT_HORIZONTAL?this.set("layout",{left:t,width:n,top:0,bottom:0}):this.set("layout",{top:t,height:n,right:0,left:0})},splitView:function(){var e=this;while(e&&!e.isSplitView)e=e.get("parentView");return e}.property("parentView").cacheable(),splitViewLayoutDirection:null,splitViewLayoutDirectionBinding:SC.Binding.oneWay("*splitView.layoutDirection"),splitViewLayoutDirectionDidChange:function(){this.invokeOnce("splitChildLayoutDidChange")}.observes("splitViewLayoutDirection")},SC.MOVES_AUTOMATIC_CHILD="moves-automatic-child",SC.MOVES_CHILD="moves-child",SC.MOVES_PREVIOUS_CHILD="moves-previous-child",SC.MOVES_NEXT_CHILD="moves-next-child",SC.SplitThumb={movesChild:function(){var e=this,t,n=this.get("splitView"),r=this.get("movesSibling");while(e&&e!==n)t=e,e=e.get("parentView");if(r===SC.MOVES_NEXT_CHILD)return t.nextView;if(r===SC.MOVES_PREVIOUS_CHILD)return t.previousView;if(r===SC.MOVES_AUTOMATIC_CHILD){if(!
t.nextView)return t.previousView;if(!t.previousView)return t.nextView}return t}.property("splitView","movesSibling").cacheable(),movesSibling:SC.MOVES_AUTOMATIC_CHILD,splitView:function(){var e=this;while(e&&!e.isSplitView)e=e.get("parentView");return e}.property("parentView").cacheable(),splitViewLayoutDirection:null,splitViewLayoutDirectionBinding:SC.Binding.oneWay("*splitView.layoutDirection"),splitCursorStyle:function(){return this.get("splitViewLayoutDirection")===SC.LAYOUT_HORIZONTAL?"ew-resize":"ns-resize"}.property("splitViewLayoutDirection").cacheable(),splitCursorStyleDidChange:function(){this._isDragging&&this.get("splitView").set("splitChildCursorStyle",this.get("splitCursorStyle")),this.$().css("cursor",this.get("splitCursorStyle"))}.observes("splitCursorStyle"),renderMixin:function(e){e.css("cursor",this.get("splitCursorStyle"))},touchStart:function(e){this._isDragging=YES;var t=this.get("splitView");return t.beginLiveResize(),this._scst_mouseStartPosition=t.get("layoutDirection")===SC.LAYOUT_HORIZONTAL?e.pageX:e.pageY,this._scst_childStartPosition=t.getPositionForChild(this.get("movesChild")),YES},touchesDragged:function(e){var t=this.get("splitView"),n=t.get("layoutDirection")===SC.LAYOUT_HORIZONTAL?e.pageX:e.pageY,r=n-this._scst_mouseStartPosition,i=this._scst_childStartPosition;return t.userAdjustPositionForChild(this.get("movesChild"),i+r),YES},touchEnd:function(e){this._isDragging=NO;var t=this.get("splitView"),n=t.get("layoutDirection")===SC.LAYOUT_HORIZONTAL?e.pageX:e.pageY,r=n-this._scst_mouseStartPosition,i=this._scst_childStartPosition;return t.userAdjustPositionForChild
(this.get("movesChild"),i+r),t.set("splitChildCursorStyle",null),t.endLiveResize(),YES},mouseDown:function(e){SC.SplitThumb.installDocumentOverlay(this.get("splitCursorStyle"));var t=this.get("splitView");return t.set("splitChildCursorStyle",this.get("splitCursorStyle")),this.touchStart(e)},mouseDragged:function(e){return this.touchesDragged(e)},mouseUp:function(e){return SC.SplitThumb.uninstallDocumentOverlay(),this.get("splitView").set("splitChildCursorStyle",null),this.touchEnd(e)},documentOverlayElement:null,installDocumentOverlay:function(e){var t=this.documentOverlayElement;t||(this.documentOverlayElement=t=document.createElement("div"),t.style.position="fixed",t.style.left=0,t.style.top=0,t.style.right=0,t.style.bottom=0,t.style.zIndex=5e3,t.onmouseup=function(){SC.SplitThumb.uninstallDocumentOverlay()}),t.style.cursor=e,document.body.appendChild(t)},uninstallDocumentOverlay:function(){var e=this.documentOverlayElement;e.parentNode&&e.parentNode.removeChild(e)}},SC.BaseTheme.splitRenderDelegate=SC.RenderDelegate.create({className:"split",render:function(e,t){t.addClass(e.get("layoutDirection"))},update:function(e,t){t.addClass(e.get("layoutDirection"))}}),SC.BaseTheme.splitDividerRenderDelegate=SC.RenderDelegate.create({className:"split-divider",dividerSize:1,splitPositionOffset:-5,splitSizeOffset:10,render:function(e,t){this.addSizeClassName(e,t),t.push("<div class='line'></div>")},update:function(e,t){this.updateSizeClassName(e,t)}}),SC.SplitDividerView=SC.View.extend(SC.SplitChild,SC.SplitThumb,{classNames:["sc-split-divider-view"],isSplitDivider:YES,autoResizeStyle
:"sc-fixed-size",movesSibling:SC.MOVES_CHILD,size:SC.propertyFromRenderDelegate("dividerSize",10),renderDelegateName:"splitDividerRenderDelegate"}),SC.FIXED_SIZE="sc-fixed-size",SC.RESIZE_MANUAL="sc-manual-size",SC.RESIZE_AUTOMATIC="sc-automatic-resize",SC.SplitView=SC.View.extend({classNames:["sc-split-view"],childViews:["topLeftView","bottomRightView"],isSplitView:YES,splitDividerView:SC.SplitDividerView,layoutDirection:SC.LAYOUT_HORIZONTAL,shouldResizeChildrenToFit:YES,splitChildCursorStyle:null,_scsv_splitChildCursorDidChange:function(){this.get("cursor").set("cursorStyle",this.get("splitChildCursorStyle"))}.observes("splitChildCursorStyle"),init:function(){this.cursor=SC.Cursor.create(),arguments.callee.base.apply(this,arguments)},displayProperties:["layoutDirection"],renderDelegateName:"splitRenderDelegate",_frameSize:function(){return this.get("layoutDirection")===SC.LAYOUT_HORIZONTAL?this.get("frame").width:this.get("frame").height}.property("frame","layoutDirection").cacheable(),viewDidResize:function(){arguments.callee.base.apply(this,arguments),this.scheduleTiling()},layoutDirectionDidChange:function(){this.scheduleTiling()}.observes("layoutDirection"),adjustPositionForChild:function(e,t){return this.invokeDelegateMethod(this.get("delegate"),"splitViewAdjustPositionForChild",this,e,t)},userAdjustPositionForChild:function(e,t){this.adjustPositionForChild(e,t)},getPositionForChild:function(e){return this.invokeDelegateMethod(this.get("delegate"),"splitViewGetPositionForChild",this,e)},didAddChild:function(){if(this._scsv_settingUpChildViews)return;this._scsv_settingUpChildViews=
YES,this.invokeOnce("_scsv_setupChildViews"),this._scsv_settingUpChildViews=NO},didRemoveChild:function(){if(this._scsv_settingUpChildViews)return;this._scsv_settingUpChildViews=YES,this.invokeOnce("_scsv_setupChildViews"),this._scsv_settingUpChildViews=NO},createChildViews:function(){arguments.callee.base.apply(this,arguments);if(this._scsv_settingUpChildViews)return;this._scsv_settingUpChildViews=YES,this.invokeOnce("_scsv_setupChildViews"),this._scsv_settingUpChildViews=NO},_scsv_setupChildViews:function(){var e=this.get("delegate"),t=this.get("childViews").copy(),n=t.length,r,i,s,o,u=this._scsv_dividers||{},a={},f,l;for(r=0;r<n;r++){i=t[r],i.get("autoResizeStyle")||(i.get("size")!==undefined?i.set("autoResizeStyle",SC.RESIZE_MANUAL):i.set("autoResizeStyle",SC.RESIZE_AUTOMATIC));var c=this.invokeDelegateMethod(e,"splitViewGetSizeForChild",this,i);c=this.invokeDelegateMethod(e,"splitViewConstrainSizeForChild",this,i,c),this.invokeDelegateMethod(e,"splitViewSetSizeForChild",this,i,c),i.previousView=s,i.nextView=undefined,i.viewIndex=r,s&&(s.nextView=i),o&&!i.isSplitDivider&&(l=SC.guidFor(o)+"-"+SC.guidFor(i),f=u[l],!f&&!s.isSplitDivider&&(f=this.invokeDelegateMethod(e,"splitViewDividerBetween",this,o,i)),f&&(f.isSplitDivider=YES,a[l]=f,u[l]?delete u[l]:this.insertBefore(f,i))),s=i,i.isSplitDivider||(o=i)}for(l in u)this.removeChild(u[l]),u[l].destroy();this._scsv_dividers=a,this._scsv_tile()},needsTiling:YES,scheduleTiling:function(){this.set("needsTiling",YES),this.invokeOnce("tileIfNeeded")},tileIfNeeded:function(){if(!this.get("needsTiling"))return;this._scsv_tile()},_scsv_tile
:function(){var e=this.get("delegate"),t,n=this.get("_frameSize");t=this.invokeDelegateMethod(e,"splitViewLayoutChildren",this),this.get("shouldResizeChildrenToFit")&&t!==n&&(this.invokeDelegateMethod(e,"splitViewResizeChildrenToFit",this,t),t=this.invokeDelegateMethod(e,"splitViewLayoutChildren",this)),this.get("shouldResizeChildrenToFit")||(this.get("layoutDirection")===SC.LAYOUT_HORIZONTAL?this.adjust("width",t):this.adjust("height",t)),this.set("needsTiling",NO)},splitViewLayoutChildren:function(e){var t=this.get("delegate"),n=this.get("childViews"),r=n.length,i,s,o=0;for(i=0;i<r;i++)s=n[i],this.invokeDelegateMethod(t,"splitViewSetPositionForChild",this,n[i],o),o+=this.invokeDelegateMethod(t,"splitViewGetSizeForChild",this,n[i]);return o},splitViewResizeChildrenToFit:function(e,t){var n=this.get("delegate"),r=this.get("_frameSize"),i=this.get("childViews"),s=i.length,o,u,a=0,f=0,l;for(o=0;o<s;o++)u=i[o],l=this.invokeDelegateMethod(n,"splitViewGetSizeForChild",this,u),this.invokeDelegateMethod(n,"splitViewShouldResizeChildToFit",this,u)?a+=l:f+=l;var c=t;c=this._resizeChildrenForSize(c,r,YES,a),c=this._resizeChildrenForSize(c,r,YES,-1),c=this._resizeChildrenForSize(c,r,NO,f),c=this._resizeChildrenForSize(c,r,NO,-1)},_resizeChildrenForSize:function(e,t,n,r){var i=this.get("delegate"),s=this.get("childViews"),o,u=s.length,a,f=t-e;for(o=0;o<u;o++){a=s[o];var l=this.invokeDelegateMethod(i,"splitViewGetSizeForChild",this,a),c=l,h=this.invokeDelegateMethod(i,"splitViewShouldResizeChildToFit",this,a);h===n&&(r===-1?c+=f:c+=c/r*f,c=Math.round(c),c=this.invokeDelegateMethod(i,"splitViewConstrainSizeForChild"
,this,a,c),this.invokeDelegateMethod(i,"splitViewSetSizeForChild",this,a,c),r!==-1&&(r-=l)),e-=l,e+=c,f=t-e}return e},splitViewShouldResizeChildToFit:function(e,t){return this.get("shouldResizeChildrenToFit")&&t.get("autoResizeStyle")===SC.RESIZE_AUTOMATIC},splitViewAdjustPositionForChild:function(e,t,n){var r=this.get("delegate"),i=this._scsv_createPlan(),s=this._scsv_adjustPositionForChildInPlan(i,t,n,t);return this._scsv_commitPlan(i),s},_scsv_createPlan:function(){var e=this.get("delegate"),t=[],n=this.get("childViews"),r,i=n.length,s,o,u;for(r=0;r<i;r++)s=n[r],o=this.invokeDelegateMethod(e,"splitViewGetPositionForChild",this,s),u=this.invokeDelegateMethod(e,"splitViewGetSizeForChild",this,s),t[r]={child:s,originalPosition:o,position:o,originalSize:u,size:u};return t},_scsv_resetPlanRange:function(e,t,n){for(var r=t;r<=n;r++)e[r].position=e[r].originalPosition,e[r].size=e[r].originalSize},_scsv_commitPlan:function(e){var t=this.get("delegate"),n=e.length,r,i,s=0;for(r=0;r<n;r++)i=e[r],i.size!==i.originalSize&&this.invokeDelegateMethod(t,"splitViewSetSizeForChild",this,i.child,i.size),i.position!==i.originalPosition&&this.invokeDelegateMethod(t,"splitViewSetPositionForChild",this,i.child,i.position),s=i.position+i.size;this.get("shouldResizeChildrenToFit")||(this.get("layoutDirection")===SC.LAYOUT_HORIZONTAL?this.adjust("width",s):this.adjust("height",s))},_scsv_adjustPositionForChildInPlan:function(e,t,n,r){var i=this.get("delegate");if(!t.get("allowsIndirectAdjustments")&&r!==t&&r!==t.previousView)return e[t.viewIndex].position;if(t._splitViewIsAdjusting)return e[t.viewIndex
].position;t._splitViewIsAdjusting=YES;var s=t.previousView,o=t.nextView,u,a,f,l,c=e[t.viewIndex].size;return s&&!s._splitViewIsAdjusting?(u=e[s.viewIndex].position,a=n-u,a=this._scsv_adjustSizeForChildInPlan(e,s,a,r),n=u+a):s||(n=0),o&&o._splitViewIsAdjusting?(t._splitViewIsAdjusting=NO,e[t.viewIndex].position=n,n):(t.get("compensatesForMovement")&&o?(f=e[o.viewIndex].position,c=this._scsv_adjustSizeForChildInPlan(e,t,f-n)):!o&&this.get("shouldResizeChildrenToFit")&&(f=this.get("_frameSize"),c=this._scsv_adjustSizeForChildInPlan(e,t,f-n)),o&&(f=n+c,f=this._scsv_adjustPositionForChildInPlan(e,o,f,r)),f&&n!==f-c&&(n=f-c,s&&!s._splitViewIsAdjusting&&(this._scsv_resetPlanRange(e,0,s.viewIndex),a=n-e[s.viewIndex].position,this._scsv_adjustSizeForChildInPlan(e,s,a,t))),e[t.viewIndex].position=n,t._splitViewIsAdjusting=NO,n)},_scsv_adjustSizeForChildInPlan:function(e,t,n,r){var i=this.get("delegate");if(r&&!t.get("allowsIndirectAdjustments")&&r!==t&&r!==t.nextView&&r!==t.previousView)return e[t.viewIndex].size;var s=this.invokeDelegateMethod(i,"splitViewConstrainSizeForChild",this,t,n);e[t.viewIndex].size=s;if(n===s)return n;var o=e[t.viewIndex].position,u=o+n-s,a=this._scsv_adjustPositionForChildInPlan(e,t,u,r);return a+s-o},splitViewDividerBetween:function(e,t,n){return this.get("splitDividerView")?this.get("splitDividerView").create():null},splitViewGetPositionForChild:function(e,t){return t.get("position")},splitViewSetPositionForChild:function(e,t,n){t.set("position",n)},splitViewGetSizeForChild:function(e,t){var n=t.get("size");return SC.none(n)?100:n},splitViewSetSizeForChild
:function(e,t,n){t.set("size",n)},splitViewConstrainSizeForChild:function(e,t,n){if(t.get("autoResizeStyle")===SC.FIXED_SIZE)return this.invokeDelegateMethod(this.get("delegate"),"splitViewGetSizeForChild",this,t);if(t.get("canCollapse")){var r=t.get("collapseAtSize");if(r&&n<r)return 0}var i=t.get("minimumSize")||0;i!==undefined&&i!==null&&(n=Math.max(i,n));var s=t.get("maximumSize");return s!==undefined&&s!==null&&(n=Math.min(s,n)),n}}),SC.ThumbView=SC.View.extend(SC.SplitThumb,{classNames:["sc-thumb-view"],init:function(){arguments.callee.base.apply(this,arguments),console.warn("SC.ThumbView is deprecated. Please use a normal view and mix in SC.SplitThumb instead.")}}),CW.HashAttributeCommon={isOrphan:NO,parent:null,parentKey:null,parentIsRecord:function(){var e=this.get("parent");return e?e.kindOf(SC.Record):NO}.property("parent").cacheable(),readAttribute:function(e){var t=this.peekAttributes();return t?t[e]:undefined},attributes:function(){if(this.get("isOrphan"))return SC.warn("%@:  Requesting 'attributes' on orphaned instance",this),null;var e=this.get("parent"),t=this.get("parentKey"),n;return e||CW.fatalError("Cannot access 'attributes' because there is no parent",{hashAttributeOrArray:this}),SC.none(t)&&CW.fatalError("Cannot access 'attributes' because there is no parentKey",{hashAttributeOrArray:this}),this.get("parentIsRecord")?n=e.get("store").readEditableDataHash(e.get("storeKey")):n=e.get("attributes"),n?n[t]:null}.property("parent","isOrphan"),hashAttributeDidChange:function(e,t,n){this.childHashDidChange(e,t,n)},destroy:function(){var e=this.get("parent"),t
,n;e&&(t=this.get("parentKey"),t||CW.fatalError("There is a parent but no parentKey",{target:this,parent:e}),n=e.get("attributes"),n&&(delete n[t],this.hashAttributeDidChange(),this.orphan())),arguments.callee.base.apply(this,arguments)},getAncestorRecord:function(){var e=this.get("parent"),t;return e&&(this.get("parentIsRecord")?t=e:t=e.getAncestorRecord()),t},orphan:function(){this._orphan&&this._orphan(),this.beginPropertyChanges(),this.set("isOrphan",YES),this.set("parent",null),this.parentDidChange&&this.parentDidChange(),this.set("parentKey",null),this.destroy(),this.allPropertiesDidChange(),this.endPropertyChanges()},peekAttributes:function(e){var t=this.get("parent"),n=this.get("parentKey"),r;return t&&!SC.none(n)&&(r=t.readAttribute(n)),r}},CW.HashAttributeSupport={hashAttributeFor:function(e){var t=this._hashAttributes,n=null,r;return t&&(r=t[e],r&&(n=r)),n},childHashDidChange:function(e,t,n){t||(e?this.notifyPropertyChange(e):this.allPropertiesDidChange());var r=this.get("parent"),i=this.get("parentKey");this._ignoreChangePropogation=YES,r.childHashDidChange(i,YES,n),this._ignoreChangePropogation=NO},attributeIsDefault:function(e){var t=this[e],n=this.readAttribute(e),r;return!t||!t.isRecordAttribute?n===undefined:(r=t.getDefaultValue(this,e),n===r||SC.none(r)&&SC.none(n))},normalize:function(e,t){var n={},r,i,s,o,u,a,f,l,c,h,p,d=this.get("attributes");for(r in this)i=this[r],i&&(s=i.typeClass,s&&(h=i.get("key")||r,p=s.call(i),o=undefined,n[h]=YES,f=SC.typeOf(s.call(i))===SC.T_CLASS,l=i.isNestedRecordTransform||p.isHashAttribute,!f&&!l?o=d[h]:l?(u=this.get(r),u&&(
u.normalize&&u.normalize(e,t),!t&&u.isEmpty&&u.isEmpty()?o=null:o=u.get("attributes"))):f&&(u=this.get(r),u&&(o=d[h])),SC.none(o)&&(o=i.getDefaultValue(this,r)),o===null&&!e&&(o=undefined),o===undefined?delete d[h]:d[h]=o,u&&(u.isHashAttribute?u.underlyingContentDidChange():u.isHashAttributeArray&&u.recordPropertyDidChange())));for(r in d)n[r]||(SC.debug("%@:  Deleting key from underlying data hash due to normalization:  %@",this,r),delete d[r]);return this},registerHashAttribute:function(e,t){var n=this._hashAttributes,r,i;n||(n=this._hashAttributes={}),r=t.get("parent"),i=t.get("parentKey"),this!==r&&CW.fatalError("registerChildHashAttribute():  The specified child hash attribute does not have the proper parent",{key:e,target:this,parent:r}),e!==i&&CW.fatalError("registerChildHashAttribute():  The specified child hash attribute does not have the proper parentKey",{target:this,key:e,parentKey:i}),n[e]=t},unregisterHashAttribute:function(e,t){var n=this._hashAttributes,r;n||CW.fatalError("unregisterChildHashAttribute():  There is no “child hash attributes” structure",{target:this}),r=n[e],r||CW.fatalError("unregisterChildHashAttribute():  There is no registered child hash attribute for the specified key",{target:this,key:e}),delete n[e]},_hashAttributes:null},CW.MergeDelegate={shouldMergeOutdatedChangesWhenCommitting:NO,parentStoreRecordPropertyDidChange:function(e,t,n,r,i){},mergeConflictDuringCommit:function(e,t,n,r,i){return undefined},mergeConflictDuringNotify:function(e,t,n,r,i,s,o){return NO}},CW.MergeSupport={extendedLogging:NO,propagateStatusIfAppropriateFromStore:function(
e,t){var n=SC.Record,r=e.peekStatus(t),i=this.peekStatus(t),s;r!==i&&(r===n.ERROR?(SC.debug("%@:  Propagating ERROR status for storeKey %@ from %@…",this,t,e),s=n.ERROR):r&n.DESTROYED?i===n.READY_NEW?(SC.debug("%@:  Propagating destroyed status for storeKey %@ from %@ (it was READY_NEW, so marking it as DESTROYED_CLEAN)…",this,t,e),s=n.DESTROYED_CLEAN):i===n.READY_CLEAN?(SC.debug("%@:  Propagating destroyed status for storeKey %@ from %@ (it was READY_CLEAN, so marking it as DESTROYED_CLEAN)…",this,t,e),s=n.DESTROYED_CLEAN):(SC.debug("%@:  Propagating destroyed status for storeKey %@ from %@ (it was not READY_CLEAN, so marking as DESTROYED_DIRTY)…",this,t,e),s=n.DESTROYED_DIRTY):i===n.ERROR&&(r===n.READY_CLEAN||r===n.DESTROYED_CLEAN)&&(SC.debug("%@:  Propagating status %@ to override our ERROR status for storeKey %@ from %@…",this,r,t,e),s=r)),s&&(this.writeStatus(t,s),this.dataHashDidChange(t,null,!0))},mergeDataFromStore:function(e,t,n,r,i){var s=e.readDataHash(t),o=this.readDataHash(t),u=e.previousDataHashesForNotify[t],a=SC.Record,f,l,c,h,p,d,v,m;e||CW.fatalError("mergeDataFromStore():  A store must be specified",{target:this,storeKey:t}),t||CW.fatalError("mergeDataFromStore():  A storeKey must be specified",{target:this,mergeFromStore:e});if(!s&&!o){if(a.DESTROYED&e.peekStatus(t)&this.peekStatus(t)){SC.debug("mergeDataFromStore():  The record for storeKey %@ was destroyed in both %@ and %@.  Skipping merge…",t,e,this);return}CW.fatalError("mergeDataFromStore():  There is no data for the specified storeKey in either the lower-level store or the nested store.  Merge should never be triggered in this scenario."
,{mergeFromStore:e,target:this,storeKey:t})}else{if(!s){f=this.peekStatus(t),f===a.READY_NEW?f=a.DESTROYED_CLEAN:f=a.DESTROYED_DIRTY,this.writeStatus(t,f),SC.debug("There is no data for storeKey %@ in the lower-level store (%@) but there is in the nested store (%@).  Marking it as destroyed.",t,e,this);return}if(!o)CW.fatalError("mergeDataFromStore():  There is data for the specified storeKey in the lower-level store but not in the nested store.  Merge should never be triggered in this scenario.",{mergeFromStore:e.toString(),target:this.toString(),storeKey:t});else if(!u){SC.warn("There is no original data for storeKey %@ in the lower-level store (%@).  We cannot merge without this information.  (This usually means that dataHashDidChange is being called unnecessarily.)",t,e);return}}if(n){if(i)for(l=0,c=i.length;l<c;++l){h=i[l];if(h.indexOf(n)!==-1){SC.debug("Merging '%@' for storeKey %@ from %@ up to %@, but since it’s defined as part of a merge group (%@), merging all properties from %@…",n,t,e,this,h,e),p=YES;break}}if(!p){SC.debug("Merging '%@' for storeKey %@ from %@ up to %@…",n,t,e,this);if(r&&r.indexOf(n)!==-1){SC.debug("  >  We were requested to ignore this property.  Skipping merge…");return}m=this.mergePropertyAsPossible(n,s,o,u,YES,e.get("name"),this.get("name")),m.changed&&(d=[n]),m.mergeConflict&&(v=[n])}}m||(r?SC.debug("Merging all properties except %@ for %@ with storeKey %@ from %@ up to %@…",r,e.materializeRecord(t).get("shortTypeString"),t,e,this):SC.debug("Merging all properties for %@ with storeKey %@ from %@ up to %@…",e.materializeRecord(t).get("shortTypeString"
),t,e,this),m=this.mergeHashesAsPossible(s,o,u,i,YES,e.get("name"),this.get("name"),r),d=m.changedKeys.concat(m.addedKeys,m.removedKeys),v=m.mergeConflictKeys);if(d&&d.length>0)this.dataHashDidChange(t,null,NO);else{var g=SC.Store.generateStoreKey();this.revisions[t]=g}if(v&&v.length>0){var y=NO,b=this.get("delegate");b&&(y=this.invokeDelegateMethod(b,"mergeConflictDuringNotify",e,this,t,d,v));if(!y)throw SC.Store.CHAIN_CONFLICT_ERROR}this._updateLock(t)},mergePropertyAsPossible:function(e,t,n,r,i,s,o){var u=this.get("extendedLogging"),a,f,l,c,h,p,d,v,m,g,y,b,w,E;a=f=!1,s||(s="mergeFrom"),o||(o="mergeTo"),i?(l=t,h=s,c=n,p=o):(l=n,h=o,c=t,p=s),d=t[e],v=n[e],m=r[e];var S=CW.getSimpleTypes();g=d===m,g||(w=SC.typeOf(d),E=SC.typeOf(m),S[w]?g=!1:g=CW.valuesAreEqual(d,m,w,E)),y=v===m,y||(b=SC.typeOf(v),S[b]?y=!1:y=CW.valuesAreEqual(v,m,b,E));if(y)g?u&&SC.debug("  >  no need to merge '%@' ('%@'), since it hasn’t changed in any hash…",e,d):(SC.debug("  >  taking value from %@ for '%@' ('%@'), since it didn’t change in %@ (it was '%@')…",s,e,d,o,v),f=!0);else if(g)SC.debug("  >  preserving current value for '%@' ('%@') in %@, since it didn’t change in %@…",e,v,o,s),a=!1,f=!1;else{var x=l[e],T=c[e];CW.valuesAreEqual(t[e],n[e])?SC.debug("  >  no need to merge '%@' ('%@'), even though it changed in both, since both changed it to the same value…",e,x):(SC.debug("  >  Merge conflict for '%@' (both changed the value).  Preferring value '%@' from %@ over value '%@' from %@ (preferMergeFromIfConflict=%@, and the original value was '%@')…",e,x,h,T,p,!!i,r[e]),a=!0,i&&(f=!0))}return f&&(n[e]=t[
e]),{mergeConflict:a,changed:f}},mergeHashesAsPossible:function(e,t,n,r,i,s,o,u){e===t&&CW.fatalError("'mergeFrom' and 'mergeTo' are both the same hash, which is not allowed",{mergeFrom:e,original:n}),e===n&&CW.fatalError("'mergeFrom' and 'original' are both the same hash, which is not allowed",{mergeFrom:e,mergeTo:t}),t===n&&CW.fatalError("'mergeTo' and 'original' are both the same hash, which is not allowed",{mergeFrom:e,mergeTo:t});var a=this.get("extendedLogging"),f=[],l=[],c=[],h=[],p={},d,v,m,g,y,b;s||(s="mergeFrom"),o||(o="mergeTo"),i?(d=e,m=s,v=t,g=o):(d=t,m=o,v=e,g=s),y=CW.hashDifferencesBreakdown(e,n,u),b=CW.hashDifferencesBreakdown(t,n,u);var w=y.equal,E=b.equal,S=y.different,x=b.different,T=y.firstHashOnly,N=b.firstHashOnly,C=y.secondHashOnly,k=b.secondHashOnly,L=CW.invertArray(w),A=CW.invertArray(E),O=CW.invertArray(S),M=CW.invertArray(x),_=CW.invertArray(T),D=CW.invertArray(N),P=CW.invertArray(C),H=CW.invertArray(k),B=S.concat(T).concat(C),j=x.concat(N).concat(k),F=CW.invertArray(B),I=CW.invertArray(j),q=CW.combineHashes(F,I),R;for(R in F)q[R]=!0;for(R in I)q[R]=!0;var U=CW.invertHash(q),z,W,X,V,$,J=SC.clone(q,YES),K=[],Q;if(r)for(z=0,W=r.length;z<W;++z){Q=[],X=r[z];for(V=0,$=X.length;V<$;++V)R=X[V],Q.push(R),delete J[R];K.push(Q)}for(R in J)K.push(R),delete J[R];var G,Y,Z,et,tt,nt,rt,it;for(z=0,W=K.length;z<W;++z){Q=K[z],Y=Z=null,G=!(Q instanceof Array);if(G){R=Q,Y=F[R]?R:null,Z=I[R]?R:null;if(Y||Z)et=CW.valuesAreEqual(e[R],t[R]),Y=Y&&!et?R:null,Z=Z&&!et?R:null}else for(V=0,$=Q.length;V<$;++V)R=Q[V],F[R]?I[R]?CW.valuesAreEqual(e[R],t[R])||(Y?Y.push(R):Y=[R],Z?
Z.push(R):Z=[R]):Y?Y.push(R):Y=[R]:I[R]&&(Z?Z.push(R):Z=[R]);if(Y&&Z)if(G)f.indexOf(R)===-1&&f.push(R),tt=d[R],nt=v[R],O[R]&&M[R]?(SC.debug("  >  Merge conflict for '%@' (both changed the value).  Preferring value '%@' from %@ over value '%@' from %@ (preferMergeFromIfConflict=%@, and the original value was '%@')…",R,tt,m,nt,g,!!i,n[R]),i&&l.push(R)):_[R]&&D[R]?(SC.debug("  >  Merge conflict for '%@' (both added a value for this key, but they do not match).  Preferring value '%@' from %@ over value '%@' from %@ (preferMergeFromIfConflict=%@)…",R,tt,m,nt,g,!!i),i&&l.push(R)):O[R]&&H[R]?i?(SC.debug("  >  Merge conflict for '%@' (%@ changed the value, %@ removed it).  Preferring value '%@' from %@ over removal from %@ (preferMergeFromIfConflict=%@)…",R,s,o,tt,m,g,!!i),c.push(R)):SC.debug("  >  Merge conflict for '%@' (%@ changed the value, %@ removed it).  Preferring removal from %@ over value '%@' from %@ (preferMergeFromIfConflict=%@)…",R,s,o,m,nt,g,!!i):P[R]&&M[R]?i?(SC.debug("  >  Merge conflict for '%@' (%@ changed the value, %@ removed it).  Preferring removal from %@ over value '%@' from %@ (preferMergeFromIfConflict=%@)…",R,o,s,m,nt,g,!!i),h.push(R)):SC.debug("  >  Merge conflict for '%@' (%@ changed the value, %@ removed it).  Preferring value '%@' from %@ over removal from %@ (preferMergeFromIfConflict=%@)…",R,o,s,tt,m,g,!!i):CW.fatalError("Bad merge state:  We’re claiming that there’s a merge conflict for a single key, but the combination doesn’t make sense",{key:R,mergeFrom:s,mergeFromValue:e[R],changedInMergeFrom:O[R],addedInMergeFrom:_[R],removedInMergeFrom:P[R],mergeTo
:o,mergeToValue:t[R],changedInMergeTo:M[R],addedInMergeTo:D[R],removedInMergeTo:H[R]});else{SC.debug("  >  Merge conflict for grouped properties [%@]:  dirty in %@: [%@],  dirty in %@: [%@]",Q,s,Y,o,Z);if(i){SC.debug("  >  Will prefer all values for this group as they are in %@",s);for(V=0,$=Q.length;V<$;++V)R=Q[V],!L[R]&&f.indexOf(R)===-1&&f.push(R),rt=e[R],it=t[R],it===undefined?rt!==undefined&&(SC.debug("       -  adding '%@' ('%@') from %@, since it’s not in %@…",R,rt,s,o),c.push(R)):rt===undefined?(SC.debug("       -  removing '%@' ('%@') from %@, since it’s not in %@…",R,it,o,s),h.push(R)):CW.valuesAreEqual(rt,it)||(SC.debug("       -  taking '%@' ('%@') from %@, which will overwrite %@’s previous value ('%@')…",R,rt,s,o,it),l.push(R))}else{SC.debug("  >  Will prefer all values for this group as they are in %@",o);for(V=0,$=Q.length;V<$;++V)R=Q[V],!L[R]&&f.indexOf(R)===-1&&f.push(R)}}else if(G)rt=e[R],it=t[R],O[R]?M[R]?SC.debug("  >  no need to merge '%@' ('%@'), even though it changed in both, since both changed it to the same value…",R,rt):(SC.debug("  >  taking value from %@ for '%@' ('%@'), since it didn’t change in %@ (it was '%@')…",s,R,rt,o,it),l.push(R)):_[R]?D[R]?SC.debug("  >  no need to merge '%@' ('%@'), even though it was added to both, since both added the same value…",R,rt):(SC.debug("  >  taking value from %@ for '%@' ('%@'), since it was only added there…",s,R,rt),c.push(R)):P[R]&&(H[R]?SC.debug("  >  no need to merge '%@' ('%@'), because it was removed from both…",R,rt):(SC.debug("  >  removing value for '%@' ('%@') from %@, since it was removed from %@…"
,R,it,o,s),h.push(R)));else{a&&SC.debug("  >  Considering group of keys [%@]…",Q);for(V=0,$=Q.length;V<$;++V)R=Q[V],rt=e[R],it=t[R],O[R]?(SC.debug("       -  taking '%@' ('%@') from %@, which will overwrite %@’s previous value ('%@')…",R,rt,s,o,it),l.push(R)):_[R]?(SC.debug("       -  adding '%@' ('%@') from %@, since it’s not in %@…",R,rt,s,o),c.push(R)):P[R]?(SC.debug("       -  removing '%@' ('%@') from %@, since it’s not in %@…",R,it,o,s),h.push(R)):a&&SC.debug("       -  no need to take '%@' ('%@') from %@, since it’s the same value in %@…",R,rt,s,o)}}var st=l.concat(c),ot;for(z=0,ot=st.length;z<ot;++z)R=st[z],t[R]=SC.clone(e[R],YES);for(z=0,ot=h.length;z<ot;++z)R=h[z],delete t[R];return{mergeConflictKeys:f,changedKeys:l,addedKeys:c,removedKeys:h}},_updateLock:function(e){var t=this.locks,n,r;t||CW.fatalError("Store has no locks defined, and we expected the specified storeKey to be locked during the merge.",{target:this,storeKey:e}),t[e]||CW.fatalError("Store has no lock for the specified storeKey, and we expected it to be locked during the merge.",{target:this,storeKey:e}),n=this.revisions[e],t[e]=n||1}},CW.StoreCommon={delegate:null,chain:function(e,t){return t||(t=CW.NestedStore),arguments.callee.base.call(this,e,t)},storageManager:null,getCurrentCommitCycle:function(){var e=null,t=this.getPath("storageManager.currentCycle");return t&&t.get("type")===CW.StorageCycle.COMMIT_CYCLE&&(e=t),e},commitAgentsFor:function(e){var t=this.commitAgents;return t?t[e]:null},lastCommitAgentWithParam:function(e,t){var n=this.commitAgents,r=null,i,s,o,u;if(n){n=n[e];if(n)for(s=n.length
,i=s-1;i>=0;--i){o=n[i],u=o.get("params");if(u&&u.hasOwnProperty(t)){r=o;break}}}return r},notifyCommitAgents:function(e,t,n){var r=this.commitAgentsFor(e),i,s,o,u;if(r)for(i=0,s=r.length;i<s;++i)o=r[i],o&&(u=o[t],u&&u.call(o,e,n))},previousDataHashesForNotify:null,commitAgents:null,_notifyRecordPropertyChange:function(e,t,n){var r=this.records,i=this.get("nestedStores"),s=SC.Store,o,u,a,f,l,c,h;a=i?i.length:0;for(f=0;f<a;f++){l=i[f],c=l.peekStatus(e),u=l.storeKeyEditState(e);if(u===s.INHERITED)l._notifyRecordPropertyChange(e,t,n);else if(c&SC.Record.BUSY){if(l.get("hasChanges"))throw s.CHAIN_CONFLICT_ERROR;l.reset()}else if(!l._isCommitting){var p=l.get("delegate");p?l.invokeDelegateMethod(p,"parentStoreRecordPropertyDidChange",this,l,e,t,n):SC.warn("%@:  Record with storeKey %@ changed underneath us, but since we have no merge delegate set, we won’t inherit the changes",l,e)}!t&&!this.get("parentStore")&&(delete this.previousDataHashesForNotify[e],this._savePreviousDataHashForNotify(e))}var d=this.recordPropertyChanges;return d||(d=this.recordPropertyChanges={storeKeys:SC.CoreSet.create(),records:SC.CoreSet.create(),hasDataChanges:SC.CoreSet.create(),propertyForStoreKeys:{}}),d.storeKeys.add(e),r&&(o=r[e])&&(d.records.push(e),t||d.hasDataChanges.push(e),n?((h=d.propertyForStoreKeys[e])||(h=d.propertyForStoreKeys[e]=SC.CoreSet.create()),h!=="*"&&h.add(n)):d.propertyForStoreKeys[e]="*"),this.invokeOnce(this.flush),this},_verifyLockRevisions:function(e,t,n){var r=this._mergedProperties,i=this._mergedDataHashes,s=!!n.getPath("delegate.shouldMergeOutdatedChangesWhenCommitting")
,o,u,a,f,l=SC.Record,c=CW.StorageCycleAction,h=e.length,p=this.revisions,d,v,m,g;if(t&&p)for(d=0;d<h;d++){v=e[d],m=t[v]||1,g=p[v]||1;if(m<g){var y=SC.Store.recordTypeFor(v);SC.debug("Potential conflict while committing from %@ down to %@:  storeKey %@, of type %@:",n,this,v,y);var b=n.peekStatus(v),w=this.peekStatus(v),E=SC.Record.DESTROYED,S=SC.Record.READY_NEW,x=b&E?c.STORAGE_OPERATION_DESTROY:c.STORAGE_OPERATION_UPDATE,T=NO,N,C,k;if(!s)throw SC.Store.CHAIN_CONFLICT_ERROR;SC.debug("  >  lock=%@,  current revision=%@",m,g),SC.debug("Version in %@:",n),SC.debug("%@",n.materializeRecord(v)),SC.debug("Version in %@:",this),SC.debug("%@",this.materializeRecord(v)),w&E?b&E?SC.debug("This record was destroyed in both stores, so ignoring it in the commit…"):C=c.ERROR_NOT_FOUND:b&E?C=c.ERROR_CONFLICT:(b===S&&w!==S&&n.writeStatus(v,SC.Record.READY_DIRTY),C=c.ERROR_CONFLICT);if(C){var L=n.get("delegate");L&&(T=n.invokeDelegateMethod(L,"mergeConflictDuringCommit",this,n,v,C,x))}if(T===NO)SC.debug("Removing this commit from %@’s changelog…",this.get("name")),k=n.changelog,k&&k.remove(v),k=n.chainedChanges,k&&k.remove(v),a=this.getCurrentCommitCycle(),a&&(f=a.get("changelog"),f&&f.remove(v)),this.notifyCommitAgents(v,"commitWasUnnecessaryAtStore");else if(T!==YES)throw SC.Store.CHAIN_CONFLICT_ERROR}}return this}},CW.HashAttribute=SC.Object.extend(CW.HashAttributeCommon,CW.HashAttributeSupport,{isHashAttribute:YES,normalize:function(e,t,n){this.get("isOrphan")&&CW.fatalError("normalize():  Cannot write to an orphan hash attribute",{target:this});var r=this.get("attributes"),i,s,o;r||(this
._neverHadAHash||CW.fatalError("normalize():  We once had a hash but no longer do",{target:this}),i=this.get("parent"),s=this.get("parentKey"),i?s?i.isHashAttributeArray&&CW.fatalError("normalize():  There are no attributes but the parent is a hash attribute array",{target:this,parent:i}):CW.fatalError("normalize():  There is no parentKey",{target:this,parent:i}):CW.fatalError("normalize():  There is no parent",{target:this}),r={},i.writeAttribute(s,r),this._neverHadAHash=NO),e(t,n)}.enhance(),_checkedKeys:SC.CoreSet.create(),isEmpty:function(){var e,t,n,r=this._checkedKeys.clear();for(e in this){t=this[e];if(!t||!t.isRecordAttribute)continue;n=this.get("key");if(n&&n.isEmpty&&n.isEmpty()||!this.attributeIsDefault(e))return NO;r.add(e)}var i=this.get("attributes");for(e in i)if(!r.contains(e))return NO;return YES},beginEditing:function(){return this._editLevel++,this},endEditing:function(e){return--this._editLevel<=0&&(this._editLevel=0,this.hashAttributeDidChange(e)),this},writeAttribute:function(e,t,n){if(this.get("isOrphan"))return SC.debug("writeAttribute():  Cannot write to an orphan hash attribute"),this;var r=this.get("attributes"),i,s,o;return r?t!==r[e]&&(n||this.beginEditing(),r[e]=t,n||this.endEditing(e)):(this._neverHadAHash||CW.fatalError("writeAttribute():  We once had a hash but no longer do",{target:this}),i=this.get("parent"),s=this.get("parentKey"),i?s?i.isHashAttributeArray&&CW.fatalError("writeAttribute():  There are no attributes but the parent is a hash attribute array",{target:this,parent:i}):CW.fatalError("writeAttribute():  There is no parentKey",{target
:this,parent:i}):CW.fatalError("writeAttribute():  There is no parent",{target:this}),r={},r[e]=t,i.writeAttribute(s,r),this._neverHadAHash=NO),this},storeDidChangeProperties:function(e,t){t?(this.beginPropertyChanges(),t.forEach(function(e){this.notifyPropertyChange(e)},this),this.endPropertyChanges()):this.allPropertiesDidChange();var n=this.relationships,r=n?n.length:0;while(--r>=0)n[r].recordPropertyDidChange(t)},unknownProperty:function(e,t){var n;return t!==undefined?(n=this.constructor,n.ignoreUnknownProperties===YES?this[e]=t:this.writeAttribute(e,t),t):this.readAttribute(e)},toString:function(){var e=arguments.callee.base.apply(this,arguments),t=this.peekAttributes();return e+="  "+SC.inspect(t),e},parentDidChange:function(){var e=this._previousParent,t=this.get("parent"),n=this.get("parentKey"),r;if(SC.none(n))return;e!==t&&(r=this.underlyingContentDidChange,e&&(e.unregisterHashAttribute&&e.unregisterHashAttribute(n,this),e.removeObserver(n,this,r)),t&&(t.registerHashAttribute&&t.registerHashAttribute(n,this),t.addObserver(n,this,r)),this._previousParent=t,r.call(this))}.observes("parent"),underlyingContentDidChange:function(){if(this._ignoreChangePropogation){this._ignoreChangePropogation=NO;return}if(this.get("isOrphan"))return;!this._neverHadAHash&&!this.peekAttributes()?this.orphan():this.allPropertiesDidChange()},init:function(){arguments.callee.base.apply(this,arguments);var e=this.get("parent");e||CW.fatalError("A hash attribute must have a parent",{hashAttribute:this}),!e.isRecord&&!e.isHashAttribute&&!e.isHashAttributeArray&&CW.fatalError("A hash attribute array’s parent must either be a record, a hash attribute, or a hash attribute array"
,{hashAttribute:this,parent:e}),this.peekAttributes()||(this._neverHadAHash=YES),this.parentDidChange()},_editLevel:0,_neverHadAHash:NO}),CW.HashAttribute.mixin({instantiateHashAttribute:function(e,t,n){return SC.kindOf(e,CW.HashAttribute)||CW.fatalError("%@ is not a kind of CW.HashAttribute".fmt(e)),e.create({parent:t,parentKey:n})},isComplex:YES,isHashAttribute:YES}),SC.RecordAttribute.registerTransform(CW.HashAttribute,{to:function(e,t,n,r,i){var s;return r?!r.kindOf(CW.Record)&&!r.kindOf(CW.HashAttribute)?CW.fatalError("The parent must be either an instance of subclass of either CW.Record or CW.HashAttribute",{parent:r,parentKey:i}):(s=r.hashAttributeFor(i),s||(s=CW.HashAttribute.instantiateHashAttribute(n,r,i))):CW.fatalError("Error during transform:  A parent must be specified"),s},from:function(e){e&&e.isHashAttribute&&CW.fatalError("You should never set a hash attribute directly",{target:this,instance:e})}}),CW.ManyHashAttribute=SC.RecordAttribute.extend({toType:function(e,t,n){var r=this.get("typeClass"),i=this.get("key")||t,s=SC.keyFor("__cw__hashAttributeArray__",SC.guidFor(this)),o=e[s],u,a;return e&&e.isRecord&&(u=e.get("store"),u&&!u.isCoreWebStore&&CW.fatalError("Hash attribute arrays require the ancestor record to belong to a CoreWeb store rather than an SC.Store",{target:this,parent:e,store:u})),o||(o=CW.HashAttributeArray.create({objectType:r,parent:e,parentKey:i,manyAttribute:this}),e[s]=o,a=e.get("relationships"),a?(a.push(o),a.enumerableContentDidChange()):e.set("relationships",[o])),o},fromType:function(e,t,n){var r=[],i,s;SC.isArray(n)||CW.fatalError("CW.ManyHashAttribute#fromType:  The toMany attribute should be an array"
);for(i=0,s=n.get("length");i<s;++i)r[i]=SC.clone(n.objectAt(i).get("attributes"),YES);return r}}),CW.Record=SC.Record.extend(CW.HashAttributeSupport,{typeString:function(){var e=this.get("store");if(!e)return null;var t=this.get("storeKey");if(!t)return null;var n=e.recordTypeFor(this.get("storeKey"));return n?n.typeString:null}.property("store","storeKey").cacheable(),childHashDidChange:function(e,t,n){var r=this.get("store");r.recordDidChange(null,null,this.get("storeKey"),e,YES),this.propagateToAggregates(),n||r.flush()},shortTypeString:function(){var e=this.get("store");if(!e)return null;var t=this.get("storeKey");if(!t)return null;var n=e.recordTypeFor(this.get("storeKey"));return n?n.shortTypeString():null}.property("store","storeKey").cacheable(),shortString:function(){var e=this.get("shortTypeString"),t;return e?(e=e.toLowerCase(),t=this.get("title"),t?e+=" “%@”".fmt(t):e+=" with ID %@".fmt(this.get(this.get("primaryKey")))):e=this.toString(),e},ownerProperty:null,owner:function(){var e=this.get("ownerProperty");return e?this.get("property"):null}.property("ownerProperty"),rootOwner:function(){var e=this.get("owner");return e?e.get("rootOwner"):this}.property("owner"),isAggregate:function(){var e=this.get("ownerProperty"),t=NO,n;return e&&(n=this[e],t=n&&n.aggregate),t}.property("ownerProperty"),aggregates:function(){var e=[],t,n,r,i,s,o,u,a,f,l,c,h,p,d,v;for(t in this){n=this[t];if(n){r=n.typeClass;if(r){r=r.call(n),i=SC.typeOf(r)===SC.T_CLASS;if(i){s=n.inverse;if(s){o=r.prototype[s];if(o){u=o.aggregate;if(u){a=this.get(t);if(a)for(f=0,l=a.get("length");f<l;++f){c=
a.objectAt(f),e.push(c),h=c.get("aggregates");if(h)for(p=0,d=h.length;p<d;++p)v=h[p],e.push(v)}}}}}}}}return e.length?e:null}.property(),usesHashAttributes:function(){var e=NO,t=this._hashAttributes,n,r,i,s;t&&t.length>0&&(e=YES);if(!e){n=this.relationships;if(n)for(r=0,i=n.length;r<i;++r){s=n[r];if(SC.kindOf(s,CW.HashAttributeArray)){e=YES;break}}}return e}.property().cacheable()}),SC.mixin(CW.Record,{toMany:function(e,t){return SC.kindOf(e,CW.HashAttribute)?CW.ManyHashAttribute.attr(e,t):SC.Record.toMany(e,t)},shortTypeString:function(){var e=this.typeString;return e&&(e=e.split("."),e=e[e.length-1]),e},storeKeyIfValid:function(e,t){e||CW.fatalError("storeKeyIfValid():  You must specify an ID."),t||CW.fatalError("storeKeyIfValid():  You must specify a store.");var n=this.storeKeyExists(e),r;return n&&(r=t.peekStatus(n),r===this.DESTROYED_CLEAN&&(n=null)),n}}),CW.AutoMergingNestedStoreDelegate=SC.Object.extend(CW.MergeDelegate,{shouldMergeOutdatedChangesWhenCommitting:YES,parentStoreRecordPropertyDidChange:function(e,t,n,r,i){if(r){t.propagateStatusIfAppropriateFromStore(e,n);return}var s=e.recordTypeFor(n),o,u;if(!s){SC.warn("%@:  Cannot determine the record type for storeKey=%@, which was changed in our parent store (%@)",this,n,e);return}o=i?"'"+i+"'":"all keys",SC.debug("%@:  Our parent store (%@) changed %@ of storeKey %@, which is a record of type %@.  Merging data…",t,e,o,n,s),u=s.propertyMergeGroups,t.propagateStatusIfAppropriateFromStore(e,n),t.mergeDataFromStore(e,n,i,undefined,u)},mergeConflictDuringCommit:function(e,t,n,r,i){var s,o,u,a=e.recordTypeFor(n),f=NO,l=
t.previousDataHashesForCommit[n];l||CW.fatalError("The nested store does not have a record of the original values of its data hash for a particular storeKey, which we need in order to commit.",{target:this,nestedStore:t,storeKey:n,recordType:a});var c=SC.clone(e.readDataHash(n),YES),h=t.readDataHash(n),p=e.mergeHashesAsPossible;if(p){SC.debug("Merging data for storeKey %@ from %@ down into %@…",n,t,this),u=p.call(this,h,c,l,a.propertyMergeGroups,NO,t.get("name"),this.get("name")),s=u.changedKeys.concat(u.addedKeys,u.removedKeys),o=u.mergeConflictKeys;if(s.length===0)return SC.debug("The merge for storeKey %@ resulted in there being no actual changes in %@…",n,this.get("name")),NO;f=o.length===0}if(f)return YES;this._reportMergeConflict(t,e,n,o,r,i);var d=a.typeString||a.toString();return SC.warn("Merge conflict for storeKey %@ (%@) during commit:  %@",n,d,o),NO},mergeConflictDuringNotify:function(e,t,n,r,i,s,o){var u=e.recordTypeFor(n),a=u.typeString||u.toString();return SC.warn("Merge conflict for storeKey %@ (%@) during notify:  %@",n,a,i),YES},_reportMergeConflict:function(e,t,n,r,i,s){var o=CW.StorageCycleAction,u=CW.errorController,a;if(!u)return;i||(i=o.ERROR_CONFLICT),s||(s=o.STORAGE_OPERATION_UPDATE),a=o.create({name:"Merging storeKey %@ from %@ to %@".fmt(n,e,t,this),type:o.TYPE_UPDATE,storageOperation:s,storeKeys:[n],status:o.STATUS_ERROR,error:i});var f=this.getPath("storageManager.errorController");f&&f.addActions([a])}}),CW.CommitAgent=SC.Object.extend({storeKeys:null,params:null,recordWasCommittedToStore:function(e,t){},commitWasUnnecessaryAtStore:function(e,t,
n){},recordWasCommittedToServer:function(e,t){},commitToServerFailed:function(e,t){}}),CW.HashAttributeArray=SC.Object.extend(CW.HashAttributeCommon,CW.HashAttributeSupport,SC.Enumerable,SC.Array,{isHashAttributeArray:YES,objectType:null,manyAttribute:null,normalize:function(e,t){var n=this._getReadOnlyUnderlyingArray(),r=n?n.get("length"):0,i,s;for(i=0;i<r;i++)s=this.objectAt(i),s.normalize(e,t);return this},length:function(){var e=this._getReadOnlyUnderlyingArray();return e?e.length:0}.property("parent","parentKey"),objectAt:function(e){var t=this._hashAttributes,n,r,i,s;return t&&(s=t[e]),s||(n=this._getReadOnlyUnderlyingArray(),n&&(r=n[e],r&&(SC.typeOf(r)!==SC.T_HASH&&CW.fatalError("objectAt():  The object in the array is not a hash",{hashAttributeArray:this,index:e}),i=this.get("objectType"),s=CW.HashAttribute.instantiateHashAttribute(i,this,e),t||(t=this._hashAttributes=[]),t[e]=s))),s},replace:function(e,t,n){var r=this._getEditableUnderlyingArray(),i=[],s=n?n.get?n.get("length"):n.length:0,o,u;this.arrayContentWillChange(e,t,s);for(o=0;o<s;++o)u=n.objectAt(o),SC.kindOf(u,CW.HashAttribute)?u=SC.clone(u.get("attributes"),YES):SC.typeOf(u)!==SC.T_HASH&&CW.fatalError("Illegal type of item specified in replace()",{target:this,index:o,items:n}),i.push(u);r.replace(e,t,i);var a=this._hashAttributes;if(a){var f=r?r.length:0,l=e+t,c=e+s;for(o=e;o<l;++o)u=a[o],u&&u.orphan();a.splice(e,t);for(o=e;o<f;++o)o<c?a.splice(o,0,null):(u=a[o])&&u.set("parentKey",o);f!==a.length&&CW.fatalError("Hash attribute array length is different from underlying array length",{target:this})}return this
.arrayContentDidChange(e,t,s),this.enumerableContentDidChange(),this.hashAttributeDidChange(null,YES),this},isEmpty:function(){var e=this._getReadOnlyUnderlyingArray();return!e||e.get("length")===0},_getReadOnlyUnderlyingArray:function(){var e=this.get("parent"),t=this.get("parentKey");return e||CW.fatalError("No parent defined"),t||CW.fatalError("No parentKey defined"),e.readAttribute(t)},_getEditableUnderlyingArray:function(){var e=this.get("parent"),t=this.get("parentKey"),n,r;return e||CW.fatalError("No parent defined"),t||CW.fatalError("No parentKey defined"),n=e.get("attributes"),r=n[t],r||(r=n[t]=[],this.recordPropertyDidChange(SC.Set.create([t])),this.hashAttributeDidChange(null,YES,YES)),r},recordPropertyDidChange:function(e){if(e&&!e.contains(this.get("parentKey")))return this;var t=this._previousUnderlyingArray,n=this._getReadOnlyUnderlyingArray(),r=0,i=0;t&&(r=t.get("length")),this._previousUnderlyingArray=n,n&&(i=n.get("length"));var s=Math.max(0,r-i),o=Math.max(0,i-r),u=Math.min(i,r);this.arrayContentWillChange(u,s,o);var a=this._hashAttributes;if(a){var f,l,c=Math.max(r,i);for(f=0;f<c;f++)l=a[f],l&&(f<i?l.allPropertiesDidChange():l.orphan());a.length=i}this.arrayContentDidChange(u,s,o),this.enumerableContentDidChange()},_orphan:function(){var e=this._hashAttributes,t,n,r;if(e){for(t=0,n=e.length;t<n;++t)r=e[t],r&&r.orphan();this._hashAttributes=null}},init:function(){arguments.callee.base.apply(this,arguments);var e=this.get("parent");e||CW.fatalError("A hash attribute array must have a parent",{hashAttributeArray:this}),!e.isRecord&&!e.isHashAttribute&&CW.fatalError
("A hash attribute array’s parent must either be a record or a hash attribute",{hashAttributeArray:this}),this.recordPropertyDidChange()},_hashAttributes:null,_previousUnderlyingArray:null}),CW.HashAttributeArray.mixin({isComplex:YES,isHashAttributeArray:YES}),CW.NestedStore=SC.NestedStore.extend(CW.StoreCommon,SC.DelegateSupport,{isCoreWebStore:YES,hasChangesInStoreHierarchy:function(){if(this.get("hasChanges"))return YES;var e=this.get("nestedStores"),t,n,r;if(e)for(t=0,n=e.length;t<n;++t){r=e[t];if(r.get("hasChangesInStoreHierarchy"))return YES}return NO},commitChanges:function(e,t,n){this._isCommitting=YES;var r=this,i,s,o,u,a,f,l,c,h,p;n&&(s=this.chainedChanges,s||CW.fatalError("Requested to commit a subset of storeKeys but there is no chainedChanges set",{target:this,storeKeys:n}),n.forEach(function(e){s.contains(e)||CW.fatalError("Requested to commit a storeKey that is not in the chainedChanges set",{target:this,storeKeys:n,chainedChanges:s})}),i=this.changelog,i&&i.removeEach(n),s&&s.removeEach(n),this._dataHashesToRestore={},this._revisionsToRestore={},this._statusesToRestore={},this._locksToRestore={},this._editablesToRestore={},this._previousDataHashesForNotifyToRestore={},this._previousDataHashesForCommitToRestore={},this._commitAgentsToRestore={},u=["dataHashes","revisions","statuses","locks","editables","previousDataHashesForNotify","previousDataHashesForCommit","commitAgents"],a=u.length,s.forEach(function(e){for(f=0;f<a;++f)l=u[f],c=r[l],c&&c.hasOwnProperty(e)&&(h="_"+l+"ToRestore",r[h][e]=c[e])}),this._changelogAfterCommit=i,this._chainedChangesAfterCommit=s
,this.changelog=this.chainedChanges=n);if(t){var d=t.get("storeKeys");d||(d=SC.CoreSet.create(),s=this.chainedChanges,s&&d.addEach(s));var v=this.commitAgents;v||(v=this.commitAgents={}),d.forEach(function(e){var n=v[e];n||(n=v[e]=[],n.push(t))})}var m=arguments.callee.base.apply(this,arguments);if(n){i=this._changelogAfterCommit,s=this._chainedChangesAfterCommit,this._changelogAfterCommit=null,this._chainedChangesAfterCommit=null;if(s.get("length")>0){var g;s.forEach(function(e){for(f=0;f<a;++f)l=u[f],h="_"+l+"ToRestore",c=r[h],c.hasOwnProperty(e)&&(g=r[l],g||(g=r[l]={}),g[e]=c[e])}),this.changelog=i,this.chainedChanges=s,this.set("hasChanges",YES)}}return this._isCommitting=NO,m},reset:function(){var e=this.get("parentStore");if(!e)throw SC.Store.NO_PARENT_STORE_ERROR;var t=this.dataHashes,n=this.statuses;this.dataHashes=SC.beget(e.dataHashes),this.revisions=SC.beget(e.revisions),this.statuses=SC.beget(e.statuses);var r=this.get("nestedStores"),i,s,o;if(r)for(i=0,s=r.length;i<s;++i)o=r[i],o._fixUpProtypeChainsAfterParentReset||CW.fatalError("The nested store is not a CW.NestedStore, and it needs to be for correct behavior.  A critical bugfix we have made for persistent nested stores has not yet made its way into SproutCore.",{target:this,nestedStore:o}),o._fixUpProtypeChainsAfterParentReset();this.previousDataHashesForNotify=SC.beget(e.previousDataHashesForNotify),this.previousDataHashesForCommit={},this.commitAgents=null,this.chainedChanges=this.locks=this.editables=null,this.changelog=null;var u={},a={},f;if(t){var l,c,h=this.dataHashes,p=CW.valuesAreEqual;for(f in t){if(!
t.hasOwnProperty(f))continue;l=t[f],c=h[f],p(l,c)||(u[f]=YES)}}if(n){var d,v,m=this.statuses;for(f in n){if(!n.hasOwnProperty(f))continue;d=n[f],v=m[f],d!==v&&(a[f]=YES)}}var g;for(f in a)u[f]?(g=NO,delete u[f]):g=YES,this._notifyRecordPropertyChange(parseInt(f,10),g);for(f in u)this._notifyRecordPropertyChange(parseInt(f,10),NO);this.set("hasChanges",NO)},commitChangesFromNestedStore:function(e,t,n){CW.Store.prototype.commitChangesFromNestedStore.apply(this,arguments);var r=this.get("parentStore"),i=r.revisions,s,o=this.locks,u=this.chainedChanges,a,f;o||(o=this.locks=[]),u||(u=this.chainedChanges=SC.Set.create()),a=t.length;for(s=0;s<a;s++)f=t[s],o[f]||(o[f]=i[f]||1),u.add(f);return this.setIfChanged("hasChanges",u.get("length")>0),this.flush(),this},_isCommitting:NO,previousDataHashesForCommit:null,readEditableDataHash:function(e){var t=this.recordTypeFor(e);return this._savePreviousDataHashForNotify(e,t),this._savePreviousDataHashForCommit(e,t),arguments.callee.base.apply(this,arguments)},writeDataHash:function(e,t,n){return t&&(this._savePreviousDataHashForNotify(e),this._savePreviousDataHashForCommit(e)),arguments.callee.base.apply(this,arguments)},_savePreviousDataHashForNotify:function(e,t){var n=this.get("nestedStores");if(n&&n.length>0){var r=this.previousDataHashesForNotify;if(!r[e]||!r.hasOwnProperty(e))r[e]=SC.clone(this.dataHashes[e],YES)}},_savePreviousDataHashForCommit:function(e){var t=this.previousDataHashesForCommit;if(!t[e]||!t.hasOwnProperty(e))t[e]=SC.clone(this.dataHashes[e],YES)},_lock:function(e){var t=this.locks,n,r;if(t&&t[e])return this;t||(t=this
.locks=[]),r=this.editables,r&&(r[e]=0);var i=this.get("parentStore"),s;while(i&&(s=i.storeKeyEditState(e))===SC.Store.INHERITED)i=i.get("parentStore");var o=this.recordTypeFor(e);return this._savePreviousDataHashForNotify(e,o),this._savePreviousDataHashForCommit(e,o),i&&s===SC.Store.EDITABLE?(this.dataHashes[e]=SC.clone(i.dataHashes[e],YES),r||(r=this.editables=[]),r[e]=1):i&&s===SC.Store.LOCKED?this.dataHashes[e]=SC.clone(i.dataHashes[e],YES):this.dataHashes[e]=this.dataHashes[e],this.statuses[e]=this.statuses[e],n=this.revisions[e]=this.revisions[e],t[e]=n||1,this},_fixUpProtypeChainsAfterParentReset:function(){var e=this.get("parentStore");if(!e)throw SC.Store.NO_PARENT_STORE_ERROR;var t=this.__fieldsForWhichToFixPrototypes,n,r,i,s,o,u;for(n=0,r=t.length;n<r;++n){i=t[n],s=this[i],o={};for(u in s)s.hasOwnProperty(u)&&(o[u]=s[u]);var a=SC.beget(e[i]);this[i]=a;for(u in o)a[u]=o[u]}var f=this.get("nestedStores"),l;if(f)for(n=0,r=f.length;n<r;++n)l=f[n],l._fixUpProtypeChainsAfterParentReset()},__fieldsForWhichToFixPrototypes:["dataHashes","revisions","statuses"]}),CW.ManagedNestedStore=CW.NestedStore.extend(CW.MergeSupport,{storageManager:null,extendedLogging:NO,lockOnRead:NO,commitChanges:function(e,t){var n=this.get("parentStore"),r=this.get("extendedLogging"),i,s,o,u,a,f,l,c;n||CW.fatalError("A managed nested store must have a parent store",{managedNestedStore:this}),n.get("parentStore")&&CW.fatalError("A managed nested store’s parent store must be a root-level store",{managedNestedStore:this}),t&&(i=t.get("storeKeys"),i||(i=SC.CoreSet.create(),s=this.chainedChanges,s&&i.
addEach(s)),o=this.commitAgents,o||(o=this.commitAgents={}),i.forEach(function(e){var n=o[e];n||(n=o[e]=[],n.push(t))})),u=YES,a=CW.StorageCycle.COMMIT_CYCLE,f=this._getStorageManager();if(f.get("currentCycle")){r&&SC.debug("%@:  The storage manager says there’s an ongoing cycle, so we'll enqueue this commit request…",this);var h=f.pendingCycleOfType(a);h&&(r&&SC.debug("%@:  …but there is already a commit cycle pending, so I don’t need to schedule another one.",this),e&&(c=h.get("params"),c?(c.force=YES,h.notifyPropertyChange("params")):(c={force:YES},h.set("params",c))),u=NO)}return u&&(l=CW.StorageCycle.createCycle(a,f),e&&l.set("params",{force:YES}),f.scheduleCycle(l)),this},commitChangesFromNestedStore:function(e,t,n){return arguments.callee.base.apply(this,arguments),this.get("extendedLogging")&&SC.debug("%@:  Store keys were committed to the managed store:  %@",this,t),this.commitChanges(n)},init:function(){arguments.callee.base.apply(this,arguments);var e=this.get("delegate");e&&SC.typeOf(e)===SC.T_CLASS&&this.set("delegate",e.create())},_getStorageManager:function(){var e=this.get("storageManager");return e||CW.fatalError("Managed nested store has no storage manager defined",{target:this}),e}}),CW.StorageCycleAction=SC.Object.extend({name:null,type:null,storageOperation:null,status:null,storeKeys:null,responses:null,params:null,error:null,errorHandled:null,addStoreKeys:function(e){var t=this.get("storeKeys");t||(t=[],this.set("storeKeys",t)),SC.typeOf(e)===SC.T_ARRAY?(t=t.concat(e),this.set("storeKeys",t)):(t.push(e),t.enumerableContentDidChange())},getSingleStoreKey
:function(){var e=this.get("storeKeys");return e&&e.length===1?e[0]:null},addResponse:function(e){var t=this.get("responses");t?t.pushObject(e):(t=[e],this.set("responses",t))},setParam:function(e,t){var n=this.get("params");n||(n={},this.set("params",n)),n[e]=t},paramValueForKey:function(e,t){var n=this.get("params");return n?n[e]:undefined},init:function(){this.get("storageOperation")||CW.fatalError("A storage cycle action must have a storage operation"),this.get("status")||this.set("status",CW.StorageCycleAction.STATUS_ONGOING)},toString:function(){var e="",t=arguments.callee.base.apply(this,arguments),n=["name","type","storageOperation","status","storeKeys","params","responses","error","errorHandled"],r,i,s,o,u,a,f;for(r=0,i=n.length;r<i;++r){s=n[r];if(s)if(s==="params"){f=[],o=this.get("params");for(u in o)f.push(u+"="+o[u]);f="{"+f.join(", ")+"}",e+=s+"="+f}else e+=s+"='%@'".fmt(this.get(s));r!==i-1&&(e+=",  ")}return e+="  ("+t+")",e}}),CW.StorageCycleAction.mixin({TYPE_CREATE:"CREATE",TYPE_UPDATE:"UPDATE",TYPE_DESTROY:"DESTROY",STORAGE_OPERATION_CREATE:"CREATE",STORAGE_OPERATION_UPDATE:"UPDATE",STORAGE_OPERATION_DESTROY:"DESTROY",STORAGE_OPERATION_RETRIEVE:"RETRIEVE",STORAGE_OPERATION_FETCH:"FETCH",STATUS_ONGOING:"ongoing",STATUS_SUCCESS:"success",STATUS_ERROR:"error",ERROR_CONFLICT:"CONFLICT",ERROR_NOT_FOUND:"NOT_FOUND",ERROR_NOT_ALLOWED:"NOT_ALLOWED",ERROR_EXCEPTION:"EXCEPTION",ERROR_NOT_AUTHORIZED:"NOT_AUTHORIZED",ERROR_QUOTA_EXCEEDED:"QUOTA_EXCEEDED"}),CW.StorageCycle=SC.Object.extend({extendedLogging:NO,type:null,storageManager:null,params:null,currentStageIndex
:null,currentStage:function(){var e=this.constructor.stages[this.get("currentStageIndex")];return e||(e="beginning"),e}.property("currentStageIndex").cacheable(),getManagedStore:function(){return this.getPath("storageManager.managedStore")},getMainStore:function(){return this.getPath("storageManager.mainStore")},actions:null,addNewAction:function(e,t,n,r){var i=CW.StorageCycleAction.create({name:e,type:t,storageOperation:n});return r&&i.addStoreKeys(r),this.addAction(i),i},addAction:function(e){var t=this.get("actions");t?t.pushObject(e):(t=[e],this.set("actions",t))},actionsForStoreKey:function(e){var t=this.get("actions"),n=null,r,i,s,o;if(t)for(r=0,i=t.length;r<i;++r)s=t[r],o=s.get("storeKeys"),o&&o.indexOf(e)!==-1&&(n?n.push(s):n=[s]);return n},actionsForStoreKeyAndStorageOperation:function(e,t){var n=this.actionsForStoreKey(e),r=null;if(n){var i,s,o;for(i=0,s=n.length;i<s;++i)o=n[i],o.get("storageOperation")===t&&(r?r.push(o):r=[o])}return r},lastActionForStoreKeyAndStorageOperation:function(e,t){var n=this.actionsForStoreKeyAndStorageOperation(e,t);return n?n[n.length-1]:null},dataChangeFunctions:null,scheduleDataChange:function(e){var t=this.get("currentStage"),n=this.constructor,r=n.DATA_CHANGE_STAGE,i;t===r?e.call():n.scheduleOrderForStage(t)>n.scheduleOrderForStage(r)?CW.fatalError("You cannot schedule a data change after the “data change” stage has already passed"):(i=this.get("dataChangeFunctions"),i?i.pushObject(e):(i=[e],this.set("dataChangeFunctions",i)))},"data change":function(){var e=this.get("dataChangeFunctions"),t,n,r;if(e)for(t=0,n=e.length;t<n;++t)r=e[
t],r.call()},_hasEnded:NO,begin:function(){this.advanceToNextStage()},end:function(){if(this.get("_hasEnded"))return;this.set("_hasEnded",YES),this.invokeLater(this._end)},_end:function(){var e=this.get("storageManager");if(!e)throw new"A storage manager must be defined";e.cycleDidEnd(this)},advanceToNextStage:function(){if(this.get("_hasEnded"))return;var e=CW.StorageCycle,t=this.constructor.stages,n=this.get("currentStageIndex"),r;SC.none(n)?r=0:r=n+1,r>=t.length?this.end():(this.get("extendedLogging")&&SC.debug("Transitioning ongoing %@ cycle from '%@' to '%@' stage…",this.get("type"),this.get("currentStage"),t[r]),this.set("currentStageIndex",r),this.currentStageDidChange())},stageWillBegin:function(e){},init:function(){arguments.callee.base.apply(this,arguments),this.get("type")||CW.fatalError("Every cycle must have a 'type' specified.",{target:this})},currentStageDidChange:function(){if(this.get("_hasEnded"))return;var e=CW.StorageCycle,t=this.get("currentStage"),n=this.get("extendedLogging"),r,i,s,o,u,a,f;t||CW.fatalError("There is no stage defined",{target:this,currentStageIndex:this.get("currentStageIndex")}),r=this[t],r||CW.fatalError("There is no method defined for the current stage",{target:this,stage:t}),this.stageWillBegin(t),r&&r.call(this,this.get("params")),i=CW.RequestManagement.sharedInstance(),s=i.pendingRequestsForCycle(this),o=i.outstandingResponsesForCycle(this),u=s?s.length:0,a=o?o.length:0,f=u+a,f===0?(n&&SC.debug("We can automatically advance from the '%@' stage to the next stage…",t),this.advanceToNextStage()):n&&(f===1?SC.debug("We cannot advance from the '%@' stage to the next stage yet, because there is 1 pending/outstanding request…"
,t):SC.debug("We cannot advance from the '%@' stage to the next stage yet, because there are %@ pending/outstanding requests…",t,f))},toString:function(){var e=arguments.callee.base.apply(this,arguments),t=this.get("type");return t&&(e=t+" cycle ("+e+")"),e}}),CW.StorageCycle.mixin({stages:null,priority:50,isPreemptible:NO,shouldBeCoalesced:NO,shouldLogLifetime:YES,createCycle:function(e){e||CW.fatalError("createCycle():  You must specify a cycle type");var t=this._typeToClassMapping,n=CW.StorageCycle,r;return t&&(r=t[e]),r||CW.fatalError("There is no registered storage cycle class for the specified type",{type:e}),r.create()},registerClassForCycleType:function(e,t){e||CW.fatalError("registerClassForCycleType():  You must specify a cycle type"),t||CW.fatalError("registerClassForCycleType():  You must specify a storage cycle subclass",{type:e}),t.isClass||CW.fatalError("registerClassForCycleType():  The specified storage cycle subclass is not a class",{type:e,klass:t});var n=this._typeToClassMapping;n||(n=this._typeToClassMapping={}),n[e]=t},scheduleOrderForStage:function(e){e||CW.fatalError("scheduleOrderForStage():  You must specify a stage");var t=this.stages,n=t.indexOf(e);return n===-1&&CW.fatalError("scheduleOrderForStage():  Invalid stage specified",{stage:e}),n},COMMIT_CYCLE:"commit",READ_CYCLE:"read",IDLE_CYCLE:"idle",DATA_CHANGE_STAGE:"data change",_typeToClassMapping:null}),CW.CommitCycle=CW.StorageCycle.extend({extendedLogging:NO,type:CW.StorageCycle.COMMIT_CYCLE,changelog:null,dataHashesCheckpointBeforeCycle:null,statusesCheckpointBeforeCycle:null,dataHashesCheckpointBeforeCycleStage
:null,statusesCheckpointBeforeCycleStage:null,determineChangelog:function(e){var t=SC.Set.create(),n=e.changelog,r={},i={},s={},o=NO,u=this,a=this.get("extendedLogging");n&&n.forEach(function(f){if(r[f])return;var l=e.materializeRecord(f),c;l||CW.fatalError("Could not determine data dependencies because there was an error materializing a record",{store:e,storeKey:f}),a&&SC.debug("Looking at ancestors of storeKey %@:  %@",f,l.shortString());var h=NO,p,d,v,m;d=p=l;while((d=d.get("owner"))&&!h){a&&SC.debug("  >  ancestor:  %@",d.shortString()),v=d.storeKey;if(p.get("isAggregate")){n.contains(v)||CW.fatalError("The ancestor is the aggregate of the child record, but is not in the changelog along with the child",{ancestor:d,child:p}),a&&SC.debug("  >  ancestor %@ is the aggregate of the child %@, so there’s no need to consider the child when scheduling",d.shortString(),p.shortString()),s[f]=d;break}if(n.contains(v)&&!r[v]){m=u._operationOrder(d),a&&SC.debug("  >  Ordering between child %@ and ancestor %@:  %@",l.shortString(),d.shortString(),m);if(m===-1){a&&SC.debug("  >  We must handle ancestor %@ before child %@…",d.shortString(),p.shortString()),r[f]=YES,h=YES;break}m!==0&&(m===1?(a&&SC.debug("  >  We must handle child %@ before ancestor %@…",p.shortString(),d.shortString()),r[v]=YES):CW.fatalError("Unexpected ordering for ancestor and child",{ordering:m,storeKey:f,ancestorStoreKey:v}))}p=d}if(!h){var g=l.get("rootOwner"),y=YES,b=NO;if(g){b=g===l,b&&o&&(a&&SC.debug("We cannot include %@ in the current commit cycle because a different root ancestor is already being included",l.
shortString()),y=NO);if(y){var w=g.get("id"),E=s[f];!E&&i[w]&&(a&&SC.debug("We cannot include %@ in the current commit cycle because a different record from the same root ancestor is already being included (%@)",l.shortString(),i[w].shortString()),y=NO)}}y&&(b&&(o=YES),a&&SC.debug("We can include %@ in the current commit cycle",l.shortString()),E||(i[w]=l),t.add(f))}else a&&SC.debug("We cannot include %@ in the current commit cycle because an ancestor must be handled first",l.shortString())});if(a){var f=t.get("length"),l=f===1?"record is":"records are",c;SC.debug("%@ %@ being included in this commit cycle:",f,l),t.forEach(function(t){var n="",r=s[t];r&&(n="  [sent as part of parent %@]".fmt(r.shortString())),c=e.materializeRecord(t),SC.debug("  *  %@%@",c.shortString(),n)});var h=SC.Set.create();n.forEach(function(e){t.contains(e)||h.add(e)}),f=h.get("length"),f>0&&(l=f===1?"record":"records",SC.debug("%@ %@ will have to wait for a later commit cycle:",f,l),h.forEach(function(t){c=e.materializeRecord(t),SC.debug("  *  %@",c.shortString())}))}return t},_operationOrder:function(e){var t=SC.Record,n=e.get("status");switch(n){case t.READY_NEW:return-1;case t.DESTROYED_DIRTY:return 1;default:return 0}},prepareDataCheckpointForCycle:function(){var e,t;e=this.dataHashesCheckpointBeforeCycle={},t=this.statusesCheckpointBeforeCycle={},this._saveDataCheckpoint(e,t)},prepareDataCheckpointForCycleStage:function(){var e,t;e=this.dataHashesCheckpointBeforeCycleStage={},t=this.statusesCheckpointBeforeCycleStage={},this._saveDataCheckpoint(e,t)},resetCheckpointData:function(){this.dataHashesCheckpointBeforeCycle=
null,this.statusesCheckpointBeforeCycle=null,this.dataHashesCheckpointBeforeCycleStage=null,this.statusesCheckpointBeforeCycleStage=null},_saveDataCheckpoint:function(e,t){var n=this.get("changelog"),r=this.getMainStore();n&&n.forEach(function(n){var i=r.readDataHash(n),s,o,u,a,f,l;e[n]=SC.clone(i,YES),t[n]=r.peekStatus(n),s=r.materializeRecord(n),o=s.get("aggregates");if(o)for(u=0,a=o.length;u<a;++u)f=o[u],l=f.storeKey,i=r.readDataHash(l),e[l]=SC.clone(i,YES),t[l]=r.peekStatus(l)})},removeFromStoreChangelog:function(e){var t=this.get("currentStage"),n=CW.StorageCycle;n.scheduleOrderForStage(t)>=n.scheduleOrderForStage(CW.CommitCycle.COMMIT_STAGE)&&CW.fatalError("You must call removeFromStoreChangelog() before the commit cycle’s commit stage");var r=this.getMainStore(),i=r.changelog;i&&i.remove(e)},restoreDataToPreCycleCheckpoint:function(e){e||CW.fatalError("You must specify a storeKey");var t=this.get("changelog"),n,r,i,s;t||CW.fatalError("restoreDataToPreCycleCheckpoint():  There is no changelog defined, so we cannot restore the previous data",{storeKey:e}),t.contains(e)||CW.fatalError("restoreDataToPreCycleCheckpoint():  The changelog does not include the specified storeKey, so we cannot restore the previous data for it",{storeKey:e}),n=this.getMainStore(),r=this.get("dataHashesCheckpointBeforeCycle"),i=r[e],s=n.recordTypeFor(e),SC.info("Restoring previous data for storeKey %@, which is a record of type %@, as it was at the beginning of this commit cycle…",e,s.typeString),i&&(i=SC.clone(i)),n.writeDataHash(e,i),n.dataHashDidChange(e)},begin:function(){var e=this.get("storageManager"
),t=e.get("managedStore"),n=t.get("parentStore"),r=this.get("params"),i=r?r.force:NO,s=CW.StorageCycle,o=this.get("extendedLogging"),u,a,f,l;o&&SC.debug("%@:  Committing data from managed store (%@) down to main store (%@)…",this,t,n),u=t.changelog,u?(a=this.determineChangelog(t),a.get("length")!==u.get("length")&&(f=s.COMMIT_CYCLE,l=e.pendingCycleOfType(f),l||(l=s.createCycle(f,e),e.scheduleCycle(l))),this.set("changelog",a),this.prepareDataCheckpointForCycle(),this.prepareDataCheckpointForCycleStage(),CW.NestedStore.prototype.commitChanges.call(t,i,undefined,a)):t.get("hasChanges")&&(SC.debug("Simply resetting the managed store because there are 'chainedChanges' but nothing in the changelog."),t.reset()),arguments.callee.base.apply(this,arguments)},stageWillBegin:function(e){arguments.callee.base.apply(this,arguments);var t=this.getMainStore();t.flush(),this.prepareDataCheckpointForCycleStage()},"commit data":function(e){var t=this.getMainStore(),n=this.get("changelog"),r=n?n.get("length"):0,i;if(r>0){var s=SC.Record.ERROR,o,u,a,f;for(o=0;o<r;++o)u=n[o],a=t.peekStatus(u),a===s&&(f=t.materializeRecord(u),CW.fatalError("Trying to call commitRecords on a record that has status ERROR",{recordType:f.get("shortTypeString"),storeKey:u}));i=t.commitRecords(null,null,n),i===NO&&SC.debug("No records were committed to the main store.  This usually means that something was in the changelog but was marked as clean.")}},"data change":function(){arguments.callee.base.apply(this,arguments);var e=this.getPath("storageManager.errorController");e&&e.addActions(this.get("actions"))},end:function(
){var e=this.getMainStore(),t=e.commitAgents,n;t&&(n=this.get("changelog"),n&&n.forEach(function(e){delete t[e]})),this.resetCheckpointData(),arguments.callee.base.apply(this,arguments)}}),CW.CommitCycle.mixin({stages:["commit data",CW.StorageCycle.DATA_CHANGE_STAGE],priority:2,shouldBeCoalesced:YES,COMMIT_STAGE:"commit data"}),CW.StorageCycle.registerClassForCycleType(CW.StorageCycle.COMMIT_CYCLE,CW.CommitCycle),CW.IdleCycle=CW.StorageCycle.extend({type:CW.StorageCycle.IDLE_CYCLE,"issue request":function(e){CW.fatalError("idle cycle 'issue request' stage:  You must implement this method")}}),CW.IdleCycle.mixin({stages:["issue request",CW.StorageCycle.DATA_CHANGE_STAGE],priority:1,shouldBeCoalesced:YES,isPreemptible:YES}),CW.StorageCycle.registerClassForCycleType(CW.StorageCycle.IDLE_CYCLE,CW.IdleCycle),CW.ReadCycle=CW.StorageCycle.extend({type:CW.StorageCycle.READ_CYCLE,requests:null,addRequest:function(e){e||CW.fatalError("addRequest():  You must specify a request");var t=this.get("requests");this.propertyWillChange("requests"),t.push(e),this.propertyDidChange("requests")},removeRequest:function(e){e||CW.fatalError("removeRequest():  You must specify a request");var t=this.get("requests"),n=t.indexOf(e);n!==-1&&t.removeAt(n,1)},"issue requests":function(e){var t=this.get("requests"),n,r,i;for(n=0,r=t.length;n<r;++n)i=t[n],i.set("cycle",this),i.send()},init:function(){arguments.callee.base.apply(this,arguments),this.set("requests",[])}}),CW.ReadCycle.mixin({stages:["issue requests",CW.StorageCycle.DATA_CHANGE_STAGE],priority:10,shouldBeCoalesced:NO}),CW.StorageCycle.registerClassForCycleType
(CW.StorageCycle.READ_CYCLE,CW.ReadCycle),CW.StorageManager=SC.Object.extend({extendedLogging:NO,name:null,managedStore:null,mainStore:function(){return this.getPath("managedStore.parentStore")}.property("managedStore").cacheable(),currentCycle:null,pendingCycles:null,cyclesAreSuspended:function(){return this._suspendCount>0}.property(),hasOutstandingCommitCycle:function(){var e=this.get("currentCycle"),t=CW.StorageCycle,n;return e&&e.get("type")===t.COMMIT_CYCLE?YES:(n=this.pendingCycleOfType(t.COMMIT_CYCLE),n?YES:NO)}.property("currentCycle","*pendingCycles.[]").cacheable(),scheduleCycle:function(e){e||CW.fatalError("scheduleCycle():  You must specify a cycle");var t=e.get("storageManager"),n=this.get("currentCycle"),r=this._suspendCount>0,i=YES,s=e.get("type"),o=e.constructor,u=o.priority,a,f,l,c,h,p,d,v,m,g,y,b;t&&(t===this?CW.fatalError("scheduleCycle():  The specified cycle is already registered with this storage manager",{cycle:e,target:this}):CW.fatalError("scheduleCycle():  The specified cycle is already registered with a different storage manager",{cycle:e,target:this,storageManager:t})),e.set("storageManager",this),!n&&!r?(this.beginCycle(e),i=NO,a=YES):r?SC.debug("Enqueuing new %@ cycle because cycles are suspended…",s):n&&(f=n.constructor,l=f.isPreemptible,l&&(c=f.priority,u>c?(SC.debug("Canceling current %@ cycle because a new %@ cycle has been scheduled…",n.get("type"),s),h=YES):SC.debug("Enqueuing new %@ cycle because there is a %@ cycle in progress…",s,n.get("type"))));if(i){p=o.shouldBeCoalesced,d=this.get("pendingCycles"),m=d.length,g=0;for(v=m-1;v>=0;--v)
{y=d[v];if(p&&s===y.get("type")){SC.debug("Ignoring registration of %@ cycle because we already have a pending %@ cycle in the queue…",s,s),g=-1;break}b=y.constructor.priority;if(b<=u){g=v+1;break}}g>=0?(d.insertAt(g,e),a=YES):a=NO}return h&&this.cancelCycle(n),a},pendingCycleOfType:function(e){var t=CW.StorageCycle,n=this.get("pendingCycles"),r,i,s;for(r=0,i=n.length;r<i;++r){s=n[r];if(s.get("type")===e)return s}return null},beginCycle:function(e){var t=this.get("currentCycle"),n,r;t?CW.fatalError("beginCycle():  Cannot begin a new cycle because there is already a cycle in progress.",{target:this,currentCycle:t,newCycle:e}):(r=e.constructor.shouldLogLifetime,n=this.get("pendingCycles"),!n||n.length===0?r&&SC.Logger.debugGroup("Beginning %@  (no pending cycles)…",e):r&&SC.Logger.debugGroup("Beginning %@  (pending cycles:  %@)…",e,n),this.set("currentCycle",e),e.begin())},cancelCycle:function(e){var t=this.get("currentCycle"),n,r,i,s,o,u,a,f,l,c,h;if(t===e){SC.debug("Canceling current %@ and associated pending/outstanding requests…",t),n=SC.Request.manager,r=CW.RequestManagement.sharedInstance(),i=r.pendingRequestsForCycle(e),s=r.outstandingResponsesForCycle(e);if(i)for(o=0,u=i.length;o<u;++o)a=i[o],SC.debug("  >  canceling pending request %@…",a),a.set("isCancelled",YES),r.removePendingRequest(a);if(s)for(o=0,u=s.length;o<u;++o)f=s[o],SC.debug("  >  canceling outstanding request %@…",f),n.cancel(f),r.removeOutstandingResponse(f);window.status=" ",e.end()}else{l=this.get("pendingCycles");for(o=0,u=l.length;o<u;++o){c=l[o];if(c===e){SC.debug("Canceling pending %@ cycle…",e.get
("type")),l.removeAt(o,1),h=YES;break}}h||CW.fatalError("cancelCycle():  Requested to cancel a cycle that is neither in progress nor in the pending queue",{target:this,cycle:e})}},suspendCycles:function(){var e=this._suspendCount>0;++this._suspendCount,e||(this.notifyPropertyChange("cyclesAreSuspended"),SC.debug("%@:  Cycles are suspended",this))},resumeCycles:function(){var e=this._suspendCount;--e,e<0?(SC.warn("CW.StorageManager#resumeCycles was called without a paired suspendCycles invocation; ignoring…"),this._suspendCount=0):(this._suspendCount=e,e===0&&(this.notifyPropertyChange("cyclesAreSuspended"),SC.debug("%@:  Cycles have been resumed",this),this._beginFirstPendingCycle()))},init:function(){arguments.callee.base.apply(this,arguments),this.set("pendingCycles",[]);var e=this.get("managedStore"),t;e||CW.fatalError("You must specify a managed store for the storage manager",{target:this}),t=this.get("mainStore"),t||CW.fatalError("The storage manager cannot determine the main store",{target:this,managedStore:e}),e.get("storageManager")&&CW.fatalError("The managed store is already registered to a different storage manager",{target:this,managedStore:e}),t.get("storageManager")&&CW.fatalError("The main store is already registered to a different storage manager",{target:this,mainStore:t}),e.set("storageManager",this),t.set("storageManager",this);var n=CW.RequestManagement.sharedInstance();n.addObserver("pendingRequests.[]",this,this.outstandingRequestsDidChange),n.addObserver("outstandingResponses.[]",this,this.outstandingRequestsDidChange)},cycleDidEnd:function(e){var t=this
.get("currentCycle");t||CW.fatalError("cycleDidEnd() was invoked but there is no current cycle",{target:this,cycle:e}),t!==e&&CW.fatalError("cycleDidEnd() was invoked on a cycle that is not the current cycle",{target:this,cycle:e,currentCycle:t}),this.set("currentCycle",null),SC.Logger.debugGroupEnd(),this._suspendCount||this._beginFirstPendingCycle()},outstandingRequestsDidChange:function(){var e=this._previousNumberOfPendingOrOutstandingRequests,t=this.get("currentCycle"),n=CW.RequestManagement.sharedInstance(),r=n.get("pendingRequests"),i=n.get("outstandingResponses"),s=this.get("extendedLogging"),o,u,a,f,l,c,h,p;if(t){o=n.pendingRequestsForCycle(t),u=n.outstandingResponsesForCycle(t),a=o?o.length:0,a+=u?u.length:0;if(e!==undefined&&e!==a){if(a===0)t.constructor.shouldLogLifetime&&SC.debug("%@:  There are no more pending/outstanding requests",t);else{f=n.numberOfPendingOrOutstandingReadsForCycle(t),a===1?(c=f>0?"read":"write",t.constructor.shouldLogLifetime&&SC.debug("%@:  There is 1 pending/outstanding request  (a %@)…",t,c)):(l=n.numberOfPendingOrOutstandingWritesForCycle(t),SC.debug("%@:  There are %@ pending/outstanding requests (%@ read, %@ write)…",t,a,f,l));if(s){SC.debug("Outstanding responses:");for(h=0;h<a;++h)p=u[h],SC.debug("  [%@]  %@",h,p)}}a===0&&(t.get("_hasEnded")&&CW.fatalError("The number of pending/outstanding requests for the current storage cycle unexpectedly changed to 0 after it ended",{target:this,currentCycle:t,previousNumber:e}),s&&SC.debug("Advancing to next stage (%@+1) because there are no outstanding requests…",t.get("currentStage")),t.invokeLast
(function(){t.advanceToNextStage()}))}}this._previousNumberOfPendingOrOutstandingRequests=a},_beginFirstPendingCycle:function(){var e=this.get("pendingCycles"),t,n;e&&(t=e.length,t>0&&(n=e.shift(),this.beginCycle(n),this.get("pendingCycles").enumerableContentDidChange()))},toString:function(){var e=arguments.callee.base.apply(this,arguments),t=this.get("name");return t&&(e=t+" ("+e+")"),e},_suspendCount:0}),CW.Store=SC.Store.extend(CW.StoreCommon,SC.DelegateSupport,{isCoreWebStore:YES,readEditableDataHash:function(e){return this._savePreviousDataHashForNotify(e),arguments.callee.base.apply(this,arguments)},writeDataHash:function(e,t,n){return t&&this._savePreviousDataHashForNotify(e),arguments.callee.base.apply(this,arguments)},placeHolderRecord:function(e,t,n){var r=e.storeKeyFor(t),i;return i=this.materializeRecord(r),r&&(this.writeDataHash(r,n?n:{}),this.writeStatus(r,SC.Record.READY_CLEAN),i.allPropertiesDidChange()),i},pushRetrieve:function(e,t,n,r,i){var s=SC.Record,o;r===undefined&&(r=e.storeKeyFor(t)),o=this.readStatus(r);if(o==s.EMPTY||o==s.ERROR||o==s.READY_CLEAN||o==s.DESTROYED_CLEAN){o=s.READY_CLEAN;if(n===undefined)this.writeStatus(r,s.EMPTY),this.dataHashDidChange(r);else{var u=this.getCurrentCommitCycle(),a=u?u.get("changelog"):null;if(a&&a.contains(r)){var f=SC.clone(this.readDataHash(r),YES),l=u.dataHashesCheckpointBeforeCycleStage[r],c=this.mergeHashesAsPossible;if(f&&l&&c){SC.debug("pushRetrieve():  Merging newly-loaded data for storeKey %@ into main store…",r);var h=c.call(this,n,f,l,e.propertyMergeGroups,YES,"server-retrieved data",this.get("name")),p=h.
changedKeys.concat(h.addedKeys,h.removedKeys),d=h.mergeConflictKeys;if(p.length||d.length)this.writeDataHash(r,f,o),this.dataHashDidChange(r);if(d.length>0){var v=this.get("delegate"),m=NO;v&&(m=this.invokeDelegateMethod(v,"mergeConflictDuringNotify",this,null,r,p,d))}}else this.writeDataHash(r,n,o),this.dataHashDidChange(r)}else this.writeDataHash(r,n,o),this.dataHashDidChange(r)}return r}return NO},_savePreviousDataHashForNotify:function(e,t){var n=this.get("nestedStores");n&&n.length>0&&(this.previousDataHashesForNotify[e]||(this.previousDataHashesForNotify[e]=SC.clone(this.dataHashes[e],YES)))},reset:function(){return this.previousDataHashesForNotify={},this.commitAgents=null,arguments.callee.base.apply(this,arguments)},commitChangesFromNestedStore:function(e,t,n){var r=e.commitAgents,i,s,o,u,a,f;if(r){i=this.commitAgents,i||(i=this.commitAgents={});for(s in r)s=parseInt(s,10),t.contains(s)&&(o=i[s],u=r[s],o?o=o.concat(u):i[s]=u)}n||this._verifyLockRevisions(t,e.locks,e);var l=t.length,c,h,p,d,v,m,g,y;v=this.revisions,h=this.dataHashes,p=this.statuses,d=this.editables,d||(d=this.editables=[]),m=e.dataHashes,y=e.revisions,g=e.statuses;for(c=0;c<l;c++)s=t[c],p[s]=g[s],v[s]=y[s],d[s]=0,this._savePreviousDataHashForCommit&&this._savePreviousDataHashForCommit(s),h[s]=m[s],this._notifyRecordPropertyChange(s,NO),this.notifyCommitAgents(s,"recordWasCommittedToStore",this);var b=this.changelog,w=e.changelog;return w&&(b||(b=this.changelog=SC.CoreSet.create()),b.addEach(w)),this.changelog=b,this.get("parentStore")||this.flush(),this}}),SC.stringsFor("English",{"SC.Date.Era.AD.Abbreviated"
:"AD","SC.Date.Era.AD.Full":"Anno Domini","SC.Date.Era.AD.Letter":"A","SC.Date.Era.BC.Abbreviated":"BC","SC.Date.Era.BC.Full":"Before Christ","SC.Date.Era.BC.Letter":"B","SC.Date.Quarter.Q1.Abbreviated":"Q1","SC.Date.Quarter.Q1.Full":"1st quarter","SC.Date.Quarter.StandAlone.Q1.Abbreviated":"Q1","SC.Date.Quarter.StandAlone.Q1.Full":"1st Quarter","SC.Date.Quarter.Q2.Abbreviated":"Q2","SC.Date.Quarter.Q2.Full":"2nd quarter","SC.Date.Quarter.StandAlone.Q2.Abbreviated":"Q2","SC.Date.Quarter.StandAlone.Q2.Full":"2nd Quarter","SC.Date.Quarter.Q3.Abbreviated":"Q3","SC.Date.Quarter.Q3.Full":"3rd quarter","SC.Date.Quarter.StandAlone.Q3.Abbreviated":"Q3","SC.Date.Quarter.StandAlone.Q3.Full":"3rd Quarter","SC.Date.Quarter.Q4.Abbreviated":"Q4","SC.Date.Quarter.Q4.Full":"4th quarter","SC.Date.Quarter.StandAlone.Q4.Abbreviated":"Q4","SC.Date.Quarter.StandAlone.Q4.Full":"4th Quarter","SC.Date.Month.January.Abbreviated":"Jan","SC.Date.Month.January.Full":"January","SC.Date.Month.January.Letter":"J","SC.Date.Month.StandAlone.January.Abbreviated":"Jan","SC.Date.Month.StandAlone.January.Full":"January","SC.Date.Month.StandAlone.January.Letter":"J","SC.Date.Month.Prepositional.January.Abbreviated":"Jan","SC.Date.Month.Prepositional.January.Full":"January","SC.Date.Month.Prepositional.January.Letter":"J","SC.Date.Month.February.Abbreviated":"Feb","SC.Date.Month.February.Full":"February","SC.Date.Month.February.Letter":"F","SC.Date.Month.StandAlone.February.Abbreviated":"Feb","SC.Date.Month.StandAlone.February.Full":"February","SC.Date.Month.StandAlone.February.Letter":"F","SC.Date.Month.Prepositional.February.Abbreviated"
:"Feb","SC.Date.Month.Prepositional.February.Full":"February","SC.Date.Month.Prepositional.February.Letter":"F","SC.Date.Month.March.Abbreviated":"Mar","SC.Date.Month.March.Full":"March","SC.Date.Month.March.Letter":"M","SC.Date.Month.StandAlone.March.Abbreviated":"Mar","SC.Date.Month.StandAlone.March.Full":"March","SC.Date.Month.StandAlone.March.Letter":"M","SC.Date.Month.Prepositional.March.Abbreviated":"Mar","SC.Date.Month.Prepositional.March.Full":"March","SC.Date.Month.Prepositional.March.Letter":"M","SC.Date.Month.April.Abbreviated":"Apr","SC.Date.Month.April.Full":"April","SC.Date.Month.April.Letter":"A","SC.Date.Month.StandAlone.April.Abbreviated":"Apr","SC.Date.Month.StandAlone.April.Full":"April","SC.Date.Month.StandAlone.April.Letter":"A","SC.Date.Month.Prepositional.April.Abbreviated":"Apr","SC.Date.Month.Prepositional.April.Full":"April","SC.Date.Month.Prepositional.April.Letter":"A","SC.Date.Month.May.Abbreviated":"May","SC.Date.Month.May.Full":"May","SC.Date.Month.May.Letter":"M","SC.Date.Month.StandAlone.May.Abbreviated":"May","SC.Date.Month.StandAlone.May.Full":"May","SC.Date.Month.StandAlone.May.Letter":"M","SC.Date.Month.Prepositional.May.Abbreviated":"May","SC.Date.Month.Prepositional.May.Full":"May","SC.Date.Month.Prepositional.May.Letter":"M","SC.Date.Month.June.Abbreviated":"Jun","SC.Date.Month.June.Full":"June","SC.Date.Month.June.Letter":"J","SC.Date.Month.StandAlone.June.Abbreviated":"Jun","SC.Date.Month.StandAlone.June.Full":"June","SC.Date.Month.StandAlone.June.Letter":"J","SC.Date.Month.Prepositional.June.Abbreviated":"Jun","SC.Date.Month.Prepositional.June.Full"
:"June","SC.Date.Month.Prepositional.June.Letter":"J","SC.Date.Month.July.Abbreviated":"Jul","SC.Date.Month.July.Full":"July","SC.Date.Month.July.Letter":"J","SC.Date.Month.StandAlone.July.Abbreviated":"Jul","SC.Date.Month.StandAlone.July.Full":"July","SC.Date.Month.StandAlone.July.Letter":"J","SC.Date.Month.Prepositional.July.Abbreviated":"Jul","SC.Date.Month.Prepositional.July.Full":"July","SC.Date.Month.Prepositional.July.Letter":"J","SC.Date.Month.August.Abbreviated":"Aug","SC.Date.Month.August.Full":"August","SC.Date.Month.August.Letter":"A","SC.Date.Month.StandAlone.August.Abbreviated":"Aug","SC.Date.Month.StandAlone.August.Full":"August","SC.Date.Month.StandAlone.August.Letter":"A","SC.Date.Month.Prepositional.August.Abbreviated":"Aug","SC.Date.Month.Prepositional.August.Full":"August","SC.Date.Month.Prepositional.August.Letter":"A","SC.Date.Month.September.Abbreviated":"Sep","SC.Date.Month.September.Full":"September","SC.Date.Month.September.Letter":"S","SC.Date.Month.StandAlone.September.Abbreviated":"Sep","SC.Date.Month.StandAlone.September.Full":"September","SC.Date.Month.StandAlone.September.Letter":"S","SC.Date.Month.Prepositional.September.Abbreviated":"Sep","SC.Date.Month.Prepositional.September.Full":"September","SC.Date.Month.Prepositional.September.Letter":"S","SC.Date.Month.October.Abbreviated":"Oct","SC.Date.Month.October.Full":"October","SC.Date.Month.October.Letter":"O","SC.Date.Month.StandAlone.October.Abbreviated":"Oct","SC.Date.Month.StandAlone.October.Full":"October","SC.Date.Month.StandAlone.October.Letter":"O","SC.Date.Month.Prepositional.October.Abbreviated"
:"Oct","SC.Date.Month.Prepositional.October.Full":"October","SC.Date.Month.Prepositional.October.Letter":"O","SC.Date.Month.November.Abbreviated":"Nov","SC.Date.Month.November.Full":"November","SC.Date.Month.November.Letter":"N","SC.Date.Month.StandAlone.November.Abbreviated":"Nov","SC.Date.Month.StandAlone.November.Full":"November","SC.Date.Month.StandAlone.November.Letter":"N","SC.Date.Month.Prepositional.November.Abbreviated":"Nov","SC.Date.Month.Prepositional.November.Full":"November","SC.Date.Month.Prepositional.November.Letter":"N","SC.Date.Month.December.Abbreviated":"Dec","SC.Date.Month.December.Full":"December","SC.Date.Month.December.Letter":"D","SC.Date.Month.StandAlone.December.Abbreviated":"Dec","SC.Date.Month.StandAlone.December.Full":"December","SC.Date.Month.StandAlone.December.Letter":"D","SC.Date.Month.Prepositional.December.Abbreviated":"Dec","SC.Date.Month.Prepositional.December.Full":"December","SC.Date.Month.Prepositional.December.Letter":"D","SC.Date.Day.Monday.Abbreviated":"Mon","SC.Date.Day.Monday.Full":"Monday","SC.Date.Day.Monday.Letter":"M","SC.Date.Day.StandAlone.Monday.Abbreviated":"Mon","SC.Date.Day.StandAlone.Monday.Full":"Monday","SC.Date.Day.StandAlone.Monday.Letter":"M","SC.Date.Day.Tuesday.Abbreviated":"Tue","SC.Date.Day.Tuesday.Full":"Tuesday","SC.Date.Day.Tuesday.Letter":"T","SC.Date.Day.StandAlone.Tuesday.Abbreviated":"Tue","SC.Date.Day.StandAlone.Tuesday.Full":"Tuesday","SC.Date.Day.StandAlone.Tuesday.Letter":"T","SC.Date.Day.Wednesday.Abbreviated":"Wed","SC.Date.Day.Wednesday.Full":"Wednesday","SC.Date.Day.Wednesday.Letter":"W","SC.Date.Day.StandAlone.Wednesday.Abbreviated"
:"Wed","SC.Date.Day.StandAlone.Wednesday.Full":"Wednesday","SC.Date.Day.StandAlone.Wednesday.Letter":"W","SC.Date.Day.Thursday.Abbreviated":"Thu","SC.Date.Day.Thursday.Full":"Thursday","SC.Date.Day.Thursday.Letter":"R","SC.Date.Day.StandAlone.Thursday.Abbreviated":"Thu","SC.Date.Day.StandAlone.Thursday.Full":"Thursday","SC.Date.Day.StandAlone.Thursday.Letter":"R","SC.Date.Day.Friday.Abbreviated":"Fri","SC.Date.Day.Friday.Full":"Friday","SC.Date.Day.Friday.Letter":"F","SC.Date.Day.StandAlone.Friday.Abbreviated":"Fri","SC.Date.Day.StandAlone.Friday.Full":"Friday","SC.Date.Day.StandAlone.Friday.Letter":"F","SC.Date.Day.Saturday.Abbreviated":"Sat","SC.Date.Day.Saturday.Full":"Saturday","SC.Date.Day.Saturday.Letter":"S","SC.Date.Day.StandAlone.Saturday.Abbreviated":"Sat","SC.Date.Day.StandAlone.Saturday.Full":"Saturday","SC.Date.Day.StandAlone.Saturday.Letter":"S","SC.Date.Day.Sunday.Abbreviated":"Sun","SC.Date.Day.Sunday.Full":"Sunday","SC.Date.Day.Sunday.Letter":"S","SC.Date.Day.StandAlone.Sunday.Abbreviated":"Sun","SC.Date.Day.StandAlone.Sunday.Full":"Sunday","SC.Date.Day.StandAlone.Sunday.Letter":"S","SC.Date.Period.AM":"AM","SC.Date.Period.PM":"PM"}),CW.DateFormatter=function(e,t){var n=e.dateObject(),r=new Date(n.getTime());return n._isUsingUTC&&r.setMinutes(r.getMinutes()+r.getTimezoneOffset()),SC.DateFormatter(r,t)},SC.stringsFor("en-us",{"Meta.Description":"Access your iCloud email on the web and on all your other devices.","Application.Title":"iCloud Mail","_Feedback.MailMessage.NetworkError.Title":"Cannot save changes.","_Feedback.MailMessage.NetworkError.Text":"Mail cannot complete your action due to a network error. To preserve recent changes, keep this window open and reload Mail in a new window. Check your Drafts folder in the new window to ensure recent changes were saved. If they were not, copy and paste your recent changes from the other window."
,"_Feedback.MailMessage.NetworkError.Caption":"If necessary, you can copy and paste the text in this window into a new message.","_Feedback.Response.RequestFailed.Title":"Cannot complete request.","_Feedback.Response.RequestFailed.Text":"Try refreshing the browser window or signing in to iCloud Mail again.","_Feedback.CoreMail.InternalError.Title":"Cannot load Mail.","_Feedback.CoreMail.InternalError.Text":"Mail cannot be loaded at this time. Try signing out and signing back in.","_PageTitle.Mail.Folder":"%@1iCloud Mail - %@2 (%@3%@4)","_PageTitle.Mail.0Messages":"0 messages","_PageTitle.Mail.1Message":"1 message","_PageTitle.Mail.2Messages":"2 messages","_PageTitle.Mail.3,4Messages":"%@1 messages","_PageTitle.Mail.5,6,7,8,9,10Messages":"%@1 messages","_PageTitle.Mail.EndingIn1Messages":"%@1 messages","_PageTitle.Mail.EndingIn2Messages":"%@1 messages","_PageTitle.Mail.EndingIn3,4Messages":"%@1 messages","_PageTitle.Mail.EndingIn5,6,7,8,9,0Messages":"%@1 messages","_PageTitle.Mail.1Unread":", 1 unread","_PageTitle.Mail.2Unread":", 2 unread","_PageTitle.Mail.3,4Unread":", %@1 unread","_PageTitle.Mail.5,6,7,8,9,10Unread":", %@1 unread","_PageTitle.Mail.EndingIn1Unread":", %@1 unread","_PageTitle.Mail.EndingIn2Unread":", %@1 unread","_PageTitle.Mail.EndingIn3,4Unread":", %@1 unread","_PageTitle.Mail.EndingIn5,6,7,8,9,0Unread":", %@1 unread","_PageTitle.Mail.SearchResults.0Matches":"iCloud Mail - 0 matching results","_PageTitle.Mail.SearchResults.1Match":"iCloud Mail - 1 matching result","_PageTitle.Mail.SearchResults.2Matches":"iCloud Mail - 2 matching results","_PageTitle.Mail.SearchResults.3,4Matches"
:"iCloud Mail - %@1 matching results","_PageTitle.Mail.SearchResults.5,6,7,8,9,10Matches":"iCloud Mail - %@1 matching results","_PageTitle.Mail.SearchResults.EndingIn1Matches":"iCloud Mail - %@1 matching results","_PageTitle.Mail.SearchResults.EndingIn2Matches":"iCloud Mail - %@1 matching results","_PageTitle.Mail.SearchResults.EndingIn3,4Matches":"iCloud Mail - %@1 matching results","_PageTitle.Mail.SearchResults.EndingIn5,6,7,8,9,0Matches":"iCloud Mail - %@1 matching results","_PageTitle.Mail.UnreadInParenthesis":"(%@1) ","_PageTitle.ViewMessage.Subject":"iCloud Mail - %@1","_PageTitle.ViewMessage.NoSubject":"iCloud Mail - (No Subject)","_PageTitle.ComposeMessage.New":"iCloud Mail - New Message","_PageTitle.ComposeMessage.EmptySubject":"iCloud Mail","_PageTitle.ComposeMessage.ReplyForward":"iCloud Mail - %@1","_Toolbar.AppSwitcher.Tooltip":"Go to the iCloud home screen","_Toolbar.Message.ReplyAll":"Reply All","_Toolbar.Message.Reply":"Reply","_Toolbar.Message.Flag":"Flag","_Toolbar.Message.MoveToTrash":"Delete selected messages","_Toolbar.Message.QuickReply.Hint":"Type a Quick Reply","_Toolbar.Message.Archive":"Archive","_Toolbar.Message.Forward":"Forward","_Toolbar.Message.Compose.Mac":"Compose (⌥⇧N)","_Toolbar.Message.Compose.Windows":"Compose (Alt+Shift+N)","_Toolbar.Message.MoveToFolder":"Move to Folder","_Toolbar.Message.Attach":"Attach a file…","_Toolbar.Message.Junk":"Junk","_Toolbar.Message.Actions":"Show Actions menu","_Toolbar.Message.Contacts":"Contacts","_Toolbar.Message.ReplyToSender":"Reply to sender","_Toolbar.Message.ReplyAllAndForwardingOptions":"Reply, Reply All, Forward"
,"_Toolbar.Message.MovingToInbox":"Moving to Inbox","_Toolbar.Message.Search.Hint":"Search %@","_Menu.Reply":"Reply","_Menu.ReplyAll":"Reply All","_Menu.Forward":"Forward","_Menu.ForwardAsAttachment":"Forward as Attachment","_Menu.Delete":"Delete","_Menu.MoveToFolder":"Move to Folder…","_Menu.EmptyTrash":"Empty Trash","_Menu.PrintMessage":"Print","_Menu.Preferences":"Preferences…","_Menu.DeleteFolder":"Delete Folder","_Menu.DownloadMessage":"Download Message","_Menu.CtrlKey":"&#67;trl+","_Menu.CreateRule":"Rules…","_Menu.CmdKey":"&#8984","_FlagMenu.Read":"Mark as Read","_FlagMenu.Unread":"Mark as Unread","_FlagMenu.Flagged":"Flag","_FlagMenu.Unflagged":"Unflag","_FlagMenu.JunkMail":"Move to Junk","_MoveToFolder.Title":"Move to Folder","_SC.DateTime.abbreviatedMonthNames":"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec","_SC.DateTime.monthNames":"January February March April May June July August September October November December","_SC.DateTime.AMPMNames":"AM PM","_DateTime.Today":"Today","_DateTime.Yesterday":"Yesterday","_DateTime.ShortDate.Regular":"%m/%d/%y","_DateTime.ShortDate.DayFirst":"%d/%m/%y","_DateTime.MonthInWords.Regular":"%B %d, %Y","_DateTime.MonthInWords.DayFirst":"%d %B %Y","_DateTime.LongDateFormat.Regular":"%B %d, %Y %i:%M:%S %p","_DateTime.LongDateFormat.DayFirst":"%d %B %Y %i:%M:%S %p","_DateTime.ReplyFormat.Regular":"%b %d, %Y, at %I:%M %p","_DateTime.ReplyFormat.DayFirst":"%d %b, %Y, at %I:%M %p","_DateTime.MessageSavedOrReceivedtime":"%i:%M %p","_DateTime.BlacklistedDateMMMDDYY":"%b %d, %Y","_DateTime.BlacklistedDayAndTime":"%{todayOrYesterday} %{time}"
,"_DateTime.VacationReplyDateFormat.Regular":"%m/%d/%Y","_DateTime.VacationReplyDateFormat.DayFirst":"%d/%m/%Y","_DateTime.VacationReplyDateFormat.DateHint.Regular":"mm/dd/yyyy","_DateTime.VacationReplyDateFormat.DateHint.DayFirst":"dd/mm/yyyy","_DateTime.StartingDayOfTheWeek":"0","_FolderList.GetMail":"Get Mail","_FolderList.AddFolder":"Create a new mail folder","_FolderList.Group.MailBoxes":"Mailboxes","_FolderList.Group.Folders":"Folders","_FolderList.FolderName.Inbox":"Inbox","_FolderList.FolderName.Drafts":"Drafts","_FolderList.FolderName.Sent":"Sent","_FolderList.FolderName.Trash":"Trash","_FolderList.FolderName.Junk":"Junk","_FolderList.FolderName.Archive":"Archive","_FolderList.FolderName.Vip":"VIP","_FolderList.FolderNameAndUnreadCount":"%@1 (%@2)","_FolderList.FolderNameWhenNoUnreadMessage":"%@1","_FolderList.NewFolder":"New Folder","_Feedback.FolderList.InvalidFolderName.Title":"Cannot create folder.","_Feedback.FolderList.InvalidFolderName.Text":"The characters / ? % * may not be used in the folder name.","_Feedback.FolderList.FolderNameTooLong.Title":"Folder name is too long.","_Feedback.FolderList.FolderNameTooLong.Text":"Shorten the name and try again.","_Feedback.FolderList.ReservedFolderName.Title":"Reserved folder name.","_Feedback.FolderList.ReservedFolderName.Text":"This name is reserved by Mail and cannot be used for a new folder.","_Feedback.FolderList.ExistingFolderName.Title":"Folder name already exists.","_Feedback.FolderList.ExistingFolderName.Text":"A folder with the name “%@” already exists. Choose a new name and try again.","_Feedback.FolderList.InvalidFirstCharacter.Title"
:"Cannot create folder.","_Feedback.FolderList.InvalidFirstCharacter.Text":"Folder names cannot begin with a number sign (#).","_Feedback.FolderList.DeleteSubFolders.Title":"Delete “%{folderName}” ?","_Feedback.FolderList.DeleteSubFolders.Text":"Are you sure you want to delete this folder? All folders and messages in it will also be deleted.","_Feedback.FolderList.DeleteFolder.Title":"Delete “%{folderName}”?","_Feedback.FolderList.DeleteFolder.Text":"Are you sure you want to delete this folder? All messages in the folder will also be deleted.","_Feedback.FolderList.DeleteFolder.ServerError.Title":"Cannot delete folder.","_Feedback.FolderList.DeleteFolder.ServerError.Text":"This folder cannot be deleted at this time. Try again later.","_Feedback.FolderList.MoveFolder.NameConflict.Title":"Cannot move folder.","_Feedback.FolderList.MoveFolder.NameConflict.Text":"This folder cannot be moved because a folder with the same name already exists there.","_Feedback.FolderList.MoveFolder.ServerError.Title":"Cannot move folder.","_Feedback.FolderList.MoveFolder.ServerError.Text":"This folder cannot be moved at this time. Try again later.","_Feedback.FolderList.CreateFolder.ServerError.Title":"Cannot create folder.","_Feedback.FolderList.CreateFolder.ServerError.Text":"This folder cannot be created at this time. Try again later.","_Feedback.FolderList.MoveMessages.ServerError.Title":"Cannot move messages.","_Feedback.FolderList.MoveMessages.ServerError.Text":"The selected messages cannot be moved at this time. Try again later.","_Feedback.FolderList.RenameFolder.ServerError.Title":"Cannot rename folder."
,"_Feedback.FolderList.RenameFolder.ServerError.Text":"This folder cannot be renamed at this time. Try again later.","_Feedback.FolderList.EmptyFolder.ServerError.Title":"Cannot empty folder.","_Feedback.FolderList.EmptyFolder.ServerError.Text":"This folder cannot be emptied at this time. Try again later.","_Feedback.FolderList.MarkAllAsRead.ServerError.Title":"Cannot mark as read.","_Feedback.FolderList.MarkAllAsRead.ServerError.Text":"These messages cannot be marked as read at this time. Try again later.","_Feedback.FolderList.MarkAllAsUnread.ServerError.Title":"Cannot mark as unread.","_Feedback.FolderList.MarkAllAsUnread.ServerError.Text":"These messages cannot be marked as unread at this time. Try again later.","_Feedback.FolderList.LoadFailed.ServerError.Title":"Cannot display folder list.","_Feedback.FolderList.LoadFailed.ServerError.Text":"The folder list cannot be displayed at this time.","_Feedback.MessageList.UnableToDeleteMessages.ServerError.Title":"Cannot delete messages.","_Feedback.MessageList.UnableToDeleteMessages.ServerError.Text":"The selected messages cannot be deleted at this time. Try again later.","_Feedback.MessageList.UnableToDeleteMessage.ServerError.Title":"Cannot delete message.","_Feedback.MessageList.UnableToDeleteMessage.ServerError.Text":"The selected message cannot be deleted at this time. Try again later.","_Feedback.MessageList.ConfirmOpenMessages.Title":"Open %{selMesgsLen} messages?","_Feedback.MessageList.ConfirmOpenMessages.Text":"Each message will open in a new window.","_Feedback.ViewMessage.Load.ServerError.Title":"Cannot load message."
,"_Feedback.ViewMessage.Load.ServerError.Text":"This message cannot be loaded at this time. Try again later.","_Feedback.MessageList.UnableToArchiveMessages.ServerError.Title":"Cannot archive message.","_Feedback.MessageList.UnableToArchiveMessages.ServerError.Text":"This message cannot be archived at this time. Try again later.","_Feedback.Messagelist.LoadFailed.ServerError.Title":"Cannot load “%{selectedFolder}”.","_Feedback.Messagelist.LoadFailed.ServerError.Text":"Messages cannot be displayed at this time. Try again later.","_Feedback.MessageList.Debug.NoMessageSelected.Title":"No message selected.","_Feedback.MessageList.Debug.NoMessageSelected.Text":"Select a message and try again.","_Feedback.MessageList.Debug.UploadFailed.Title":"Message upload failed.","_Feedback.MessageList.Debug.UploadFailed.Text":"Try again with a valid .eml file.","_Feedback.Compose.ConfirmClose.Text":"This message has not been sent or saved.","_Feedback.Compose.UnableToSaveAsDraft.ServerError.Title":"Cannot save draft.","_Feedback.Compose.UnableToSaveAsDraft.ServerError.Text":"This message cannot be saved as a draft at this time. Try again later.","_Feedback.Compose.UnableToSaveAsDraftMsgSizeTooLarge.Title":"Cannot save draft.","_Feedback.Compose.UnableToSaveAsDraftMsgSizeTooLarge.Text":"To save this draft, delete the current attachments and attach them again.","_Feedback.Compose.UnableToOpen.Title":"Cannot compose message.","_Feedback.Compose.UnableToOpen.Text":"This action cannot be completed because of an error. Close and start over.","_Feedback.Compose.UnableToFetchPreferences.Title":"Cannot compose message."
,"_Feedback.Compose.UnableToFetchPreferences.Text":"This action cannot be completed because of an error. Close and start over.","_Feedback.SendFailureGeneric.Title":"Cannot send message.","_Feedback.SendFailureGeneric.Text":"This message cannot be sent at this time. Try again later.","_Feedback.SendFailureAttachment.Title":"Cannot send message.","_Feedback.SendFailureAttachment.Text":"To send this message, delete the current attachments and attach them again.","_Feedback.SendFailureMessageSizeTooLarge.Title":"Cannot send message.","_Feedback.SendFailureMessageSizeTooLarge.Text":"To send this message, delete the current attachments and attach them again.","_Feedback.ReplyMenu.SendFailureGeneric.Title":"Cannot send message.","_Feedback.ReplyMenu.SendFailureGeneric.Text":"This message cannot be sent at this time.","_Feedback.ReplyMenu.UnableToSaveAsDraft.ServerError.Title":"Cannot save draft.","_Feedback.ReplyMenu.UnableToSaveAsDraft.ServerError.Text":"This message cannot be saved as a draft at this time.","_Feedback.Compose.SendFailureTooManyRecipients.Title":"Recipient limit exceeded.","_Feedback.Compose.SendFailureTooManyRecipients.Text":"This message cannot be sent because it has too many recipients.","_MessageList.EmptySnippet":"This message has no text content.","_MessageList.ColumnHeader.SwitchMenu":"Switch View","_MessageList.ColumnHeader.SwitchView.ToolTip.ShowMailboxes":"Show Mailboxes","_MessageList.ColumnHeader.SwitchView.ToolTip.HideMailboxes":"Hide Mailboxes","_MessageList.ColumnHeader.SortMenu":"Sort by %{field}","_MessageList.ColumnHeader.Sort.Size":"Size","_MessageList.ColumnHeader.Sort.Subject"
:"Subject","_MessageList.ColumnHeader.Sort.From":"From","_MessageList.ColumnHeader.Sort.To":"To","_MessageList.ColumnHeader.Sort.Date":"Date","_MessageList.ColumnHeader.Sort.Unread":"Unread","_MessageList.ColumnHeader.Sort.Flagged":"Flagged","_MessageList.Sort.Size":"Size","_MessageList.Sort.Subject":"Subject","_MessageList.Sort.From":"From","_MessageList.Sort.To":"To","_MessageList.Sort.Date":"Date","_MessageList.Sort.Unread":"Unread","_MessageList.Sort.Flagged":"Flagged","_MessageList.Sort.Ascending":"Ascending","_MessageList.Sort.Descending":"Descending","_MessageList.EmptyField.To":"(No Recipient)","_MessageList.EmptyField.Subject":"(No Subject)","_MessageList.MarkAs.Read":"Mark as read","_MessageList.MarkAs.Unread":"Mark as unread","_MessageListItem.ToolTip":"%{sender}: %{subject}","_MessageList.Footer.Filters.Tooltip":"Filter messages","_MessageList.Footer.Filters.Label":"Filtered by:","_MessageList.Footer.Filters.Menu.Unread":"Unread","_MessageList.Footer.Filters.Menu.Flagged":"Flagged","_MessageList.Footer.Filters.Menu.ToMe":"To: Me","_MessageList.Footer.Filters.Menu.CcMe":"Cc: Me","_MessageList.Footer.Filters.Menu.WithAttachments":"Only Mail with Attachments","_MessageList.Footer.Filters.Menu.FromVip":"Only from VIP","_MessageList.Footer.Filters.Button.Title.Separator":", ","_MessageList.Footer.Filters.Button.Title.None":"None","_MessageList.Footer.Filters.Button.Title.Unread":"Unread","_MessageList.Footer.Filters.Button.Title.Flagged":"Flagged","_MessageList.Footer.Filters.Button.Title.ToMe":"To: Me","_MessageList.Footer.Filters.Button.Title.CcMe":"Cc: Me","_MessageList.Footer.Filters.Button.Title.WithAttachments"
:"Attachments","_MessageList.Footer.Filters.Button.Title.FromVip":"VIP","_MessageList.SearchPane.Search":"Search","_MessageList.SearchPane.By":"by","_MessageList.Search.AnyField":"All","_MessageList.Search.TheSubject":"Subject","_MessageList.Search.TheSender":"From","_MessageList.Search.TheRecipient":"To","_MessageView.To":"To","_MessageView.Expanded.From":"From","_MessageView.Expanded.Hide":"Hide","_MessageView.ReplyTo":"Reply-To","_MessageView.Subject":"Subject:","_MessageView.Date":"Date:","_MessageView.Size":"Size","_MessageView.AttachmentText":"Attachment","_MessageView.AttachmentsText":"Attachments","_MessageView.Cc":"Cc","_MessageView.NotJunk":"Not Junk","_MessageView.LoadImages":"Load images","_MessageView.EnableDownloadLinks":"Enable All","_MessageView.Bcc":"Bcc","_MessageView.To.Value.Undisclosed":"Undisclosed recipients: ;","_MessageView.ListUnsubscribe.Banner.Message":"This message is from a mailing list.","_MessageView.ListUnsubscribe.Banner.Button.Unsubscribe":"Unsubscribe","_MessageView.ListUnsubscribe.Banner.Button.Dismiss":"Dismiss","_MessageView.ListUnsubscribe.Email.Body.Text":"iCloud Mail sent this email to unsubscribe from the mailing list with subject “%{messageSubject}”.","_MessageView.Collapsed.Order":"%@1.%@2.%@3","_MessageView.Collapsed.From":"From","_MessageView.Collapsed.Sent.To":"To","_MessageView.Collapsed.FromEmail":"<IGNORE: place holder for sender email address>","_MessageView.Collapsed.to":" to","_MessageView.Collapsed.2Recipients":"%@1 2 recipients","_MessageView.Collapsed.EndingIn1Recipients":"%@1 %@2 recipients","_MessageView.Collapsed.EndingIn2Recipients"
:"%@1 %@2 recipients","_MessageView.Collapsed.EndingIn3,4Recipients":"%@1 %@2 recipients","_MessageView.Collapsed.EndingIn5,6,7,8,9,0Recipients":"%@1 %@2 recipients","_MessageView.Collapsed.More":"More","_MessageView.Collapsed.Yesterday":"Yesterday","_MessageView.Collapsed.Today":"Today","_MessageView.DateWithTime":"%{date} at %{time}","_MessageView.OneDayAgo":"1 day ago","_MessageView.DaysAgo":"%@1 days ago","_MessageView.OneWeekAgo":"1 week ago","_MessageView.WeeksAgo":"%@1 weeks ago","_MessageView.OneMinuteAgo":"1 minute ago","_MessageView.MinutesAgo":"%@1 minutes ago","_MessageView.OneHourAgo":"1 hour ago","_MessageView.HoursAgo":"%@1 hours ago","_MessageView.OneMonthAgo":"1 month ago","_MessageView.MonthsAgo":"%@1 months ago","_MessageView.OneYearAgo":"1 year ago","_MessageView.YearsAgo":"%@1 years ago","_MessageView.ShowLongHeaders":"Show Long Headers","_MessageView.HideLongHeaders":"Hide Long Headers","_MessageView.LoadingMail":"Loading…","_MessageView.ContactImportPicker.ContactMessage":"You can download this file to your computer or add it to Contacts.","_MessageView.ContactImportPicker.Import.ButtonTitle":"Add to Contacts","_MessageView.ContactImportPicker.Download.ButtonTitle":"Download","_MessageView.ImportContactSuccessful":"%@1 was added successfully to Contacts.","_MessageView.AddingContact":"Adding contact card…","_MessageView.MarkedJunkMail":"You marked this message as junk.","_MessageView.JunkMail":"iCloud Mail thinks this message is junk.","_MessageView.RulesJunkMail":"iCloud Mail or one of your rules thinks this message is junk.","_MessageView.UnloadedImgs"
:"This message contains unloaded images.","_MessageView.SuspiciousMessageWarning":"This message is suspicious. Links and attachments have been disabled for your security. <a href='https://support.apple.com/en-us/HT204759' target='_new'>Learn More…</a>","_MessageView.FormSubmitWarning.Alert":"You are about to send information to someone other than iCloud. \nDo you want to proceed?","_MessageView.Attachment.ToolTip":"Download %@1 to your computer","_Feedback.MessageView.ContactNotAdded.ServerError.Title":"Contact cannot be added.","_Feedback.MessageView.ContactNotAdded.ServerError.Text":"Contact cannot be added at this time. Try again later.","_Feedback.MessageView.ContactNotImported.ServerError.Title":"vCard cannot be added.","_Feedback.MessageView.ContactNotImported.ServerError.Text":"%{fileName} cannot be added to contacts at this time. Try again later.","_Feedback.MessageView.ContactNotImported.InvalidFileError.Title":"vCard cannot be added.","_Feedback.MessageView.ContactNotImported.InvalidFileError.Text":"%{fileName} is corrupt and cannot be added. Request another vCard from the sender","_Feedback.MessageView.Download.SizeQuotaExceeded.Title":"%{fileName} cannot be downloaded.","_Feedback.MessageView.Download.SizeQuotaExceeded.Text":"This file cannot be viewed in Mail at iCloud.com.","_Feedback._MessageView.ListUnsubscribe.Confirmation.Title":"Unsubscribe from this mailing list?","_Feedback._MessageView.ListUnsubscribe.Confirmation.Text":"The following unsubscribe email will be sent.","_Feedback.MessageView.ForwardAsAttachment.MessageTooLarge.Title":"Cannot forward this message as an attachment."
,"_Feedback.MessageView.ForwardAsAttachment.MessageTooLarge.Text":"This message exceeds the size limit for emails forwarded as attachments.","_MessageView.MultiSelection.Button.Junk":"Junk","_MessageView.MultiSelection.Button.NotJunk":"Not Junk","_MessageView.MultiSelection.Button.Read":"Read","_MessageView.MultiSelection.Button.Unread":"Unread","_MessageView.MultiSelection.Button.Unflagged":"Unflagged","_MessageView.MultiSelection.Button.Flagged":"Flagged","_MessageView.MultiSelection.NoneSelected":"No Message Selected","_MessageView.MultiSelection.2Selected":"Mark 2 selected messages as:","_MessageView.MultiSelection.3,4Selected":"Mark %{messagesSelected} selected messages as:","_MessageView.MultiSelection.5,6,7,8,9,10Selected":"Mark %{messagesSelected} selected messages as:","_MessageView.MultiSelection.EndingIn1GreaterThan20Selected":"Mark %{messagesSelected} selected messages as:","_MessageView.MultiSelection.EndingIn2,3,4GreaterThan20Selected":"Mark %{messagesSelected} selected messages as:","_MessageView.MultiSelection.Default":"Mark %{messagesSelected} selected messages as:","_MessageView.iWork.Picker.Button.Download":"Download","_MessageView.iWork.Picker.Button.OpenInPages":"Open in Pages","_MessageView.iWork.Picker.Button.OpenInKeynote":"Open in Keynote","_MessageView.iWork.Picker.Button.OpenInNumbers":"Open in Numbers","_MessageView.UnnamedAttachment.FilenamePrefix":"Mail Attachment","_Compose.Toolbar.SaveAsDraft.Tooltip":"Save as a draft","_Compose.Toolbar.SaveAsDraft.ButtonTitle":"Save","_Compose.Toolbar.Send.Tooltip":"Send message","_Compose.Toolbar.Send.ButtonTitle"
:"Send","_Compose.Toolbar.Cancel.Tooltip":"Cancel message","_Compose.Toolbar.ShowRTEToolbar.Tooltip":"Show format bar","_Compose.Toolbar.HideRTEToolbar.Tooltip":"Hide format bar","_Compose.SendFailure.LearnMoreButton":"Learn More","_Compose.RTEToolBar.FontSize.ToolTip":"Choose the font size","_Compose.RTEToolBar.ColorPicker.ToolTip":"Choose the text color","_Compose.RTEToolBar.Bold.Tooltip":"Bold","_Compose.RTEToolBar.Italic.Tooltip":"Italic","_Compose.RTEToolBar.Underline.Tooltip":"Underline","_Compose.RTEToolBar.AllignTextLeft.Tooltip":"Align text to the left","_Compose.RTEToolBar.CenterAlign.Tooltip":"Center text","_Compose.RTEToolBar.AllignTextRight.Tooltip":"Align text to the right","_Compose.RTEToolBar.ListButton.Tooltip":"Insert or modify a list","_Compose.RTEToolBar.TabButton.Tooltip":"Tabbing","_Compose.RTEToolBar.LinkButton.Tooltip":"Insert a hyperlink…","_Compose.RTEToolBar.ImageButton.Tooltip":"Insert an image","_ComposeMessage.To":"To:","_ComposeMessage.Cc":"Cc:","_ComposeMessage.CcBcc":"Cc/Bcc","_ComposeMessage.CcBccWithColon":"Cc/Bcc:","_ComposeMessage.Bcc":"Bcc:","_ComposeMessage.From":"From:","_ComposeMessage.Subject":"Subject:","_ComposeMessage.FwdSubjectText":"Fwd: ","_ComposeMessage.FwSubjectText":"Fw:","_ComposeMessage.ReSubjectText":"Re: ","_ComposeToolbar.ReplyText":"Reply","_ComposeToolbar.ReplyAllText":"Reply All","_ComposeToolbar.SavingDraft":"Saving…","_ComposeToolbar.SavedDraft":"Saved","_Feedback.ComposeMessage.DraftCaption.AutoSaving":"Auto-saving…","_Feedback.ComposeMessage.DraftCaption.ManualSaving":"Saving…","_Feedback.Send.BadTo.Title":"Invalid email address."
,"_Feedback.Send.BadTo.Text":"One or more addresses in the “To:” field appear to be invalid. Make corrections and try again.","_Feedback.Send.BadCC.Title":"Invalid email address.","_Feedback.Send.BadCC.Text":"One or more addresses in the “Cc:” field appear to be invalid. Make corrections and try again.","_Feedback.Send.BadBCC.Title":"Invalid email address.","_Feedback.Send.BadBCC.Text":"One or more addresses in the “Bcc:” field appear to be invalid. Make corrections and try again.","_Feedback.SendWithoutSubject.Title":"This message has no subject.","_Feedback.SendWithoutSubject.Text":"Do you want to send it anyway?","_Feedback.SendWithoutSubject.Button.SendAnyway":"Send Anyway","_Feedback.Sending":"Sending…","_Feedback.SaveDraftAlert.Title":"Save this message as a draft?","_Feedback.SaveDraftAlert.Text":"This message has not been sent and contains unsaved changes. You can save it as a draft to work on later.","_Feedback.SaveDraftAlert.Button.Save":"Save","_Feedback.SaveDraftAlert.Button.DontSave":"Don’t Save","_Print.PrintMessage":"Print Message","_Print.PageTitle":"iCloud Mail","_Print.PageTitle.Subject":"iCloud Mail - %@1","_Print.PageTitle.NoSubject":"iCloud Mail - (No Subject)","_Preferences.MailPreferences.Title":"Mail Preferences","_Preferences.General":"General","_Preferences.Composing":"Composing","_Preferences.Viewing":"Viewing","_Preferences.Vacation":"Vacation","_Preferences.Accounts":"Accounts","_Preferences.Rules":"Rules","_Preferences.Blacklist":"Junk","_Preferences.Interface":"Appearance","_Preferences.ShowMessagePreviews":"Show message previews","_Preferences.DisplayArchiveIcon"
:"Show Archive icon in the toolbar","_Preferences.DisableArchiveOptionCaption":"Disable this option to replace the Archive icon with the Trash icon.","_Preferences.EnableArchiveOptionCaption":"Enable this option to replace the Trash icon with the Archive icon.","_Preferences.MailBoxBehavior":"Mailboxes","_Preferences.SaveSentMessagesTo":"Save sent messages in:","_Preferences.MoveDeletedMessagesTo":"Move deleted messages to:","_Preferences.PermanentlyDeletedSelected":"Messages will be deleted from the trash after 30 days.","_Preferences.Forwarding":"Forwarding","_Preferences.ForwardTo":"Forward my email to:","_Preferences.ForwardToHint":"enter email address","_Preferences.InvalidForwardToAddress":"You cannot forward iCloud email to your iCloud accounts.","_Preferences.DeleteMessageAfterForwardingMessages":"Delete messages after forwarding","_Preferences.DeleteMessageAfterForwardingMessagesText":"Validate the email address before enabling this feature. Once deleted, messages cannot be recovered.","_Preferences.QuoteOriginal":"Include original message in reply","_Preferences.includeOriginalAttachmentsInReply":"Include original attachments in reply","_Preferences.IncludeOriginalAttachmentsInReply.Hint":"Not applicable to Mail Drop attachments.","_Preferences.Compose.UseMailDrop":"Use Mail Drop when sending large attachments","_Preferences.Compose.UseMailDrop.Hint":"Recipients will be able to download these files from iCloud for %{numberOfDays} days after sending.","_Preferences.Composing.Label":"Composing","_Preferences.SendFrom":"Send From","_Preferences.Signature.Label":"Signature"
,"_Preferences.SendMailAs":"Send mail as:","_Preferences.UseWhenSendingMail1":"Set a default address:","_Preferences.UseWhenSendingMailDesc":"Choose which addresses you would like to be able to send from.\n You can still receive mail at all of the addresses.","_Preferences.NameInFrom":"This name will appear in the “From” field in the mail you send.","_Preferences.Signature":"Sent from iCloud","_Preferences.SignatureText":"Add a signature","_Preferences.AutoReplyHint":"Add vacation message","_Preferences.AutoResponse":"Auto-response","_Preferences.AutoReply":"Automatically reply to messages when they are received.","_Preferences.AutoReplyText":"I am currently away from my email.","_Preferences.AutoReply.StartDate":"Start date:","_Preferences.AutoReply.EndDate":"End date:","_Preferences.AutoReplyStatus.Inactive":"Your vacation response is currently <b>inactive</b>.","_Preferences.AutoReplyStatus.Inactive.EndDateInPast":"Your vacation response is currently <b>inactive</b>. The end date must be the same as or later than today.","_Preferences.AutoReplyStatus.Active":"Your vacation response is currently <b>active</b>. It will end at 11:59 PM on %{endDate}.","_Preferences.AutoReplyStatus.Active.NoEndDate":"Your vacation response is currently <b>active</b>.","_Preferences.AutoReplyStatus.Scheduled":"Your vacation response has been <b>scheduled</b>. It will be activated at 12:00 AM on %{startDate} and end at 11:59 PM on %{endDate}.","_Preferences.AutoReplyStatus.Scheduled.NoEndDate":"Your vacation response has been <b>scheduled</b>. It will be activated at 12:00 AM on %{startDate}.","_Preferences.MonthCalendar.MonthYear.Format"
:"%{date:LLLL} %{date:yyyy}","_Preferences.LoadImages":"Load images in HTML messages","_Preferences.LoadingImageText":"Loading images in junk mail may encourage more junk mail in the future.","_Preferences.Button.Back":"Go Back","_Preferences.Button.Next":"Next","_Preferences.AccountTypeAlias":"iCloud Mail Alias","_Preferences.AccountTypeICloudIMAP":"iCloud IMAP","_Preferences.BasicInfoLabelAlias":"Alias Address:","_Preferences.BasicInfoLabelEmail":"Email Address:","_Preferences.ErrorSavingPrefDefaultButton":"Try Again","_Preferences.ErrorSavingPrefCancelButton":"Don’t Save","_Preferences.SavingChanges":"Saving your changes…","_Preferences.InvalidEmailAddress":"Invalid email address.","_Preferences.SameFromAndForwardToAddress":"The email address in the “From” field cannot be the same as the email address in the “Forward to” field.","_Preferences.InvalidSubject":"Enter a message subject.","_Preferences.LoadPreferences":"Loading…","_Preferences.EnterValidNameEmailAddress":"Enter a valid name or email address.","_Preferences.EnterValidListId":"Enter a valid list-id.","_Preferences.Blacklist.Label":"Marked as Junk","_Preferences.Blacklist.EmailAddField.Hint":"Type an email address","_Preferences.Blacklist.EmailAddButton":"Mark as Junk","_Preferences.FullName":"Full Name:","_Preferences.FullNameInfo":"Name shown in the From field","_Preferences.Description":"Label:","_Preferences.AccountAliasDetails":"Create Mail Alias","_Preferences.LabelColor":"Label Color:","_Preferences.Accounts.List.Header":"Addresses","_Preferences.Accounts.Bottom":"Add an alias…","_Preferences.Alias.Active"
:"Active","_Preferences.IMAPAccountDescription.Hint":"iCloud","_Preferences.AliasFillInformation":"Use aliases to prevent receiving unwanted messages at your primary account. Aliases cannot be changed, transferred or converted to primary accounts.&nbsp;<a href='http://www.apple.com/icloud' target='_new'>Learn More</a>.","_Preferences.Alias":"Alias:","_Preferences.CheckAlias":"Create Mail Alias","_Preferences.AliasCreated":"Mail Alias Created","_Preferences.CheckToSeeIfAliasIsAvailable":"Creating alias…","_Preferences.AliasIdSuffix":"@icloud.com","_Preferences.AccountAliasDetails.Hint":"Name","_Preferences.AliasDescription.Hint":"Shopping","_Preferences.Button.DeleteAlias":"Delete","_Preferences.AliasesCreated.ZeroOfThree":"You have 0 of 3 aliases","_Preferences.AliasesCreated.OneOfThree":"You have 1 of 3 aliases","_Preferences.AliasesCreated.TwoOfThree":"You have 2 of 3 aliases","_Preferences.AliasesCreated.ThreeOfThree":"You have 3 of 3 aliases","_Preferences.ClassicAliasesRemaining":"0 aliases remaining","_Preferences.Alias.Disable":"Disable alias","_Blacklist.SortMenu":"Sort by %{field}","_Blacklist.Sort.Name":"Name","_Blacklist.Sort.MenuTitle.Name":"Name","_Blacklist.Sort.Date":"Date","_Blacklist.Sort.MenuTitle.Date":"Date","_Blacklist.Sort.EmailAddress":"Email Address","_Blacklist.Sort.MenuTitle.EmailAddress":"Email Address","_Blacklist.Sort.Domain":"Domain","_Blacklist.Sort.MenuTitle.Domain":"Domain","_Blacklist.Sort.Ascending":"Ascending","_Blacklist.Sort.Descending":"Descending","_Blacklist.Empty.Message.Text":"Remove incoming messages from these senders.","_Blacklist.Empty.Message.Title"
:"Enter an email address below to begin.","_Blacklist.FetchFailed.Message.Text":"Cannot retrieve the list of senders marked as junk.","_Blacklist.Button.TryAgain":"Try Again","_Feedback.Preferences.AliasBeginsWithPeriod":"Alias names cannot begin with a period (.).","_Feedback.Preferences.AliasEndsWithPeriod":"Alias names cannot end with a period (.).","_Feedback.Preferences.AliasHasTwoPeriods":"Alias names cannot have two consecutive periods (..).","_Feedback.Preferences.AliasBeginsWithUnderscore":"Alias names cannot begin with an underscore (_).","_Feedback.Preferences.AliasBeginsWithNumber":"Alias names cannot begin with a number.","_Feedback.Preferences.AliasNotOfValidLength":"Alias names must be between 3-20 characters.","_Feedback.Preferences.AliasContainsInvalidChars":"Alias names may only contain unaccented letters, numbers, periods, and underscores.","_Feedback.Preferences.FullNameContainsInvalidChars":"Names may not contain the characters “<”, “ >”, “@”, colons or quotation marks.","_Feedback.Preferences.ErrorTextSignatureTooLong":"Your signature is too long.","_Feedback.Preferences.ErrorTextAutoResponseTooLong":"Your auto-response is too long.","_Feedback.Preferences.ErrorTextAutoResponseMandatory":"Enter a vacation response message.","_Feedback.Preferences.FailedSavingPreferences.Title":"Cannot save preferences.","_Feedback.Preferences.FailedSavingPreferences.Text":"The changes to preferences cannot be saved. Try again later.","_Feedback.Preferences.FailedVacationSavingPreferences.Title":"Vacation response is too long.","_Feedback.Preferences.FailedVacationSavingPreferences.Text"
:"Try using a shorter message in the response.","_Feedback.Preferences.AutoReply.StartDateError.StartDateGreaterThanEndDate":"The start date can’t occur after the end date. Change the start or end date.","_Feedback.Preferences.AutoReply.EndDateError.StartDateGreaterThanEndDate":"The end date can’t occur before the start date. Change the end or start date.","_Feedback.Preferences.AutoReply.EndDateInThePast":"This date cannot be in the past.","_Feedback.Preferences.RefreshError.Title":"Cannot load preferences.","_Feedback.Preferences.RefreshError.Text":"Preferences cannot be retrieved at this time. Try again later.","_Feedback.Preferences.ConfirmClose.Text":"You are currently editing iCloud Mail Preferences. If you close the window without saving, all changes will be lost.","_Feedback.AliasUnavailable":"This alias is not available.","_Feedback.MessageMailAliasCreated":"Your new mail alias has been created.","_Preferences.AccountUpdated":"Settings Changed","_Feedback.MessageAccountUpdated":"Your changes have been saved.","_Feedback.Preferences.MandatoryField":"Provide the required information.","_Feedback.Preferences.FromAddressTooLong":"Reduce the number of characters in this field and try again.","_Feedback.Preferences.InvalidEmailAddress":"Invalid email address","_Feedback.Preferences.DeleteAccount.Title":"Delete alias %{aliasName}?","_Feedback.Preferences.DeleteAccount.Text":"You currently have the maximum number of aliases allowed. If you delete this alias, you cannot add a new one until you have fewer than 3 aliases.","_Feedback.Preferences.MaxAliasDeleteConfirm.Title":"Delete alias %{aliasName}?"
,"_Feedback.Preferences.MaxAliasDeleteConfirm.Text":"If you delete this alias you will have to wait 7 days before creating a new one.","_Feedback.Preferences.FailedDeletingAccounts.Title":"Cannot delete alias.","_Feedback.Preferences.FailedDeletingAccounts.Text":"This alias cannot be deleted at this time. Try again later.","_Feedback.Preferences.AccountNotSaved.Title":"Cannot save alias.","_Feedback.Preferences.AccountNotSaved.Text":"This alias cannot be saved at this time. Try again later.","_Feedback.Preferences.AccountAlreadyExists.Title":"Alias already exists.","_Feedback.Preferences.AccountAlreadyExists.Text":"This email address is already one of your aliases.","_Feedback.Preferences.ErrorQuotes":'Quotation marks (") are not allowed here.',"_Feedback.Preferences.NonIcloudAliasConfirm.Title":"Delete alias %{aliasName}?","_Feedback.Preferences.NonIcloudAliasConfirm.Text":"If you delete this alias, you will not be able to add it back. All new iCloud aliases are @icloud.com email addresses.","_Feedback.Preferences.AliasFullNameTooLong.Title":"Full name is too long.","_Feedback.Preferences.AliasFullNameTooLong.Text":"Shorten the name and try again.","_Feedback.Preferences.AliasError.SessionExpired.Title":"Alias cannot be created.","_Feedback.Preferences.AliasError.SessionExpired.Text":"Sign out and back in to try again.","_Feedback.Preferences.AliasError.SessionExpired.SignOut.Button":"Sign out","_Feedback.Preferences.AliasCapReached.1DayRemaining.Title":"Waiting period in progress.","_Feedback.Preferences.AliasCapReached.1DayRemaining.Text":"You had the maximum number of aliases and deleted one recently. You will be able to create a new alias in one day."
,"_Feedback.Preferences.AliasCapReached.2DaysRemaining.Title":"Waiting period in progress.","_Feedback.Preferences.AliasCapReached.2DaysRemaining.Text":"You had the maximum number of aliases and deleted one recently. You will be able to create a new alias in two days.","_Feedback.Preferences.AliasCapReached.3DaysRemaining.Title":"Waiting period in progress.","_Feedback.Preferences.AliasCapReached.3DaysRemaining.Text":"You had the maximum number of aliases and deleted one recently. You will be able to create a new alias in three days.","_Feedback.Preferences.AliasCapReached.4DaysRemaining.Title":"Waiting period in progress.","_Feedback.Preferences.AliasCapReached.4DaysRemaining.Text":"You had the maximum number of aliases and deleted one recently. You will be able to create a new alias in four days.","_Feedback.Preferences.AliasCapReached.5DaysRemaining.Title":"Waiting period in progress.","_Feedback.Preferences.AliasCapReached.5DaysRemaining.Text":"You had the maximum number of aliases and deleted one recently. You will be able to create a new alias in five days.","_Feedback.Preferences.AliasCapReached.6DaysRemaining.Title":"Waiting period in progress.","_Feedback.Preferences.AliasCapReached.6DaysRemaining.Text":"You had the maximum number of aliases and deleted one recently. You will be able to create a new alias in six days.","_Feedback.Preferences.AliasCapReached.7DaysRemaining.Title":"Waiting period in progress.","_Feedback.Preferences.AliasCapReached.7DaysRemaining.Text":"You had the maximum number of aliases and deleted one recently. You will be able to create a new alias in seven days."
,"_Feedback.Preferences.Button.Disable":"Disable","_Feedback.Preferences.ServerConnectionError.Title":"Mail has lost connection.","_Feedback.Preferences.ServerConnectionError.Text":"This request couldn’t be completed due to a connection error. Try again later.","_Feedback.Preferences.ServerGenericError.Title":"Cannot complete request","_Feedback.Preferences.ServerGenericError.Text":"Your request cannot be completed at this time. Try again later.","_ComposeMessage.AttachFileInProgress":"Attaching file…","_ComposeMessage.AttachFilesInProgress":"Attaching files…","_ComposeMessage.AttachFile":"(<a>Add another…</a>)","_ComposeMessage.AttachmentCount.SingleFile":"%{attachmentCount} attachment,","_ComposeMessage.AttachmentCount.MultipleFiles":"%{attachmentCount} attachments,","_ComposeMessage.Remaining":"%@1 %@2 attached, %@3 %@4 available","_ComposeMessage.AttachmentSize":"%@1 %@2","_ComposeMessage.PastedImage.FilenamePrefix":"PastedImage-%{fileIndex}.%{fileExtension}","_ComposeMessage.ForwardAsAttachment.FileName":"Forwarded Message","_Feedback.Upload.ServerError.Title":"Cannot add attachment.","_Feedback.Upload.ServerError.Text":"%@1 cannot be attached at this time. If you are trying to attach a folder, try compressing it first.","_Feedback.Upload.UnsupportedFileFormat.Title":"Cannot add %{attachmentName}.","_Feedback.Upload.UnsupportedFileFormat.Text":"%{attachmentName} cannot be uploaded because Mail does not support attachments in “.%{attachmentExtension}” format. Try compressing it first.","_Feedback.Upload.SizeQuotaExceeded.Title":"Attachment exceeds limit.","_Feedback.Upload.SizeQuotaExceeded.Text"
:"%{fileName} cannot be attached because it exceeds the maximum allowed size for attachments (%{maxSize} %{sizeUnit}).","_Feedback.Upload.SizeQuotaExceeded.IMAP.Caption":"To send this attachment, turn on Mail Drop in Preferences.","_Feedback.Upload.QuotaExceeded.Title":"Too many attachments.","_Feedback.Upload.QuotaExceeded.Text":"%{fileName} cannot be attached because you already have the maximum number of %{number} attachments.","_Feedback.Upload.NotRegularFile.Title":"Cannot upload attachment.","_Feedback.Upload.NotRegularFile.Text":"%@1 cannot be attached. Try compressing it first.","_Feedback.Upload.AccessDenied.Title":"Cannot upload attachments.","_Feedback.Upload.AccessDenied.Text":"Make sure you have permission to read the files.","_Feedback.Upload.NetworkError.Title":"Cannot upload attachment.","_Feedback.Upload.NetworkError.Text":"%@1 cannot be attached. Make sure you have permission to read the file.","_Upload.Error.UnknownFileName":"This attachment","_Feedback.Upload.UnableToFetchDocumentFromRemoteServer.Title":"Cannot add attachment.","_Feedback.Upload.UnableToFetchDocumentFromRemoteServer.Text":"%{fileName} cannot be attached at this time. Close this window and try sending the document again.","_Feedback.Upload.CannotUploadAttachments.Caption":"Choose OK to continue attaching the remaining files or Cancel All to stop.","_Feedback.Upload.Button.CancelAll":"Cancel All","_Feedback.Upload.ZeroByteFile.Title":"Cannot upload attachment.","_Feedback.Upload.ZeroByteFile.Text":"%{fileName} cannot be attached. Try compressing it first.","_MessageView.MailDrop.Coupon.DownloadInstructions.Title"
:"Download from iCloud","_MessageView.MailDrop.Banner.DownloadInstructions.ImageArchive.Title":"Download full resolution images.","_MessageView.MailDrop.Banner.DownloadInstructions.Image.Title":"Click on the image in the email to download full resolution version from iCloud.","_MessageView.MailDrop.Banner.DownloadInstructions.MultipleImages.Title":"Click on the images in the email to download full resolution versions from iCloud.","_MessageView.MailDrop.Banner.DownloadInstructions.ImagesAndFiles.Title":"Click on the images in the email to download full resolution versions from iCloud.","_MessageView.MailDrop.Banner.AttachmentExpiration.OneFile":"Attachment available until %{date}.","_MessageView.MailDrop.Banner.AttachmentExpiration.ManyFiles":"Attachments available until %{date}.","_MessageView.MailDrop.Coupon.Image.DownloadInstructions.AltText":"Click to download full resolution image from iCloud.","_MessageView.MailDrop.Banner.AttachmentExpiration.SavedDraft":"Attachment available for %{days} days after message is sent.","_MessageView.MailDrop.Banner.AttachmentsExpiration.SavedDraft":"Attachments available for %{days} days after message is sent.","_MessageView.MailDrop.Coupon.Expired.Title":"Expired","_MessageView.MailDrop.Banner.Expired.Image.Text":"Full resolution image expired on %{date}.","_MessageView.MailDrop.Banner.Expired.MultipleImages.Text":"Full resolution images expired on %{date}.","_MessageView.MailDrop.Banner.Expired.File.Text":"Attachment expired on %{date}.","_MessageView.MailDrop.Banner.Expired.MultipleFiles.Text":"Attachments expired on %{date}.","_Feedback.Upload.MailDrop.CannotUploadAttachment.Title"
:"Cannot upload attachment.","_Feedback.Upload.MailDrop.CannotUploadAttachment.Text":"%{fileName} cannot be attached at this time. Try again later.","_Feedback.Upload.MailDrop.CannotUploadAttachments.Title":"Cannot upload attachments.","_Feedback.Upload.MailDrop.CannotUploadAttachments.Text":"Files cannot be attached at this time. Try again later.","_Feedback.Upload.SizeQuotaExceeded.UploadLargeAttachment.ManyFiles.Title":"Would you like to deliver these files using Mail Drop?","_Feedback.Upload.SizeQuotaExceeded.UploadLargeAttachment.ManyFiles.Text":"These attachments are too large to send in email. Mail Drop can deliver large files by making them available in the cloud. Recipients can download them from iCloud for the next %{numberOfDays} days.","_Feedback.Upload.SizeQuotaExceeded.UploadLargeAttachment.SingleFile.Title":"Would you like to deliver this file using Mail Drop?","_Feedback.Upload.SizeQuotaExceeded.UploadLargeAttachment.SingleFile.Text":"This attachment is too large to send in email. Mail Drop can deliver large files by making them available in the cloud. Recipients can download them from iCloud for the next %{numberOfDays} days.","_Feedback.Upload.MailDrop.Button.Send":"Use Mail Drop","_Feedback.Upload.MailDrop.Button.DontSend":"Don’t use Mail Drop","_Feedback.Upload.MailDrop.Button.DontAskAgain":"Don’t ask again","_Feedback.Upload.MailDrop.CannotMigrateAttachments.Title":"Cannot attach files due to a server error.","_Feedback.Upload.MailDrop.CannotMigrateAttachments.Text":"To try again, go to your Drafts folder, open the saved message draft and reattach the missing files."
,"_Feedback.Upload.MailDrop.MissingServiceIdentities.Title":"Sign in to iCloud again to set up Mail Drop.","_Feedback.Upload.MailDrop.MissingServiceIdentities.Text":"Save all drafts and sign out of iCloud. You will be able to use Mail Drop after you sign back in.","_Feedback.Upload.MailDrop.StorageQuotaExceeded.Title":"Cannot attach file.","_Feedback.Upload.MailDrop.StorageQuotaExceeded.Text":"This file cannot be attached because it would exceed your Mail Drop quota.","_Feedback.Upload.MailDrop.StorageQuotaExceeded.Caption":"You will be able to attach this file later when your older Mail Drop attachments expire.","_Feedback.Upload.MailDrop.StorageQuotaExceeded.MultipleFiles.Title":"Cannot attach files.","_Feedback.Upload.MailDrop.StorageQuotaExceeded.MultipleFiles.Text":"These files cannot be attached because they would exceed your Mail Drop quota.","_Feedback.Upload.MailDrop.StorageQuotaExceeded.MultipleFiles.Caption":"You will be able to attach these files later when your older Mail Drop attachments expire.","_Feedback.Download.MailDrop.Attachment.Expired.Title":"Attachment expired.","_Feedback.Download.MailDrop.Attachment.Expired.Text":"This file is no longer available. Ask the sender to attach it again.","_Feedback.Download.MailDrop.Attachment.Not.Found.Title":"Attachment cannot be found.","_Feedback.Download.MailDrop.Attachment.Not.Found.Text":"This file cannot be found. Ask the sender to attach it again.","_Feedback.Download.MailDrop.Server.Error.Title":"Cannot download file.","_Feedback.Download.MailDrop.Server.Error.Text":"There was a problem downloading this file. Try again later."
,"_Feedback.Download.MailDrop.Attachment.Download.Limit.Exceeded.Title":"File no longer available.","_Feedback.Download.MailDrop.Attachment.Download.Limit.Exceeded.Text":"This file is unavailable because it has reached the maximum number of downloads. Ask the owner to resend the file.","_MessageView.MailDrop.TextBody.DownloadInstructions":"Click to download.","_Feedback.Remote.MailDrop.Upload.InvalidTotalSize.Title":"Cannot compose message.","_Feedback.Remote.MailDrop.Upload.InvalidTotalSize.Text":"An error occurred loading Compose window. Close the window and try again.","_Feedback.MailDrop.Malicious.Coupon.ErrorCatcher.Dialog.Title":"Message contains suspicious attachments.","_Feedback.MailDrop.Malicious.Coupon.ErrorCatcher.Dialog.Message":"Help Apple improve its products by sending us diagnostic and usage information about iCloud.","_Attachments.UploadProgress.SizeRemaining.WithUploadSpeed":"%{completedSize} of %{totalSize}, %{uploadSpeedString}/sec - %{timeRemaining}","_Attachments.UploadProgress.FormattedSize":"%{fileSize} %{sizeUnits}","_Attachments.UploadProgress.FilesRemaining.With.Time.AndUploadSpeed":"%{currentFileNumber} out of %{totalFiles} files, %{uploadSpeedString}/sec - %{timeRemaining}","_Attachments.UploadProgress.FilesRemaining.SingleFile":"%{currentFileNumber} out of %{totalFiles} file","_Attachments.UploadProgress.FilesRemaining.ManyFiles":"%{currentFileNumber} out of %{totalFiles} files","_Attachments.UploadProgress.PreparingForUpload":"Preparing…","_Attachments.UploadProgress.FinishingUpload":"Finishing…","_Attachments.UploadProgress.TimeRemaining.EstimatingTimeRemaining"
:"Estimating time remaining…","_Attachments.UploadProgress.TimeRemaining.AboutXHours":"About %{numberOfHours} hours","_Attachments.UploadProgress.TimeRemaining.AboutAnHour":"About an hour","_Attachments.UploadProgress.TimeRemaining.AboutXMinutes":"About %{numberOfMinutes} minutes","_Attachments.UploadProgress.TimeRemaining.AboutAMinute":"About a minute","_Attachments.UploadProgress.TimeRemaining.LessThanAMinute":"Less than a minute","_Attachments.UploadProgress.TimeRemaining.AboutXSeconds":"About %{numberOfSeconds} seconds","_Attachments.UploadProgress.Uploading":"Uploading…","_RichTextToolbar.FontNameMenu.SelectFont":"Select font","_RichTextToolbar.LinkReveal.LinkTitle":"Link Title","_RichTextToolbar.LinkReveal.URL":"URL","_RichTextToolbar.LinkReveal.RemoveLink":"Remove Link","_RichTextToolbar.ListMenu.None":"None","_RichTextToolbar.ListMenu.Bullet":"&#149; Bullet","_RichTextToolbar.ListMenu.Numbered":"1. Numbered","_RichTextToolbar.IndentMenu.Indent":"Indent","_RichTextToolbar.IndentMenu.Outdent":"Outdent","_RichTextToolbar.AttachText":"Attach a file…","_RichTextEditor.ReplyText":"On %@1, %@2 wrote:","_RichTextEditor.ForwardModeFrom":"From: ","_RichTextEditor.ForwardModeDate":"Date: ","_RichTextEditor.ForwardModeTo":"To: ","_RichTextEditor.ForwardModeCc":"Cc: ","_RichTextEditor.ForwardModeSubject":"Subject: ","_RichTextEditor.ForwardText":"Begin forwarded message:","_Feedback.RichTextEditor.ImagePasteNotSupported.Title":"Pasting images is not supported.","_Feedback.RichTextEditor.ImagePasteNotSupported.Text":"To attach an image, click on the attachment icon and choose a file, or drag an image into the compose window."
,"_Contacts.Loading":"Loading Contacts…","_Contacts.Button.TryAgain":"Try again","_Contacts.Search.NoResult":"No Results","_Contacts.EmptyContact":"No Contacts","_Contacts.Main.Title":"Contacts","_Contacts.Main.SearchContacts":"Search Contacts","_Contacts.Header.Group":"Group","_Contacts.Header.Name":"Name","_Contacts.Header.Email":"Email","_Contacts.Header.SearchContacts":"Search Contacts","_Contacts.Header.To":"To:","_Contacts.Header.Cc":"Cc:","_Contacts.Header.Bcc":"Bcc:","_Contacts.Entry.HomeIndicator":"(h)","_Contacts.Entry.WorkIndicator":"(w)","_Contacts.Entry.OtherIndicator":"(o)","_Contacts.Picker.Vip":"VIP","_Contacts.ContactPicker.FirstName":"First Name","_Contacts.ContactPicker.LastName":"Last Name","_Contacts.ContactPicker.CompanyName":"Company","_Contacts.ContactPicker.emailType.Work":"Work","_Contacts.ContactPicker.emailType.Home":"Home","_Contacts.ContactPicker.emailType.Other":"Other","_Feedback.Contacts.ServerErrorMessage.Title":"Cannot load Contacts.","_Feedback.Contacts.ServerErrorMessage.Text":"Contacts cannot be displayed at this time. Try again later.","_Spinner.Loading":"Loading…","_Common.Button.Done":"Done","_Common.Button.OK":"OK","_Common.Button.Cancel":"Cancel","_Common.Button.Delete":"Delete","_Common.Button.Open":"Open","_Common.Comma":",","_Common.Add":"Add","_Common.Bytes":"Bytes","_Common.KB":"KB","_Common.MB":"MB","_Common.GB":"GB","_Common.Number.DecimalCharacter":".","_Common.Button.ReloadMail":"Reload Mail","_Common.Button.Close":"Close","_Common.Button.Retry":"Retry","_Vip.Welcome.Title.Text":"VIP","_Vip.Welcome.QuicklyAccess.Text":"Quickly access mail from important people."
,"_Vip.Welcome.ToGetStarted.Text":"To get started, open a message, then click on the sender’s name and select VIP.","_Feedback.VipSender.AddVip.Title":"Add “%{recipient}” as VIP?","_Feedback.VipSender.AddVip.Text":"All messages from this sender will be available for quick access in the VIP folder.","_Feedback.VipSender.Button.DontAdd":"Don’t Add","_Feedback.VipSender.DeleteFolder.Title":"Delete “%{folderName}”?","_Feedback.VipSender.DeleteFolder.Text":"Are you sure you want to remove this VIP? Messages from this sender will remain in your Inbox.","_Feedback.VipSender.MessageList.LoadFailed.ServerError.Title":"Cannot load messages from “%{selectedFolder}”.","_Feedback.VipSender.MessageList.LoadFailed.ServerError.Text":"Messages cannot be displayed at this time. Try again later.","_Feedback.VipSender.AddFailed.ServerError.Title":"Cannot add to VIP list.","_Feedback.VipSender.AddFailed.ServerError.Text":"Cannot add VIP status at this time. Try again later.","_Feedback.VipSender.RenameFailed.ServerError.Title":"Cannot rename “%{vipSender}”.","_Feedback.VipSender.RenameFailed.ServerError.Text":"This folder cannot be renamed at this time. Try again later.","_Feedback.VipSender.DeleteFailed.ServerError.Title":"Cannot remove from VIP list.","_Feedback.VipSender.DeleteFailed.ServerError.Text":"Cannot remove VIP status at this time. Try again later.","_Feedback.MailFilters.MaxRulesExceeded.Title":"Cannot create rule.","_Feedback.MailFilters.MaxRulesExceeded.Text":"iCloud Mail allows a maximum of %{maxRulesLimit} rules. Delete an existing rule to create a new one.","_Feedback.MailFilters.DeleteRule.Title"
:"Delete rule?","_Feedback.MailFilters.DeleteRule.Text":"This rule will no longer apply to incoming messages.","_Feedback.MailFilters.DeleteRules.Title":"Delete rules?","_Feedback.MailFilters.DeleteRules.Text":"These rules will no longer apply to incoming messages.","_Feedback.MailFilters.ForwardToOwnAddress.Title":"Cannot create rule.","_Feedback.MailFilters.ForwardToOwnAddress.Text":"You cannot forward iCloud email to your iCloud accounts.","AppTitle.mail":"Mail","ErrorCatcher.Dialog.Title":"%@ has stopped responding.","ErrorCatcher.Dialog.Text":"An error has prevented this application from working properly. Help Apple improve its products by sending us diagnostic and usage information about iCloud.","ErrorCatcher.Dialog.Caption":'By clicking “Send to Apple” you agree that Apple will collect and use this information as part of its support services and to improve its products and services. This report will include personal information such as your member name and user data. To learn more about Apple’s Privacy Policy, see <a target="_BLANK" href="http://www.apple.com/privacy/">http://www.apple.com/privacy/</a>.',"ErrorCatcher.Dialog.Details":"Details","ErrorCatcher.Dialog.ReportButton":"Send to Apple","ErrorCatcher.Dialog.CloseButton":"Close","ErrorCatcher.Dialog.OKButton":"OK","_AX.Messages":"Messages","_AX.MailBoxes":"Mailboxes"}),window.MailServerVersion={serverBuildRevision:null,serverBuildSeries:null,parseXRespondingInstance:function(e){var t=e.get("headers"),n;if(t){n=t["X-Responding-Instance"];if(!n)return;if(this._prevRespondingInstance===n)return;this._prevRespondingInstance=
n,n=n.split(":");if(n&&n.length!==6&&!this._isRespondingInstanceExceptionReported){this._isRespondingInstanceExceptionReported=YES;var r={error:"Unexpected X-Responding-Instance format"};CoreMail.errorHandler.reportNonFatalError(r);return}var i=n[4];i&&i.length>=3&&(i=i.substring(0,3),this.setIfChanged("serverBuildSeries",i));var s=n[5];s=parseInt(s,10),this.setIfChanged("serverBuildRevision",s)}},LATEST_SERVER_BUILD_SERIES:"15F",LATEST_SERVER_BUILD_REVISION:20350,isLatestServerVersion:function(){var e=this.get("serverBuildRevision"),t=this.get("serverBuildSeries");return(!e||!t)&&window.WHAT_TYPE.isMailChild()?opener.CoreMail.get("isLatestServerVersion"):t>=this.LATEST_SERVER_BUILD_SERIES&&e>=this.LATEST_SERVER_BUILD_REVISION?YES:NO}.property("serverBuildRevision","serverBuildSeries").cacheable()},window.CoreMail=SC.Object.create(window.MailServerVersion,{init:function(){delete window.MailServerVersion},FOLDER_PERF:YES,HACK_SEARCH:YES,SLOT:"-1.-1",NAME:"CoreMail",VERSION:"0.1.0",ENABLE_STATS:YES,INBOX_GUID:"folder:INBOX",TRASH_GUID:"folder:Deleted Messages",SENT_GUID:"folder:Sent Messages",DRAFTS_GUID:"folder:Drafts",JUNK_GUID:"folder:Junk",ARCHIVE_GUID:"folder:Archive",SERVER_PREFS_GUID:"serverPrefsGuid",IMPLICIT_PREFS_GUID:"implicitPrefsGuid",IDENTITY_ACCOUNT_GUID:"identityAccountGuid",UNDISCLOSED_RECIPIENTS_GUID:"undisclosed-recipients: ;",undisclosedRecipientsRecordStoreKey:null,TEXT:256,TEXT_PLAIN:257,TEXT_HTML:272,IMAGE:4096,APPLICATION:65536,VIDEO:65537,AUDIO:65552,MODEL:65553,OTHER:1048576,ATTACHMENT_NAME_LENGTH:20,ATTACHMENT_NAME_TRUNCATION_BUFFER:5,ATTACHMENT_BYTES_FOR_KB
:1e3,ATTACHMENT_BYTES_FOR_MB:1e6,ATTACHMENT_BYTES_FOR_GB:1e9,ATTACHMENT_IMAGE_THUMBNAIL_GENERATE_LIMIT:25e6,MAX_IMAP_BASE64_ATTACHMENT_SIZE:33554432,UPLOAD_MODE_IMAP:"upload_imap",UPLOAD_MODE_MAIL_DROP:"upload_mail_drop",NO_OF_DAYS_IN_A_YEAR:365,MINUTE_LENGTH_IN_MILLISECONDS:6e4,YEAR_LENGTH_IN_MILLISECONDS:31536e6,WEEK_LENGTH_IN_MILLISECONDS:6048e5,DAY_LENGTH_IN_MILLISECONDS:864e5,HOUR_LENGTH_IN_MILLISECONDS:36e5,MONTH_LENGTH_IN_MILLISECONDS:2628e6,END_OF_DAY_TIME_IN_SECONDS:86399,FOLDER_ROLE_INBOX:"INBOX",FOLDER_ROLE_DRAFTS:"DRAFTS",FOLDER_ROLE_SENT:"SENT",FOLDER_ROLE_TRASH:"TRASH",FOLDER_ROLE_JUNK:"JUNK",FOLDER_ROLE_ARCHIVE:"ARCH",FOLDER_ROLE_FOLDER:"FOLDER",FOLDER_ROLE_GHOST:"GHOST",FOLDER_ROLE_VIP:"VIP",FOLDER_NAME_ARCHIVE:"Archive",FOLDER_NAME_SENT:"Sent Messages",FOLDER_NAME_TRASH:"Deleted Messages",FOLDER_NAME_INBOX:"inbox",FOLDER_NAME_DRAFTS:"Drafts",FOLDER_NAME_JUNK:"Junk",FOLDER_GROUP_MAILBOXES:"_FolderList.Group.MailBoxes",FOLDER_GROUP_FOLDERS:"_FolderList.Group.Folders",MESSAGE_MODE_COMPOSE:"compose",MESSAGE_MODE_REPLY:"reply",MESSAGE_MODE_REPLY_ALL:"replyAll",MESSAGE_MODE_FORWARD:"forward",MESSAGE_MODE_FORWARD_AS_ATTACHMENT:"forwardAsAttachment",MESSAGE_MODE_VIEW:"view",SPAM_HEADER:"X-Suspected-Spam",JUNK_FLAG:"junkFlag",JUNK_SPAM:"junkSpam",JUNK_OTHER:"junkOther",SORT_BY_FLAG:"Flag",SORT_BY_UNREAD:"Unread",SORT_BY_FROM:"From",SORT_BY_SUBJECT:"Subject",SORT_BY_DATE:"Date",SORT_BY_TO:"To",SORT_BY_SIZE:"Size",SEARCH_ANYFIELD:"anyfield",SEARCH_SUBJECT:"subject",SEARCH_FROM:"from",SEARCH_RECIPIENT:"recipient",MESSAGE_FLAG_READ:"read",MESSAGE_FLAG_UNREAD:"unread",MESSAGE_FLAG_JUNK
:"junk",MESSAGE_FLAGGED:"flagged",BL_SORT_BY_EMAIL:"Email",BL_SORT_BY_DATE:"Date",BL_SORT_BY_NAME:"Name",BL_SORT_BY_DOMAIN:"Domain",IMAGE_ORIENTATION_CLASS_PREFIX:function(){return"pre-"+CW.UUID()+"-"}(),BENCH_MAIL_STARTUP:"Mail Startup",BENCH_MAIL_CLIENT_LOAD:"Waiting for application to become visible",cloudOSBenchmarks:null,INTERVAL_SEARCH_KEY_PRESS:1500,INTERVAL_SEARCH_ENTER:50,INTERVAL_MESSAGE_BATCH_FETCH:250,INTERVAL_MESSAGE_DETAIL_FETCH:175,INTERVAL_SAVE_IMPL_PREFS:200,INTERVAL_CLOSE_COMPOSE:1,INTERVAL_FOLDER_LIST_FETCH:50,INTERVAL_AUTO_SAVE_DRAFT:3e3,INTERVAL_CHILD_WINDOW_CLEANUP:5e3,INTERVAL_LOG_CLEANUP:3e5,INTERVAL_COMPOSE_NOTIFY:2e3,INTERVAL_RESYNC:250,INTERVAL_SOURCE_LIST_ANIMATION:.25,INTERVAL_DISABLE_ANIMATION:500,INTERVAL_XHR_TIMEOUT:6e4,INTERVAL_PREFERENCES_ANIMATION:350,INTERVAL_SET_MESSAGE_LIST:12e4,INTERVAL_SEND_DISABLE_WAIT:500,INTERVAL_RESYNC_FOLDER_LIST:12e4,INTERVAL_RESYNC_MESSAGE_LIST:12e4,INTERVAL_VIP_POLL:15e5,INTERVAL_UNSEEN_VIP_TIMEOUT:12e4,INTERVAL_COMPOSE_TAB_INSERT_ACTION:50,INTERVAL_MORE_HIDE_BUTTON_TOP_ADJUST:10,INTERVAL_DRAG_HOVER_ON_COLLAPSED_COMPOSE_HEADER:300,INTERVAL_DRAG_HOVER_ON_COLLAPSED_FOLDER:500,INTERVAL_AUTO_COMPLETE_TOKEN_VIEW_HEIGHT_RESIZE:200,INTERVAL_DELETED_IMAGE_PRUNE:2e3,DEFAULT_SOURCELIST_THICKNESS:.3,DEFAULT_SEARCHFIELD_WIDTH:181,DEFAULT_SNIPPET_LEN:150,DRAG_START_THRESHOLD:10,emailCache:{},CHILD_WINDOW_HASHES:{},DELETED_GUIDS:[],DELETED_UIDS:[],DEFAULT_IDENTITY_ACCOUNT_DESCRIPTION:"_Preferences.IMAPAccountDescription.Hint".loc(),ACCOUNT_COLOR_CODES:{GRAY:"#a8a8a8",ORANGE:"#ffac00",GREEN:"#5bbb00",BLUE:"#009fea",PURPLE:"#d88aef"
,RED:"#ff716e",getCode:function(e){for(var t in this)if(e===this[t])return e;return this.GRAY}},INCOMPLETE_PREFERENCES:13017,ERROR_AUTH_INVALIDATED:421,COMPOSE_GUID:"COMPOSE",RESYNC_FOLDERS:"RESYNC_FOLDERS",RESYNC_MSGLIST:"RESYNC_MSGLIST",HELP_TOPIC_ID:"mm6b1a17e3",ALIAS_HELP_TOPIC_ID:"mm6b1a490a",RULES_HELP_TOPIC_ID:"mm6b1a3f8a",IWORK_KEYNOTE_FILE:"keynote",IWORK_PAGES_FILE:"pages",IWORK_NUMBERS_FILE:"numbers",COMPOSE_POPULATE_FIELDS_JSON_RPC_ID:"populateFields/1",COMPOSE_IS_READY_TO_SHOW:"readyToShow/1",COMPOSE_ADD_PARTICIPANTS_JSON_RPC_ID:"addParticipants/1",MESSAGE_LIST_UNSUBSCRIBE_STATUS_ACCEPTED:"accepted",MESSAGE_LIST_UNSUBSCRIBE_STATUS_IGNORED:"ignored",MAX_RULES_LIMIT:500,SEED:CW.UUID(),userPartition:function(){var e=CloudOS.getUrlForServiceName("mail")||"",t=e.match(/^https?:\/\/(p[a-z0-9]+)-/i);return t?t[1]:null}.property().cacheable(),accountsBinding:SC.Binding.oneWay("Preferences.accountPreferencesController.content"),userEmailAddresses:function(){var e=[],t,n,r,i,s,o=this.store.find(this.IdentityAccount,this.IDENTITY_ACCOUNT_GUID);if(!o||o.get("status")===SC.Record.ERROR)this.errorHandler.recordStat("ERROR_IdentityAccountNotFound");else{s=o.get("emails");for(n=0,t=s.length;n<t;n++)e.push(s[n].address)}o=this.store.find(this.AliasAccount);if(o){r=o.get("length");var u;for(n=0;n<r;n++){u=o.objectAt(n),s=u.get("emails");for(i=0,t=s.get("length");i<t;i++)e.push(s[i].address)}}return e}.property("accounts").cacheable()}),CW.set("requestLoggingLevel",SC.LOGGER_LEVEL_DEBUG),CoreMail.MailRequest=CK.Request.extend({reportRequest:YES,reportPath:"Misc",_redirectCountForTimeout
:0,_redirectCount:0,MAX_REDIRECT_FOR_TIMEOUT:1,MAX_REDIRECT:4,_cancelled:[],attachIdentifyingHeaders:NO,serviceName:"mail",willSend:function(e){arguments.callee.base.apply(this,arguments);var t=e.get("body");CoreMail.ENABLE_STATS&&t&&(t.userStats=CoreMail.iReporterStats(),t.systemStats=CoreMail.hubbleStats())},willReceive:function(e,t){arguments.callee.base.apply(this,arguments);if(t.get("isCancelled")===YES){SC.debug("CoreMail.MailRequest.willReceive: Request has been cancelled. Nothing to do");return}var n=t.rawRequest,r=n?n.status:0,i=t.get("body"),s=SC.typeOf(i),o=Math.floor(r/100);r===200&&(window.REDIRECT_RESPONSE_TEXT===n.responseText||s===SC.T_ERROR)&&this._redirectCount<this.MAX_REDIRECT||o===5&&this._redirectCount<this.MAX_REDIRECT||r===0&&this._redirectCountForTimeout<this.MAX_REDIRECT_FOR_TIMEOUT?(this._redirectCount++,r===0&&this._redirectCountForTimeout++,SC.warn("REJECTING SERVER RESPONSE CoreMail.MailRequest.willReceive:\n						Status:%@\n						Request:%@\n						Wmsid:%@\n						Redirect Count:%@\n						Timeout Redirect Count:%@\n						".fmt(r,e.get("address"),CK.readCookie("wmsid"),this._redirectCount,this._redirectCountForTimeout)),t.cancel(),e.send()):((r===200&&(window.REDIRECT_RESPONSE_TEXT===n.responseText||s===SC.T_ERROR)&&this._redirectCount===this.MAX_REDIRECT||o===5&&this._redirectCount===this.MAX_REDIRECT||r===0&&this._redirectCountForTimeout>=this.MAX_REDIRECT_FOR_TIMEOUT)&&SC.error("GIVING UP ON RETRIES, CoreMail.MailRequest.willReceive: \nthis._redirectCount: %@".fmt(this._redirectCount)),this._redirectCount=0,this._redirectCountForTimeout=0)},didSend
:function(e){arguments.callee.base.apply(this,arguments);var t=e.get("benchKey");if(t){var n="----------------> Request out: "+t;n+="\n	wmsid: "+CK.readCookie("wmsid");var r=SC.copy(e.get("body").params);this._redactSensitiveData(e.get("address"),e.get("body").method,r);if(r)if(!r.requesttype)n+="\n	params: "+SC.json.encode(r);else{var i=SC.json.encode(r);n+="\n	params: "+i}SC.debug(n),SC.Benchmark.start(t)}},didReceive:function(e,t){arguments.callee.base.apply(this,arguments);if(t.get("isCancelled")){CoreMail.errorHandler.recordStat("_STAT_didReceiveRequestWhenInSuspendedState");return}var n=t.get("status");if(n===405&&!Global.get("isMethodNotAllowedErrorReported")){SC.debug("CoreMail.MailRequest.didReceive: Recieved 405 response for the request body: "+SC.json.encode(e.get("body"))),Global.set("isMethodNotAllowedErrorReported",YES);var r={error:"Request returned 405 Method not allowed.",title:"_Feedback.Response.RequestFailed.Title".loc()};CoreMail.errorHandler.reportNonFatalError(r)}var i=e.get("benchKey");CoreMail.parseXRespondingInstance(t);if(i){SC.Benchmark.end(i);var s=SC.Benchmark.stats[i].amt,o=t.get("body"),u="",a="";if(n===200){var f=o.error;f&&(u=f.code,a=f.message)}var l=i+",httpStatus: "+n+",round trip time: "+s+"ms, wmsid: "+CK.readCookie("wmsid");u&&(l+=","+u,a&&(l+=","+a)),SC.debug("<---------------- Request in: "+l)}},didTimeout:function(e,t){var n=t.get("listeners");n&&CoreMail.Request.cancel(n[0],t,YES),CoreMail.Request.cancelUnfinishedRequests(CoreMail.Request.ALL)},copy:function(){var e=arguments.callee.base.apply(this,arguments);return e.set("benchKey"
,this.get("benchKey")),e},_sensitiveParams:{"/wm/message":{saveDraft:["body","textBody"],send:["body","textBody"]}},_redactSensitiveData:function(e,t,n){var r;if(!(r=this._sensitiveParams[e])||!(r=r[t]))return n;for(var i in n)r.indexOf(i)!==-1&&(n[i]="<redacted>");return n}}),SC.mixin(CoreMail,{Request:{BASE_URL:"/wm/",MESSAGE_LIST_BATCH_SIZE:50,SEARCH:256,SEARCH_WITH_SELECTION:257,SORT:4096,SORT_WITH_SELECTION:4097,CREATE_ACCOUNT:"CREATE_ACCOUNT",CREATE_FOLDER:"CREATE_FOLDER",DELETE_MSG_SINGLE:"DELETE_MESSAGE_SINGLE",DELETE_MSG_SELECTION:"DELETE_MESSAGE_SELECTION",MOVE_MSG_SINGLE:"MOVE_MESSAGE_SINGLE",MOVE_MSG_SELECTION:"MOVE_MESSAGE_SELECTION",DELETE_ACCOUNT:"DELETE_ACCOUNT",DELETE_FOLDER:"DELETE_FOLDER",EMPTY_FOLDER:"EMPTY_FOLDER",DELETE_MSG_PUSH:"DELETE_MESSAGE_PUSH",UPDATE_MSG_SINGLE:"UPDATE_MESSAGE_SINGLE",UPDATE_MSG_SELECTION:"UPDATE_MESSAGE_SELECTION",UPDATE_MSG_ALL:"UPDATE_MESSAGE_ALL",RENAME_FOLDER:"RENAME_FOLDER",MOVE_FOLDER:"MOVE_FOLDER",UPDATE_ACCOUNT:"UPDATE_ACCOUNT",UPDATE_SERVER_PREFS:"UPDATE_SERVER_PREFERENCES",CREATE_VIP_SENDER:"CREATE_VIP_SENDER",UPDATE_VIP_SENDER_ADDRESSES:"UPDATE_VIP_SENDER_ADDRESSES",UPDATE_VIP_SENDER_NAME:"UPDATE_VIP_SENDER_NAME",DELETE_VIP_SENDER:"DELETE_VIP_SENDER",BLACKLIST_ACTION_DELETE:"D",BLACKLIST_ACTION_ADD:"A",ALL:1,MSGLIST:2,_counter:1,_cancelled:[],getRequest:function(e){var t=CoreMail.MailRequest.postUrl(e).json();t.set("timeout",CoreMail.INTERVAL_XHR_TIMEOUT);var n;return window.PushService?n=PushService.token():window.WHAT_TYPE.isMailChild()&&(n=opener.PushService.token()),!n&&!CoreMail.TOKEN?(CoreMail.TOKEN=CW.UUID(),n=
CoreMail.TOKEN):n||(n=CoreMail.TOKEN),t},postBody:function(e,t){var n=new Date,r={jsonrpc:"2.0",id:n.getTime()+"/"+this._counter++,method:e};if(t!==undefined){var i=t.get("address")+"-"+e;t.set("reportPath",i),t.set("benchKey",i+"-->"+r.id)}else SC.warn("CoreMail.postBody requires the request param");return r},errorInResponse:function(e){var t=e.get("status"),n={},r=e.get("body");if(t!==200)return 504===t?(n.errorCode=t,n.errorMessage=t):(n.errorCode=CoreMail.ERROR_HTTP,n.errorMessage=t),421===t&&r&&r.reason&&(n.errorData={reason:r.reason}),n;if(!r)return n.errorCode=CoreMail.ERROR_EMPTY_RESPONSE,n;if(!r.jsonrpc&&r.label==="Response"&&r.message)return n.errorCode=CoreMail.ERROR_PARSE_JSON,n.errorMessage=r.message,n;if(r.jsonrpc!=="2.0")return n.errorCode=CoreMail.ERROR_JSONRPC_VERSION,n;var i=e.originalRequest().get("body");if(i.id!==r.id)return n.errorCode=CoreMail.ERROR_REQUEST_ID,n.errorMessage="RequestID mismatch: "+i.id+" <--> "+r.id,n;if(r.error)return n.errorData=r.error.data,n.errorCode=r.error.code,n.errorMessage=r.error.message,n;var s=r.result;if(!s)return n.errorCode=CoreMail.ERROR_EMPTY_RESULT,n;if(CoreMail.DEBUG_ERROR)return n.errorCode=-9999,n},cancelUnfinishedRequests:function(e){var t=SC.Request.manager.get("pending");SC.Request.manager.set("pending",[]),CoreMail.Request.cancelQueue(t,e);var n=SC.Request.manager.get("inflight");CoreMail.Request.cancelQueue(n,e)},cancelQueue:function(e,t){var n=e.length;for(var r=0;r<n;r++){var i=e[r];if(i)if(t===CoreMail.Request.ALL||t===i.originalRequest().get("requestType")){var s=i.get("listeners");s&&CoreMail.Request.cancel
(s[0],i,NO)}}},cancel:function(e,t,n){var r=n?"Request timed out: ":"Request cancelled: ",i;if(!t||!t.originalRequest()||!t.originalRequest().get("body")){SC.warn("Unable to clean up after cancelling request");return}i=t.originalRequest().get("body").id;var s=this._cancelled.length;for(var o=0;o<s;o++)if(this._cancelled[o]===i){SC.debug("Ignoring previously cancelled request: "+i);return}s===10&&this._cancelled.shift(),this._cancelled.push(i),e.forEach(function(e){var s=e.target,o=e.action,u=e.params;e&&s&&o&&u&&u.length===1?(n?t.set("status",504):t.set("status",409),u=u[0],SC.warn(r+u.caller+"."+u.method+"/"+t.originalRequest().get("body").id),o.call(s,t,u)):SC.warn("Unable to clean up after cancelling: "+i)}),SC.Request.manager.cancel(t)}}}),SC.mixin(CoreMail,{isBlacklistVisible:NO,_setMessageListStartTime:null,_resyncFolderListStartTime:null,_resyncMessageListStartTime:null,washClean:function(e,t,n){var r={reason:n?n:"DEFAULT",washClean:YES};e.commitRecord(null,null,t,r)},unrecoverableError:function(e,t){t&&t.setError({errorCode:CoreMail.ERROR_INTERNAL,errorMessage:e}),SC.warn("INTERNAL_ERROR: "+e)},ERROR_INTERNAL:-1e3,ERROR_HTTP:-1,ERROR_EMPTY_RESPONSE:-2,ERROR_JSONRPC_VERSION:-3,ERROR_PARSE_JSON:-4,ERROR_REQUEST_ID:-5,ERROR_FAILED:-6,ERROR_BUSY:-7,ERROR_DENIED:-8,ERROR_EMPTY_RESULT:-9,ERROR_SANITY_IDLE:-10,ERROR_SANITY_TOTAL:-11,ERROR_SANITY_DELETE:-12,ERROR_SANITY_FLAG:-13,ERROR_SLOT_MISSED:-14,ERROR_SLOT_ROLLED:-15,ERROR_SLOT_DUPLICATE:-16,ERROR_PUSH_RETRIEVE:-17,ERROR_PUSH_DESTROY:-18,ERROR_SERVER_PUSH_RESYNC_FOLDERS:-19,ERROR_SERVER_PUSH_RESYNC_MSGLIST:-20,ERROR_FOLDER_NOT_FOUND
:-21,ERROR_MESSAGE_NOT_FOUND:-22,errs:["N/A","ERROR_HTTP","ERROR_EMPTY_RESPONSE","ERROR_JSONRPC_VERSION","ERROR_PARSE_JSON","ERROR_REQUEST_ID","ERROR_FAILED","ERROR_BUSY","ERROR_DENIED","ERROR_EMPTY_RESULT","ERROR_SANITY_IDLE","ERROR_SANITY_TOTAL","ERROR_SANITY_DELETE","ERROR_SANITY_FLAG","ERROR_SLOT_MISSED","ERROR_SLOT_ROLLED","ERROR_SLOT_DUPLICATE","ERROR_PUSH_RETRIEVE","ERROR_PUSH_DESTROY","ERROR_SERVER_PUSH_RESYNC_FOLDERS","ERROR_SERVER_PUSH_RESYNC_MSGLIST","ERROR_FOLDER_NOT_FOUND","ERROR_MESSAGE_NOT_FOUND"],errorString:function(e){return e===-1e3?"ERROR_INTERNAL":(e*=-1,this.errs[e])},RequestStatus:SC.Object.extend({STATE:"state",ERROR_CODE:"errorCode",ERROR_MESSAGE:"errorMessage",ERROR_DATA:"errorData",STATE_PENDING:1,STATE_SUCCESS:2,STATE_ERROR:3,getStateString:function(){var e=this.get(this.STATE);return this.STATE_PENDING===e?"STATE_PENDING":this.STATE_SUCCESS===e?"STATE_SUCCESS":"STATE_ERROR"},setPending:function(){this.set(this.STATE,this.STATE_PENDING)},setSuccess:function(){this.set(this.STATE,this.STATE_SUCCESS)},setError:function(e){this.set(this.ERROR_CODE,e.errorCode),this.set(this.ERROR_MESSAGE,e.errorMessage),this.set(this.ERROR_DATA,e.errorData),this.get(this.STATE)===this.STATE_ERROR&&this.set(this.STATE,null),this.set(this.STATE,this.STATE_ERROR)}}),createPendingStatus:function(){var e=CoreMail.RequestStatus.create();return e.setPending(),e},sharedResponse:function(e,t){var n=t.method,r=t.caller+"."+n+" ",i=t.params;i||(i={});var s=r+e.originalRequest().get("body").id,o,u;if(n==="localFetchResponse")o=this.localFetchResponseError,u=this.localFetchResponseSuccess
;else if(n==="fetchResponse")o=this.fetchResponseError,u=this.fetchResponseSuccess;else if(n==="retrieveResponse")o=this.retrieveResponseError,u=this.retrieveResponseSuccess;else if(n==="createResponse")o=this.createResponseError,u=this.createResponseSuccess;else if(n==="updateResponse")o=this.updateResponseError,u=this.updateResponseSuccess;else if(n==="destroyResponse")o=this.destroyResponseError,u=this.destroyResponseSuccess;else if(n==="snippetResponse")o=this.snippetResponseError,u=this.snippetResponseSuccess;else if(n==="imageOrientationResponse")o=this.imageOrientationResponseError,u=this.imageOrientationResponseSuccess;else if(n==="sendResponse")o=this.sendResponseError,u=this.sendResponseSuccess;else if(n==="draftResponse")o=this.draftResponseError,u=this.draftResponseSuccess;else if(n==="pushAddResponse")o=this.pushAddResponseError,u=this.pushAddResponseSuccess;else if(n==="getBadges")o=this.getBadgesError,u=this.getBadgesSuccess;else if(n==="getVipBadges")o=this.getVipBadgesError,u=this.getVipBadgesSuccess;else if(n==="pushVipFlagResponse")o=this.pushVipFlagResponseError,u=this.pushVipFlagResponseSuccess;else if(n==="deleteSingleMessageResponse")o=this.deleteSingleMessageResponseError,u=this.deleteSingleMessageResponseSuccess;else if(n==="releaseServerCacheResponse")o=this.releaseServerCacheResponseError,u=this.releaseServerCacheResponseSuccess;else if(n==="fetchMailDropAuthTokens")o=this.fetchMailDropAuthTokensResponseError,u=this.fetchMailDropAuthTokensResponseSuccess;else if(n==="fetchFileDownloadUrl")o=this.fetchFileDownloadUrlResponseError,u=this.fetchFileDownloadUrlResponseSuccess
;else if(n==="sendMailDropRepublishRequest")o=this.mailDropRepublishResponseError,u=this.mailDropRepublishResponseSuccess;else if(n==="moveAttachmentToMailDrop")o=this.moveAttachmentToMailDropResponseError,u=this.moveAttachmentToMailDropResponseSuccess;else if(n==="relatedMessageResponse")o=this.relatedMessageResponseError,u=this.relatedMessageResponseSuccess;else{if(n!=="listUnsubscribeResponse")return CoreMail.unrecoverableError("Unexpected method name: "+n,i.requestStatus);o=this.listUnsubscribeResponseError,u=this.listUnsubscribeResponseSuccess}var a=t.store,f=t.storeKeys,l=t.skArray;i.storeKeys=f,i.storeKeyArray=l,r.indexOf("MessageListDataSource.fetchResponse")>=0&&(i.origRequest=e.originalRequest()),SC.Benchmark.start(s);var c,h=e.get("body"),p=CoreMail.Request.errorInResponse(e);if(p){var d;h&&(d=h.push),c=CoreMail.handleMissingPushes(d);if(c.status===CoreMail.PUSH_PENDING)return SC.Benchmark.end(s),CoreMail.unrecoverableError("Unexpected PUSH_PENDING status",i.requestStatus);o.call(this,r,a,i,p);if(CoreMail.pushError(c.status)){c.resync===CoreMail.RESYNC_FOLDERS?CoreMail.resyncFolderList(c.status,c.message):CoreMail.resyncMessageList(c.folderGuid,c.status,c.message),SC.Benchmark.end(s);return}}else{c=CoreMail.handleMissingPushes(h.push);if(c.status===CoreMail.PUSH_PENDING)return SC.Benchmark.end(s),CoreMail.unrecoverableError("Unexpected PUSH_PENDING status",i.requestStatus);if(CoreMail.pushError(c.status)){o.call(this,r,a,i,{errorCode:c.status}),c.resync===CoreMail.RESYNC_FOLDERS?CoreMail.resyncFolderList(c.status,c.message):CoreMail.resyncMessageList(c.folderGuid,
c.status,c.message),SC.Benchmark.end(s);return}u.call(this,r,a,i,h)}SC.Benchmark.end(s)},SLOT_OK:0,SLOT_DUPLICATE:1,SLOT_ROLLED:2,SLOT_MISSED:3,PUSH_FINISHED:1,PUSH_PENDING:0,pushMessageListInProgress:NO,logPush:function(e,t){SC.debug(e+", "+t.newslotnumber+"/"+t.operation)},_pushString:function(e){var t="Push Hash:";return t=this._pushProp(t,e,"newslotnumber"),t=this._pushProp(t,e,"inboxUnread"),t=this._pushProp(t,e,"operation"),t=this._pushProp(t,e,"folderGuid"),t=this._pushProp(t,e,"msgUid"),t=this._pushProp(t,e,"index"),t=this._pushProp(t,e,"totalMessages"),t=this._pushProp(t,e,"origFolderGuid"),t=this._pushProp(t,e,"name"),t=this._pushProp(t,e,"parentGuid"),t=this._pushProp(t,e,"role"),t},_pushProp:function(e,t,n){return t[n]!==null&&t[n]!==undefined?e+"\n	"+n+": "+t[n]:e},push:function(e,t){if(!e||!e.operation||e.operation.length===0)return SC.debug("No pushData/operation"),CoreMail.PUSH_FINISHED;SC.debug(this._pushString(e));if(e.inboxUnread!==null&&e.inboxUnread!==undefined){var n=e.folderGuid?e.folderGuid:CoreMail.INBOX_GUID;CoreMail.updateFolderCount(n,CoreMail.MESSAGE_FLAG_UNREAD,CoreMail.SET,e.inboxUnread),CoreMail.DRAFTS_GUID===e.folderGuid&&CoreMail.updateFolderCount(n,"total",CoreMail.SET,e.totalMessages)}var r=CoreMail.PUSH_FINISHED,i=CoreMail.RESYNC_MSGLIST,s,o,u=CoreMail.slotCheck(e.newslotnumber);if(u===CoreMail.SLOT_DUPLICATE)this.logPush("Ignoring duplicate push request",e);else if(u===CoreMail.SLOT_MISSED)r=CoreMail.ERROR_SLOT_MISSED,i=CoreMail.RESYNC_FOLDERS;else if(u===CoreMail.SLOT_ROLLED&&!t)r=CoreMail.ERROR_SLOT_ROLLED,i=CoreMail.RESYNC_FOLDERS;else{
var a=e.operation.charAt(0);a!=="X"&&!e.folderGuid&&(e.folderGuid=CoreMail.INBOX_GUID);if(a==="A")this.set("pushMessageListInProgress",YES),r=CoreMail.messageListDataSource.pushStart(e,t),this.set("pushMessageListInProgress",NO);else if(a==="B"){if(CoreMail.folderSelected(e.folderGuid)){var f=CoreMail.findLocalFolder(e.folderGuid);f&&f.get("unread")===e.inboxUnread&&f.get("total")===e.totalMessages?r=CoreMail.PUSH_FINISHED:(r=CoreMail.ERROR_SANITY_IDLE,i=CoreMail.RESYNC_MSGLIST,o=e.folderGuid)}else CoreMail.updateFolderCount(e.folderGuid,CoreMail.MESSAGE_FLAG_UNREAD,CoreMail.SET,e.unread),CoreMail.DRAFTS_GUID===e.folderGuid&&CoreMail.updateFolderCount(e.guid,"total",CoreMail.SET,e.total);e.folderGuid===CoreMail.INBOX_GUID&&FolderList.hasVipFolders()===YES&&CoreMail.folderDataSource.getVipBadges(CoreMail.store)}else if(a==="C"){var l={guid:e.folderGuid,role:e.role,parent:e.parentGuid};CoreMail.store.pushRetrieve(CoreMail.Folder,e.folderGuid,l)?this.logPush("pushRetrieve succeeded",e):(this.logPush("pushRetrieve failed",e),r=CoreMail.ERROR_PUSH_RETRIEVE,i=CoreMail.RESYNC_FOLDERS,o=e.folderGuid)}else if(a==="D")if(e.msgUid&&e.index)r=CoreMail.messageListDataSource.pushStart(e,t),s=CoreMail.INBOX_GUID,e.folderGuid&&(s=e.folderGuid);else{var c=CoreMail.INBOX_GUID;e.folderGuid&&(c=e.folderGuid),CoreMail.store.pushDestroy(CoreMail.Folder,c)?this.logPush("pushDestroy succeeded",e):(this.logPush("pushDestroy failed",e),r=CoreMail.ERROR_PUSH_DESTROY,i=CoreMail.RESYNC_FOLDERS,o=c)}else if(a==="E")if(!CoreMail.store.pushDestroy(CoreMail.Folder,e.origFolderGuid))this.logPush("pushDestroy failed"
,e),r=CoreMail.ERROR_PUSH_DESTROY,i=CoreMail.RESYNC_FOLDERS,o=e.origFolderGuid;else{this.logPush("pushDestroy succeeded",e);var h={guid:e.folderGuid,role:e.role,parent:e.parentGuid};CoreMail.store.pushRetrieve(CoreMail.Folder,e.folderGuid,h)?this.logPush("pushRetrieve succeeded",e):(this.logPush("pushRetrieve failed",e),r=CoreMail.ERROR_PUSH_RETRIEVE,i=CoreMail.RESYNC_FOLDERS,o=e.folderGuid)}else a==="F"||a==="f"||a==="G"||a==="g"||a==="H"||a==="h"||a==="J"||a==="j"||a==="R"||a==="r"?r=CoreMail.messageListDataSource.pushStart(e,t):a==="P"?(CoreMail.poll(),r=CoreMail.PUSH_PENDING):a==="X"?e.folderGuid?(r=CoreMail.ERROR_SERVER_PUSH_RESYNC_MSGLIST,i=CoreMail.RESYNC_MSGLIST,s=e.folderGuid):(r=CoreMail.ERROR_SERVER_PUSH_RESYNC_FOLDERS,i=CoreMail.RESYNC_FOLDERS):SC.debug("Unsupported push operation: "+e.operation)}SC.RunLoop.begin(),SC.RunLoop.end();if(CoreMail.pushError(r)&&!t)if(i===CoreMail.RESYNC_FOLDERS)CoreMail.resyncFolderList(r,o);else{if(s===CoreMail.INBOX_GUID&&FolderList.hasVipFolders()===YES){CoreMail.folderDataSource.getVipBadges(CoreMail.store);var p=FolderList.getPath("foldersTreeController.selection");if(p){var d=p.get("firstObject");d.get("role")===CoreMail.FOLDER_ROLE_VIP&&(s=d.get("guid"))}}CoreMail.resyncMessageList(s,r,o)}else r!==CoreMail.PUSH_PENDING&&this.slotMove(e.newslotnumber,"Push:"+e.operation);return{status:r,resync:i,folderGuid:s,message:o}},handleMissingPushes:function(e){var t={status:CoreMail.PUSH_FINISHED};if(e){var n=e.length;for(var r=0;r<n;r++){t=CoreMail.push(e[r],YES);if(t.status!==CoreMail.PUSH_FINISHED)break}}return t},slotCheck:function(
e,t){if(e===undefined||e===null)return SC.debug("Ignoring check on undefined slot number"),CoreMail.SLOT_OK;if(!(e instanceof String)||e.indexOf(".")<0)return CoreMail.SLOT_OK;e===0&&(e="0.0");if(t&&t.query){var n=t.query.get("parameters");if(n&&n.requesttype==="index"&&n.selected===1)return SC.debug("ignoring slot check - switching or reloading folder"),CoreMail.SLOT_OK}var r=CoreMail.SLOT.split(".");r[0]=parseInt(r[0],10),r[1]=parseInt(r[1],10);var i=e.split(".");return i[0]=parseInt(i[0],10),i[1]=parseInt(i[1],10),r[0]===-1||i[0]-r[0]===1&&i[1]>r[1]?(SC.debug("slot check OK (current: "+CoreMail.SLOT+", new: "+e+")"),CoreMail.SLOT_OK):i[0]<=r[0]&&i[1]<=r[1]?(SC.debug("duplicate slot number (current: "+CoreMail.SLOT+", new: "+e+")"),CoreMail.SLOT_DUPLICATE):i[0]<r[0]&&i[1]>r[1]?(SC.debug("slot number rolled (current: "+CoreMail.SLOT+", new: "+e+")"),SC.debug("ignoring slot check while testing: "+e),CoreMail.SLOT_OK):(SC.debug("slot number missed (current: "+CoreMail.SLOT+", new: "+e+")"),SC.debug("ignoring slot check while testing: "+e),CoreMail.SLOT_OK)},slotMove:function(e){if(e===null||e===undefined){SC.debug("retaining current slot number: "+CoreMail.SLOT);return}e===0&&(e="0.0");if(e===CoreMail.SLOT)return;CoreMail.SLOT=e},pushError:function(e){return e<0?YES:NO},poll:function(){var e=this.createPendingStatus();return this.invokeLater(this._poll,1,e),e},_poll:function(){CoreMail.resyncFolderList("poll")},_pollResponse:function(e,t){var n=t.requestStatus,r=CoreMail.Request.errorInResponse(e);if(r){n.setError(r),CoreMail.resyncFolderList(r.errorCode+"/"+r.errorMessage);return}
var i=e.get("body"),s=CoreMail.handleMissingPushes(i.push);if(s.status!==CoreMail.PUSH_FINISHED){n.setError({errorCode:s.status}),CoreMail.resyncFolderList(s.status);return}n.setSuccess()},getMessageDetail:function(e){var t=this.createPendingStatus(),n=CoreMail.store.find(CoreMail.MessageDetail,e);if(!n)return t.setError({errorCode:CoreMail.ERROR_FAILED}),t;t.set("requestData",{record:n});if(n.get("status")===SC.Record.READY_CLEAN){t.setSuccess(),CoreMail.setSnippet(n);var r=n.get("message");r.get("unread")===YES?r.serverClearUnread=YES:r.serverClearUnread=undefined}else n.addObserver("status",this,function(e){e.removeObserver("status",this,arguments.callee),e.get("status")!==SC.Record.READY_CLEAN?t.setError({errorCode:CoreMail.ERROR_FAILED}):(t.setSuccess(),CoreMail.setSnippet(e))});return t},REGEX:YES,TMP_DIV:document.createElement("div"),setSnippet:function(e){var t=e.get("message"),n=t.get("mimeParts");if(t.get("preview")||!n||n.get("length")===0)return;var r=e.get("body");if(!r)return},definedMessageIndexes:function(e,t){var n,r;if(!e||!t||!(n=e.firstObject())||!(r=n.get("folder")))return SC.warn("CoreMail.definedMessageIndexes invalid input"),null;var i=r.get("guid"),s=CoreMail.messageListDataSource.storeKeyArray(i);if(!s){var o="CoreMail.definedMessageIndexes: Store Key Array is null - guid : %@".fmt(i);return CoreMail.errorHandler.logErrorTrap(o),null}var u=e.indexSetForSource(t),a=s.definedIndexes(u);return a.set("source",t),a},loadMessageList:function(e,t,n,r,i){var s=this.createPendingStatus();e||(SC.warn("CoreMail.loadMessageList: undefined folderGuid, defaulting to inbox"
),e=CoreMail.INBOX_GUID),i||SC.warn("CoreMail.loadMessageList: undefined filterCriteria"),t=null;if(n===undefined||n!==null&&n.length===0)n=null;if(r===undefined||r!==null&&r.length===0)r=null;var o=CoreMail.store.find(CoreMail.ImplicitPreferences,CoreMail.IMPLICIT_PREFS_GUID),u=this._getLoadType(n,r,t),a={_internalUse:{requestStatus:s,loadType:u},guid:e,sorttype:o.get("messageSortBy"),sortorder:o.get("messageSortAscending")?"ascending":"descending",searchtype:n,searchtext:r};i&&i.get("enabled")&&(a.filters={unread:i.get("unread"),flagged:i.get("flagged"),toMe:i.get("toMe"),ccMe:i.get("ccMe"),withAttachments:i.get("withAttachments"),fromVip:i.get("fromVip")}),t===null?(a.requesttype="index",a.selected=0,a.count=CoreMail.Request.MESSAGE_LIST_BATCH_SIZE):(a.requesttype="guid",a.selected=t,a.count=CoreMail.Request.MESSAGE_LIST_BATCH_SIZE),CoreMail.errorHandler.recordStat("_load_message_list",{filterCriteria:i?i.get("digest"):""});var f=SC.Query.remote(CoreMail.Message,null,a);return s.set("requestData",{messageArray:CoreMail.store.find(f)}),s},setMessageList:function(e,t){if(!e)return;var n=CoreMail.findLocalFolder(e),r=new Date,i=r.getTime(),s=0;this._setMessageListStartTime?s=i-this._setMessageListStartTime:this._setMessageListStartTime=i;if(!n&&s<CoreMail.INTERVAL_SET_MESSAGE_LIST){SC.warn("Waiting to set message list on folder: "+e+" ..."),this.invokeLater(this.setMessageList,100,e,t);return}if(n)Message.messageListController.set("content",t);else{var o="CoreMail.setMessageList: The folder record "+e+" is unavailable even after "+s+" ms."+" Giving up set message list.";CoreMail
.errorHandler.logErrorTrap(o)}this._setMessageListStartTime=null;return},canResyncMessageList:YES,isResyncMessageListInProgress:NO,isResyncMessageListDelayed:NO,resyncMessageList:function(e,t,n,r){if(!r&&YES===this.get("isResyncMessageListDelayed"))return;var i=FolderList.getPath("foldersTreeController.selection.firstObject.guid"),s=new Date,o=s.getTime(),u=0;this._resyncMessageListStartTime===null?this._resyncMessageListStartTime=o:u=o-this._resyncMessageListStartTime;if(NO===this.get("canResyncMessageList")||!i||this.get("isResyncFolderListInProgress")){u<this.INTERVAL_RESYNC_MESSAGE_LIST?(SC.debug("CoreMail.resyncMessageList delayed"),this.set("isResyncMessageListDelayed",YES),this.invokeLater("resyncMessageList",CoreMail.INTERVAL_RESYNC,e,t,n,YES)):(SC.warn("Trying to resync message list from "+u+" ms. "+"Giving up."),this.set("isResyncMessageListDelayed",NO),this._resyncMessageListStartTime=null);return}this.set("isResyncMessageListDelayed",NO),this._resyncMessageListStartTime=null;if(i){if(e&&i!==e)return;t<0&&(t=this.errorString(t),n&&(t=t+"/"+n)),SC.debug("RESYNC message list for folder: "+i+" ("+t+")");var a=Global.shouldShowVipWelcomePage();if(a!==NO)return SC.debug("Ignoring push because current selected Folder is  "+i+" shows VIP Welcome message"),CoreMail.PUSH_FINISHED;this.set("isResyncMessageListInProgress",YES),CoreMail.SLOT="-1.-1"}},deleteChildMessage:function(e){var t;if(window.WHAT_TYPE.isMailChild()===NO)return t=this.createPendingStatus(),CoreMail.unrecoverableError("CoreMail.deleteChildMessage called from main window",t),t;var n=opener.CoreMail.store.find
(opener.CoreMail.Message,e);return!n||(n.get("status")&SC.Record.DESTROYED)>0?(t=this.createPendingStatus(),t.setError({errorCode:CoreMail.ERROR_MESSAGE_NOT_FOUND,errorMessage:"Message not found"}),t):opener.CoreMail.deleteMessage(n)},deleteMessage:function(e,t){if(window.WHAT_TYPE.isMailChild())return this.deleteChildMessage(e.get("guid"));var n=this.createPendingStatus();return this._deleteMoveMessages(CoreMail.Request.DELETE_MSG_SINGLE,e,t,null,n),n},moveChildMessage:function(e,t){var n;if(window.WHAT_TYPE.isMailChild()===NO)return n=this.createPendingStatus(),CoreMail.unrecoverableError("CoreMail.moveChildMessage called from main window",n),n;var r=opener.CoreMail.store.find(opener.CoreMail.Message,e);return!r||(r.get("status")&SC.Record.DESTROYED)>0?(n=this.createPendingStatus(),n.setError({errorCode:CoreMail.ERROR_MESSAGE_NOT_FOUND,errorMessage:"Message not found"}),n):opener.CoreMail.moveMessage(r,null,t)},moveMessage:function(e,t,n){if(window.WHAT_TYPE.isMailChild())return this.moveChildMessage(e.get("guid"),n);n===CoreMail.ARCHIVE_GUID&&CoreMail.incrementUserStat(CoreMail.STAT_ARCHIVE);var r=this.createPendingStatus();return this._deleteMoveMessages(CoreMail.Request.MOVE_MSG_SINGLE,e,t,n,r),r},_deleteMoveMessages:function(e,t,n,r,i){t.get("length")===1&&(t=t.firstObject());if(t instanceof SC.Record)return this._deleteMoveSingle(e,t,r,i);e===CoreMail.Request.DELETE_MSG_SINGLE?e=CoreMail.Request.DELETE_MSG_SELECTION:e=CoreMail.Request.MOVE_MSG_SELECTION;var s=this._definedIndexes(t,n),o=[],u=0,a;if(!s){var f="CoreMail._deleteMoveMessages : result is undefined";CoreMail
.errorHandler.logErrorTrap(f);return}a=s.definedIndexes,a.forEachObject(function(e,t,n){o.push(n.objectAt(t));var r=CoreMail.store.materializeRecord(n.objectAt(t));CoreMail.DELETED_GUIDS.push(r.get("guid")),r.get("unread")&&u++},this),CoreMail.store.destroyRecords(null,null,o);var l=t.getPath("firstObject.folder.guid"),c=CoreMail.messageListDataSource.storeKeyArray(l),h;c&&((c.loadType&CoreMail.Request.SEARCH)>0?h=a:h=s.selectedIndexSet),t&&l?CoreMail.store.commitRecords(null,null,o,{deleteType:e,folderGuid:l,destFolderGuid:r,selectedIndexSet:h,unreadDiff:u,requestStatus:i}):t?CoreMail.errorHandler.logErrorTrap("CoreMail._deleteMoveMessages: selection issues:"+t.toArray().toString()):CoreMail.errorHandler.logErrorTrap("CoreMail._deleteMoveMessages, selection is "+t)},_deleteMoveSingle:function(e,t,n,r){var i=t.get("guid"),s=0;t.get("unread")===YES&&(s=1),CoreMail.DELETED_GUIDS.push(i),CoreMail.store.destroyRecord(CoreMail.Message,i);var o=t.get("folder"),u;window.WHAT_TYPE.isMailChild()===NO&&window.WHAT_TYPE.isMail()===NO&&!o?u=CoreMail.DRAFTS_GUID:o&&(u=o.get("guid")),CoreMail.store.commitRecord(CoreMail.Message,i,undefined,{deleteType:e,messageGuid:i,folderGuid:u,destFolderGuid:n,unreadDiff:s,selectedIndexSet:t,requestStatus:r})},archiveChildMessage:function(e){var t;if(window.WHAT_TYPE.isMailChild()===NO)return t=this.createPendingStatus(),CoreMail.unrecoverableError("CoreMail.moveChildMessage called from main window",t),t;var n=opener.CoreMail.store.find(opener.CoreMail.Message,e);return!n||(n.get("status")&SC.Record.DESTROYED)>0?(t=this.createPendingStatus(),t.setError
({errorCode:CoreMail.ERROR_MESSAGE_NOT_FOUND,errorMessage:"Message not found"}),t):opener.CoreMail.archiveMessage(n)},archiveMessage:function(e,t){if(window.WHAT_TYPE.isMailChild())return this.archiveChildMessage(e.get("guid"));var n=CoreMail.findLocalFolder(CoreMail.ARCHIVE_GUID);if(n&&n.get("status")===SC.Record.READY_CLEAN)return CoreMail.moveMessage(e,t,CoreMail.ARCHIVE_GUID);var r=this.createPendingStatus();return r.setError({errorCode:CoreMail.ERROR_FOLDER_NOT_FOUND,errorMessage:"Folder not found"}),r},saveDeletedUids:function(e){if(e==="success")return;CoreMail.DELETED_UIDS.length===5&&CoreMail.DELETED_UIDS.shift(),CoreMail.DELETED_UIDS.push(e)},updateUnreadFlag:function(e,t,n){var r=this.createPendingStatus(),i=this._definedIndexes(t,n);if(!i)return r.setError({errorCode:this.ERROR_BUSY}),r;var s,o=0,u,a=[],f={};i.definedIndexes.forEachObject(function(t,n,r){u=r.objectAt(n);var i=CoreMail.store.materializeRecord(u);s||(s=i.get("folder")),e===YES&&i.get("unread")===NO?(a.push(u),f[u]=NO,i.set("unread",YES),o++,CoreMail.washClean(CoreMail.store,u)):e===NO&&i.get("unread")===YES&&(a.push(u),f[u]=YES,i.set("unread",NO),o++,CoreMail.washClean(CoreMail.store,u))},this);if(s){var l;e===YES?l=CoreMail.INCREMENT:l=CoreMail.DECREMENT,CoreMail.updateFolderCount(s.get("guid"),CoreMail.MESSAGE_FLAG_UNREAD,l,o),f.unreadDiff=o,CoreMail.messageListDataSource.updateVipUnreadCounts(CoreMail.store,s.get("guid"),a,l,f,NO)}else CoreMail.errorHandler.logErrorTrap("CoreMail.updateUnreadFlag detected undefined folder");return r.setSuccess(),r},setChildMessageFlag:function(e,t){if(window.WHAT_TYPE
.isMailChild()===NO){var n=this.createPendingStatus();return CoreMail.unrecoverableError("CoreMail.setChildMessageFlag called from main window",n),n}var r=Message.messageController.get("content"),i=opener.CoreMail.store.find(opener.CoreMail.Message,r.get("guid"));return opener.CoreMail.setMessageFlag(e,t,i)},setMessageFlag:function(e,t,n,r){if(window.WHAT_TYPE.isMailChild())return this.setChildMessageFlag(e,t);var i=this.createPendingStatus();return this._setMessageFlag(e,t,n,r,i),i},_setMessageFlag:function(e,t,n,r,i){if(n instanceof SC.Record)return this._setSingleFlag(e,t,n,i);var s=this._definedIndexes(n,r);if(!s){i.setError({errorCode:this.ERROR_BUSY});return}var o=[],u={unreadDiff:0},a=s.definedIndexes;a.forEachObject(function(n,r,i){var s=i.objectAt(r),a=CoreMail.store.materializeRecord(s);u[s]=a.get(e);if(e===CoreMail.MESSAGE_FLAG_UNREAD&&a.get("unread")!==t)u.unreadDiff++;else if(e===CoreMail.MESSAGE_FLAG_JUNK){var f=a.getPath("folder.role");if(t===YES&&f!==CoreMail.FOLDER_ROLE_JUNK||t===NO&&f===CoreMail.FOLDER_ROLE_JUNK)a.get("unread")&&u.unreadDiff++,CoreMail.DELETED_GUIDS.push(a.get("guid"))}a.set(e,!t),a.set(e,t),o.push(s)},this);var f=n.getPath("firstObject.folder.guid"),l=CoreMail.messageListDataSource.storeKeyArray(f),c;l&&((l.loadType&CoreMail.Request.SEARCH)>0?c=a:c=s.selectedIndexSet),CoreMail.store.commitRecords(null,null,o,{updateType:CoreMail.Request.UPDATE_MSG_SELECTION,propertyName:e,newValue:t,origValues:u,selectedIndexSet:c,requestStatus:i})},_setSingleFlag:function(e,t,n,r){if(n.get("status")!==SC.Record.READY_CLEAN){r.setError({errorCode:this.ERROR_BUSY
});return}var i={unreadDiff:0},s=n.get("storeKey");i[s]=n.get(e),(CoreMail.MESSAGE_FLAG_JUNK===e||NO===t)&&n.set(e,!t),n.set(e,t);if(e===CoreMail.MESSAGE_FLAG_UNREAD)i.unreadDiff=1;else if(e===CoreMail.MESSAGE_FLAG_JUNK){var o=n.getPath("folder.role");if(t===YES&&o!==CoreMail.FOLDER_ROLE_JUNK||t===NO&&o===CoreMail.FOLDER_ROLE_JUNK)n.get("unread")&&(i.unreadDiff=1),CoreMail.DELETED_GUIDS.push(n.get("guid"))}CoreMail.store.commitRecord(CoreMail.Message,n.get("guid"),undefined,{updateType:CoreMail.Request.UPDATE_MSG_SINGLE,messageGuid:n.get("guid"),propertyName:e,newValue:t,origValues:i,requestStatus:r})},setAllFlags:function(e,t,n){var r=this.createPendingStatus();return this.invokeLater(this._setAllFlags,1,e,t,n,r),r},_setAllFlags:function(e,t,n,r){var i=this._folderLocalMessages(n);if(i===NO){r.setError({errorCode:this.ERROR_BUSY});return}var s,o;if(i&&(s=i.get("length"))>0){var u=[],a={};for(var f=0;f<s;f++){var l=i.objectAt(f),c=l.get("storeKey");u.push(c),a[c]=l.get(e),l.set(e,t)}o={updateType:CoreMail.Request.UPDATE_MSG_ALL,propertyName:e,newValue:t,origValues:a,requestStatus:r},u?CoreMail.store.commitRecords(null,null,u,o):(o.folderGuid=n.get("guid"),CoreMail.messageListDataSource.updateRecords(CoreMail.store,null,o))}},_manyArrayToGuidArray:function(e){var t=[],n=[];if(e){var r=e.get("length");for(var i=0;i<r;i++){var s=e.objectAt(i);if(s){var o=s.get("guid");n.push(o),t.push(s.toHash())}}}return n.length===0?null:{guidArray:n,hashArray:t}},hashChildWindowRecords:function(e,t){var n=e;n||(n=CoreMail.COMPOSE_GUID);var r;CoreMail.CHILD_WINDOW_HASHES?r=CoreMail.CHILD_WINDOW_HASHES
[n]:CoreMail.CHILD_WINDOW_HASHES={},r||(r={count:0},CoreMail.CHILD_WINDOW_HASHES[n]=r),r.count++;var i=CoreMail.getServerPreferences();r.serverPrefs=i.toHash();var s=CoreMail.store.find(CoreMail.IdentityAccount,CoreMail.IDENTITY_ACCOUNT_GUID);s&&s.get("status")!==SC.Record.ERROR&&(r.identityAccount=s.toHash());var o=CoreMail.store.find(CoreMail.AliasAccount),u=[];for(var a=0,f=o.get("length");a<f;a++)u.push(o.objectAt(a).toHash());r.aliases=u;var l=CoreMail.getVipSenders(),c=[];for(a=0,f=l.get("length");a<f;a++)c.push(l.objectAt(a).toHash());r.vipSenders=c;if(e){var h=CoreMail.store.find(CoreMail.Message,e);if(h){var p=h.get("status");if(p===SC.Record.READY_CLEAN){var d=h.get("folder"),v=d.get("status");r.folder=d.toHash();if(v===SC.Record.READY_CLEAN){var m=h.toHash();m.mimePartHashes&&(r.mimeParts=m.mimePartHashes),r.message=m.messageHash;var g=SC.Query.local(CoreMail.MessageDetail,"guid = {messageGuid}",{messageGuid:e}),y=CoreMail.store.find(g);if(y&&y.get("length")===1){var b=y.objectAt(0),w=b.toHash();w.toHashes&&(r.to=w.toHashes),w.ccHashes&&(r.cc=w.ccHashes),w.bccHashes&&(r.bcc=w.bccHashes),w.replyToHashes&&(r.replyTo=w.replyToHashes),b.get("from")&&(r.from=b.get("from").toHash()),r.messageDetail=w.detailHash,r.messageDetailCustomProperties=w.customProperties}}else SC.warn("CoreMail.hashChildWindowRecords: folder record status is "+v)}else SC.warn("CoreMail.hashChildWindowRecords: Message (guid = "+e+") status is "+p)}else SC.warn("CoreMail.hashChildWindowRecords: No message record found for guid "+e);r.isRelatedMessage=t}},addServiceUrlDsidAndClientIdToUrl:function(e
){var t=window.CloudOS&&!CloudOS.isCloudOSClient,n=t&&CloudOS.getUser?CloudOS.getUser():COS.authController.get("user"),r=n?n.get("dsid"):null,i=t&&CloudOS.getClientId?CloudOS.getClientId():COS.CLIENT_ID;e.toLowerCase().indexOf("http")!==0&&(e=CloudOS.getUrlForServiceName("mail")+e);var s=URI(e);try{r&&s.addQuery("dsid",r),i&&s.addQuery("clientId",i),e=s.toString()}catch(o){SC.error(o+": malformed_url = "+e+"; dsid = "+r+"; clientId = "+i),r&&e.indexOf(r)<0&&(e+="&dsid="+r),i&&e.indexOf(i)<0&&(e+="&clientId="+i)}return e},folderSelected:function(e){var t=FolderList.get("foldersTreeController").get("selection");if(!t)return NO;var n=t.firstObject().get("guid");return!e&&n!==CoreMail.INBOX_GUID||e!==n?NO:YES},findLocalFolder:function(e){var t=CoreMail.store,n=CoreMail.Folder,r=SC.Query.local(n,"guid = {fguid}",{fguid:e}),i=t.find(r);return!i||i.get("length")!==1?(SC.debug("findLocalFolder could not find folder: "+e),null):i.objectAt(0)},SET:"set",INCREMENT:"increment",DECREMENT:"decrement",updateFolderCount:function(e,t,n,r){if(r===undefined||r===null)return;if((n===CoreMail.INCREMENT||n===CoreMail.DECREMENT)&&r===0)return;var i=CoreMail.findLocalFolder(e);if(i===null)return;n===CoreMail.INCREMENT?r=i.get(t)+r:n===CoreMail.DECREMENT&&(r=i.get(t)-r);if(r<0){SC.warn("CoreMail.updateFolderCount calculated invalid new "+t+" count: "+r);return}if(i.get(t)===r)return;i.set(t,r);var s=CoreMail.store;CoreMail.washClean(s,i.get("storeKey")),e===CoreMail.INBOX_GUID&&t==="unread"&&CloudOS.setBadgeCount&&(CloudOS.setBadgeCount(r),SC.debug("set unread badge count: "+r))},canResyncFolderList
:YES,isResyncFolderListInProgress:NO,isResyncFolderListDelayed:NO,resyncFolderList:function(e,t,n){if(!n&&YES===this.get("isResyncFolderListDelayed"))return;var r=new Date,i=r.getTime(),s=0;this._resyncFolderListStartTime===null?this._resyncFolderListStartTime=i:s=i-this._resyncFolderListStartTime;if(NO===this.get("canResyncFolderList")&&s<CoreMail.INTERVAL_RESYNC_FOLDER_LIST){SC.debug("CoreMail.resyncFolderList delayed"),this.set("isResyncFolderListDelayed",YES),this.invokeLater("resyncFolderList",CoreMail.INTERVAL_RESYNC,e,t,YES);return}YES===this.get("canResyncFolderList")?this._resyncFolderList(e,t):(SC.warn("Trying to resync folder list from "+s+" ms. "+"Giving up."),FolderList.dispatch({sig:"resyncDone"})),this.set("isResyncFolderListDelayed",NO),this._resyncFolderListStartTime=null},_resyncFolderList:function(e,t){this.setIfChanged("isResyncFolderListInProgress",YES),e<0&&(e=this.errorString(e),t&&(e=e+"/"+t)),SC.debug("RESYNC folder list ("+e+")"),CoreMail.getFolders(YES),this.resyncMessageList(null,e,t)},getFolders:function(e){var t;return e?(t=SC.Query.local(CoreMail.Folder,{resync:YES}),this.setIfChanged("isResyncFolderListInProgress",YES)):t=SC.Query.local(CoreMail.Folder),CoreMail.store.find(t)},createFolder:function(e){var t=CoreMail.store.createRecord(CoreMail.Folder,e);if(CoreMail.FOLDER_PERF&&e.parent){var n=CoreMail.findLocalFolder(e.parent);t.get("guid")||t.set("guid",e.parent+"/"+e.name),n.get("kids").pushObject(t)}return t},commitFolder:function(e){var t=this.createPendingStatus();return this.invokeLater(this._commitFolder,1,e,t),t},_commitFolder:function(
e,t){CoreMail.store.commitRecord(null,null,e.get("storeKey"),{createType:CoreMail.Request.CREATE_FOLDER,requestStatus:t})},deleteFolder:function(e){var t=this.createPendingStatus();return this.invokeLater(this._deleteFolder,1,e,t),t},_deleteFolder:function(e,t){if(e.get("status")!==SC.Record.READY_CLEAN){t.setError({errorCode:this.ERROR_BUSY});return}var n=e.get("guid"),r=e.get("parent");CoreMail.store.destroyRecord(CoreMail.Folder,n),CoreMail.store.commitRecord(CoreMail.Folder,n,undefined,{deleteType:CoreMail.Request.DELETE_FOLDER,folderGuid:n,folderName:e.get("name"),folderParent:e.get("parent"),requestStatus:t}),CoreMail.FOLDER_PERF||r&&r.notifyPropertyChange("children")},renameFolder:function(e,t){var n=this.createPendingStatus();return this.invokeLater(this._renameFolder,0,e,t,n),n},_renameFolder:function(e,t,n){if(e.get("status")!==SC.Record.READY_CLEAN){n.setError({errorCode:this.ERROR_BUSY});return}var r=e.get("storeKey"),i={};i[r]=e.get("name"),e.set("name",t),CoreMail.store.commitRecord(null,null,r,{updateType:CoreMail.Request.RENAME_FOLDER,propertyName:"name",origValues:i,children:e.get("children"),requestStatus:n})},moveFolder:function(e,t){var n=this.createPendingStatus();return this.invokeLater(this._moveFolder,1,e,t,n),n},_moveFolder:function(e,t,n){if(e.get("status")!==SC.Record.READY_CLEAN){n.setError({errorCode:this.ERROR_BUSY});return}var r=e.get("storeKey"),i={};i[r]=e.get("parent"),e.set("parent",t),CoreMail.store.commitRecord(null,null,r,{updateType:CoreMail.Request.MOVE_FOLDER,propertyName:"parent",origValues:i,children:e.get("children"),requestStatus:
n})},emptyFolder:function(e){var t=this.createPendingStatus();return this.invokeLater(this._emptyFolder,1,e,t),t},_emptyFolder:function(e,t){var n=this._folderLocalMessages(e);if(n===NO){t.setError({errorCode:this.ERROR_BUSY});return}var r;n&&n.get("length")>0&&(r=n.getEach("storeKey"),CoreMail.store.destroyRecords(null,null,r));var i={deleteType:CoreMail.Request.EMPTY_FOLDER,folderGuid:e.get("guid"),requestStatus:t};r?CoreMail.store.commitRecords(null,null,r,i):CoreMail.messageListDataSource.destroyRecords(CoreMail.store,null,i)},_sendURL:CoreMail.Request.BASE_URL+"message",sendMessage:function(e,t,n,r,i,s,o,u,a,f,l,c){var h=this.createPendingStatus();return this._sendMessageRequest("send",h,e,t,n,r,i,s,o,u,a,f,l,c),h},saveDraft:function(e,t,n,r,i,s,o,u,a,f,l,c){var h=this.createPendingStatus();if(Compose.get("isSendInProgress")===YES)h.setError({});else{var p=u.filterProperty("isFileUploaded",YES);this._sendMessageRequest("saveDraft",h,e,t,n,r,i,s,o,p,a,f,l,c)}return h},_sendMessageRequest:function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=CoreMail.Request.getRequest(this._sendURL),v=CoreMail.Request.postBody(e,d);v.params={};var m=CK.tokensParser.parseEmailAddress(n);m&&(n=m.get("parsedValue")),v.params.date=(new Date).toUTCString(),v.params.from=n,v.params.webmailClientBuild=SC.buildNumber,r&&(v.params.to=r.replace(/(\r\n|\n|\r)/gm," ")),i&&(v.params.cc=i.replace(/(\r\n|\n|\r)/gm," ")),s&&(v.params.bcc=s.replace(/(\r\n|\n|\r)/gm," ")),o&&(v.params.subject=o),u&&(v.params.textBody=u),a&&(v.params.body=a);if(f||l)v.params.attachments=[],f&&this._jsonifyAttachments(f,v),l&&this._jsonifyAttachments
(l,v);c&&(v.params.draftGuid=c);if(h&&p){v.params.msgGuid=h,v.params.mode=p;var g=CoreMail.store.find(CoreMail.MessageDetail,h);if(g){var y=g.get("processedLongHeader");for(var b=0;b<y.length;b++)if(y[b].key.toLowerCase()==="message-id"){v.params.messageId=y[b].value;break}}}var w=e==="send"?"sendResponse":"draftResponse";d.set("body",v),d.notify(this,CoreMail.sharedResponse,{caller:"CoreMail",method:w,store:CoreMail.store,params:{opener:window.WHAT_TYPE.isMailChild()?opener:null,requestStatus:t,draftGuid:c,msgGuid:h,mode:p}}),d.send()},_jsonifyAttachments:function(e,t){var n=e.get("length"),r,i;for(var s=0;s<n;s++)r=e.objectAt(s),i={guid:r.get("guid"),name:r.get("name")||r.get("filename"),datatype:r.get("datatype"),contentDisposition:r.get("contentDisposition"),url:r.get("attachmentUrl"),related:r.get("related"),contentID:r.get("contentID"),size:r.get("size"),mailDropStreamingUrl:r.get("mailDropStreamingUrl"),mailDropExpirationDate:r.get("mailDropExpirationDate"),isMailDropThumbnail:r.get("isMailDropThumbnail")},t.params.attachments.push(i)},sendResponseSuccess:function(e,t,n,r){var i=n.requestStatus;if(n.opener)if(opener&&opener.Global)opener.Global.execFunctionInMailContext(opener.CoreMail,CoreMail.performPostSendMaintenance,n,r);else{var s="CoreMail.sendResponseSuccess : opener is "+opener;CoreMail.errorHandler.logErrorTrap(s)}i.setSuccess()},performPostSendMaintenance:function(e,t){var n=e.mode,r=t.result.relatedGUID;this._deleteDraft(e.draftGuid),e.draftGuid&&CoreMail.updateFolderCount(CoreMail.DRAFTS_GUID,"total",CoreMail.DECREMENT,1);if(e.msgGuid){var i=CoreMail.store
.find(CoreMail.Message,e.msgGuid);i&&(i.get("status")&SC.Record.READY)>0&&(n===CoreMail.MESSAGE_MODE_REPLY||n===CoreMail.MESSAGE_MODE_REPLY_ALL?(i.set("replied",YES),i.set("forwarded",NO)):n===CoreMail.MESSAGE_MODE_FORWARD&&(i.set("forwarded",YES),i.set("replied",NO)),r&&i.set("relatedGUID",r),CoreMail.washClean(CoreMail.store,i.get("storeKey")))}},sendResponseError:function(e,t,n,r){SC.debug(e+"error = "+r.errorCode+"/"+r.errorMessage);var i=n.requestStatus;i.setError(r)},draftResponseSuccess:function(e,t,n,r){var i=n.requestStatus,s=r.result;if(!s){i.setError({errorCode:CoreMail.ERROR_EMPTY_RESULT});return}if(n.opener)if(opener)opener.Global&&(opener.Global.execFunctionInMailContext(opener.CoreMail,this._deleteDraft,n.draftGuid),n.draftGuid||opener.Global.execFunctionInMailContext(opener.CoreMail,CoreMail.updateFolderCount,CoreMail.DRAFTS_GUID,"total",CoreMail.INCREMENT,1));else{var o="CoreMail.draftResponseSuccess : opener is "+opener;CoreMail.errorHandler.logErrorTrap(o)}i.set("newDraftGuid",s.guid),s.uid&&i.set("newDraftUid",s.uid),i.setSuccess()},draftResponseError:function(e,t,n,r){SC.debug(e+"error = "+r.errorCode+"/"+r.errorMessage);var i=n.requestStatus;i.setError(r)},_deleteDraft:function(e){var t=CoreMail.store,n=t.find(CoreMail.Message,e);if(n&&(n.get("status")&SC.Record.READY)>0){var r=CoreMail.messageListDataSource.storeKeyArray(CoreMail.DRAFTS_GUID),i=r.indexOf(n.get("storeKey"));if(i>=0){r.removeAt(i),t.pushDestroy(CoreMail.Message,n.get("guid")),SC.debug("removed draft message: "+e);return}}},deleteSingleMessage:function(e,t){var n=this.createPendingStatus(
);return this._deleteSingleMessage(e,t,n),n},_deleteSingleMessage:function(e,t,n){var r=CoreMail.Request.getRequest(this._sendURL),i=CoreMail.Request.postBody("delete",r);i.params={folder:e,uids:[t]},r.set("body",i),r.notify(this,CoreMail.sharedResponse,{caller:"CoreMail",method:"deleteSingleMessageResponse",store:CoreMail.store,params:{requestStatus:n}}),r.send()},deleteSingleMessageResponseSuccess:function(e,t,n){n.requestStatus.setSuccess()},deleteSingleMessageResponseError:function(e,t,n,r){SC.debug(e+"error = "+r.errorCode+"/"+r.errorMessage),n.requestStatus.setError(r)},implicitPreferences:function(){return this._implicitPref?this._implicitPref:CloudOS.getUser().get("appleId")?(this._implicitPref=CoreMail.store.find(CoreMail.ImplicitPreferences,CoreMail.IMPLICIT_PREFS_GUID),this._implicitPref):(this._tempImplicitPref||(this._tempImplicitPref=CoreMail.store.createRecord(CoreMail.ImplicitPreferences,{})),this._tempImplicitPref)}.property(),saveImplicitPreference:function(e,t){if(SC.browser.isOpera===YES)return;e==="view"?CoreMail.incrementUserStat(CoreMail.STAT_CHANGE_VIEW):(e==="messageSortBy"||e==="messageSortAscending")&&CoreMail.incrementUserStat(CoreMail.STAT_CHANGE_SORT);var n=CoreMail.store.find(CoreMail.ImplicitPreferences,CoreMail.IMPLICIT_PREFS_GUID);(e==="openFolderDisclosures"||e==="folderFilterCriteriaMap")&&n.set(e,{}),n.set(e,t);var r=this.createPendingStatus();return this.invokeLater(this._saveImplicitPreference,1,n,r),r},_saveImplicitPreference:function(e,t){if(e.get("status")&SC.Record.BUSY){t.setError({errorCode:this.ERROR_BUSY});return}CoreMail.store.
commitRecord(null,null,e.get("storeKey"),{requestStatus:t})},getServerPreferences:function(){return CoreMail.store.find(CoreMail.ServerPreferences,CoreMail.SERVER_PREFS_GUID)},saveServerPreferences:function(e){var t=this.createPendingStatus();return this.invokeLater(this._saveServerPreferences,1,e,t),t},_saveServerPreferences:function(e,t){if(e.get("status")&SC.Record.BUSY){t.setError({errorCode:this.ERROR_BUSY});return}CoreMail.store.commitRecord(null,null,e.get("storeKey"),{updateType:CoreMail.Request.UPDATE_SERVER_PREFS,requestStatus:t})},createAccount:function(e,t){var n=this.createPendingStatus();return this.invokeLater(this._createAccount,1,e,t,n),n},_createAccount:function(e,t,n){e===CoreMail.IdentityAccount&&(t.type="CoreMail.IdentityAccount"),e===CoreMail.AliasAccount&&(t.type="CoreMail.AliasAccount",t.emails[0]&&t.emails[0].address.indexOf("@icloud.com")<0&&(t.emails[0].address+="@icloud.com"));var r=CoreMail.store.createRecord(e,t);CoreMail.store.commitRecord(null,null,r.get("storeKey"),{createType:CoreMail.Request.CREATE_ACCOUNT,accountHash:t,requestStatus:n})},updateAccount:function(e){var t=this.createPendingStatus();return this.invokeLater(this._updateAccount,1,e,t),t},_updateAccount:function(e,t){if(e.get("status")&SC.Record.BUSY){t.setError({errorCode:this.ERROR_BUSY});return}CoreMail.store.commitRecord(null,null,e.get("storeKey"),{updateType:CoreMail.Request.UPDATE_ACCOUNT,requestStatus:t})},deleteAccount:function(e){var t=this.createPendingStatus();return this.invokeLater(this._deleteAccount,1,e,t),t},_deleteAccount:function(e,t){if(e.get("status")!==SC.Record
.READY_CLEAN){t.setError({errorCode:this.ERROR_BUSY});return}if(e instanceof CoreMail.IdentityAccount){t.setError({errorCode:this.ERROR_DENIED});return}var n=e.get("storeKey");CoreMail.store.destroyRecord(null,null,n),CoreMail.store.commitRecord(null,null,n,{deleteType:CoreMail.Request.DELETE_ACCOUNT,requestStatus:t})},getBlacklist:function(e,t){var n;return e?n=SC.Query.create({recordType:CoreMail.Blacklist,orderBy:t,resync:YES,isEditable:YES}):n=SC.Query.create({conditions:"action != 'D'",recordType:CoreMail.Blacklist,orderBy:t,isEditable:YES}),CoreMail.store.find(n)},updateBlacklist:function(){var e=this.createPendingStatus();return this.invokeLater(this._updateBlacklist,1,e),e},_updateBlacklist:function(e){var t=[],n=[],r,i=[],s=CoreMail.store.find(CoreMail.Blacklist);s&&s.length()>0&&(s.forEach(function(e){var i=e.get("action"),s=e.get("storeKey");i===CoreMail.Request.BLACKLIST_ACTION_ADD?(r={name:e.get("name"),address:e.get("address"),action:i},t.push(r),n.push(s)):i===CoreMail.Request.BLACKLIST_ACTION_DELETE&&(r={address:e.get("address"),action:i},t.push(r),n.push(s))}),i={records:t}),CoreMail.blacklistDataSource.updateRecords(CoreMail.store,n,{records:i,requestStatus:e})},getMessage:function(e,t){var n=this.createPendingStatus(),r=CoreMail.store.find(CoreMail.Message,t);if(r&&r.get("status")===SC.Record.READY_CLEAN)n.setSuccess();else{var i=CoreMail.store.find(CoreMail.ImplicitPreferences,CoreMail.IMPLICIT_PREFS_GUID),s={_internalUse:{requestStatus:n,loadType:this._getLoadType(null,null,t)},guid:e,sorttype:i.get("messageSortBy"),sortorder:i.get("messageSortAscending"
)?"ascending":"descending",searchtype:null,searchtext:null};s.requesttype="guid",s.selected=t,s.count=1;var o=SC.Query.remote(CoreMail.Message,null,s);n.set("requestData",{messageArray:CoreMail.store.find(o)})}return n},fetchMailDropAuthTokens:function(e){return CoreMail.messagePartDataSource.fetchMailDropAuthTokens(e)},fetchFileDownloadUrl:function(e){return CoreMail.messagePartDataSource.fetchFileDownloadUrl(e)},sendMailDropRepublishRequest:function(e){return CoreMail.messagePartDataSource.sendMailDropRepublishRequest(e)},moveAttachmentToMailDrop:function(e){return CoreMail.messagePartDataSource.moveAttachmentToMailDrop(e)},authInvalidated:function(){if(window.WHAT_TYPE.isMail()===NO){var e=window.opener,t=e?e.parent:null;t&&t.location.reload()}},_definedIndexes:function(e,t){if(e&&e.firstObject()&&e.firstObject().get("folder")){var n=e.firstObject().get("folder").get("guid"),r=CoreMail.messageListDataSource.storeKeyArray(n),i=e.indexSetForSource(t);if(r){var s=r.definedIndexes(i);s.set("source",r);var o=YES,u=CoreMail.store;return s.forEachObject(function(e,t,n){u.readStatus(n.objectAt(t))!==SC.Record.READY_CLEAN&&(o=NO)},this),o?{definedIndexes:s,selectedIndexSet:i}:null}var a="CoreMail._definedIndexes : storeKeyArray is undefined";return CoreMail.errorHandler.logErrorTrap(a),null}return e?CoreMail.errorHandler.logErrorTrap("CoreMail._definedIndexes:error retrieving folder name "+e.toArray().toString()):CoreMail.errorHandler.logErrorTrap("CoreMail._definedIndexes: selectedRecords is "+e),null},_folderLocalMessages:function(e){var t=SC.Query.local(CoreMail.Message,"folder = {record}"
,{record:e}),n=CoreMail.store.find(t);if(n&&n.get("length")>0){var r=n.getEach("status"),i=r.length,s=YES;for(var o=0;o<i;o++)if(r[o]!==SC.Record.READY_CLEAN){s=NO;break}if(!s)return NO}return n},_getLoadType:function(e,t,n){var r=CoreMail.Request.SORT;return e&&t?n?r=CoreMail.Request.SEARCH_WITH_SELECTION:r=CoreMail.Request.SEARCH:n&&(r=CoreMail.Request.SORT_WITH_SELECTION),r},_pushToString:function(e){var t="pushHash:\n";return e.newslotnumber&&(t+="	newslotnumber: "+e.newslotnumber+"\n"),e.operation&&(t+="	operation: "+e.operation+"\n"),e.folderGuid&&(t+="	folderGuid: "+e.folderGuid+"\n"),e.msgUid&&(t+="	msgUid: "+e.msgUid+"\n"),e.index&&(t+="	index: "+e.index+"\n"),e.totalMessages&&(t+="	totalMessages: "+e.totalMessages+"\n"),t},listUnsubscribe:function(e,t){var n=this.createPendingStatus();return CoreMail.messageDetailDataSource.listUnsubscribe(n,e,t),n},uploadMessage:function(e,t){CoreMail.messageListDataSource.uploadMessage(e,t)}}),SC.mixin(CoreMail,{sharedRuleResponse:function(e,t){var n=t.method,r=t.caller+"."+n+" ",i=t.params;i||(i={});var s,o;if(n==="fetchRulesResponse")s=this.fetchRulesResponseError,o=this.fetchRulesResponseSuccess;else{if(n!=="updateRulesResponse")return CoreMail.unrecoverableError("Unexpected method name: "+n,i.requestStatus);s=this.updateRulesResponseError,o=this.updateRulesResponseSuccess}var u=t.store,a=t.storeKeys,f=t.skArray;i.storeKeys=a,i.storeKeyArray=f;var l=r+e.originalRequest().get("body").id;SC.Benchmark.start(l);var c=e.get("body"),h=CoreMail.Request.errorInResponse(e);h?s.call(this,r,u,i,h):(o.call(this,r,u,i,c),Preferences._prefRules
.set("status",513)),SC.Benchmark.end(l)},getRules:function(e){var t;return e?t=SC.Query.create({recordType:CoreMail.RuleList,orderBy:"order",isEditable:YES,resync:YES}):t=SC.Query.create({conditions:"ruleState != 'D'",recordType:CoreMail.RuleList,orderBy:"order",isEditable:YES}),CoreMail.store.find(t)},getRulesFolders:function(e){var t;return e?t=SC.Query.local(CoreMail.Folder,{conditions:"role != '"+CoreMail.FOLDER_ROLE_VIP+"'",orderBy:"name",resync:YES}):t=SC.Query.local(CoreMail.Folder,{conditions:"role != '"+CoreMail.FOLDER_ROLE_VIP+"'",orderBy:"name"}),CoreMail.store.find(t)},saveRules:function(){return CoreMail.ruleListDataSource.updateRecords()}}),SC.mixin(CoreMail,{createVipSender:function(e){var t=CoreMail.store.createRecord(CoreMail.VipSender,e),n=this.createPendingStatus();return this.invokeLater(this._createVipSender,0,t,n),n},_createVipSender:function(e,t){CoreMail.store.commitRecord(null,null,e.get("storeKey"),{createType:CoreMail.Request.CREATE_VIP_SENDER,requestStatus:t})},getVipSenders:function(e){var t;return e?(t=SC.Query.local(CoreMail.VipSender,{resync:YES}),this.setIfChanged("isVipSenderResyncInProgress",YES)):t=SC.Query.local(CoreMail.VipSender),CoreMail.store.find(t)},updateVipSenderAddresses:function(e,t){var n=this.createPendingStatus();return this.invokeLater(this._updateVipSenderAddresses,0,e,t,n),n},_updateVipSenderAddresses:function(e,t,n){var r=e.get("storeKey"),i={};i.addresses=e.get("addresses"),e.set("addresses",t),CoreMail.store.commitRecord(null,null,r,{updateType:CoreMail.Request.UPDATE_VIP_SENDER_ADDRESSES,propertyName:"addresses",origValues
:i,requestStatus:n})},updateVipSenderName:function(e,t){var n=this.createPendingStatus();return this.invokeLater(this._updateVipSenderName,0,e,t,n),n},_updateVipSenderName:function(e,t,n){var r=e.get("storeKey"),i={};i.name=e.get("name"),e.set("name",t),CoreMail.store.commitRecord(null,null,r,{updateType:CoreMail.Request.UPDATE_VIP_SENDER_NAME,propertyName:"name",origValues:i,requestStatus:n})},deleteVipSender:function(e){var t=this.createPendingStatus();return this.invokeLater(this._deleteVipSender,0,e,t),t},_deleteVipSender:function(e,t){if(e.get("status")!==SC.Record.READY_CLEAN){t.setError({errorCode:this.ERROR_BUSY});return}var n=e.get("guid");CoreMail.store.destroyRecord(CoreMail.VipSender,n),CoreMail.store.commitRecord(CoreMail.VipSender,n,undefined,{deleteType:CoreMail.Request.DELETE_VIP_SENDER,vipSenderGuid:n,requestStatus:t})}}),CoreMail.mixin({initializeStores:function(){CoreMail.store=SC.Store.create({name:"Mail Main store"}).from("CoreMail.dataSource")},imapAttachmentBaseUrl:function(){return CloudOS.getUrlForServiceName("mail")+"/wm/messagepart"}.property().cacheable(),updateUnreadForVipFolder:function(e,t,n){var r,i,s,o,u,a;if(!e){SC.warn("updateUnreadForVipFolder: GUID of VIP folder is undefined");return}r=CoreMail.findLocalFolder(e);if(!r){SC.warn("updateUnreadForVipFolder: unable to find local vipFolder: %@. Ignoring update".fmt(e));return}s=r.get("parent");if(!s){SC.warn("updateUnreadForVipFolder: unable to find local aggregateVipFolder: %@. Ignoring update".fmt(e));return}i=r.get("sha1"),o=s.get("guid"),u=s.get("sha1"),CoreMail.updateFolderCount(e,CoreMail
.MESSAGE_FLAG_UNREAD,t,n),CoreMail.updateFolderCount(o,CoreMail.MESSAGE_FLAG_UNREAD,t,n),a=CoreMail.getPath("implicitPreferences.vipUnreadCounts"),a||CoreMail.errorHandler.logErrorTrap("CoreMail.updateUnreadForVipFolder: vipUnreadCounts(implicit prefs) is null when it should not be. vipFolderGuid: %@, aggregateVipFolderGuid: %@".fmt(e,o)),a[i]||(a[i]=0),a[u]||(a[u]=0),t===CoreMail.INCREMENT?(a[i]+=n,a[u]+=n):t===CoreMail.DECREMENT&&(a[i]-=n,a[u]-=n),CoreMail.saveImplicitPreference("vipUnreadCounts",a)},tempMessageBodyElement:null,extensionForFileName:function(e){var t;if(e){e=e.split(".");var n=e.length;t=e.lastObject().toLowerCase(),t==="zip"&&n>2&&(t=e[n-2]+"."+t)}return t?t:""}}),SC.mixin(CoreMail,{hasIncompletePreferences:NO,serverPreferences:null,fetchServerPreferences:function(){this._serverPref=CoreMail.store.find(CoreMail.ServerPreferences,CoreMail.SERVER_PREFS_GUID),this.set("serverPreferences",this._serverPref),(this._serverPref.get("status")&SC.Record.BUSY)>0?this._serverPref.addObserver("status",this,this.preferencesFetched):this.preferencesFetched()},werePreferencesFetched:NO,preferencesFetched:function(){var e=this._serverPref.get("status");if(e&SC.Record.READY>0&&this.get("werePreferencesFetched")===NO)this.set("werePreferencesFetched",YES),CoreMail.timeZoneConverter.configure(this._serverPref.get("tzOffset"),this._serverPref.get("country")),this._serverPref.removeObserver("status",this,this.preferencesFetched);else if((e&SC.Record.ERROR)>0||(e&SC.Record.EMPTY)>0)this._serverPref.removeObserver("status",this,this.preferencesFetched),CoreMail.errorHandler.handleBootstrapError
("Preferences.RefreshError")},isEmailInUserAccount:function(e,t){var n=CK.tokensParser.parseEmailAddress(e);n&&(e=n.get("emailId").toLowerCase());var r=NO;return t&&t.join().toLowerCase().indexOf(e)>=0&&(r=YES),r},getIdentityAccountEmail:function(){var e=CoreMail.store.find(CoreMail.IdentityAccount,CoreMail.IDENTITY_ACCOUNT_GUID);if(e&&e.get("status")!==SC.Record.ERROR)return this.getPreferredEmailAddress(e.get("emails"))},buildAccountDataHash:function(e,t){var n,r;t=t?t:"",e=e?e:"",t=SC.RenderContext.escapeHTML(t);if(!e||e===""){try{n=SC.RenderContext.escapeHTML(CloudOS.getUser().displayName())}catch(i){throw SC.error(i),i}n?n=n+" <"+t+">":n=" <"+t+">"}else n=e+" <"+t+">";return r={email:t,fullName:e,display:n},r},getSendFromEmailHashes:function(){var e=this.getActiveAccounts(),t=[],n,r,i,s=SC.Record.ERROR;return e&&e.forEach(function(e){var o=e.get("fullName"),u;if(e.instanceOf(CoreMail.IdentityAccount)&&e.get("status")!==s){i=e.get("emails");var a=NO;for(n=0,r=i.length;n<r;n++)i[n].canSendFrom===YES&&(a=YES,u=CoreMail.buildAccountDataHash(o,i[n].address),t.push(u))}else if(e.instanceOf(CoreMail.AliasAccount)&&e.get("status")!==s){i=e.get("emails");for(n=0,r=i.length;n<r;n++)i[n].canSendFrom===YES&&(u=CoreMail.buildAccountDataHash(o,i[n].address),t.push(u))}},t),t},getActiveAccounts:function(){var e,t=[];t.pushObjects(CoreMail.store.find(CoreMail.IdentityAccount));var n=CoreMail.store.find(CoreMail.AliasAccount);if(n){var r=n.get("length");for(e=0;e<r;e++){var i=n.objectAt(e);i.get("active")&&t.pushObject(i)}}return t},getPreferredEmailAddress:function(e){var t,n,r;for(var i=0
,s=e.length;i<s;i++)e[i].address.toLowerCase().split("@").indexOf("icloud.com")===1?t=i:e[i].address.toLowerCase().split("@").indexOf("me.com")===1?n=i:e[i].address.toLowerCase().split("@").indexOf("mac.com")===1&&(r=i);if(t>=0&&e[t].canSendFrom===YES)return e[t].address;if(n>=0&&e[n].canSendFrom===YES)return e[n].address;if(r>=0&&e[r].canSendFrom===YES)return e[r].address;if(n>=0)return e[n].address;if(t>=0)return e[t].address;if(r>=0)return e[r].address}}),SC.mixin(CoreMail,{TIME_CLIENT_LOAD:0,TIME_INBOX_LOAD:1,TIME_COMPOSE_LOAD:2,TIME_SEND:3,systemStatStrings:["TIME_CLIENT_LOAD","TIME_INBOX_LOAD","TIME_COMPOSE_LOAD","TIME_SEND"],systemStats:[],setSystemStat:function(e,t){if(e===undefined||e<0||e>CoreMail.TIME_SEND){SC.warn("Invalid system statistic: "+e);return}CoreMail.systemStats[e]=t},_isMailClientLoadStatSent:NO,_isStartupLoadStatSent:NO,isComposeLoadStatSent:YES,isSendTimeStatSent:YES,hubbleStats:function(){var e,t,n,r=CoreMail.systemStatStrings,i=CoreMail.errorHandler,s=CoreMail.cloudOSBenchmarks;if(this._isMailClientLoadStatSent===NO&&s){e=s[CoreMail.BENCH_MAIL_CLIENT_LOAD];if(e){var o=CoreMail.TIME_CLIENT_LOAD;n=e.amt,CoreMail.setSystemStat(o,n),n>0&&(i.recordStat("_"+r[o],{clientLoadTimeInMS:n}),this._isMailClientLoadStatSent=YES,this.invokeLater(function(){CoreMail.setSystemStat(o,0)},1e3))}}if(this._isStartupLoadStatSent===NO){var u=SC.Benchmark.stats[CoreMail.BENCH_MAIL_STARTUP];u&&(n=u.amt,t=CoreMail.TIME_INBOX_LOAD,CoreMail.setSystemStat(t,n),n>0&&(i.recordStat("_"+r[t],{inboxLoadTimeInMS:n}),this._isStartupLoadStatSent=YES,this.invokeLater(function(){CoreMail
.setSystemStat(t,0)},1e3)))}if(this.get("isComposeLoadStatSent")===NO){var a=SC.Benchmark.stats.perfOpenMessageWindowInEditMode;a&&(n=Math.floor(a.amt/a.runs),t=CoreMail.TIME_COMPOSE_LOAD,CoreMail.setSystemStat(t,n),n>0&&(i.recordStat("_"+r[t],{composeLoadTimeInMS:n}),this.set("isComposeLoadStatSent",YES)))}if(this.get("isSendTimeStatSent")===NO){var f=SC.Benchmark.stats.perfSendMessage;f&&(n=Math.floor(f.amt/f.runs),t=CoreMail.TIME_SEND,CoreMail.setSystemStat(t,n),n>0&&(i.recordStat("_"+r[t],{sendTimeInMS:n}),this.set("isSendTimeStatSent",YES)))}var l=CoreMail.systemStats;for(var c=0;c<=CoreMail.TIME_SEND;c++)l[c]||(l[c]=0);return l},STAT_ARCHIVE:0,STAT_COMPOSE:1,STAT_KS_COMPOSE:2,STAT_KS_MSG_NAV:3,STAT_KS_DELETE:4,STAT_KS_FLAG_UNFLAG:5,STAT_KS_READ_UNREAD:6,STAT_KS_REPLY:7,STAT_DD_MOVE_MSG:8,STAT_TB_MOVE_MSG:9,STAT_CHANGE_VIEW:10,STAT_VIEW:11,STAT_CHANGE_SORT:12,STAT_SORT_TYPE:13,STAT_SORT_ORDER:14,STAT_VIEW_MSG_WINDOW:15,STAT_FONT_CHANGE:16,STAT_FONT_SIZE_CHANGE:17,STAT_FONT_COLOR_CHANGE:18,STAT_BOLD_ITALIC_UNDERLN:19,STAT_JUSTIFY_CHANGE:20,STAT_LINK:21,STAT_MINI_AB:22,STAT_TOTAL_ALIASES:23,STAT_ENABLE_VACATION_REPLY:24,STAT_USE_SIGNATURE:25,STAT_REPLY_REPLY_ALL:26,STAT_RECENTS_CLICK:27,STAT_ATTACHMENT_SIZE_ALERT:28,STAT_IMPORT_VCF:29,STAT_KS_SEND_EMAIL:30,STAT_LOGIN:31,iReporterStatStrings:["ae","cc","ck","mn","dk","fl","rd","rk","dmv","tm","cdm","dm","sc","ost","osv","vmc","fcg","fsc","fcc","biuc","jt","cl","abo","al","vro","so","rc","rec","asa","ivcf","ksm","lo"],feedbackWSStatStrings:["STAT_ARCHIVE","STAT_COMPOSE","STAT_KS_COMPOSE","STAT_KS_MSG_NAV","STAT_KS_DELETE","STAT_KS_FLAG_UNFLAG"
,"STAT_KS_READ_UNREAD","STAT_KS_REPLY","STAT_DD_MOVE_MSG","STAT_TB_MOVE_MSG","STAT_CHANGE_VIEW","STAT_VIEW","STAT_CHANGE_SORT","STAT_SORT_TYPE","STAT_SORT_ORDER","STAT_VIEW_MSG_WINDOW","STAT_FONT_CHANGE","STAT_FONT_SIZE_CHANGE","STAT_FONT_COLOR_CHANGE","STAT_BOLD_ITALIC_UNDERLN","STAT_JUSTIFY_CHANGE","STAT_LINK","STAT_MINI_AB","STAT_TOTAL_ALIASES","STAT_ENABLE_VACATION_REPLY","STAT_USE_SIGNATURE","STAT_REPLY_REPLY_ALL","STAT_RECENTS_CLICK","STAT_ATTACHMENT_SIZE_ALERT","STAT_IMPORT_VCF","STAT_KS_SEND_EMAIL","STAT_LOGIN"],_STAT_VIEWS:{"3Column":1,"2Column":2},_STAT_SORTS:{Date:1,From:2,Subject:3,Unread:4,Flag:5,Size:6},userStats:{},incrementUserStat:function(e){if(e===undefined||e<0||e===CoreMail.STAT_TOTAL_ALIASES||e===CoreMail.STAT_ENABLE_VACATION_REPLY||e===CoreMail.STAT_USE_SIGNATURE){SC.warn("Attempt to increment an invalid user stat: "+e);return}CoreMail.errorHandler.recordStat("_"+this.feedbackWSStatStrings[e]),e=CoreMail.iReporterStatStrings[e],CoreMail.userStats[e]||(CoreMail.userStats[e]=0),CoreMail.userStats[e]++},_prevStatsCache:{},iReporterStats:function(){var e=CoreMail.get("implicitPreferences"),t=CoreMail.getServerPreferences(),n=CoreMail.userStats,r=this._prevStatsCache,i=e.get("view");i!==r.dm&&(r.dm=i,n.dm=i==="3Column"?"Widescreen":"Compact");var s=e.get("messageSortBy");s!==r.ost&&(r.ost=n.ost=s);var o=e.get("messageSortAscending");o!==r.osv&&(r.osv=o,n.osv=o===YES?"Ascending":"Descending");var u=CoreMail.store.find(CoreMail.AliasAccount).get("length");u!==r.al&&(r.al=n.al=u);var a=t.get("enableVacationReply")===YES;a!==r.vro&&(r.vro=a,n.vro=a===YES?1:2);var f=
t.get("useSignature");return f!==r.so&&(r.so=f,n.so=f===YES?1:2),CoreMail.userStats={},n},feedbackWSStats:function(){var e={},t=CoreMail.get("implicitPreferences"),n=CoreMail.getServerPreferences();e.implicitPrefs_view=t.get("view"),e.implicitPrefs_messageSortBy=t.get("messageSortBy"),e.implicitPrefs_messageSortAscending=t.get("messageSortAscending"),e.implicitPrefs_headerExpanded=t.get("headerExpanded"),e.implicitPrefs_longHeaderVisible=t.get("longHeaderVisible");var r=t.get("lastSelectedSearch");switch(r){case"0":r="From";break;case"1":r="To";break;case"2":r="Subject";break;case"3":r="All";break;default:}e.implicitPrefs_lastSelectedSearch=r,e.implicitPrefs_blacklistSortBy=t.get("blacklistSortBy"),e.implicitPrefs_blacklistSortAscending=t.get("blacklistSortAscending"),n.get("country")!==null&&(e.prefs_country=n.get("country")),n.get("tzOffset")!==null&&(e.prefs_tzOffset=n.get("tzOffset")),n.get("showMessagePreviews")!==null&&(e.prefs_showMessagePreviews=n.get("showMessagePreviews")),n.get("displayArchiveInseadOfTrash")!==null&&(e.prefs_displayArchiveInseadOfTrash=n.get("displayArchiveInseadOfTrash")),n.get("saveSent")!==null&&(e.prefs_saveSent=n.get("saveSent")),n.get("moveTrash")!==null&&(e.prefs_moveTrash=n.get("moveTrash")),n.get("forwardEmail")!==null&&(e.prefs_forwardEmail=n.get("forwardEmail"),n.get("deleteMessageAfterForwarding")!==null&&(e.prefs_deleteMessageAfterForwarding=n.get("deleteMessageAfterForwarding"))),n.get("includeOriginalMessageInReply")!==null&&(e.prefs_includeOriginalMessageInReply=n.get("includeOriginalMessageInReply")),n.get("includeOriginalAttachmentsInReply"
)!==null&&(e.prefs_includeOriginalAttachmentsInReply=n.get("includeOriginalAttachmentsInReply")),n.get("useSignature")!==null&&(e.prefs_useSignature=n.get("useSignature")),e.prefs_useMailDrop=n.get("useMailDrop"),n.get("loadImagesInHTML")!==null&&(e.prefs_loadImagesInHTML=n.get("loadImagesInHTML")),n.get("enableVacationReply")!==null&&(e.prefs_enableVacationReply=n.get("enableVacationReply"),e.prefs_isVacationStartDateSet=n.get("vacationStartDate")!==null?YES:NO,e.prefs_isVacationEndDateSet=n.get("vacationEndDate")!==null?YES:NO),e.prefs_hasCustomTrashFolder=n.get("trashFolderGuid")===CoreMail.TRASH_GUID?NO:YES,e.prefs_hasCustomSentFolder=n.get("sentFolderGuid")===CoreMail.SENT_GUID?NO:YES;var i=CoreMail.getVipSenders(),s;i&&(s=i.get("length"),s&&(e.stats_vip_senders_count=s));var o=CoreMail.getFolders(),u,a,f;o&&(a=o.filterProperty("role",CoreMail.FOLDER_ROLE_FOLDER),u=a.get("length"),u>0&&(e.stats_custom_folders_count=u),a=o.filterProperty("role",CoreMail.FOLDER_ROLE_INBOX),a.get("length")>=1&&(f=a.firstObject(),f&&(e.stats_inbox_message_count=f.get("total"))),a=o.filterProperty("role",CoreMail.FOLDER_ROLE_ARCHIVE),a.get("length")>=1&&(f=a.firstObject(),f&&(e.stats_archive_message_count=f.get("total"))),a=o.filterProperty("role",CoreMail.FOLDER_ROLE_TRASH),a.get("length")>=1&&(f=a.firstObject(),f&&(e.stats_trash_message_count=f.get("total")))),e.stats_browser=SC.browser.current,CoreMail.errorHandler.recordStat("_USER_PREFERENCES",e)},sendCollectedStats:function(){var e=CoreMail.Request.BASE_URL+"stat",t=CoreMail.Request.getRequest(e),n=CoreMail.Request.postBody("put",t);t.
set("body",n),t.notify(CoreMail.ERROR_AUTH_INVALIDATED,this,this.authInvalidated),t.send()}}),CoreMail.AbstractDataSource=SC.DataSource.extend({retrieveResponseSuccess:function(e,t,n,r){var i=n.storeKeys,s=r.result,o={},u=NO,a=[],f=[],l,c,h,p,d,v,m;r.errorCode===CoreMail.INCOMPLETE_PREFERENCES?(CoreMail.set("hasIncompletePreferences",YES),s=r.errorData):CoreMail.set("hasIncompletePreferences",NO),!s||(c=s.length)===0,e&&e.trim()==="ServerPreferencesDataSource.retrieveResponse"&&SC.debug(JSON.stringify(r));for(var g=0;g<c;g++){var y=s[g];y.type||(y.type=y.recordType),o[y.type]||(o[y.type]=[]);if(y.type==="CoreMail.MessageDetail"){n.numPartsRequested>0&&(!y.parts||n.numPartsRequested>y.parts.length)&&(u=YES),this._handleMessageParts(t,y);var b=y.to,w=b?b.length:0,E=y.cc,S=E?E.length:0,x=y.bcc,T=x?x.length:0;if(w===0&&S===0&&T===0){var N=t.find(CoreMail.Message,y.message),C;N&&(C=N.getPath("folder.role"));if(C&&C!==CoreMail.FOLDER_ROLE_DRAFTS){var k=CoreMail.UNDISCLOSED_RECIPIENTS_GUID,L=CoreMail.get("undisclosedRecipientsRecordStoreKey");y.to=[k],L===null&&(L=t.loadRecord(CoreMail.EmailAddress,{guid:k,type:"CoreMail.EmailAddress"}),CoreMail.set("undisclosedRecipientsRecordStoreKey",L))}}}else if(y.type==="CoreMail.ServerPreferences"){y.guid=CoreMail.SERVER_PREFS_GUID;if(!y.sentFolder||y.sentFolder.toLowerCase().indexOf("folder:")!==0)y.sentFolder=CoreMail.SENT_GUID;if(!y.trashFolder||y.trashFolder.toLowerCase().indexOf("folder:")!==0)y.trashFolder=CoreMail.TRASH_GUID;y.sendMailFromAddress&&(y.sendMailFromAddress=y.sendMailFromAddress.toLowerCase())}else if(y.type==="CoreMail.IdentityAccount"
){y.accountDescription===""&&(y.accountDescription=CoreMail.DEFAULT_IDENTITY_ACCOUNT_DESCRIPTION),h=y.emails;for(var A=0,O=h.length;A<O;A++)h[A].address=h[A].address.toLowerCase();d=y.emails,v=d.get("length");for(var M=0;M<v;M++){p=d[M],m=p.canSendFrom;if(m===null||m===undefined)p.canSendFrom=YES;a.push(p)}l=CoreMail.getPreferredEmailAddress(y.emails)}else if(y.type==="CoreMail.AliasAccount"){y.color=CoreMail.ACCOUNT_COLOR_CODES.getCode(y.color);var _=y.emails;for(var D=0,P=_.length;D<P;D++)_[D].address=_[D].address.toLowerCase();if(f.indexOf(y.guid.toLowerCase()<0)){f.push(y.guid.toLowerCase()),o[y.type].push(y),d=y.emails,v=d.get("length");for(var H=0;H<v;H++){p=d[H],m=p.canSendFrom;if(m===null||m===undefined)p.canSendFrom=YES;a.push(p)}}}else if(y.type==="CoreMail.EmailAddress"){t.loadRecord(CoreMail.EmailAddress,y);continue}y.type!=="CoreMail.AliasAccount"&&o[y.type].push(y)}for(var B in o)if(o.hasOwnProperty(B)){var j=o[B];if(j.length===1&&j[0].guid===n.id){var F=j[0];if(F.type==="CoreMail.ServerPreferences"&&(!F.sendMailFromAddress||this._isSendMailFromAddressValid(F.sendMailFromAddress,a)===NO)){F.sendMailFromAddress=l;if(h){var I=h.filterProperty("address",l)[0];I&&(I.canSendFrom=!0)}}u===NO?t.dataSourceDidComplete(i,F):this.retrieveRecord(t,i,n.id)}else{var q=SC.objectForPropertyPath(B);t.loadRecords(q,o[B])}}},_isSendMailFromAddressValid:function(e,t){e=e.toLowerCase();for(var n=0,r=t.length;n<r;n++)if(t[n].address===e)return t[n].canSendFrom===YES?YES:NO;return NO},retrieveResponseError:function(e,t,n,r){SC.error("retrieveResponseError: \n			"+e+"\n			error:"+r.errorCode+"/"+
r.errorMessage+"\n			guid:"+n.id);if(r.errorCode===CoreMail.INCOMPLETE_PREFERENCES){this.retrieveResponseSuccess(e,t,n,r);return}var i=n.storeKeys;if(e&&e.trim()==="ServerPreferencesDataSource.retrieveResponse"){var s=SC.Error.create({code:r.errorMessage,errorValue:r});t.dataSourceDidError(i,s)}else t.dataSourceDidCancel(i)},createResponseSuccess:function(e,t,n,r){var i=n.storeKeys[0],s=r.result;t.dataSourceDidComplete(i,s,s.guid);if(CoreMail.FOLDER_PERF&&n.createType===CoreMail.Request.CREATE_FOLDER){var o=CoreMail.findLocalFolder(s.parent);if(o){var u=o.get("kids"),a=u.get("length");for(var f=0;f<a;f++){var l=u.objectAt(f);if(l.get("guid")===s.guid){u.removeAt(f,1),this.addSubfolder(o,l,t);break}}}}n.requestStatus.setSuccess()},createResponseError:function(e,t,n,r){SC.debug(e+"error = "+r.errorCode+"/"+r.errorMessage);var i=n.storeKeys[0];this._notifyStore(t,t.dataSourceDidError,i);if(CoreMail.FOLDER_PERF&&n.createType===CoreMail.Request.CREATE_FOLDER){var s=t.materializeRecord(i),o=s.get("parent");o&&(o.get("kids").removeObject(s),CoreMail.washClean(t,o.get("storeKey")))}t.pushDestroy(null,null,i),SC.debug(e+"setting ERROR on RequestStatus"),n.requestStatus.setError(r)},updateResponseSuccess:function(e,t,n,r){var i=n.storeKeys,s=n.storeKeyArray,o=n.selectedIndexSet,u=CoreMail.get("global"),a,f,l,c=n.updateType,h=CoreMail.Request;s&&(a=s.folderGuid);if(c===h.RENAME_FOLDER||c===h.MOVE_FOLDER){var p=r.result;if(CoreMail.FOLDER_PERF){var d=t.materializeRecord(i[0]),v;c===h.RENAME_FOLDER?v=d.get("parent"):v=n.origValues[i[0]],v&&(v.get("kids").removeObject(d),CoreMail.washClean
(t,v.get("storeKey"))),t.dataSourceDidComplete(i[0],p,p.guid);var m=p.parent;m&&(m=CoreMail.findLocalFolder(m),m&&this.addSubfolder(m,d,t))}if(!this._fixChildFolders(t,p.guid,n.children))return CoreMail.unrecoverableError("unable to fix child folders",n.requestStatus);if(c===h.RENAME_FOLDER){var g,y;l=u.getAllChildWindows();if(l)for(g=0,y=l.get("length");g<y;g++){var b=l[g];if(b&&b.closed===NO){var w=b.MailMessage,E=b.Message;w&&w.get("mode")===CoreMail.MESSAGE_MODE_VIEW&&E&&E.getPath("messageController.folder.guid")===a&&b.close()}}var S=s?s.get("length"):0;for(g=0;g<S;g++){var x=s.objectAt(g,YES);x!==undefined&&t.unloadRecord(null,null,x)}}}else if(i){var T=[],N,C=function(e){N=t.readStatus(e),N&SC.Record.BUSY?T.push(e):CoreMail.errorHandler.recordStat("_STAT_UPDATE_RECORD_INTERNAL_INCONSISTENCY",{updateType:c,folderListState:FolderList.get("state"),messageListState:MessageList.get("state"),viewMessageState:ViewMessage.get("state")})};i instanceof Array?i.forEach(function(e){C(e)}):C(i),this._notifyStore(t,t.dataSourceDidComplete,T)}if(c===h.UPDATE_SERVER_PREFS){var k=t.find(CoreMail.ServerPreferences,CoreMail.SERVER_PREFS_GUID),L=CoreMail.findLocalFolder(k.get("sentFolder")),A=CoreMail.findLocalFolder(k.get("trashFolder")),O=SC.Query.local(CoreMail.Folder,"role = '"+CoreMail.FOLDER_ROLE_SENT+"'"),M=t.find(O);if(M&&M.get("length")===1){var _=M.objectAt(0);L&&_!==L&&(SC.debug("updating default SENT folder from ["+_.get("guid")+"] to ["+L.get("guid")+"]"),_.set("role",CoreMail.FOLDER_ROLE_FOLDER),CoreMail.washClean(t,_.get("storeKey")),L.set("role",CoreMail.FOLDER_ROLE_SENT)
,CoreMail.washClean(t,L.get("storeKey")))}var D=SC.Query.local(CoreMail.Folder,"role = '"+CoreMail.FOLDER_ROLE_TRASH+"'"),P=t.find(D);if(P&&P.get("length")===1){var H=P.objectAt(0);A&&H!==A&&(SC.debug("updating default TRASH folder from ["+H.get("guid")+"] to ["+A.get("guid")+"]"),H.set("role",CoreMail.FOLDER_ROLE_FOLDER),CoreMail.washClean(t,H.get("storeKey")),A.set("role",CoreMail.FOLDER_ROLE_TRASH),CoreMail.washClean(t,A.get("storeKey")))}}else if(n.propertyName===CoreMail.MESSAGE_FLAG_UNREAD)s&&(f=n.origValues.unreadDiff,n.newValue===YES?c=CoreMail.INCREMENT:c=CoreMail.DECREMENT,CoreMail.updateFolderCount(a,CoreMail.MESSAGE_FLAG_UNREAD,c,f),this.updateVipUnreadCounts(t,a,i,c,n.origValues,NO));else if(n.propertyName===CoreMail.MESSAGE_FLAG_JUNK){f=n.origValues.unreadDiff;if(n.newValue===YES)CoreMail.updateFolderCount(a,CoreMail.MESSAGE_FLAG_UNREAD,CoreMail.DECREMENT,f),this.updateVipUnreadCounts(t,a,i,CoreMail.DECREMENT,n.origValues,YES),this._deleteJunk(c,t,s,i,o),CoreMail.saveDeletedUids(r.result);else{var B=CoreMail.findLocalFolder(s.folderGuid);B&&B.get("role")===CoreMail.FOLDER_ROLE_JUNK&&(CoreMail.updateFolderCount(s.folderGuid,CoreMail.MESSAGE_FLAG_UNREAD,CoreMail.DECREMENT,n.origValues.unreadDiff),this._deleteJunk(c,t,s,i,o),CoreMail.saveDeletedUids(r.result))}}if(n.messageGuid){l=u.getChildWindowsForMessage(n.messageGuid);try{if(l){var j,F;l.forEach(function(e){j=e.CoreMail,F=j.store.find(j.Message,n.messageGuid),F.set(n.propertyName,n.newValue),j.washClean(j.store,F.get("storeKey")),e.SC.RunLoop.begin().end()})}}catch(I){SC.warn('Caught exception "%@" while updating child window properties'
.fmt(I))}}n.requestStatus.setSuccess()},updateResponseError:function(e,t,n,r){SC.debug(e+"error = "+r.errorCode+"/"+r.errorMessage);var i=n.storeKeys,s=n.origValues;if(n.updateType===CoreMail.Request.UPDATE_ACCOUNT||n.updateType===CoreMail.Request.UPDATE_SERVER_PREFS)t.dataSourceDidCancel(i);else if(i&&s){SC.debug(e+"reverting changes after server error");var o=n.propertyName,u=i.length;for(var a=0;a<u;a++){var f=i[a],l=t.readStatus(f);if(l&SC.Record.BUSY){t.dataSourceDidCancel(f);var c=t.materializeRecord(f),h=s[f];if(h===undefined||h===null)return CoreMail.unrecoverableError("Can not revert to original value",n.requestStatus);c.set(o,h),SC.debug(c.get("guid")+": "+o+" reverted to "+h),CoreMail.washClean(t,f)}else SC.debug(e+"did not revert changes (record not BUSY)")}}else if(!!i||!!s)return CoreMail.unrecoverableError("Unexpected state in updateResponseError",n.requestStatus);SC.debug(e+"setting ERROR on RequestStatus"),n.requestStatus.setError(r)},destroyResponseSuccess:function(e,t,n,r){var i=n.storeKeyArray,s=n.storeKeys,o=n.selectedIndexSet,u;s&&s.length===1&&n.deleteType===CoreMail.Request.DELETE_FOLDER&&(u=t.materializeRecord(s[0])),(n.deleteType===CoreMail.Request.DELETE_MSG_SINGLE||n.deleteType===CoreMail.Request.MOVE_MSG_SINGLE||n.deleteType===CoreMail.Request.DELETE_MSG_SELECTION||n.deleteType===CoreMail.Request.MOVE_MSG_SELECTION)&&this.updateVipUnreadCounts(t,n.folderGuid,s,CoreMail.DECREMENT,{unreadDiff:n.unreadDiff},YES),s&&this._notifyStore(t,t.dataSourceDidDestroy,s);if(n.deleteType===CoreMail.Request.EMPTY_FOLDER)i&&i.get("length")>0&&i.removeAt(0,i.get("length"
)),this._zeroizeFolderCounts(t,n.folderGuid),CoreMail.saveDeletedUids(r.result);else if(n.deleteType===CoreMail.Request.DELETE_FOLDER){CoreMail.FOLDER_PERF&&n.folderParent&&(n.folderParent.get("kids").removeObject(u),CoreMail.washClean(t,n.folderParent.get("storeKey")));var a=SC.Query.local(CoreMail.Folder,"parent = {p}",{p:u}),f=t.find(a);if(f)if(f.get("length")===0){var l=n.folderParent;while(l&&l.get("role")===CoreMail.FOLDER_ROLE_GHOST&&l.get("kids").get("length")===0){var c=l;l=l.get("parent"),CoreMail.FOLDER_PERF&&l&&(l.get("kids").removeObject(c),CoreMail.washClean(t,l.get("storeKey")));var h=c.get("guid");SC.debug("destroying childless ghost folder: "+h),t.pushDestroy(CoreMail.Folder,h)}}else{var p;n.folderParent?p={guid:n.folderParent.get("guid")+"/"+n.folderName,name:n.folderName,role:CoreMail.FOLDER_ROLE_GHOST,parent:n.folderParent.get("guid"),kids:[]}:p={guid:"folder:"+n.folderName,name:n.folderName,role:CoreMail.FOLDER_ROLE_GHOST,kids:[]};var d,v;if(CoreMail.FOLDER_PERF){d=f.get("length");for(v=0;v<d;v++)p.kids.push(f.objectAt(v).get("guid"))}if(!t.pushRetrieve(CoreMail.Folder,p.guid,p))n.requestStatus.setError({errorCode:CoreMail.ERROR_PUSH_RETRIEVE});else{var m=CoreMail.findLocalFolder(p.guid);if(m){if(CoreMail.FOLDER_PERF&&n.folderParent){var g=n.folderParent;g.get("kids").pushObject(m),CoreMail.washClean(t,g.get("storeKey"))}d=f.get("length");for(v=0;v<d;v++){var y=f.objectAt(v);SC.debug("assigning new ghost parent ["+m.get("guid")+"] to child: "+y.get("guid")),y.parent=m,CoreMail.washClean(t,y.get("storeKey"))}}}}}else if(n.deleteType===CoreMail.Request.DELETE_MSG_SINGLE||
n.deleteType===CoreMail.Request.MOVE_MSG_SINGLE){var b=i?i.indexOf(s[0]):-1;b>=0?i.removeAt(b):SC.warn("Ignoring delete index: "+b),CoreMail.updateFolderCount(n.folderGuid,"total",CoreMail.DECREMENT,1),CoreMail.updateFolderCount(n.folderGuid,CoreMail.MESSAGE_FLAG_UNREAD,CoreMail.DECREMENT,n.unreadDiff);if(window.WHAT_TYPE.isMail()&&n.messageGuid){var w=CoreMail.get("global").getChildWindowsForMessage(n.messageGuid);try{w&&w.forEach(function(e){e.CoreMail.store.pushDestroy(e.CoreMail.Message,n.messageGuid)||SC.warn("Could not destroy: "+n.messageGuid),e.SC.RunLoop.begin().end()})}catch(E){SC.warn('Caught exception "%@" while updating child window properties'.fmt(E))}}}else if(n.deleteType===CoreMail.Request.DELETE_MSG_SELECTION||n.deleteType===CoreMail.Request.MOVE_MSG_SELECTION)i.removeAt(o),CoreMail.updateFolderCount(n.folderGuid,CoreMail.MESSAGE_FLAG_UNREAD,CoreMail.DECREMENT,n.unreadDiff),CoreMail.updateFolderCount(n.folderGuid,"total",CoreMail.DECREMENT,o.get("length")),CoreMail.saveDeletedUids(r.result);else if(n.deleteType===CoreMail.Request.DELETE_MSG_PUSH){var S=SC.Query.local(CoreMail.Message,"guid = {messageGuid}",{messageGuid:n.messageGuid}),x=t.find(S);if(x&&x.get("length")===1){var T=x.objectAt(0).get("storeKey"),N=i.indexOf(T);if(n.index!==N)return SC.debug("specified index ("+n.index+") "+"does not match storeKeyArray index ("+N+") "+"for message "+n.messageGuid),CoreMail.ERROR_SANITY_DELETE;t.pushDestroy(CoreMail.Message,n.messageGuid)||SC.warn("DELETE_MSG_PUSH unable to destroy: "+n.messageGuid),i.removeAt(N)}else i.removeAt(n.index)}n.requestStatus&&n.requestStatus
.setSuccess();switch(n.deleteType){case CoreMail.Request.DELETE_MSG_SINGLE:case CoreMail.Request.DELETE_MSG_SELECTION:SC.Benchmark.end("perfDeleteMessage");break;case CoreMail.Request.MOVE_MSG_SINGLE:case CoreMail.Request.MOVE_MSG_SELECTION:SC.Benchmark.end("perfMoveMessage")}},destroyResponseError:function(e,t,n,r){SC.debug(e+"error = "+r.errorCode+"/"+r.errorMessage);var i=n.storeKeys;i&&this._notifyStore(t,t.dataSourceDidError,i),SC.debug(e+"setting ERROR on RequestStatus"),n.requestStatus.setError(r),n.deleteType===CoreMail.Request.DELETE_ACCOUNT?(t.pushDestroy(null,null,i),CoreMail.store.refreshRecord(CoreMail.ServerPreferences,CoreMail.SERVER_PREFS_GUID)):n.deleteType===CoreMail.Request.DELETE_FOLDER?CoreMail.resyncFolderList("delete folder failed"):CoreMail.resyncMessageList(n.folderGuid,"delete/move message failed");switch(n.deleteType){case CoreMail.Request.DELETE_MSG_SINGLE:case CoreMail.Request.DELETE_MSG_SELECTION:SC.Benchmark.end("perfDeleteMessage");break;case CoreMail.Request.MOVE_MSG_SINGLE:case CoreMail.Request.MOVE_MSG_SELECTION:SC.Benchmark.end("perfMoveMessage")}},_handleMessageParts:function(e,t){var n=t.parts;if(n){for(var r=0;r<n.length;r++){var i=e.find(CoreMail.MessagePart,n[r].guid);i.set("content",n[r].content),i.serverResponded=YES,n[r].content.indexOf("cid:")>0&&i.set("hasCID",YES);var s=i.get("storeKey");CoreMail.washClean(e,s)}t.parts=undefined}t.message=t.guid},_notifyStore:function(e,t,n){if(n instanceof Array){var r=n.length;for(var i=0;i<r;i++)t.call(e,n[i])}else t.call(e,n)},_fixChildFolders:function(e,t,n){if(!n)return YES;var r=CoreMail.
findLocalFolder(t),i=n.get("length");for(var s=0;s<i;s++){var o=n.objectAt(s),u=o.get("children"),a=o.toHash(),f=a.guid.split("/"),l=f[f.length-1],c=t+"/"+l;a.guid=c,a.parent=t,e.pushDestroy(CoreMail.Folder,o.get("guid"))||SC.warn("fixChildFolders unable to destroy: "+o.get("guid"));if(!e.pushRetrieve(CoreMail.Folder,c,a))return NO;if(CoreMail.FOLDER_PERF){var h=CoreMail.findLocalFolder(c);h&&(r.get("kids").pushObject(h),CoreMail.washClean(e,r.get("storeKey")))}if(!this._fixChildFolders(e,a.guid,u))return NO}return YES},_deleteJunk:function(e,t,n,r,i){if(e===CoreMail.Request.UPDATE_MSG_SINGLE){if(n){var s=n.indexOf(r[0]);if(s>=0)n.removeAt(s,1);else{var o="CoreMail.AbstractDataSource._deleteJunk : storekey "+r[0]+" not found in storeKeyArray ["+n.toArray()+"] of folder "+n.folderGuid;CoreMail.errorHandler.logErrorTrap(o)}}CoreMail.updateFolderCount(n.folderGuid,"total",CoreMail.DECREMENT,1)}else e===CoreMail.Request.UPDATE_MSG_ALL?(n&&n.removeAt(0,n.get("length")),this._zeroizeFolderCounts(t,n.folderGuid)):e===CoreMail.Request.UPDATE_MSG_SELECTION&&(n.removeAt(i),CoreMail.updateFolderCount(n.folderGuid,"total",CoreMail.DECREMENT,i.get("length")))},_zeroizeFolderCounts:function(e,t){CoreMail.updateFolderCount(t,"total",CoreMail.SET,0),CoreMail.updateFolderCount(t,CoreMail.MESSAGE_FLAG_UNREAD,CoreMail.SET,0)},updateVipUnreadCounts:function(e,t,n,r,i,s){var o=CoreMail.findLocalFolder(t);if(!o)return;var u=o.get("role"),a=o.get("sha1"),f=0,l,c,h,p,d,v,m=CoreMail.getPath("implicitPreferences.vipUnreadCounts"),g=i.unreadDiff;if(u===CoreMail.FOLDER_ROLE_INBOX){if(!n){CoreMail.folderDataSource
.getVipBadges(e);return}n.forEach(function(t){var n=e.materializeRecord(t);if(n.get("isFromVipSender")===YES){var o=VipSender.isVip(n.get("fromAddress"));if(o){l=o.get("vipFolder");if(l){h=l.get("guid"),p=l.get("sha1");if(r===CoreMail.INCREMENT)m[p]++;else{if(r!==CoreMail.DECREMENT||!(s===NO&&i[t]===YES||s===YES&&n.get("unread")===YES))return;m[p]--}CoreMail.updateFolderCount(h,CoreMail.MESSAGE_FLAG_UNREAD,r,1),f++}else CoreMail.errorHandler.logErrorTrap("CoreMail.AbstractDataSource.updateVipUnreadCounts : VIP exists, but corresponding VIP folder doesn't exist")}}}),l&&(c=l.get("parent"))}else u===CoreMail.FOLDER_ROLE_VIP&&(CoreMail.updateFolderCount(CoreMail.INBOX_GUID,CoreMail.MESSAGE_FLAG_UNREAD,r,g),r===CoreMail.INCREMENT?m[a]+=g:m[a]-=g,c=o.get("parent"),f=g);c&&(d=c.get("guid"),v=c.get("sha1"),CoreMail.updateFolderCount(d,CoreMail.MESSAGE_FLAG_UNREAD,r,f),r===CoreMail.INCREMENT?m[v]+=f:r===CoreMail.DECREMENT&&(m[v]-=f)),CoreMail.saveImplicitPreference("vipUnreadCounts",m)}}),CoreMail.AccountDataSource=CoreMail.AbstractDataSource.extend({URL:CoreMail.Request.BASE_URL+"account",fetch:function(e,t){return!t||!t.isLocal()?(SC.warn("illegal non-local account query"),NO):(e.dataSourceDidFetchQuery(t),YES)},createRecord:function(e,t,n){var r=CoreMail.Request.getRequest(this.URL),i=CoreMail.Request.postBody("put",r);return i.params=n.accountHash,r.set("body",i),r.notify(this,CoreMail.sharedResponse,{caller:"AccountDataSource",method:"createResponse",store:e,storeKeys:[t],params:n}),r.send(),YES},updateRecord:function(e,t,n){if(n.updateType!==CoreMail.Request.UPDATE_ACCOUNT)return CoreMail
.unrecoverableError("Expected updateType of ACCOUNT",n.requestStatus),NO;var r=e.materializeRecord(t).toHash();!r.type&&r.recordType&&(r.type=r.recordType,r.recordType=undefined);var i=CoreMail.Request.getRequest(this.URL),s=CoreMail.Request.postBody("update",i);return s.params=r,i.set("body",s),i.notify(this,CoreMail.sharedResponse,{caller:"AccountDataSource",method:"updateResponse",store:e,storeKeys:[t],params:n}),i.send(),YES},destroyRecord:function(e,t,n){if(n.deleteType!==CoreMail.Request.DELETE_ACCOUNT)return CoreMail.unrecoverableError("Expected deleteType of DELETE_ACCOUNT",n.requestStatus),NO;var r=e.materializeRecord(t),i=CoreMail.Request.getRequest(this.URL),s=CoreMail.Request.postBody("delete",i);return s.params={type:r.get("type"),guid:r.get("guid")},i.set("body",s),i.notify(this,CoreMail.sharedResponse,{caller:"AccountDataSource",method:"destroyResponse",store:e,storeKeys:[t],params:n}),i.send(),YES}}),CoreMail.accountDataSource=CoreMail.AccountDataSource.create(),CoreMail.blacklistDataSource=CoreMail.AbstractDataSource.extend({URL:CoreMail.Request.BASE_URL+"blacklist",fetch:function(e,t){SC.warn("CoreMail.blacklistDataSource.fetch");if(!t||!t.isLocal())return SC.warn("Illegal local query"),NO;if(t.get("conditions"))return e.dataSourceDidFetchQuery(t),YES;var n,r;return r=CoreMail.Request.getRequest(this.URL),n=CoreMail.Request.postBody("list",r),r.set("body",n),r.notify(this,CoreMail.sharedResponse,{caller:"blacklistDataSource",method:"fetchResponse",store:e,params:{query:t}}),r.send(),YES},fetchResponseSuccess:function(e,t,n,r){var i=n.query,s=r.result;s&&t.loadRecords
(i.recordType,s.records),t.dataSourceDidFetchQuery(i)},fetchResponseError:function(e,t,n,r){SC.warn(e+"error = "+r.errorCode+"/"+r.errorMessage),t.dataSourceDidErrorQuery(n.query)},updateRecords:function(e,t,n){var r=CoreMail.Request.getRequest(this.URL),i=CoreMail.Request.postBody("put",r);return i.params=n.records,r.set("body",i),r.notify(this,CoreMail.sharedResponse,{caller:"blacklistDataSource",method:"updateResponse",store:e,storeKeys:t,params:n}),r.send(),YES},updateResponseSuccess:function(e,t,n){n.requestStatus&&n.requestStatus.setSuccess()},updateResponseError:function(e,t,n,r){SC.debug(e+"error = "+r.errorCode+"/"+r.errorMessage),n.requestStatus&&n.requestStatus.setError(r)}}).create(),CoreMail.DataSource=SC.DataSource.extend({_source:function(e,t){if(e===CoreMail.Folder)return CoreMail.folderDataSource;if(e===CoreMail.Message)return CoreMail.messageListDataSource;if(e===CoreMail.MessageDetail)return CoreMail.messageDetailDataSource;if(e===CoreMail.ImplicitPreferences)return CoreMail.implicitPreferencesDataSource;if(e===CoreMail.ServerPreferences)return CoreMail.serverPreferencesDataSource;if(e===CoreMail.RuleList)return CoreMail.ruleListDataSource;if(e===CoreMail.IdentityAccount||e===CoreMail.AliasAccount)return CoreMail.accountDataSource;if(e===CoreMail.VipSender)return CoreMail.vipSenderDataSource;if(e===CoreMail.Blacklist)return CoreMail.blacklistDataSource;var n;return t&&(n=t.requestStatus),CoreMail.unrecoverableError("Could not determine datasource for recordType: "+e,n),NO},fetch:function(e,t){var n;t&&(n=t.get("parameters"))&&(n=n._internalUse);var r=this.
_source(t.get("recordType"),n);return r?r.fetch(e,t):NO},retrieveRecord:function(e,t,n){var r=this._source(e.recordTypeFor(t));return r?r.retrieveRecord(e,t,n):NO},retrieveRecords:function(e,t,n){var r=this._source(e.recordTypeFor(t.objectAt(0)));return r?r.retrieveRecords(e,t,n):NO},createRecord:function(e,t,n){var r=this._source(e.recordTypeFor(t),n);return r?r.createRecord(e,t,n):NO},updateRecord:function(e,t,n){if(n&&n.washClean===YES)return e.dataSourceDidComplete(t),YES;var r=this._source(e.recordTypeFor(t),n);return r?r.updateRecord(e,t,n):NO},updateRecords:function(e,t,n){if(t&&t.length===1&&n&&n.washClean===YES)return this.updateRecord(e,t[0],n);var r=this._source(e.recordTypeFor(t.objectAt(0)),n);return r?r.updateRecords(e,t,n):NO},destroyRecord:function(e,t,n){var r=this._source(e.recordTypeFor(t),n);return r?r.destroyRecord(e,t,n):NO},destroyRecords:function(e,t,n){var r=this._source(e.recordTypeFor(t.objectAt(0)),n);return r?r.destroyRecords(e,t,n):NO}}),CoreMail.dataSource=CoreMail.DataSource.create(),CoreMail.FolderDataSource=CoreMail.AbstractDataSource.extend({URL:CoreMail.Request.BASE_URL+"folder",_isGetVipBadgesRequestInProgress:NO,fetch:function(e,t){if(!t||!t.isLocal())return SC.warn("Illegal local folder query"),NO;if(t.get("conditions"))return e.dataSourceDidFetchQuery(t),YES;var n=CoreMail.Request.getRequest(this.URL),r=CoreMail.Request.postBody("list",n);return n.set("body",r),n.notify(this,CoreMail.sharedResponse,{caller:"FolderDataSource",method:"localFetchResponse",store:e,params:{query:t}}),n.send(),YES},localFetchResponseSuccess:function(e,t,n,r)
{var i=n.query,s=r.result;if(!s||s.length<0)t.dataSourceDidErrorQuery(i);else{if(i.recordType===CoreMail.Folder){this.setKids(s);if(CoreMail.get("isResyncFolderListInProgress")===YES){var o=CoreMail.store.find(CoreMail.Folder),u=o.get("length");for(var a=0,f;a<u;a++)f=o.objectAt(a),CoreMail.store.pushDestroy(CoreMail.Folder,f.get("guid"))||SC.warn("CoreMail.resyncFolderList could not destroy: "+f.get("guid"))}}var l=[],c,h,p=i.recordType,d;s.forEach(function(e){c=e.guid,h=t.readStatus(p.storeKeyFor(c)),h&SC.Record.BUSY?(d={viewMessageState:ViewMessage.get("state")},window.WHAT_TYPE.isMail()&&(d.folderListState=FolderList.get("state"),d.messageListState=MessageList.get("state")),CoreMail.errorHandler.recordStat("_STAT_FETCH_FOLDER_INTERNAL_INCONSISTENCY",d)):l.push(e)}),t.loadRecords(p,l),t.dataSourceDidFetchQuery(i),i.recordType===CoreMail.Folder&&(this.updateUnreadCount(s),CoreMail.get("isResyncFolderListInProgress")===YES&&CoreMail.set("isResyncFolderListInProgress",NO))}},localFetchResponseError:function(e,t,n,r){var i=n.query;SC.debug(e+"error = "+r.errorCode+"/"+r.errorMessage),i.recordType===CoreMail.Folder&&CoreMail.setIfChanged("isResyncFolderListInProgress",NO),t.dataSourceDidErrorQuery(n.query)},createRecord:function(e,t,n){var r=e.materializeRecord(t),i=CoreMail.Request.getRequest(this.URL),s=CoreMail.Request.postBody("put",i),o=r.get("parent");return o?s.params={name:r.get("name"),parent:o.get("guid")}:s.params={name:r.get("name"),parent:null},i.set("body",s),i.notify(this,CoreMail.sharedResponse,{caller:"FolderDataSource",method:"createResponse",store:e,storeKeys
:[t],params:n}),i.send(),YES},updateRecord:function(e,t,n){var r=e.materializeRecord(t),i=r.get("guid"),s=CoreMail.Request.getRequest(this.URL),o;if(n.updateType===CoreMail.Request.RENAME_FOLDER)o=CoreMail.Request.postBody("rename",s),o.params={guid:i,name:r.get("name")};else{if(n.updateType!==CoreMail.Request.MOVE_FOLDER)return CoreMail.unrecoverableError("Unexpected update type: "+n.updateType,n.requestStatus),NO;o=CoreMail.Request.postBody("move",s);var u=r.get("parent");u?o.params={guid:i,parent:u.get("guid")}:o.params={guid:i,parent:null}}var a=CoreMail.messageListDataSource.storeKeyArray(i);return s.set("body",o),s.notify(this,CoreMail.sharedResponse,{caller:"FolderDataSource",method:"updateResponse",store:e,storeKeys:[t],params:n,skArray:a}),s.send(),YES},destroyRecord:function(e,t,n){if(n.deleteType!==CoreMail.Request.DELETE_FOLDER)return CoreMail.unrecoverableError("Expected deleteType of DELETE_FOLDER when destroying a folder record",n.requestStatus),NO;var r=e.materializeRecord(t),i=CoreMail.Request.getRequest(this.URL),s=CoreMail.Request.postBody("delete",i);return s.params={guid:r.get("guid")},i.set("body",s),i.notify(this,CoreMail.sharedResponse,{caller:"FolderDataSource",method:"destroyResponse",store:e,storeKeys:[t],params:n}),i.send(),YES},setKids:function(e){var t={},n=e.length,r,i,s,o,u,a,f,l,c;e=e.sortProperty("parent","name");for(var h=0;h<n;h++){f=e[h],l=f.guid;if(f.role!==CoreMail.FOLDER_ROLE_VIP)if(l.indexOf("/")<0)f.kids=[],t[l]=f;else{var p=t[f.parent];if(!p){var d=f,v=l;while(YES){var m=d.parent,g,y=m.substring(7),b=y.lastIndexOf("/");b>=0?(g="folder:"+
y.substring(0,b),b++):b=0,y=y.substring(b);var w={type:"CoreMail.Folder",guid:m,name:y,parent:g,role:CoreMail.FOLDER_ROLE_GHOST,kids:[]};SC.debug("creating ghost folder:\n	guid: "+m+",\n"+"	name: "+y+",\n"+"	parent: "+g+",\n"+"	role: "+CoreMail.FOLDER_ROLE_GHOST),t[m]=w,e.push(w);if(!(m.indexOf("/")>0&&!t[g])){if(w.parent){var E=t[w.parent];E.kids.push(w.guid)}p=w;break}w.kids.push(v),t[v]=d,d=w,v=m}}p.kids||(p.kids=[]),p.kids.push(l),f.role!==CoreMail.FOLDER_ROLE_GHOST&&(f.kids=[]),t[l]=f}else f.parent?t[f.parent].kids.push(l):(f.kids=[],t[l]=f);c=f.role;switch(c){case CoreMail.FOLDER_ROLE_INBOX:r=f;break;case CoreMail.FOLDER_ROLE_DRAFTS:i=f;break;case CoreMail.FOLDER_ROLE_SENT:s=f;break;case CoreMail.FOLDER_ROLE_TRASH:u=f;break;case CoreMail.FOLDER_ROLE_ARCHIVE:o=f;break;case CoreMail.FOLDER_ROLE_JUNK:a=f;break;default:}}this._detachParent(s,t),this._detachParent(u,t)},_detachParent:function(e,t){if(!e)return;var n=e.parent;if(n){var r=t[n],i=r.kids,s,o=[];for(var u=0,a=i.length;u<a;u++)s=i[u],s!==e.guid&&o.push(s);r.realKids=r.kids,r.kids=o,e.parent=undefined,e.realParent=n}},updateUnreadCount:function(e){var t=NO,n,r,i=CoreMail.getPath("implicitPreferences.vipUnreadCounts"),s;if(e){var o,u,a=e.length,f;for(var l=0;l<a;l++)o=e[l],o.type==="CoreMail.Folder"&&(o.unread&&CoreMail.updateFolderCount(o.guid,CoreMail.MESSAGE_FLAG_UNREAD,CoreMail.SET,o.unread),o.total&&CoreMail.updateFolderCount(o.guid,"total",CoreMail.SET,o.total),o.role===CoreMail.FOLDER_ROLE_VIP&&(u=CoreMail.Folder.getSha1FromGuid(o.guid),f=i[u],o.parent?((f!==null||f!==undefined)&&CoreMail.updateFolderCount(o
.guid,CoreMail.MESSAGE_FLAG_UNREAD,CoreMail.SET,f),t=YES):(n=o.guid,r=u,s=f)))}window.WHAT_TYPE.isMail()===YES&&(t===YES?this.getVipBadges(CoreMail.store):(s=0,i={},r&&(i[r]=0),CoreMail.saveImplicitPreference("vipUnreadCounts",i)),n&&s>=0&&CoreMail.updateFolderCount(n,CoreMail.MESSAGE_FLAG_UNREAD,CoreMail.SET,s))},addSubfolder:function(e,t,n){var r,i=0,s=[],o=0;r=e.get("kids"),i=r.get("length");for(var u=0;u<i;u++)s.push(r.objectAt(u));s.pushObject(t),s=s.sortProperty("name"),o=s.indexOf(t),r.insertAt(o,t),CoreMail.washClean(n,e.get("storeKey"))},getVipBadges:function(e,t){var n;t?n=t:n="all folders";if(this._isGetVipBadgesRequestInProgress===NO){var r=CoreMail.Request.getRequest(this.URL),i=CoreMail.Request.postBody("unseen_vip",r),s;t&&(s={guid:t},i.params=s),SC.debug("CoreMail.FolderDataSource.getVipBadges: Sending unseen_vip request for "+n),r.set("body",i),r.set("timeout",CoreMail.INTERVAL_UNSEEN_VIP_TIMEOUT),r.notify(this,CoreMail.sharedResponse,{caller:"FolderListDataSource",method:"getVipBadges",store:e,params:s}),r.send(),this._isGetVipBadgesRequestInProgress=YES}else SC.warn("CoreMail.FolderDataSource.getVipBadges: unseen_vip request already in progress. Not sending request for "+n)},getVipBadgesSuccess:function(e,t,n,r){var i=r.result,s;this._isGetVipBadgesRequestInProgress=NO;if(i){var o,u,a,f,l,c=i.length,h;if(n&&n.guid){if(c!==1){SC.warn("CoreMail.FolderDataSource.getVipBadges: Unexpected length");return}var p=i[0];f=p.guid,a=p.unread;if(n.guid!==f||a===null||a===undefined||p.role!==CoreMail.FOLDER_ROLE_VIP){SC.warn("CoreMail.FolderDataSource.getVipBadges: Unexpected response"
);return}s=CoreMail.getPath("implicitPreferences.vipUnreadCounts"),u=CoreMail.findLocalFolder(f);if(u===null){SC.warn("CoreMail.FolderDataSource.getVipBadges: cannot find folder: "+f);return}if(a<0){SC.warn("CoreMail.FolderDataSource.getVipBadges invalid new unread count: "+a);return}h=u.get("unread");if(h===a){SC.debug("CoreMail.FolderDataSource.getVipBadges: No change in unread count");return}l=u.get("sha1"),u.set("unread",a),CoreMail.washClean(t,u.get("storeKey")),s[l]=a;var d=u.get("parent"),v=d.get("sha1"),m=d.get("unread");m=m+a-h,m<0&&(SC.warn("CoreMail.FolderDataSource.getVipBadges: calculatedinvalid new aggregate vip folder unread count "+m),m=0),d.set("unread",m),CoreMail.washClean(t,d.get("storeKey")),s[v]=m}else{s={};for(var g=0;g<c;g++){o=i[g],a=o.unread,f=o.guid;if((a!==null||a!==undefined)&&o.role===CoreMail.FOLDER_ROLE_VIP){u=CoreMail.findLocalFolder(f);if(u===null){SC.warn("CoreMail.FolderDataSource.getVipBadges: cannot find folder: "+f);continue}if(a<0){SC.warn("CoreMail.FolderDataSource.getVipBadges invalid new unread count: "+a);continue}l=u.get("sha1"),h=u.get("unread"),s[l]=a;if(h===a)continue;u.set("unread",a),CoreMail.washClean(t,u.get("storeKey"))}}}CoreMail.saveImplicitPreference("vipUnreadCounts",s)}},getVipBadgesError:function(e,t,n,r){this._isGetVipBadgesRequestInProgress=NO;var i="errorCode="+r.errorCode;r.errorMessage&&(i+="/errorMessage="+r.errorMessage),SC.warn("CoreMail.FolderDataSource.getVipBadgesError: Folder badges could not be updated: "+i)}}),CoreMail.folderDataSource=CoreMail.FolderDataSource.create(),CoreMail.ImplicitPreferencesDataSource=
CoreMail.AbstractDataSource.extend({userDefaults:undefined,implicitPrefsKey:"implicitPrefs"+CK.get("persistAfterLogoutSuffix"),retrieveRecord:function(e,t){var n=CloudOS.getUser(),r=n.get("dsid"),i=n.get("appleId"),s=this.get("implicitPrefsKey"),o;try{this.userDefaults=SC.UserDefaults.create({appDomain:"iCloud_Mail",userDomain:SHA1.hex_sha1(i+"+"+r)}),o=this.userDefaults.readDefault(s)}catch(u){SC.warn("Error reading implicit preferences: "+u),CoreMail.errorHandler.recordStat("_count_USER_DEFAULTS_FAILED_TO_LOAD",{errorMessage:""+u})}return o||(o={guid:CoreMail.IMPLICIT_PREFS_GUID}),o.view&&o.view==="3Pane"&&(o.view="3Column"),e.dataSourceDidComplete(t,o),YES},updateRecord:function(e,t,n){if(!this.userDefaults)SC.warn("No user defaults, ignoring update call");else{var r=e.readEditableDataHash(t);try{this.userDefaults.writeDefault(this.get("implicitPrefsKey"),r)}catch(i){SC.warn("Could not save implicit prefs: "+i),CoreMail.errorHandler.recordStat("_count_USER_DEFAULTS_FAILED_TO_SAVE",{errorMessage:""+i})}}return this._notifyStore(e,e.dataSourceDidComplete,t),n.requestStatus.setSuccess(),YES},updateRecords:function(e,t,n){return t.length===1?this.updateRecord(e,t[0],n):(CoreMail.unrecoverableError("Expected single ImplicitPreferences storeKey",n.requestStatus),NO)}}),CoreMail.implicitPreferencesDataSource=CoreMail.ImplicitPreferencesDataSource.create(),CoreMail.MessageDetailDataSource=CoreMail.AbstractDataSource.extend({URL:CoreMail.Request.BASE_URL+"message",fetch:function(e,t){return t.isLocal()?(e.dataSourceDidFetchQuery(t),YES):(SC.warn("Illegal remote query for MessageDetail"
),NO)},retrieveRecord:function(e,t,n){if(!n)return SC.warn("Expected message guid"),NO;var r=e.find(CoreMail.Message,n);if(!r)return SC.warn("Can not find CoreMail.Message record with guid: "+n),NO;var i=[],s="",o="",u="",a=r.get("mimeParts"),f=a.get("length");for(var l=0;l<f;l++){var c=a.objectAt(l);o=c.get("name"),u=c.get("datatype"),o&&u&&(s=o.split(".").lastObject().toLowerCase(),u=u.toLowerCase());if(c.get("serverResponded")!==YES)if(c.get("isAttachment")===NO){if((c.get("contentCode")&CoreMail.TEXT)>0)i.push(c.get("guid"));else if((c.get("contentCode")&CoreMail.OTHER)>0){var h=c.get("contentDisposition");h&&h.search(/TEXT/i)>-1&&i.push(c.get("guid"))}}else c.get("isMailDrop")===NO&&s&&(s==="vcf"||s==="vcard")&&(u==="text/vcard"||u==="text/directory"||u==="text/x-vcard"||u==="text/directory;profile=vcard")&&i.push(c.get("guid"))}var p=CoreMail.Request.getRequest(this.URL),d=CoreMail.Request.postBody("get",p);return d.params={guid:n,parts:i},p.set("body",d),p.notify(this,CoreMail.sharedResponse,{caller:"MessageDetailDataSource",method:"retrieveResponse",store:e,storeKeys:t,params:{id:n,numPartsRequested:i.length}}),p.send(),YES},retrieveRecords:function(e,t,n){return!n||n.length!==1?(SC.warn("Expected message guid"),NO):this.retrieveRecord(e,t[0],n[0])},listUnsubscribe:function(e,t,n){var r=CoreMail.Request.getRequest(this.URL),i=CoreMail.Request.postBody("unsubscribe",r);i.params={listUnsubscribeKey:t,listUnsubscribeStatus:n},r.set("body",i),r.notify(this,CoreMail.sharedResponse,{caller:"MessageDetailDataSource",method:"listUnsubscribeResponse",params:{listUnsubscribeKey
:t,listUnsubscribeStatus:n,requestStatus:e}}),r.send()},listUnsubscribeResponseSuccess:function(e,t,n){var r=n.requestStatus;r.setSuccess()},listUnsubscribeResponseError:function(e,t,n){this.listUnsubscribeResponseSuccess(e,t,n)}}),CoreMail.messageDetailDataSource=CoreMail.MessageDetailDataSource.create(),CoreMail.MessageListDataSource=CoreMail.AbstractDataSource.extend({URL:CoreMail.Request.BASE_URL+"message",INDEX:1,GUID:2,_storeKeyArrays:{},storeKeyArray:function(e){return this._storeKeyArrays[e]},getBadges:function(e){var t=CoreMail.Request.getRequest(CoreMail.folderDataSource.URL),n=CoreMail.Request.postBody("list",t);t.set("body",n),t.notify(this,CoreMail.sharedResponse,{caller:"MessageListDataSource",method:"getBadges",store:e}),t.send()},getBadgesSuccess:function(e,t,n,r){var i=r.result;if(i){var s,o=i.length;for(var u=0;u<o;u++)s=i[u],s.type==="CoreMail.Folder"&&(s.unread&&CoreMail.updateFolderCount(s.guid,CoreMail.MESSAGE_FLAG_UNREAD,CoreMail.SET,s.unread),s.total&&CoreMail.updateFolderCount(s.guid,"total",CoreMail.SET,s.total))}},getBadgesError:function(e,t,n,r){var i="errorCode="+r.errorCode;r.errorMessage&&(i+="/errorMessage="+r.errorMessage),SC.warn("Folder badges will not be updated: "+i)},fetch:function(e,t){if(t.isLocal())return e.dataSourceDidFetchQuery(t),YES;var n=t.get("parameters");if(!n||!n._internalUse||!n._internalUse.requestStatus)return SC.warn("Invalid params"),NO;var r=n._internalUse;if(!r.loadType||!n.guid||!n.sorttype||!n.sortorder)return CoreMail.unrecoverableError("Missing parameter",n.requestStatus),NO;var i=this._getStoreKeyArray(n.guid,r.requestStatus
,r.loadType,n.searchtype,n.searchtext,n.filters,r.fromSparseArrayDelegate);n._internalUse=undefined;var s=CoreMail.Request.getRequest(this.URL);s.set("requestType",CoreMail.Request.MSGLIST);var o=CoreMail.Request.postBody("list",s);n.requesttype==="index"&&(n.selected=this.toImapIndex(n.selected)),n.rollbackslot=CoreMail.SLOT,o.params=n;var u=r.requestStatus;return u.pending||(u.pending={}),u.pending[o.id]=YES,s.set("body",o),s.notify(this,CoreMail.sharedResponse,{caller:"MessageListDataSource",method:"fetchResponse",store:e,params:{query:t,requestStatus:r.requestStatus,loadType:r.loadType,fromSparseArrayDelegate:r.fromSparseArrayDelegate},skArray:i}),s.send(),YES},updateRecord:function(e,t,n){var r=e.materializeRecord(t),i=r.getPath("folder.guid");if(!i)return NO;var s=this.storeKeyArray(i),o=CoreMail.Request.getRequest(this.URL),u;return n.newValue===YES?u=CoreMail.Request.postBody("setflag",o):u=CoreMail.Request.postBody("clrflag",o),u.params={folder:i,uids:[r.get("uid")],flag:n.propertyName},u.params.rollbackslot=CoreMail.SLOT,o.set("body",u),o.notify(this,CoreMail.sharedResponse,{caller:"MessageListDataSource",method:"updateResponse",store:e,storeKeys:[t],params:n,skArray:s}),o.send(),YES},updateRecords:function(e,t,n){if(!n||!n.requestStatus)return SC.warn("Invalid params"),NO;if(n.newValue===undefined||n.newValue===null)return CoreMail.unrecoverableError("Expected newValue",n.requestStatus),NO;if(n.updateType!==CoreMail.Request.UPDATE_MSG_SINGLE&&n.updateType!==CoreMail.Request.UPDATE_MSG_SELECTION&&n.updateType!==CoreMail.Request.UPDATE_MSG_ALL)return CoreMail.unrecoverableError
("Invalid updateType: "+n.updateType,n.requestStatus),NO;if(n.updateType===CoreMail.Request.UPDATE_MSG_SELECTION&&!n.selectedIndexSet)return CoreMail.unrecoverableError("Expected selectedIndexSet",n.requestStatus),NO;var r;if(!t)r=n.folderGuid;else{var i=e.materializeRecord(t[0]);r=i.getPath("folder.guid")}if(!r)return NO;var s=this.storeKeyArray(r),o,u,a,f,l;if(n.updateType===CoreMail.Request.UPDATE_MSG_ALL)u=this.INDEX,o="ALL";else{if(n.updateType===CoreMail.Request.UPDATE_MSG_SINGLE||(a=n.selectedIndexSet.get("length"))===1)return this.updateRecord(e,t[0],n);if(a===t.length){u=this.GUID,o=[];for(var c=0;c<t.length;c++)o.push(e.materializeRecord(t[c]).get("uid"))}else if(CoreMail.HACK_SEARCH&&(s.loadType&CoreMail.Request.SEARCH)>0)u=this.GUID,o=[],n.selectedIndexSet.forEachRange(function(e,t){for(var n=0;n<t;n++)o.push(s.searchUIDs[n])},this);else{u=this.INDEX,o=this._serializeSelections(n.selectedIndexSet);var h=e.find(CoreMail.ImplicitPreferences,CoreMail.IMPLICIT_PREFS_GUID);f=h.get("messageSortBy"),l=h.get("messageSortAscending")?"ascending":"descending"}}var p=CoreMail.Request.getRequest(this.URL),d;return n.newValue===YES?d=CoreMail.Request.postBody("setflag",p):d=CoreMail.Request.postBody("clrflag",p),u===this.GUID?d.params={folder:r,uids:o,flag:n.propertyName}:d.params={folder:r,indexes:o,flag:n.propertyName,sorttype:f,sortorder:l,searchtype:s.searchtype,searchtext:s.searchtext},d.params.rollbackslot=CoreMail.SLOT,p.set("body",d),p.notify(this,CoreMail.sharedResponse,{caller:"MessageListDataSource",method:"updateResponse",store:e,storeKeys:t,params:n,skArray:s}),p.
send(),YES},destroyRecord:function(e,t,n){var r=CoreMail.Request.getRequest(this.URL),i=e.materializeRecord(t),s;n.deleteType===CoreMail.Request.MOVE_MSG_SINGLE||n.deleteType===CoreMail.Request.MOVE_MSG_SELECTION?(SC.Benchmark.start("perfMoveMessage"),s=CoreMail.Request.postBody("move",r),s.params={folder:n.folderGuid,dest:n.destFolderGuid,uids:[i.get("uid")]}):(SC.Benchmark.start("perfDeleteMessage"),s=CoreMail.Request.postBody("delete",r),s.params={folder:n.folderGuid,uids:[i.get("uid")]});var o=this.storeKeyArray(n.folderGuid);return s.params.rollbackslot=CoreMail.SLOT,r.set("body",s),r.notify(this,CoreMail.sharedResponse,{caller:"MessageListDataSource",method:"destroyResponse",store:e,storeKeys:[t],params:n,skArray:o}),r.send(),YES},destroyRecords:function(e,t,n){if(!n||!n.requestStatus)return SC.warn("Invalid params"),NO;if(!n.folderGuid)return CoreMail.unrecoverableError("Expected folderGuid",n.requestStatus),NO;if(n.deleteType!==CoreMail.Request.DELETE_MSG_SINGLE&&n.deleteType!==CoreMail.Request.DELETE_MSG_SELECTION&&n.deleteType!==CoreMail.Request.MOVE_MSG_SINGLE&&n.deleteType!==CoreMail.Request.MOVE_MSG_SELECTION&&n.deleteType!==CoreMail.Request.EMPTY_FOLDER&&n.deleteType!==CoreMail.Request.DELETE_FOLDER)return CoreMail.unrecoverableError("Invalid deleteType: "+n.deleteType,n.requestStatus),NO;if(n.deleteType!==CoreMail.Request.MOVE_MSG_SINGLE&&n.deleteType!==CoreMail.Request.MOVE_MSG_SELECTION||!!n.destFolderGuid){if(n.deleteType!==CoreMail.Request.DELETE_MSG_SELECTION&&n.deleteType!==CoreMail.Request.MOVE_MSG_SELECTION||!!n.selectedIndexSet){var r=this.storeKeyArray
(n.folderGuid),i,s,o,u,a;if(n.deleteType===CoreMail.Request.EMPTY_FOLDER)s=this.INDEX,i="ALL";else{if(n.deleteType===CoreMail.Request.DELETE_MSG_SINGLE||n.deleteType===CoreMail.Request.MOVE_MSG_SINGLE||(o=n.selectedIndexSet.get("length"))===1)return this.destroyRecord(e,t[0],n);if(o===t.length){s=this.GUID,i=[];for(var f=0;f<t.length;f++)i.push(e.materializeRecord(t[f]).get("uid"))}else if(CoreMail.HACK_SEARCH&&r&&(r.loadType&CoreMail.Request.SEARCH)>0)s=this.GUID,i=[],n.selectedIndexSet.forEachRange(function(e,t){for(var n=0;n<t;n++)i.push(r.searchUIDs[n])},this);else{s=this.INDEX,i=this._serializeSelections(n.selectedIndexSet);var l=e.find(CoreMail.ImplicitPreferences,CoreMail.IMPLICIT_PREFS_GUID);u=l.get("messageSortBy"),a=l.get("messageSortAscending")?"ascending":"descending"}}var c=CoreMail.Request.getRequest(this.URL),h;return n.deleteType===CoreMail.Request.MOVE_MSG_SINGLE||n.deleteType===CoreMail.Request.MOVE_MSG_SELECTION?(SC.Benchmark.start("perfMoveMessage"),h=CoreMail.Request.postBody("move",c),h.params={dest:n.destFolderGuid}):(SC.Benchmark.start("perfDeleteMessage"),h=CoreMail.Request.postBody("delete",c),h.params={}),h.params.folder=n.folderGuid,s===this.GUID?h.params.uids=i:(h.params.indexes=i,h.params.sorttype=u,h.params.sortorder=a,r&&(h.params.searchtype=r.searchtype,h.params.searchtext=r.searchtext)),h.params.rollbackslot=CoreMail.SLOT,c.set("body",h),c.notify(this,CoreMail.sharedResponse,{caller:"MessageListDataSource",method:"destroyResponse",store:e,storeKeys:t,params:n,skArray:r}),c.send(),YES}return CoreMail.unrecoverableError("Expected selectedIndexSet"
,n.requestStatus),NO}return CoreMail.unrecoverableError("Expected destFolderGuid",n.requestStatus),NO},pushStart:function(e){var t=e.operation.charAt(0),n=e.folderGuid,r=n.split(":")[1],i="message:"+r+"/"+e.msgUid,s=FolderList.getPath("foldersTreeController.selection"),o,u,a,f=NO;if(s){o=s.get("firstObject"),u=o.get("guid"),a=o.get("role");if(n===CoreMail.INBOX_GUID&&a===CoreMail.FOLDER_ROLE_VIP&&o.get("parent")!==null)SC.debug("Process push for vip"),f=YES;else if(n===CoreMail.INBOX_GUID&&a!==CoreMail.FOLDER_ROLE_INBOX&&a!==CoreMail.FODLER_ROLE_VIP)return this._checkPushForVipBadges(i)}if(!CoreMail.folderSelected(n)&&f===NO)return SC.debug("Ignoring push for unselected folder "+n),CoreMail.PUSH_FINISHED;f===YES&&(n=u);var l=this.storeKeyArray(n);if(!l)return SC.debug("Ignoring push because message list for "+n+" not loaded"),CoreMail.PUSH_FINISHED;if(CoreMail.HACK_SEARCH&&l&&(l.loadType&CoreMail.Request.SEARCH)>0)return SC.debug("Ignoring push ("+t+") for message: "+i+" while searching"),CoreMail.PUSH_FINISHED;if(t==="A")return f&&(this._pendingPushAddVip=YES,n=CoreMail.INBOX_GUID),this.pushAdd(n,i,l,e);if(t==="D"){var c=i,h;f===YES&&(h=CoreMail.findLocalFolder(n),i="message:"+n.substr(7)+"/"+e.msgUid);for(var p=0;CoreMail.DELETED_GUIDS&&p<CoreMail.DELETED_GUIDS.length;p++)if(CoreMail.DELETED_GUIDS[p]===i)return SC.debug("Ignoring push delete for guid: "+i),CoreMail.PUSH_FINISHED;for(p=0;CoreMail.DELETED_UIDS&&p<CoreMail.DELETED_UIDS.length;p++){var d=CoreMail.DELETED_UIDS[p];if(d.folder===n){d.deletedArray||(d.deletedArray=d.deletedUids.split(","));var v=d.deletedArray.length
;for(var m=0;m<v;m++)if(e.msgUid===d.deletedArray[m])return SC.debug("Ignoring push delete for uid: "+i),CoreMail.PUSH_FINISHED}}return f===YES?this.pushVipDelete(n,c,l,e):this.pushDelete(n,i,l,e)}if(t==="F"||t==="f"||t==="G"||t==="g"||t==="H"||t==="h"||t==="J"||t==="j"||t==="R"||t==="r")return f===YES?this.pushVipFlag(n,i,e):this.pushFlag(n,i,l,e)},pushAdd:function(e,t,n,r){var i;if(r.result)return this.pushAddResponseSuccess("MessageListDataSource.pushAdd",CoreMail.store,null,r),CoreMail.PUSH_FINISHED;var s=CoreMail.store.find(CoreMail.ImplicitPreferences,CoreMail.IMPLICIT_PREFS_GUID),o=CoreMail.Request.getRequest(this.URL),u=CoreMail.Request.postBody("list",o);return u.params={sorttype:s.get("messageSortBy"),sortorder:s.get("messageSortAscending")?"ascending":"descending",searchtype:null,searchtext:null,rollbackslot:CoreMail.SLOT,requesttype:"guid",selected:t,count:1,guid:e},i=FolderList.getSelectedFolder().get("filterCriteria"),i.get("enabled")&&(u.params.filters={unread:i.get("unread"),flagged:i.get("flagged"),toMe:i.get("toMe"),ccMe:i.get("ccMe"),withAttachments:i.get("withAttachments"),fromVip:i.get("fromVip")}),o.set("body",u),o.notify(this,CoreMail.sharedResponse,{caller:"MessageDetailDataSource",method:"pushAddResponse",store:CoreMail.store}),o.send(),CoreMail.PUSH_PENDING},pushAddVip:function(e,t){var n=CoreMail.store.find(CoreMail.ImplicitPreferences,CoreMail.IMPLICIT_PREFS_GUID),r=CoreMail.Request.getRequest(this.URL),i=CoreMail.Request.postBody("list",r);return i.params={sorttype:n.get("messageSortBy"),sortorder:n.get("messageSortAscending")?"ascending":"descending"
,searchtype:null,searchtext:null,rollbackslot:CoreMail.SLOT,requesttype:"guid",selected:t,count:1,guid:e},r.set("body",i),r.notify(this,CoreMail.sharedResponse,{caller:"MessageDetailDataSource",method:"pushAddResponse",store:CoreMail.store}),r.send(),this._pendingPushAddVip=NO,CoreMail.PUSH_PENDING},pushDelete:function(e,t,n,r){var i=CoreMail.findLocalFolder(e);if(i&&i.get("total")!==r.totalMessages+1)return CoreMail.ERROR_SANITY_TOTAL;CoreMail.updateFolderCount(e,CoreMail.MESSAGE_FLAG_UNREAD,CoreMail.SET,r.inboxUnread);if(i.get("role")===CoreMail.FOLDER_ROLE_INBOX){var s=SC.Query.local(CoreMail.Message,"guid = {messageGuid}",{messageGuid:t}),o=CoreMail.store.find(s);if(o&&o.get("length")===1){var u=o.objectAt(0);if(u.get("unread")===YES&&u.get("isFromVipSender")===YES){var a=VipSender.isVip(u.get("fromAddress"));a&&CoreMail.updateUnreadForVipFolder(a.getPath("vipFolder.guid"),CoreMail.DECREMENT,1)}}}var f=this.destroyResponseSuccess("MessageList.pushDelete",CoreMail.store,{deleteType:CoreMail.Request.DELETE_MSG_PUSH,storeKeyArray:n,folderGuid:e,messageGuid:t,index:this.fromImapIndex(r.index)});return f?f:CoreMail.PUSH_FINISHED},pushVipDelete:function(e,t,n,r){var i=CoreMail.findLocalFolder(e);if(!i){SC.warn("pushVipDelete: could not find local folder:"+e);return}var s=CoreMail.store,o=SC.Query.local(CoreMail.Message,"guid = {messageGuid}",{messageGuid:t}),u=s.find(o),a=i.get("vipSender"),f;if(u&&u.get("length")===1){f=u.objectAt(0);var l=f.get("fromAddress"),c=a.get("addresses");if(c.contains(l)===NO)return f.get("unread")===YES&&f.get("isFromVipSender")===YES&&(a=VipSender
.isVip(l),a&&CoreMail.updateUnreadForVipFolder(a.getPath("vipFolder.guid"),CoreMail.DECREMENT,1)),CoreMail.PUSH_FINISHED}var h="message:"+e.substr(7)+"/"+r.msgUid;o=SC.Query.local(CoreMail.Message,"guid = {vipMessageGuid}",{vipMessageGuid:h}),u=s.find(o);if(u&&u.get("length")===1){f=u.objectAt(0);var p=f.get("storeKey"),d=n.indexOf(p),v=f.get("unread");if(!s.pushDestroy(CoreMail.Message,h))return SC.warn("DELETE_MSG_PUSH unable to destroy: "+h),CoreMail.PUSH_FINISHED;n.removeAt(d),v===YES&&CoreMail.updateUnreadForVipFolder(e,CoreMail.DECREMENT,1),CoreMail.updateFolderCount(e,"total",CoreMail.DECREMENT,1)}else CoreMail.folderDataSource.getVipBadges(s);return CoreMail.PUSH_FINISHED},pushFlag:function(e,t,n,r){var i=CoreMail.findLocalFolder(e);i&&i.get("total")!==r.totalMessages,CoreMail.updateFolderCount(e,CoreMail.MESSAGE_FLAG_UNREAD,CoreMail.SET,r.inboxUnread);var s=SC.Query.local(CoreMail.Message,"guid = {messageGuid}",{messageGuid:t}),o=CoreMail.store.find(s);if(o&&o.get("length")===1){var u=o.objectAt(0),a=n.indexOf(u.get("storeKey")),f=this.fromImapIndex(r.index);f!==a;var l=u.get("unread");u&&u.get("status")===SC.Record.READY_CLEAN?this._updateMessageFlagsFromPush(u,r.operation):SC.debug("_updateMessageFlagsFromPush ignored failed as the message is not in READY_CLEAN state");var c=u.get("unread");if(c!==l&&i.get("role")===CoreMail.FOLDER_ROLE_INBOX&&u.get("isFromVipSender")===YES){var h=u.get("fromAddress"),p=VipSender.isVip(h);if(p){var d;c===YES?d=CoreMail.INCREMENT:d=CoreMail.DECREMENT,CoreMail.updateUnreadForVipFolder(p.getPath("vipFolder.guid"),d,1)}}}else SC.debug
("Ignoring push for unloaded message "+t);return CoreMail.PUSH_FINISHED},pushVipFlag:function(e,t,n){var r=CoreMail.findLocalFolder(e);if(!r){SC.warn("pushVipFlag: Could not find local folder "+e);return}var i=SC.Query.local(CoreMail.Message,"guid = {messageGuid}",{messageGuid:t}),s=CoreMail.store.find(i);if(!s||s.get("length")!==1){var u=CoreMail.store.find(CoreMail.ImplicitPreferences,CoreMail.IMPLICIT_PREFS_GUID),a=CoreMail.Request.getRequest(this.URL),f=CoreMail.Request.postBody("list",a);return f.params={sorttype:u.get("messageSortBy"),sortorder:u.get("messageSortAscending")?"ascending":"descending",searchtype:null,searchtext:null,rollbackslot:CoreMail.SLOT,requesttype:"guid",selected:t,count:1,guid:CoreMail.INBOX_GUID},a.set("body",f),a.notify(this,CoreMail.sharedResponse,{caller:"MessageListDataSource",method:"pushVipFlagResponse",store:CoreMail.store,params:{inboxMessageGuid:t,vipFolderGuid:e,msgUid:n.msgUid,operation:n.operation}}),a.send(),CoreMail.PUSH_PENDING}var o=s.objectAt(0);return o.get("isFromVipSender")===NO?(SC.debug("Message not from vip sender. Ignore push"),CoreMail.PUSH_FINISHED):(this.updateVipMessageFlags(e,n.msgUid,n.operation),CoreMail.PUSH_FINISHED)},pushVipFlagResponseSuccess:function(e,t,n,r){var i=n.vipFolderGuid,s=n.msgUid;this._retrieveMetaData(r);var o=r.result;if(!o||o.length!==1){CoreMail.resyncMessageList(i,"empty result body");return}var u=o[0],a=CK.tokensParser.parseEmailAddress(u.from);a&&(a=a.get("emailId"));if(VipSender.isVip(a)===NO)return SC.warn("Message not from vip sender. Ignore push"),CoreMail.PUSH_FINISHED;this.updateVipMessageFlags
(i,s,n.operation)},pushVipFlagResponseError:function(e,t,n,r){SC.debug(e+"error = "+r.errorCode+"/"+r.errorMessage)},updateVipMessageFlags:function(e,t,n){var r="message:"+e.substr(7)+"/"+t,i=SC.Query.local(CoreMail.Message,"guid = {vipMessageGuid}",{vipMessageGuid:r}),s=CoreMail.store.find(i),o;if(!s||s.get("length")!==1){SC.warn("Unable to find message : "+r),CoreMail.folderDataSource.getVipBadges(CoreMail.store);return}o=s.objectAt(0);var u=o.get("unread");this._updateMessageFlagsFromPush(o,n);var a=o.get("unread"),f;a!==u&&(a===YES?f=CoreMail.INCREMENT:f=CoreMail.DECREMENT,CoreMail.updateUnreadForVipFolder(e,f,1))},fetchResponseSuccess:function(e,t,n,r){var i=n.storeKeyArray,s=n.query,o=n.loadType,u=n.fromSparseArrayDelegate,a=n.requestStatus,f,l=[],c=[],h=[],p=[];this._retrieveMetaData(r);var d=this._checkSlot(e,t,n,r,this.fetchResponseError);if(d!==CoreMail.SLOT_OK)return;var v=r.result;if(CoreMail.HACK_SEARCH&&(i.loadType&CoreMail.Request.SEARCH)>0){var m=i.get("length");m>0&&m!==r.totalmessages&&(SC.warn("MessageListDataSource resetting storeKeyArray"),i.resetLength=r.totalmessages,i.reset(),i.provideLength(r.totalmessages)),i.searchUIDs=[];var g=v.length;for(var y=0;y<g;y++)i.searchUIDs.push(v[y].uid)}var b=v.length;for(var w=0;w<b;w++){var E=v[w];f=E.folder;if(E.previewId)l.push(E.previewId);else if(!E.preview&&!E.previewId&&E.parts&&E.parts.length>0){var S=E.parts.length,x;for(var T=0;T<S;T++)x=E.parts[T],x.datatype.toLowerCase().indexOf("text/html")>=0&&c.push(E.guid)}var N=E.parts;if(N&&N.length>0){var C;for(var k=0,L=N.length;k<L;k++)C=N[k],C.orientationId&&h.push
(C.orientationId)}var A=E.messageId;(E.replied||E.forwarded)&&A&&p.push(A),this._addUndisclosedRecipientIfReqd(E),this._mimeParts(t,E)}var O=[];v.forEach(function(e){var t=e.guid,n=CoreMail.store.readStatus(CoreMail.Message.storeKeyFor(t));n&SC.Record.BUSY?CoreMail.errorHandler.logErrorTrap("CoreMail.AbstractDataSource.fetchResponseSuccess: Bad record guid: "+t+" status: "+n):O.push(e)});var M=t.loadRecords(CoreMail.Message,O),_={start:this.fromImapIndex(r.indexstart),length:v.length};u?i.provideObjectsInRange(_,M):(i.provideLength(r.totalmessages),i.provideObjectsInRange(_,M),t.loadQueryResults(s,i)),i.rangeRequestCompleted(_.start);if(o===CoreMail.Request.SORT_WITH_SELECTION||o===CoreMail.Request.SEARCH_WITH_SELECTION){var D=a.get("requestData");D&&(D.selectionIndex=_.start)}var P=i.folderGuid;CoreMail.updateFolderCount(P,"total",CoreMail.SET,r.totalmessages);var H=CoreMail.store.find(CoreMail.Folder,P);if(H){var B=H.get("role");B!==CoreMail.FOLDER_ROLE_VIP&&CoreMail.updateFolderCount(P,CoreMail.MESSAGE_FLAG_UNREAD,CoreMail.SET,r.unseen)}l.length>0&&this._sendSnippetRequest(t,f,l),p.length>0&&this._sendRelatedMessageRequest(t,p),h.length>0&&CoreMail.messagePartDataSource.sendImageOrientationRequest(t,f,h);var j=n.origRequest.get("body").id;this._updatePendingStatus(e,a,j)},fetchResponseError:function(e,t,n,r){SC.debug(e+"error = "+r.errorCode+"/"+r.errorMessage);var i=n.storeKeyArray,s=n.origRequest,o=n.query,u=n.fromSparseArrayDelegate,a=n.requestStatus;if(!u)t.dataSourceDidCancelQuery(o);else{var f=s.get("body").params,l={start:this.fromImapIndex(f.selected),length:f.count
};i.rangeRequestCompleted(l.start),i.objectsDidChangeInRange(l)}var c=s.get("body").id;this._updatePendingStatus(e,a,c,r)},toImapIndex:function(e){var t;return e instanceof String?t=parseInt(e,10)+1:t=e+1,t},fromImapIndex:function(e){var t=e===0?0:e-1;return t},_sendSnippetRequest:function(e,t,n){var r=CoreMail.Request.getRequest(CoreMail.messageListDataSource.URL),i=CoreMail.Request.postBody("preview",r);i.params={folder:t,ids:n},r.set("body",i),r.notify(this,CoreMail.sharedResponse,{caller:"MessageListDataSource",method:"snippetResponse",store:e}),r.send()},_sendRelatedMessageRequest:function(e,t){var n=CoreMail.Request.getRequest(CoreMail.messageListDataSource.URL),r=CoreMail.Request.postBody("relatedMessage",n);r.params={messageIds:t},n.set("body",r),n.notify(this,CoreMail.sharedResponse,{caller:"MessageListDataSource",method:"relatedMessageResponse",store:e}),n.send()},_updatePendingStatus:function(e,t,n,r){t.pending[n]===YES?t.pending[n]=undefined:SC.warn(e+" could not find pending request: "+n);var i=0,s=[];for(var o in t.pending)t.pending[o]&&(i++,s.push(o));i===0?r?(SC.debug(e+"setting ERROR on RequestStatus"),t.setError(r)):t.setSuccess():SC.debug(e+"RequestStatus still pending "+"("+i+" outstanding)\n	"+s)},pushAddResponseSuccess:function(e,t,n,r){this._retrieveMetaData(r);var i=this._checkSlot(e,t,n,r,this.pushAddResponseError);if(i!==CoreMail.SLOT_OK)return;var s=r.result,o=s[0];if(!s||s.length!==1){CoreMail.resyncMessageList(undefined,"empty result body");return}this._addUndisclosedRecipientIfReqd(o),this._mimeParts(t,o);var u=[],a,f,l=CoreMail.Message;s.forEach
(function(e){a=e.guid,f=t.readStatus(l.storeKeyFor(a)),f&SC.Record.BUSY?CoreMail.errorHandler.recordStat("_STAT_PUSH_MESSAGE_INTERNAL_INCONSISTENCY",{folderListState:FolderList.get("state"),messageListState:MessageList.get("state"),viewMessageState:ViewMessage.get("state")}):u.push(e)});var c=t.loadRecords(l,u),h=this.fromImapIndex(r.indexstart),p=o.folder,d=this.storeKeyArray(p);if(!this._pendingPushAddVip&&d){if(d.get("maxDefinedIndex")>=h)d.replace(h,0,c);else{var v=d.get("length");d.provideLength(v+1),d.provideObjectAtIndex(h,c[0])}SC.debug("MessageListDataSource.pushAddImpl added message at index "+h);if(d.get("length")!==r.totalmessages){CoreMail.resyncMessageList(p,CoreMail.ERROR_SANITY_TOTAL),CoreMail.folderDataSource.getVipBadges(t);return}}var m=CoreMail.findLocalFolder(p),g,y=CK.tokensParser.parseEmailAddress(o.from);y&&(y=y.get("emailId"));if(m){var b=m.get("role");CoreMail.updateFolderCount(p,"total",CoreMail.SET,r.totalmessages),b===CoreMail.FOLDER_ROLE_VIP?CoreMail.folderDataSource.getVipBadges(t,p):(CoreMail.updateFolderCount(p,CoreMail.MESSAGE_FLAG_UNREAD,CoreMail.SET,r.unseen),b===CoreMail.FOLDER_ROLE_INBOX&&!this._pendingPushAddVip&&o.unread===YES&&(g=VipSender.isVip(y),g&&CoreMail.updateUnreadForVipFolder(g.getPath("vipFolder.guid"),CoreMail.INCREMENT,1)))}if(this._pendingPushAddVip){var w=FolderList.getPath("foldersTreeController.selection.firstObject.guid"),E=CoreMail.findLocalFolder(w);if(E){g=E.get("vipSender");if(g){var S=g.get("addresses");if(S.contains(y)===NO)return o.unread===YES&&(g=VipSender.isVip(y),g&&CoreMail.updateUnreadForVipFolder(g.getPath
("vipFolder.guid"),CoreMail.INCREMENT,1)),CoreMail.PUSH_FINISHED;SC.debug("Sending VIP Push Add for folder:"+w);var x="message:"+w.substr(7)+"/"+o.uid;CoreMail._previousPendingStatus=CoreMail.PUSH_PENDING,this.pushAddVip(w,x)}}this._pendingPushAddVip=NO}},pushAddResponseError:function(e,t,n,r){SC.debug(e+"error = "+r.errorCode+"/"+r.errorMessage),CoreMail.resyncMessageList(undefined,r.errorCode)},snippetResponseSuccess:function(e,t,n,r){var i=r.result;if(!i){SC.debug("no snippet data found");return}var s=i.length;for(var o=0;o<s;o++){var u=t.find(CoreMail.Message,i[o].guid);u.set("computedPreview",i[o].preview)}},snippetResponseError:function(e,t,n,r){SC.debug(e+"error = "+r.errorCode+"/"+r.errorMessage)},relatedMessageResponseSuccess:function(e,t,n,r){var i,s,o,u,a,f;i=r.result;if(!i){SC.debug("no related message ids found");return}s=i.length;for(var l=0;l<s;l++)o=SC.Query.local(CoreMail.Message,"messageId = {messageId}",{messageId:i[l].messageId}),u=t.find(o),u&&u.length()>0&&(f=u.objectAt(0),f&&(f.set("relatedGUID",i[l].relatedGUID),a=f.get("storeKey"),CoreMail.washClean(t,a)))},relatedMessageResponseError:function(e,t,n,r){SC.debug(e+"error = "+r.errorCode+"/"+r.errorMessage)},timer:[],timerArg:[],sparseArrayDidRequestLength:function(e){return e.resetLength},sparseArrayDidRequestIndex:function(e,t){this.sparseArrayDidRequestRange(e,{start:t,length:1})},sparseArrayDidRequestRange:function(e,t){if(this.timer[0]&&this.timer[1]){var n=this.timer[1],r=this.timerArg[1];n.invalidate(),e.rangeRequestCompleted(r.start),SC.debug("Dropped range fetch: start = "+r.start)}this.timer[0
]&&(this.timer[1]=this.timer[0],this.timerArg[1]=this.timerArg[0]);var i={start:t.start,length:t.length};this.timerArg[0]=i,this.timer[0]=this.invokeLater(this._sparseArrayDidRequestRange,CoreMail.INTERVAL_MESSAGE_BATCH_FETCH,e,i)},_sparseArrayDidRequestRange:function(e,t){this.timerArg[1]&&this.timerArg[1].start===t.start?(this.timer[1]=null,this.timerArg[1]=null):(this.timer[0]=null,this.timerArg[0]=null);var n=CoreMail.store.find(CoreMail.ImplicitPreferences,CoreMail.IMPLICIT_PREFS_GUID),r=e.requestStatus;r.setPending(YES);var i={_internalUse:{requestStatus:e.requestStatus,loadType:e.loadType,fromSparseArrayDelegate:!0},guid:e.folderGuid,requesttype:"index",selected:t.start,count:t.length,searchtype:e.searchtype,searchtext:e.searchtext,sorttype:n.get("messageSortBy"),sortorder:n.get("messageSortAscending")?"ascending":"descending"};e.filters!==undefined&&(i.filters=e.filters),this.fetch(CoreMail.store,SC.Object.create({parameters:i,isLocal:function(){return!1}}))},sparseArrayShouldReplace:function(){return YES},sparseArrayDidReset:function(){},_getStoreKeyArray:function(e,t,n,r,i,s,o){var u=this._storeKeyArrays[e];if(!u||!o)u=this._storeKeyArrays[e]=CoreMail.MessageListSparseArray.array(),u.set("delegate",this),u.set("rangeWindowSize",CoreMail.Request.MESSAGE_LIST_BATCH_SIZE),u.folderGuid=e,u.requestStatus=t,u.loadType=n,u.searchtype=r,u.searchtext=i,u.filters=s;return u},_serializeSelections:function(e){var t=[];return e.forEachRange(function(e,n){e=this.toImapIndex(e);if(n===1)t.push(e.toString());else{var r=e+n-1;t.push(e.toString()+"-"+r.toString())}},this),t},_dataTypeToConstant
:function(e){var t=e.datatype.toLowerCase();t.indexOf("text/plain")===0?e.contentCode=CoreMail.TEXT_PLAIN:t.indexOf("text/html")===0?e.contentCode=CoreMail.TEXT_HTML:t.indexOf("text/")===0?e.contentCode=CoreMail.TEXT:t.indexOf("image/")===0?e.contentCode=CoreMail.IMAGE:t.indexOf("application/")===0?e.contentCode=CoreMail.APPLICATION:t.indexOf("video/")===0?e.contentCode=CoreMail.VIDEO:t.indexOf("audio/")===0?e.contentCode=CoreMail.AUDIO:t.indexOf("model/")===0?e.contentCode=CoreMail.MODEL:e.contentCode=CoreMail.OTHER},_addUndisclosedRecipientIfReqd:function(e){var t=e.to,n=t?t.length:0,r=e.cc,i=r?r.length:0,s=e.bcc,o=s?s.length:0;if(n===0&&i===0&&o===0){var u=CoreMail.findLocalFolder(e.folder),a=u?u.get("role"):null;a!==CoreMail.FOLDER_ROLE_DRAFTS&&(e.to=[CoreMail.UNDISCLOSED_RECIPIENTS_GUID])}},_mimeParts:function(e,t){var n=t.parts,r,i=0,s;if(n&&n.length>0){t.mimeParts=[];var o=[];for(var u=0;u<n.length;u++)r=n[u],this._dataTypeToConstant(r),o.push(r),t.mimeParts.push(r.guid),s=r.size,i=s?i+s:i,this._reportMessagePartStat(t.uid,r);this._reportMessageSizeStat(i);var a=e.storeKeyExists(CoreMail.MessagePart,o[0].guid)?YES:NO;a||e.loadRecords(CoreMail.MessagePart,o),t.parts=undefined}},_retrieveMetaData:function(e){var t=e.result,n=NO,r,i;if(t&&(i=t.length)>0)for(var s=0;s<i;s++){r=t[s];if(r.type==="CoreMail.MessageListMetaData"){n=YES;break}}n===YES&&(e.totalmessages=r.totalmessages,e.unseen=r.unseen,e.indexstart=r.indexstart,e.indexrange=r.indexrange,e.newslotnumber=r.newslotnumber,e.position=r.position,t.removeObject(r))},_checkSlot:function(e,t,n,r,i){var s=r.newslotnumber
,o=-1;if(s!==undefined&&s!==null){o=CoreMail.slotCheck(s,n);if(o===CoreMail.SLOT_OK)CoreMail.slotMove(s,e);else if(o===CoreMail.SLOT_DUPLICATE||o===CoreMail.SLOT_MISSED)i.call(this,e,t,n,{errorCode:o===CoreMail.SLOT_DUPLICATE?CoreMail.ERROR_SLOT_DUPLICATE:CoreMail.ERROR_SLOT_MISSED}),CoreMail.resyncFolderList("slot duplicate or missed")}return o},_updateMessageFlagsFromPush:function(e,t){var n=t.length,r;for(var i=0;i<n;i++)r=t.charAt(i),r==="F"?e.set("flagged",YES):r==="f"?e.set("flagged",NO):r==="G"?e.set("replied",YES):r==="g"?e.set("replied",NO):r==="H"?e.set("forwarded",YES):r==="h"?e.set("forwarded",NO):r==="J"?e.set("junk",YES):r==="j"?e.set("junk",NO):r==="R"?e.set("unread",NO):r==="r"&&e.set("unread",YES),CoreMail.washClean(CoreMail.store,e.get("storeKey"))},_checkPushForVipBadges:function(e){var t=SC.Query.local(CoreMail.Message,"guid = {messageGuid}",{messageGuid:e}),n=CoreMail.store,r=n.find(t);if(!r||r.get("length")!==1)return CoreMail.folderDataSource.getVipBadges(n),CoreMail.PUSH_PENDING;var i=r.objectAt(0);return i.get("isFromVipSender")===YES?(CoreMail.folderDataSource.getVipBadges(n),CoreMail.PUSH_PENDING):CoreMail.PUSH_FINISHED},_reportMessagePartStat:function(e,t){if(this._shouldReportMessageStat){var n=t.datatype;n&&(n=n.toLowerCase()),CoreMail.errorHandler.recordStat("_stat_incoming_msg_mime-parts",{dataType:n,size:t.size,isMailDrop:t.mailDropStreamingUrl?YES:NO,messageUID:e})}},_shouldReportMessageStat:function(){if(Math.random()*1e3<1)return SC.info("Message Stat reporting enabled."),YES;SC.info("Message Stat reporting throttled, not reporting.")}(),_reportMessageSizeStat
:function(e){this._shouldReportMessageStat&&CoreMail.errorHandler.recordStat("_stat_incoming_msg_size",{messageSize:e})},uploadMessage:function(e,t){var n,r;e&&e.name.substr(-4)===".eml"&&t?(t.indexOf("folder:/VIP")===0&&(t=CoreMail.INBOX_GUID),n=CoreMail.addServiceUrlDsidAndClientIdToUrl(this.URL+"?guid="+t),r=CoreMail.MailRequest.putUrl(n),r.header("Content-Type","message/rfc822"),r.notify(200,this,function(){return SC.debug("Uploaded %@ into %@".fmt(e.name,t)),YES}),r.notify(0,this,function(){return CoreMail.errorHandler.handleError({keyString:"MessageList.Debug.UploadFailed"}),YES}),r.send(e)):CoreMail.errorHandler.handleError({keyString:"MessageList.Debug.UploadFailed"})}}),CoreMail.messageListDataSource=CoreMail.MessageListDataSource.create(),CoreMail.MessageListSparseArray=SC.SparseArray.extend({maxDefinedIndex:function(){return this._sa_content?this._sa_content.get("length"):0}.property()}),CoreMail.messagePartDataSource=CoreMail.AbstractDataSource.extend({URL:CoreMail.Request.BASE_URL+"messagepart",CLOUDKIT_URL:CoreMail.Request.BASE_URL+"cloudkit",sendImageOrientationRequest:function(e,t,n){var r=CoreMail.Request.getRequest(CoreMail.messagePartDataSource.URL),i=CoreMail.Request.postBody("imageOrientation",r);i.params={folder:t,ids:n},r.set("body",i),r.notify(this,CoreMail.sharedResponse,{caller:"messagePartDataSource",method:"imageOrientationResponse",store:e}),r.send()},imageOrientationResponseSuccess:function(e,t,n,r){var i=r.result;if(!i){SC.debug("no image orientation data found");return}var s=i.length;for(var o=0;o<s;o++){var u=t.find(CoreMail.MessagePart,i[o].
guid);u&&(u.set("orientation",i[o].orientation),CoreMail.washClean(CoreMail.store,u.get("storeKey")))}CoreMail.messagePartDataSource.set("orientationData",Math.random())},imageOrientationResponseError:function(e,t,n,r){SC.debug(e+"error = "+r.errorCode+"/"+r.errorMessage)},releaseServerCache:function(e,t,n){if(n===NO)return;var r=CoreMail.Request.getRequest(CoreMail.messagePartDataSource.URL),i=CoreMail.Request.postBody("release",r);i.params={guids:t},r.set("body",i),r.notify(this,CoreMail.sharedResponse,{caller:"messagePartDataSource",method:"releaseServerCacheResponse",store:e}),r.send()},releaseServerCacheResponseSuccess:function(){return},releaseServerCacheResponseError:function(){return},_sendCloudkitRequest:function(e,t,n){var r=CoreMail.createPendingStatus();r.set("messageParts",e);var i=CoreMail.Request.getRequest(CoreMail.messagePartDataSource.CLOUDKIT_URL),s=CoreMail.Request.postBody(t,i),o=[];return e.forEach(function(e){o.push({type:"CoreMail.MessagePart",id:e.get("id"),guid:e.get("guid"),mailDropRecordId:e.get("mailDropRecordId"),size:e.get("size"),filename:e.get("filename")||e.get("name"),mailDropFileSignature:e.get("mailDropFileSignature"),mailDropUploadReceipt:e.get("mailDropUploadReceipt"),mailDropWrappingKey:e.get("mailDropWrappingKey"),mailDropReferenceSignature:e.get("mailDropReferenceSignature"),datatype:e.get("datatype")})}),s.params={attachments:o},i.set("body",s),i.notify(this,CoreMail.sharedResponse,{caller:"CoreMail.messagePartDataSource",method:n,store:CoreMail.store,params:{requestStatus:r}}),i.send(),r},fetchMailDropAuthTokens:function(e){return this
._sendCloudkitRequest(e,"getMailDropToken","fetchMailDropAuthTokens")},fetchMailDropAuthTokensResponseSuccess:function(e,t,n,r){var i=n.requestStatus;i.set("responseBody",r),i.setSuccess()},fetchMailDropAuthTokensResponseError:function(e,t,n,r){n.requestStatus.setError(r)},fetchFileDownloadUrl:function(e){return this._sendCloudkitRequest(e,"putMailDropRecord","fetchFileDownloadUrl")},fetchFileDownloadUrlResponseSuccess:function(e,t,n,r){var i=n.requestStatus;i.set("responseBody",r),i.setSuccess()},fetchFileDownloadUrlResponseError:function(e,t,n,r){n.requestStatus.setError(r)},sendMailDropRepublishRequest:function(e){return this._sendCloudkitRequest(e,"republishAttachments","sendMailDropRepublishRequest")},mailDropRepublishResponseSuccess:function(e,t,n,r){var i=n.requestStatus;i.set("responseBody",r),i.setSuccess()},mailDropRepublishResponseError:function(e,t,n,r){n.requestStatus.setError(r)},moveAttachmentToMailDrop:function(e){var t=CoreMail.createPendingStatus();t.set("messageParts",e);var n=CoreMail.Request.getRequest(CoreMail.messagePartDataSource.CLOUDKIT_URL),r=CoreMail.Request.postBody("moveAttachmentToMailDrop",n),i=[];return e.forEach(function(e){var t=CW.UUID();i.push({type:"CoreMail.MessagePart",guid:e.get("guid"),id:t,datatype:e.get("datatype"),size:e.get("size"),name:e.get("name")}),e.set("partIdentifier",t)}),r.params={attachments:i},n.set("body",r),n.notify(this,CoreMail.sharedResponse,{caller:"CoreMail.messagePartDataSource",method:"moveAttachmentToMailDrop",store:CoreMail.store,params:{requestStatus:t}}),n.send(),t},moveAttachmentToMailDropResponseSuccess:
function(e,t,n,r){var i=n.requestStatus;i.set("responseBody",r),i.setSuccess()},moveAttachmentToMailDropResponseError:function(e,t,n,r){n.requestStatus.setError(r)}}).create(),CoreMail.RuleListDataSource=CoreMail.AbstractDataSource.extend({URL:CoreMail.Request.BASE_URL+"rule",storeKeyArray:null,storeKeys:null,fetch:function(e,t){if(!t||!t.isLocal())return SC.warn("Illegal local folder query"),NO;if(t.get("conditions"))return e.dataSourceDidFetchQuery(t),YES;var n,r;return r=CoreMail.Request.getRequest(this.URL),n=CoreMail.Request.postBody("fetchFilters",r),r.set("body",n),r.notify(this,CoreMail.sharedRuleResponse,{caller:"ruleListDataSource",method:"fetchRulesResponse",store:e,params:{query:t}}),r.send(),YES},updateRecords:function(){var e=[],t=[],n,r=CoreMail.Request.getRequest(this.URL),i=CoreMail.Request.postBody("saveFilters",r),s=SC.Query.create({conditions:"ruleState != 'S'",recordType:CoreMail.RuleList}),o=CoreMail.store.find(s);if(o.get("length")===0){MailFilters.getPath("prefPaneViewObj").set("filtersResponse",1);return}for(var u=0;u<o.get("length");u++){var a=o.objectAt(u);if(a){var f=this._createRuleObj(a);if(f===NO){MailFilters.getPath("prefPaneViewObj").set("filtersResponse",1);return}n=a.get("ruleState"),n!=="A"&&f&&f.type!==undefined&&(e.push(f),n==="N"?CoreMail.errorHandler.recordStat("_rule_added",{ruleCriteriaPrefix:f.prefix,ruleAction:f.type}):n==="M"?CoreMail.errorHandler.recordStat("_rule_modified",{ruleCriteriaPrefix:f.prefix,ruleAction:f.type}):n==="D"&&CoreMail.errorHandler.recordStat("_rule_deleted",{ruleCriteriaPrefix:f.prefix,ruleAction:f.type}))}}
return t={rules:e},i.params=t,r.set("body",i),r.notify(this,CoreMail.sharedRuleResponse,{caller:"ruleListDataSource",method:"updateRulesResponse",store:CoreMail.store,params:e}),e.length>0&&r.send(),YES},updateRuleListSaveRecords:function(e){if(e)for(var t=0;t<e.length;t++)e[t].code==="200"&&CoreMail.store.find(CoreMail.RuleList,e[t].id).set("ruleState","S")},_createRuleObj:function(e){var t=e.get("ruleState"),n;if(t!=="S"&&t!=="A"){if(e.get("order")===0){var r={error:"order 0 issue with Rules"};return CoreMail.errorHandler.reportNonFatalError(r),CoreMail.errorHandler.recordStat("_count_RULES_ORDER_ZERO_ISSUE"),NO}return n=e.get("type"),n===MailFilters.INVALID_FOLDER_RULE_TYPE&&(n=MailFilters.SERVER_CODE_MOVE),{id:e.get("id"),type:n,prefix:e.get("prefix"),body:e.get("body"),action:e.get("action"),order:e.get("order"),ruleState:e.get("ruleState")}}},fetchRulesResponseSuccess:function(e,t,n,r){var i=r.result,s=i.rules.length,o={};for(var u=0;u<s;u++){var a=i.rules[u];a.type||(a.type="CoreMail.RuleList"),a.guid="ruleListGuid",o[a.type]||(o[a.type]=[]),o[a.type].push(a);var f=t.loadRecord(CoreMail.RuleList,a);CoreMail.washClean(t,f)}},fetchRulesResponseError:function(e,t,n,r){SC.debug(e+"error = "+r.errorCode+"/"+r.errorMessage),t.dataSourceDidErrorQuery(n.query)},updateRulesResponseError:function(e,t,n,r){SC.debug(e+"error = "+r.errorCode+"/"+r.errorMessage);var i;r.errorCode===Preferences.MAX_RULES_EXCEEDED?i=5:r.errorCode===Preferences.FORWARD_TO_OWN_ADDRESS?i=6:i=4,MailFilters.setPath("prefPaneViewObj.filtersResponse",i)},updateRulesResponseSuccess:function(e,t,n,r){var i;i=
r.result.rulesResult,i.length===1?i[0].code==="200"?MailFilters.getPath("prefPaneViewObj").set("filtersResponse",1):MailFilters.getPath("prefPaneViewObj").set("filtersResponse",4):i.length>1&&(this.updateRuleListSaveRecords(i.rulesResult),MailFilters.getPath("prefPaneViewObj").set("filtersResponse",4))}}),CoreMail.ruleListDataSource=CoreMail.RuleListDataSource.create(),CoreMail.ServerPreferencesDataSource=CoreMail.AbstractDataSource.extend({URL:CoreMail.Request.BASE_URL+"preference",retrieveRecord:function(e,t,n){var r=CoreMail.Request.getRequest(this.URL),i=CoreMail.Request.postBody("list",r);return this._accountPrefs||(this._accountPrefs=CloudOS.getAccountPreferences()),i.params={locale:this._accountPrefs.locale,timeZone:this._accountPrefs.timeZone},r.set("body",i),r.notify(this,CoreMail.sharedResponse,{caller:"ServerPreferencesDataSource",method:"retrieveResponse",store:e,storeKeys:t,params:{id:n}}),r.send(),YES},updateRecord:function(e,t,n){var r=e.materializeRecord(t).toHash();r=SC.clone(r);for(var i in r)i[0]==="~"&&delete r[i];var s=CoreMail.Request.getRequest(this.URL),o=CoreMail.Request.postBody("set",s);return o.params={prefs:r},s.set("body",o),s.notify(this,CoreMail.sharedResponse,{caller:"ServerPreferencesDataSource",method:"updateResponse",store:e,storeKeys:t,params:n}),s.send(),YES},updateRecords:function(e,t,n){return t.length===1?this.updateRecord(e,t[0],n):(CoreMail.unrecoverableError("Expected single store key when updating server prefs",n.requestStatus),NO)}}),CoreMail.serverPreferencesDataSource=CoreMail.ServerPreferencesDataSource.create(),CoreMail.vipSenderDataSource=
CoreMail.AbstractDataSource.extend({URL:CoreMail.Request.BASE_URL+"vipsender",_startUp:YES,createRecord:function(e,t,n){var r=CoreMail.Request.getRequest(this.URL),i=CoreMail.Request.postBody("put",r);return i.params=e.readDataHash(t),r.set("body",i),r.notify(this,CoreMail.sharedResponse,{caller:"VipSenderDataSource",method:"createResponse",store:e,storeKeys:[t],params:n}),r.send(),YES},fetch:function(e,t){if(!t||!t.isLocal())return SC.warn("Illegal local folder query"),NO;if(window.WHAT_TYPE.isMailChild()===YES&&this._startUp===YES)return e.dataSourceDidFetchQuery(t),this._startUp=NO,YES;if(t.get("conditions"))return e.dataSourceDidFetchQuery(t),YES;var n,r;return r=CoreMail.Request.getRequest(this.URL),n=CoreMail.Request.postBody("list",r),r.set("body",n),r.notify(this,CoreMail.sharedResponse,{caller:"VipSenderDataSource",method:"fetchResponse",store:e,params:{query:t}}),r.send(),YES},fetchResponseSuccess:function(e,t,n,r){var i=n.query,s,o,u;if(VipSender.get("isVipSendersListLoaded")===YES){var a=t.find(SC.Query.local(CoreMail.VipSender));u=a.get("length");for(o=0;o<u;o++)s=a.objectAt(o),t.pushDestroy(CoreMail.VipSender,s.get("guid"))||SC.warn("CoreMail.vipSenderDataSource.fetchResponseSuccess could not clear: "+s.get("guid"))}var f=r.result,l;for(o=0,u=f.length;o<u;o++){s=f[o];if(!s.addresses)continue;l=s.addresses;for(var c=0,h=l.length;c<h;c++)l[c]=l[c].toLowerCase()}t.loadRecords(i.recordType,f),t.dataSourceDidFetchQuery(i)},fetchResponseError:function(e,t,n,r){var i=n.query;SC.warn(e+"error = "+r.errorCode+"/"+r.errorMessage),t.loadRecords(i.recordType,[]),t.dataSourceDidFetchQuery
(i)},updateRecord:function(e,t,n){var r=e.readDataHash(t),i=CoreMail.Request.getRequest(this.URL),s=CoreMail.Request.postBody("update",i);s.params={guid:r.guid};if(n.updateType===CoreMail.Request.UPDATE_VIP_SENDER_ADDRESSES)s.params.addresses=r.addresses;else{if(n.updateType!==CoreMail.Request.UPDATE_VIP_SENDER_NAME)return CoreMail.unrecoverableError("Unexpected update type: "+n.updateType,n.requestStatus),NO;s.params.name=r.name}return i.set("body",s),i.notify(this,CoreMail.sharedResponse,{caller:"VipSenderDataSource",method:"updateResponse",store:e,storeKeys:[t],params:n}),i.send(),YES},updateResponseSuccess:function(e,t,n){var r=n.storeKeys;this._notifyStore(t,t.dataSourceDidComplete,r),n.requestStatus.setSuccess()},updateResponseError:function(e,t,n,r){SC.debug(e+"error = "+r.errorCode+"/"+r.errorMessage);var i=n.storeKeys,s=n.origValues;SC.debug(e+"reverting changes after server error");var o=n.propertyName,u=i[0],a=t.readStatus(u);if(a&SC.Record.BUSY){t.dataSourceDidCancel(u);var f=t.materializeRecord(u),l=s[o];f.set(o,l),SC.debug(f.get("guid")+": "+o+" reverted to "+l),CoreMail.washClean(t,u)}n.requestStatus.setError(r)},destroyRecord:function(e,t,n){if(n.deleteType!==CoreMail.Request.DELETE_VIP_SENDER)return CoreMail.unrecoverableError("Expected deleteType of DELETE_VIP_SENDER when destroying a vip sender record",n.requestStatus),NO;var r=e.readDataHash(t),i=e.materializeRecord(t),s=SC.browser;if(s.isIE||s.isEdge){var o=[],u=i.get("addresses");for(var a=0,f=u.length;a<f;a++)o[a]=u[a];r.addresses=o}var l=CoreMail.Request.getRequest(this.URL),c=CoreMail.Request.postBody
("delete",l);return c.params=r,l.set("body",c),l.notify(this,CoreMail.sharedResponse,{caller:"VipSenderDataSource",method:"destroyResponse",store:e,storeKeys:[t],params:n}),l.send(),YES},destroyResponseSuccess:function(e,t,n){this._notifyStore(t,t.dataSourceDidDestroy,n.storeKeys),n.requestStatus.setSuccess()},destroyResponseError:function(e,t,n,r){SC.debug(e+"error = "+r.errorCode+"/"+r.errorMessage);var i=n.storeKeys,s=t.readDataHash(i[0]);this._notifyStore(t,t.dataSourceDidDestroy,i),t.loadRecord(CoreMail.VipSender,s),SC.debug(e+"setting ERROR on RequestStatus"),n.requestStatus.setError(r)}}).create(),CoreMail.errorHandler=SC.Object.create({handleError:function(e){var t=e.keyCode,n=e.keyString,r=e.messageLocParams,i=e.descriptionLocParams,s=e.captionLocParams,o=e.image,u=e.rightButton,a=e.middleButton,f=e.leftButton,l=SC.Locale,c=l.currentLanguage.toLowerCase(),h=l.currentLocale.strings,p=SC.Logger;p.info("CoreMail.errorHandler.handleError: Params: "+JSON.stringify(e));if(!t&&!n){this.logErrorTrap("CoreMail.errorHandler.handleError: Invalid params passed :"+SC.json.encode(e));return}t&&!n&&(n=this.errorCodesKeys[t]),SC.empty(n)&&(this.logErrorTrap("CoreMail.errorHandler.handleError: Unknown keyCode :"+SC.json.encode(e)),n="Response.RequestFailed");var d="_Feedback."+n+".Title",v="_Feedback."+n+".Text",m="_Feedback."+n+".Caption";if(!h[d]){this.recordStat("_Missing_Localization_key",{keyName:d,currentLanguage:c}),this.logErrorTrap("CoreMail.errorHandler.handleError: Invalid LOC Key () : "+d);return}if(!h[v]){this.recordStat("_Missing_Localization_key",{keyName:v,currentLanguage
:c}),this.logErrorTrap("CoreMail.errorHandler.handleError: Invalid LOC Key () : "+v);return}var g=NO;h[m]&&(g=YES);var y="_count_"+n,b;return e.internalDescription&&(b={internalDescription:e.internalDescription}),CoreMail.errorHandler.recordStat(y,b),r?d=SC.String.loc(d,r):d=d.loc(),i?v=SC.String.loc(v,i):v=v.loc(),g&&s?m=SC.String.loc(m,s):m=m.loc(),c==="en-us"&&(p.info("CoreMail.errorHandler.handleError: Message: "+d),p.info("CoreMail.errorHandler.handleError: Description: "+v)),SC.typeOf(u)===SC.T_STRING&&(u={title:u.loc(),action:function(){CoreMail.errorHandler.removeErrorPane(this)}}),SC.typeOf(f)===SC.T_STRING&&(f={title:f.loc(),action:function(){CoreMail.errorHandler.removeErrorPane(this)}}),SC.typeOf(a)===SC.T_STRING&&(a={title:a.loc(),action:function(){CoreMail.errorHandler.removeErrorPane(this)}}),u||(u="_Common.Button.OK".loc()),o||(e.image={value:"mail-error-icon",width:67,height:65}),e.rightButton=u,e.middleButton=a,e.leftButton=f,e.message=d,e.description=v,g&&(e.caption=m),e.escapeHTML=YES,CW.Alert.show(e)},handleBootstrapError:function(e){if(this._isStopped)return;if(!Global.get("isAppReady"))return this._isStopped=YES,SC.error("Bootstrap error: %@".fmt(e)),window.Mail&&Mail.getPath("mainPage.loadingMainPane").remove(),this.recordStat("_startupfailed_"+e),Global.set("hasStartupFailed",YES),CloudOS.exit(2,SC.Logger.stringifyRecordedLogMessages())},logErrorTrap:function(e){var t;t="\n-------------------------------------------------------------------",t+="\n|	 ERROR_TRAP: "+e,t+="\n-------------------------------------------------------------------",t+="\n|	 APPLICATION STATES: "
,window.Contacts&&(t+="\n|	 Contact State : "+window.Contacts.currentState()),window.Attachments&&(t+="\n|	 Attachments State : "+window.Attachments.state),window.Compose&&(t+="\n|	 Compose State : "+window.Compose.state),window.FolderList&&(t+="\n|	 FolderList State : "+window.FolderList.state),window.VipSender&&(t+="\n|	 VipSender States : "+window.VipSender.currentStates()),window.Global&&(t+="\n|	 Global State : "+window.Global.state),window.MailFilters&&(t+="\n|	 MailFilters State : "+window.MailFilters.state),window.MainToolbar&&(t+="\n|	 MainToolbar State : "+window.MainToolbar.state),window.MessageList&&(t+="\n|	 MessageList State : "+window.MessageList.state),window.Preferences&&(t+="\n|	 Preferences State : "+window.Preferences.state),window.ReplyMenu&&(t+="\n|	 ReplyMenu State : "+window.ReplyMenu.state),window.RichTextEditor&&(t+="\n|	 RichTextEditor State : "+window.RichTextEditor.state),window.ViewMessage&&(t+="\n|	 ViewMessage State : "+window.ViewMessage.state),CoreMail.isResyncMessageListInProgress?t+="\n|	 Message list resync in progress? TRUE":t+="\n|	 Message list resync in progress? FALSE",CoreMail.isResyncFolderListInProgress?t+="\n|	 Folder list resync is in progress? TRUE":t+="\n|	 Folder list resync is in progress? FALSE",t+="\n-------------------------------------------------------------------\n",SC.debug(t)},removeErrorPane:function(e){var t=e.get("pane");t&&t.remove()},recordStat:function(e,t){var n="RECORD STAT: statName: "+e;t||(t={}),t.mailPartition=CoreMail.get("userPartition"),n=n+", Params: "+JSON.stringify(t),SC.debug(n),window.WHAT_TYPE.isMail
()?CloudOS.recordStat&&CloudOS.recordStat(e,t):COS.statsController.recordStat("mail",e,t)},reportNonFatalError:function(e){e.applicationLog=SC.Logger.stringifyRecordedLogMessages(),e.isFatal=NO,e.type="non-fatal client report",CK.errorCatcher.report(e)}}),SC.mixin(CoreMail.errorHandler,{errorCodesKeys:{"-1000":"CoreMail.InternalError",2221:"SendFailureGeneric",2301:"SendFailureAttachment",2302:"SendFailureMessageSizeTooLarge",11001:"FolderList.CreateFolder.ServerError",11002:"FolderList.MoveMessages.ServerError",11003:"FolderList.MoveFolder.ServerError",11004:"FolderList.MoveFolder.NameConflict",11005:"FolderList.DeleteFolder.ServerError",11006:"FolderList.RenameFolder.ServerError",11007:"FolderList.EmptyFolder.ServerError",11008:"FolderList.MarkAllAsRead.ServerError",11009:"FolderList.MarkAllAsUnread.ServerError",11010:"FolderList.LoadFailed.ServerError",11011:"FolderList.InvalidFolderName",11012:"FolderList.ReservedFolderName",11013:"FolderList.ExistingFolderName",11014:"FolderList.FolderNameTooLong",12001:"MessageList.UnableToDeleteMessages.ServerError",12002:"MessageList.UnableToArchiveMessages.ServerError",12003:"Messagelist.LoadFailed.ServerError",12006:"MessageList.UnableToDeleteMessage.ServerError",12004:"ReplyMenu.SendFailureGeneric",12005:"ReplyMenu.UnableToSaveAsDraft.ServerError",13001:"Preferences.FailedSavingPreferences",13002:"Preferences.RefreshError",13003:"Preferences.FailedDeletingAccounts",13004:"Preferences.FailedVacationSavingPreferences",13006:"AliasUnavailable",13007:"Preferences.DeleteAccount",13008:"Preferences.AccountAlreadyExists",13009:"Preferences.RefreshError"
,13010:"Preferences.AliasCapReached",13012:"Preferences.AccountNotSaved",13015:"Preferences.ServerGenericError",13016:"Preferences.MaxAliasDeleteConfirm",13017:"Preferences.IncompletePreferences",13018:"Preferences.AliasFullNameTooLong",13019:"Preferences.AliasError.SessionExpired",14001:"Compose.UnableToSaveAsDraft.ServerError",14002:"SendFailureGeneric",14004:"UnsavedDraft",14005:"SendWithoutSubject",14006:"MailMessage.NetworkError",14007:"Upload.UnsupportedFileFormat",14008:"Upload.ServerError",14009:"Send.BadTo",14010:"Send.BadCC",14011:"Send.BadBCC",14012:"Compose.UnableToSaveAsDraftMsgSizeTooLarge",15001:"ViewMessage.Load.ServerError",15002:"MessageView.ContactNotAdded.ServerError",15003:"MessageView.ContactNotImported.ServerError",16001:"Contacts.ServerErrorMessage",17e3:"Upload.SizeQuotaExceeded",17001:"Upload.QuotaExceeded",17002:"Upload.NotRegularFile",17003:"Upload.UnableToFetchDocumentFromRemoteServer",17004:"Upload.MailDrop.MissingServiceIdentities",17005:"Upload.MailDrop.StorageQuotaExceeded",17006:"Upload.MailDrop.CannotMigrateAttachments",17007:"Upload.MailDrop.StorageQuotaExceeded.MultipleFiles",17010:"Upload.AccessDenied",17011:"Upload.NetworkError",18001:"VipSender.ListFailed",18002:"VipSender.AddFailed",18003:"VipSender.UpdateNameFailed",18004:"VipSender.UpdateAddressFailed",18005:"VipSender.DeleteFailed","-2":"Response.RequestFailed","-3":"Response.RequestFailed","-4":"Response.RequestFailed",504:"Preferences.ServerConnectionError"}});var html4={};html4.atype={NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,HTML:12,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME
:8,CLASSES:9,FRAME_TARGET:10,MEDIA_QUERY:13},html4.atype=html4.atype,html4.ATTRIBS={"*::class":9,"*::data-expiration":0,"*::data-filename":0,"*::data-recordid":0,"*::data-size":0,"*::data-url":0,"*::dir":0,"*::id":4,"*::lang":0,"*::ontouchcancel":2,"*::ontouchend":2,"*::ontouchenter":2,"*::ontouchleave":2,"*::ontouchmove":2,"*::ontouchstart":2,"*::style":3,"*::title":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::rel":0,"a::rev":0,"a::shape":0,"a::tabindex":0,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::shape":0,"area::tabindex":0,"area::target":10,"bdo::dir":0,"blockquote::cite":1,"blockquote::type":0,"body::alink":0,"body::background":1,"body::bgcolor":0,"body::link":0,"body::text":0,"body::vlink":0,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::tabindex":0,"button::type":0,"button::value":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"del::cite":1,"del::datetime":0,"dir::compact":0,"div::align":0,"dl::compact":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::enctype":0,"form::method":0,"form::name":7,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::color":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0
,"img::hspace":0,"img::ismap":0,"img::longdesc":1,"img::name":7,"img::src":1,"img::usemap":0,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::checked":0,"input::disabled":0,"input::ismap":0,"input::maxlength":0,"input::name":8,"input::readonly":0,"input::size":0,"input::tabindex":0,"input::type":0,"input::usemap":0,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"ol::compact":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"p::align":0,"pre::width":0,"q::cite":1,"select::disabled":0,"select::multiple":0,"select::name":8,"select::size":0,"select::tabindex":0,"style::media":0,"style::type":0,"table::align":0,"table::background":1,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::height":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::background":1,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::cols":0,"textarea::disabled":0,"textarea::name":8,"textarea::readonly":0,"textarea::rows":0,"textarea::tabindex":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0
,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::height":0,"tr::valign":0,"ul::compact":0,"ul::type":0},html4.ATTRIBS=html4.ATTRIBS,html4.eflags={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128,VIRTUALIZED:256},html4.eflags=html4.eflags,html4.ELEMENTS={a:1,abbr:1,acronym:1,address:1,applet:273,area:3,article:0,aside:0,audio:272,b:1,base:275,basefont:275,bdi:0,bdo:1,big:1,blockquote:1,body:0,br:3,button:1,canvas:272,caption:1,center:1,cite:1,code:1,col:3,colgroup:1,command:274,data:272,datalist:272,dd:1,del:1,details:272,dfn:1,dialog:272,dir:1,div:1,dl:1,dt:1,em:1,fieldset:1,figcaption:0,figure:0,font:1,footer:0,form:1,frame:275,frameset:273,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,head:304,header:0,hgroup:0,hr:3,html:304,i:1,iframe:277,img:3,input:3,ins:1,isindex:275,kbd:1,keygen:274,label:1,legend:1,li:1,link:275,map:1,mark:0,menu:1,meta:275,meter:272,nav:0,nobr:0,noembed:276,noframes:277,noscript:277,object:273,ol:1,optgroup:1,option:1,output:272,p:1,param:275,pre:1,progress:272,q:1,s:1,samp:1,script:85,section:0,select:1,small:1,source:274,span:1,strike:1,strong:1,style:5,sub:1,summary:0,sup:1,table:1,tbody:1,td:1,textarea:9,tfoot:1,th:1,thead:1,time:0,title:281,tr:1,track:274,tt:1,u:1,ul:1,"var":1,video:272,wbr:2},html4.ELEMENTS=html4.ELEMENTS
,html4.ELEMENT_DOM_INTERFACES={a:"HTMLElement",abbr:"HTMLElement",acronym:"HTMLElement",address:"HTMLElement",applet:"HTMLElement",area:"HTMLElement",article:"HTMLElement",aside:"HTMLElement",audio:"HTMLAudioElement",b:"HTMLElement",base:"HTMLElement",basefont:"HTMLElement",bdi:"HTMLElement",bdo:"HTMLElement",big:"HTMLElement",blockquote:"HTMLElement",body:"HTMLElement",br:"HTMLElement",button:"HTMLElement",canvas:"HTMLCanvasElement",caption:"HTMLElement",center:"HTMLElement",cite:"HTMLElement",code:"HTMLElement",col:"HTMLElement",colgroup:"HTMLElement",command:"HTMLCommandElement",data:"HTMLElement",datalist:"HTMLDataListElement",dd:"HTMLElement",del:"HTMLElement",details:"HTMLDetailsElement",dfn:"HTMLElement",dialog:"HTMLDialogElement",dir:"HTMLElement",div:"HTMLElement",dl:"HTMLElement",dt:"HTMLElement",em:"HTMLElement",fieldset:"HTMLElement",figcaption:"HTMLElement",figure:"HTMLElement",font:"HTMLElement",footer:"HTMLElement",form:"HTMLElement",frame:"HTMLElement",frameset:"HTMLElement",h1:"HTMLElement",h2:"HTMLElement",h3:"HTMLElement",h4:"HTMLElement",h5:"HTMLElement",h6:"HTMLElement",head:"HTMLElement",header:"HTMLElement",hgroup:"HTMLElement",hr:"HTMLElement",html:"HTMLElement",i:"HTMLElement",iframe:"HTMLElement",img:"HTMLElement",input:"HTMLElement",ins:"HTMLElement",isindex:"HTMLElement",kbd:"HTMLElement",keygen:"HTMLKeygenElement",label:"HTMLElement",legend:"HTMLElement",li:"HTMLElement",link:"HTMLElement",map:"HTMLElement",mark:"HTMLElement",menu:"HTMLElement",meta:"HTMLElement",meter:"HTMLMeterElement",nav:"HTMLElement",nobr:"HTMLElement",noembed:"HTMLElement",
noframes:"HTMLElement",noscript:"HTMLElement",object:"HTMLElement",ol:"HTMLElement",optgroup:"HTMLElement",option:"HTMLElement",output:"HTMLOutputElement",p:"HTMLElement",param:"HTMLElement",pre:"HTMLElement",progress:"HTMLProgressElement",q:"HTMLElement",s:"HTMLElement",samp:"HTMLElement",script:"HTMLElement",section:"HTMLElement",select:"HTMLElement",small:"HTMLElement",source:"HTMLSourceElement",span:"HTMLElement",strike:"HTMLElement",strong:"HTMLElement",style:"HTMLElement",sub:"HTMLElement",summary:"HTMLElement",sup:"HTMLElement",table:"HTMLElement",tbody:"HTMLElement",td:"HTMLElement",textarea:"HTMLElement",tfoot:"HTMLElement",th:"HTMLElement",thead:"HTMLElement",time:"HTMLTimeElement",title:"HTMLElement",tr:"HTMLElement",track:"HTMLTrackElement",tt:"HTMLElement",u:"HTMLElement",ul:"HTMLElement","var":"HTMLElement",video:"HTMLVideoElement",wbr:"HTMLElement"},html4.ELEMENT_DOM_INTERFACES=html4.ELEMENT_DOM_INTERFACES,html4.ueffects={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2},html4.ueffects=html4.ueffects,html4.URIEFFECTS={"a::href":2},html4.URIEFFECTS=html4.URIEFFECTS,html4.ltypes={UNSANDBOXED:2,SANDBOXED:1,DATA:0},html4.ltypes=html4.ltypes,html4.LOADERTYPES={"a::href":2},html4.LOADERTYPES=html4.LOADERTYPES,typeof window!="undefined"&&(window.html4=html4);if("I".toLowerCase()!=="i")throw"I/i problem";var defs={};defs.TagPolicyDecision,defs.TagPolicy;var html=function(e){function f(e){if(i.hasOwnProperty(e))return i[e];var t=e.match(s);if(t)return String.fromCharCode(parseInt(t[1],10));if(!(t=e.match(o))){if(a&&u.test(e)){a.innerHTML="&"+e+";";var n=a.textContent;return i
[e]=n,n}return"&"+e+";"}return String.fromCharCode(parseInt(t[1],16))}function l(e,t){return f(t)}function h(e){return e.replace(c,"")}function v(e){return e.replace(p,l)}function E(e){return(""+e).replace(m,"&amp;").replace(y,"&lt;").replace(b,"&gt;").replace(w,"&#34;")}function S(e){return e.replace(g,"&amp;$1").replace(y,"&lt;").replace(b,"&gt;")}function C(e){var t={cdata:e.cdata||e.cdata,comment:e.comment||e.comment,endDoc:e.endDoc||e.endDoc,endTag:e.endTag||e.endTag,pcdata:e.pcdata||e.pcdata,rcdata:e.rcdata||e.rcdata,startDoc:e.startDoc||e.startDoc,startTag:e.startTag||e.startTag};return function(e,n){return L(e,t,n)}}function L(e,t,n){var r,i,s,o=M(e),u={noMoreGT:!1,noMoreEndComments:!1};O(t,o,0,u,n)}function A(e,t,n,r,i){return function(){O(e,t,n,r,i)}}function O(t,n,r,i,s){try{t.startDoc&&r==0&&t.startDoc(s);var o,u,a;for(var f=r,l=n.length;f<l;){var c=n[f++],h=n[f];switch(c){case"&":d.test(h)?(t.pcdata&&t.pcdata("&"+h,s,k,A(t,n,f,i,s)),f++):t.pcdata&&t.pcdata("&amp;",s,k,A(t,n,f,i,s));break;case"</":(o=/^([-\w:]+)[^\'\"]*/.exec(h))?o[0].length===h.length&&n[f+1]===">"?(f+=2,a=o[1].toLowerCase(),t.endTag&&t.endTag(a,s,k,A(t,n,f,i,s))):f=_(n,f,t,s,k,i):t.pcdata&&t.pcdata("&lt;/",s,k,A(t,n,f,i,s));break;case"<":if(o=/^([-\w:]+)\s*\/?/.exec(h))if(o[0].length===h.length&&n[f+1]===">"){f+=2,a=o[1].toLowerCase(),t.startTag&&t.startTag(a,[],s,k,A(t,n,f,i,s));var p=e.ELEMENTS[a];if(p&N){var v={name:a,next:f,eflags:p};f=H(n,v,t,s,k,i)}}else f=D(n,f,t,s,k,i);else t.pcdata&&t.pcdata("&lt;",s,k,A(t,n,f,i,s));break;case"<!--":if(!i.noMoreEndComments){for(u=f+1;u<l;u++)if(n[u]===">"&&/--$/
.test(n[u-1]))break;if(u<l){if(t.comment){var m=n.slice(f,u).join("");t.comment(m.substr(0,m.length-2),s,k,A(t,n,u+1,i,s))}f=u+1}else i.noMoreEndComments=!0}i.noMoreEndComments&&t.pcdata&&t.pcdata("&lt;!--",s,k,A(t,n,f,i,s));break;case"<!":if(!/^\w/.test(h))t.pcdata&&t.pcdata("&lt;!",s,k,A(t,n,f,i,s));else{if(!i.noMoreGT){for(u=f+1;u<l;u++)if(n[u]===">")break;u<l?f=u+1:i.noMoreGT=!0}i.noMoreGT&&t.pcdata&&t.pcdata("&lt;!",s,k,A(t,n,f,i,s))}break;case"<?":if(!i.noMoreGT){for(u=f+1;u<l;u++)if(n[u]===">")break;u<l?f=u+1:i.noMoreGT=!0}i.noMoreGT&&t.pcdata&&t.pcdata("&lt;?",s,k,A(t,n,f,i,s));break;case">":t.pcdata&&t.pcdata("&gt;",s,k,A(t,n,f,i,s));break;case"":break;default:t.pcdata&&t.pcdata(c,s,k,A(t,n,f,i,s))}}t.endDoc&&t.endDoc(s)}catch(g){if(g!==k)throw g}}function M(e){var t=/(<\/|<\!--|<[!?]|[&<>])/g;e+="";if(T)return e.split(t);var n=[],r=0,i;while((i=t.exec(e))!==null)n.push(e.substring(r,i.index)),n.push(i[0]),r=i.index+i[0].length;return n.push(e.substring(r)),n}function _(e,t,n,r,i,s){var o=B(e,t);return o?(n.endTag&&n.endTag(o.name,r,i,A(n,e,t,s,r)),o.next):e.length}function D(e,t,n,r,i,s){var o=B(e,t);return o?(n.startTag&&n.startTag(o.name,o.attrs,r,i,A(n,e,o.next,s,r)),o.eflags&N?H(e,o,n,r,i,s):o.next):e.length}function H(t,n,r,i,s,o){var u=t.length;P.hasOwnProperty(n.name)||(P[n.name]=new RegExp("^"+n.name+"(?:[\\s\\/]|$)","i"));var a=P[n.name],f=n.next,l=n.next+1;for(;l<u;l++)if(t[l-1]==="</"&&a.test(t[l]))break;l<u&&(l-=1);var c=t.slice(f,l).join("");if(n.eflags&e.eflags.CDATA)r.cdata&&r.cdata(c,i,s,A(r,t,l,o,i));else{if(!(n.eflags&e.eflags.RCDATA))throw new Error
("bug");r.rcdata&&r.rcdata(S(c),i,s,A(r,t,l,o,i))}return l}function B(t,n){var r=/^([-\w:]+)/.exec(t[n]),i={};i.name=r[1].toLowerCase(),i.eflags=e.ELEMENTS[i.name];var s=t[n].substr(r[0].length),o=n+1,u=t.length;for(;o<u;o++){if(t[o]===">")break;s+=t[o]}if(u<=o)return void 0;var a=[];while(s!==""){r=x.exec(s);if(!r)s=s.replace(/^[\s\S][^a-z\s]*/,"");else{if(r[4]&&!r[5]||r[6]&&!r[7]){var f=r[4]||r[6],l=!1,c=[s,t[o++]];for(;o<u;o++){if(l){if(t[o]===">")break}else 0<=t[o].indexOf(f)&&(l=!0);c.push(t[o])}if(u<=o)break;s=c.join("");continue}var h=r[1].toLowerCase(),p=r[2]?j(r[3]):"";a.push(h,p),s=s.substr(r[0].length)}}return i.attrs=a,i.next=o+1,i}function j(e){var t=e.charCodeAt(0);if(t===34||t===39)e=e.substr(1,e.length-2);return v(h(e))}function F(t,n,r){var i,s,o=!1,u=!1,a=!1;"undefined"!=typeof window&&(MailCaja=window.MailCaja);var f=function(e,t){s||t.push(e)};return C({startDoc:function(e){i=[],s=!1},startTag:function(n,f,l){if(s)return;if(!e.ELEMENTS.hasOwnProperty(n))return;var c=e.ELEMENTS[n];if(c&e.eflags.FOLDABLE)return;var h=t(n,f);if(!h){s=!(c&e.eflags.EMPTY);return}if(typeof h!="object")throw new Error("tagPolicy did not return object (old API?)");if(!("attribs"in h))throw new Error("tagPolicy gave no attribs");f=h.attribs;var p,d;"tagName"in h?(d=h.tagName,p=e.ELEMENTS[d]):(d=n,p=c),d==="a"?o=!0:d==="style"?u=!0:d==="form"&&(a=!0);if(c&e.eflags.OPTIONAL_ENDTAG){var v=i[i.length-1];v&&v.orig===n&&(v.rep!==d||n!==d)&&l.push("</",v.rep,">")}c&e.eflags.EMPTY||i.push({orig:n,rep:d}),l.push("<",d);for(var m=0,g=f.length;m<g;m+=2){var y=f[m],b=f[m+1];b!==null&&b!==void 0&&
l.push(" ",y,'="',E(b),'"')}if(a&&r.formSubmitWarningText&&!r.isContentForCompose){var w=' onsubmit="return window.confirm(&quot;'+r.formSubmitWarningText+'&quot;);" target="_blank" rel="noopener noreferrer"';l.push(w)}a=!1,l.push(">"),c&e.eflags.EMPTY&&!(p&e.eflags.EMPTY)&&l.push("</",d,">")},endTag:function(t,n){if(s){s=!1;return}if(!e.ELEMENTS.hasOwnProperty(t))return;var r=e.ELEMENTS[t];if(!(r&(e.eflags.EMPTY|e.eflags.FOLDABLE))){var a;if(r&e.eflags.OPTIONAL_ENDTAG)for(a=i.length;--a>=0;){var f=i[a].orig;if(f===t)break;if(!(e.ELEMENTS[f]&e.eflags.OPTIONAL_ENDTAG))return}else for(a=i.length;--a>=0;)if(i[a].orig===t)break;if(a<0)return;for(var l=i.length;--l>a;){var c=i[l].rep;e.ELEMENTS[c]&e.eflags.OPTIONAL_ENDTAG||n.push("</",c,">")}a<i.length&&(t=i[a].rep),i.length=a,n.push("</",t,">"),t==="a"?o=!1:t==="style"&&(u=!1)}},pcdata:function(e,t){s||(!o&&e.trim().length>6&&(e=MailCaja.createHyperlinksInTextData(e)),t.push(e))},rcdata:f,cdata:function(e,t){if(!s&&u){var r=MailCaja.sanitizeStyles(e,n);MailCaja.context.hasUnloadedIMG=r.hasUnloadedIMG,MailCaja.context.styleTagOutputArray.push(r.text)}},endDoc:function(e){for(;i.length;i.length--)e.push("</",i[i.length-1].rep,">")}})}function q(e,t,n,r,i){return r.XML_TAG==="img"&&(e=i(e),e===""&&(MailCaja.context.hasUnloadedIMG=!0)),e}function R(e,t,n,r,i){n||e(t+" removed",{change:"removed",tagName:t});if(r!==i){var s="changed";r&&!i?s="removed":!r&&i&&(s="added"),e(t+"."+n+" "+s,{change:s,tagName:t,attribName:n,oldValue:r,newValue:i})}}function U(e,t,n){var r;return r=t+"::"+n,e.hasOwnProperty(r)?e[r]:(r="*::"+n,e.hasOwnProperty
(r)?e[r]:void 0)}function z(t,n){return U(e.ATTRIBS,t,n)}function W(t,n){return U(e.LOADERTYPES,t,n)}function X(t,n){return U(e.URIEFFECTS,t,n)}function V(r,i,s,o,u){var a=[],f;for(var l=0;l<i.length;l+=2){var c=i[l],h=i[l+1],p=h,d=null,v;if((v=r+"::"+c,e.ATTRIBS.hasOwnProperty(v))||(v="*::"+c,e.ATTRIBS.hasOwnProperty(v)))d=e.ATTRIBS[v];if(d!==null)switch(d){case e.atype.NONE:c==="type"&&h.toLowerCase()==="password"&&(a.push("readonly","readonly"),a.push("disabled","disabled"),h=null);break;case e.atype.SCRIPT:h=null,u&&R(u,r,c,p,h);break;case e.atype.STYLE:MailCaja.sanitizeStyles!==undefined&&(f=MailCaja.sanitizeStyles(h,s),h=f.text,f.hasUnloadedIMG&&(MailCaja.context.hasUnloadedIMG=f.hasUnloadedIMG));if("undefined"==typeof t){u&&R(u,r,c,p,h);break}var m=[];t(h,{declaration:function(t,r){var i=t.toLowerCase();n(i,r,s?function(t){return q(t,e.ueffects.SAME_DOCUMENT,e.ltypes.SANDBOXED,{TYPE:"CSS",CSS_PROP:i},s)}:null),r.length&&m.push(i+": "+r.join(" "))}}),h=m.length>0?m.join(" ; "):null,u&&R(u,r,c,p,h);break;case e.atype.ID:case e.atype.IDREF:case e.atype.IDREFS:case e.atype.GLOBAL_NAME:case e.atype.LOCAL_NAME:case e.atype.CLASSES:h=o?o(h):h,u&&R(u,r,c,p,h);break;case e.atype.URI:h=q(h,X(r,c),W(r,c),{TYPE:"MARKUP",XML_ATTR:c,XML_TAG:r},s),u&&R(u,r,c,p,h);var g=h.replace(/\s+/g,"");if(g.search(MailCaja.urlWhitelist)!==0){r==="a"&&g.search(/#/)===0?(a.push("target","_self"),a.push("onclick","return false;")):h=null;break}r==="a"?g.match(/^mailto:/i)?a.push("onclick","return false;"):a.push("rel","noopener noreferrer"):c==="background"&&h!==""&&(h=s(h),h===""&&(MailCaja.context
.hasUnloadedIMG=!0,h=null));break;case e.atype.URI_FRAGMENT:h&&"#"===h.charAt(0)?(h=h.substring(1),h=o?o(h):h,h!==null&&h!==void 0&&(h="#"+h)):h=null,u&&R(u,r,c,p,h);break;default:h=null,u&&R(u,r,c,p,h)}else h=null,u&&R(u,r,c,p,h);i[l+1]=h}return a.length>0&&i.push.apply(i,a),i}function $(t,n,r){return function(i,s){if(!(e.ELEMENTS[i]&e.eflags.UNSAFE))return{attribs:V(i,s,t,n,r)};var o=MailCaja.context.unsafeTagsRemoved[i];o?MailCaja.context.unsafeTagsRemoved[i]=o+1:MailCaja.context.unsafeTagsRemoved[i]=1,r&&R(r,i,undefined,undefined,undefined)}}function J(e,t,n,r){var i=[];return F(t,n,r)(e,i),{output:MailCaja.convertURLMarkersToHyperlinks(i.join("")),styles:MailCaja.context.styleTagOutputArray.join(""),hasUnloadedIMG:MailCaja.context.hasUnloadedIMG,tagsRemoved:MailCaja.context.unsafeTagsRemoved}}function K(e,t,n,r){var i=MailCaja.scrubImagesUriRewriter;t||(t={}),t.loadIMG&&(i=MailCaja.loadImagesUriRewriter),MailCaja.pushContext({hasUnloadedIMG:!1,styleTagOutputArray:[],unsafeTagsRemoved:{}});var s=$(i,n,r),o=J(e,s,i,t);return MailCaja.popContext(),o}var t,n,r;"undefined"!=typeof window&&(t=window.parseCssDeclarations,n=window.sanitizeCssProperty,r=window.cssSchema);var i={lt:"<",LT:"<",gt:">",GT:">",amp:"&",AMP:"&",quot:'"',apos:"'",nbsp:" "},s=/^#(\d+)$/,o=/^#x([0-9A-Fa-f]+)$/,u=/^[A-Za-z][A-za-z0-9]+$/,a="undefined"!=typeof window&&window.document?window.document.createElement("textarea"):null,c=/\0/g,p=/&(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/g,d=/^(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/,m=/&/g,g=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,y=/[<]/g,b=/>/g,w=/\"/g,x=new RegExp("^\\s*([-.:\\w]+)(?:\\s*(=)\\s*((\")[^\"]*(\"|$)|(')[^']*('|$)|(?=[a-z][-\\w]*\\s*=)|[^\"'\\s]*))?"
,"i"),T="a,b".split(/(,)/).length===3,N=e.eflags.CDATA|e.eflags.RCDATA,k={},P={},I=/^(?:https?|mailto)$/i,Q={};return Q.escapeAttrib=Q.escapeAttrib=E,Q.makeHtmlSanitizer=Q.makeHtmlSanitizer=F,Q.makeSaxParser=Q.makeSaxParser=C,Q.makeTagPolicy=Q.makeTagPolicy=$,Q.normalizeRCData=Q.normalizeRCData=S,Q.sanitize=Q.sanitize=K,Q.sanitizeAttribs=Q.sanitizeAttribs=V,Q.sanitizeWithPolicy=Q.sanitizeWithPolicy=J,Q.unescapeEntities=Q.unescapeEntities=v,Q}(html4),html_sanitize=html.sanitize;typeof window!="undefined"&&(window.html=html,window.html_sanitize=html_sanitize);var MailCaja={_contextStack:[],context:undefined,pushContext:function(e){var t=this._contextStack;t.push(e),this.context=e},popContext:function(){var e=this._contextStack,t=e.pop();return e.length>0?this.context=e[e.length-1]:this.context=undefined,t},loadImagesUriRewriter:function(e){return e},scrubImagesUriRewriter:function(e){return e.indexOf(CoreMail.get("imapAttachmentBaseUrl"))===0?e:""},urlWhitelist:new RegExp("(http|https|ftp|ftps|sftp|dict|file|telnet|rdar|exp2|webcal)://|/wm/messagepart|mailto:|data:image","i"),sanitizeStyles:function(e,t){var n={text:"",hasUnloadedIMG:!1};e.replace(/\s+/g,"").search(/@import/ig)>-1&&(e=""),e.replace(/\s+/g,"").search(/expression\(.*\)/ig)>-1&&(e=e.replace(/expression\(.*\)/ig,""));if(e.match("url(.*)")!==null){var r=e.split(/(url\(\S+\))/ig),i=r.length,s="",o;for(var u=0;u<i;u++)s=r[u].match(/url\((\S+)\)/),s&&s[1]&&(s=s[1],o=s.search(this.urlWhitelist),o===-1||o>1?r[u]="":(s=t(s),s===""&&(r[u]=r[u].replace(/url\(\S+\)/ig,""),n.hasUnloadedIMG=!0)));e=r.join("")}return n.text=e,
n},EMAIL_BETWEEN_WHITESPACE:/(\s)(([A-Z0-9\.\-\_\+])*([A-Z0-9\+\-\_])+\@[A-Z0-9]+([\-][A-Z0-9]+)*([\.][A-Z0-9\-]+){1,8})\b/ig,EMAIL_IN_START:/^(([A-Z0-9\.\-\_\+])*([A-Z0-9\+\-\_])+\@[A-Z0-9]+([\-][A-Z0-9]+)*([\.][A-Z0-9\-]+){1,8})\b/ig,URL_START:/(([\w\-]+:\/\/?|www[.])[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_;|])/ig,URL_START_MARKER:"__URLSTART__"+CoreMail.SEED+"__",SHORT_URL_IN_START:/^([\w]+\.(com|org|net|edu|biz|gov|mil|info|name|me|us|mobi))\b/ig,SHORT_URL_BETWEEN_WHITESPACE:/(\s)([\w]+\.(com|org|net|edu|biz|gov|mil|info|name|me|us|mobi))\b/ig,convertURLMarkersToHyperlinks:function(e){var t=new RegExp(this.URL_START_MARKER+"(([\\w\\-]+://?|www[.])[-A-Z0-9+&@#/%?=~_|!:,.;]*[-A-Z0-9+&@#/%=~_;|])","ig");return e=e.replace(t,function(e,t){var n=html_sanitize('<a href="'+t+'">'+t+"</a>");return n?n.output:t}),e},createHyperlinksInTextData:function(e){return e=e.replace(this.EMAIL_BETWEEN_WHITESPACE,"$1<a href='mailto:$2' onclick=\"return false;\">$2</a>").replace(this.EMAIL_IN_START,"<a href='mailto:$1' onclick=\"return false;\">$1</a>").replace(this.URL_START,this.URL_START_MARKER+"$1").replace(new RegExp(this.URL_START_MARKER+"www\\.","ig"),this.URL_START_MARKER+"http://www.").replace(this.SHORT_URL_IN_START,"<a href='http://$1'>$1</a>").replace(this.SHORT_URL_BETWEEN_WHITESPACE,"$1<a href='http://$2'>$2</a>"),e}};typeof window!="undefined"&&(window.MailCaja=MailCaja),CoreMail.messageScrubber=SC.Object.create({formSubmitWarningText:function(){var e=Global.escapeHTMLAndQuotes("_MessageView.FormSubmitWarning.Alert".loc());return e=e.replace(/\n/g,"\\n"),e}.property().cacheable
(),stripInternalMarkupFromMessage:function(e){if(Compose.get("isSendInProgress")){var t=Attachments.get("uploadMode");t===CoreMail.UPLOAD_MODE_MAIL_DROP?e=e.replace(/id="x-apple-maildrop-container"/gi,""):e=e.replace(/<div id="x-apple-maildrop-container" contenteditable="false">[^<>]*<\/div>/,"")}return e},removeOrientationClassFromImgTags:function(e){var t=new RegExp(CoreMail.IMAGE_ORIENTATION_CLASS_PREFIX+"orientation-[2-8]","gi");return e.replace(t,"")}}),SC.IFrameRootResponder=SC.RootResponder.create({iframe:null,target:null,setupRTEResponder:function(e,t){this.set("target",t);var n=this.get("iframe");n&&this.teardown(),this.set("iframe",e);var r=e.contentWindow,i=r.document;this.listenFor("dragenter dragover dragleave drop mouseup mousemove".w(),i)},setupResponder:function(e,t){this.set("target",t);var n=this.get("iframe");n&&this.teardown(),this.set("iframe",e),this.setup()},setup:function(){var e=SC.browser,t=e.mozilla,n=this.get("iframe"),r=n.contentWindow;if(!r){var i="SC.IFrameRootResponder.setup: iframeWindow is null";CoreMail.errorHandler.logErrorTrap(i);return}var s=r.document;this.listenFor("keydown keyup mousedown mouseup click dblclick mouseout mouseover mousemove".w(),s).listenFor("resize".w(),r),this.listenFor(["focus","blur"],window);if(this.keypress)if(SC.CAPTURE_BACKSPACE_KEY&&t){var o=this;s.onkeypress=function(e){return e=SC.Event.normalizeEvent(e),o.keypress.call(o,e)},SC.Event.add(r,"unload",this,function(){s.onkeypress=null})}else SC.Event.add(s,"keypress",this,this.keypress);"drag selectstart".w().forEach(function(e){var t=this[e];t&&SC.Event.add(s
,e,this,t)},this),"drop dragover dragenter".w().forEach(function(e){var t=this[e];t?r["on"+e]=function(e){return e.cancelBubble=!0,!1}:SC.Event.add(s,e,this,t)},this);var u="wheel";t?u="MozMousePixelScroll":e.isSafari&&document.onwheel===undefined&&(u="mousewheel"),SC.Event.add(s,u,this,this.mousewheel)},teardown:function(){var e=this.get("iframe"),t=e.contentWindow,n;t&&(n=t.document),SC.Event.remove(n),SC.Event.remove(t)},computeWindowSize:function(){var e=this.get("iframe"),t=e.contentWindow,n=t?t.document:e.contentDocument,r=t?t.innerHeight:null,i;if(r)i={width:t.innerWidth,height:r};else if(n){var s=n.documentElement,o=n.body,u=s?s.clientHeight:null;u?i={width:s.clientWidth,height:u}:o&&(i={width:o.clientWidth,height:o.clientHeight})}return i},sendEvent:function(e,t){var n,r;SC.RunLoop.begin();var i=this.get("target");return i?n=i.get("pane"):n=this.get("keyPane")||this.get("mainPane"),r=n?n.sendEvent(e,t,i):null,SC.RunLoop.end(),r},targetViewForEvent:function(){return this.get("target")},focus:function(){return NO===SC.RootResponder.responder.get("hasFocus")&&SC.$("body").addClass("sc-blur").removeClass("sc-focus"),YES},mousemove:function(e){var t=arguments.callee.base.apply(this,arguments);e=SC.clone(e),e.clientX=e.layerX=e.x=e.pageX=e.clientX+this.getLeft(),e.clientY=e.layerY=e.y=e.pageY=e.clientY+this.getTop();try{return SC.RootResponder.responder.mousemove(SC.Event.create(e)),t}catch(n){SC.debug("Passing mousemove to message detail iframe's parent failed with an exception: "+n)}},mouseup:function(e){var t=arguments.callee.base.apply(this,arguments);e=SC.clone(e),e.
clientX=e.layerX=e.x=e.pageX=e.clientX+this.getLeft(),e.clientY=e.layerY=e.y=e.pageY=e.clientY+this.getTop();try{return SC.RootResponder.responder.mouseup(SC.Event.create(e)),t}catch(n){SC.debug("Passing mouseup to message detail iframe's parent failed with an exception: "+n)}},getTop:function(){var e=0,t=this.get("iframe"),n=t.contentWindow,r=n.document;while(t&&t!==r.body)e+=t.offsetTop||0,t=t.parentNode;var i=e-parseInt(ViewMessage.page.messageScrollView.get("verticalScrollOffset"),0);return i},getLeft:function(){var e=0,t=this.get("iframe"),n=t.contentWindow,r=n.document;while(t&&t!==r.body)e+=t.offsetLeft||0,t=t.parentNode;var i=e-parseInt(ViewMessage.page.messageScrollView.get("horizontalScrollOffset"),0);return i}}),CoreMail.numberFormatter=SC.Object.create({formatDecimals:function(e){var t="_Common.Number.DecimalCharacter".loc();return t!=="."&&t.length===1?e.toString().replace(/\./,t):e},millisecondsToDateString:function(e){var t="";return e&&(isNaN(e)&&(e=parseInt(e)),e=new Date(e),t=CoreMail.timeZoneConverter.getFormattedDate(e,CoreMail.timeZoneConverter.get("monthInWordsDateFormat"))),t}}),window.RegexHelper=SC.Object.create({SPECIAL_CHARS:["/","^","$",".","*","+","?","|","(",")","[","]","{","}","\\"],specialRegExp:null,emailAddressRE:/\b(([A-Z0-9\.\-\_\+])*([A-Z0-9\+\-\_])+\@[A-Z0-9]+([\-][A-Z0-9]+)*([\.][A-Z0-9\-]+){1,8})\b/ig,init:function(){arguments.callee.base.apply(this,arguments),this.set("specialRegExp",new RegExp("(\\"+this.SPECIAL_CHARS.join("|\\")+")","g"))},escapeSpecialCharacters:function(e){return e.replace(this.get("specialRegExp"),"\\$1")},findEmailAddresses
:function(e){var t=[];if(!SC.empty(e))t=e.match(this.get("emailAddressRE"));else{var n="CoreMail.RegexHelper: findEmailAddresses() received input parameter- value : "+e;CoreMail.errorHandler.logErrorTrap(n)}return t},isValidUrlDomain:function(e){var t=NO,n=new RegExp("^(?:(?:https?)://)(?:(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?:/[^\\s]*)?$");return e&&n.test(e)&&(t=YES),t}}),CoreMail.timeZoneConverter=SC.Object.create({timezoneOffset:-(new Date).getTimezoneOffset(),_dateTime:SC.DateTime.create(),configure:function(e){if(e===null||e===undefined)e=-420;this.set("timezoneOffset",e),SC.DateTime.monthNames="_SC.DateTime.monthNames".loc().w(),SC.DateTime.abbreviatedMonthNames="_SC.DateTime.abbreviatedMonthNames".loc().w(),SC.DateTime.AMPMNames="_SC.DateTime.AMPMNames".loc().w()},lang:function(){return SC.Locale.currentLanguage.toLowerCase()}.property().cacheable(),today:function(){return"_DateTime.Today".loc()}.property().cacheable(),yesterday:function(){return"_DateTime.Yesterday".loc()}.property().cacheable(),shortDateFormat:function(){var e=this.get("isDayBeforeMonth")?"_DateTime.ShortDate.DayFirst".loc():"_DateTime.ShortDate.Regular".loc();return e}.property().cacheable(),monthInWordsDateFormat:function(){var e=SC.Locale.currentLocale.strings;if(!e["_DateTime.MonthInWords.DayFirst"]||!e["_DateTime.MonthInWords.Regular"])return this.get("shortDateFormat");var t=this.get("isDayBeforeMonth")?"_DateTime.MonthInWords.DayFirst".loc():"_DateTime.MonthInWords.Regular"
.loc();return t}.property().cacheable(),longDateFormat:function(){var e=this.get("isDayBeforeMonth")?"_DateTime.LongDateFormat.DayFirst".loc():"_DateTime.LongDateFormat.Regular".loc();return e}.property().cacheable(),replyFormat:function(){var e=this.get("isDayBeforeMonth")?"_DateTime.ReplyFormat.DayFirst".loc():"_DateTime.ReplyFormat.Regular".loc();return e}.property().cacheable(),messageSavedOrReceivedTime:function(){return"_DateTime.MessageSavedOrReceivedtime".loc()}.property().cacheable(),blacklistItemDetail:function(){return"_DateTime.BlacklistedDateMMMDDYY".loc()}.property().cacheable(),vacationReplyDateFormat:function(){var e=this.get("isDayBeforeMonth")?"_DateTime.VacationReplyDateFormat.DayFirst".loc():"_DateTime.VacationReplyDateFormat.Regular".loc();return e}.property().cacheable(),isDayBeforeMonth:function(){var e=CloudOS.getAppPreferences("calendar"),t;return e&&e.dateFormat?t=e.dateFormat:(t="MM/DD/YYYY",SC.debug("TIME ZONE CONVERTER: Date format preference unavailable, using locale defaults")),t.charAt(0).toUpperCase()==="D"?YES:NO}.property().cacheable(),currentDate:function(){var e=new Date,t=this.get("timezoneOffset"),n=t*6e4,r=e.getTimezoneOffset(),i=r*6e4;return e.setTime(e.getTime()+i+n),e}.property(),currentDateTime:function(){return SC.DateTime.create({timezone:-this.get("timezoneOffset")})}.property(),getLocalizedDate:function(e){var t=e instanceof Date?new Date(e.getTime()):new Date(e),n=t.getTime(),r=this.get("timezoneOffset"),i=r*6e4,s=t.getTimezoneOffset(),o=s*6e4;return t.setTime(n+i+o),t},getGMTDate:function(e){var t=e instanceof Date?new Date(e
.getTime()):new Date(e),n=t.getTime(),r=this.get("timezoneOffset")*6e4,i=t.getTimezoneOffset()*6e4;return t.setTime(n-r-i),t},yesterdayDate:function(){var e=this.get("currentDate");return e.setTime(e.getTime()-CoreMail.DAY_LENGTH_IN_MILLISECONDS),e}.property(),startingWeekday:function(){var e=parseInt("_DateTime.StartingDayOfTheWeek".loc(),10);return isNaN(e)&&(e=null),e}.property().cacheable(),compare:function(e,t){var n=e.getTime(),r=t.getTime();return n-r},getDateTimeOptions:function(e){var t={year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate(),hour:e.getHours(),minute:e.getMinutes(),second:e.getSeconds(),millisecond:e.getMilliseconds(),timezone:0};return t},getFormattedDate:function(e,t){return this._dateTime.adjust(this.getDateTimeOptions(e)).toFormattedString(t)}}),CoreMail.ScrollOnDragSelect={adjustForIframe:YES,mouseMoved:function(e){this._mouseDownEvt&&(this._dragInProgress=YES,this._autoScroll(e))},_autoScroll:function(e){e||(e=this._lastAutoscrollEvent);if(!e||!this._dragInProgress)return NO;if(!this._firstScrollableView)if(this.get("isScrollable"))this._firstScrollableView=this;else{var t=this.get("parentView");while(t&&YES!==t.get("isScrollable"))t=t.get("parentView");YES===t.get("isScrollable")&&(this._firstScrollableView=t)}if(!this._firstScrollableView)return;var n={x:e.pageX,y:e.pageY},r=this._firstScrollableView,i=null,s,o,u,a,f,l,c;if(this.get("adjustForIframe")){var h=this.$("iframe").offset();n.x+=h.left,n.y+=h.top}if(r&&!i){s=r.get("canScrollVertical")?1:0,o=r.get("canScrollHorizontal")?1:0;if(s||o)l=r.get("containerView"),l?c=r.convertFrameToView
(l.get("frame"),null):s=o=0;var p=r.get("verticalScrollOffset"),d=r.get("horizontalScrollOffset");s&&(a=SC.maxY(c),u=a-SC.DRAG_AUTOSCROLL_ZONE_THICKNESS,n.y>=u&&n.y<=a&&r.get("maximumVerticalScrollOffset")!==p?s=1:(u=SC.minY(c),a=u+SC.DRAG_AUTOSCROLL_ZONE_THICKNESS,n.y>=u&&n.y<=a&&r.get("minimumVerticalScrollOffset")!==p?s=-1:s=0)),o&&(a=SC.maxX(c),u=a-SC.DRAG_AUTOSCROLL_ZONE_THICKNESS,n.x>=u&&n.x<=a&&r.get("maximumHorizontalScrollOffset")!==d?o=1:(u=SC.minX(c),a=u+SC.DRAG_AUTOSCROLL_ZONE_THICKNESS,n.x>=u&&n.x<=a&&r.get("minimumHorizontalScrollOffset")!==d?o=-1:o=0));if(s||o)i=r}var v=15,m=15;if(i){Date.now()-this._hotzoneStartTime>100&&(v*=1.05,m*=1.05);if(o||s){var g={x:o*v,y:s*m};i.scrollBy(g)}}return i?(e&&(this._lastAutoscrollEvent={pageX:e.pageX+g.x,pageY:e.pageY+g.y}),this.invokeLater(this._autoScroll,100,null),YES):(this._lastAutoscrollEvent=null,NO)}},require("core"),CoreMail.Contact=SC.Record.extend({addressType:SC.Record.attr(String),firstName:SC.Record.attr(String),lastName:SC.Record.attr(String),emailAddresses:SC.Record.toMany("CoreMail.ContactEmail"),groupName:SC.Record.attr(String),members:SC.Record.toMany("CoreMail.Contact"),fullName:function(){return[this.get("firstName"),this.get("lastName")].compact().join(" ")}.property("firstName","lastName").cacheable()}),require("core"),CoreMail.AliasAccount=SC.Record.extend({accountDescription:SC.Record.attr(String,{defaultValue:""}),fullName:SC.Record.attr(String,{isRequired:NO,defaultValue:""}),color:SC.Record.attr(String,{defaultValue:"#a8a8a8"}),active:SC.Record.attr(Boolean,{defaultValue:YES}),emailId:SC.Record.attr
(String),emails:SC.Record.attr(Array),toHash:function(){return{type:this.get("type"),guid:this.get("guid"),accountDescription:this.get("accountDescription"),fullName:this.get("fullName"),color:this.get("color"),active:this.get("active"),emailId:this.get("emailId"),emails:this.get("emails")}}}),CoreMail.Blacklist=SC.Record.extend({primaryKey:"address",name:SC.Record.attr(String),address:SC.Record.attr(String),date:SC.Record.attr(Number),action:SC.Record.attr(String),localizedDate:function(){var e=new Date(this.get("date")*1e3);return CoreMail.timeZoneConverter.getLocalizedDate(e)}.property("date").cacheable(),domain:function(){var e=this.get("address");return e.substring(e.indexOf("@")+1,e.length)}.property("address").cacheable()}),require("core"),CoreMail.Contact=SC.Record.extend({addressType:SC.Record.attr(String),firstName:SC.Record.attr(String),lastName:SC.Record.attr(String),emailAddresses:SC.Record.toMany("CoreMail.ContactEmail"),groupName:SC.Record.attr(String),members:SC.Record.toMany("CoreMail.Contact"),fullName:function(){return[this.get("firstName"),this.get("lastName")].compact().join(" ")}.property("firstName","lastName").cacheable()}),require("core"),CoreMail.ContactEmail=SC.Record.extend({index:SC.Record.attr(Number),stripe:SC.Record.attr(Boolean),firstName:SC.Record.attr(String),lastName:SC.Record.attr(String),emailType:SC.Record.attr(String),fullName:SC.Record.attr(String),email:SC.Record.attr(String,{isRequired:YES}),emailAddress:function(e){return e+"&lt ;"+this.get("email")+"&gt ;"}.property("email")}),require("core"),CoreMail.EmailAddress=SC.Record.extend
({name:SC.Record.attr(String),email:SC.Record.attr(String,{isRequired:YES}),nameAndEmailAddress:SC.Record.attr(String),toHash:function(){return{type:this.get("type"),guid:this.get("guid"),name:this.get("name"),email:this.get("email"),nameAndEmailAddress:this.get("nameAndEmailAddress")}},contactDataRefreshed:null,contactDataRefreshedBinding:"Contacts.contactDataRefreshed",nameAndEmailForCompose:function(){var e=null,t=this.get("nameAndEmailAddress");return e=t?t:this.get("email"),e}.property("nameAndEmailAddress","email").cacheable(),fullName:function(){var e;return window.Contacts&&(e=Contacts.getFullName(this.get("emailId"))),e||(e=this.get("name")),e}.property("contactDataRefreshed").cacheable(),_firstAndLastNames:function(){return CK.tokensParser.getFirstAndLastNames(this.get("fullName"))}.property("fullName").cacheable(),firstName:function(){return this.get("_firstAndLastNames").firstName}.property("_firstAndLastNames").cacheable(),lastName:function(){return this.get("_firstAndLastNames").lastName}.property("_firstAndLastNames").cacheable(),emailId:function(){return this.get("email")}.property().cacheable(),vipDataRefreshed:null,vipDataRefreshedBinding:"VipSender.vipDataRefreshed",isVipSender:function(){return window.VipSender?VipSender.isVip(this.get("emailId"))!==NO?YES:NO:(SC.debug("Vip check failed for"+this.get("emailId")),NO)}.property("vipDataRefreshed").cacheable()}),require("core"),CoreMail.Folder=SC.Record.extend({ignoreUnknownProperties:YES,name:SC.Record.attr(String,{isRequired:YES}),role:SC.Record.attr(String,{isRequired:YES}),parent:SC.Record.toOne("CoreMail.Folder"
),realParent:SC.Record.toOne("CoreMail.Folder"),vipSender:SC.Record.toOne("CoreMail.VipSender"),kids:SC.Record.toMany("CoreMail.Folder"),realKids:SC.Record.toMany("CoreMail.Folder"),children:function(){if(CoreMail.FOLDER_PERF){var e=this.get("kids");if(!e||e.get("length")===0)return null;var t=[];return e.forEach(function(e){t.push(e)}),t}return this.childrenOrig()}.property("kids","kidsEnumerableContent").cacheable(),init:function(){arguments.callee.base.apply(this,arguments),this._kidsDidChange()},_kidsDidChange:function(){var e=this._previousKids,t=this.get("kids");e!==t&&(e&&e.removeObserver("[]",this,this._kidsContentDidChange),t&&t.addObserver("[]",this,this._kidsContentDidChange)),this._previousKids=t}.observes("kids"),kidsEnumerableContent:null,_kidsContentDidChange:function(){this.get("role")===CoreMail.FOLDER_ROLE_VIP&&!this.get("parent")&&this.notifyPropertyChange("kidsEnumerableContent")},childrenOrig:function(){var e=CoreMail.getFolders().filterProperty("parent",this);return e&&e.get("length")>0?(e.sortProperty("lowerCaseName"),e):null},toHash:function(){return{type:this.get("type"),guid:this.get("guid"),name:this.get("name"),role:this.get("role"),parent:this.get("parent")?this.get("parent").get("guid"):null,total:this.get("total"),unread:this.get("unread")}},displayName:function(){var e,t=this.get("name");switch(this.get("role")){case CoreMail.FOLDER_ROLE_INBOX:e="_FolderList.FolderName.Inbox".loc();break;case CoreMail.FOLDER_ROLE_DRAFTS:e="_FolderList.FolderName.Drafts".loc();break;case CoreMail.FOLDER_ROLE_SENT:t===CoreMail.FOLDER_NAME_SENT?e="_FolderList.FolderName.Sent"
.loc():e=t;break;case CoreMail.FOLDER_ROLE_TRASH:t===CoreMail.FOLDER_NAME_TRASH?e="_FolderList.FolderName.Trash".loc():e=t;break;case CoreMail.FOLDER_ROLE_JUNK:e="_FolderList.FolderName.Junk".loc();break;case CoreMail.FOLDER_ROLE_ARCHIVE:e="_FolderList.FolderName.Archive".loc();break;case CoreMail.FOLDER_ROLE_VIP:this.get("parent")===null?e="_FolderList.FolderName.Vip".loc():e=t;break;default:e=t}return e}.property("name","role").cacheable(),total:null,unread:0,isExpanded:NO,icon:function(){var e=this.get("role");return e?e.toLowerCase():""}.property("role","guid").cacheable(),sortKind:function(){return this.get("parent")===null?this.get("group"):null}.property().cacheable(),group:function(){var e;switch(this.get("role")){case CoreMail.FOLDER_ROLE_INBOX:case CoreMail.FOLDER_ROLE_DRAFTS:case CoreMail.FOLDER_ROLE_SENT:case CoreMail.FOLDER_ROLE_TRASH:case CoreMail.FOLDER_ROLE_JUNK:case CoreMail.FOLDER_ROLE_ARCHIVE:case CoreMail.FOLDER_ROLE_VIP:e=CoreMail.FOLDER_GROUP_MAILBOXES;break;case CoreMail.FOLDER_ROLE_FOLDER:e=CoreMail.FOLDER_GROUP_FOLDERS;break;default:e=CoreMail.FOLDER_GROUP_FOLDERS}return e}.property("role").cacheable(),junk:function(){return this.get("role")===CoreMail.FOLDER_ROLE_JUNK}.property("role").cacheable(),canDelete:function(){var e=this.get("role"),t=this.get("parent");return e===CoreMail.FOLDER_ROLE_FOLDER||e===CoreMail.FOLDER_ROLE_VIP&&t!==null?YES:NO}.property().cacheable(),count:function(){return this.get("role")===CoreMail.FOLDER_ROLE_DRAFTS?this.get("total"):this.get("unread")}.property("total","unread").cacheable(),sortOrder:function(){var e;switch(this
.get("role")){case CoreMail.FOLDER_ROLE_INBOX:e=1;break;case CoreMail.FOLDER_ROLE_VIP:e=2;break;case CoreMail.FOLDER_ROLE_DRAFTS:e=3;break;case CoreMail.FOLDER_ROLE_SENT:e=4;break;case CoreMail.FOLDER_ROLE_ARCHIVE:e=5;break;case CoreMail.FOLDER_ROLE_TRASH:e=6;break;case CoreMail.FOLDER_ROLE_JUNK:e=7;break;case CoreMail.FOLDER_ROLE_FOLDER:e=8;break;default:e=9}return e}.property("role").cacheable(),subfolders:function(){var e=this.get("children"),t=[];if(e){t.pushObjects(e);for(var n=0,r=e.get("length");n<r;n++)t.pushObjects(e[n].get("subfolders"))}return t}.property("children"),lowerCaseName:function(){return this.get("name").toLowerCase()}.property("name").cacheable(),sha1:function(){return CoreMail.Folder.getSha1FromGuid(this.get("guid"))}.property("guid").cacheable(),filterCriteria:function(e,t){var n,r=this.get("sha1"),i=this._filterCriteria,s=this._filterCriteriaMap,o=CoreMail.get("implicitPreferences");return s||(this._filterCriteriaMap=s=o.get("folderFilterCriteriaMap")),i||(this._filterCriteria=i=CoreMail.FolderFilterCriteria.create(),n=s[r],n&&i.set("bitmap",n)),t&&(["unread","flagged","toMe","ccMe","withAttachments","fromVip","enabled"].forEach(function(e){t[e]!==undefined&&i.set(e,t[e])}),n=i.get("bitmap"),n>0?(SC.debug('CoreMail.Folder.filterCriteria: Saving filter criteria for "'+this.get("guid")+'"" '+"with bitmap value of "+n+"."),s[r]=n):(SC.debug('CoreMail.Folder.filterCriteria: Resetting filter criteria for "'+this.get("guid")+'".'),delete s[r]),CoreMail.saveImplicitPreference("folderFilterCriteriaMap",s)),i}.property()}),CoreMail.Folder.mixin({getSha1FromGuid
:function(e){var t=CloudOS.getUser().get("dsid"),n=(e||"")+"+"+t;return SHA1.hex_sha1(n).substr(0,7)}}),CoreMail.FolderFilterCriteria=SC.Object.extend({enabled:NO,unread:NO,flagged:NO,toMe:NO,ccMe:NO,withAttachments:NO,fromVip:NO,digest:function(){if(!this.get("enabled"))return"";var e=[];return this.get("unread")&&e.push("unread"),this.get("flagged")&&e.push("flagged"),this.get("toMe")&&e.push("toMe"),this.get("ccMe")&&e.push("ccMe"),this.get("withAttachments")&&e.push("withAttachments"),this.get("fromVip")&&e.push("fromVip"),e.join(",")}.property("enabled","unread","flagged","toMe","ccMe","withAttachments","fromVip").cacheable(),bitmap:function(e,t){return t!==undefined&&(this.set("enabled",t&1?YES:NO),this.set("unread",t&2?YES:NO),this.set("flagged",t&4?YES:NO),this.set("toMe",t&8?YES:NO),this.set("ccMe",t&16?YES:NO),this.set("withAttachments",t&32?YES:NO),this.set("fromVip",t&64?YES:NO)),t=(this.get("enabled")?1:0)+(this.get("unread")?2:0)+(this.get("flagged")?4:0)+(this.get("toMe")?8:0)+(this.get("ccMe")?16:0)+(this.get("withAttachments")?32:0)+(this.get("fromVip")?64:0),t}.property("enabled","unread","flagged","toMe","ccMe","withAttachments","fromVip").cacheable()}),require("core"),CoreMail.Group=SC.Record.extend({name:SC.Record.attr(String,{isRequired:YES}),members:SC.Record.toMany("CoreMail.Contact"),guid:SC.Record.attr(String,{isRequired:YES}),isLoaded:SC.Record.attr(Boolean,{defaultValue:NO}),currentRangeIndex:SC.Record.attr(Number,{defaultValue:0}),memberList:function(){return this.get("members")}.property("members")}),require("core"),CoreMail.IdentityAccount=SC.Record
.extend({accountDescription:SC.Record.attr(String,{defaultValue:CoreMail.DEFAULT_IDENTITY_ACCOUNT_DESCRIPTION}),fullName:SC.Record.attr(String,{isRequired:NO,defaultValue:""}),emailId:SC.Record.attr(String),emails:SC.Record.attr(Array),toHash:function(){var e={type:this.get("type"),guid:this.get("guid"),accountDescription:this.get("accountDescription"),fullName:this.get("fullName"),emails:this.get("emails")};for(var t in e)e[t]===null&&(e[t]=undefined);return e}}),require("core"),CoreMail.ImplicitPreferences=SC.Record.extend({view:SC.Record.attr(String,{defaultValue:"3Column"}),messageSortBy:SC.Record.attr(String,{defaultValue:"Date"}),messageSortAscending:SC.Record.attr(Boolean,{defaultValue:NO}),messageSplitterPosition:SC.Record.attr(Number,{defaultValue:380}),folderListWidth:SC.Record.attr(Number),headerExpanded:SC.Record.attr(Boolean,{defaultValue:NO}),longHeaderVisible:SC.Record.attr(Boolean,{defaultValue:NO}),openFolderDisclosures:SC.Record.attr(Object,{defaultValue:{}}),lastSelectedFolder:SC.Record.attr(String,{defaultValue:""}),lastSelectedSearch:SC.Record.attr(String,{defaultValue:3}),isQuickReplyEnabled:SC.Record.attr(Boolean,{defaultValue:NO}),vipUnreadCounts:SC.Record.attr(Object,{defaultValue:{}}),blacklistSortBy:SC.Record.attr(String,{defaultValue:"Date"}),blacklistSortAscending:SC.Record.attr(Boolean,{defaultValue:YES}),blacklistSortOrder:SC.Record.attr(String,{defaultValue:"date"}),isRTEToolbarVisible:SC.Record.attr(Boolean,{defaultValue:NO}),folderFilterCriteriaMap:SC.Record.attr(Object,{defaultValue:{}}),allowZeroByteFileUploads:SC.Record.attr(Boolean,{defaultValue
:NO})}),require("core"),CoreMail.Message=SC.Record.extend({ignoreUnknownProperties:YES,folder:SC.Record.toOne("CoreMail.Folder",{isRequired:YES}),uid:SC.Record.attr(String,{isRequired:YES}),to:SC.Record.attr(Array),cc:SC.Record.attr(Array),from:SC.Record.attr(String,{isRequired:YES}),replyTo:SC.Record.attr(Array),subject:SC.Record.attr(String),date:SC.Record.attr(String,{isRequired:YES}),unread:SC.Record.attr(Boolean,{isRequired:YES,defaultValue:NO}),replied:SC.Record.attr(Boolean,{isRequired:YES,defaultValue:NO}),forwarded:SC.Record.attr(Boolean,{isRequired:YES,defaultValue:NO}),flagged:SC.Record.attr(Boolean,{isRequired:YES,defaultValue:NO}),junk:SC.Record.attr(Boolean,{isRequired:YES,defaultValue:NO}),preview:SC.Record.attr(String,{defaultValue:""}),parts:SC.Record.attr(Array),mimeParts:SC.Record.toMany("CoreMail.MessagePart"),messageId:SC.Record.attr(String),relatedGUID:SC.Record.attr(String),toHash:function(){var e=CoreMail._manyArrayToGuidArray(this.get("mimeParts")),t={type:this.get("type"),guid:this.get("guid"),relatedGUID:this.get("relatedGUID"),folder:this.get("folder").get("guid"),uid:this.get("uid"),to:this.get("to"),cc:this.get("cc"),from:this.get("from"),replyTo:this.get("replyTo"),subject:this.get("subject"),date:this.get("date"),unread:this.get("unread"),replied:this.get("replied"),forwarded:this.get("forwarded"),flagged:this.get("flagged"),junk:this.get("junk"),preview:this.get("preview"),messageId:this.get("messageId"),mimeParts:e?e.guidArray:null};return{messageHash:t,mimePartHashes:e?e.hashArray:null}},computedPreview:function(e,t){var n=this._computedPreview
;t!==undefined?(t.search(/\S/g)===-1&&(t="_MessageList.EmptySnippet".loc()),n=t):n=n?n:this.get("preview");var r=n.indexOf("\n>"),i=new RegExp("\n>","g"),s=n.indexOf(">");while(s===0)n=n.replace(">",""),s=n.indexOf(">");while(r!==-1)n=n.replace(i,"\n"),r=n.indexOf("\n>");return this._computedPreview=n,this._computedPreview}.property("preview").cacheable(),account:function(){var e=this.get("folder");if(!e)return undefined;var t,n=e.get("role");return n===CoreMail.FOLDER_ROLE_DRAFTS||n===CoreMail.FOLDER_ROLE_SENT?t=this._getAccount([this.get("from")]):(t=this._getAccount(this.get("to")),t||(t=this._getAccount(this.get("cc")))),t}.property().cacheable(),_getAccount:function(e){var t=0;e&&(t=e.length);var n,r;for(var i=0;i<t;i++){if(e[i]===null){SC.warn("null entry at index %@ in array [%@] of length %@".fmt(i,e,t));continue}r=RegexHelper.findEmailAddresses(e[i]);if(!(r&&r.length>0))continue;r=r[0],n=CoreMail.emailCache[r];if(n)break;n=this._pickAccount(r);if(n){CoreMail.emailCache[r]=n;break}}return n},_pickAccount:function(e){var t,n,r,i;if(!e)return r;this._accounts||(this._accounts={aliasAccounts:CoreMail.store.find(CoreMail.AliasAccount)}),e=e.toLowerCase();var s=this._accounts.aliasAccounts;if(s){n=s.get("length");for(t=0;t<n;t++){r=s.objectAt(t),i=r.get("emails");for(var o=0,u=i.length;o<u;o++)if(e===i[o].address)return r}}return undefined},messageDetail:null,contactDataRefreshed:null,contactDataRefreshedBinding:"Contacts.contactDataRefreshed",toDisplayName:function(){var e=this.get("to");if(!e||e.get("length")===0)e=this.get("cc"),e||(e=[undefined]);return this._displayName
(e.objectAt(0))}.property("to","contactDataRefreshed").cacheable(),fromDisplayName:function(){return this._displayName(this.get("from"))}.property("from","contactDataRefreshed").cacheable(),_displayName:function(e){var t="",n="",r=CK.tokensParser.parseEmailAddress(e);if(!r)t=e;else{n=r.get("emailId"),window.Contacts&&(t=Contacts.getFullName(n)),t||(t=r.get("name"));if(t&&n){var i=t.replace(/["']/g,"").trim();if(i){var s=CK.tokensParser.parseEmailAddress(i);s&&s.isValid&&s.emailId!==n&&(t=n)}}SC.empty(t)===YES&&(SC.empty(n)===NO?t=n:t=e)}return t},fromAddress:function(){var e=this.get("from"),t=CK.tokensParser.parseEmailAddress(e);return t?t.get("emailId"):e}.property("from").cacheable(),toAddress:function(){var e=this.get("to");if(!e||e.get("length")===0){e=this.get("cc");if(!e||e.get("length")===0)return null}return e=CK.tokensParser.parseEmailAddress(e.objectAt(0)),e?e.get("emailId"):null}.property("to","cc").cacheable(),attachmentCount:function(){var e=0,t=this.get("mimeParts");return t&&t.get("length")>0&&t.forEach(function(t){t&&t.get("isAttachment")===YES&&e++}),e}.property("mimeParts").cacheable(),size:function(){var e=0;return this.get("mimeParts").forEach(function(t){t.get("isMailDrop")||(e+=t.get("size")||0)}),e}.property("mimeParts").cacheable(),localizedDate:function(){return CoreMail.timeZoneConverter.getLocalizedDate(this.get("date"))}.property("date").cacheable(),isMessageJunk:function(){return this.get("junk")===YES||this.getPath("folder.role")===CoreMail.FOLDER_ROLE_JUNK?YES:NO}.property("junk").cacheable(),vipDataRefreshed:null,vipDataRefreshedBinding:"VipSender.vipDataRefreshed"
,isFromVipSender:function(){return window.VipSender?VipSender.isVip(this.get("fromAddress"))!==NO?YES:NO:NO}.property("vipDataRefreshed").cacheable(),isToVipSender:function(){if(!window.VipSender)return SC.warn("CoreMail.Message.isToVipSender: VipSender module not yet loaded"),NO;var e=this.getPath("folder.role");if(e!==CoreMail.FOLDER_ROLE_DRAFTS&&e!==CoreMail.FOLDER_ROLE_SENT)return SC.warn("CoreMail.Message.isToVipSender:Message does not belong to either drafts or sent folder"),NO;var t=this.get("toAddress");return t&&VipSender.isVip(t)!==NO?YES:NO}.property("vipDataRefreshed").cacheable(),hasUnexpiredAttachments:function(){var e=NO;if(this.get("attachmentCount")>0){var t=this.get("mimeParts"),n=t?t.get("length"):0;for(var r=0;r<n;r++){var i=t.objectAt(r);if(i.get("isAttachment")===YES&&i.get("isExpired")===NO){e=YES;break}}}return e}.property("mimeParts","messageDetail").cacheable(),isMailDropMessage:function(){var e=this.get("mimeParts"),t=e?e.get("length"):0,n=NO;for(var r=0;r<t;r++)if(e.objectAt(r).get("isMailDrop")===YES){n=YES;break}return n}.property("mimeParts").cacheable()}),require("core"),CoreMail.MessageDetail=SC.Record.extend({message:SC.Record.toOne("CoreMail.Message"),longHeader:SC.Record.attr(String),to:SC.Record.toMany("CoreMail.EmailAddress"),from:SC.Record.toOne("CoreMail.EmailAddress"),cc:SC.Record.toMany("CoreMail.EmailAddress"),bcc:SC.Record.toMany("CoreMail.EmailAddress"),replyTo:SC.Record.toMany("CoreMail.EmailAddress"),listUnsubscribe:SC.Record.attr(String),listUnsubscribeKey:SC.Record.attr(String),listUnsubscribeStatus:SC.Record.attr(String),hasUnloadedIMG
:!1,doctype:"",messageStyles:null,viewMessageSpecificStyles:null,isContentForCompose:!1,mailDropBannerExpirationDate:null,haveMailDropAttachmentsExpired:function(){return Message.checkIfDateIsExpired(this.get("mailDropBannerExpirationDate"))}.property("mailDropBannerExpirationDate").cacheable(),shouldPublishStatAndShowErrorForScrubbedCoupons:YES,shouldValidateAnchorLinksInBody:NO,isSuspicious:NO,isTrusted:null,isSuspiciousAndNotTrusted:function(){var e;return this.get("isSuspicious")&&!this.get("isTrusted")?e=YES:e=NO,e}.property("isSuspicious","isTrusted").cacheable(),listUnsubscribeMailTo:function(){var e={emailAddress:"",subject:""},t=this.get("listUnsubscribe"),n;if(t){var r=/<mailto:([^>]*)\?subject=([^>]*)>/i;n=t.match(r),n||(r=/<mailto:([^>]*)>/i,n=t.match(r)),n&&n[1]&&(e.emailAddress=n[1],n[2]&&(e.subject=n[2]))}return e}.property("listUnsubscribe").cacheable(),canBeUnsubscribed:function(){var e=NO;if(this.get("listUnsubscribe")&&!this.get("junkContext")){var t=this.get("listUnsubscribeMailTo");if(Global.validateEmail(t.emailAddress)){var n=this.get("listUnsubscribeStatus");n!==CoreMail.MESSAGE_LIST_UNSUBSCRIBE_STATUS_ACCEPTED&&n!==CoreMail.MESSAGE_LIST_UNSUBSCRIBE_STATUS_IGNORED&&(e=YES)}}return e}.property("listUnsubscribe","listUnsubscribeStatus","junkContext").cacheable(),unsafeTagsRemoved:null,_preScrubBody:null,_isHTML:null,toHash:function(){var e=CoreMail._manyArrayToGuidArray(this.get("to")),t=CoreMail._manyArrayToGuidArray(this.get("cc")),n=CoreMail._manyArrayToGuidArray(this.get("bcc")),r=CoreMail._manyArrayToGuidArray(this.get("replyTo")),i={type:this.get("type"
),guid:this.get("guid"),message:this.get("message").get("guid"),longHeader:this.get("longHeader"),to:e?e.guidArray:null,from:this.get("from")?this.get("from").get("guid"):null,cc:t?t.guidArray:null,bcc:n?n.guidArray:null,replyTo:r?r.guidArray:null};return{toHashes:e?e.hashArray:null,ccHashes:t?t.hashArray:null,bccHashes:n?n.hashArray:null,replyToHashes:r?r.hashArray:null,detailHash:i,customProperties:{didUserChangeLoadImgPref:this.get("didUserChangeLoadImgPref"),loadIMG:this.get("loadIMG"),doctype:this.get("doctype"),messageStyles:this.get("messageStyles"),viewMessageSpecificStyles:this.get("viewMessageSpecificStyles"),isContentForCompose:this.get("isContentForCompose"),mailDropBannerExpirationDate:this.get("mailDropBannerExpirationDate"),haveMailDropAttachmentsExpired:this.get("haveMailDropAttachmentsExpired"),plainTextPreview:this.get("plainTextPreview"),customStyles:this.get("customStyles"),_isHTML:this._isHTML,isSuspicious:this.get("isSuspicious"),isTrusted:this.get("isTrusted"),listUnsubscribe:this.get("listUnsubscribe"),listUnsubscribeKey:this.get("listUnsubscribeKey"),listUnsubscribeStatus:this.get("listUnsubscribeStatus")}}},didUserChangeLoadImgPref:NO,loadIMG:function(e,t){var n;return t===undefined?(this.get("didUserChangeLoadImgPref")===NO&&(this.get("junkContext")?this._loadIMG=NO:this._loadIMG=CoreMail.store.find(CoreMail.ServerPreferences,CoreMail.SERVER_PREFS_GUID).get("loadImagesInHTML")),n=this._loadIMG):(this._loadIMG=t,this.set("didUserChangeLoadImgPref",YES),n=t),n}.property(),orientationData:null,orientationDataBinding:"CoreMail.messagePartDataSource.orientationData"
,body:function(){SC.Benchmark.start("CoreMail.MessageDetail: Processing (body)");var e="";this.get("orientationData")&&(this._preScrubBody=null,this.orientationData=null);if(this._preScrubBody===null||this.get("isContentForCompose")===YES){var t=this.get("message"),n=t.get("mimeParts"),r={},i,s=this;n.forEach(function(t){var n=t.get("contentCode"),o=t.get("content"),u=t.get("attachmentUrl");if(!t.get("isAttachment")&&n===CoreMail.TEXT_HTML&&o!==null)e+=o,i=YES;else if(!t.get("isAttachment")&&o!==null){var a=/&/g,f=/</g,l=/>/g,c="	&gt;",h=new RegExp(c,"g");o=o.replace(a,"&amp;"),o=o.replace(f,"&lt;").replace(l,c),o=o.replace(/(\r\n|\r|\n)/g,"<br>\n"),o=o.replace(h,"&gt;"),o=s._parseAngleBrackets(o),s.get("isContentForCompose")&&(o=s._convertTabsToSpaces(o)),e+='<div class="_stretch"><span class="body-text-content">'+o+"</span></div>"}else if(t.get("contentDisposition")&&n===CoreMail.IMAGE)if(t.get("contentID"))r[t.get("contentID")]=t;else{var p="",d=t.get("imageStyle");d||(d=""),d&&(d=' style="'+d+'"'),p='<img src ="'+u+'" alt="" class="'+Global.getImageOrientationCSSClassForImagePart(t)+'"'+d+">",e+=p}else if(t.contentID){r[t.get("contentID")]=t;if(!s.get("isContentForCompose")&&!t.get("isMailDrop")&&(t.get("iWorkFileType")||t.get("attachmentType")==="calendar")){var v='<span data-url="'+u+'"></span>',m=e.indexOf("</body>");m>-1?e=e.slice(0,m)+v+e.slice(m):e+=v}}}),this._isHTML=i,e=this._cidsToURLs(r,e),this._preScrubBody=e}else e=this._preScrubBody;this._isHTML!==YES&&(e="<body>"+e+"</body>");var o=/^\s*?(<\!DOCTYPE[^<>&;]*>)/i,u=e.match(o);u&&u[1]&&this.set("doctype",u[1])
;var a=/(<style[^>]*>\s*)<!--([\s\S]*?)--\s*>(\s*<\/style>)/ig;e=e.replace(a,"$1$2$3");var f=new RegExp("<!--[\\s\\S]*?-->","g");e=e.replace(f,"");var l=new RegExp("<![^>]*>|<\\?[^>*]*>","g");e=e.replace(l,"");var c;c=html_sanitize(e,{loadIMG:this.get("loadIMG"),isContentForCompose:this.get("isContentForCompose"),formSubmitWarningText:CoreMail.messageScrubber.get("formSubmitWarningText")}),e=c.output,c.hasUnloadedIMG?this.set("hasUnloadedIMG",YES):this.set("hasUnloadedIMG",NO);var h=c.styles,p=c.tagsRemoved;return h!==""&&this.set("messageStyles",'<style type="text/css" class="'+Message.EXISTING_STYLES_CLASS+'">'+h+"</style>"),p&&this.set("unsafeTagsRemoved",p),e=this.performDOMActionsOnBody(e),SC.Benchmark.end("CoreMail.MessageDetail: Processing (body)"),e}.property("message","loadIMG","orientationData","isContentForCompose","isTrusted").cacheable(),bodyForCompose:function(){var e;return this.set("isContentForCompose",YES),e=this.get("body"),this.set("isContentForCompose",NO),e}.property("body").cacheable(),pdfHtml:function(){return""}.property("message").cacheable(),_cidsToURLs:function(e,t){var n=t,r,i,s,o,u,a,f,l="";for(var c in e)e.hasOwnProperty(c)===YES&&(f=e[c],r=f.get("contentID"),r&&(r=r.substring(1,r.length-1),r=RegexHelper.escapeSpecialCharacters(r),i="cid:"+r,s=new RegExp(i,"g"),o=new RegExp("src=([\"|'])"+i,"ig"),f.get("isImage")&&f.get("size")<CoreMail.MAX_IMAP_BASE64_ATTACHMENT_SIZE&&(a=f.get("attachmentUrl"),l=Global.getImageOrientationCSSClassForImagePart(f),l.length>0&&(l="&x_orientation_class="+l),t=t.replace(o,"src=$1"+a+l),t=t.replace(s,a),u=new RegExp("<\\s*img[^>]*"+
i,"i"),n.search(u)===-1&&(t+='<img src="'+a+l+'">'))));return t},performDOMActionsOnBody:function(e){var t=e,n=NO,r=NO,i="_temp_src_",s=/(<body[^>]*>)([\s\S]*)(<\/body>)([\s\S]*)/,o=this.get("isContentForCompose"),u,a,f,l,c,h,p,d=NO;l=e.match(s),l||(e="<body>"+e+"</body>",t=e,l=e.match(s));var v=l[2],m=l[4];m&&(v+=m),l[0]&&l[1]&&l[3]&&v!==null&&v!==undefined&&(e=v,d=YES);if(d===NO)return CoreMail.errorHandler.recordStat("invalid_bodyTagArr"),t;if(e&&e.search(/<\s*img/i)>-1){u=new RegExp(i,"g"),a="src",f=new RegExp(a,"g"),e=e.replace(f,i),n=YES;var g="<\\s*img[^>]+"+i+'\\s*=\\s*"'+CoreMail.get("imapAttachmentBaseUrl")+'/[^"]*type=image';g=new RegExp(g,"i"),e.search(g)>-1&&(r=YES)}CoreMail.tempMessageBodyElement||(CoreMail.tempMessageBodyElement=SC.$("<html></html>")),c=CoreMail.tempMessageBodyElement;try{c.html(e)}catch(y){return SC.error(y.toString()),t}this._setPlainTextPreviewFromBodyElement(c),h=c[0],r&&this._removeUnsupportedInlineImages(c,i),n&&(h=this._processImgElements(h,i));var b,w=0;!o&&this.get("shouldValidateAnchorLinksInBody")&&(b=c.find("a"),w=b.length,w>0&&(this.get("isSuspicious")||this._validateLinksInBody(b,w))),p=Message.getMailDropBannerExpirationDateFromBody(h),p&&(this.set("mailDropBannerExpirationDate",p),h=Message.updateMailDropBannerAndCoupons(h,p,this.getPath("message.mimeParts"),o));if(!o){var E=this.get("isSuspiciousAndNotTrusted");w>0&&E===YES&&b.removeAttr("href"),E||this._addCustomHtml(c)}e=null;var S=h.getElementsByTagName("body")[0];return S?e=S.innerHTML:e=h.innerHTML,e&&e.length>0?(e=l[1]+e+l[3],n&&(e=e.replace(u,a))):(CoreMail.errorHandler
.recordStat("invalid_bodyString"),e=t),e},_setPlainTextPreviewFromBodyElement:function(e){var t=this.get("message");if(!t.get("computedPreview")){var n=e.html();n=n.replace(/></g,"> <");var r=SC.$("<html></html>").html(n),i=r.text().replace(/\s+/g," ").replace(/(<!?:--[\s\S]*?--\s*?>\s*)/g,"").replace(/(style[\s\S]*?<\/style>)/g,"").replace(/<[^>]+>/g,"").trim();i.length>CoreMail.DEFAULT_SNIPPET_LEN?i=i.substring(0,CoreMail.DEFAULT_SNIPPET_LEN).trim():i===""&&(i="_MessageList.EmptySnippet".loc()),t.set("computedPreview",i)}},_processImgElements:function(e,t){var n=e.getElementsByTagName("img"),r,i,s=new RegExp("(.*)(&x_orientation_class)(=|&#61;)("+CoreMail.IMAGE_ORIENTATION_CLASS_PREFIX+"orientation-[2345678])(.*)","i"),o=CloudOS.getUser(),u=o?o.get("dsid"):0,a,f,l,c,h;for(var p=0,d=n.length;p<d;p++){r=SC.$(n[p]),i=r.attr(t),l=r.attr("width"),c=r.attr("height");if(i){if(i.indexOf(CoreMail.get("imapAttachmentBaseUrl"))===0){r.attr("data-inline-image","true"),!c&&!l?r.addClass("_auto-scale"):r.removeClass("_auto-scale"),a=i.match(s);if(a&&a[4]){f=a[4],h=0;if(f===CoreMail.IMAGE_ORIENTATION_CLASS_PREFIX+"orientation-5"||f===CoreMail.IMAGE_ORIENTATION_CLASS_PREFIX+"orientation-6"||f===CoreMail.IMAGE_ORIENTATION_CLASS_PREFIX+"orientation-7"||f===CoreMail.IMAGE_ORIENTATION_CLASS_PREFIX+"orientation-8")c>0&&l>0&&(h=l-c,h<0&&(h*=-1)),c>0&&r.attr("width",c),l>0&&r.attr("height",l),f===CoreMail.IMAGE_ORIENTATION_CLASS_PREFIX+"orientation-5"||f===CoreMail.IMAGE_ORIENTATION_CLASS_PREFIX+"orientation-8"?h>0&&r.css("padding-bottom",h+"px"):(f===CoreMail.IMAGE_ORIENTATION_CLASS_PREFIX+"orientation-6"||
f===CoreMail.IMAGE_ORIENTATION_CLASS_PREFIX+"orientation-7")&&h>0&&r.css("padding-top",h+"px");r.addClass(a[4]),r.attr(t,i.replace(s,"$1$5"))}}if(/https:\/\/[^\/]*\/wm\/messagepart\//.test(i))try{var v=URI(i),m=v.query(YES).dsid;m!==u&&r.removeAttr(t)}catch(g){SC.warn(g+": img src - "+i)}}}return e},_convertTabsToSpaces:function(e){var t,n,r,i,s,o,u=e.split("\n"),a=[],f=4;for(var l=0,c=u.length;l<c;l++){n=u[l];if(n&&n.length>0)while((t=n.indexOf("	"))!==-1)r=n.substr(0,t),s=f-t%f,o=this._stringRepeat(" &nbsp;",s),i=n.substr(t+1),n=r+o+i;a.push(n)}return a.join("\n")},_stringRepeat:function(e,t){return(new Array(t+1)).join(e)},customStyles:function(e,t){var n;return t===undefined?(this._customStyles===undefined&&(this.get("messageStyles")?this._customStyles=ViewMessage._getCustomStyles():this._customStyles=""),n=this._customStyles):this._customStyles=t,n}.property("messageStyles").cacheable(),init:function(){arguments.callee.base.apply(this,arguments);var e=CoreMail.store.find(CoreMail.ServerPreferences,CoreMail.SERVER_PREFS_GUID).get("loadImagesInHTML");this.set("loadIMG",e),this.set("didUserChangeLoadImgPref",NO)},processedLongHeader:function(){var e=this.get("longHeader"),t;if(e.length<=0)t=[];else{e=e.split("\r\n"),t=[];if(e.length>0){var n,r;for(var i=0,s=e.length;i<s;i++)if(e[i].length>0){n=e[i].split(": ");if(n.length<2)continue;if(n.length===2)r=n[1];else if(n.length>2){var o=n.splice(1);r=o.join(": ")}t.push(SC.Object.create({key:n[0],value:r}))}}}return t}.property("longHeader").cacheable(),xMailerHeader:function(){var e,t,n;return e=this.get("processedLongHeader"),
e&&(t=e.filterProperty("key","X-Mailer"),t.get("length")>0&&(n=t[0].value)),n}.property("processedLongHeader").cacheable(),junkContext:function(){var e=this.get("message");if(e&&e.get("folder"))return e.get("junk")===YES?CoreMail.JUNK_FLAG:this.get("longHeader").indexOf(CoreMail.SPAM_HEADER)>=0?CoreMail.JUNK_SPAM:e.get("folder").get("role")===CoreMail.FOLDER_ROLE_JUNK?CoreMail.JUNK_OTHER:undefined}.property("longHeader"),_parseAngleBrackets:function(e){var t=e.split("\n"),n,r,i,s;for(var o=0,u=t.length;o<u;o++){n=t[o];var a=/(?:&gt;)*(.*)<br>/i,f=n.match(a),l=f!==null?f[1]:null;l&&l.trim().length>0&&(n=n.substring(0,n.length-4)),r=NO,i=0,s="";while(n.indexOf("&gt;")===0)i++,n=n.substring(4,n.length),s+='<blockquote type="cite" class="quoted-plain-text">',r=YES;if(r){s+=n;while(i>0)i--,s+="</blockquote>";t[o]=s}}return e=t.join(""),e},isMailDropMessage:function(){var e=this.get("mailDropBannerExpirationDate"),t=NO;return e&&(t=YES),t}.property("mailDropBannerExpirationDate").cacheable(),_removeUnsupportedInlineImages:function(e,t){var n=this.getPath("message.mimeParts"),r,i,s;for(var o=0,u=n.get("length");o<u;o++)r=n.objectAt(o),r.get("isImage")&&r.get("canImageBeDisplayedInline")===NO&&(i=r.get("attachmentUrl"),s=e.find("img["+t+"$='"+i+"']"),s.remove())},_addCustomHtml:function(e){var t=e.find(".x-apple-signature").not("blockquote .x-apple-signature"),n=this.getPath("message.mimeParts"),r=NO,i=NO,s,o,u,a;for(var f=0,l=n.get("length");f<l;f++)s=n.objectAt(f),o=s.get("isMailDrop"),a="",s.get("iWorkFileType")?(o===NO&&(a=Message.iWorkCouponForMessagePart(s)),r=YES):s.get("attachmentType"
)==="calendar"&&o===NO&&(a=Message.icsHtmlForMessagePart(s),i=YES),a&&(u=e.find('span[data-url="'+s.get("attachmentUrl")+'"]'),t.length>0&&u.index()>t.index()?(t.before(a),u.remove()):u.replaceWith(a));var c=this.get("viewMessageSpecificStyles")||"",h="";r&&c.indexOf(".iwork-app-icon")===-1&&(h+=ViewMessage.get("iWorkCouponStyle")),i&&c.indexOf(".ics-attachment-image")===-1&&(h+=ViewMessage.get("icsStyle")),h&&this.set("viewMessageSpecificStyles",c+h)},_validateLinksInBody:function(e,t){var n,r,i,s,o;for(var u=0;u<t;u++){try{n=e[u],r=n.href}catch(a){SC.error(a),this._markAsSuspicious();break}i=n.innerText||n.textContent;if(r&&i){r=r.toLowerCase(),i=i.toLowerCase(),r=r.toLowerCase(),/^https?:\/\//.test(i)||(i="http://"+i);if(RegexHelper.isValidUrlDomain(i)&&RegexHelper.isValidUrlDomain(r))try{s=URI(i).domain(),o=URI(r).domain();if(o&&s&&o!==s){this._markAsSuspicious();break}}catch(a){SC.error("CoreMail.MessageDetail.body: url malformed: "+a)}}}},_markAsSuspicious:function(){this.set("isSuspicious",YES),CoreMail.errorHandler.recordStat("_scrubbed_suspicious_links_in_body")}}),CoreMail.MessagePart=SC.Record.extend({ignoreUnknownProperties:YES,contentCode:SC.Record.attr(Number,{isRequired:YES}),datatype:SC.Record.attr(String),content:SC.Record.attr(String),contentDisposition:SC.Record.attr(String),url:SC.Record.attr(String),filename:SC.Record.attr(String),name:SC.Record.attr(String),related:SC.Record.attr(String),contentID:SC.Record.attr(String),size:SC.Record.attr(Number),hasCID:SC.Record.attr(Boolean,{defaultValue:NO}),mailDropRecordId:SC.Record.attr(String),mailDropUploadUrl:
SC.Record.attr(String),mailDropAuthToken:SC.Record.attr(String),mailDropReferenceSignature:SC.Record.attr(String),mailDropWrappingKey:SC.Record.attr(String),mailDropStreamingUrl:SC.Record.attr(String),mailDropPublishedUrl:SC.Record.attr(String),mailDropExpirationDate:SC.Record.attr(Number),mailDropHeaderName:SC.Record.attr(String),isMailDropThumbnail:SC.Record.attr(Boolean,{defaultValue:NO}),thumbnailMessagePart:SC.Record.toOne("CoreMail.MessagePart"),orientation:SC.Record.attr(Number,{defaultValue:null}),remoteThumbnailUrl:SC.Record.attr(String),dataPlaceholderUUID:SC.Record.attr(String),toHash:function(){return{type:this.get("type"),guid:this.get("guid"),contentCode:this.get("contentCode"),datatype:this.get("datatype"),content:this.get("content"),contentDisposition:this.get("contentDisposition"),url:this.get("url"),filename:this.get("filename"),name:this.get("name"),related:this.get("related"),contentID:this.get("contentID"),size:this.get("size"),hasCID:this.get("hasCID"),isVCF:this.get("isVCF"),isMailDrop:this.get("isMailDrop"),mailDropAuthToken:this.get("mailDropAuthToken"),mailDropReferenceSignature:this.get("mailDropReferenceSignature"),mailDropStreamingUrl:this.get("mailDropStreamingUrl"),mailDropPublishedUrl:this.get("mailDropPublishedUrl"),mailDropUploadUrl:this.get("mailDropUploadUrl"),mailDropExpirationDate:this.get("mailDropExpirationDate"),mailDropHeaderName:this.get("mailDropHeaderName"),isMailDropThumbnail:this.get("isMailDropThumbnail"),mailDropRecordId:this.get("mailDropRecordId"),mailDropWrappingKey:this.get("mailDropWrappingKey"),thumbnailMessagePart:this.
get("thumbnailMessagePart"),orientation:this.get("orientation"),remoteThumbnailUrl:this.get("remoteThumbnailUrl"),dataPlaceholderUUID:this.get("dataPlaceholderUUID")}},isPackageLikeFile:function(){var e=this.get("localFile");if(!e)return NO;var t=this.get("attachmentName"),n;t&&(n=CoreMail.extensionForFileName(t));var r=e.rawFileSize;return["key","pages","numbers","kth","template","nmbtemplate"].indexOf(n)>=0&&r<2e3||Attachments&&Attachments.INVALID_FILE_EXTS.indexOf(n)>=0?YES:NO}.property("localFile","attachmentName"),attachmentName:function(){var e=this.get("filename")||this.get("name");if(!e&&this.get("contentCode")===CoreMail.IMAGE){e="_MessageView.UnnamedAttachment.FilenamePrefix".loc();var t=this._imageFileExtensionFromDataType(this.get("datatype"));e+="."+t,this.set("filename",e),this._attachmentHadNoFilename=YES}return e}.property("contentType","datatype","name","filename").cacheable(),sizeString:function(){var e=this.get("size"),t=this.get("isUploaded");return t===YES||e!==0&&e!==null?e===null?"":(e=Global.getFormattedFileSize(e),"_ComposeMessage.AttachmentSize".loc(e.size,e.sizeUnits.loc())):"(%@)".fmt("_ComposeMessage.AttachFileInProgress".loc())}.property("size").cacheable(),isUploaded:function(){var e=this.get("guid"),t=e?YES:NO;return t}.property("guid"),attachmentUrl:function(){var e=null;if(this.get("isAttachment")){e=this.get("url");var t=this.get("mailDropStreamingUrl");if(e&&!this._attachmentHadNoFilename)e=CoreMail.addServiceUrlDsidAndClientIdToUrl(e);else if(t)e=t;else{var n=URI.encodeQuery(this.get("guid")),r=URI.encodeQuery(this.get("attachmentName"));
r=r.replace(/\+/g,"%20");var i=URI.encodeQuery(this.get("datatype"));e=CoreMail.get("imapAttachmentBaseUrl")+"/"+r+"?guid="+n+"&name="+r+"&type="+i+"&clientUrl=true",this._attachmentHadNoFilename?CoreMail.errorHandler.recordStat("_count_MessagePart_attachmentUrl_no_filename_found"):CoreMail.errorHandler.recordStat("_count_MessagePart_attachmentUrl_no_base_url_found"),e=CoreMail.addServiceUrlDsidAndClientIdToUrl(e)}}return e}.property("url","mailDropStreamingUrl","datatype","guid","attachmentName").cacheable(),attachmentType:function(){var e=this.get("datatype"),t="application",n=this.get("attachmentName"),r;return n&&(r=this.get("fileExtension")),e&&(e.indexOf("audio")>=0?t="audio":e.indexOf("video")>=0?t="video":e.indexOf("image/")===0?t="image":e.indexOf("/calendar")>=0||r==="ics"?t="calendar":e.indexOf("/pdf")>=0||r==="pdf"?t="pdf":t="application"),t}.property("datatype","attachmentName").cacheable(),icon:function(){var e=this.get("attachmentName"),t="generic-image ",n=e?e.split("."):[];return n.length>1&&(t+=e.split(".").lastObject().toLowerCase()),t}.property("attachmentType","attachmentName").cacheable(),attachmentDisplayName:function(){var e=this.get("attachmentName")||"";if(e){var t=e.lastIndexOf("."),n="";t>1&&(n=e.substring(t+1,e.length),e=e.substring(0,t));if(e){var r=e.length,i=CoreMail.ATTACHMENT_NAME_LENGTH,s=r>i+CoreMail.ATTACHMENT_NAME_TRUNCATION_BUFFER?YES:NO,o=n.length>8?YES:NO;switch(!0){case!s&&n.length===0:e=e;break;case s&&n.length===0:e=e.substring(0,i/2)+"…"+e.substring(r-i/2,e.length);break;case!s&&!o:e=e+"."+n;break;case s&&!o:e=e.substring(0,i/2)+"…"+
e.substring(r-i/2,e.length)+"."+n;break;case s&&o:e=e.substring(0,i)+"…"+n.substr(n.length-7,7);break;case!s&&o:e=e+"…"+n.substr(n.length-7,7)}}}return e}.property("attachmentName").cacheable(),attachmentDisplayNameWithoutExtension:function(){var e=this.get("attachmentDisplayName"),t=this.get("fileExtension"),n="\\."+t+"(\\.zip)*$",r=new RegExp(n);if(e)return e.replace(r,"")}.property("attachmentDisplayName","fileExtension").cacheable(),attachmentDetails:function(){var e=this.get("sizeString"),t=this.get("attachmentDisplayName");return e!==""?t+" "+e:t}.property("attachmentName","sizeString").cacheable(),isAttachment:function(){var e=this.get("attachmentName"),t=e?YES:NO;return t}.property("attachmentName").cacheable(),isVCF:function(){var e=NO,t=this.get("attachmentName");if(t){var n=this.get("fileExtension"),r=this.get("content");if(r&&n==="vcf"){var i=r.indexOf("BEGIN:VCARD");i===0&&(e=YES)}}return e}.property("content","attachmentName").cacheable(),isImage:function(){var e=this.get("datatype");return this.get("contentCode")===CoreMail.IMAGE||e&&e.indexOf("image/")===0?YES:NO}.property("contentCode","datatype").cacheable(),canImageBeDisplayedInline:function(){var e=this.get("datatype"),t=NO;if(e){var n=e.split("/");n[0]==="image"&&Message.IMAGE_TYPE_WHITELIST.contains(n[1].toLowerCase())&&(t=YES)}return t}.property("datatype").cacheable(),isMailDrop:function(){var e=this.get("mailDropReferenceSignature"),t=this.get("mailDropStreamingUrl"),n=this.get("mailDropHeaderName");return e||n||t?YES:NO}.property("mailDropReferenceSignature","mailDropHeaderName","mailDropStreamingUrl"
).cacheable(),isExpired:function(){var e=this.get("mailDropExpirationDate"),t=NO,n;return e?(n=Message.checkIfDateIsExpired(e),n&&(t=YES),t):t}.property("mailDropExpirationDate").cacheable(),expirationDateString:function(){var e=this.get("mailDropExpirationDate"),t="";return e&&(t=CoreMail.numberFormatter.millisecondsToDateString(e)),t}.property("mailDropExpirationDate").cacheable(),keynoteFiles:["key","ppt","pptx","pps","ppsx"],pagesFiles:["pages","txt","doc","docx","dot","dotx"],numbersFiles:["numbers","xls","xlt","xla","xlsx","xltx","xlsm","xlam","csv"],zippedIWorkFiles:["key.zip","pages.zip","numbers.zip"],iWorkFileType:function(){var e=null,t=this.get("fileExtension");return this.keynoteFiles.indexOf(t)>=0?e=CoreMail.IWORK_KEYNOTE_FILE:this.pagesFiles.indexOf(t)>=0?e=CoreMail.IWORK_PAGES_FILE:this.numbersFiles.indexOf(t)>=0&&(e=CoreMail.IWORK_NUMBERS_FILE),e}.property("fileExtension").cacheable(),fileExtension:function(){var e,t=this.get("attachmentName");return t&&(e=CoreMail.extensionForFileName(t),e.lastIndexOf(".zip")>-1&&(this.zippedIWorkFiles.indexOf(e)>-1?e=e.replace(".zip",""):e="zip")),e}.property("attachmentName").cacheable(),localFile:null,localUrl:function(e,t){var n=this.get("localFile"),r;return t!==undefined?r=t:n&&!n.isRemote&&window.URL&&URL.createObjectURL?r=URL.createObjectURL(n):r=null,r}.property("localFile").cacheable(),previousLocalUrl:null,dropEntry:null,isFileUploaded:NO,uploadedImageFileUrl:function(){var e;return this.get("isImage")&&this.get("isFileUploaded")&&(e=this.get("previousLocalUrl")||this.get("localUrl")||this.get("attachmentUrl")),e
}.property("isImage","localUrl","attachmentUrl","isFileUploaded","previousLocalUrl").cacheable(),canHaveThumbnail:function(){return this.get("isImage")&&(this.get("size")<CoreMail.ATTACHMENT_IMAGE_THUMBNAIL_GENERATE_LIMIT||this.get("remoteThumbnailUrl"))?YES:NO}.property("isImage","size","remoteThumbnailUrl").cacheable(),contentUrl:null,_imageFileExtensionFromDataType:function(e){var t;e=e.toLowerCase();switch(e){case"image/png":t="png";break;case"image/jpeg":t="jpg";break;case"image/jpg":t="jpg";break;case"image/gif":t="gif";break;case"image/tiff":t="tiff";break;case"image/bmp":t="bmp";break;case"image/x-windows-bmp":t="bmp";break;case"image/vnd.adobe.photoshop":t="psd";break;default:t="",CoreMail.errorHandler.recordStat("_MessagePart_imageFileExtensionFromDataType_no_extension_for_type",e)}return t}}),require("core"),CoreMail.RuleList=SC.Record.extend({primaryKey:"id",ruleState:SC.Record.attr(String,{defaultValue:"S",isRequired:YES,isCacheable:!1}),folderValid:SC.Record.attr(Boolean,{defaultValue:!0,isRequired:YES,isCacheable:!1}),id:SC.Record.attr(Number),order:SC.Record.attr(Number)}),require("core"),CoreMail.ServerPreferences=SC.Record.extend({country:SC.Record.attr(String),tzOffset:SC.Record.attr(Number),showMessagePreviews:SC.Record.attr(Boolean,{defaultValue:YES}),displayArchiveInseadOfTrash:SC.Record.attr(Boolean,{defaultValue:NO}),saveSent:SC.Record.attr(Boolean,{defaultValue:YES}),sentFolder:SC.Record.attr(String),sentFolderGuid:function(){var e=this.get("sentFolder");return CoreMail.findLocalFolder(e)?e:CoreMail.SENT_GUID}.property("sentFolder").cacheable(),moveTrash
:SC.Record.attr(Boolean,{defaultValue:YES}),trashFolder:SC.Record.attr(String),trashFolderGuid:function(){var e=this.get("trashFolder");return CoreMail.findLocalFolder(e)?e:CoreMail.TRASH_GUID}.property("trashFolder").cacheable(),forwardEmail:SC.Record.attr(Boolean,{defaultValue:NO}),forwardEmailAddress:SC.Record.attr(String),deleteMessageAfterForwarding:SC.Record.attr(Boolean,{defaultValue:NO}),includeOriginalMessageInReply:SC.Record.attr(Boolean,{defaultValue:YES}),includeOriginalAttachmentsInReply:SC.Record.attr(Boolean,{defaultValue:YES}),sendMailFromAddress:SC.Record.attr(String),useSignature:SC.Record.attr(Boolean,{defaultValue:NO}),signature:SC.Record.attr(String,{defaultValue:"_Preferences.Signature".loc()}),useMailDrop:SC.Record.attr(Boolean,{defaultValue:null}),"~mailDropMaxSizeKB":SC.Record.attr(Number,{defaultValue:5e6}),mailDropMaxSize:function(){var e=this.get("~mailDropMaxSizeKB");return e*1e3}.property("~mailDropMaxSizeKB").cacheable(),"~mailDropExpiresAfterSeconds":SC.Record.attr(Number,{defaultValue:2592e3}),mailDropExpiresAfterDays:function(){return this.get("~mailDropExpiresAfterSeconds")/86400}.property("~mailDropExpiresAfterSeconds").cacheable(),"~whitelistedDownloadDomains":SC.Record.attr(Array,{defaultValue:[".digitalhub.com",".icloud.com"]}),loadImagesInHTML:SC.Record.attr(Boolean,{defaultValue:YES}),enableVacationReply:SC.Record.attr(Boolean,{defaultValue:NO}),vacationReply:SC.Record.attr(String),vacationStartDate:SC.Record.attr(Number),vacationEndDate:SC.Record.attr(Number),toHash:function(){return{type:this.get("type"),guid:this.get("guid"),language
:this.get("language"),tzOffset:this.get("tzOffset"),saveSent:this.get("saveSent"),sentFolder:this.get("sentFolder")?this.get("sentFolder"):null,moveTrash:this.get("moveTrash"),trashFolder:this.get("trashFolder")?this.get("trashFolder"):null,instantFiling:this.get("instantFiling"),instantFilingFolder:this.get("instantFilingFolder")?this.get("instantFilingFolder").get("guid"):null,forwardEmail:this.get("forwardEmail"),forwardEmailAddress:this.get("forwardEmailAddress"),deleteMessageAfterForwarding:this.get("deleteMessageAfterForwarding"),includeOriginalMessageInReply:this.get("includeOriginalMessageInReply"),includeOriginalAttachmentsInReply:this.get("includeOriginalAttachmentsInReply"),sendMailFromAddress:this.get("sendMailFromAddress"),useSignature:this.get("useSignature"),signature:this.get("signature"),loadImagesInHTML:this.get("loadImagesInHTML"),enableLongHeaders:this.get("enableLongHeaders"),enableVacationReply:this.get("enableVacationReply"),vacationReply:this.get("vacationReply"),vacationStartDate:this.get("vacationStartDate"),vacationEndDate:this.get("vacationEndDate"),showFirstRun:this.get("showFirstRun"),showMessagePreviews:this.get("showMessagePreviews"),displayArchiveInseadOfTrash:this.get("displayArchiveInseadOfTrash"),useMailDrop:this.get("useMailDrop"),"~mailDropMaxSizeKB":this.get("~mailDropMaxSizeKB"),"~mailDropExpiresAfterSeconds":this.get("~mailDropExpiresAfterSeconds"),"~whitelistedDownloadDomains":this.get("~whitelistedDownloadDomains")}}}),CoreMail.VipSender=SC.Record.extend({name:SC.Record.attr(String,{isRequired:YES}),addresses:SC.Record.attr(Array,{isRequired
:YES}),vipFolder:SC.Record.toOne("CoreMail.Folder"),toHash:function(){return CoreMail.store.readDataHash(this.get("storeKey"))}}),Message=SC.Object.create({}),Message.messageController=SC.ObjectController.create({content:null,contentDidChange:function(){var e=Message.getPath("appNamespace.mode");if(window.ViewMessage&&ViewMessage.get("isPreview")===YES||window.WHAT_TYPE.isMailChild()===YES&&e===CoreMail.MESSAGE_MODE_VIEW){var t=this.get("content");ViewMessage._isDispatching=NO,t&&t.get("status")!==SC.Record.DESTROYED_CLEAN?this.invokeLast(this.dispatchLoadMessage):ViewMessage.dispatch({sig:"noContent"})}else Message.messageDetailController.set(this.getPath("content.messageDetail"))}.observes("content"),dispatchLoadMessage:function(){ViewMessage.dispatch({sig:"loadMessage"})},getFormattedDate:function(e){var t,n,r,i,s,o=this.getPath("content.localizedDate");if(o){var u=CoreMail.timeZoneConverter,a=u.get("currentDate"),f=u.compare(a,o);if(f<0||e)t=u.getFormattedDate(o,u.get("monthInWordsDateFormat"));else{var l=f/CoreMail.MINUTE_LENGTH_IN_MILLISECONDS,c=f/CoreMail.WEEK_LENGTH_IN_MILLISECONDS,h=f/CoreMail.DAY_LENGTH_IN_MILLISECONDS,p=f/CoreMail.HOUR_LENGTH_IN_MILLISECONDS,d;0<l&&l<1?d=1:d=Math.round(l);var v;c>1?v=Math.round(c):v=c;var m;0<h&&h<1?m=h:m=Math.round(h);var g;0<p&&p<1?g=p:g=Math.round(p),r=o.getDate()===a.getDate()&&o.getMonth()===a.getMonth()&&o.getFullYear()===a.getFullYear(),r||(n=u.get("yesterdayDate"),i=o.getDate()===n.getDate()&&o.getMonth()===n.getMonth()&&o.getFullYear()===n.getFullYear()),v>4?t=u.getFormattedDate(o,u.get("monthInWordsDateFormat")):v>=1&&v<=4?
v===1?t="_MessageView.OneWeekAgo".loc():t="_MessageView.WeeksAgo".loc(v):g>=12&&!r&&!i&&v<1?m<=1?t="_MessageView.OneDayAgo".loc():t="_MessageView.DaysAgo".loc(m):g>=12&&i?t="_MessageView.Collapsed.Yesterday".loc():g>=12&&r?t="_MessageView.Collapsed.Today".loc():g>=1&&g<12?g===1?t="_MessageView.OneHourAgo".loc():t="_MessageView.HoursAgo".loc(g):g<1&&(d===1?t="_MessageView.OneMinuteAgo".loc():t="_MessageView.MinutesAgo".loc(d))}var y=u.getFormattedDate(o,u.get("messageSavedOrReceivedTime"));s="_MessageView.DateWithTime".loc({date:t,time:y})}return s}}),Message.messageDetailController=SC.ObjectController.create({content:null,contentDidChange:function(){var e=this.getPath("content.unsafeTagsRemoved");if(!SC.$.isEmptyObject(e)){var t=Math.floor(Math.random()*10+1);if(t===1){var n=Object.keys(e);n=n.join(","),CoreMail.errorHandler.recordStat("MessageDetail_HtmlSanitize_Result",{tagsRemoved:n})}}}.observes("content")}),Message.messageListController=SC.ArrayController.create({content:null,isKeyDown:NO,allowsEmptySelection:YES,msgDragIndex:null,isRefreshViewVisible:NO,isJunk:function(){if(this.get("isUnloadedMessageSelected"))return NO;var e=this.get("selection");if(e){var t=e.getEach("isMessageJunk");if(t.indexOf(NO)>=0)return NO}return YES}.property("selection"),areUnloadedMessagesMarkedAsFlagged:YES,isFlagged:function(){if(this.get("isUnloadedMessageSelected"))return this.get("areUnloadedMessagesMarkedAsFlagged");var e=this.get("selection");if(e){var t=e.getEach("flagged");if(t.indexOf(YES)>=0)return YES}return NO}.property("selection","areUnloadedMessagesMarkedAsFlagged"),areUnloadedMessagesMarkedAsUnread
:YES,isUnread:function(){if(this.get("isUnloadedMessageSelected"))return this.get("areUnloadedMessagesMarkedAsUnread");var e=this.get("selection");if(e){var t=e.getEach("unread");if(t.indexOf(YES)>=0)return YES}return NO}.property("selection","areUnloadedMessagesMarkedAsUnread"),isJunkingEnabled:function(){var e=this.get("isUnloadedMessageSelected"),t=this.getPath("firstObject.folder.role");return YES===e||CoreMail.FOLDER_ROLE_DRAFTS===t||CoreMail.FOLDER_ROLE_SENT===t?NO:YES}.property("isUnloadedMessageSelected").cacheable(),isUnloadedMessageSelected:function(){if(window.ViewMessage&&ViewMessage.get("isPreview")===NO)return NO;var e=YES,t=this.get("arrangedObjects"),n=this.get("selection");if(n&&n.get("length")>0){var r=n.indexSetForSource(t),i=CoreMail.definedMessageIndexes(n,t);r&&r.isEqual(i)&&(e=NO)}return e}.property("selection").cacheable(),updateSelectionAfterContentChange:function(){var e=arguments.callee.base.apply(this,arguments),t=this.getPath("content.firstObject.folder.guid"),n=this.getPath("content.length");if(!t||n<=0||this._lastSelFolder!==t)this.set("selection",null);else if(this._lastContentLength<n&&this._prevSelection)this.selectObjects(this._prevSelection.toArray());else if(this._lastContentLength>n&&this._prevSelIndexSet){var r=this.get("msgDragIndex");if(r&&this._prevSelIndexSet&&!this._prevSelIndexSet.contains(r)){var i=this._prevSelIndexSet.toArray(),s=r.get("firstObject"),o=[];for(var u=0,a=this._prevSelIndexSet.get("length");u<a;u++)i[u]>s?(i[u]--,o.push(this.objectAt(i[u]))):o.push(this.objectAt(i[u]));this.selectObjects(o)}else{var f=MessageList.
get("state");if(f!=="3.0 Waiting for Content"&&f!=="3.3 Resyncing"){var l=CoreMail.get("implicitPreferences"),c=l.get("messageSortAscending"),h;c?h=this._prevSelIndexSet.get("firstObject"):h=this._prevSelIndexSet.get("firstObject")-1,h=h<0?0:h===n?h-1:h,this.selectObject(this.objectAt(h))}}}return this._lastContentLength=n,this._lastSelFolder=t,this.set("msgDragIndex",null),e},selectionDidChange:function(){var e=this.get("selection"),t;e&&e.get("length")===1&&(t=e.get("firstObject"),t&&t.get("unread")&&t.get("messageDetail")&&(t.serverClearUnread=YES)),this.invokeOnce(this.updateControllersOnSelectionChange),this.set("areUnloadedMessagesMarkedAsUnread",YES),this.set("areUnloadedMessagesMarkedAsFlagged",YES)}.observes("selection"),updateControllersOnSelectionChange:function(){var e=this.get("selection"),t=Message.messageDetailController;if(e){var n=this.get("arrangedObjects"),r=Message.messageController,i=e.get("firstObject");if(1===e.get("length")&&i){if(this.get("isKeyDown")===YES)return;i!==r.get("content")&&(r.set("content",i),t.set("content",null),i.get("unread")===YES&&(i.get("serverClearUnread")===YES?(CoreMail.setMessageFlag(CoreMail.MESSAGE_FLAG_UNREAD,NO,i),i.set("serverClearUnread",undefined)):(CoreMail.updateUnreadFlag(NO,e,n),this.notifyPropertyChange("isUnread"))))}else r.set("content",null),t.set("content",null);this._prevSelection=e,this._prevSelIndexSet=e.indexSetForSource(n)}else this._prevSelIndexSet=null},updateControllerContentOnKeyUp:function(){var e=this.get("selection");if(e){var t=e.get("firstObject");1===e.get("length")&&t&&t!==Message.messageController
.get("content")&&this.updateControllersOnSelectionChange()}}}),Message.searchController=SC.ObjectController.create({_searchFieldValue:"",searchPaneVisible:NO,performSearch:function(e){var t=this.get("searchFieldValue");if(this._prevSearchVal===null||this._prevSearchVal!==t)this._prevSearchVal=t;this._timer!==null&&this._timer!==undefined&&this._timer.invalidate();var n=CoreMail.INTERVAL_SEARCH_KEY_PRESS;e&&e.keyCode===SC.Event.KEY_RETURN&&(n=CoreMail.INTERVAL_SEARCH_ENTER),this._timer=this._performSearch.invokeLater(this,n,t)},_prevSearchVal:null,searchFieldValue:function(e,t){return t!==undefined&&(this._searchFieldValue=t),this._searchFieldValue}.property(),searchFieldValueDidChange:function(){var e=this.get("searchFieldValue"),t=this.get("searchPaneVisible");t||this.set("searchPaneVisible",YES),this.set("shouldShowClearSearch",e&&e.length>0),this.performSearch()}.observes("searchFieldValue"),shouldShowClearSearch:NO,clearSearchField:function(){var e=Mail.getPath("mainPage.mainPane.dockView.searchContainerView.searchWrapper.searchView.searchTextView");Global.clearSearchField(this,e)},_performSearch:function(e){MessageList.dispatch({sig:"showSearch",searchTextValue:e})}}),SC.mixin(Message,{IMAGE_TYPE_WHITELIST:["png","jpeg","jpg","gif","bmp"],BROWSER_SPECIFIC_IMAGE_TYPE_WHITELIST:{safari:["tiff","vnd.adobe.photoshop"],chrome:["webp"],mozilla:[],msie:["tiff"],edge:["tiff"]},EXISTING_STYLES_CLASS:"existing-message-styles",DYNAMIC_STYLES_CLASS:"icloud-message-dynamic-styles",BASE_STYLES_CLASS:"icloud-message-base-styles",configure:function(e){e!==undefined&&this.set("appNamespace"
,e);var t=window.location.href;t.indexOf("expireMailDrop")>-1&&(this._expireMailDrop=YES);var n=this.BROWSER_SPECIFIC_IMAGE_TYPE_WHITELIST[SC.browser.current];n&&this.IMAGE_TYPE_WHITELIST.pushObjects(n)},setMessageList:function(e){e&&this.messageListController.set("content",e)},setSelectedMessage:function(e){e&&e instanceof CoreMail.Message&&(this.messageListController.set("content",[e]),this.messageListController.selectObject(e),this.messageListController.notifyPropertyChange("isJunkingEnabled"))},setMessageFlag:function(e,t){var n=this.messageListController,r=n.get("selection"),i=CoreMail.MESSAGE_FLAG_UNREAD,s=CoreMail.MESSAGE_FLAGGED,o,u;u=r?r.get("length"):0,u===0?o=null:u===1?o=r.get("firstObject"):o=r,this._setMessageFlagRequest=CoreMail.setMessageFlag(e,t,o,this.messageListController.get("arrangedObjects"));if(n.getPath("selection.length")>1)switch(e){case i:ViewMessage.multiSelectionController.isUnreadDidChange();break;case s:ViewMessage.multiSelectionController.isFlaggedDidChange()}if(n.get("isUnloadedMessageSelected")){var a=function(){var r=this._setMessageFlagRequest;if(r.get("state")===r.STATE_SUCCESS){var o;switch(e){case i:o="areUnloadedMessagesMarkedAsUnread";break;case s:o="areUnloadedMessagesMarkedAsFlagged"}o&&n.set(o,t)}r.removeObserver("state",this,a)};this._setMessageFlagRequest.addObserver("state",this,a)}return this._setMessageFlagRequest},isMessageInDraftsOrSentFolder:function(){var e=Message.messageListController.getPath("selection.firstObject.folder.role");return!e||CoreMail.FOLDER_ROLE_DRAFTS!==e&&CoreMail.FOLDER_ROLE_SENT!==e?NO:YES},unreadMessageSelected
:function(){return Message.messageListController.get("isUnread")}.property(),flaggedMessageSelected:function(){return Message.messageListController.get("isFlagged")}.property(),junkMessageSelected:function(){return Message.messageListController.get("isJunk")}.property(),iWorkCouponForMessagePart:function(e){var t=e.get("iWorkFileType");if(!t){SC.warn("Message.iWorkCouponForMessagePart: Invalid message part, expected iWork part");return}var n=SC.RenderContext.escapeHTML(e.get("attachmentDisplayNameWithoutExtension")),r=SC.RenderContext.escapeHTML(e.get("sizeString")),i=e.get("attachmentUrl").replace(/'/g,"\\'"),s=e.get("attachmentName").replace(/'/g,"\\'");i=Global.escapeHTMLAndQuotes(i);var o;switch(t){case CoreMail.IWORK_KEYNOTE_FILE:o="_MessageView.iWork.Picker.Button.OpenInKeynote".loc();break;case CoreMail.IWORK_PAGES_FILE:o="_MessageView.iWork.Picker.Button.OpenInPages".loc();break;case CoreMail.IWORK_NUMBERS_FILE:o="_MessageView.iWork.Picker.Button.OpenInNumbers".loc()}var u,a,f=SC.browser,l=e.get("fileExtension");return window.location.hostname!=="www.icloud.com"?u='<a style="font-weight:500; text-decoration: none; color: #dadada; cursor: default;">'+o+"</a>":u="<a onclick=\"javascript:window.parent.ViewMessage.openIWorkDocument('%{attachmentName}', '%{fileExtension}', '%{attachmentUrl}', '%{iWorkFileType}')\" style=\"font-weight:500; text-decoration: none; color: #0A8DE9; cursor: pointer;\">%{openInAppButton}</a>".fmt({attachmentName:Global.escapeHTMLAndQuotes(s),fileExtension:Global.escapeHTMLAndQuotes(l),attachmentUrl:i,iWorkFileType:t,openInAppButton:o}),f.isEdge||
f.isIE?a="0px 0px 3px":a="0px 1px 2px",'<div style="border:1px solid #d1d1d1; border-radius: 15px; min-width:350px; height:125px; margin:15px 15px 15px 0px; display: inline-block; white-space: nowrap; vertical-align: middle;"><div style="display:inline-block; width:100px; height:125px;"><div class="iwork-app-icon '+t+'" style="width:72px; height:93px; display:inline-block;  margin:16px 0 0 16px; box-shadow: '+a+' rgba(0,0,0,0.3);">'+"</div>"+"</div>"+'<div style="display:inline-block; vertical-align: top; margin:17px 15px 17px 15px;">'+'<div style="font-weight: 500; height: 22px;">'+n+"</div>"+'<div  style="font-weight: 300">'+r+"</div>"+'<div style="margin-top:20px;">'+'<a onclick="javascript:window.parent.ViewMessage.downloadIWorkDocument('+"'"+i+"',"+"'"+t+"'"+')" class="download-iwork-doc" style="font-weight:300; text-decoration: none; color: #0A8DE9; cursor: pointer;" >'+"_MessageView.iWork.Picker.Button.Download".loc()+"</a>"+u+"</div>"+"</div>"+"</div>"},icsHtmlForMessagePart:function(e){var t=SC.RenderContext.escapeHTML(e.get("attachmentDetails")),n=e.get("attachmentName")||"ics",r=e.get("attachmentUrl"),i;n=SC.RenderContext.escapeHTML(html.escapeAttrib(n)),i="_MessageView.Attachment.ToolTip".loc(n);var s="<a href ="+r+' title = "'+i+'"style = "width:auto; color:#0A8DE9; cursor:pointer;" target="_self">';return'<div style = "margin:9px 4px 0 0; width:auto; display:inline-block;"><div style="text-align:center">'+s+'<img class = "icon ics-attachment-image" src="'+SC.BLANK_IMAGE_URL+'" border = "0px" alt = "'+i+'"></a>'+"</div>"+'<div style = "margin-top:3px"">'+s+t+"</a>"+"</div>"+"</div>"
}}),SC.mixin(Message,{_tempSrcAttributeName:"data-temp-src",getMailDropBannerExpirationDateFromBody:function(e){var t=e.getElementsByClassName("x-apple-maildropbanner"),n=null,r;return t.length<1?null:(r=t[0],SC.$(r).closest("blockquote").length>0?null:(n=SC.$(r).attr("data-expiration"),n=parseInt(n,10),n))},updateMailDropBannerAndCoupons:function(e,t,n,r){var i="",s,o,u,a,f,l=NO,c,h,p,d,v=NO,m=this.messageDetailController,g=m.get("isSuspicious");o=SC.$(e).find(".x-apple-maildropbanner");if(o.length<1)return e;u=SC.$(o[0]);if(u.closest("blockquote").length>0)return e;Message._expireMailDrop&&(t-=26784e5),s=this.checkIfDateIsExpired(t);if(r){var y=MailMessage.get("mode");if(y===CoreMail.MESSAGE_MODE_COMPOSE)l=YES;else if(y===CoreMail.MESSAGE_MODE_REPLY||y===CoreMail.MESSAGE_MODE_REPLY_ALL||CoreMail.MESSAGE_MODE_FORWARD){var b=u.html();b=b.replace(/<div>\s?<\/div>/g,'<div style="height:0px;"></div>'),u.html(b)}}else{a=u.attr("data-url");if(a)if(s)u.removeAttr("href");else if(!g){var w=this.validateUrlDomain(u.attr("href"));if(!w.isUrlValid)return m.set("isSuspicious",YES),CoreMail.errorHandler.recordStat("_scrubbed_suspicious_links_in_body",{isMailDropBannerHrefSuspicious:YES,mailDropBannerHrefUrl:w.urlString}),e}}v=l&&s;var E=SC.$(e);c=E.find(".x-apple-maildrop"),h=c.length;var S,x,T,N={imageCount:0,nonImageCount:0},C=e.innerHTML,k=NO,L=m.get("shouldPublishStatAndShowErrorForScrubbedCoupons");if(!s&&!g){for(p=0;p<h;p++)T=SC.$(c[p]),T&&!Message.couponContainsValidMailDropDomainUrls(T,n,L)&&(SC.debug("Invalid coupon scrubbed: Coupon HTML : %@".fmt(T.html())),k=YES);if(k){CoreMail
.errorHandler.recordStat("_scrubbed_suspicious_links_in_body",{isMailDropCouponSuspicious:YES}),m.set("isSuspicious",YES);if(L){m.set("shouldPublishStatAndShowErrorForScrubbedCoupons",NO),SC.debug("Invalid coupon scrubbed: Message long header : %@".fmt(m.get("longHeader"))),SC.debug("Invalid coupon scrubbed: Message body : %@".fmt(C));var A={error:"Invalid Mail Drop URLs detected.",title:"_Feedback.MailDrop.Malicious.Coupon.ErrorCatcher.Dialog.Title".loc(),message:"_Feedback.MailDrop.Malicious.Coupon.ErrorCatcher.Dialog.Message".loc()};CoreMail.errorHandler.reportNonFatalError(A)}return e}}var O;for(p=0,d=n.get("length");p<d;p++){x=n.objectAt(p);if(x.get("isMailDrop")===NO)continue;S=x.get("mailDropStreamingUrl"),!s&&!g&&(O=this.validateUrlDomain(S),O.isUrlValid||(m.set("isSuspicious",YES),CoreMail.errorHandler.recordStat("_scrubbed_suspicious_links_in_body",{isMsgPartMailDropStreamingUrlSuspicious:YES,msgPartMailDropStreamingUrl:O.urlString}))),T=E.find("div[data-url='"+S+"']");if(T.length>0){if(T.closest("blockquote").length>0)continue;x.set("mailDropPublishedUrl",T.find("a").attr("href")),x.set("mailDropRecordId",T.attr("data-recordid")),x.set("mailDropExpirationDate",parseInt(T.attr("data-expiration"),10)),r?this._processCouponForComposeWindow(T,x,n,l,s):this._processCouponForViewMode(T,s,x,n)}(!r||v)&&this._populateFileCountHash(x,N,v)}v&&CoreMail.errorHandler.recordStat("_STAT_OPEN_DRAFT_WITH_EXPIRED_MAILDROP_ATTACHMENTS",{maildroppedImagesCount:N.imageCount,mailDroppedNonImagesCount:N.nonImageCount});if(l)u.remove();else if(!r){var M=N.imageCount,_=N.nonImageCount;s||
(i=this._getBannerTitle(M,a)),f=this._createBannerInnerHtml(i,t,M,_,a,NO),u.html(f)}return e},_processCouponForViewMode:function(e,t,n,r){var i,s=this.messageDetailController.get("isSuspiciousAndNotTrusted");if(n.get("iWorkFileType")&&!t&&!s){this._replaceCouponWithIWorkCoupon(e,n);return}var o=e.hasClass("maildrop-thumbnail");if(o){this._associateMailDropPartWithThumbnailPart(e,n,r),s||this._replaceHrefWithOnclick(e,n),(t||s)&&this._decouponifyMailDropThumbnailCoupon(e);return}var u=e.find("a");t?this._replaceCouponWithExpiredCoupon(e):(i="_MessageView.MailDrop.Coupon.DownloadInstructions.Title".loc(),s||this._replaceHrefWithOnclick(e,n),u.text(i))},_populateFileCountHash:function(e,t,n){var r=e.get("mailDropHeaderName");r.toLowerCase()==="image-archive-url"?t.imageCount++:e.get("isImage")&&(n||e.get("thumbnailMessagePart"))?t.imageCount++:t.nonImageCount++},_associateMailDropPartWithThumbnailPart:function(e,t,n){var r=e.find("img").attr("_temp_src_"),i;for(var s=0,o=n.get("length");s<o;s++){i=n.objectAt(s);if(i.get("isMailDrop"))continue;if(i.get("attachmentUrl")===r){i.set("isMailDropThumbnail",YES),t.set("thumbnailMessagePart",i);break}}},_decouponifyMailDropThumbnailCoupon:function(e){var t=e.find("img");t&&t[0]&&(t.attr("style",Global.get("inlineImageMargin")),e.replaceWith(t))},_processCouponForComposeWindow:function(e,t,n,r,i){var s=e.hasClass("maildrop-thumbnail");r?s?(this._associateMailDropPartWithThumbnailPart(e,t,n),i?e.remove():this._decouponifyMailDropThumbnailCoupon(e)):e.remove():i&&(s?this._decouponifyMailDropThumbnailCoupon(e):this._replaceCouponWithExpiredCoupon
(e))},_replaceHrefWithOnclick:function(e,t){var n=t.get("mailDropStreamingUrl")+"&teh=1",r=e.find("a");r.removeAttr("href"),r.attr("onclick",'javascript:window.parent.ViewMessage.downloadMailDropAttachment("'+n+'"'+")"),r.css("cursor","pointer")},_replaceCouponWithExpiredCoupon:function(e){var t=e.find("a"),n="_MessageView.MailDrop.Coupon.Expired.Title".loc(),r="color:red !important; "+t.attr("style");t.replaceWith('<div style="'+r+'">'+n+"</div>")},checkIfDateIsExpired:function(e){var t=NO,n,r;return e?(this._expireMailDrop&&(e-=26784e5),n=new Date(e),r=new Date,r>n&&(t=YES),t):t},insertMailDropBannerIntoBody:function(e){var t=Attachments.attachmentsController.get("content"),n=Compose.get("mailDropBannerExpirationDate"),r=t.length,i=0,s=0,o,u,a,f;for(o=0;o<r;o++)f=t[o],f.get("isImage")&&f.get("thumbnailMessagePart")?i++:s++,!n&&f.get("mailDropExpirationDate")&&(n=f.get("mailDropExpirationDate"),Compose.set("mailDropBannerExpirationDate",n));a=this.checkIfDateIsExpired(n);if(i===0&&s===0)return e;a||(u=this._getBannerTitle(i));var l=this._createBannerInnerHtml(u,n,i,s,undefined,YES),c='<div class="x-apple-maildropbanner" data-expiration="'+n+'" '+"style=\"font: 13px 'SFNSText', 'Helvetica Neue',sans-serif; color: #808080; font-weight: 300; -webkit-text-size-adjust: 100%;\">"+l+"</div>";return e=c+e,e},insertMailDropCouponsIntoBody:function(e){var t=Attachments.get("uploadMode")===CoreMail.UPLOAD_MODE_MAIL_DROP?YES:NO;if(!t)return e;var n="src",r=new RegExp(this._tempSrcAttributeName,"g"),i=new RegExp(n,"g");e=e.replace(i,this._tempSrcAttributeName),CoreMail.TMP_DIV.innerHTML=
e;var s=SC.$(CoreMail.TMP_DIV),o=Attachments.attachmentsController.get("content"),u=o.length,a="",f,l,c,h,p,d,v,m,g,y,b,w,E;for(c=0;c<u;c++)f=o[c],f.get("isImage")&&(p=f.get("thumbnailMessagePart"))?(d=p.get("localUrl")||p.get("attachmentUrl"),v=s.find("img["+this._tempSrcAttributeName+"$='"+d+"']"),g=v.length,g>0&&(h=this._createCoupon(f),m=SC.$(v),w=m.parents("a"),w.length>0?(E=w.parent(),E.append(SC.$(h)),m.remove()):SC.$(h).replaceAll(v))):(l=this._createCoupon(f),y=f.get("dataPlaceholderUUID"),y&&(b=s.find('[data-placeholder="'+y+'"]')),b&&b.length>0?b.replaceWith(l):a+=l);var S=s.find("#x-apple-maildrop-container");if(S&&S.length===0||S[0]&&SC.$(S[0]).closest("blockquote").length>0){var x='<div id="x-apple-maildrop-container" contenteditable="false">'+a+"</div>",T=s.find("blockquote"),N;T.length===0?s.append(x):(N=SC.$(T[0]).closest("div"),SC.$(x).insertBefore(N))}else S[0].innerHTML=a;try{s=SC.$("<div></div>").append(s)}catch(C){throw SC.warn("Message.insertMailDropCouponsIntoBody: Content of bodyElements: %@",s.html()),C}return e=s.html(),e=e.replace(r,n),e}.property(),_getBannerTitle:function(e,t){var n="";return e>0&&(t?n="_MessageView.MailDrop.Banner.DownloadInstructions.ImageArchive.Title".loc():e===1?n="_MessageView.MailDrop.Banner.DownloadInstructions.Image.Title".loc():n="_MessageView.MailDrop.Banner.DownloadInstructions.MultipleImages.Title".loc()),n},_createBannerInnerHtml:function(e,t,n,r,i,s){var o=CoreMail.numberFormatter.millisecondsToDateString(t),u=this.checkIfDateIsExpired(t),a=n+r,f,l,c,h="",p;u&&a>0?n===1?f="_MessageView.MailDrop.Banner.Expired.Image.Text"
.loc({date:o}):n>1?f="_MessageView.MailDrop.Banner.Expired.MultipleImages.Text".loc({date:o}):a===1?f="_MessageView.MailDrop.Banner.Expired.File.Text".loc({date:o}):a>1&&(f="_MessageView.MailDrop.Banner.Expired.MultipleFiles.Text".loc({date:o})):a===1?f="_MessageView.MailDrop.Banner.AttachmentExpiration.OneFile".loc({date:o}):f="_MessageView.MailDrop.Banner.AttachmentExpiration.ManyFiles".loc({date:o});var d=Message.messageController.getPath("folder.guid");if(s&&Compose.get("isDraftSaveInProgress")||!s&&d===CoreMail.DRAFTS_GUID&&!u)e="",p=CoreMail.getServerPreferences().get("mailDropExpiresAfterDays"),a===1?f="_MessageView.MailDrop.Banner.AttachmentExpiration.SavedDraft".loc({days:p}):f="_MessageView.MailDrop.Banner.AttachmentsExpiration.SavedDraft".loc({days:p});e&&e!==""&&!u?c='<div style="float:left; margin-right:62px"><div style="'+(i?"margin-top:-3px":"height:25px; display:table-cell; vertical-align:bottom")+'" class="">'+e+"</div>"+"<div></div>"+'<div style="height:19px; display:table-cell; vertical-align:bottom">'+f+"</div>"+"</div>":c='<div style="float:left; margin-top:'+(i?"1px;":"13px;")+'; margin-right:62px">'+'<div style="height:19px; display:table-cell; vertical-align:bottom">'+f+"</div>"+"</div>",s&&(h='<div style="height:0px; border-top:1px solid #ececec; margin-right:-20px"></div>');if(i){var v="maildrop_icon",m="";if(u){var g='url("%@")'.fmt("/applications/mail/1808Project39/frameworks/core_mail/mail_theme/1808Project39/en-us/source/view_message/images/expired_cloud_icon/expired@2x.png");v="expired_cloud_icon",m="<style>.expired_cloud_icon {background:"+g+" no-repeat;"+"background-size: 26px 22px;"+"}"+"</style>"
}var y='<div class="'+v+'"'+'style="'+"width:26px;"+"height:25px; "+"margin:2px 1px 13px 18px; "+'"></div>';l=h+'<div style="overflow: auto">'+c+'<div style="float:right; width:48px; margin-left:-62px" class="">'+y+"</div>"+"</div>"+'<div style="height:0px; border-top:1px solid #ececec; margin-bottom:15px; margin-right:-20px" class=""></div>',l=m+l}else l=h+'<div style="height:53px; overflow:auto">'+c+'<div style="float:right; width:62px; margin-left:-62px"></div>'+"</div>"+'<div style="height:0px; border-top:1px solid #ececec; margin-bottom:15px; margin-right:-20px"></div>';return l},_createCoupon:function(e){var t=this._createCouponDataAttributes(e),n=Global.escapeHTMLAndQuotes(e.get("attachmentDisplayName")),r=e.get("mailDropPublishedUrl"),i=e.get("sizeString"),s="",o;if(e.get("isImage")&&(o=e.get("thumbnailMessagePart"))){e=o;var u=e.get("imageStyle")||"",a='style="display:inline-block; '+u+'"',f=e.get("attachmentUrl"),l="_MessageView.MailDrop.Coupon.Image.DownloadInstructions.AltText".loc();s='<div style="'+Global.get("inlineImageMargin")+'display:inline-block;"'+t+">"+'<a href="'+r+'">'+"<img "+this._tempSrcAttributeName+'="'+f+'" class="'+Global.getImageOrientationCSSClassForImagePart(e)+'" '+'alt="'+n+'" title="'+l+'" '+a+">"+"</a>"+"</div>"}else{var c="_MessageView.MailDrop.Coupon.DownloadInstructions.Title".loc();s="<div "+t+'style="'+"margin: 15px 15px 15px 0px; "+"-webkit-text-size-adjust: 100%;"+"border: 1px solid #CACACA; "+"border-radius:15px;"+"height:134px; "+"display:inline-block; "+"vertical-align: middle; "+"min-width:159px; "+"font-family:'SFNSText','Helvetica Neue',sans-serif; "+'text-align: center;">'+'<a target="_blank" href="'+
r+'" style="'+"text-decoration:none; "+"outline: 0; "+"font-size: 14px; "+"color: #007AFF; "+"display:block; "+"margin:40px 10px 0px"+'">'+c+"</a>"+'<div style="text-align: center; font-size:12px; color:#808080">'+'<div style="margin:4px 10px 0px">'+n+"</div>"+'<div style="margin:3px 10px 0px">'+i+"</div>"+"</div>"+"</div>"}return s},_createCouponDataAttributes:function(e){var t="x-apple-maildrop";e.get("isImage")&&e.getPath("thumbnailMessagePart.isMailDropThumbnail")&&(t+=" maildrop-thumbnail");var n=e.get("attachmentDisplayName"),r=e.get("size"),i=e.get("mailDropExpirationDate"),s=e.get("mailDropStreamingUrl"),o=e.get("mailDropRecordId");n=Global.escapeHTMLAndQuotes(n);var u='class="'+t+'" '+'data-url="'+s+'" '+'data-filename="'+n+'" '+'data-size="'+r+'" '+'data-expiration="'+i+'" '+'data-recordid="'+o+'" ';return u},couponContainsValidMailDropDomainUrls:function(e,t,n){var r,i,s,o,u,a;return s=e.attr("data-url"),o=this._doesCouponHaveMatchingMsgPart(s,t),e.closest("blockquote").length>0||!o?a=e.find("a").attr("href"):a=s,r=this.validateUrlDomain(a),i=r.isUrlValid,u=r.urlString,!i&&n&&CoreMail.errorHandler.recordStat("_maildrop_scrubbed_nonicloud_url",{maliciousMailDropDownloadUrl:u,xMailerHeader:this.messageDetailController.get("xMailerHeader")}),i},_doesCouponHaveMatchingMsgPart:function(e,t){var n,r,i,s=t.get("length"),o=NO;for(i=0;i<s;i++){r=t.objectAt(i),n=r.get("mailDropStreamingUrl");if(n===e){o=YES;break}}return o},validateUrlDomain:function(e){var t=NO,n=e;if(e){var r=new URI(e),i=r.domain();if(i){n=i;var s=CoreMail.getServerPreferences().get("~whitelistedDownloadDomains"
);s.indexOf("."+i.toLowerCase())>-1&&(t=YES)}}else t=YES,n="EMPTY";return{isUrlValid:t,urlString:n}},addMailDropPlainText:function(e){var t=Attachments.attachmentsController,n=t.get("length");if(n>0){var r=Compose.get("mailDropBannerExpirationDate"),i=CoreMail.numberFormatter.millisecondsToDateString(r),s="_MessageView.MailDrop.TextBody.DownloadInstructions".loc(),o=Compose.get("isSendInProgress"),u=CoreMail.getServerPreferences().get("mailDropExpiresAfterDays"),a=0,f="",l,c,h,p,d,v,m;o?(n===1?l="_MessageView.MailDrop.Banner.AttachmentExpiration.OneFile":l="_MessageView.MailDrop.Banner.AttachmentExpiration.ManyFiles",c={date:i}):(n===1?l="_MessageView.MailDrop.Banner.AttachmentExpiration.SavedDraft":l="_MessageView.MailDrop.Banner.AttachmentsExpiration.SavedDraft",c={days:u}),l=l.loc(c);for(var g=0;g<n;g++)h=t.objectAt(g),p=h.get("mailDropPublishedUrl"),d=Global.escapeHTMLAndQuotes(h.get("attachmentDisplayName")),v=h.get("sizeString"),h.get("isImage")&&h.get("thumbnailMessagePart")&&a++,f+=s+"\n"+p+"\n"+d+"\n"+v+"\n";e=l+"\n"+e+"\n"+f,o&&a>0&&(a===1?m="_MessageView.MailDrop.Banner.DownloadInstructions.Image.Title":m="_MessageView.MailDrop.Banner.DownloadInstructions.MultipleImages.Title",e=m.loc()+"\n"+e)}return e},_expireMailDrop:NO,_replaceCouponWithIWorkCoupon:function(e,t){var n=Message.iWorkCouponForMessagePart(t);e.replaceWith(n)}}),SC.mixin(Message,{_handleSetMessageFlagRequest:function(){Message.messageListController.notifyPropertyChange("selection")}});var FolderList=SC.Object.create({content:null,folderListWidth:0,msgDragContent:null,editingFolder:null,didInlineEditorLoseFocus
:NO,isDeleteClicked:NO,_refreshStartTime:0,_MIN_SPINNER_TIME:1500,isFolderListResyncInProgress:NO,initStatechart:function(){arguments.callee.base.apply(this,arguments)},isResyncFolderListInProgressDidChange:function(){var e=CoreMail.get("isResyncFolderListInProgress");YES===e?this.dispatch({sig:"resync"}):this.dispatch({sig:"resyncDone"})}.observes("CoreMail.isResyncFolderListInProgress"),initial:"2.0 Waiting for Content","2.0 Waiting for Content":function(e){switch(e.sig){case"enter":return CK.Statechart.handled();case"load content":if(Global.get("hasStartupFailed")===YES)return this[this.stateKey]="2.3 Startup Request Failed",CK.Statechart.EVT_TRANSITION_RES;if(CoreMail.get("werePreferencesFetched")===NO)return this._rescheduleFolderListFetch.invokeLater(this,CoreMail.INTERVAL_FOLDER_LIST_FETCH),CK.Statechart.handled();if(this.get("content"))return this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES;this._folderArray=CoreMail.getFolders();switch(this._folderArray.get("status")){case SC.Record.READY_CLEAN:return this._setupFolderListAfterLoad(),this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES;case SC.Record.ERROR:case SC.Record.EMPTY:return CoreMail.errorHandler.handleError({keyString:"FolderList.LoadFailed.ServerError"}),this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES;default:this._folderRequestStatusObserver=this._folderArray.addStatechartObserver("status",this)}return CK.Statechart.handled();case"exit":return this._folderArray.removeStatechartObserver("status",this,this._folderRequestStatusObserver
),this._folderArray=null,this._folderRequestStatusObserver=null,CK.Statechart.handled();case"propertyChanged":if(this._folderArray&&e.target===this._folderArray&&e.key==="status")switch(this._folderArray.get("status")){case SC.Record.READY_CLEAN:this._setupFolderListAfterLoad();break;case SC.Record.ERROR:case SC.Record.EMPTY:Global.get("isAppReady")===NO?CoreMail.errorHandler.handleBootstrapError("FolderList.LoadFailed.ServerError"):CoreMail.errorHandler.handleError({keyString:"FolderList.LoadFailed.ServerError"})}return this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES}}.state(),"2.3 Waiting For Add Folder Confirmation":function(e){var t=this.page.getPath("folderList.contentView");switch(e.sig){case"defaultTransition":this._viewOrientation=MessageList.get("viewPreference"),this._viewOrientation===MessageList.ORIENTATION_TWO_COL&&MessageList.switchToThreeColumnView();var n=this.computeNewFolderName(),r={name:n,role:CoreMail.FOLDER_ROLE_FOLDER,total:0,unread:0},i=t.getPath("selection.firstObject");this.get("shouldAddFolderAtRootLevel")===NO&&(r.parent=i.get("guid")),this._lastAddedFolder=CoreMail.createFolder(r);var s=this._lastAddedFolder.get("parent");return s&&this._expandFolder(s),this.foldersArrayController.notifyPropertyChange("[]"),this.invokeLast(function(){t.itemViewForContentObject(this._lastAddedFolder).beginEditing(YES)}),CK.Statechart.handled();case"exit":return t.set("addFolderIcon","add-button"),this._addRequestStatus&&(this._addRequestStatus.removeStatechartObserver("state",this,this._addResponseObserver),this._addResponseObserver=null
,this._addRequestStatus=null),this._viewOrientation===MessageList.ORIENTATION_TWO_COL&&(MessageList.switchToTwoColumnView(),this._viewOrientation=null),this.set("shouldAddFolderAtRootLevel",NO),CK.Statechart.handled();case"startEditing":return CK.Statechart.handled();case"finishEditing":return e.newFolderName&&this._lastAddedFolder.set("name",e.newFolderName),this._addRequestStatus=CoreMail.commitFolder(this._lastAddedFolder),this._addResponseObserver=this._addRequestStatus.addStatechartObserver("state",this),t.set("addFolderIcon","spinner-24px-dfe1e3"),CK.Statechart.handled();case"discardEditing":case"showDeleteConfirmation":var o=this._lastAddedFolder.get("parent");if(o){var u=o.get("kids");u&&(u.removeObject(this._lastAddedFolder),u.get("length")===0&&t.set("hasDisclosureView",NO))}return this._lastAddedFolder.destroy(),o&&(CoreMail.washClean(CoreMail.store,o.get("storeKey")),this.setFolderSelectionWithGuid(o.get("guid"))),this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES;case"folderSelected":return SC.Benchmark.start("perfLoadMessages"),MessageList.dispatch({sig:"show"}),CK.Statechart.handled();case"propertyChanged":var a=this._addRequestStatus;if(e.target===a&&e.key==="state")switch(a.get("state")){case a.STATE_SUCCESS:var f=this._lastAddedFolder.get("parent");f&&f.notifyPropertyChange("children"),MoveToFolder.foldersArrayController.notifyPropertyChange("[]");if(window.MailFilters&&window.Preferences){var l=Preferences.page.get("selectedPreference");l===Preferences.RULES_SELECTED_PREFERENCE&&MailFilters.folderListController.notifyPropertyChange
("[]")}return this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES;case a.STATE_PENDING:break;case a.STATE_ERROR:var c;return a.get(a.ERROR_CODE)===this.FOLDER_NAME_TOO_LONG?c="FolderList.FolderNameTooLong":c="FolderList.CreateFolder.ServerError",CoreMail.errorHandler.handleError({keyString:c}),this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES}return CK.Statechart.handled()}}.state(),"2.1 Folder List Item":function(e){switch(e.sig){case"enter":return CoreMail.set("canResyncFolderList",YES),CK.Statechart.handled();case"exit":return CoreMail.set("canResyncFolderList",NO),CK.Statechart.handled();case"clickOnRefreshButton":return this[this.stateKey]="2.2 Waiting for resync to complete",CK.Statechart.EVT_TRANSITION_RES;case"resync":return this[this.stateKey]="2.2 Waiting for resync to complete",CK.Statechart.EVT_TRANSITION_RES;case"clickOnAddFolderButton":return this[this.stateKey]="2.3 Waiting For Add Folder Confirmation",CK.Statechart.EVT_TRANSITION_RES;case"showDeleteConfirmation":return this._showDeleteConfirmation(e.folderToDelete),CK.Statechart.handled();case"deleteFolder":var t=this.getPath("foldersToDelete.firstObject");if(t){if(t.get("role")!==CoreMail.FOLDER_ROLE_VIP)return this[this.stateKey]="2.1.2.1.1.1 Waiting For Deletion Confirmation",CK.Statechart.EVT_TRANSITION_RES;var n=t.get("vipSender");n?VipSender.deleteVip(n):CoreMail.errorHandler.handleError({keyString:"VipSender.DeleteFailed.ServerError"}),this.set("foldersToDelete",[])}return CK.Statechart.handled();case"emptyTrash":return this[this.stateKey]="2.1.2.1.1.2 Waiting For Empty Trash Confirmation"
,CK.Statechart.EVT_TRANSITION_RES;case"folderSelected":var r,i=Global.shouldShowVipWelcomePage();r=Mail.mainPage.get("vipWelcomeViewOutlet");if(i===YES){r.messages.set("layoutDirection","");return}r.messages.set("layoutDirection",SC.LAYOUT_HORIZONTAL),SC.Benchmark.start("perfLoadMessages"),MessageList.dispatch({sig:"show"});if(this._hoveredView)return this[this.stateKey]="2.1.2 Mouse Inside View",CK.Statechart.EVT_TRANSITION_RES;return CK.Statechart.handled();case"dragOverFolder":return this[this.stateKey]="2.1.2.3 Drag Session",CK.Statechart.EVT_TRANSITION_RES;case"startEditing":return this[this.stateKey]="2.1.4 Edit",CK.Statechart.EVT_TRANSITION_RES}}.state(),"2.2 Waiting for resync to complete":function(e){var t,n;switch(e.sig){case"enter":return this.setIfChanged("isResyncFolderListInProgress",YES),this._requestStatus=CoreMail.poll(),this._getMailResponseObserver=this._requestStatus.addStatechartObserver("state",this),this._requestStatus.get("state")!==this._requestStatus.STATE_SUCCESS&&(t=new Date,n=t.getTime(),this.set("_refreshStartTime",n),this.set("isFolderListResyncInProgress",YES)),CK.Statechart.handled();case"resync":return CK.Statechart.handled();case"exit":return this._requestStatus.removeStatechartObserver("state",this,this._getMailResponseObserver),this._getMailResponseObserver=null,CK.Statechart.handled();case"resyncDone":t=new Date,n=t.getTime();var r=n-this.get("_refreshStartTime");r>this._MIN_SPINNER_TIME?this.set("isFolderListResyncInProgress",NO):this.invokeLater(function(){this.set("isFolderListResyncInProgress",NO)},this._MIN_SPINNER_TIME-r),this.page
.setPath("folderList.contentView.hasDisclosureView",NO),FolderList.foldersArrayController.notifyPropertyChange("[]"),MoveToFolder.foldersArrayController.notifyPropertyChange("[]");if(window.MailFilters&&window.Preferences){var i=Preferences.page.get("selectedPreference");i===Preferences.RULES_SELECTED_PREFERENCE&&(MailFilters.folderListController.notifyPropertyChange("[]"),MailFilters.checkRulesFolderValidity(),MailFilters.get("ruleListContentView")&&MailFilters.get("ruleListContentView").reload())}return this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES}}.state("2.1 Folder List Item"),"2.1.2.3 Drag Session":function(e){switch(e.sig){case"enter":return CK.Statechart.handled();case"exit":return this.foldersArrayController.notifyPropertyChange("[]"),CK.Statechart.handled();case"dragHoverOnFolder":return this._dropFolder=e.folder,this[this.stateKey]="2.1.2.3.1 Highlight",CK.Statechart.EVT_TRANSITION_RES;case"dragEnded":return this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES;case"dropMessages":var t=this._dropFolder,n,r;if(t){t=t.get("content");var i=this.get("msgDragContent");if(i){var s=i.get("firstObject");return t&&t.get("role")===CoreMail.FOLDER_ROLE_VIP&&t.get("parent")===null&&s.getPath("folder.role")===CoreMail.FOLDER_ROLE_INBOX?(n=s.get("fromAddress"),r=Contacts.getFullName(n),r||(r=s.get("fromDisplayName")),CoreMail.errorHandler.handleError({keyString:"VipSender.AddVip",rightButton:{title:"_Common.Add".loc(),action:function(){CoreMail.errorHandler.removeErrorPane(this);var e={name:r,addresses:[n]};VipSender.addVip(e)
}},middleButton:"_Feedback.VipSender.Button.DontAdd",messageLocParams:{recipient:r}}),this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES):(CoreMail.incrementUserStat(CoreMail.STAT_DD_MOVE_MSG),this[this.stateKey]="2.1.2.3.2 Move dragged messages",CK.Statechart.EVT_TRANSITION_RES)}}break;case"dropFolder":this._draggedFolder=e.draggedFolder;if(!this.validateFolderDrop(this._draggedFolder,this._dropFolder))return this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES;return this[this.stateKey]="2.1.2.3.3 Move Folder",CK.Statechart.EVT_TRANSITION_RES}}.state("2.1 Folder List Item"),"2.1.2.3.1 Highlight":function(e){if(!this._dropFolder)return;switch(e.sig){case"enter":return this._dropFolder.set("isDropZone",YES),CK.Statechart.handled();case"exit":return this._dropFolder.set("isDropZone",NO),CK.Statechart.handled();case"dragHoverEndOnFolder":return this[this.stateKey]="2.1.2.3 Drag Session",CK.Statechart.EVT_TRANSITION_RES}}.state("2.1.2.3 Drag Session"),"2.1.2.3.2 Move dragged messages":function(e){switch(e.sig){case"enter":var t=this.get("msgDragContent");return this._isEditing=YES,this._moveMessagesStatus=CoreMail.moveMessage(t,Message.messageListController.get("arrangedObjects"),this._dropFolder.getPath("content.guid")),this._moveMessageResponse=this._moveMessagesStatus.addStatechartObserver("state",this),CK.Statechart.handled();case"exit":return this._moveMessagesStatus.removeStatechartObserver("state",this,this._moveMessageResponse),this._moveMessageResponse=null,this._moveMessagesStatus=null,this._isEditing=NO,this.msgDragContent=
null,CK.Statechart.handled();case"propertyChanged":var n=this._moveMessagesStatus;if(e.target===n&&e.key==="state")switch(n.get("state")){case n.STATE_SUCCESS:return this.foldersArrayController.notifyPropertyChange("[]"),this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES;case n.STATE_PENDING:break;case n.STATE_ERROR:return CoreMail.errorHandler.handleError({keyString:"FolderList.MoveMessages.ServerError"}),this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES}return CK.Statechart.handled()}}.state("2.1.2.3 Drag Session"),"2.1.2.3.3 Move Folder":function(e){switch(e.sig){case"enter":var t;return this._isEditing=YES,this._dragFirstParent=this._draggedFolder.getPath("content.parent"),t=this._dropFolder.get("content"),t.get("isFoldersGroup")&&(t=null),this._moveFolderStatus=CoreMail.moveFolder(this._draggedFolder.get("content"),t),this._moveFolderResponse=this._moveFolderStatus.addStatechartObserver("state",this),CK.Statechart.handled();case"exit":return this._moveFolderStatus.removeStatechartObserver("state",this,this._moveFolderResponse),this._moveFolderResponse=null,this._moveFolderStatus=null,this._isEditing=NO,this._dragFirstParent&&(this._dragFirstParent.notifyPropertyChange("children"),this._dragFirstParent=null),this._newParent=this._draggedFolder.getPath("content.parent"),this._newParent&&(this._newParent.notifyPropertyChange("children"),this._newParent=null),CK.Statechart.handled();case"propertyChanged":var n=this._moveFolderStatus;if(e.target===n&&e.key==="state")switch(n.get("state")){case n.STATE_SUCCESS:return FolderList
.page.folderList.contentView.set("hasDisclosureView",NO),this.invokeLast(function(){this.foldersArrayController.notifyPropertyChange("[]"),MoveToFolder.foldersArrayController.notifyPropertyChange("[]")}),this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES;case n.STATE_PENDING:break;case n.STATE_ERROR:return CoreMail.errorHandler.handleError({keyCode:n.errorCode}),this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES}return CK.Statechart.handled()}}.state("2.1.2.3 Drag Session"),"2.1.4 Edit":function(e){var t=this.page.getPath("folderList.contentView"),n;switch(e.sig){case"enter":case"defaultTransition":return this._isEditing=YES,FolderList.foldersTreeController.set("allowsSelection",NO),CK.Statechart.handled();case"exit":return this.invokeOnce(function(){this.foldersArrayController.notifyPropertyChange("[]")}),this._renameFolderRequestStatus&&(this._renameFolderRequestStatus.removeStatechartObserver("state",this,this._renameResponseObserver),this._renameResponseObserver=null,this._renameFolderRequestStatus=null),this._vipFolderRenameResponseObserver&&(this._vipFolderRenameResponseObserver=null,this._vipFolderRenameRequestStatus=null),this._isEditing=NO,t.set("addFolderIcon","add-button"),FolderList.foldersTreeController.set("allowsSelection",YES),SC.Benchmark.start("perfLoadMessages"),MessageList.dispatch({sig:"show"}),CK.Statechart.handled();case"finishEditing":if(!e.newFolderName)return this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES;return t.set("addFolderIcon","spinner-24px-dfe1e3"),n=this.get("editingFolder"
),n&&(n.get("role")===CoreMail.FOLDER_ROLE_VIP?(this._vipFolderRenameRequestStatus=CoreMail.createPendingStatus(),this._vipFolderRenameResponseObserver=this._vipFolderRenameRequestStatus.addStatechartObserver("state",this),VipSender.updateVipName(n.get("vipSender"),e.newFolderName,this._vipFolderRenameRequestStatus),this._prevVipFolderName=n.get("name"),n=this.get("editingFolder"),n.set("name",e.newFolderName),CoreMail.washClean(CoreMail.store,n.get("storeKey"))):(this._renameFolderRequestStatus=CoreMail.renameFolder(n,e.newFolderName),this._renameResponseObserver=this._renameFolderRequestStatus.addStatechartObserver("state",this))),CK.Statechart.handled();case"discardEditing":return this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES;case"showDeleteConfirmation":return this._showDeleteConfirmation(e.folderToDelete),CK.Statechart.handled();case"cancelEditing":return this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES;case"propertyChanged":var r=this._renameFolderRequestStatus;if(e.target===r&&e.key==="state")switch(r.get("state")){case r.STATE_SUCCESS:return MoveToFolder.foldersArrayController.notifyPropertyChange("[]"),this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES;case r.STATE_PENDING:break;case r.STATE_ERROR:var i;return r.get(r.ERROR_CODE)===this.FOLDER_NAME_TOO_LONG?i="FolderList.FolderNameTooLong":i="FolderList.RenameFolder.ServerError",CoreMail.errorHandler.handleError({keyString:i}),this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES}var s=this._vipFolderRenameRequestStatus
;if(e.target===s&&e.key==="state")switch(s.get("state")){case s.STATE_PENDING:break;case s.STATE_ERROR:return n=this.get("editingFolder"),n.set("name",this._prevVipFolderName),CoreMail.washClean(CoreMail.store,n.get("storeKey")),this._prevVipFolderName=null,CoreMail.errorHandler.handleError({keyString:"VipSender.RenameFailed.ServerError",messageLocParams:{vipSender:n.get("name")}}),this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES;case s.STATE_SUCCESS:return this._prevVipFolderName=null,this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES}return CK.Statechart.handled()}}.state(),"2.1.2.1.1.1 Waiting For Deletion Confirmation":function(e){var t=this.page.getPath("folderList.contentView"),n=this.get("foldersToDelete"),r,i,s;switch(e.sig){case"enter":return CoreMail.set("canResyncFolderList",NO),t.set("addFolderIcon","spinner-24px-dfe1e3"),s=n.get("length"),s>0&&(r=n.pop(),r&&(s===1&&(this._deleteFolderParent=r.get("parent")),i=CoreMail.deleteFolder(r),this._deleteResponseObserver=i.addStatechartObserver("state",this),this._deleteStatus=i)),CK.Statechart.handled();case"exit":return i=this._deleteStatus,i&&(i.removeStatechartObserver("state",this,this._deleteResponseObserver),this._deleteResponseObserver=null,this._deleteStatus=null),t.set("addFolderIcon","add-button"),CoreMail.set("canResyncFolderList",YES),this.set("foldersToDelete",[]),CK.Statechart.handled();case"propertyChanged":i=this._deleteStatus;if(e.target===i&&e.key==="state")switch(i.get("state")){case i.STATE_SUCCESS:s=n.get("length");if(!(s>0))return this._deleteFolderParent&&
(this._deleteFolderParent.notifyPropertyChange("children"),this._deleteFolderParent=null,FolderList.page.folderList.contentView.set("hasDisclosureView",NO),this.foldersArrayController.notifyPropertyChange("[]"),MoveToFolder.foldersArrayController.notifyPropertyChange("[]")),this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES;r=n.pop(),r&&(s===1&&(this._deleteFolderParent=r.get("parent")),this._deleteStatus.removeStatechartObserver("state",this,this._deleteResponseObserver),i=CoreMail.deleteFolder(r),this._deleteResponseObserver=i.addStatechartObserver("state",this),this._deleteStatus=i);break;case i.STATE_PENDING:break;case i.STATE_ERROR:return CoreMail.errorHandler.handleError({keyString:"FolderList.DeleteFolder.ServerError"}),this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES}return CK.Statechart.handled();default:return CK.Statechart.handled()}}.state("2.1 Folder List Item"),"2.1.2.1.1.2 Waiting For Empty Trash Confirmation":function(e){switch(e.sig){case"defaultTransition":this._isEditing=YES;var t=CoreMail.store.find(CoreMail.ServerPreferences,CoreMail.SERVER_PREFS_GUID).get("trashFolder"),n=CoreMail.findLocalFolder(t);if(!n)return CoreMail.errorHandler.handleError({keyString:"FolderList.EmptyFolder.ServerError"}),this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES;return this._emptyRequest=CoreMail.emptyFolder(n),this._emptyFolderResponseObserver=this._emptyRequest.addStatechartObserver("state",this),CK.Statechart.handled();case"exit":return this._emptyRequest.removeStatechartObserver("state",this
,this._emptyFolderResponseObserver),this._emptyFolderResponseObserver=null,this.__emptyRequest=null,this._isEditing=NO,CK.Statechart.handled();case"propertyChanged":var r=this._emptyRequest;if(e.target===r&&e.key==="state")switch(r.get("state")){case r.STATE_SUCCESS:return this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES;case r.STATE_PENDING:break;case r.STATE_ERROR:return CoreMail.errorHandler.handleError({keyString:"FolderList.EmptyFolder.ServerError"}),this[this.stateKey]="2.1 Folder List Item",CK.Statechart.EVT_TRANSITION_RES}return CK.Statechart.handled()}}.state("2.1 Folder List Item"),"2.3 Startup Request Failed":function(){}.state()});FolderList.foldersArrayController=SC.ArrayController.create({contentBinding:"FolderList.content",allowsEmptySelection:NO,allowsMultipleSelection:NO,init:function(){arguments.callee.base.apply(this,arguments),this._source=SC.Object.create({children:null,isExpanded:null})},serverPreferences:null,serverPreferencesBinding:"CoreMail.serverPreferences",sourceRoot:function(){var e=this.get("content");if(!e)return null;e=e.sortProperty("group","sortOrder","lowerCaseName");var t=[],n=[],r=e.get("length"),i,s=CoreMail.getPath("implicitPreferences.openFolderDisclosures");for(var o=0;o<r;o++)i=e[o],i.get("parent")||(CoreMail.FOLDER_GROUP_MAILBOXES===i.get("group")?t.push(i):n.push(i)),window.VipSender&&i.get("role")===CoreMail.FOLDER_ROLE_VIP&&i.get("parent")===null&&!i.get("isExpanded")&&VipSender.get("openVIPDisclosure")&&(s[i.get("sha1")]=YES,CoreMail.saveImplicitPreference("openFolderDisclosures",s),VipSender.set("openVIPDisclosure"
,NO)),s[i.get("sha1")]===YES&&i.set("isExpanded",YES);return t.push(SC.Object.create({name:CoreMail.FOLDER_GROUP_FOLDERS,displayName:CoreMail.FOLDER_GROUP_FOLDERS.loc(),isExpanded:YES,isFoldersGroup:YES})),t=t.concat(n),this._source.set("children",t),this._source.set("isExpanded",YES),this._source}.property("[]").cacheable()}),FolderList.foldersTreeController=SC.TreeController.create(SC.CollectionViewDelegate,{contentBinding:"FolderList.foldersArrayController.sourceRoot",allowsEmptySelection:NO,allowsMultipleSelection:NO,treeItemChildrenKey:"children",treeItemIsExpandedKey:"isExpanded",treeItemIsGrouped:NO,_previousSelection:null,selectionDidChange:function(){var e=this.get("selection"),t=e.get("firstObject"),n=t?t.get("guid"):null;SC.debug('FolderList.foldersTreeController.selectionDidChange: "'+n+'"'),t&&t.get("role")&&(!this._previousSelection||this._previousSelection!==t)&&(this._previousSelection=t,this.invokeLast(function(){FolderList.dispatch({sig:"folderSelected"}),Global.setMailPageTitle(t.get("displayName"),t.get("total"),t.get("unread"))}),CoreMail.saveImplicitPreference("lastSelectedFolder",t.get("sha1"))),FolderList.folderController.set("folderRecord",t),this._prevSelIndex=e.indexSetForSource(this.get("arrangedObjects"))}.observes("selection"),updateSelectionAfterContentChange:function(){var e=this.get("arrangedObjects"),t=this.getPath("selection.firstObject.status"),n=this.getPath("selection.firstObject");if(e&&this._prevSelIndex){var r=e.get("length");if(r<this._lastContentLength){var i=this._prevSelIndex.firstObject(),s,o,u=e.objectAt(1);if(n.get("role")===CoreMail
.FOLDER_ROLE_VIP&&u.get("parent")===null&&u.get("isExpanded"))s=0;else if(t!==SC.Record.READY_CLEAN){s=i-1,o=e.objectAt(s);while(o&&(o.get("status")!==SC.Record.READY_CLEAN||CoreMail.FOLDER_ROLE_GHOST===o.get("role"))){o.get("guid")?(s-=1,s=s<0?0:s):s=0;if(s===0)break}}o=e.objectAt(s),o&&this.selectObject(o)}this._lastContentLength=r}return arguments.callee.base.apply(this,arguments)}}),FolderList.folderController=SC.ObjectController.create({contentBinding:"FolderList.foldersTreeController.selection",folderRecord:null,folderRecordDidChange:function(){var e=this.get("folderRecord");if(!e)return;var t=this.get("displayName");if(!t)return;var n=this.get("unread"),r=this.get("total");if(this._prevUnread!==n||this._prevTotal!==r)this._prevUnread=n,this._prevTotal=r,Global.setMailPageTitle(t,r,n)}.observes("total","unread")}),SC.mixin(FolderList,{validateFolderName:function(e,t){var n=NO,r=e.get("parent");if(""===t)n=YES;else if(""===t.trim())CoreMail.errorHandler.handleError({keyString:"FolderList.InvalidFolderName"}),n=NO;else if(e.get("role")===CoreMail.FOLDER_ROLE_VIP)n=YES;else if(this.checkForSpecialCharacters(t))CoreMail.errorHandler.handleError({keyString:"FolderList.InvalidFolderName"}),n=NO;else if(this.checkForFirstCharacter(t))CoreMail.errorHandler.handleError({keyString:"FolderList.InvalidFirstCharacter"}),n=NO;else if(!!r||t.toLowerCase()!==CoreMail.FOLDER_NAME_INBOX&&t!==CoreMail.FOLDER_NAME_DRAFTS&&t!==CoreMail.FOLDER_NAME_ARCHIVE&&t!==CoreMail.FOLDER_NAME_JUNK)if(this.checkIfFolderAlreadyExists(e,t)){var i=NO;if(!r)if(t===CoreMail.FOLDER_NAME_TRASH){var s=this.get
("content").findProperty("role",CoreMail.FOLDER_ROLE_TRASH);s.get("name")===CoreMail.FOLDER_NAME_TRASH&&(i=YES)}else if(t===CoreMail.FOLDER_NAME_SENT){var o=this.get("content").findProperty("role",CoreMail.FOLDER_ROLE_SENT);o.get("name")===CoreMail.FOLDER_NAME_SENT&&(i=YES)}i===NO?CoreMail.errorHandler.handleError({keyString:"FolderList.ExistingFolderName",descriptionLocParams:[t]}):CoreMail.errorHandler.handleError({keyString:"FolderList.ReservedFolderName"}),n=NO}else n=YES;else CoreMail.errorHandler.handleError({keyString:"FolderList.ReservedFolderName"}),n=NO;return n},checkForFirstCharacter:function(e){var t=e.charAt(0);return t==="#"?YES:NO},checkForSpecialCharacters:function(e){return e.match(/[\/\?\%\*]/)},checkIfFolderAlreadyExists:function(e,t){var n,r,i,s=e.get("guid"),o=e.get("parent");if(o)i=o.get("children");else{i=this.get("content").filterProperty("parent",null);var u=i.findProperty("role",CoreMail.FOLDER_ROLE_VIP);u&&i.removeObject(u)}if(i){r=i.get("length");for(var a=0;a<r;a++){n=i[a];if(n.get("guid")!==s&&n.get("name")===t)return YES}}return NO},computeNewFolderName:function(){var e="_FolderList.NewFolder".loc(),t=[],n=0,r=1,i="",s,o=this.page.getPath("folderList.contentView"),u=o.getPath("selection.firstObject");this.get("shouldAddFolderAtRootLevel")===NO?s=u:s=null,t=s?s.get("children")?s.get("children").getEach("name"):null:CoreMail.getFolders().filterProperty("parent",null).getEach("name");if(t)while(n!==1)e="_FolderList.NewFolder".loc(),r!==1&&(i=" ",i+=r-1),e+=i,t.indexOf(e)===-1&&(n=1),r++;return e},isMessagesDraggedToSameFolder:function(e){var t=e.
get("guid"),n=this.get("msgDragContent"),r=n&&n.firstObject()?n.firstObject().getPath("folder.guid"):null;if(r===null){var i="FolderList.isMessagesDraggedToSameFolder: Folder Guid is null";return CoreMail.errorHandler.logErrorTrap(i),YES}return t===r?YES:NO},isUnloadedMessagesDraggedToJunkFolder:function(e){var t=NO,n=e.get("role"),r=Message.messageListController.get("isJunkEnabled");return n===CoreMail.FOLDER_ROLE_JUNK&&(t=r?YES:NO),t},isValidFolderDropTarget:function(e,t){var n=t.get("content"),r=n.get("guid"),i=YES;return n.get("isFoldersGroup")?e.get("parent")||(i=NO):n.get("role")===CoreMail.FOLDER_ROLE_FOLDER&&r!==e.get("guid")&&r!==e.getPath("parent.guid")&&!this.isDescendantOfFolder(e,n)?i=YES:i=NO,i},expandDropFolder:function(e){e.set("isExpanded",YES)},collapseDropFolder:function(e){e.set("isExpanded",NO)},addTempExpandedFolder:function(e){this._expandedFolders=this._expandedFolders||[],-1===this._expandedFolders.indexOf(e)&&this._expandedFolders.push(e)},collapseTempExpandedFolders:function(){this._expandedFolders&&(this._expandedFolders.forEach(function(e){this.collapseDropFolder(e)},this),this._expandedFolders=null)},isDescendantOfFolder:function(e,t){var n=e.get("guid"),r=t.get("parent");while(r){if(r.get("guid")===n)return YES;r=r.get("parent")}return NO},validateFolderDrop:function(e,t){var n=e.getPath("content.name"),r;t.getPath("content.isFoldersGroup")===YES?r=CoreMail.getFolders().filterProperty("role",CoreMail.FOLDER_ROLE_FOLDER).filterProperty("parent",null):r=t.getPath("content.children");if(r){var i=r.filterProperty("name",n);if(i&&i.get("length")>0)return CoreMail
.errorHandler.handleError({keyString:"FolderList.MoveFolder.NameConflict"}),NO}return YES},passFirstResponder:function(){MessageList.invokeLast("takeFirstResponder")}}),SC.mixin(FolderList,{MAX_NESTING_LEVELS:4,shouldAddFolderAtRootLevel:NO,indexOfEditingFolder:null,foldersToDelete:[],FOLDER_NAME_TOO_LONG:11014,configure:function(e){var t=this.page.get("folderList"),n=e.get("parentView");if(!n)throw"bad API call; view does not have a parent view";n.replaceChild(t,e),this.dispatch({sig:"load content"})},setEditingFolder:function(e){var t=e.get("content"),n=t.get("role");n===CoreMail.FOLDER_ROLE_FOLDER||n===CoreMail.FOLDER_ROLE_VIP?this.set("editingFolder",t):this.set("editingFolder",null)},addNewFolder:function(){this.dispatch({sig:"clickOnAddFolderButton"})},addNewFolderAtRootLevel:function(){this.set("shouldAddFolderAtRootLevel",YES),this.addNewFolder()},removeFolder:function(e){YES===e.get("canDelete")&&this.dispatch({sig:"showDeleteConfirmation",folderToDelete:e})},deleteSelectedFolder:function(){var e=FolderList.foldersTreeController.getPath("selection.firstObject");this.removeFolder(e)},selectedFolderRole:function(){var e=this.page.getPath("folderList.contentView"),t="";return e.get("selection")&&(t=e.getPath("selection.firstObject.role")),t},getSelectedFolder:function(){var e=this.page.getPath("folderList.contentView"),t=null;e.get("selection")&&(t=e.getPath("selection.firstObject"));if(!t){var n=this.foldersTreeController.getPath("selection.firstObject.guid"),r=this.foldersArrayController.getPath("content.length");SC.warn("FolderList.getSelectedFolder: No folder is selected. record("+
t+"), guid("+n+"), size("+r+")")}return t},selectedFolderGuid:function(){var e=this.foldersTreeController.getPath("selection.firstObject.guid");if(!e){var t=this.foldersArrayController.getPath("content.length");SC.warn("FolderList.selectedFolderGuid: No folder is selected. guid("+e+"), size("+t+")")}return e},lastSelectedFolderGuid:function(){var e=CoreMail.get("implicitPreferences"),t=e.get("lastSelectedFolder"),n=FolderList.content,r;return n&&(r=n.filter(function(e){return e.get("sha1")===t})[0]),r?r.get("guid"):(SC.warn('FolderList.lastSelectedFolderGuid: lastSelectedFolder "'+t+'" not found, defaulting to inbox'),CoreMail.INBOX_GUID)},getFolderNameAndUnreadCount:function(){var e=this.foldersTreeController.get("selection").firstObject();if(e){var t=e.get("displayName"),n=e.get("count");return n>0?"_FolderList.FolderNameAndUnreadCount".loc(SC.RenderContext.escapeHTML(t),n):"_FolderList.FolderNameWhenNoUnreadMessage".loc(SC.RenderContext.escapeHTML(t))}return""},setCurrentDragView:function(e){this._dragView=e},signalInvalidDropTarget:function(){this._dragView&&this._dragView.setInvalidDrop(YES)},signalValidDropTarget:function(){this._dragView&&this._dragView.setInvalidDrop(NO)},setFolderSelectionWithGuid:function(e){if(e){var t=CoreMail.findLocalFolder(e);t&&(this.foldersTreeController.selectObject(t),CoreMail.saveImplicitPreference("lastSelectedFolder",t.get("sha1")))}},showSelectedFolder:function(){var e=FolderList.foldersTreeController.getPath("selection.firstObject");if(e){var t=e.get("parent");while(t)t.set("isExpanded",YES),t=t.get("parent");this._scrollToSelectedFolder
()}},hasVipFolders:function(){var e=this.get("content"),t;for(var n=0,r=e.get("length");n<r;n++){t=e.objectAt(n);if(t.get("role")===CoreMail.FOLDER_ROLE_VIP){if(t.get("parent")!==null)return YES;var i=t.get("children");return i===null||i.get("length")===0?NO:YES}}return NO}.property("content").cacheable(),showMessageInFolder:function(e,t){this.selectedFolderGuid()===e?MessageList.scrollToMessage(t):(MessageList.set("pushMessageGuid",t),this.setFolderSelectionWithGuid(e),this.showSelectedFolder())},getFolderForNonEncodedPath:function(e){e=e.split("/");var t=CoreMail.getFolders().toArray().filterProperty("parent",null),n,r;for(var i=0,s=e.length;i<s;i++){n=t.filterProperty("name",e[i]);if(!n||n.get("length")!==1){n=null;break}n=n[0],r=n.get("realKids"),r.get("length")>0?t=r:t=n.get("kids")}return n},getNonEncodedPathForFolder:function(e){var t=CoreMail.findLocalFolder(e),n;if(t){var r=t.get("realParent");r||(r=t.get("parent")),n=t.get("name");while(r){n=r.get("name")+"/"+n;var i=r.get("realParent");i?r=i:r=r.get("parent")}}return n},mouseInsideView:function(){},onMouseOutsideView:function(){},mouseOnRevealBtn:function(){},showHideActionMenu:function(){},hideRevealBtn:function(){},renameFolderAPIcall:function(){},showDeleteConfirmation:function(){},deleteFolder:function(){},emptyTrash:function(){},startEditing:function(){},finishEditing:function(){},clickOnRefreshButton:function(){},clickOnAddFolderButton:function(){},dropMessages:function(){}}),SC.mixin(FolderList,{_actionMenuPane:null,_hoveredView:null,_beginEditingOnFolder:function(e){e&&!e.isEditing&&this.invokeLast(function(
){e.beginEditing()})},_expandFolder:function(e){e&&(e.notifyPropertyChange("children"),e.set("isExpanded",YES))},_rescheduleFolderListFetch:function(){CoreMail.get("werePreferencesFetched")===NO?this._rescheduleFolderListFetch.invokeLater(this,CoreMail.INTERVAL_FOLDER_LIST_FETCH):this.dispatch({sig:"load content"})},_setupFolderListAfterLoad:function(){var e=this.get("content");e||(this.set("content",this._folderArray),e=this.get("content"));var t=e.getEach("sha1");this._deleteInvalidFilterCriteria(t),this._deleteInvalidOpenFolderDisclosures(t),this._deleteInvalidVipUnreadCounts(t);var n=CoreMail.findLocalFolder(this.lastSelectedFolderGuid());n&&(this.foldersTreeController.selectObject(n),this.invokeLast(this.showSelectedFolder))},_deleteInvalidFilterCriteria:function(e){var t=CoreMail.getPath("implicitPreferences.folderFilterCriteriaMap");this._deleteInvalidKeys(t,e)&&CoreMail.saveImplicitPreference("folderFilterCriteriaMap",t)},_deleteInvalidOpenFolderDisclosures:function(e){var t=CoreMail.getPath("implicitPreferences.openFolderDisclosures");this._deleteInvalidKeys(t,e)&&CoreMail.saveImplicitPreference("openFolderDisclosures",t)},_deleteInvalidVipUnreadCounts:function(e){var t=CoreMail.getPath("implicitPreferences.vipUnreadCounts");this._deleteInvalidKeys(t,e)&&CoreMail.saveImplicitPreference("vipUnreadCounts",t)},_deleteInvalidKeys:function(e,t){var n,r=NO;for(n in e)e.hasOwnProperty(n)&&t.indexOf(n)===-1&&(delete e[n],r=YES);return r},_scrollToSelectedFolder:function(){var e=FolderList.getPath("page.folderList.contentView"),t=e.getPath("selection.firstObject");if(t){var n=
e.itemViewForContentObject(t);n&&n.scrollToVisible()}},_showDeleteConfirmation:function(e){var t,n,r=NO;e&&(t=e.get("displayName").trim(),e.get("role")===CoreMail.FOLDER_ROLE_VIP?n="VipSender.DeleteFolder":e.get("children")?(r=YES,n="FolderList.DeleteSubFolders"):n="FolderList.DeleteFolder");var i=this;CoreMail.get("isResyncFolderListInProgress")||CoreMail.errorHandler.handleError({keyString:n,rightButton:{title:"_Common.Button.Delete".loc(),action:function(){var t=i.get("foldersToDelete");CoreMail.errorHandler.removeErrorPane(this),t.pushObject(e),r===YES&&t.pushObjects(e.get("subfolders")),i.dispatch({sig:"deleteFolder"})}},middleButton:"_Common.Button.Cancel",messageLocParams:{folderName:t}})}}),FolderList.metrics=SC.Object.create({ACTION_MENU_ITEM_WIDTH:200}),FolderList.SourceInlineTextFieldView=SC.InlineTextFieldView.extend({classNames:["folder-inline-editor"],leftAccessoryView:SC.ImageButtonView.create({layout:{left:-59,width:23,top:4,height:23},image:"delete-folder",mouseUp:function(e){var t;return e.target&&(t=SC.$(e.target).hasClass("delete-folder")),t===NO&&FolderList.get("isDeleteClicked")===YES&&(FolderList.set("isDeleteClicked",NO),this.get("parentView").commitEditing()),arguments.callee.base.apply(this,arguments),YES},action:function(){FolderList.removeFolder(FolderList.get("editingFolder")),this.get("parentView").discardEditing(),FolderList.set("isDeleteClicked",NO)}}),insertNewline:function(){var e=SC.browser;return e.isEdge||e.isIE?(this.get("value")!==this.$input().val()&&this.set("value",this.$input().val()),this.invokeLater(function(){this.commitEditing()
}.bind(this),1),YES):arguments.callee.base.apply(this,arguments)},cancel:function(){var e=SC.browser;return e.isEdge||e.isIE?(this.invokeLater(function(){this.discardEditing()}.bind(this),1),YES):arguments.callee.base.apply(this,arguments)},render:function(e){arguments.callee.base.apply(this,arguments);var t=this._target,n=this.getPath("leftAccessoryView.layout").left;t&&(t.getPath("content.role")===CoreMail.FOLDER_ROLE_VIP?n!==-50&&this.get("leftAccessoryView").adjust("left",-50):(t.get("outlineLevel")>0&&e.addClass("has-parent"),n!==-59&&this.get("leftAccessoryView").adjust("left",-59)))},willLoseFirstResponder:function(e,t){FolderList.set("didInlineEditorLoseFocus",YES);if(t){var n=SC.$(t.target).hasClass("delete-folder");n===YES&&FolderList.set("isDeleteClicked",YES)}arguments.callee.base.apply(this,arguments),this.invokeLast(function(){FolderList.set("didInlineEditorLoseFocus",NO)})}}),FolderList.SourceListItemView=SC.ListItemView.extend({exampleEditor:FolderList.SourceInlineTextFieldView,_isMouseDownOnAddFolderButton:NO,_isMouseDownOnRevealButton:NO,editValue:null,ariaRole:"treeitem",displayProperties:"content selection toolTip isDropZone unreadCount addFolderIcon".w(),localize:YES,contentKeys:{contentNameKey:"name",contentRoleKey:"role",contentParentKey:"parent",contentKidsKey:"kids",contentChildrenKey:"children",contentTypeKey:"type",contentTotalKey:"total",contentUnreadKey:"unread",contentDisplayNameKey:"displayName",contentIconKey:"icon",contentGroupKey:"group",contentCountKey:"count"},contentNameKey:"name",contentRoleKey:"role",contentParentKey:"parent",contentKidsKey
:"kids",contentChildrenKey:"children",contentTypeKey:"type",contentTotalKey:"total",contentUnreadKey:"unread",contentDisplayNameKey:"displayName",contentIconKey:"icon",contentGroupKey:"group",contentCountKey:"count",unreadCount:null,unreadCountBinding:".content.count",addFolderIcon:null,addFolderIconBinding:".owner.addFolderIcon",isEditingDidChange:function(){var e;if(!this._$||this._$.length!==1)this._$=this.$();var t=this._$;this.get("isEditing")===YES?(t.addClass("editing"),e=this.get("contentIndex")):(t.removeClass("editing"),e=null),FolderList.set("indexOfEditingFolder",e)}.observes("isEditing"),didCreateLayer:function(){this.$().hasClass("has-disclosure")&&this.parentView.get("hasDisclosureView")===NO&&this.parentView.set("hasDisclosureView",YES)},render:function(e){var t=this.get("content"),n,r,i,s,o;if(!this._$||this._$.length!==1)this._$=this.$();o=this._$;if(!t){var u="FolderList.SourceListItemView render:content is undefined";CoreMail.errorHandler.logErrorTrap(u);return}r=t.get("name"),i=t.get("role"),s=t.get("parent");var a=this.get("outlineLevel");n=this.get("classNames"),e.addClass(this._classNameForTruncatedLabel()),i===CoreMail.FOLDER_ROLE_VIP&&e.addClass("vip"),i===CoreMail.FOLDER_ROLE_JUNK&&e.addClass("full-bottom-separator"),this.get("isDropZone")&&e.addClass("drop-zone"),this.getPath("content.isFoldersGroup")||e.addClass("leaf-node"),this.get("isEditing")?o.addClass("editing"):o.removeClass("editing"),s?e.addClass("has-parent"):e.addClass("has-no-parent"),i===CoreMail.FOLDER_ROLE_GHOST&&e.addClass("ghost-folder"),i===CoreMail.FOLDER_ROLE_SENT&&this.renderSentSpinner
(e);var f=a;a>FolderList.MAX_NESTING_LEVELS&&(a=FolderList.MAX_NESTING_LEVELS,this.set("outlineLevel",a)),f===0&&e.addClass("level-0");var l=arguments.callee.base.apply(this,arguments);return this.set("outlineLevel",f),this.getPath("content.isFoldersGroup")?(this.addIcon(e,this.get("addFolderIcon")),e.addClass("folders-group"),this.set("toolTip","_FolderList.AddFolder".loc()),e.removeAttr("role")):e.attr("aria-level",this.get("outlineLevel")+1),e.hasClass("has-disclosure")&&(e.attr("role","group"),t.get("isExpanded")?e.attr("aria-expanded","true"):e.attr("aria-expanded","false")),this.get("isSelected")?e.attr("aria-selected","true"):e.attr("aria-selected","false"),l},renderLabel:function(e,t){var n=this.getPath("content.isFoldersGroup")?"me-sourcelist-section-label":"me-sourcelist-row-title";t=t?t.replace(/ /g,"&nbsp;"):"",t=t.replace(/"/g,"&quot;"),e.push('<label class="',n,'" title="',t||"",'">',t||"","</label>")},renderSentSpinner:function(e){e.push('<span id="spinner" class="sent-spinner spinner-18px-e8ebf2 sc-hidden"></span>')},renderCount:function(e,t){e.push('<div class="count digit">',t.toString(),"</div>")},isEditingEnabled:function(){var e=NO,t=this.getPath("content.role");return t===CoreMail.FOLDER_ROLE_FOLDER?e=YES:t===CoreMail.FOLDER_ROLE_VIP&&this.getPath("content.parent")!==null&&(e=YES),e}.property(),beginEditing:function(e){if(this.get("isEditingEnabled")){FolderList.setEditingFolder(this),FolderList.dispatch({sig:"startEditing"}),this.scrollToVisible();if(e){var t=this.get("owner"),n=this.get("contentIndex");return this.invokeLast(function(){var e=t.itemViewForContentIndex
(n);e&&e.beginEditing&&e.beginEditing(NO)}),YES}return arguments.callee.base.apply(this,arguments)}return NO},inlineEditorWillBeginEditing:function(e){return e.set("maxLength",100),arguments.callee.base.apply(this,arguments)},inlineEditorShouldBeginEditing:function(){return this.get("isEditingEnabled")?(this.$().addClass("editing"),YES):NO},inlineEditorShouldCommitEditing:function(e,t){if(!this.get("pane"))return YES;if(FolderList.get("isDeleteClicked")===YES)return NO;var n=NO;return this._isValidating||(this._isValidating=YES,FolderList.validateFolderName(this.get("content"),t)?(this._isValidating=null,n=YES):this.invokeLater(function(){this.get("pane").makeFirstResponder(e),this._isValidating=null},100)),n},inlineEditorDidCommitEditing:function(e,t){var n=this.get("content");return FolderList.get("isDeleteClicked")===NO&&t!==n.get("name")?FolderList.dispatch({sig:"finishEditing",newFolderName:t}):FolderList.dispatch({sig:"finishEditing"}),arguments.callee.base.apply(this,arguments)},inlineEditorDidDiscardEditing:function(){return FolderList.dispatch({sig:"discardEditing"}),arguments.callee.base.apply(this,arguments)},mouseDown:function(e){if(FolderList.get("didInlineEditorLoseFocus")===YES)return FolderList.set("didInlineEditorLoseFocus",NO),YES;var t=arguments.callee.base.apply(this,arguments);return!t&&this._isInsideElementWithClassName("add-button",e)?(this._isMouseDownOnAddFolderButton=YES,this.$(".add-button").addClass("active"),YES):t},mouseUp:function(e){var t=arguments.callee.base.apply(this,arguments);if(!t&&this._isMouseDownOnAddFolderButton)return this.$(".add-button"
).removeClass("active"),this._isMouseDownOnAddFolderButton=NO,this._isInsideElementWithClassName("add-button",e)&&(FolderList.selectedFolderRole()===CoreMail.FOLDER_ROLE_FOLDER?FolderList.addNewFolder():FolderList.addNewFolderAtRootLevel()),YES;if(!this._isInsideDisclosure(e)&&e.clickCount===2)this.beginEditing(),t=YES;else if(this._isInsideDisclosure(e)){var n=CoreMail.getPath("implicitPreferences.openFolderDisclosures"),r=this.get("content");r.get("isExpanded")?n[r.get("sha1")]=YES:(n[r.get("sha1")]=undefined,delete n[r.get("sha1")]),CoreMail.saveImplicitPreference("openFolderDisclosures",n),t=YES}return t},addIcon:function(e,t){var n=this.get("toolTip");SC.typeOf(n)===SC.T_STRING&&(n=n.loc(),e.begin("img").addClass(t).attr("src",SC.BLANK_IMAGE_URL).attr("title",n).attr("alt",n).end())},contentPropertyDidChange:function(e,t){if(t==="status"&&this.get("parentView")){var n=this.get("parentView").get("childViews")[0];n.displayDidChange()}},renderSpinner:function(e){e=e.begin("div"),e.addClass("spinner");if(!this.get("content")||!this.get("content").get("children"))return;var t=this.get("content").get("children"),n=NO,r=t.getEach("status"),i,s;for(i=0,s=r.length;i<s;i++)if(r[i]&SC.Record.BUSY){n=YES;break}n&&e.addClass("sel"),e.end()},_classNameForTruncatedLabel:function(){var e=this.getPath("content.count"),t;if(e&&e>0)switch(e.toString().length){case 1:t="one-digit";break;case 2:t="two-digit";break;case 3:t="three-digit";break;case 4:t="four-digit";break;case 5:t="five-digit";break;case 6:t="six-digit";break;default:t="six-digit"}else t="zero-digit";return t}}),FolderList.SourceListView=
SC.SourceListView.design({layout:{top:1,left:0,right:0,bottom:0},rowHeight:44,classNames:"folder-list".w(),hasHorizontalScroller:YES,canReorderContent:YES,contentValueKey:"displayName",hasContentIcon:YES,contentIconKey:"icon",contentUnreadCountKey:"count",ariaRole:"tree",exampleView:FolderList.SourceListItemView.design({}),canDeleteContentKey:"canDelete",canEditContent:YES,selectOnMouseDown:NO,_isValidDragOperation:NO,dragDataTypes:[CoreMail.Folder],delegate:this,isDropTarget:YES,_lastDropIdx:null,hasDisclosureView:NO,addFolderIcon:"add-button",_viewOrientation:null,hasDisclosureViewDidChange:function(){var e=this.$();this.get("hasDisclosureView")===NO?e.hasClass("no-disclosure")||e.addClass("no-disclosure"):e.hasClass("no-disclosure")&&e.removeClass("no-disclosure")}.observes("hasDisclosureView"),render:function(e){this.get("hasDisclosureView")===NO?e.addClass("no-disclosure"):e.removeClass("no-disclosure"),arguments.callee.base.apply(this,arguments)},interpretKeyEvents:function(e){var t,n=e.commandCodes(),r=n[0],i=this.get("selection"),s,o,u,a=NO,f=NO,l=NO;i&&(s=i.get("firstObject"),o=s.get("canDelete"),u=this.get("content").indexOf(s)),s.get("role")===CoreMail.FOLDER_ROLE_INBOX?f=YES:s.get("role")===CoreMail.FOLDER_ROLE_DRAFTS?a=YES:s.get("role")===CoreMail.FOLDER_ROLE_VIP&&(l=YES);if(r==="down"&&f||r==="up"&&(a||l)||r==="left"&&l){var c,h,p,d,v=1;return c=this.get("content").objectAt(1),p=c.get("children"),p&&(h=p.get("length")),!SC.empty(c)&&c.get("parent")===null&&(p!==null&&h>0?(d=CoreMail.getPath("implicitPreferences.openFolderDisclosures"),c.get("isExpanded")||(d[c.
get("sha1")]=YES,c.set("isExpanded",YES),CoreMail.saveImplicitPreference("openFolderDisclosures",d)),f?v=2:l&&(u===2&&r==="up"?v=2:r==="left"&&(v=0))):r==="left"&&l&&(v=0)),a||l?this.selectPreviousItem(NO,v):this.selectNextItem(NO,v),YES}if(r==="tab"||r==="shift_tab")return NO;t=arguments.callee.base.apply(this,arguments);if(r==="delete"||r==="backspace")i&&o&&FolderList.dispatch({sig:"showDeleteConfirmation",folderToDelete:s}),t=YES;return t},didBecomeFirstResponder:function(){MessageList.ORIENTATION_TWO_COL===MessageList.get("viewPreference")&&MessageList.page.getPath("messageList.contentList.contentView").becomeFirstResponder()},mouseDown:function(e){SC.browser.isMozilla?this.invokeLater(function(){var e=ViewMessage.getWebViewIframe();e&&e.blur(),window.focus?window.focus():CoreMail.errorHandler.logErrorTrap("FolderList.SourceListView.mouseDown : window does not have method focus()")},1):window.focus?window.focus():CoreMail.errorHandler.logErrorTrap("FolderList.SourceListView.mouseDown : window does not have method focus()"),this.set("acceptsFirstResponder",NO);var t=arguments.callee.base.apply(this,arguments);return this._mouseDownView=this.itemViewForEvent(e),this.set("acceptsFirstResponder",YES),t},doubleClick:function(){return this._mouseDownView||FolderList.addNewFolderAtRootLevel(),NO},mouseDragged:function(e){var t=this.mouseDownInfo,n;if(!t||!t.event)n=YES;else{var r=t.event,i=r.clientX,s=r.clientY,o=i-e.clientX,u=s-e.clientY,a=Math.sqrt(o*o+u*u);a<=CoreMail.DRAG_START_THRESHOLD?n=YES:(this._isFolderDrag=YES,n=arguments.callee.base.apply(this,arguments))}return n}
,mouseUp:function(){var e,t,n,r,i=Message.searchController;i.get("searchPaneVisible")&&(i.clearSearchField(),Mail.getPath("mainPage.searchTextViewOutlet").resignFirstResponder(),i.set("searchPaneVisible",NO));if(this._isFolderDrag)e=NO;else if(this.mouseDownInfo){t=this.mouseDownInfo.itemView.get("content"),n=t.get("children"),n&&(r=n.get("length"));if(t)if(t.get("role")===CoreMail.FOLDER_ROLE_VIP&&t.get("parent")===null&&n!==null&&r>0){var s=this.mouseDownInfo.itemView.getPath("content.isExpanded"),o=CoreMail.getPath("implicitPreferences.openFolderDisclosures");s?(o[t.get("sha1")]=undefined,delete o[t.get("sha1")]):o[t.get("sha1")]=YES;var u=this.mouseDownInfo.contentIndex;FolderList.foldersTreeController.getPath("content.children")[u].set("isExpanded",!s),CoreMail.saveImplicitPreference("openFolderDisclosures",o),e=NO}else t.get("isFoldersGroup")===YES?(FolderList.addNewFolderAtRootLevel(),e=arguments.callee.base.apply(this,arguments)):(this.mouseDownInfo.shouldSelect&&FolderList.set("isFolderChangedByMouse",YES),e=arguments.callee.base.apply(this,arguments))}else FolderList.passFirstResponder(),e=arguments.callee.base.apply(this,arguments);return this._isFolderDrag=NO,e},collectionViewShouldBeginDrag:function(){var e;if(this._mouseDownView!==null){e=this._mouseDownView.get("content");if(e){var t=e.get("role");if(t===CoreMail.FOLDER_ROLE_FOLDER)return this._isFolderIsDragged=YES,YES}}else{var n="FolderList.SourceListView collectionViewShouldBeginDrag : _mouseDownView is null";CoreMail.errorHandler.logErrorTrap(n)}return NO},computeDragOperations:function(){return SC.DRAG_MOVE
},dragStarted:function(){this._isFolderDrag=YES;var e=MessageList.get("viewPreference");return this._viewOrientation=e,e===MessageList.ORIENTATION_TWO_COL&&MessageList.switchToThreeColumnView(),SC.DRAG_MOVE},dragEntered:function(){return FolderList.dispatch({sig:"dragOverFolder"}),SC.DRAG_MOVE},mouseMoved:function(){try{return arguments.callee.base.apply(this,arguments)}catch(e){return SC.warn(e),NO}},dragUpdated:function(e){var t=NO;if(e.hasDataType(CoreMail.Message))t=YES;else if(!e.hasDataType(CoreMail.Folder))return arguments.callee.base.apply(this,arguments);var n=this.convertFrameFromView(e.get("location"),null),r=this.insertionIndexForLocation(n,SC.DROP_ON),i=r[0];if(i!==this._lastDropIdx){this._stopExpandFolderTimer(),FolderList.dispatch({sig:"dragHoverEndOnFolder"});var s=this.itemViewForContentIndex(i),o=s.get("content");if(!s||!o)return this._lastDropIdx=-1,SC.DRAG_NONE;var u=o.get("children");u&&!o.get("isExpanded")&&this._startExpandFolderTimer(o);if(t){var a=FolderList.get("msgDragContent");if(a){var f=a.getPath("firstObject.isFromVipSender"),l=a.get("length"),c=FolderList.selectedFolderRole(),h=o.get("role"),p=CoreMail.FOLDER_ROLE_INBOX,d=CoreMail.FOLDER_ROLE_VIP;if(s.getPath("content.isFoldersGroup")||CoreMail.FOLDER_ROLE_GHOST===h||d===h&&(o.get("parent")!==null||f||l>1||c!==p)||p===h&&d===c||FolderList.isMessagesDraggedToSameFolder(o)||FolderList.isUnloadedMessagesDraggedToJunkFolder(o))return MessageList.signalInvalidDropTarget(),this._lastDropIdx=-1,SC.DRAG_NONE}}else if(e.hasDataType(CoreMail.Folder))if(this._mouseDownView!==null){var v=this._mouseDownView
.get("content");if(!FolderList.isValidFolderDropTarget(v,s))return FolderList.signalInvalidDropTarget(),this._lastDropIdx=-1,SC.DRAG_NONE}else{var m="FolderList.SourceListView dragUpdated : mouseDownView is null";CoreMail.errorHandler.logErrorTrap(m)}-1===this._lastDropIdx&&(t?MessageList.signalValidDropTarget():FolderList.signalValidDropTarget()),this._lastDropIdx=i,this.invokeLast(function(){FolderList.dispatch({sig:"dragHoverOnFolder",folder:s})})}return SC.DRAG_MOVE},performDragOperation:function(e){if(e.hasDataType(CoreMail.Message))null!==this._lastDropIdx&&-1!==this._lastDropIdx&&(this._isValidDragOperation=YES,FolderList.dispatch({sig:"dropMessages"}),this.displayDidChange());else{if(!e.hasDataType(CoreMail.Folder))return arguments.callee.base.apply(this,arguments);var t=this._lastDropIdx,n=this.itemViewForContentIndex(t),r,i,s;if(n){r=n.get("content"),r&&(i=r.get("name"));var o=NO;r&&this._isFolderIsDragged&&(n.getPath("content.isFoldersGroup")?(o=YES,s=null):CoreMail.FOLDER_ROLE_FOLDER===r.get("role")&&(o=YES,s=r),o&&(this._isValidDragOperation=YES,FolderList.dispatch({sig:"dropFolder",draggedFolder:this._mouseDownView}),this.displayDidChange()))}}},dragExited:function(){FolderList.dispatch({sig:"dragHoverEndOnFolder"}),this._stopExpandFolderTimer(),this._lastDropIdx=null,MessageList.signalValidDropTarget(),FolderList.signalValidDropTarget()},dragEnded:function(e){this._isFolderDrag=NO;var t=this._lastDropIdx,n=this.itemViewForContentIndex(t),r=n.getPath("isDropZone");FolderList.collapseTempExpandedFolders();if(e.dataTypes)if(e.hasDataType(CoreMail.Message))r&&(this
._isValidDragOperation=YES,FolderList.dispatch({sig:"dropMessages"})),this._viewOrientation===MessageList.ORIENTATION_TWO_COL&&MessageList.switchToTwoColumnView(),this._lastDropIdx=null;else{if(!e.hasDataType(CoreMail.Folder))return;this._lastDropIdx=null}this._isValidDragOperation===NO?FolderList.dispatch({sig:"dragEnded"}):this._isValidDragOperation=NO},collectionViewDragViewFor:function(e,t){if(t&&this._mouseDownView){var n;return this._mouseDownView.$().hasClass("has-parent")?n="subfolder":n=this._mouseDownView.getPath("content.role"),this._dragView=FolderList.DragView.create({folderName:this._mouseDownView.getPath("content.name"),iconName:n}),FolderList.setCurrentDragView(this._dragView),this._dragView}if(this._mouseDownView===null){var r="FolderList.SourceListView collectionViewDragViewFor : _mouseDownView is null";CoreMail.errorHandler.logErrorTrap(r)}return null},ghostActsLikeCursor:YES,_startExpandFolderTimer:function(e){this._expandFolderTimer||(this._expandFolderTimer=SC.Timer.schedule({target:this,action:function(){FolderList.expandDropFolder(e),FolderList.addTempExpandedFolder(e)},repeats:NO,interval:CoreMail.INTERVAL_DRAG_HOVER_ON_COLLAPSED_FOLDER}))},_stopExpandFolderTimer:function(){this._expandFolderTimer&&(this._expandFolderTimer.invalidate(),this._expandFolderTimer=null)},moveRight:function(e){var t=FolderList.foldersTreeController.getPath("selection.firstObject");return NO===t.get("isExpanded")&&t.getPath("children.length")>0?arguments.callee.base.apply(this,arguments):Global.tryToPerform("keyDown",e)?YES:NO},viewDidResize:function(){var e=FolderList.get("indexOfEditingFolder"
);return e&&this.itemViewForContentIndex(e).commitEditing(),arguments.callee.base.apply(this,arguments)},collectionViewShouldSelectIndexes:function(e,t){var n=e.itemViewForContentIndex(t.firstObject());return n.getPath("content.isFoldersGroup")?null:t}}),FolderList.page=SC.Page.design({folderList:SC.ScrollView.design(CW.FadingCaplessScrollerViewSupport,{classNames:"left source-list stack-order".w(),layout:{top:0,left:0,right:0,bottom:44},hasHorizontalScroller:NO,verticalScrollerView:CW.FadingCaplessScrollerView.extend({mouseDragged:function(){return FolderList.get("indexOfEditingFolder")?YES:arguments.callee.base.apply(this,arguments)}}),verticalOverlay:YES,verticalScrollerLayout:{right:-1,top:1,bottom:1},isVerticalScrollerVisibleDidChange:function(){this.displayDidChange()}.observes("isVerticalScrollerVisible"),render:function(e){var t=this.get("isVerticalScrollerVisible");t&&e.addClass("scroller-visible"),arguments.callee.base.apply(this,arguments)},mouseWheel:function(){return FolderList.get("indexOfEditingFolder")?YES:arguments.callee.base.apply(this,arguments)},borderStyle:SC.BORDER_NONE,contentView:FolderList.SourceListView.extend({contentBinding:"FolderList.foldersTreeController.arrangedObjects",selection:null,selectionBinding:"FolderList.foldersTreeController.selection"})})}),FolderList.DragView=SC.View.extend({layout:{height:56,width:200},childViews:"name".w(),folderName:null,iconName:null,name:SC.LabelView.design({layout:{top:0,left:0},classNames:["folder-drag","sc-menu-item-drag"],icon:null,init:function(){arguments.callee.base.apply(this,arguments);var e=this.getPath
("owner.iconName");this.set("icon",e.toLowerCase())},textValue:function(){return SC.RenderContext.escapeHTML(this.getPath("owner.folderName"))}.property(),render:function(e){arguments.callee.base.apply(this,arguments),e.push('<div class="drag-label-text '+this.get("icon")+'">'+this.get("textValue")+"</div>")}}),setInvalidDrop:function(e){var t="default";e&&(t="no-drop"),this.get("name").$().css("cursor",t)}});var Global=SC.Object.create({initial:"0.1 Global Enabled","0.1 Global Enabled":function(e){switch(e.sig){case"enter":return CK.Statechart.handled();case"exit":return CK.Statechart.handled();case"keyDown":if(this.get("isAppReady")===NO)return;var t=e.commandCodes(),n=t[0],r=MainToolbar.page.getPath("toolbar.pane.firstResponder");switch(n){case"alt_shift_n":return CoreMail.incrementUserStat(CoreMail.STAT_KS_COMPOSE),this.openMessage(CoreMail.MESSAGE_MODE_COMPOSE,""),CK.Statechart.handled();case"ctrl_shift_m":var i=MessageList.get("viewPreference");return i===MessageList.ORIENTATION_TWO_COL?MessageList.switchToThreeColumnView():i===MessageList.ORIENTATION_THREE_COL&&(MessageList.switchToTwoColumnView(),Global.set("isFolderListAutoHidden",NO)),CK.Statechart.handled();case"ctrl_shift_r":CoreMail.incrementUserStat(CoreMail.STAT_KS_REPLY);var s=Message.messageListController.get("selection"),o=FolderList.selectedFolderGuid();if(o!==CoreMail.DRAFTS_GUID&&s&&s.firstObject()){var u=s.firstObject().get("guid");Message.getPath("messageListController.selection.length")===1&&Global.openMessage(CoreMail.MESSAGE_MODE_REPLY,u)}return CK.Statechart.handled();case"ctrl_ ":return this.focusSearchField
(),CK.Statechart.handled();case"tab":var a;return r instanceof FolderList.SourceListView?MessageList.takeFirstResponder():r instanceof MessageList.MessageListView?this.focusSearchField():MessageList.ORIENTATION_TWO_COL===MessageList.get("viewPreference")?MessageList.takeFirstResponder():(a=FolderList.getPath("page.folderList.contentView"),a&&(a.becomeFirstResponder(),a.$().focus())),CK.Statechart.handled();case"shift_tab":var f;if(r instanceof FolderList.SourceListView)if(Message.messageListController.selection().firstObject()){f=ViewMessage.getPath("page.messageScrollView.contentView");if(f)return f.becomeFirstResponder(),YES}else this.focusSearchField();else if(r instanceof MessageList.MessageListView)if(MessageList.ORIENTATION_THREE_COL===MessageList.get("viewPreference"))a=FolderList.getPath("page.folderList.contentView"),a&&a.becomeFirstResponder();else if(Message.messageListController.selection().firstObject()){f=ViewMessage.getPath("page.messageScrollView.contentView");if(f)return f.becomeFirstResponder(),YES}else this.focusSearchField();else this.focusSearchField();return CK.Statechart.handled();case"right":var l;if(r instanceof SC.InlineTextFieldView)return;var c=Message.getPath("messageListController.selection.length");return r instanceof FolderList.SourceListView?(MessageList.takeFirstResponder(),c<=0&&MessageList.selectFirstMessage()):r instanceof MessageList.MessageListView&&(c<=0?MessageList.selectFirstMessage():(l=ViewMessage.getPath("page.messageScrollView.contentView"),l&&l.becomeFirstResponder())),CK.Statechart.handled();case"left":var h;if(r instanceof SC.
InlineTextFieldView)return;return r instanceof FolderList.SourceListView||(r instanceof MessageList.MessageListView?MessageList.ORIENTATION_TWO_COL!==MessageList.get("viewPreference")&&(h=FolderList.page.getPath("folderList.contentView")):(h=MessageList.page.getPath("messageList.contentList.contentView"),h.$().focus())),h&&h.becomeFirstResponder(),CK.Statechart.handled();case"backspace":return e.preventDefault(),CK.Statechart.handled();case"alt_ctrl_shift_d":return Global.downloadMessage(),CK.Statechart.handled();case"alt_ctrl_shift_u":var p=$('<input type="file">')[0];return p.onchange=function(){var e=this.files?this.files[0]:null;this.onchange=undefined,e&&CoreMail.uploadMessage(e,FolderList.selectedFolderGuid())},p.click(),CK.Statechart.handled()}return;case"openPreferences":return SC.Benchmark.start("perfDisplayPrefs"),this._openPreferences(),CK.Statechart.handled();case"printSelectedMessage":return this.invokeLater(function(){this._printMessage()},50),CK.Statechart.handled()}}.state(),openPreferences:function(){},printSelectedMessage:function(){}});SC.mixin(Global,{hasStartupFailed:NO,isVIPWelcomePageVisible:NO,isFolderListAutoHidden:NO,inlineImageMargin:"margin: 10px 10px 10px 0px;",isMethodNotAllowedErrorReported:NO,isAppReady:function(e,t){return t===undefined?!this._isAppReady&&window.MailMessage?this._isAppReady=YES:this._isAppReady=NO:this._isAppReady=t,this._isAppReady}.property().cacheable(),_childWindows:[],appNamespace:null,SEND_ERROR_CODES:[2221,2201,2301,2302,14009,14010,14011],configure:function(e){this.set("appNamespace",e),CoreMail.set("global",Global)},
printSelectedMessage:function(){this.dispatch({sig:"printSelectedMessage"})},openPreferences:function(){this.dispatch({sig:"openPreferences"})},openMessage:function(e,t,n,r){switch(e){case CoreMail.MESSAGE_MODE_COMPOSE:case CoreMail.MESSAGE_MODE_REPLY:case CoreMail.MESSAGE_MODE_REPLY_ALL:case CoreMail.MESSAGE_MODE_FORWARD:case CoreMail.MESSAGE_MODE_FORWARD_AS_ATTACHMENT:SC.Benchmark.start("perfOpenMessageWindowInEditMode");break;case CoreMail.MESSAGE_MODE_VIEW:SC.Benchmark.start("perfOpenMessageWindowInViewMode")}if(t==="")CoreMail.hashChildWindowRecords(t),this._openMessageWindow(e);else{if(e===CoreMail.MESSAGE_MODE_COMPOSE||e===CoreMail.MESSAGE_MODE_VIEW){var i=this.getChildWindowForMessage(t,e);if(i&&i.focus){i.focus();return}}if(e===CoreMail.MESSAGE_MODE_VIEW){var s=CoreMail.store.find(CoreMail.Message,t);s&&s.get("unread")===YES&&(s.set("unread",NO),CoreMail.washClean(CoreMail.store,s.get("storeKey")))}CoreMail.hashChildWindowRecords(t,r),this._openViewerWindow(e,t,n)}},_openViewerWindow:function(e,t,n){var r="",i="";SC.debug("Open child window: "+e+"/"+t),CoreMail.MESSAGE_MODE_FORWARD===e?(i=n?"1":"0",r=this._openMessageWindow(e+"?guid="+URI.encodeQuery(t)+"&lh="+i)):r=this._openMessageWindow(e+"?guid="+URI.encodeQuery(t)),this._storeMessageWindow(t,r)},addChildWindow:function(e){var t;if(!e)return;this._childWindows||(this._childWindows=[],window.WHAT_TYPE.isMailChild()?t=MailMessage:t=Mail,this._childWindowsRefChecker||(this._childWindowsRefChecker=SC.Timer.schedule({target:t,action:"removeInvalidChildRef",repeats:YES,interval:CoreMail.INTERVAL_CHILD_WINDOW_CLEANUP})
)),this._childWindows.push(e)},closeAllChildWindows:function(){if(!this._childWindows)return;for(var e=this._childWindows.length-1;e>=0;e--)this._childWindows[e].close(),this._childWindows.removeAt(e)},getAllChildWindows:function(){return this._childWindows},setMailPageTitle:function(e,t,n){if(t===null||t===undefined)return;var r,i=Message.searchController.get("searchFieldValue"),s=t?t:0,o=n?n:0,u="",a=s%10,f=o%10;if(i){var l="";switch(YES){case s===0:l="_PageTitle.Mail.SearchResults.0Matches".loc();break;case s===1:l="_PageTitle.Mail.SearchResults.1Match".loc();break;case s===2:l="_PageTitle.Mail.SearchResults.2Matches".loc();break;case s===3||s===4:l="_PageTitle.Mail.SearchResults.3,4Matches".loc(s);break;case s>=5&&s<=10:l="_PageTitle.Mail.SearchResults.5,6,7,8,9,10Matches".loc(s);break;case a===1:l="_PageTitle.Mail.SearchResults.EndingIn1Matches".loc(s);break;case a===2:l="_PageTitle.Mail.SearchResults.EndingIn2Matches".loc(s);break;case a===3||a===4:l="_PageTitle.Mail.SearchResults.EndingIn3,4Matches".loc(s);break;case a>=5&&a<=9||a===0:l="_PageTitle.Mail.SearchResults.EndingIn5,6,7,8,9,0Matches".loc(s)}r=l}else{var c="",h="";switch(YES){case s===0:c="_PageTitle.Mail.0Messages".loc();break;case s===1:c="_PageTitle.Mail.1Message".loc();break;case s===2:c="_PageTitle.Mail.2Messages".loc();break;case s===3||s===4:c="_PageTitle.Mail.3,4Messages".loc(s);break;case s>=5&&s<=10:c="_PageTitle.Mail.5,6,7,8,9,10Messages".loc(s);break;case a===1:c="_PageTitle.Mail.EndingIn1Messages".loc(s);break;case a===2:c="_PageTitle.Mail.EndingIn2Messages".loc(s);break;case a===3||a===4:c="_PageTitle.Mail.EndingIn3,4Messages"
.loc(s);break;case a>=5&&a<=9||a===0:c="_PageTitle.Mail.EndingIn5,6,7,8,9,0Messages".loc(s)}switch(YES){case o===0:h="";break;case o===1:h="_PageTitle.Mail.1Unread".loc();break;case o===2:h="_PageTitle.Mail.2Unread".loc();break;case o===3||o===4:h="_PageTitle.Mail.3,4Unread".loc(o);break;case o>=5&&o<=10:h="_PageTitle.Mail.5,6,7,8,9,10Unread".loc(o);break;case f===1:h="_PageTitle.Mail.EndingIn1Unread".loc(o);break;case f===2:h="_PageTitle.Mail.EndingIn2Unread".loc(o);break;case f===3||f===4:h="_PageTitle.Mail.EndingIn3,4Unread".loc(o);break;case f>=5&&f<=9||f===0:h="_PageTitle.Mail.EndingIn5,6,7,8,9,0Unread".loc(o)}o>0&&(u="_PageTitle.Mail.UnreadInParenthesis".loc(o)),r="_PageTitle.Mail.Folder".loc(u,e,c,h)}CloudOS.setTitle(r)},_emailValidator:null,validateEmail:function(e){var t=SC.Object.create({fieldValue:e}),n=this._emailValidator;return n||(n=SC.Validator.Email.create(),this._emailValidator=n),n.validate(null,t)},mailTo:function(e){CoreMail.hashChildWindowRecords(""),this._openMessageWindow(CoreMail.MESSAGE_MODE_COMPOSE+"?to="+URI.encodeQuery(e))},mailToUrl:function(e){if(!e)return this.mailTo();var t=e.split("?"),n="?to="+URI.encodeQuery(t[0]);t[1]&&(n+="&"+URI.encodeQuery(t[1])),CoreMail.hashChildWindowRecords(""),this._openMessageWindow(CoreMail.MESSAGE_MODE_COMPOSE+n)},focusSearchField:function(){var e=MainToolbar.page.getPath("toolbar.pane.dockView.searchContainerView.searchWrapper.searchView.searchTextView");e&&e.becomeFirstResponder()},convertToBoolean:function(e){return"YES"===e?YES:NO},execFunctionInMailContext:function(target,func){try{var funcInNewContext;eval
("funcInNewContext = ("+func+")");var args;return arguments.length>2&&(args=SC.$A(arguments).slice(2)),funcInNewContext.apply(target,args)}catch(e){SC.warn("Error executing function in mail window's context: "+e)}},performKeyEquivalent:function(){return NO},isQuickReplyEnabled:function(){var e=CoreMail.getPath("implicitPreferences.isQuickReplyEnabled");return e===YES?YES:NO}.property(),getFormattedFileSize:function(e){var t={},n="_Common.Bytes";return e>=CoreMail.ATTACHMENT_BYTES_FOR_GB&&(e=Math.round(e*100/CoreMail.ATTACHMENT_BYTES_FOR_GB)/100,e=CoreMail.numberFormatter.formatDecimals(e),n="_Common.GB"),e>=CoreMail.ATTACHMENT_BYTES_FOR_MB?(e=Math.round(e*100/CoreMail.ATTACHMENT_BYTES_FOR_MB)/100,e=CoreMail.numberFormatter.formatDecimals(e),n="_Common.MB"):e>=CoreMail.ATTACHMENT_BYTES_FOR_KB?(e=Math.round(e*100/CoreMail.ATTACHMENT_BYTES_FOR_KB)/100,e=CoreMail.numberFormatter.formatDecimals(e),n="_Common.KB"):e>0&&(e>=1&&e<100?e=Math.round(e*100)/100:e>=100&&(e=Math.round(e*100/1e3)/100,n="_Common.KB")),e=CoreMail.numberFormatter.formatDecimals(e),t.size=e,t.sizeUnits=n,t},shouldShowVipWelcomePage:function(){var e=FolderList.getSelectedFolder(),t=e.get("children"),n=0;t&&(n=t.get("length"));var r=NO;return e&&e.get("role")===CoreMail.FOLDER_ROLE_VIP&&e.get("parent")===null&&(t===null||n===0)&&(r=YES),r!==YES?(Global.set("isVIPWelcomePageVisible",NO),NO):(Global.set("isVIPWelcomePageVisible",YES),r)},isLastNameFirstLanguage:function(){var e=SC.Locale.currentLanguage.toLowerCase();return e==="ja-jp"||e==="hu-hu"||e==="ko-kr"||e==="zh-cn"||e==="zh-tw"?YES:NO}.property().cacheable
(),escapeHTMLAndQuotes:function(e){return html.escapeAttrib(e).replace(/'/g,"&#39;")},getImageOrientationCSSClassForImagePart:function(e){switch(e.get("orientation")){case 2:return CoreMail.IMAGE_ORIENTATION_CLASS_PREFIX+"orientation-2";case 3:return CoreMail.IMAGE_ORIENTATION_CLASS_PREFIX+"orientation-3";case 4:return CoreMail.IMAGE_ORIENTATION_CLASS_PREFIX+"orientation-4";case 5:return CoreMail.IMAGE_ORIENTATION_CLASS_PREFIX+"orientation-5";case 6:return CoreMail.IMAGE_ORIENTATION_CLASS_PREFIX+"orientation-6";case 7:return CoreMail.IMAGE_ORIENTATION_CLASS_PREFIX+"orientation-7";case 8:return CoreMail.IMAGE_ORIENTATION_CLASS_PREFIX+"orientation-8";default:return""}},hasPDFViewer:function(){var e=SC.browser,t=function(e){try{return new ActiveXObject(e)}catch(t){SC.warn("Exception in ActiveXObject for IE. Exception: "+t)}},n=function(e){var t=navigator.plugins,n,r,i=t.length;for(n=0;n<i;n++){r=t[n];if(r.name===e)return r}},r=function(){return e.isIE?t("AcroPDF.PDF")||t("PDF.PdfCtrl"):e.isMozilla&&parseFloat(e.version)>18?YES:n("WebKit built-in PDF")||n("Chrome PDF Viewer")||n("Adobe Acrobat")};return r()?YES:NO}.property().cacheable(),isRTLText:function(e){var t=NO,n=new RegExp("[A-Za-zÀ-ÖØ-öø-ʸ̀-֐ࠀ-῿‎Ⰰ-﬜︀-﹯﻽-￿]"),r="[֑-߿‏יִ-﷿ﹰ-ﻼ]",i=e.search(r),s=e.search(n);return i===-1?t=NO:s===-1?t=YES:i<s?t=YES:t=NO,t},clearSearchField:function(e,t){var n=e.get("searchFieldValue");n&&n.length>0&&e.set("searchFieldValue","");if(t){var r=t.get("selection"),i=SC.browser;i.isMozilla===YES?t.becomeFirstResponder():(i.isIE===YES||i.isEdge===YES)&&r&&r.start!==r.end&&t.set("selection",SC.TextSelection
.create({start:0,end:0}))}},downloadMessage:function(){var e=Message.messageListController.getPath("selection.firstObject"),t,n,r;e?(t=encodeURIComponent(e.get("guid")),n=e.get("subject"),n?n=n.substr(0,100):n="eml",n=encodeURIComponent(n+".eml"),r=CoreMail.addServiceUrlDsidAndClientIdToUrl("/wm/message/"+n+"?guid="+t),SC.debug("Downloading the message. Url = %@".fmt(r)),SC.download(r)):CoreMail.errorHandler.handleError({keyString:"MessageList.Debug.NoMessageSelected"})}}),SC.mixin(Global,{iconURLs:{},fetchIcon:function(e,t,n){var r={docx:"com.microsoft.word.doc",xlsx:"com.microsoft.excel.xls",pptx:"com.microsoft.powerpoint.ppt","org.openxmlformats.wordprocessingml.document":"com.microsoft.word.doc","org.openxmlformats.spreadsheetml.sheet":"com.microsoft.excel.xls","org.openxmlformats.presentationml.presentation":"com.microsoft.powerpoint.ppt","com.apple.iwork.keynote.key":"com.apple.iWork.Keynote.key","com.apple.iwork.keynote.key-tef":"com.apple.iWork.Keynote.key-tef","com.apple.iwork.keynote.sffkey":"com.apple.iWork.Keynote.sffkey","com.apple.iwork.keynote.template":"com.apple.iWork.Keynote.template","com.apple.iwork.pages.pages":"com.apple.iWork.Pages.pages","com.apple.iwork.pages.pages-tef":"com.apple.iWork.Pages.pages-tef","com.apple.iwork.pages.sffpages":"com.apple.iWork.Pages.sffpages","com.apple.iwork.pages.template":"com.apple.iWork.Pages.template","com.apple.iwork.numbers.numbers":"com.apple.iWork.Numbers.numbers","com.apple.iwork.numbers.numbers-tef":"com.apple.iWork.Numbers.numbers-tef","com.apple.iwork.numbers.sffnumbers":"com.apple.iWork.Numbers.sffnumbers","com.apple.iwork.numbers.template"
:"com.apple.iWork.Numbers.template"};e in r&&(e=r[e]);var i,s=this.get("iconURLs"),o=s[e],u;o?u=o[t]:s[e]={};if(u)n(u,e);else{window.opener?i=window.opener.CloudOS:i=CloudOS;if(i&&i.fetchIcon)i.fetchIcon(e,t,function(r){var i=r.iconURL;s[e][t]=i,n(i,e)});else{var a=window.CoreTypes;if(!a)SC.Module.loadModule("cloudkit/core_types",this,function(){var r=window.CoreTypes.API.fetchIcon(e,t,window.devicePixelRatio),i=r.iconURL;s[e][t]=i,n(i,e)}.bind(this));else{var f=a.API.fetchIcon(e,t,window.devicePixelRatio);u=f.iconURL,s[e][t]=u,n(u,e)}}}}}),SC.mixin(Global,{_urlMessageApp:function(){var e=window.location;return e.protocol+"//"+e.hostname+"/message/current/"}.property().cacheable(),_openMessageWindow:function(e){var t=SC.Locale.currentLanguage.toLowerCase();t+="/index.html";var n=this.get("_urlMessageApp")+t;return window.devicePixelRatio===2&&(n+="?2x=true"),n+="#"+e,this._openWindow(n)},_openWindow:function(e){var t=this.getNextChildWindowPosition(),n=CK.openWindowApplication(e,"_blank","width="+Global.metrics.CHILD_WINDOW_WIDTH+",height="+Global.metrics.CHILD_WINDOW_HEIGHT+",top="+t.y+",left="+t.x+",resizable=yes,scrollbars=auto,status=no,menubar=no,toolbar=no,location=no,directories=no"),r=CK.windowApplications[n];r&&(r=r.window);var i=SC.browser;if(i.isIE===NO&&i.isEdge===NO){var s=Global.LOADING_HTML,o=r&&r.document?r.document:null;if(o){if(!o.body){var u=o.createElement("body");o.documentElement?o.documentElement.appendChild(u):o.appendChild(u)}o.body.innerHTML=s}}return this.addChildWindow(r),r},_openPreferences:function(){window.Preferences?Preferences.configure("loading"
):SC.Module.loadModule("preferences","Preferences","configureWrapper","loading")},_printMessage:function(){var e,t=ViewMessage.get("page"),n=t.getPath("messageScrollView.contentView"),r=n.get("messageBodyView"),i=n.getPath("collapsedHeader.isVisible"),s=r.getPath("messageBodyWebView.body"),o=ViewMessage.getPrintViewIframe();if(!o){SC.warn("ViewMessage.getPrintViewIframe() has returned the value : "+o);return}var u=o.contentWindow,a=n.$().html(),f=SC.$("<html></html>").html(a),l=f.find(".header-view-info-date");if(l.length>0){var c=Message.messageController.getFormattedDate(YES);c&&l.text(c)}f.find(".banner-underlay").remove(),i?e=n.get("collapsedHeader"):e=n.get("expandedHeader");if(u){u.document.open();var h=SC.browser;h.isMozilla?o.isMozilla=YES:o.isMozilla=NO,h.isIE?o.isIE=YES:o.isIE=NO,h.isEdge?o.isEdge=YES:o.isEdge=NO;var p=Print.MESSAGE_HEAD+f.html()+s+Print.MESSAGE_TAIL;u.document.write(p),u.document.close(),u.focus(),CoreMail.errorHandler.recordStat("_STAT_PRINT_MESSAGE")}else SC.warn("Could not print because printIFrameContentWindow was null. Is pop-up blocker enabled?")},getChildWindowsForMessage:function(e){if(this._messageWindows){var t=this._messageWindows[e],n=[];if(t){for(var r=t.get("length")-1;r>=0;r--)t[r].closed&&n.pushObject(r);n.forEach(function(e){t.removeAt(e)}),t.get("length")===0&&(delete this._messageWindows[e],t=null)}return t}return null},getChildWindowForMessage:function(e,t){var n,r,i;if(this._messageWindows){var s=this._messageWindows[e],o=[],u;if(s){if(t){for(u=s.get("length")-1;u>=0;u--){r=s[u];if(r.closed===YES)o.pushObject(u);else{i=r.Message
;if(i&&i.getPath("appNamespace.mode")===t){n=r;break}}}o.forEach(function(e){s.removeAt(e)}),n||(n=s.get("lastObject"))}else{for(u=s.get("length")-1;u>=0;u--){r=s[u];if(r.closed!==YES){n=r;break}o.pushObject(u)}o.forEach(function(e){s.removeAt(e)})}n||delete this._messageWindows[e]}}return n},_storeMessageWindow:function(e,t){if(!e||!t){SC.warn("Global._storeMessageWindow: messageGuid or messageWindow is null or undefined.");return}this._messageWindows||(this._messageWindows={});var n=this._messageWindows[e];n||(n=this._messageWindows[e]=[]),n.pushObject(t)},getNextChildWindowPosition:function(){var e=0,t,n,r,i,s;for(s=this._childWindows.length-1;s>=0;s--){if(this._childWindows[s]&&!this._childWindows[s].closed){e=s+1;break}this._childWindows.pop()}return n=e%10,t=parseInt(e/10,10),i=20+n*20,r=20+n*20+t*20,{x:window.screenX+r,y:window.screenY+i}}}),Global.metrics=SC.Object.create({DOCK_HEIGHT:44,DOCK_HEIGHT_WITH_SHADOW:44,MIN_MESSAGEVIEW_WIDTH:520,DOCK_TOOLBAR_SEPARATOR_HEIGHT:44,CHILD_WINDOW_WIDTH:810,CHILD_WINDOW_HEIGHT:644}),function(){var e="";window.COS&&COS.authController&&(e=COS.authController.get("siteURL"));var t=e+"/applications/mail/1808Project39/frameworks/coreweb/apple_theme_v4/1808Project39/en-us/source/resources/spinners/images/spinner_32px_ffffff.gif",n=e+"/applications/mail/1808Project39/frameworks/coreweb/apple_theme_v4/1808Project39/en-us/source/resources/spinners/images/spinner_32px_ffffff@2x.gif",r='<div id="loading-spinner"></div>',i='<div id="loading-main-pane"><div id="loading-centering-positioner">'+r+"</div>"+"</div>",s="#loading-main-pane {  position: fixed; top: 0px; bottom: 0px; left: 0px; right: 0px;}#loading-centering-positioner {  position: absolute; top: 50%; bottom: 0%; width: 100%; text-align: center;}#loading-spinner {  background:url("+
t+"); width: 32px; height: 32px; position: absolute; left: 50%, top:50%; margin-top: -16px; margin-left: -16px;}"+"@media only screen and (-webkit-min-device-pixel-ratio: 1.01),  only screen and (min-resolution: 192dpi) {"+"#loading-spinner {  background:url("+n+"); background-size:32px 32px;}"+"}";Global.LOADING_HTML='<div id="loading"><style type="text/css" media="screen">'+s+"</style>"+i+"</div>"}(),Global.PostMessageHandlerMixin={_messageWasReceived:function(e){var t=e.originalEvent,n=URI(t.origin),r=t.data,i,s;try{s=SC.typeOf(r)!==SC.T_STRING?r:SC.json.decode(r)}catch(o){return SC.warn(o),arguments.callee.base.apply(this,arguments)}if(!s)return arguments.callee.base.apply(this,arguments);if((s.cvws||s.isWebmsResponse)&&CoreMail.store){i=CoreMail.getServerPreferences().get("~whitelistedDownloadDomains");if(n.protocol()!=="https"||!i||!i.contains("."+n.domain())){SC.warn("postMessage coming from untrusted domain");return}var u=s.status,a,f={};if(u){switch(u){case 403:case 410:a="Download.MailDrop.Attachment.Expired";break;case 404:a="Download.MailDrop.Attachment.Not.Found";break;case 429:a="Download.MailDrop.Attachment.Download.Limit.Exceeded",f.extraWide=YES;break;case 507:a="MessageView.Download.SizeQuotaExceeded",f.messageLocParams={fileName:s.fileName},CoreMail.errorHandler.recordStat("_STAT_IMAP_DOWNLOAD_SIZEQUOTAEXCEEDED_ERROR",{description:"Size quota exceeded error while trying to download an oversized IMAP attachment"});break;default:a="Download.MailDrop.Server.Error"}f.keyString=a,CoreMail.errorHandler.handleError(f)}}else s.jsonrpc==="2.0"&&window.Compose&&window
.MailMessage&&(SC.debug("Global.postmessagehandler: Received "+SC.json.encode(s)),s.id===CoreMail.COMPOSE_ADD_PARTICIPANTS_JSON_RPC_ID?Compose.dispatch({sig:"addParticipantsCompleted",response:s}):s.id===CoreMail.COMPOSE_POPULATE_FIELDS_JSON_RPC_ID&&s.result&&MailMessage.populateFields(s.result));var l=SC.json.encode(s);return l.length>1e3&&(l=l.substr(0,1e3)+"…"),SC.debug("Global.PostMessageHandlerMixin._messageWasReceived: message = "+l),arguments.callee.base.apply(this,arguments)}},Global.RTLMixin={renderRTLAttr:function(e){var t=this.get("value");return t&&Global.isRTLText(t)?e.attr("dir","rtl"):e.attr("dir",null),e}};var Print={};Print.generic="url(%@)".fmt("/applications/mail/1808Project39/frameworks/core_mail/mail_theme/1808Project39/en-us/source/attachments/images/icons/attachment_icon_generic.png"),Print.attachmentIcon="url(%@)".fmt("/applications/mail/1808Project39/frameworks/core_mail/mail_theme/1808Project39/en-us/source/view_message/images/attachments/mail_message_attachment.png"),Print.MESSAGE_HEAD='<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html>  <title>'+"_Print.PageTitle".loc()+'</title>  <head>    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />    <style type="text/css" media="print,screen">      @font-face {        font-family: \'SFNSText\';        src: local(".SFNSText-Light"),            url(\'/fonts/SFNSText-Light.woff\') format(\'woff\');        font-weight: 300;      }      @font-face {        font-family: \'SFNSText\';        src: local(".SFNSText-Medium"),           url(\'/fonts/SFNSText-Medium.woff\') format(\'woff\');        font-weight: 500;      }      body {        background:#FFFFFF ;        padding: 10px;        font: 15px \'SFNSText\',\'Helvetica Neue\',Helvetica,sans-serif;        font-weight:300;        margin: 0px;        overflow:auto;      }      .sc-web-view, .header-view-text-button {        display:none      }      blockquote[type=cite].quoted-plain-text{        line-height:1.5;        padding-bottom: 0px;      }      blockquote[type=cite] {        border-left: 2px solid #003399;        margin:0;        padding: 0 12px 0 12px;        color: #003399;      }      blockquote[type=cite] blockquote[type=cite] {        border-left: 2px solid #006600;        margin:0;        padding: 0 12px 0 12px;        color: #006600      }      blockquote[type=cite] blockquote[type=cite] blockquote[type=cite] {        border-left : 2px solid #660000;        margin:0;        padding: 0 12px 0 12px;        color: #660000      }      p {        margin: 0;        padding: 0;      }      img._stretch {        max-width: 765px;        padding-top:7px;        padding-right:28px;      }      pre {        white-space: pre-wrap;        white-space: -moz-pre-wrap;        white-space: -pre-wrap;        white-space: -o-pre-wrap;        word-wrap: break-word;        white-space: pre-wrap !important;        word-wrap: normal !important;      }      a {        text-decoration:none;        background:#FFFFFF;      }      .sc-static-layout {        position:relative;      }      .sc-collection-item {        line-height:1.2;        overflow:auto;      }      .sc-view.static-header-view-expanded, .sc-view.static-header-view-collapsed {        padding-top:5px;        overflow:hidden;      }      .sc-view.static-header-view-collapsed .header-view-field-value {        top:0px !important      }      .sc-stacked-view .sc-collection-item:after{        content:",";        padding-right:5px;      }      .sc-stacked-view :last-child::after{        content:"";      }      .sc-view {        margin:0;        overflow:auto;      }      .recipient-names {        color: #0a8de9;      }      .header-view-date-field {        color:#888888;        margin-top:-2px;      }      .header-view-info-date {        line-height:19px;      }      .sc-view.header-view-compact-info {        color: #999999;        display:table-cell;        padding-right: 5px;      }      .sc-view.header-view-compact-info.to-recipients {        left: 5px;      }      .header-view-field{        padding-bottom:8px;      }      .header-view-field div.sc-label-view {        display: inline-block;      }      .header-view-subject{        font-size: 27px;        color: #000;        font-weight: 500;        margin-bottom:5px;      }      .header-view-field-value {        display: table-cell;        overflow: visible;      }      .disclosure-header-names {        color: #000000;        position:relative;        display: inline-block;      }      .body-separator {        border-top: 1px solid #e9e9e9;        padding-bottom:1px;        margin:0px 1px 3px 10px;        padding:6px;      }      .sc-hidden {        display: none !important;      }      .long-header-background {        background:#F2F2F2 none repeat scroll 0 0;        border:1px none #DADADA;        margin-right:0px;        line-height:1.2;        overflow:hidden;        margin-left:10px;        margin-top:11px;      }      .long-header-link{         display:none;       }       .long-header-font  {       }      .message .border {        border-top:1px solid #E9E9E9;        margin-top:15px;        margin-left:-20px;      }      .attachments img {        height: 14px;        vertical-align: middle;        border:medium none;      }      .attachments a {        height:20px;        color:#0a8de9;        margin-left:3px;      }      .attachments {        padding-right:12px;        overflow:hidden;      }      .attachments:before {        content:'+
Print.attachmentIcon+";        position:absolute;        top:4px;        left:1px;      }      .attachment-icon img {        width: 16px;        height: 16px;      }      .attachment-icon {        white-space: nowrap;        display: inline-block;        margin-left: 2px;      }      .attachment-icon:before {        content: "+Print.generic+';        position: absolute;        margin-left: -16px;      }      .msie .attachment-icon:before, .msedge .attachment-icon:before {        margin-left: 0px;      }      .long-header-data {        overflow:visible;      }      .header-long {        color:#666666;        font-size:11px;        max-width:600px;      }      .header-long.key {        white-space:nowrap;      }   </style>  </head>  <body id="message-print-view" class="sc-view message view">  <script language="javascript">    window.onload = function(){      var iframe = window.frameElement;      if (iframe) {        var isEdge = iframe.isEdge,          body = document.body;        if (body) {          if (iframe.isIE) {            body.className = body.className + " msie";          }          if (isEdge) {            body.className = body.className + " msedge";            document.execCommand("print", false, null);            return;          }        }      }      window.print();    };  </script>',Print.BODY_STYLE="<div class=body-separator sc-static-layout>",Print.BODY_DIV='<div style = "position:relative;                          padding-left:10px;margin-right:42px;                          margin-bottom:12px;">',Print.BODY_STYLE_END="</div>",Print.MESSAGE_TAIL="</body></html>"
,Global.page=SC.Page.extend({}),Global.ToolbarButtonMixin={render:function(e,t){var n=this.get("toolTip");SC.typeOf(n)===SC.T_STRING&&(this.get("localize")&&(n=n.loc()),e.attr("title",n),e.attr("alt",n)),this.renderIcon(e)},renderIcon:function(e){var t=this.get("icon"),n="",r,i,s=SC.BLANK_IMAGE_URL;return n='<img src="'+s+'" class="'+t+'" />',e.push(n),e}},window.MessageList=SC.Object.create({splitterPosition:0,selectionGuid:null,searchField:null,isSearchPaneVisible:NO,previousPosition:0,folderController:null,guid:"",guidBinding:SC.Binding.transform(function(e){return e&&e.firstObject()?e.firstObject().get("guid"):""}).from(".folderController.content"),sortMenuController:null,isResyncMessageListInProgressDidChange:function(){YES===CoreMail.get("isResyncMessageListInProgress")&&this.dispatch({sig:"resync"})}.observes("CoreMail.isResyncMessageListInProgress"),initial:"Message List not visible","Message List not visible":function(e){switch(e.sig){case"show":Mail.loadVipSenderModule(),this.page.get("messageListContainerView").showSubViews(YES);if(this.get("content"))return this[this.stateKey]="3 Message List Visible",CK.Statechart.EVT_TRANSITION_RES;return this[this.stateKey]="3.0 Waiting for Content",CK.Statechart.EVT_TRANSITION_RES}}.state(),"3.0 Waiting for Content":function(e){var t=FolderList.selectedFolderGuid(),n,r;switch(e.sig){case"enter":CoreMail.set("canResyncMessageList",NO);if(this._didResetSearchField===YES)return this._didResetSearchField=NO,CK.Statechart.handled();return this._showMessageList(this.page.getPath("loadingView"),this._messageList),CoreMail.Request.cancelUnfinishedRequests
(CoreMail.Request.MSGLIST),this.page.setPath("messageListContainerView.loading.isVisible",NO),n=FolderList.getSelectedFolder(),n?r=n.get("filterCriteria"):SC.warn('MessageList."3.0 Waiting for Content": FolderList does not have a selection. selectedFolder('+n+"), filterCriteria("+r+"), folderGuid("+t+")"),this._messageListRequest=CoreMail.loadMessageList(t,this.selectionGuid,this.searchField,Message.searchController.get("searchFieldValue"),r),this._messageListRequestObserver=this._messageListRequest.addStatechartObserver("state",this),this._messageListRequest.get("state")!==this._messageListRequest.STATE_PENDING&&this.invokeLast(function(){this.dispatch({sig:"propertyChanged",key:"state",target:this._messageListRequest})}),CK.Statechart.handled();case"exit":return CK.Statechart.handled();case"show":return this._messageListRequest.removeStatechartObserver("state",this,this._messageListRequestObserver),this._messageListRequestObserver=null,this[this.stateKey]="3.0 Waiting for Content",CK.Statechart.EVT_TRANSITION_RES;case"filterCriteriaChanged":return this[this.stateKey]="3.0 Waiting for Content",CK.Statechart.EVT_TRANSITION_RES;case"propertyChanged":if(e.target===this._messageListRequest&&e.key==="state")switch(this._messageListRequest.get("state")){case this._messageListRequest.STATE_SUCCESS:var i=NO;Global.get("isAppReady")===NO&&(Global.set("isAppReady",YES),i=YES,CloudOS.startupDataIsLoaded&&CloudOS.startupDataIsLoaded(),SC.Benchmark.end(CoreMail.BENCH_MAIL_STARTUP),Mail.loadPushService(),this._setMessageListOrientationOnLoad()),CoreMail.setMessageList(t,this._messageListRequest
.get("requestData").messageArray),(i===YES||YES===FolderList.get("isFolderChangedByMouse"))&&this.invokeLast(this.takeFirstResponder);var s=CoreMail.findLocalFolder(t);return s&&s.get("role")===CoreMail.FOLDER_ROLE_VIP&&i===NO&&CoreMail.folderDataSource.getVipBadges(CoreMail.store,t),SC.Benchmark.end("perfLoadMessages"),this[this.stateKey]="3 Message List Visible",CK.Statechart.EVT_TRANSITION_RES;case this._messageListRequest.STATE_ERROR:if(Global.get("isAppReady")===NO)CoreMail.errorHandler.handleBootstrapError("Messagelist.LoadFailed.ServerError");else{n=FolderList.foldersTreeController.getPath("selection.firstObject");var o=n.get("displayName"),u=n.get("guid"),a;n.get("role")===CoreMail.FOLDER_ROLE_VIP?a="VipSender.MessageList.LoadFailed.ServerError":a="Messagelist.LoadFailed.ServerError",SC.empty(u)||CoreMail.errorHandler.handleError({keyString:"Messagelist.LoadFailed.ServerError",messageLocParams:{selectedFolder:o}})}return this[this.stateKey]="3.1 Empty Message View",CK.Statechart.EVT_TRANSITION_RES}return CK.Statechart.handled()}}.state(),"3 Message List Visible":function(e){var t=Message.messageListController,n=t.get("selection");switch(e.sig){case"enter":CoreMail.set("canResyncMessageList",YES),this._selectionObserver=t.addStatechartObserver("selection",this),this._contentObserver=t.addStatechartObserver("length",this);var r=this.get("pushMessageGuid");return r&&(this.scrollToMessage(r),this.set("pushMessageGuid",null)),CK.Statechart.handled();case"exit":return CoreMail.set("canResyncMessageList",NO),t=Message.messageListController,t.removeStatechartObserver("selection"
,this,this._selectionObserver),t.removeStatechartObserver("length",this,this._contentObserver),this._selectionObserver=null,this._contentObserver=null,CK.Statechart.handled();case"show":return this._show(n),t.get("isRefreshViewVisible")===YES&&this.removeRefreshView(),this[this.stateKey]="3.0 Waiting for Content",CK.Statechart.EVT_TRANSITION_RES;case"resync":return this._historyState="3 Message List Visible",this[this.stateKey]="3.3 Resyncing",CK.Statechart.EVT_TRANSITION_RES;case"showSearch":return SC.Benchmark.start("perfLoadMessages"),this._showSearch(e.searchTextValue,n),Message.messageListController.set("selection",null),this[this.stateKey]="3.0 Waiting for Content",CK.Statechart.EVT_TRANSITION_RES;case"filterCriteriaChanged":return SC.Benchmark.start("perfLoadMessages"),this[this.stateKey]="3.0 Waiting for Content",CK.Statechart.EVT_TRANSITION_RES;case"propertyChanged":if(e.target===t&&e.key==="length")return Message.getPath("messageListController.content.length")===0?(this[this.stateKey]="3.1 Empty Message View",CK.Statechart.EVT_TRANSITION_RES):(this[this.stateKey]="3.2 With Message Items",CK.Statechart.EVT_TRANSITION_RES);return CK.Statechart.handled();case"defaultTransition":return Message.getPath("messageListController.content.length")===0?(this[this.stateKey]="3.1 Empty Message View",CK.Statechart.EVT_TRANSITION_RES):(this[this.stateKey]="3.2 With Message Items",CK.Statechart.EVT_TRANSITION_RES);case"sortBySize":return this._wasShowTriggeredBySort=YES,CoreMail.saveImplicitPreference("messageSortBy",CoreMail.SORT_BY_SIZE),this.invokeLast(function(){this.dispatch({
sig:"show"})}),CK.Statechart.handled();case"sortByDate":return this._wasShowTriggeredBySort=YES,CoreMail.saveImplicitPreference("messageSortBy",CoreMail.SORT_BY_DATE),this.invokeLast(function(){this.dispatch({sig:"show"})}),CK.Statechart.handled();case"sortByFrom":return this._wasShowTriggeredBySort=YES,CoreMail.saveImplicitPreference("messageSortBy",CoreMail.SORT_BY_FROM),this.invokeLast(function(){this.dispatch({sig:"show"})}),CK.Statechart.handled();case"sortByTo":return this._wasShowTriggeredBySort=YES,CoreMail.saveImplicitPreference("messageSortBy",CoreMail.SORT_BY_TO),this.invokeLast(function(){this.dispatch({sig:"show"})}),CK.Statechart.handled();case"sortByFlag":return this._wasShowTriggeredBySort=YES,CoreMail.saveImplicitPreference("messageSortBy",CoreMail.SORT_BY_FLAG),this.invokeLast(function(){this.dispatch({sig:"show"})}),CK.Statechart.handled();case"sortByUnread":return this._wasShowTriggeredBySort=YES,CoreMail.saveImplicitPreference("messageSortBy",CoreMail.SORT_BY_UNREAD),this.invokeLast(function(){this.dispatch({sig:"show"})}),CK.Statechart.handled();case"sortBySubject":return this._wasShowTriggeredBySort=YES,CoreMail.saveImplicitPreference("messageSortBy",CoreMail.SORT_BY_SUBJECT),this.invokeLast(function(){this.dispatch({sig:"show"})}),CK.Statechart.handled();case"sortAscending":return this._wasShowTriggeredBySort=YES,CoreMail.saveImplicitPreference("messageSortAscending",YES),this.invokeLast(function(){this.dispatch({sig:"show"})}),CK.Statechart.handled();case"sortDescending":return this._wasShowTriggeredBySort=YES,CoreMail.saveImplicitPreference("messageSortAscending"
,NO),this.invokeLast(function(){this.dispatch({sig:"show"})}),CK.Statechart.handled()}}.state(),"3.1 Empty Message View":function(e){switch(e.sig){case"enter":return this._showMessageList(this.page.get("messageList"),this._messageList),CK.Statechart.handled();case"exit":return CK.Statechart.handled()}}.state("3 Message List Visible"),"3.2 With Message Items":function(e){var t;switch(e.sig){case"enter":return this._showMessageList(this.page.getPath("messageList"),this._messageList),this.invokeLast(function(){this.get("shouldSelectCloudOSPushNotifiedMessage")||this.set("shouldSelectCloudOSPushNotifiedMessage",YES)}),this.invokeLast(this.resetScrollViewPosition),CK.Statechart.handled();case"markAsReadOrUnread":var n=e.content;if(!n)return CK.Statechart.handled();var r=n.get("unread");return CoreMail.setMessageFlag(CoreMail.MESSAGE_FLAG_UNREAD,!r,n,Message.messageListController.get("arrangedObjects")),CK.Statechart.handled();case"openRelatedMessage":var i=e.relatedMessageContent;if(i){var s=i.get("relatedGUID");Global.openMessage(CoreMail.MESSAGE_MODE_VIEW,s,undefined,YES)}return CK.Statechart.handled();case"exit":return CK.Statechart.handled();case"propertyChanged":if(e.target===this._messageListRequest&&e.key==="state"){t=this._messageListRequest.get("state");switch(t){case this._messageListRequest.STATE_SUCCESS:this.page.setPath("messageListContainerView.loading.isVisible",NO);break;case this._messageListRequest.STATE_ERROR:return this.page.setPath("messageListContainerView.loading.isVisible",NO),this[this.stateKey]="3.0 Waiting for Content",CK.Statechart.EVT_TRANSITION_RES;case this
._messageListRequest.STATE_PENDING:this.page.setPath("messageListContainerView.loading.isVisible",YES)}}if(e.target===Message.messageListController)return Message.getPath("messageListController.length")===0?(this[this.stateKey]="3.1 Empty Message View",CK.Statechart.EVT_TRANSITION_RES):Message.getPath("messageListController.selection.length")>=1?(this[this.stateKey]="3.2.2 Selected Messages",CK.Statechart.EVT_TRANSITION_RES):(this[this.stateKey]="3.2.1 No Messages Selected",CK.Statechart.EVT_TRANSITION_RES);return CK.Statechart.handled();case"defaultTransition":return Message.getPath("messageListController.selection.length")>=1?(t=this._messageListRequest.get("state"),t!==this._messageListRequest.STATE_PENDING&&this.page.setPath("messageListContainerView.loading.isVisible",NO),this[this.stateKey]="3.2.2 Selected Messages",CK.Statechart.EVT_TRANSITION_RES):(this[this.stateKey]="3.2.1 No Messages Selected",CK.Statechart.EVT_TRANSITION_RES)}}.state("3 Message List Visible"),"3.2.1 No Messages Selected":function(e){switch(e.sig){case"enter":return CK.Statechart.handled();case"exit":return CK.Statechart.handled()}}.state("3.2 With Message Items"),"3.2.2 Selected Messages":function(e){switch(e.sig){case"enter":return CK.Statechart.handled();case"exit":return CK.Statechart.handled();case"defaultTransition":return Message.getPath("messageListController.selection.length")===1?(this[this.stateKey]="3.2.2.1 One Message Selected",CK.Statechart.EVT_TRANSITION_RES):(this[this.stateKey]="3.2.2.2 Multiple Messages Selected",CK.Statechart.EVT_TRANSITION_RES);case"backspace":case"delete":case"deleteMessages"
:return this[this.stateKey]="3.2.2.3 Waiting For Deletion Confirmation",CK.Statechart.EVT_TRANSITION_RES;case"archiveMessages":return this[this.stateKey]="3.2.2.4 Waiting For Archiving Confirmation",CK.Statechart.EVT_TRANSITION_RES;case"markAsReadUnread":var t=Message.messageListController,n=t.get("isUnread"),r=!n;return Message.setMessageFlag(CoreMail.MESSAGE_FLAG_UNREAD,r),CK.Statechart.handled();case"markAsFlaggedUnflagged":t=Message.messageListController;var i=t.get("isFlagged"),s=!i;return Message.setMessageFlag(CoreMail.MESSAGE_FLAGGED,s),CK.Statechart.handled();case"markAsJunkNotJunk":t=Message.messageListController;if(t.get("isJunkingEnabled")){var o=t.get("isJunk");1===t.getPath("selection.length")?ViewMessage.dispatch({sig:"setJunk"}):Message.setMessageFlag(CoreMail.MESSAGE_FLAG_JUNK,!o)}return CK.Statechart.handled()}}.state("3.2 With Message Items"),"3.2.2.1 One Message Selected":function(e){switch(e.sig){case"enter":return CK.Statechart.handled();case"exit":return this._3H="3.2.2.1 One Message Selected",CK.Statechart.handled();case"ctrl_shift_f":return Message.getPath("messageListController.selection.length")===1&&Global.openMessage(CoreMail.MESSAGE_MODE_FORWARD,this._guidOfSelectedMessage()),CK.Statechart.handled();case"ctrl_p":return Message.getPath("messageListController.selection.length")===1&&Global.printSelectedMessage(),CK.Statechart.handled();case"return":case"messageListItemDoubleClick":var t=this._guidOfSelectedMessage(),n=Message.messageListController.get("selection").toArray();if(n){var r=n[0];if(r&&r.get("status")===SC.Record.READY_CLEAN){var i=r.get
("folder");i&&(i.get("role")===CoreMail.FOLDER_ROLE_DRAFTS?Global.openMessage(CoreMail.MESSAGE_MODE_COMPOSE,t):(CoreMail.incrementUserStat(CoreMail.STAT_VIEW_MSG_WINDOW),Global.openMessage(CoreMail.MESSAGE_MODE_VIEW,t)))}else SC.debug("3.2.2.1 One Message Selected: messageListItemDoubleClick action ignored as the record is not in READY_CLEAN state")}else{var s='MessageList."3.2.2.1 One Message Selected": selection is null';CoreMail.errorHandler.logErrorTrap(s)}return CK.Statechart.handled()}}.state("3.2.2 Selected Messages"),"3.2.2.2 Multiple Messages Selected":function(e){switch(e.sig){case"enter":return CK.Statechart.handled();case"exit":return this._3H="3.2.2.2 Multiple Messages Selected",CK.Statechart.handled();case"return":case"messageListItemDoubleClick":var t=Message.messageListController.getPath("selection.length"),n=this;return t>this.MAX_MESSAGES_TO_OPEN_BEFORE_WARNING?(CoreMail.errorHandler.handleError({keyString:"MessageList.ConfirmOpenMessages",messageLocParams:{selMesgsLen:t},rightButton:{title:"_Common.Button.Open".loc(),action:function(){this.target.remove(),n.openMultipleMessages()}},leftButton:"_Common.Button.Cancel".loc()}),CK.Statechart.handled()):(this.openMultipleMessages(),CK.Statechart.handled())}}.state("3.2.2 Selected Messages"),"3.2.2.3 Waiting For Deletion Confirmation":function(e){var t=Message.messageListController,n=t.get("selection"),r=t.get("arrangedObjects");switch(e.sig){case"defaultTransition":try{this._requestStatus=CoreMail.deleteMessage(n,r),this._deleteResponseObserver=this._requestStatus.addStatechartObserver("state",this),this._setDeleteStyling
()}catch(i){var s="MessageList.'3.2.2.3 Waiting For Deletion Confirmation state': Exception in transition to state with evt.sig 'defaultTransition'";s+="\nException "+i,CoreMail.errorHandler.logErrorTrap(s)}return CK.Statechart.handled();case"exit":return this._requestStatus.removeStatechartObserver("state",this,this._deleteResponseObserver),this._deleteResponseObserver=null,CK.Statechart.handled();case"propertyChanged":this._fixLoadingUI(e);var o=this._requestStatus;if(e.target===o&&e.key==="state")switch(o.get("state")){case o.STATE_SUCCESS:if(t.getPath("content.length")>0)return this[this.stateKey]="3.2.2.1 One Message Selected",CK.Statechart.EVT_TRANSITION_RES;return this[this.stateKey]="3.1 Empty Message View",CK.Statechart.EVT_TRANSITION_RES;case o.STATE_ERROR:return t.getPath("selection.length")>1?CoreMail.errorHandler.handleError({keyString:"MessageList.UnableToDeleteMessages.ServerError"}):CoreMail.errorHandler.handleError({keyString:"MessageList.UnableToDeleteMessage.ServerError"}),this._removeDeleteStyling(),this[this.stateKey]="3.2.2 Selected Messages",CK.Statechart.EVT_TRANSITION_RES}if(e.key==="length")return t.getPath("content.length")>0?(this[this.stateKey]="3.2.2.1 One Message Selected",CK.Statechart.EVT_TRANSITION_RES):(this[this.stateKey]="3.1 Empty Message View",CK.Statechart.EVT_TRANSITION_RES);return CK.Statechart.handled()}}.state(),"3.2.2.4 Waiting For Archiving Confirmation":function(e){var t=Message.messageListController,n=t.get("selection"),r=t.get("arrangedObjects");switch(e.sig){case"defaultTransition":this._requestStatus=CoreMail.archiveMessage(
n,r);var i=this._requestStatus;return this._archiveResponseObserver=i.addStatechartObserver("state",this),i.get("state")!==i.STATE_PENDING&&this.invokeLater(function(){this.dispatch({sig:"propertyChanged"})}),CK.Statechart.handled();case"exit":return this._requestStatus.removeStatechartObserver("state",this,this._archiveResponseObserver),this._archiveResponseObserver=null,CK.Statechart.handled();case"propertyChanged":this._fixLoadingUI(e);var s=this._requestStatus;switch(s.get("state")){case s.STATE_SUCCESS:if(t.getPath("content.length")>0)return this[this.stateKey]="3.2.2.1 One Message Selected",CK.Statechart.EVT_TRANSITION_RES;return this[this.stateKey]="3.1 Empty Message View",CK.Statechart.EVT_TRANSITION_RES;case s.STATE_ERROR:return CoreMail.errorHandler.handleError({keyString:"MessageList.UnableToArchiveMessages.ServerError"}),this[this.stateKey]="3.2.2 Selected Messages",CK.Statechart.EVT_TRANSITION_RES}return CK.Statechart.handled()}}.state(),"3.2.3 Drag Session":function(e){switch(e.sig){case"enter":return CK.Statechart.handled();case"exit":return CK.Statechart.handled()}}.state("3.2 With Message Items"),"3.3 Resyncing":function(e){var t=FolderList.selectedFolderGuid(),n=FolderList.getSelectedFolder().get("filterCriteria");switch(e.sig){case"enter":var r=Message.searchController.get("searchFieldValue");return this._messageListRequest=CoreMail.loadMessageList(t,this.selectionGuid,this.searchField,r,n),this._messageListRequestObserver=this._messageListRequest.addStatechartObserver("state",this),CK.Statechart.handled();case"exit":return CoreMail.set("isResyncMessageListInProgress"
,NO),CK.Statechart.handled();case"show":return this._messageListRequest.removeStatechartObserver("state",this,this._messageListRequestObserver),this._messageListRequestObserver=null,Message.messageListController.get("isRefreshViewVisible")===YES&&this.removeRefreshView(),this[this.stateKey]="3.0 Waiting for Content",CK.Statechart.EVT_TRANSITION_RES;case"propertyChanged":var i=this._messageListRequest;if(e.target===i&&e.key==="state")switch(i.get("state")){case i.STATE_SUCCESS:return CoreMail.setMessageList(t,i.get("requestData").messageArray),this[this.stateKey]=this._historyState,CK.Statechart.EVT_TRANSITION_RES;case i.STATE_ERROR:var s=FolderList.foldersTreeController.getPath("selection.firstObject.displayName");return CoreMail.errorHandler.handleError({keyString:"Messagelist.LoadFailed.ServerError",messageLocParams:{selectedFolder:s}}),this[this.stateKey]="3.1 Empty Message View",CK.Statechart.EVT_TRANSITION_RES;default:}return CK.Statechart.handled()}}.state(),show:function(){},headerMouseClick:function(){},messageListItemDoubleClick:function(){},threePane:function(){},twoColumn:function(){},threeColumn:function(){},sortByDate:function(){},sortByFrom:function(){},sortByTo:function(){},sortBySubject:function(){},sortByFlag:function(){},sortByUnread:function(){},sortAscending:function(){},sortDescending:function(){},sortBySize:function(){}}),MessageList.FiltersMenuController=SC.ObjectController.extend({folderRecord:null,folderRecordBinding:SC.Binding.oneWay("FolderList.folderController.folderRecord"),unread:function(e,t){return this._getOrSetCriteria("unread",t)}.property("folderRecord"
),flagged:function(e,t){return this._getOrSetCriteria("flagged",t)}.property("folderRecord"),toMe:function(e,t){return this._getOrSetCriteria("toMe",t)}.property("folderRecord"),ccMe:function(e,t){return this._getOrSetCriteria("ccMe",t)}.property("folderRecord"),withAttachments:function(e,t){return this._getOrSetCriteria("withAttachments",t)}.property("folderRecord"),fromVip:function(e,t){return this._getOrSetCriteria("fromVip",t)}.property("folderRecord"),enabled:function(e,t){if(t===YES){var n=this.getPath("folderRecord.filterCriteria"),r=!(n.get("unread")||n.get("flagged")||n.get("toMe")||n.get("ccMe")||n.get("withAttachments")||n.get("fromVip"));r&&this.set("unread",YES)}return this._getOrSetCriteria("enabled",t)}.property("folderRecord"),_getOrSetCriteria:function(e,t){if(t!==undefined){SC.debug("FilterMenuController: Set "+e+" to "+t);var n={};return n[e]=t,this.setPath("folderRecord.filterCriteria",n),t}return t=this.getPath("folderRecord.filterCriteria."+e),!!t},filtersPopupMenuButtonTitle:function(){var e="";return this.get("unread")&&(e="_MessageList.Footer.Filters.Button.Title.Unread".loc()),this.get("flagged")&&(e=this._addSeparatorIfNeeded(e),e+="_MessageList.Footer.Filters.Button.Title.Flagged".loc()),this.get("toMe")&&(e=this._addSeparatorIfNeeded(e),e+="_MessageList.Footer.Filters.Button.Title.ToMe".loc()),this.get("ccMe")&&(e=this._addSeparatorIfNeeded(e),e+="_MessageList.Footer.Filters.Button.Title.CcMe".loc()),this.get("withAttachments")&&(e=this._addSeparatorIfNeeded(e),e+="_MessageList.Footer.Filters.Button.Title.WithAttachments".loc()),this.get("fromVip"
)&&(e=this._addSeparatorIfNeeded(e),e+="_MessageList.Footer.Filters.Button.Title.FromVip".loc()),e||(e="_MessageList.Footer.Filters.Button.Title.None".loc()),e}.property("unread","flagged","toMe","ccMe","withAttachments","fromVip","enabled").cacheable(),_addSeparatorIfNeeded:function(e){return e&&(e+="_MessageList.Footer.Filters.Button.Title.Separator".loc()),e}}),MessageList.SortMenuController=SC.ObjectController.extend({sortField:null,sortFieldBinding:"CoreMail.implicitPreferences.messageSortBy",sortMenuTitle:function(){return"_MessageList.ColumnHeader.SortMenu".loc({field:this.get("localizedSortField")})}.property("localizedSortField").cacheable(),localizedSortField:function(){var e=this.get("sortField"),t;switch(e){case CoreMail.SORT_BY_DATE:t="_MessageList.ColumnHeader.Sort.Date".loc();break;case CoreMail.SORT_BY_FROM:t="_MessageList.ColumnHeader.Sort.From".loc();break;case CoreMail.SORT_BY_TO:t="_MessageList.ColumnHeader.Sort.To".loc();break;case CoreMail.SORT_BY_SUBJECT:t="_MessageList.ColumnHeader.Sort.Subject".loc();break;case CoreMail.SORT_BY_UNREAD:t="_MessageList.ColumnHeader.Sort.Unread".loc();break;case CoreMail.SORT_BY_FLAG:t="_MessageList.ColumnHeader.Sort.Flagged".loc();break;case CoreMail.SORT_BY_SIZE:t="_MessageList.ColumnHeader.Sort.Size".loc()}return t}.property("sortField").cacheable(),folderRoleDidChange:function(){var e=FolderList.selectedFolderRole(),t=this.get("sortField");if(t!==CoreMail.SORT_BY_FROM||e!==CoreMail.FOLDER_ROLE_SENT&&e!==CoreMail.FOLDER_ROLE_DRAFTS){if(t!==CoreMail.SORT_BY_TO||e===CoreMail.FOLDER_ROLE_SENT||e===CoreMail.FOLDER_ROLE_DRAFTS
)return;t=CoreMail.SORT_BY_FROM}else t=CoreMail.SORT_BY_TO;this.set("sortField",t)}.observes("FolderList.folderController.role")}),SC.mixin(MessageList,{resetScrollViewPosition:function(){var e=Message.messageListController.get("selection");(!e||e.get("length")<1)&&this.page.getPath("messageList.contentList").scrollTo(0,0)},takeFirstResponder:function(e){var t;t=MessageList.page.getPath("messageList.contentList.contentView");if(!t)return;(YES===e||!(t.getPath("pane.firstResponder")instanceof FolderList.SourceInlineTextFieldView))&&t.becomeFirstResponder(),FolderList.set("isFolderChangedByMouse",NO)},removeRefreshView:function(){var e=this.page.get("messageList"),t=Message.messageListController,n=e.$();t.set("isRefreshViewVisible",NO),n.removeClass("has-refresh-spinner"),e.stopAnimation(),e.contentList.set("isReverseAnimationInProgress",NO),e.adjust("top",MessageList.metrics.DEFAULT_TOP)}}),SC.mixin(MessageList,{SORT_DESC:"sort-desc",SORT_ASC:"sort-asc",MAX_MESSAGES_TO_OPEN_BEFORE_WARNING:10,ORIENTATION_THREE_COL:"3Column",ORIENTATION_TWO_COL:"2Column",MIN_WHEEL_DELTA:5,WHEEL_DELTA_BUFFER:20,REFRESH_SPINNER_ANIMATION_DURATION:200,MIN_THRESHOLD_TO_REVERSE_ANIMATE:1500,pushMessageGuid:null,shouldSelectCloudOSPushNotifiedMessage:null,configure:function(e,t){this.filtersMenuController=this.FiltersMenuController.create();var n=this.page.get("messageListContainerView"),r=this.page.get("searchPaneView"),i=e.get("parentView");if(!i)throw"bad API call; view does not have a parent view";i.replaceChild(n,e),i=t.get("parentView"),i.replaceChild(r,t),n.showSubViews(NO),this.set("serverPreferences"
,CoreMail.getServerPreferences()),this.set("sortMenuController",MessageList.SortMenuController.create()),this._lastSortOrder=this.SORT_DESC},deleteSelectedMessages:function(){this.dispatch({sig:"deleteMessages"})},archiveSelectedMessages:function(){this.dispatch({sig:"archiveMessages"})},flagSelectedMessages:function(){this.dispatch({sig:"markAsFlaggedUnflagged"})},switchToTwoColumnView:function(){var e=MessageList.get("viewPreference"),t=MessageList.get("splitterPosition");this._saveSplitterPosition(e,t),CoreMail.saveImplicitPreference("view",this.ORIENTATION_TWO_COL),Mail.mainSplitController.hideFolderList(YES),MessageList.set("viewPreference",MessageList.ORIENTATION_TWO_COL),this.page.setPath("messageList.contentList.contentView.viewOrientation",MessageList.ORIENTATION_TWO_COL)},switchToThreeColumnView:function(){var e=MessageList.get("viewPreference"),t=MessageList.get("splitterPosition");this._saveSplitterPosition(e,t),CoreMail.saveImplicitPreference("view",this.ORIENTATION_THREE_COL),Mail.mainSplitController.showFolderList(YES),MessageList.set("viewPreference",MessageList.ORIENTATION_THREE_COL),this.page.setPath("messageList.contentList.contentView.viewOrientation",MessageList.ORIENTATION_THREE_COL)},setCurrentDragView:function(e){this._dragView=e},signalInvalidDropTarget:function(){this._dragView&&this._dragView.setInvalidDrop(YES)},signalValidDropTarget:function(){this._dragView&&this._dragView.setInvalidDrop(NO)},nowShowingMessages:function(){var e,t=[],n=MessageList.page.getPath("messageList.contentList.contentView");return n&&(e=n.get("nowShowing"),e.set("source",
Message.messageListController),e.forEachObject(function(e){t.push(e)})),t},notifyAccountLabelColorChange:function(){this.nowShowingMessages().forEach(function(e){e.notifyPropertyChange("account")})},openMultipleMessages:function(){var e=Message.messageListController.get("selection").toArray(),t=e.get("length"),n,r;for(var i=0;i<t;i++)n=e[i]?e[i].get("guid"):null,r=e[i]?e[i].getPath("folder.role"):null,n!==null&&(r===CoreMail.FOLDER_ROLE_DRAFTS?Global.openMessage(CoreMail.MESSAGE_MODE_COMPOSE,n):Global.openMessage(CoreMail.MESSAGE_MODE_VIEW,n))},forceResyncMessageList:function(){var e=MessageList.getPath("page.folderDropDownView"),t=e.getPath("menu.selectedItem.value"),n=e.get("lastSelectedFolderGuid");t===n&&this.dispatch({sig:"resync"})},scrollToMessage:function(e){if(!e){SC.debug("MessageList.showMessage: messageGuid is null");return}var t=FolderList.selectedFolderGuid(),n=CoreMail.messageListDataSource.storeKeyArray(t);if(!n){SC.warn("MessageList.showMessage: storeKeyArray not found for "+t);return}var r=CoreMail.store.find(CoreMail.Message,e);if(!r){SC.warn("MessageList.showMessage: message "+e+" not found");return}if(r.get("status")!==SC.Record.READY_CLEAN){SC.warn("MessageList.showMessage: "+e+" record is not READY_CLEAN.");return}var i=n.indexOf(r.get("storeKey"));if(i<0){SC.warn("MessageList.showMessage: message "+e+" not found in storeKeyArray of folder "+t);return}if(i>=Message.getPath("messageListController.length")){SC.debug("MessageList.showMessage: index "+i+" out of range");return}var s=MessageList.page.getPath("messageList.contentList"),o=s.get("contentView")
,u=o.itemViewForContentIndex(i);if(u){SC.debug("Message exists in sparse array at index "+i+". Scroll to the message and select it");var a=u.get("frame");s.scrollTo(null,a.y),o.select(i)}},selectFirstMessage:function(){var e=Message.messageListController,t=e.get("arrangedObjects");t&&e.selectObject(t.get("firstObject"))}}),SC.mixin(MessageList,{_3H:null,_messageList:null,_lastButtonSelected:null,_lastSortOrder:null,_showMessageList:function(e,t){if(!t)this.page.get("messageListContainerView").appendChild(e),this._messageList=e;else{if(e===t)return;var n=t.get("parentView");if(!n)throw"bad API call; view does not have a parent view";n.replaceChild(e,t),this._messageList=e}},_guidOfSelectedMessage:function(){var e=Message.messageListController.get("selection"),t=e.firstObject().get("guid");return t},_setMessageListOrientationOnLoad:function(){var e=CoreMail.getPath("implicitPreferences.view");this.set("viewPreference",e),MessageList.ORIENTATION_THREE_COL===e?this.page.setPath("messageList.contentList.contentView.viewOrientation",MessageList.ORIENTATION_THREE_COL):this.page.setPath("messageList.contentList.contentView.viewOrientation",MessageList.ORIENTATION_TWO_COL),this.notifyPropertyChange("viewPreference")},_saveSplitterPosition:function(e,t){CoreMail.saveImplicitPreference("messageSplitterPosition",t)},_showSearch:function(e,t){if(e.length===0)this.set("searchField",""),this.getPath("page.searchPaneView").set("searchTextValue",""),Message.messageListController.set("content",null);else{var n=this.page.getPath("searchPaneView.searchTab.value");n==="_MessageList.Search.AnyField"
.loc()?this.set("searchField",CoreMail.SEARCH_ANYFIELD):n==="_MessageList.Search.TheSubject".loc()?this.set("searchField",CoreMail.SEARCH_SUBJECT):n==="_MessageList.Search.TheSender".loc()?this.set("searchField",CoreMail.SEARCH_FROM):n==="_MessageList.Search.TheRecipient".loc()&&this.set("searchField",CoreMail.SEARCH_RECIPIENT)}t&&t.firstObject()?this.set("selectionGuid",t.firstObject().get("guid")):this.set("selectionGuid",null)},_wasShowTriggeredBySort:NO,_show:function(e){this._wasShowTriggeredBySort===NO?(Message.searchController.setIfChanged("searchFieldValue",""),this.setPath("page.searchPaneView.isVisible",NO),this._showSearch("",e)):this._wasShowTriggeredBySort===YES&&(this._wasShowTriggeredBySort=NO)},_messageLoadErrorDelegate:SC.Object.create({alertPaneDidDismiss:function(e,t){switch(t){case SC.BUTTON2_STATUS:break;case SC.BUTTON1_STATUS:MessageList.dispatch({sig:"show"})}}}),_setDeleteStyling:function(){var e=this.page.getPath("messageList.contentList.contentView"),t=e.get("selectedViews"),n,r;if(t){r=t.get("length");for(var i=0;i<r;i++)n=t[i],n.set("isEnabled",NO)}},_removeDeleteStyling:function(){var e=this.page.getPath("messageList.contentList.contentView"),t=e.get("selectedViews"),n,r;if(t){r=t.get("length");for(var i=0;i<r;i++)n=t[i],n.set("isEnabled",YES)}},_fixLoadingUI:function(e){if(e.target===this._messageListRequest&&e.key==="state"){var t=this._messageListRequest.get("state");switch(t){case this._messageListRequest.STATE_SUCCESS:this.page.setPath("messageListContainerView.loading.isVisible",NO);break;case this._messageListRequest.STATE_ERROR:this.page.
setPath("messageListContainerView.loading.isVisible",NO);break;case this._messageListRequest.STATE_PENDING:this.page.setPath("messageListContainerView.loading.isVisible",YES)}}}}),MessageList.metrics=SC.Object.create({COLUMN_HEADER_FOLDER_DROP_DOWN_LEFT:100,COLUMN_HEADER_SORT_MENU_WIDTH:118,SPINNER_WIDTH:145,SEARCH_LABEL_VIEW_WIDTH:42,SEARCH_LABEL_VIEW_LEFT:10,SEARCH_FOLDER_DROP_DOWN_LEFT:54,SEARCH_FOLDER_DROP_DOWN_WIDTH:132,SEARCH_BY_LABEL_LEFT:183,SEARCH_BY_LABEL_WIDTH:14,SEARCH_FIELD_FOLDER_LEFT:200,SEARCH_FIELD_FOLDER_WIDTH:104,LOADING_WIDTH:174,LOADING_HEIGHT:50,MIN_MESSAGE_LIST_WIDTH:320,DEFAULT_MESSAGE_LIST_ITEM_HEIGHT:98,NO_PREVIEW_MESSAGE_LIST_ITEM_HEIGHT:55,DEFAULT_TOP:25,REFRESH_SPINNER_HEIGHT:62}),MessageList.SortMenuView=CW.AutoResizingMenuPane.extend({classNames:["select-menu"],contentView:SC.View.design(),itemSeparatorKey:"separator",itemsArray:[{title:"_MessageList.Sort.Date".loc(),isEnabled:YES,target:MessageList,action:"sortByDate",layerId:"mail-message-list-sort-by-date"},{title:"_MessageList.Sort.Flagged".loc(),isEnabled:YES,target:MessageList,action:"sortByFlag",layerId:"mail-message-list-sort-by-flag"},{title:"_MessageList.Sort.From".loc(),isEnabled:YES,target:MessageList,action:"sortByFrom",layerId:"mail-message-list-sort-by-from"},{title:"_MessageList.Sort.Size".loc(),isEnabled:YES,target:MessageList,action:"sortBySize",layerId:"mail-message-list-sort-by-size"},{title:"_MessageList.Sort.Subject".loc(),isEnabled:YES,target:MessageList,action:"sortBySubject",layerId:"mail-message-list-sort-by-subject"},{title:"_MessageList.Sort.Unread".loc(),isEnabled:YES
,target:MessageList,action:"sortByUnread",layerId:"mail-message-list-sort-by-unread"},{title:"",isEnabled:YES,icon:null,separator:YES},{title:"_MessageList.Sort.Ascending".loc(),isEnabled:YES,target:MessageList,action:"sortAscending",layerId:"mail-message-list-sort-ascending"},{title:"_MessageList.Sort.Descending".loc(),isEnabled:YES,target:MessageList,action:"sortDescending",layerId:"mail-message-list-sort-descending"}],items:function(){var e=this.get("itemsArray");return e=this.getSortedMenuItems(e),e}.property("itemsArray").cacheable(),getSortedMenuItems:function(e){var t=[],n=e.get("length");for(var r=0;r<=5;r++)t[r]=e[r];t.sort(function(e,t){return e.title.localeCompare(t.title,SC.Locale.currentLanguage.substr(0,2))});for(var i=6;i<n;i++)t[i]=e[i];return t},updateMenuCheckboxes:function(){var e=CoreMail.get("implicitPreferences"),t=e.get("messageSortBy"),n=this.get("items"),r;n[0].checkbox=n[1].checkbox=n[2].checkbox=n[3].checkbox=n[4].checkbox=n[5].checkbox=NO;switch(t){case CoreMail.SORT_BY_DATE:r="sortByDate";break;case CoreMail.SORT_BY_FLAG:r="sortByFlag";break;case CoreMail.SORT_BY_SIZE:r="sortBySize";break;case CoreMail.SORT_BY_SUBJECT:r="sortBySubject";break;case CoreMail.SORT_BY_TO:r="sortByTo";break;case CoreMail.SORT_BY_UNREAD:r="sortByUnread";break;case CoreMail.SORT_BY_FROM:r="sortByFrom"}for(var i=0;i<=5;i++){var s=n[i];if(s.action===r){s.checkbox=YES;break}}var o=e.get("messageSortAscending");o===YES?(n[7].checkbox=YES,n[8].checkbox=NO):(n[8].checkbox=YES,n[7].checkbox=NO),this.notifyPropertyChange("items")},setSortByFromOrTo:function(){var e=FolderList.selectedFolderRole
(),t=this.get("items"),n,r,i,s,o;e===CoreMail.FOLDER_ROLE_SENT||e===CoreMail.FOLDER_ROLE_DRAFTS?(r="sortByFrom",i="_MessageList.Sort.To".loc(),s="sortByTo",o="mail-message-list-sort-by-to"):(r="sortByTo",i="_MessageList.Sort.From".loc(),s="sortByFrom",o="mail-message-list-sort-by-from");for(var u=0;u<=5;u++){n=t[u];if(n.action===r){n.title=i,n.action=s,n.layerId=o;break}}this.notifyPropertyChange("items")}}),MessageList.ColumnHeaderView=SC.View.extend(SC.Control,{lastSelectedFolderGuid:null,childViews:"switchView folderDropDownView sortView".w(),switchView:SC.ButtonView.design(Global.ToolbarButtonMixin,{layout:{left:0,top:1,height:23,width:29},classNames:["switch-header"],themeName:"borderless",icon:null,iconBinding:SC.Binding.transform(function(e){return e===MessageList.ORIENTATION_TWO_COL?"show":"hide"}).from("MessageList.viewPreference"),toolTipBinding:SC.Binding.transform(function(e){return e===MessageList.ORIENTATION_TWO_COL?"_MessageList.ColumnHeader.SwitchView.ToolTip.ShowMailboxes".loc():"_MessageList.ColumnHeader.SwitchView.ToolTip.HideMailboxes".loc()}).from("MessageList.viewPreference"),action:function(){MessageList.viewPreference===MessageList.ORIENTATION_TWO_COL?MessageList.switchToThreeColumnView():(MessageList.switchToTwoColumnView(),Global.set("isFolderListAutoHidden",NO))}}),folderDropDownView:CW.PopupButtonView.design({layout:{left:MessageList.metrics.COLUMN_HEADER_FOLDER_DROP_DOWN_LEFT,right:MessageList.metrics.COLUMN_HEADER_SORT_MENU_WIDTH,top:2,height:18},themeName:"borderless",classNames:["folder-drop-down"],displayProperties:["selFolderGuid","unread"],
isVisible:NO,isVisibleBinding:SC.Binding.transform(function(e){return MessageList.ORIENTATION_TWO_COL===e?YES:NO}).from("MessageList.viewPreference"),menu:function(){if(!this._foldersMenu){var e=this;this._foldersMenu=CW.MenuPane.create({desiredSize:{width:180},anchor:e,moveToFolderItems:null,moveToFolderItemsBinding:"MoveToFolder.foldersArrayController.moveToFolderItems",items:function(){return this._itemsArray=this.get("moveToFolderItems"),this._itemsArray&&(this._itemsArray=this._itemsArray.toArray(),this.selFolderGuidDidChange()),this._itemsArray}.property("moveToFolderItems").cacheable(),selectedItemDidChange:function(){FolderList.setFolderSelectionWithGuid(this.getPath("selectedItem.value"))}.observes("selectedItem"),selFolderGuid:null,selFolderGuidBinding:".anchor.selFolderGuid",selFolderGuidDidChange:function(){if(!this._itemsArray)return;var e=this._itemsArray.getEach("value").indexOf(this.getPath("anchor.selFolderGuid"));if(e>-1){var t=this._itemsArray.objectAt(e);this._prevSelItem&&this._prevSelItem.set("checkbox",NO),t.set("checkbox",YES),this._prevSelItem=t}}.observes("selFolderGuid"),target:MessageList,action:"forceResyncMessageList"})}return this._foldersMenu}.property(),selFolderGuid:null,selFolderGuidBinding:SC.Binding.oneWay("FolderList.foldersTreeController*selection.firstObject.guid"),unread:null,unreadBinding:SC.Binding.oneWay("FolderList.foldersTreeController*selection.firstObject.unread"),displayTitle:function(){return FolderList.getFolderNameAndUnreadCount()+'<img src="'+SC.BLANK_IMAGE_URL+'" alt="" class="black-caret" />'}.property("selFolderGuid","unread"
),showMenu:function(){this.set("lastSelectedFolderGuid",this.get("selFolderGuid")),arguments.callee.base.apply(this,arguments)}}),sortView:SC.View.design({layout:{right:6,top:2,bottom:0,width:MessageList.metrics.COLUMN_HEADER_SORT_MENU_WIDTH},classNames:"text-align-right".w(),childViews:"sortMenuPopUp".w(),sortMenuPopUp:CW.PopupButtonView.design(SC.AutoResize,{classNames:"sort-header".w(),layout:{right:0,top:0,bottom:0},autoResizePadding:26,icon:"down-arrow",titleBinding:"MessageList.sortMenuController.sortMenuTitle",themeName:"borderless",titleMinWidth:60,menu:MessageList.SortMenuView,showMenu:function(){arguments.callee.base.apply(this,arguments);var e=this.get("menu");e.setSortByFromOrTo(),e.updateMenuCheckboxes()}})})}),MessageList.MessageListItemView=SC.ListItemView.extend(SC.RootResponder,{classNames:"message".w(),displayProperties:["showMessagePreviews","contactDataRefreshed"],contentKeys:{contentUnreadKey:"unread",contentRepliedKey:"replied",contentForwardedKey:"forwarded",contentFlaggedKey:"flagged",contentJunkKey:"junk",contentComputedPreviewKey:"computedPreview",contentAccountKey:"account",contentIsMessageJunk:"isMessageJunk",contentIsFromVipSender:"isFromVipSender"},contentUnreadKey:"unread",contentRepliedKey:"replied",contentForwardedKey:"forwarded",contentFlaggedKey:"flagged",contentJunkKey:"junk",contentComputedPreviewKey:"computedPreview",contentAccountKey:"account",contentIsMessageJunk:"isMessageJunk",contentIsFromVipSender:"isFromVipSender",showMessagePreviews:null,showMessagePreviewsBinding:"MessageList.serverPreferences.showMessagePreviews",contactDataRefreshed
:null,contactDataRefreshedBinding:"Contacts.contactDataRefreshed",isPoolable:YES,layerIsCacheable:YES,_propertyCache:null,render:function(e,t){var n=this.get("content");this._propertyCache?this._propertyCache.layerId=this.get("layerId"):this._propertyCache={layerId:this.get("layerId")},this.renderColumnView(e,t,n)},renderColumnView:function(e,t,n){var r,i="",s="",o="",u=0,a,f="",l="",c="",h,p=this._propertyCache;n&&(r=this._getMessageStatus(),i=r.topFlagToRender,s=r.middleFlagToRender,o=n.get("toDisplayName"),u=n.get("attachmentCount"),a=FolderList.selectedFolderRole(),CoreMail.FOLDER_ROLE_DRAFTS===a?SC.empty(o)&&(o="_MessageList.EmptyField.To".loc()):CoreMail.FOLDER_ROLE_SENT!==a&&(o=n.get("fromDisplayName")),l=n.get("subject"),SC.empty(l)&&(l="_MessageList.EmptyField.Subject".loc()),f=this._getDate(),c=this.get("showMessagePreviews")===YES?SC.RenderContext.escapeHTML(n.get("computedPreview")):"",h=r.classes),SC.empty(h)===NO&&e.addClass(h,YES);if(n)if(s!==""||i==="")if(s!==""&&i==="")i=s,s="";else if(s===""||i==="")i="read";var d="_MessageListItem.ToolTip".loc({sender:o,subject:l});n?e.attr("title",d):e.removeAttr("title"),e.attr("aria-hidden",NO),o=SC.RenderContext.escapeHTML(o),l=SC.RenderContext.escapeHTML(l);if(t)p.topFlagToRender=i,p.middleFlagToRender=s,p.renderedSender=o,e.push('<div class="left-msg">','<div class="top-flag ',i,'"></div>','<div class="middle-flag ',s,'"></div>',"</div>",'<div class="right-msg">','<div class="first-row">','<span class="wrapper">','<span class="sender">',o,"</span>"),p.attachmentCount=u,u>0&&e.push('<span class="attachment">','<img src="'
,SC.BLANK_IMAGE_URL,'"/>',"</span>"),e.push("</span>");else{if(p.topFlagToRender!==i||p.middleFlagToRender!==s)this.$(".top-flag").removeClass(this._propertyCache.topFlagToRender),this.$(".top-flag").addClass(i),this.$(".middle-flag").removeClass(this._propertyCache.middleFlagToRender),this.$(".middle-flag").addClass(s),p.topFlagToRender=i,p.middleFlagToRender=s;p.renderedSender!==o&&(this.$(".sender").html(o),p.renderedSender=o),p.attachmentCount!==u&&(u===0?this.$(".attachment").remove():p.attachmentCount===0&&this.$(".wrapper").append('<span class="attachment"><img src="'+SC.BLANK_IMAGE_URL+'"/>'+"</span>")),p.attachmentCount=u}this.renderAccount(e,t,n),t?(p.renderedSubject=l,p.date=f,e.push('<span class="date">',f,"</span>","</div>",'<div class="second-row subject">',l,"</div>")):(p.date!==f&&(this.$(".date").html(f),p.date=f),p.renderedSubject!==l&&(this.$(".subject").html(l),p.renderedSubject=l)),t?(p.preview=c,e.push('<div class="third-row-wrapper"><div class="third-row preview">',c,"</div></div>"),e.push("</div>")):p.preview!==c&&(this.$(".third-row.preview").html(c),p.preview=c)},renderAccount:function(e,t,n){var r,i=CoreMail.ACCOUNT_COLOR_CODES.GRAY,s="",o,u=this._propertyCache;n&&(r=n.get("account"),r!==undefined&&(s=SC.RenderContext.escapeHTML(r.get("accountDescription")),i=r.get("color"))),i=CoreMail.ACCOUNT_COLOR_CODES.getCode(i),t?(o=' style="color:'+i+';"',e.push('<span class="account" '+o+">",s,"</span>"),u.color=i,u.desc=s):(u.color!==i&&(this.$(".account").css("color",i),u.color=i),u.desc!==s&&(this.$(".account").html(s),u.desc=s))},_getDate:function(){var e
,t=this.getPath("content.localizedDate"),n=CoreMail.timeZoneConverter.get("currentDate"),r=CoreMail.timeZoneConverter.get("yesterdayDate"),i;return t.getDate()===r.getDate()&&t.getMonth()===r.getMonth()&&t.getFullYear()===r.getFullYear()?i=CoreMail.timeZoneConverter.get("yesterday"):t.getDate()===n.getDate()&&t.getMonth()===n.getMonth()&&t.getFullYear()===n.getFullYear()?(e=CoreMail.timeZoneConverter.get("messageSavedOrReceivedTime"),i=CoreMail.timeZoneConverter.getFormattedDate(t,e)):(e=CoreMail.timeZoneConverter.get("shortDateFormat"),i=CoreMail.timeZoneConverter.getFormattedDate(t,e)),i},_getMessageStatus:function(){var e={},t=[],n="",r="",i=this.get("content"),s=NO,o=i.getPath("folder.role");o===CoreMail.FOLDER_ROLE_DRAFTS||o===CoreMail.FOLDER_ROLE_SENT?s=i.get("isToVipSender"):s=i.get("isFromVipSender"),i.get("unread")===YES||s===YES?(s===YES?i.get("unread")===YES?(t.push("unread-vip"),n="unread-vip"):(n="read-vip",t.push("read-vip")):i.get("unread")===YES?(t.push("unread"),n="unread"):t.push("read"),i.get("replied")===YES?r="replied":i.get("forwarded")===YES&&(r="forwarded"),i.get("isMessageJunk")===YES&&(t.push("junk"),r="junk"),i.get("flagged")===YES&&(t.push("flagged"),r="flagged")):i.get("flagged")===YES||i.get("isMessageJunk")===YES||i.get("forwarded")===YES||i.get("replied")===YES?(i.get("flagged")===YES?(t.push("flagged"),n="flagged"):i.get("isMessageJunk")===YES&&(t.push("junk"),n="junk"),i.get("replied")===YES?r="replied":i.get("forwarded")===YES&&(r="forwarded"),i.get("isMessageJunk")===YES&&n!=="junk"&&(t.push("junk"),r="junk")):(n="read",t.push("read")),i.get
("attachmentCount")>0&&t.push("has-attachment"),i.get("account")!==undefined&&t.push("has-account");if(i.get("relatedGUID"))if(n==="forwarded"||n==="replied")n+=" has-related-message",t.push("has-related-message");else if(r==="forwarded"||r==="replied")r+=" has-related-message",t.push("has-related-message");return e.classes=t,e.topFlagToRender=n,e.middleFlagToRender=r,e},mouseMoved:function(e){var t=arguments.callee.base.apply(this,arguments),n=this.get("content"),r;r=e.target?e.target.className:null;if(r.indexOf("left-msg")>=0||r.indexOf("top-flag")>=0)if(n)n.get("flagged")>0||n.get("replied")>0||n.get("forwarded")>0?e.target.title="":n.get("unread")?e.target.title="_MessageList.MarkAs.Read".loc():e.target.title="_MessageList.MarkAs.Unread".loc();else{var i="MessageList.MessageListItemView - mouseMoved : content is undefined";CoreMail.errorHandler.logErrorTrap(i)}return t},mouseDown:function(e){var t=NO,n=e.target,r;return r=n?n.className:null,r&&(r.indexOf("flagged")===-1&&r.indexOf("replied")===-1&&r.indexOf("forwarded")===-1&&!(r.indexOf("left-msg")>=0||r.indexOf("top-flag")<0)&&(t=YES),r.indexOf("has-related-message")!==-1&&(this.$(".has-related-message").addClass("selected"),t=YES)),t},mouseUp:function(e){var t=NO,n=e.target,r;return r=n?n.className:null,r&&(r.indexOf("flagged")!==-1||r.indexOf("replied")!==-1||r.indexOf("forwarded")!==-1||r.indexOf("left-msg")>=0||r.indexOf("top-flag")<0?r.indexOf("has-related-message")!==-1&&(CoreMail.errorHandler.recordStat("_STAT_REPLY_OR_FORWARD_GLYPH_CLICK"),MessageList.dispatch({sig:"openRelatedMessage",relatedMessageContent:this
.get("content")}),t=YES):(MessageList.dispatch({sig:"markAsReadOrUnread",content:this.get("content")}),t=YES)),this.$(".has-related-message").removeClass("selected"),t},isVisibleInWindowDidChange:function(){if(this.isVisibleInWindow===!1){var e=this.$();e.attr("aria-hidden",YES),e.hide()}}.observes("isVisibleInWindow")}),MessageList.MessageListView=SC.ListView.design({contentBinding:"Message.messageListController.arrangedObjects",selectionBinding:"Message.messageListController.selection",exampleView:MessageList.MessageListItemView,appHasFocusBinding:"SC.RootResponder.responder.hasFocus",viewOrientation:null,displayProperties:["viewOrientation","selection","showMessagePreviews"],canDeleteContent:YES,rowSpacing:1,action:"messageListItemDoubleClick",target:"MessageList",useFastPath:YES,selectOnMouseDown:NO,dragDataTypes:[CoreMail.Message],showMessagePreviews:null,showMessagePreviewsBinding:"MessageList.serverPreferences.showMessagePreviews",rowHeight:function(){var e=MessageList.metrics;return this.get("showMessagePreviews")===YES?e.DEFAULT_MESSAGE_LIST_ITEM_HEIGHT:e.NO_PREVIEW_MESSAGE_LIST_ITEM_HEIGHT}.property("showMessagePreviews").cacheable(),deleteBackward:function(){return NO},deleteForward:function(){return NO},moveLeft:function(e){return Global.tryToPerform("keyDown",e)?YES:NO},moveRight:function(e){return Global.tryToPerform("keyDown",e)?YES:NO},willBecomeKeyResponderFrom:function(){Message.messageListController.set("isKeyDown",NO)},mouseDown:function(e){Message.messageListController.set("isKeyDown",NO),SC.browser.isMozilla?this.invokeLater(function(){var e=ViewMessage
.getWebViewIframe();e&&e.blur(),window.focus?window.focus():CoreMail.errorHandler.logErrorTrap("MessageList.MessageListView.mouseDown : window does not have method focus()"),this.invokeLater("becomeFirstResponder",1)},1):window.focus?window.focus():CoreMail.errorHandler.logErrorTrap("MessageList.MessageListView.mouseDown : window does not have method focus()");var t=this.getPath("pane.rootResponder");return t&&t.targetViewForEvent(e)?arguments.callee.base.apply(this,arguments):YES},mouseUp:function(e){var t=this.getPath("pane.rootResponder");return t&&t.targetViewForEvent(e)?arguments.callee.base.apply(this,arguments):YES},mouseDragged:function(e){var t=this.mouseDownInfo,n,r;if(!t||!t.event)n=YES;else{var i=t.event,s=i.clientX,o=i.clientY,u=s-e.clientX,a=o-e.clientY,f=Math.sqrt(u*u+a*a);f<=CoreMail.DRAG_START_THRESHOLD?n=YES:(n=arguments.callee.base.apply(this,arguments),r=this.get("dragContent"),r&&r.contentDragged&&(FolderList.set("msgDragContent",r.contentDragged),Message.messageListController.set("msgDragIndex",r.indexes)))}return n},interpretKeyEvents:function(e){var t=e.commandCodes(),n=t[0],r=t[1],i=YES;if(n==="ctrl_shift_j")MessageList.dispatch({sig:"markAsJunkNotJunk"});else if(n==="ctrl_shift_l")CoreMail.incrementUserStat(CoreMail.STAT_KS_FLAG_UNFLAG),MessageList.dispatch({sig:"markAsFlaggedUnflagged"});else if(n==="ctrl_shift_u")CoreMail.incrementUserStat(CoreMail.STAT_KS_READ_UNREAD),MessageList.dispatch({sig:"markAsReadUnread"});else if(n==="return")MessageList.dispatch({sig:"return"});else if(n==="ctrl_p")MessageList.dispatch({sig:"ctrl_p"});else if("backspace"===
n||"delete"===n)CoreMail.incrementUserStat(CoreMail.STAT_KS_DELETE),MessageList.dispatch({sig:"delete"});else if(n==="ctrl_down"&&CoreMail.ARCHIVE_GUID!==Message.messageController.getPath("folder.guid"))MainToolbar.dispatch({sig:"archiveMessage"});else if(!n&&" "===r){var s=ViewMessage.getPath("page.messageScrollView");e.shiftKey?0===s.get("verticalScrollOffset")?this.selectNextItem(!1,1):s.scrollUpPage():s.get("verticalScrollOffset")===s.get("maximumVerticalScrollOffset")?this.selectPreviousItem(!1,1):s.scrollDownPage()}else n==="tab"||n==="shift_tab"?i=NO:((n==="up"||n==="down")&&CoreMail.incrementUserStat(CoreMail.STAT_KS_MSG_NAV),i=arguments.callee.base.apply(this,arguments));return i},keyDown:function(){return Message.messageListController.set("isKeyDown",YES),arguments.callee.base.apply(this,arguments)},keyUp:function(){return Message.messageListController.set("isKeyDown",NO),Message.messageListController.updateControllerContentOnKeyUp(),arguments.callee.base.apply(this,arguments)},init:function(){arguments.callee.base.apply(this,arguments);var e=SC.DateTime.create(),t=e.unknownProperty("hour"),n=e.unknownProperty("minute"),r=e.unknownProperty("second"),i=((23-t)*60*60+(59-n)*60+(60-r))*1e3,s=SC.Timer.schedule({target:this,action:"_reloadMessageList",interval:i});this.set("timer",s)},_reloadMessageList:function(){this.reload(null)},collectionViewShouldBeginDrag:function(){return YES},_computeDraggedMessages:function(e){if(e){var t=CoreMail.definedMessageIndexes(this.getPath("dragContent.contentDragged"),Message.messageListController.get("arrangedObjects"));if(!t){SC.warn
("definedIndexes is null");return}t=t.toArray();var n=[],r=e.toArray(),i=r.get("length"),s;for(var o=0;o<i;o++)s=r[o],-1!==t.indexOf(s)&&n.push(this.itemViewForContentIndex(s))}},collectionViewDragViewFor:function(e,t){if(t){this._computeDraggedMessages(t);var n=this.getPath("dragContent.contentDragged"),r=n.getPath("firstObject.folder.guid"),i=CoreMail.messageListDataSource.storeKeyArray(r),s;if(i)if((i.loadType&CoreMail.Request.SEARCH)>0){var o=CoreMail.definedMessageIndexes(n,Message.messageListController.get("arrangedObjects"));o&&(s=o.get("length"))}else s=t.get("length");return this._dragView=MessageList.DragView.create({messageCount:s}),MessageList.setCurrentDragView(this._dragView),this._dragView}return null},ghostActsLikeCursor:YES,selectedViews:function(){var e=this.get("selection"),t=this.get("content"),n=CoreMail.definedMessageIndexes(e,t),r,i=[],s;if(e&&n){r=n.toArray(),s=r.get("length");for(var o=0;o<s;o++)i.push(this.itemViewForContentIndex(r[o]))}return i}.property("selection"),render:function(e){return this.get("showMessagePreviews")===NO?e.addClass("no-preview"):e.removeClass("no-preview"),arguments.callee.base.apply(this,arguments)},selectionDidChange:function(){var e=this.get("selection"),t=this.get("content"),n=this.getPath("content.length"),r;e&&this._lastContentLength>n&&(r=e.indexSetForSource(t),r&&this.scrollToContentIndex(r.firstObject())),this._lastSelectedGuid=e.getPath("firstObject.guid"),this._lastContentLength=n}.observes("selection"),mouseWheel:function(){return arguments.callee.base.apply(this,arguments),NO}}),MessageList.RefreshView=SC.View.
extend({childViews:["wrapper"],isVisibleBinding:"Message.messageListController.isRefreshViewVisible",wrapper:SC.View.extend({layout:{centerX:0,top:15,width:32,height:32},childViews:["spinnerView"],spinnerView:SC.View.extend({classNames:"spinner-32px-ffffff"})})}),MessageList.FiltersMenuItemView=CW.AutoResizingMenuItemView.extend({performAction:function(){this.sendAction()},sendAction:function(){var e=this.getPath("parentMenu.rootMenu");e.set("selectedItem",this.get("content")),e.notifyPropertyChange("menuItemClicked")}}),MessageList.FiltersMenuView=CW.AutoResizingMenuPane.extend({classNames:["filters-menu"],contentView:SC.View.design(),itemSeparatorKey:"separator",menuWidthPadding:60,exampleView:MessageList.FiltersMenuItemView,layouts:[CW.PickerLayout.ON_TOP],INDEX_UNREAD:0,INDEX_FLAGGED:1,INDEX_SEPARATOR_1:2,INDEX_TO_ME:3,INDEX_CC_ME:4,INDEX_SEPARATOR_2:5,INDEX_FROM_VIP:6,viewControllerBinding:"MessageList.filtersMenuController",_vipItems:[{title:"_MessageList.Footer.Filters.Menu.Unread".loc(),icon:"unread"},{title:"_MessageList.Footer.Filters.Menu.Flagged".loc(),icon:"flagged"},{title:"",icon:null,separator:YES},{title:"_MessageList.Footer.Filters.Menu.ToMe".loc(),icon:"to-me"},{title:"_MessageList.Footer.Filters.Menu.CcMe".loc(),icon:"cc-me"}],_regularItems:[{title:"_MessageList.Footer.Filters.Menu.Unread".loc(),icon:"unread"},{title:"_MessageList.Footer.Filters.Menu.Flagged".loc(),icon:"flagged"},{title:"",icon:null,separator:YES},{title:"_MessageList.Footer.Filters.Menu.ToMe".loc(),icon:"to-me"},{title:"_MessageList.Footer.Filters.Menu.CcMe".loc(),icon:"cc-me"},{title:""
,icon:null,separator:YES},{title:"_MessageList.Footer.Filters.Menu.FromVip".loc(),icon:"from-vip"}],items:function(){var e=this.getPath("viewController.folderRecord.role");return e===CoreMail.FOLDER_ROLE_VIP?this._vipItems:this._regularItems}.property("viewController.folderRecord").cacheable(),modalPane:SC.ModalPane.extend({mouseUp:function(e){var t=SC.$(e.target),n="filters-button";return(t.hasClass(n)||t.parent().hasClass(n))&&MessageList.page.getPath("messageListContainerView.footer.filtersButton").tryToPerform("mouseUp",e),YES}}),remove:function(){var e=this.get("viewController"),t=!(e.get("unread")||e.get("flagged")||e.get("toMe")||e.get("ccMe")||e.get("withAttachments")||e.get("fromVip"));return e.get("enabled")&&t&&e.set("enabled",NO),arguments.callee.base.apply(this,arguments)},viewControllerDidSetup:function(){this.get("viewController")&&this.updateMenuCheckboxes()}.observes("viewController"),updateMenuCheckboxes:function(){var e=this.get("viewController");if(e){var t=this.get("items");t[this.INDEX_UNREAD].checkbox=e.get("unread"),t[this.INDEX_FLAGGED].checkbox=e.get("flagged"),t[this.INDEX_TO_ME].checkbox=e.get("toMe"),t[this.INDEX_CC_ME].checkbox=e.get("ccMe"),this.getPath("viewController.folderRecord.role")!==CoreMail.FOLDER_ROLE_VIP&&(t[this.INDEX_FROM_VIP].checkbox=e.get("fromVip")),this.notifyPropertyChange("items")}},menuItemClicked:null,menuItemClickActionPerformed:function(){var e=this.get("selectedItem"),t=e.get("checkbox"),n=this.get("viewController"),r,i,s;e.set("checkbox",!t);switch(e.getPath("contentIndex")){case this.INDEX_UNREAD:r="unread";break;case this
.INDEX_FLAGGED:r="flagged";break;case this.INDEX_TO_ME:r="toMe";break;case this.INDEX_CC_ME:r="ccMe";break;case this.INDEX_FROM_VIP:r="fromVip";break;case this.INDEX_SEPARATOR_1:return;case this.INDEX_SEPARATOR_2:return}s=n.get(r),i=!s,n.set(r,i),CoreMail.errorHandler.recordStat("_filter_criteria_changed",{filterCriteria:n.getPath("folderRecord.filterCriteria.digest"),filterChangedProperty:r,filterNewValue:i,filterOldValue:s}),MessageList.dispatch({sig:"filterCriteriaChanged"})}.observes("menuItemClicked")}),MessageList.MessageListFooterView=SC.View.extend({classNames:["message-list-footer"],layout:{left:0,right:0,height:44,bottom:0},childViews:["filtersButton","wrapper"],filtersButton:SC.ButtonView.extend({classNames:["filters-button"],themeName:"custom",layout:{centerY:0,height:20,width:20,left:13},toolTip:"_MessageList.Footer.Filters.Tooltip".loc(),valueBinding:"MessageList.filtersMenuController.enabled",action:"toggle",toggle:function(){var e=MessageList.filtersMenuController,t=e.get("enabled");e.set("enabled",!t),CoreMail.errorHandler.recordStat("_filter_criteria_changed",{filterCriteria:e.getPath("folderRecord.filterCriteria.digest"),filterChangedProperty:"enabled",filterNewValue:!t,filterOldValue:t}),MessageList.dispatch({sig:"filterCriteriaChanged"})},render:function(e,t){return arguments.callee.base.apply(this,arguments),t&&e.push('<div class="line1"></div>','<div class="line2"></div>','<div class="line3"></div>'),e}}),wrapper:SC.View.design({childViews:["filteredByLabel","filtersPopupMenuButton"],layout:{left:46,right:46,top:0,bottom:0},filteredByLabel:SC.LabelView
.design(SC.AutoResize,{layout:{centerY:-10,centerX:5,height:20},localize:YES,value:"_MessageList.Footer.Filters.Label",isVisibleBinding:"MessageList.filtersMenuController.enabled"}),filtersPopupMenuButton:CW.PopupButtonView.design(SC.AutoResize,{themeName:"borderless",controlSize:SC.TINY_CONTROL_SIZE,layout:{centerY:10,centerX:0,height:20},maxWidthBinding:SC.Binding.transform(function(e){var t=e.width;return t}).from(".owner.frame"),localize:YES,titleBinding:"MessageList.filtersMenuController.filtersPopupMenuButtonTitle",isVisibleBinding:"MessageList.filtersMenuController.enabled",menu:MessageList.FiltersMenuView,showMenu:function(){arguments.callee.base.apply(this,arguments);var e=this.get("menu");e.updateMenuCheckboxes()}})})}),MessageList.MessageListContainerView=SC.View.extend({classNames:"message-list".w(),margins:32,childViews:"columnHeader topBorder refreshSpinner loading footer".w(),columnHeader:MessageList.ColumnHeaderView.design({classNames:"column-header".w(),layout:{top:0,left:0,right:0,height:24}}),topBorder:SC.View.design({classNames:"border".w(),layout:{left:0,right:0,top:24,height:1}}),refreshSpinner:MessageList.RefreshView.design({classNames:"refresh-spinner".w(),layout:{top:25,left:0,right:0}}),loading:SC.View.extend({classNames:["loading-box"],childViews:"loadingSpinner loadingLabel".w(),layout:{centerX:0,height:54,width:MessageList.metrics.LOADING_WIDTH,bottom:40},loadingSpinner:CW.SpinnerView.extend({layout:{left:30,top:13},size:28,innerClassNames:["message-list-loading-box-spinner"]}),loadingLabel:SC.LabelView.design({layout:{left:71,top:18,height:22},value
:"_MessageView.LoadingMail".loc()})}),footer:MessageList.MessageListFooterView,showSubViews:function(e){this.setPath("columnHeader.isVisible",e),this.setPath("topBorder.isVisible",e)}}),MessageList.ScrollThumb=SC.View.extend(CW.Animatability,{classNames:"message-list-scroll-thumb",childViews:"contentList".w(),contentList:SC.ScrollView.design(CW.FadingCaplessScrollerViewSupport,{layout:{top:0,left:0,right:0,bottom:0},hasHorizontalScroller:NO,borderStyle:SC.BORDER_NONE,autohidesVerticalScroller:YES,isVerticalScrollerVisible:YES,verticalScrollerView:CW.FadingCaplessScrollerView,verticalScrollerLayout:{right:1,top:1,bottom:1},contentView:MessageList.MessageListView.extend({layout:{top:0,left:0,right:0,bottom:0}}),shouldForwardAnimate:YES,isReverseAnimationInProgress:NO,forwardAnimationCompletionTime:0,didCreateLayer:function(){arguments.callee.base.apply(this,arguments),this._scrollThumbElem=this.get("parentView").$()},mouseWheel:function(e){arguments.callee.base.apply(this,arguments);if(this.get("isReverseAnimationInProgress")===YES)return YES;var t=Math.round(e.wheelDeltaY),n=Message.messageListController,r=n.get("isRefreshViewVisible"),i=MessageList.metrics,s=i.REFRESH_SPINNER_HEIGHT,o=i.DEFAULT_TOP,u=Math.round(s*1.33)+o,a=this.get("owner"),f=MessageList.REFRESH_SPINNER_ANIMATION_DURATION;if(r===NO&&t<0&&this.get("verticalScrollOffset")===0)n.set("isRefreshViewVisible",YES),this._scrollThumbElem.addClass("has-refresh-spinner");else if(CoreMail.get("isResyncMessageListInProgress")===NO&&r===YES&&t<0&&this.get("shouldForwardAnimate")===YES){var l=a.getPath("layout.top"),c=Math
.abs(l-t);Math.abs(t)<=MessageList.MIN_WHEEL_DELTA&&(c+=MessageList.WHEEL_DELTA_BUFFER),c>u?(c=u,this.set("shouldForwardAnimate",NO)):f*=.5;var h=this;a.animate("top",{from:l,to:c,duration:f},{reportCompletion:function(){h.forwardAnimationCompletionTime=Date.now(),h.set("shouldForwardAnimate",YES)}.listens("finish")})}return YES},performReverseAnimation:function(){var e=Message.messageListController,t=e.get("isRefreshViewVisible"),n=CoreMail.get("isResyncMessageListInProgress"),r=MessageList.metrics,i=r.REFRESH_SPINNER_HEIGHT,s=MessageList.REFRESH_SPINNER_ANIMATION_DURATION,o=this.get("owner");if(t===YES&&o.get("isAnimating")===NO){var u=r.DEFAULT_TOP,a=i+u,f=o.getPath("layout.top"),l=NO,c=NO,h;f===u?(e.set("isRefreshViewVisible",NO),this._scrollThumbElem.removeClass("has-refresh-spinner")):f>a?(l=YES,h=a,c=YES):n===NO&&(l=YES,h=u);if(l===YES){this.set("isReverseAnimationInProgress",YES);var p=this,d=function(){o.animate("top",{to:h,duration:s},{reportCompletion:function(){h===u&&p.set("isReverseAnimationInProgress",NO)}.listens("finish")})};if(c===YES)d(),CoreMail.resyncMessageList(),CoreMail.errorHandler.recordStat("_STAT_pull_to_refresh_message_list");else{var v=Date.now()-this.forwardAnimationCompletionTime,m=0,g=MessageList.MIN_THRESHOLD_TO_REVERSE_ANIMATE;v<g&&(m=g-v),this.invokeLater(d,m)}}}}.observes("CoreMail.isResyncMessageListInProgress","owner.isAnimating")})}),MessageList.LoadingScrollThumb=SC.View.extend({classNames:["message-list-loading"],childViews:["emptyRowBackgroundView","loadingWrapper"],emptyRowBackgroundView:SC.View.extend(SC.StaticLayout,{useStaticLayout
:YES,classNames:["empty-row-wrapper"],layout:{top:0,left:0},showMessagePreviewsBinding:"MessageList.serverPreferences.showMessagePreviews",displayProperties:["showMessagePreviews"]}),loadingWrapper:SC.View.extend({layout:{bottom:84,centerX:0,width:MessageList.metrics.SPINNER_WIDTH,height:MessageList.metrics.LOADING_HEIGHT},childViews:"showSpinner loadingLabel".w(),showSpinner:SC.View.extend({layout:{top:8},classNames:"spinner-32px-ffffff"}),loadingLabel:SC.LabelView.design({classNames:["spinner-text"],layout:{left:46,top:12},value:"_MessageView.LoadingMail".loc()})})}),MessageList.SearchPaneView=SC.View.extend({classNames:["search-pane-view"],selectedTab:null,isVisibleBinding:SC.Binding.transform(function(e){return e}).from("Message.searchController.searchPaneVisible"),searchTextValue:null,searchTextValueBinding:"Message.searchController.searchFieldValue",childViews:["searchTab"],searchTab:SC.SegmentedView.design({layout:{top:9,left:8,right:8,height:30},themeName:"borderless",controlSize:SC.SMALL_CONTROL_SIZE,items:[{layerId:"search-from",value:"_MessageList.Search.TheSender".loc(),width:.25},{layerId:"search-to",value:"_MessageList.Search.TheRecipient".loc(),width:.25},{layerId:"search-subject",value:"_MessageList.Search.TheSubject".loc(),width:.25},{layerId:"search-all",value:"_MessageList.Search.AnyField".loc(),width:.25}],itemTitleKey:"value",itemValueKey:"value",itemLayerIdKey:"layerId",itemWidthKey:"width",localize:YES,valueBinding:".owner.selectedTab",allowsEmptySelection:NO,shouldHandleOverflow:NO,align:SC.ALIGN_LEFT,setIndex:function(e){var t=this.items[e];t&&this.owner
.set("selectedTab",t.value)},mouseUp:function(e){var t=this.displayItemIndexForEvent(e),n;t>0&&(n=this.items[t].value,this.owner.set("selectedTab",n)),CoreMail.saveImplicitPreference("lastSelectedSearch",t),arguments.callee.base.apply(this,arguments)},valueDidChange:function(){arguments.callee.base.apply(this,arguments);var e=Message.searchController.get("searchFieldValue");e&&MessageList.dispatch({sig:"showSearch",searchTextValue:e})}.observes("value")})}),MessageList.page=SC.Page.design({folderDropDownView:SC.outlet("messageListContainerView.columnHeader.folderDropDownView"),messageListContainerView:MessageList.MessageListContainerView.extend({layout:{left:0,right:0,bottom:0}}),loadingView:MessageList.LoadingScrollThumb.extend({layout:{top:25,left:0,right:0,bottom:0}}),messageList:MessageList.ScrollThumb.extend({layout:{top:MessageList.metrics.DEFAULT_TOP,left:0,right:0,bottom:45}}),searchPaneView:MessageList.SearchPaneView.design({layout:{top:0,left:0,right:0,height:44}})}),MessageList.DragView=SC.View.extend({layout:{height:39,width:81},childViews:"envelopeView badgeView countView".w(),messageCount:null,badgeClass:function(){var e=this.get("messageCount"),t;return e<10?t="drag-badge-1-digit":e<100?t="drag-badge-2-digit":e<1e3?t="drag-badge-3-digit":e<1e4?t="drag-badge-4-digit":t="drag-badge-5-digit",t}.property(),envelopeView:SC.ImageView.design({classNames:["drag-envelope"]}),countView:SC.LabelView.design({layout:function(){var e=this.getPath("owner.messageCount"),t=SC.browser.isSafari?4:3,n;return e>9999?n=22:n=26,{top:t,left:n}}.property().cacheable(),classNames:["me-dragcount"
],render:function(e){var t=arguments.callee.base.apply(this,arguments);return e.addClass(this.getPath("owner.badgeClass")),t},value:function(){var e=this.getPath("owner.messageCount");return e>9999?"9999":e}.property(),isVisible:function(){return this.getPath("owner.messageCount")>1?YES:NO}.property()}),badgeView:SC.LabelView.design({layout:{top:7,left:26},classNames:["badge-view"],textAlign:SC.ALIGN_CENTER,controlSize:SC.SMALL_CONTROL_SIZE,render:function(e){var t=arguments.callee.base.apply(this,arguments);return e.push('<div class="left"></div>'),e.push('<div class="middle"></div>'),e.push('<div class="right"></div>'),e.addClass(this.getPath("owner.badgeClass")),t},isVisible:function(){return this.getPath("owner.messageCount")>1?YES:NO}.property()}),setInvalidDrop:function(e){var t="default";YES===e?(t="no-drop",this.get("badgeView").$().addClass("hidden")):this.get("messageCount")>1&&this.get("badgeView").$().removeClass("hidden"),this.get("envelopeView").$().css("cursor",t)}}),window.MainToolbar=SC.Object.create({initStatechart:function(){arguments.callee.base.apply(this,arguments)},initial:"1.2 Main Toolbar","1.2 Main Toolbar":function(e){switch(e.sig){case"enter":return this._selectionObserver=Message.messageListController.addStatechartObserver("selection",this),CK.Statechart.handled();case"exit":return Message.messageListController.removeStatechartObserver("selection",this,this._selectionObserver),this._selectionObserver=null,CK.Statechart.handled();case"propertyChanged":var t=Message.messageListController.getPath("selection.length");return t>1?(this[this.stateKey]="1.2.2.2 Multiple Message Selected"
,CK.Statechart.EVT_TRANSITION_RES):t===1?(this[this.stateKey]="1.2.2.1 Single Message Selected",CK.Statechart.EVT_TRANSITION_RES):(this[this.stateKey]="1.2.1 No Message Selected",CK.Statechart.EVT_TRANSITION_RES);case"compose":return CoreMail.incrementUserStat(CoreMail.STAT_COMPOSE),Global.openMessage(CoreMail.MESSAGE_MODE_COMPOSE,"",""),CK.Statechart.handled()}}.state(),"1.2.1 No Message Selected":function(e){switch(e.sig){case"enter":return CK.Statechart.handled()}}.state("1.2 Main Toolbar"),"1.2.2 Message Selected":function(e){var t,n;switch(e.sig){case"enter":return t=Message.messageListController.get("isJunk"),this.setPath("page.toolbar.junk",t),CK.Statechart.handled();case"setJunk":return t=Message.messageListController.get("isJunk"),n=Message.setMessageFlag(CoreMail.MESSAGE_FLAG_JUNK,!t),CK.Statechart.handled();case"deleteMessage":return MessageList.deleteSelectedMessages(),CK.Statechart.handled();case"archiveMessage":return MessageList.archiveSelectedMessages(),CK.Statechart.handled();case"moveToFolder":return this.getPath("page.toolbar.leftWrapper.moveToFolder").action(),CK.Statechart.handled();case"flagMessage":return MessageList.flagSelectedMessages(),CK.Statechart.handled()}}.state("1.2 Main Toolbar"),"1.2.2.1 Single Message Selected":function(e){var t;switch(e.sig){case"selectMultipleMessage":return this[this.stateKey]="1.2.2.2 Multiple Message Selected",CK.Statechart.EVT_TRANSITION_RES;case"reply":return CoreMail.incrementUserStat(CoreMail.STAT_REPLY_REPLY_ALL),t=this.getGuidOfSelectedMessage(),t&&Global.openMessage(CoreMail.MESSAGE_MODE_REPLY,t,""),CK.Statechart
.handled();case"replyAll":return CoreMail.incrementUserStat(CoreMail.STAT_REPLY_REPLY_ALL),t=this.getGuidOfSelectedMessage(),t&&Global.openMessage(CoreMail.MESSAGE_MODE_REPLY_ALL,t,""),CK.Statechart.handled();case"forward":return t=this.getGuidOfSelectedMessage(),t&&Global.openMessage(CoreMail.MESSAGE_MODE_FORWARD,t,ViewMessage.page.getPath("messageScrollView.contentView.expandedHeader.longHeaderContainerView.isVisible")),CK.Statechart.handled();case"forwardAsAttachment":var n=Message.messageController.get("size");return n<=CoreMail.MAX_IMAP_BASE64_ATTACHMENT_SIZE?(t=this.getGuidOfSelectedMessage(),t&&Global.openMessage(CoreMail.MESSAGE_MODE_FORWARD_AS_ATTACHMENT,t)):CoreMail.errorHandler.handleError({keyString:"MessageView.ForwardAsAttachment.MessageTooLarge"}),CK.Statechart.handled()}}.state("1.2.2 Message Selected"),"1.2.2.2 Multiple Message Selected":function(e){switch(e.sig){case"selectSingleMessage":return this[this.stateKey]="1.2.2.1 Single Message Selected",CK.Statechart.EVT_TRANSITION_RES}}.state("1.2.2 Message Selected"),showToolBar:function(){},selectSingleMessage:function(){},selectMultipleMessage:function(){},deleteMessage:function(){},archiveMessage:function(){},setJunk:function(){},compose:function(){},reply:function(){},replyAll:function(){},forward:function(){},forwardAsAttachment:function(){}}),SC.mixin(MainToolbar,{configure:function(e){var t=this.getPath("page.toolbar"),n=e.get("parentView");if(!n)throw"bad API call; view does not have a parent view";n.replaceChild(t,e)},showMoveToFolderMenu:function(){this.dispatch({sig:"moveToFolder"})}}),SC.mixin(MainToolbar
,{_replyMenuButton:null,_replyMenu:null,getGuidOfSelectedMessage:function(){var e=Message.messageController.get("content");if(e)return e.get("guid")}}),MainToolbar.DockRightView=SC.View.extend({layout:{left:0,right:0,height:44,centerY:0},selection:null,childViews:"accountMenu leftWrapper".w(),leftWrapper:SC.View.design({layout:{left:0,top:2,bottom:0,width:300},classNames:["left-wrapper"],childViews:"reply flag trash archive moveToFolder compose".w(),isVisibleBinding:SC.binding("Global.isVIPWelcomePageVisible").not(),reply:CW.PopupButtonView.design(Global.ToolbarButtonMixin,{classNames:["n-m-w"],layout:{left:15,top:0,width:42,height:42},themeName:"borderless",icon:"reply",layerId:"toolbar-reply-menu",selection:null,selectionBinding:".owner.owner.selection",toolTip:"_Toolbar.Message.ReplyAllAndForwardingOptions".loc(),isEnabled:function(){var e=this.get("selection");return!e||e.get("length")===0?!1:!e||e.get("length")!==1?!1:!0}.property("selection").cacheable(),menu:function(){return Global.get("isQuickReplyEnabled")===NO?this.page.get("replyMenu"):ReplyMenu.getReplyMenuPane()}.property(),_setOptions:function(){var e=this.get("selection"),t=NO,n=NO,r=NO,i=0,s=MessageList.folderController?MessageList.folderController.get("role"):null;if(e){i=e.get("length");if(i===1){t=YES,r=YES;var o=0,u=0,a=e.firstObject().get("to"),f=e.firstObject().get("cc");a&&(o=a.get("length")),f&&(u=f.get("length"));var l=o+u;if(s!==CoreMail.FOLDER_ROLE_DRAFTS){n=l>1?YES:NO;if(l===1){var c=CoreMail.get("userEmailAddresses");if(o>0){var h=a[0],p=CK.tokensParser.parseEmailAddress(h),d;p&&(d=p.get("emailId"
)),d&&(p=d.toLowerCase(),Global.validateEmail(p)?n=CoreMail.isEmailInUserAccount(p,c)?NO:YES:n=NO)}else u>0&&(n=CoreMail.isEmailInUserAccount(f[0],c)?NO:YES)}}else n=NO,r=NO}}if(Global.get("isQuickReplyEnabled")===NO){var v=[];v.push({title:"_Menu.Reply".loc(),isEnabled:r,target:MainToolbar,action:"reply",disableMenuFlash:YES}),v.push({title:"_Menu.ReplyAll".loc(),isEnabled:n,target:MainToolbar,action:"replyAll",disableMenuFlash:YES}),v.push({title:"_Menu.Forward".loc(),isEnabled:t,target:MainToolbar,action:"forward",disableMenuFlash:YES}),v.push({title:"_Menu.ForwardAsAttachment".loc(),target:MainToolbar,action:"forwardAsAttachment",disableMenuFlash:YES}),this.setPath("menu.items",v)}else ReplyMenu.set("isReplyAllEnabled",n),ReplyMenu.set("isReplyEnabled",r),ReplyMenu.set("isForwardEnabled",t)},showMenu:function(){SC.warn("reply action fired"),Global.get("isQuickReplyEnabled")===YES?(ReplyMenu.getReplyMenuPane()._menuView.childViews[0].get("quickReplyText").becomeFirstResponder(),ReplyMenu.dispatch({sig:"showReplyMenu",isViewMessage:NO})):this._setOptions(),arguments.callee.base.apply(this,arguments)}}),flag:CW.PopupButtonView.design(Global.ToolbarButtonMixin,{classNames:["n-m-w"],layout:{left:70,top:0,width:42,height:42},themeName:"borderless",icon:"flag",layerId:"toolbar-flag",toolTip:"_Toolbar.Message.Flag".loc(),selectionBinding:SC.binding(".owner.owner.selection").oneWay(),isEnabled:function(){var e=this.get("selection");return!e||e.get("length")===0?!1:!0}.property("selection").cacheable(),menu:function(){return FlagMenu.getFlagMenuPane()}.property().cacheable(),showMenu
:function(){CoreMail.errorHandler.recordStat("_STAT_FLAG_BUTTON_CLICKED_MAIL"),FlagMenu.statechart.sendEvent("openFlagMenu"),arguments.callee.base.apply(this,arguments)}}),trash:SC.ButtonView.design(Global.ToolbarButtonMixin,{classNames:["n-m-w"],layout:{left:131,top:0,width:42,height:42},themeName:"borderless",icon:"trash",layerId:"toolbar-trash",toolTip:"_Toolbar.Message.MoveToTrash".loc(),selectionBinding:SC.binding(".owner.owner.selection").oneWay(),isVisibleBinding:SC.Binding.not("CoreMail.serverPreferences.displayArchiveInseadOfTrash"),isEnabled:function(){var e=this.get("selection");return!e||e.get("length")===0?!1:!0}.property("selection").cacheable(),action:function(){MainToolbar.dispatch({sig:"deleteMessage"})}}),archive:SC.ButtonView.design(Global.ToolbarButtonMixin,{classNames:["n-m-w"],layout:{left:131,top:0,width:42,height:42},themeName:"borderless",icon:"archive",layerId:"toolbar-archive",toolTip:"_Toolbar.Message.Archive".loc(),selectionBinding:SC.binding(".owner.owner.selection").oneWay(),isVisibleBinding:"CoreMail.serverPreferences.displayArchiveInseadOfTrash",isEnabled:function(){var e=this.get("selection");return!e||e.get("length")===0||CoreMail.ARCHIVE_GUID===e.getPath("firstObject.folder.guid")?NO:YES}.property("selection").cacheable(),action:function(){MainToolbar.dispatch({sig:"archiveMessage"})}}),moveToFolder:CW.PopupButtonView.design(Global.ToolbarButtonMixin,{layout:{left:192,top:0,width:42,height:42},classNames:["n-m-w"],themeName:"borderless",icon:"move-to-folder",layerId:"toolbar-move-to-folder",toolTip:"_Toolbar.Message.MoveToFolder".loc(),selectionBinding
:SC.binding(".owner.owner.selection").oneWay(),menu:function(){return MoveToFolder.getMoveToFolderMenu()}.property().cacheable(),isEnabled:function(){var e=this.get("selection");return!e||e.get("length")===0?!1:!0}.property("selection").cacheable()}),compose:SC.ButtonView.design(Global.ToolbarButtonMixin,{classNames:["n-m-w"],layout:{left:255,top:0,width:42,height:42},themeName:"borderless",icon:"compose",layerId:"toolbar-compose",toolTip:function(){return SC.browser.isMac?"_Toolbar.Message.Compose.Mac".loc():"_Toolbar.Message.Compose.Windows".loc()}(),isEnabled:YES,action:function(e){e.clickCount===1&&MainToolbar.dispatch({sig:"compose"})}})}),accountMenu:CK.AccountMenuView.design({}),viewDidResize:function(){arguments.callee.base.apply(this,arguments);var e=this.get("accountMenu"),t=this.getPath("frame.width"),n=this.getPath("leftWrapper.layout.width"),r=t-n,i=e.get("preferredWidth"),s;r>=i?s=i:s=r,e.adjust("width",s)}}),MainToolbar.page=SC.Page.design({toolbar:MainToolbar.DockRightView.extend({selection:null,selectionBinding:"Message.messageListController.selection",target:null,targetBinding:".page.owner"}),replyMenu:CW.AutoResizingMenuPane.extend({classNames:"reply-menu".w(),controlSize:SC.LARGE_CONTROL_SIZE,items:null,isEnabled:YES,itemShortCutKey:"shortCut",itemKeyEquivalentKey:"keyEquivalent",itemActionKey:"action",contentView:SC.View.extend({layout:{top:0,left:0,bottom:0,right:0}})})});var ActionMenu=SC.Object.create({messageListController:null,selection:null,messageListControllerDidChange:function(){this.bind("selection",".messageListController.selection")}.observes
("messageListController"),actionMenuPane:null,initStatechart:function(){arguments.callee.base.apply(this,arguments)},initial:"1.1.1 Action Menu Closed","1.1.1 Action Menu Closed":function(e){switch(e.sig){case"showActionMenu":return this[this.stateKey]="1.1.2 Action Menu Open",CK.Statechart.EVT_TRANSITION_RES}}.state(),"1.1.2 Action Menu Open":function(e){switch(e.sig){case"enter":var t=ActionMenu.actionMenuController,n=ViewMessage.getPath("page.messageScrollView.contentView"),r=n.getPath("expandedHeader.isVisible"),i=n.getPath("expandedHeader.longHeaderContainerView.isVisible"),s=this.get("selection"),o=NO;return s&&s.get("length")===1&&(o=YES),t.set("isSingleSelection",o),t.set("titleForLongHeader",i===YES&&r===YES?"_MessageView.HideLongHeaders".loc():"_MessageView.ShowLongHeaders".loc()),CK.Statechart.handled();case"exit":return CK.Statechart.handled();case"defaultTransition":var u=this.getPath("selection.length");switch(u){case 0:case undefined:return this[this.stateKey]="1.1.2.1 No Messages Selected",CK.Statechart.EVT_TRANSITION_RES;case 1:return this[this.stateKey]="1.1.2.2.1 One Message Selected",CK.Statechart.EVT_TRANSITION_RES;default:return this[this.stateKey]="1.1.2.2.2 Multiple Messages Selected",CK.Statechart.EVT_TRANSITION_RES}return CK.Statechart.handled();case"propertyChanged":if(NO===this.page.getPath("actionMenuPane.isPaneAttached"))return this[this.stateKey]="1.1.1 Action Menu Closed",CK.Statechart.EVT_TRANSITION_RES;return CK.Statechart.handled();case"deleteFolder":return FolderList.deleteSelectedFolder(),CK.Statechart.handled();case"createRule":return window
.Preferences?Preferences.configure("showActionRules"):SC.Module.loadModule("preferences","Preferences","configureWrapper","showActionRules"),CK.Statechart.handled();case"openPreferences":return Global.openPreferences(),CK.Statechart.handled()}}.state("1.1.1 Action Menu Closed"),"1.1.2.1 No Messages Selected":function(e){switch(e.sig){case"enter":return CK.Statechart.handled()}}.state("1.1.2 Action Menu Open"),"1.1.2.2 Messages Selected":function(e){switch(e.sig){case"enter":return CK.Statechart.handled();case"exit":return this.page.get("actionMenuPane").notifyPropertyChange("selection"),CK.Statechart.handled()}}.state("1.1.2 Action Menu Open"),"1.1.2.2.1 One Message Selected":function(e){var t=this._getSelectedMessage();switch(e.sig){case"enter":return CK.Statechart.handled();case"printMessage":return t&&Global.printSelectedMessage(),CK.Statechart.handled();case"showHideLongHeaders":return ViewMessage.showOrHideLongHeader(),CK.Statechart.handled();case"downloadMessage":return Global.downloadMessage(),CK.Statechart.handled()}}.state("1.1.2.2 Messages Selected"),"1.1.2.2.2 Multiple Messages Selected":function(e){switch(e.sig){case"enter":return CK.Statechart.handled()}}.state("1.1.2.2 Messages Selected"),showActionMenu:function(){},closeActionMenu:function(){},deleteFolder:function(){},createRule:function(){},openPreferences:function(){},printMessage:function(){},showHideLongHeaders:function(){},downloadMessage:function(){}});ActionMenu.actionMenuController=SC.ObjectController.create({isSingleSelection:NO,titleForLongHeader:null,isDeleteFolderEnabled:NO,isDeleteFolderEnabledBinding
:"FolderList.foldersTreeController*selection.firstObject.canDelete"}),SC.mixin(ActionMenu,{showActionMenu:function(e){if(!e)throw SC.$error("Bad API call to ActionMenu.showActionMenu()");this.dispatch({sig:"showActionMenu"}),this.page.get("actionMenuPane").popup(e)},configure:function(e,t){this.set("messageListController",e),this.setPath("page.actionMenuPane.isForViewMessage",t),t?this.getPath("page.actionMenuPane").adjust("width",ActionMenu.metrics.CHILD_WINDOW_MENU_WIDTH):this.getPath("page.actionMenuPane").adjust("width",ActionMenu.metrics.MAIN_WINDOW_MENU_WIDTH)},getActionMenuPane:function(){return this.getPath("page.actionMenuPane")}}),SC.mixin(ActionMenu,{_getSelectedMessage:function(){var e=this.messageListController.get("selection");if(e){if(SC.typeOf(e)===SC.T_ARRAY)return e[0];if(SC.typeOf(e)===SC.T_OBJECT&&e.kindOf(SC.SelectionSet))return e.firstObject()}}}),ActionMenu.metrics=SC.Object.create({MAIN_WINDOW_MENU_WIDTH:162,CHILD_WINDOW_MENU_WIDTH:138,MENU_POINTER_RIGHT_OFFSET:10}),ActionMenu.ActionMenuPane=CW.AutoResizingMenuPane.extend({classNames:["action-menu"],localize:YES,controlSize:SC.LARGE_CONTROL_SIZE,itemIsEnabledKey:"isEnabled",itemTitleKey:"title",itemIconKey:"icon",itemTargetKey:"target",itemActionKey:"action",itemSeparatorKey:"separator",itemShortCutKey:"shortCut",itemKeyEquivalentKey:"keyEquivalent",itemLayerIdKey:"layerId",contentView:SC.View.extend({layout:{top:0,left:0,bottom:0,right:0}}),isForViewMessage:null,isForViewMessageDidChange:function(){this._itemsArray=null,this.notifyPropertyChange("items")}.observes("isForViewMessage"),items:function()
{if(!this._itemsArray){this._itemsArray=[];var e=this.get("isForViewMessage");e||this._itemsArray.push(SC.Object.create({title:"_Menu.Preferences",layerId:"actions-preferences",isEnabled:YES,target:ActionMenu,action:"openPreferences"}),SC.Object.create({title:"_Menu.CreateRule",layerId:"actions-rules",isEnabled:YES,target:ActionMenu,action:"createRule"}),SC.Object.create({isEnabled:YES,separator:YES})),!e&&window.FolderList&&this._itemsArray.push(SC.Object.create({title:"_Menu.DeleteFolder",isEnabled:null,isEnabledBinding:"ActionMenu.actionMenuController.isDeleteFolderEnabled",target:ActionMenu,layerId:"actions-delete-folder",action:"deleteFolder"}),SC.Object.create({title:"_Menu.EmptyTrash",isEnabled:YES,target:FolderList,layerId:"actions-empty-trash",action:"emptyTrash"})),this._itemsArray.push(SC.Object.create({title:"_Menu.PrintMessage",isEnabled:null,isEnabledBinding:"ActionMenu.actionMenuController.isSingleSelection",target:ActionMenu,layerId:"actions-print",action:"printMessage",disableMenuFlash:YES})),e&&(this._itemsArray.push(SC.Object.create({title:null,titleBinding:"ActionMenu.actionMenuController.titleForLongHeader",isEnabled:YES,target:ActionMenu,action:"showHideLongHeaders"})),this._itemsArray.push(SC.Object.create({title:"_Menu.DownloadMessage",isEnabled:YES,target:ActionMenu,action:"downloadMessage"})))}return this._itemsArray}.property()}),ActionMenu.page=SC.Page.design({actionMenuPane:ActionMenu.ActionMenuPane.design({})}),MoveToFolder=SC.Object.create({messageListController:null}),SC.mixin(MoveToFolder,{MAX_NESTED_LEVEL:4,configure:function(e){this.foldersArrayController
.set("content",e)},getMoveToFolderMenu:function(){return this.page.get("moveToFolderMenu")},moveToFolder:function(){window.WHAT_TYPE.isMailChild()?opener.CoreMail.incrementUserStat(opener.CoreMail.STAT_TB_MOVE_MSG):CoreMail.incrementUserStat(CoreMail.STAT_TB_MOVE_MSG);var e=this.page.getPath("moveToFolderMenu.selectedItem.value");if(!e)return;var t=Message.messageListController.get("selection");if(t){1===t.get("length")?(this._isEditing=YES,this._moveMessagesStatus=CoreMail.moveMessage(t.get("firstObject"),null,e),this._moveMessagesStatus.get("state")===this._moveMessagesStatus.STATE_ERROR&&this._moveMessagesStatus.errorCode===CoreMail.ERROR_MESSAGE_NOT_FOUND&&this.invokeLater(function(){ViewMessage.dispatch({sig:"noContent"})})):this._moveMessagesStatus=CoreMail.moveMessage(t,Message.messageListController.get("arrangedObjects"),e);var n=this._moveMessagesStatus;this._moveMessagesStatusObserver=function(){switch(n.get("state")){case n.STATE_SUCCESS:try{window.WHAT_TYPE.isMailChild()?opener.FolderList.foldersArrayController.notifyPropertyChange("[]"):FolderList.foldersArrayController.notifyPropertyChange("[]")}catch(e){SC.error(e)}n.removeObserver("state",this,this._moveMessagesStatusObserver);break;case n.STATE_ERROR:n.removeObserver("state",this,this._moveMessagesStatusObserver),CoreMail.errorHandler.handleError({keyString:"FolderList.MoveMessages.ServerError"})}},n.addObserver("state",this,this._moveMessagesStatusObserver)}},createNestedMenuItems:function(e){if(e)return this._getNestedItemsBasedOnLevels(e)},getCurrentFolder:function(){if(!this.messageListController)return null
;var e;return this.messageListController instanceof SC.ArrayController?e=this.messageListController.getPath("content.firstObject.folder"):e=this.messageListController.getPath("content.folder"),e},destroyMoveMessagesStatusObserver:function(){this._moveMessagesStatus&&(this._moveMessagesStatus.removeObserver("state",this,this._moveMessagesStatusObserver),this._moveMessagesStatus=null)}}),MoveToFolder.foldersArrayController=SC.ArrayController.create({content:null,moveToFolderItems:null,source:function(){var e=this.get("content");return e?(e=e.filterProperty("parent",null).sortProperty("sortOrder","name"),e):null}.property("[]").cacheable(),sourceItems:null,sourceItemsBinding:".source",sourceItemsDidChange:function(){YES===CoreMail.get("isResyncFolderListInProgress")||YES===CoreMail.get("isResyncMessageListInProgress")?this.sourceItemsDidChange.invokeLater(this,2e3):this.set("moveToFolderItems",MoveToFolder.createNestedMenuItems(this.get("sourceItems")))}.observes("sourceItems")}),SC.mixin(MoveToFolder,{_getNestedItemsBasedOnLevels:function(e){var t=[],n,r,i,s,o=[],u=[],a=[],f=e,l=e.get("length"),c=0,h=1;while(c<=l){if(c===l){h=o.pop(),c=u.pop(),f=a.pop();if(!f)break;l=f.get("length");continue}n=f.objectAt(c),r=n.get("role"),s=h>this.MAX_NESTED_LEVEL?this.MAX_NESTED_LEVEL:h,t.push(SC.Object.create({icon:n.get("icon")+" level-"+s,role:r,value:n.get("guid"),title:n.get("displayName"),isEnabled:r===CoreMail.FOLDER_ROLE_VIP&&n.get("parent")===null||r===CoreMail.FOLDER_ROLE_GHOST?NO:YES})),c++,i=n.get("children"),i&&i.get("length")>0&&(o.push(h),u.push(c),a.push(f),h+=1,c=0,f=i,l=i.get
("length"))}return t}}),MoveToFolder.metrics=SC.Object.create({MOVE_TO_FOLDER_MENU_WIDTH:190}),MoveToFolder.MoveToFolderMenuPane=CW.MenuPane.extend({classNames:["cw-menu","move-to-folder"],preferType:SC.PICKER_MENU_POINTER,pointerOffset:[9,-9,-12,3],desiredSize:{width:MoveToFolder.metrics.MOVE_TO_FOLDER_MENU_WIDTH},localize:YES,controlSize:SC.LARGE_CONTROL_SIZE,itemIsEnabledKey:"isEnabled",itemTitleKey:"title",itemIconKey:"icon",itemValueKey:"value",itemTargetKey:"target",itemActionKey:"action",contentView:SC.View.extend({layout:{top:0,left:0,bottom:0,right:0}}),content:null,messageContent:null,target:"MoveToFolder",action:"moveToFolder",selFolderGuid:null,messageContentDidChange:function(){var e=this.get("selFolderGuid"),t=this.getPath("messageContent.firstObject.folder.guid");t!==e&&this.set("selFolderGuid",t)}.observes("messageContent"),isJunkingEnabled:null,isJunkingEnabledBinding:"Message.messageListController.isJunkingEnabled",items:function(){var e=[];e.push({title:"_MoveToFolder.Title",isEnabled:NO}),e.push({isEnabled:YES,separator:YES});var t=this.get("content");if(!t)return e;var n=this.get("selFolderGuid"),r=this.get("isJunkingEnabled"),i=t.get("length"),s,o;for(var u=0;u<i;u++){s=t.objectAt(u);if(s.get("role")===CoreMail.FOLDER_ROLE_VIP)continue;o=SC.Object.create({icon:s.get("icon"),role:s.get("role"),value:s.get("value"),title:s.get("title"),isEnabled:s.get("isEnabled")}),o.get("value")===n?o.set("isEnabled",NO):o.get("role")===CoreMail.FOLDER_ROLE_JUNK&&o.set("isEnabled",r),e.push(o)}return e}.property("content").cacheable(),selFolderGuidDidChange:function(){var e=
this.get("selFolderGuid"),t=this.get("isJunkingEnabled"),n,r,i=this.get("items"),s=i.get("length");for(var o=2;o<s;o++)n=i.objectAt(o),r=n.get("role"),n.get("value")===e||r===CoreMail.FOLDER_ROLE_GHOST?n.set("isEnabled",NO):r===CoreMail.FOLDER_ROLE_JUNK?n.set("isEnabled",t):n.set("isEnabled",YES)}.observes("selFolderGuid","isJunkingEnabled")}),MoveToFolder.page=SC.Page.design({moveToFolderMenu:MoveToFolder.MoveToFolderMenuPane.design({contentBinding:"MoveToFolder.foldersArrayController.moveToFolderItems",messageContent:null,messageContentBinding:"Message.messageListController.content"})}),window.FlagMenu=SC.Object.create({}),FlagMenu.flagMenuController=SC.ObjectController.create({titleForMarkAsReadUnread:null,titleForMarkAsFlaggedUnflagged:null,titleForMarkAsJunk:null,isJunkingEnabled:NO,shouldShowJunkOption:null,shouldShowJunkOptionBinding:SC.binding("Message.messageListController.isJunk").not(),_menuItems:[{titleBinding:"FlagMenu.flagMenuController.titleForMarkAsFlaggedUnflagged",action:"markAsFlaggedUnflagged"},{titleBinding:"FlagMenu.flagMenuController.titleForMarkAsReadUnread",action:"markAsReadUnread"},{titleBinding:"FlagMenu.flagMenuController.titleForMarkAsJunk",action:"markAsJunk",isEnabledBinding:"FlagMenu.flagMenuController.isJunkingEnabled"}],menuItems:function(){var e=this._menuItems;return this.get("shouldShowJunkOption")===NO&&(e=e.slice(0,2)),e}.property("shouldShowJunkOption").cacheable()}),SC.mixin(FlagMenu,{getFlagMenuPane:function(){return this.page.get("flagMenuPane")},configure:function(){FlagMenu.statechart.initStatechart()}}),FlagMenu.FlagMenuPane=CW.
AutoResizingMenuPane.extend({localize:YES,controlSize:SC.LARGE_CONTROL_SIZE,target:"FlagMenu.statechart",isEnabled:YES,itemActionKey:"action",itemTargetKey:"target",contentView:SC.View.extend({layout:{top:0,left:0,bottom:0,right:0}}),itemsBinding:"FlagMenu.flagMenuController.menuItems",modalPaneDidClick:function(){FlagMenu.statechart.sendEvent("resignFlagMenu"),arguments.callee.base.apply(this,arguments)}}),FlagMenu.page=SC.Page.design({flagMenuPane:FlagMenu.FlagMenuPane.design({})}),FlagMenu.statechart=SC.Statechart.create({rootState:SC.State.design({initialSubstate:"flagMenuClosed",flagMenuClosed:SC.State.design({openFlagMenu:function(){this.gotoState("flagMenuOpen")}}),flagMenuOpen:SC.State.design({enterState:function(){var e=FlagMenu.flagMenuController,t=Message.get("unreadMessageSelected"),n=Message.get("flaggedMessageSelected"),r=Message.messageListController.get("isJunkingEnabled");e.set("isJunkingEnabled",r),e.set("titleForMarkAsReadUnread",t?"_FlagMenu.Read".loc():"_FlagMenu.Unread".loc()),e.set("titleForMarkAsFlaggedUnflagged",n?"_FlagMenu.Unflagged".loc():"_FlagMenu.Flagged".loc()),e.set("titleForMarkAsJunk","_FlagMenu.JunkMail".loc())},markAsReadUnread:function(){var e=YES;Message.get("unreadMessageSelected")&&(e=NO),Message.setMessageFlag(CoreMail.MESSAGE_FLAG_UNREAD,e),this.gotoState("flagMenuClosed")},markAsFlaggedUnflagged:function(){var e=YES;Message.get("flaggedMessageSelected")&&(e=NO),Message.setMessageFlag(CoreMail.MESSAGE_FLAGGED,e),this.gotoState("flagMenuClosed")},markAsJunk:function(){var e=YES;Message.get("junkMessageSelected")&&(e=NO),Message.setMessageFlag
(CoreMail.MESSAGE_FLAG_JUNK,e),this.gotoState("flagMenuClosed")},resignFlagMenu:function(){this.gotoState("flagMenuClosed")}})})});var ViewMessage=SC.Object.create({initial:"6.2 pop up View",isPreview:NO,msgSubject:null,date:null,"6 parent state":function(e){switch(e.sig){case"configureViewMessage":return this[this.stateKey]="6.2 pop up View",CK.Statechart.EVT_TRANSITION_RES}}.state(),"6.2 pop up View":function(e){switch(e.sig){case"enter":return this.setPath("page.messageScrollView.isVisible",NO),CK.Statechart.handled();case"exit":return this._appMainPane&&this._appMainPane.removeAllChildren(),CK.Statechart.handled();case"loadMessage":SC.Benchmark.start("perfOpenEmailPreview"),this._appMainPane&&this._appMainPane.childViews.length===0?this._appMainPane.appendChild(this.getPath("page.spinnerView")):(this._setMessageDetailVisibility(NO),this.isPreview?this.setPath("page.spinnerView.isVisible",YES):this.setPath("page.spinnerView.isVisible",NO));var t=Message.messageController.get("content");if(!t)return SC.warn("Message content is null"),this[this.stateKey]="6.2.2 No Content",CK.Statechart.EVT_TRANSITION_RES;var n=t.get("subject"),r=t.get("messageDetail");n===null&&(n="");if(r){var i=this.page;return Message.messageDetailController.set("content",r),i.set("bodyMessage",r.get("body")),i.set("content",r),this.set("msgSubject",n),this.set("date",t.get("date")),this[this.stateKey]="6.2.1.1 View Message",CK.Statechart.EVT_TRANSITION_RES}return this[this.stateKey]="6.2.1 Loading",CK.Statechart.EVT_TRANSITION_RES;case"noContent":return this[this.stateKey]="6.2.2 No Content",CK.Statechart
.EVT_TRANSITION_RES}}.state("6 parent state"),"6.2.1 Loading":function(e){var t,n,r;switch(e.sig){case"enter":this._appMainPane.removeAllChildren(),this._appMainPane.appendChild(this.getPath("page.spinnerView")),this.isPreview&&this.setPath("page.spinnerView.isVisible",YES),this._appMainPane.appendChild(this.getPath("page.messageScrollView")),this._appMainPane.appendChild(this.getPath("page.moreHideView"));if(this._appMainPane&&this._appMainPane.childViews){this.isPreview===NO?this._appMainPane.appendChild(this.getPath("page.toolbar")):SC.browser.isWebkit||this._appMainPane.appendChild(this.getPath("page.gutterView")),this._appMainPane.appendChild(this.getPath("page.loadImagesView")),this._appMainPane.appendChild(this.getPath("page.junkView")),this._appMainPane.appendChild(this.getPath("page.suspiciousMessageBannerView")),this._appMainPane.appendChild(this.getPath("page.listUnsubscribeBannerView")),this._setMessageDetailVisibility(NO);var i=this.getPath("page.junkView.junkShow.rightView");i&&(i.setPath("spinnerView.isVisible",NO),i.setPath("notJunkButton.isEnabled",YES))}return r=Message.messageController.get("content"),this._messageStatus=CoreMail.getMessageDetail(r.get("guid")),n=this._messageStatus,n.get("state")!==n.STATE_PENDING&&this.invokeLater(function(){this.dispatch({sig:"propertyChanged"})}),this._statusObserver=n.addStatechartObserver("state",this),CK.Statechart.handled();case"exit":if(this._messageStatus&&this._statusObserver)this._messageStatus.removeStatechartObserver("state",this,this._statusObserver),this._messageStatus=null,this._statusObserver=null;else{var s='ViewMessage."6.2.1 Loading" : this._messageStatus is '+
this.get("_messageStatus");CoreMail.errorHandler.logErrorTrap(s)}return CK.Statechart.handled();case"propertyChanged":n=this._messageStatus;switch(n.get("state")){case n.STATE_SUCCESS:t=n.get("requestData").record,r=Message.messageController.get("content"),this._setMessageDetailVisibility(YES),this.setPath("page.spinnerView.isVisible",NO),t&&this.invokeLast(function(){this.page.set("content",t),this.toController.set("content",t.get("to")),this.ccController.set("content",t.get("cc")),this.bccController.set("content",t.get("bcc")),this.replyToController.set("content",t.get("replyTo")),this.setEmailAddressList(),window.WHAT_TYPE.isMailChild()===YES&&opener&&MailMessage.get("isRelatedMessage")&&this.loadMessageDetailToMainStore(t)});var o=r.get("subject");return o===null&&(o=""),this.set("msgSubject",o),this.set("date",r.get("date")),SC.RunLoop.end(),SC.RunLoop.begin(),Message.messageDetailController.set("content",t),r.set("messageDetail",t),this[this.stateKey]="6.2.1.1 View Message",CK.Statechart.EVT_TRANSITION_RES;case n.STATE_ERROR:return CoreMail.errorHandler.handleError({keyString:"ViewMessage.Load.ServerError"}),this[this.stateKey]="6.2.2 No Content",CK.Statechart.EVT_TRANSITION_RES}return CK.Statechart.handled()}}.state("6.2 pop up View"),"6.2.2 No Content":function(e){switch(e.sig){case"enter":this._appMainPane.removeAllChildren();var t=this.get("isPreview");return t===YES?this._appMainPane.appendChild(this.getPath("page.multiSelectionActions")):MailMessage.closeMailMessageApp(),CK.Statechart.handled();case"markAsReadUnread":return Message.setMessageFlag(CoreMail.MESSAGE_FLAG_UNREAD
,!Message.get("unreadMessageSelected")),CK.Statechart.handled();case"markAsFlaggedUnflagged":return Message.setMessageFlag(CoreMail.MESSAGE_FLAGGED,!Message.get("flaggedMessageSelected")),CK.Statechart.handled();case"markAsJunkNotJunk":return Message.setMessageFlag(CoreMail.MESSAGE_FLAG_JUNK,!Message.get("junkMessageSelected")),CK.Statechart.handled();case"exit":return CK.Statechart.handled()}}.state("6.2 pop up View"),"6.2.1.1 View Message":function(e){var t,n=Message.messageController;switch(e.sig){case"enter":this._clearMessageBodySelection(),this.setPath("page.spinnerView.isVisible",NO),this._setMessageDetailVisibility(YES),this.setPath("page.messageScrollView.verticalScrollOffset",0),this.setPath("page.messageScrollView.horizontalScrollOffset",0);if(window.getSelection){var r=window.getSelection();r&&r.removeAllRanges&&r.removeAllRanges()}if(!this.isPreview){var i=n.get("subject");i?window.document.title="_PageTitle.ViewMessage.Subject".loc(i):window.document.title="_PageTitle.ViewMessage.NoSubject".loc()}return this.invokeLast(function(){var e=Message.messageDetailController.get("content");this.toController.set("content",e.get("to")),this.ccController.set("content",e.get("cc")),this.bccController.set("content",e.get("bcc")),this.replyToController.set("content",e.get("replyTo")),this.setEmailAddressList()}),t=n.get("junk"),NO===ViewMessage.get("isPreview")&&(this._prevJunkStatus=t,this._junkStatusObserver=n.addStatechartObserver("junk",this)),SC.Benchmark.end("perfOpenEmailPreview"),CK.Statechart.handled();case"exit":return this._destroyStatechartObservers(),this._isShowingMovingToInbox=!1
,CK.Statechart.handled();case"defaultTransition":var s=CoreMail.timeZoneConverter.get("currentDate"),o=s.getMinutes(),u=s.getSeconds(),a=((59-o)*60+(60-u))*1e3;return this.timerSchedule=SC.Timer.schedule({target:this.getPath("page.messageScrollView.contentView.collapsedHeader"),action:"setLayerNeedsUpdate",repeats:NO,interval:a}),CK.Statechart.handled();case"delete":return this._deleteRequest=CoreMail.deleteMessage(n.get("content")),this._deleteRequest.get("state")!==this._deleteRequest.STATE_PENDING&&this.invokeLater(function(){this.dispatch({sig:"propertyChanged",target:this._deleteRequest,key:"state"})}),this._deleteResponseObserver=this._deleteRequest.addStatechartObserver("state",this),CK.Statechart.handled();case"showJunkPane":return Message.setMessageFlag(CoreMail.MESSAGE_FLAG_JUNK,!1),ViewMessage.setPath("page.bodyMessage",Message.messageDetailController.getPath("content.body")),CK.Statechart.handled();case"archive":return this._archiveRequest=CoreMail.archiveMessage(Message.getPath("messageController.content")),this._archiveRequest.get("state")!==this._archiveRequest.STATE_PENDING&&this.invokeLater(function(){this.dispatch({sig:"propertyChanged",target:this._archiveRequest,key:"state"})}),this._archiveResponseObserver=this._archiveRequest.addStatechartObserver("state",this),CK.Statechart.handled();case"setJunk":var f=Message.messageListController.get("isJunk"),l=this.getPath("page.junkView.junkShow.rightView");return this._isShowingMovingToInbox||f===!1||n.getPath("folder.role")===CoreMail.FOLDER_ROLE_INBOX?(this._setFlagRequest=Message.setMessageFlag(CoreMail.MESSAGE_FLAG_JUNK
,!f),this._setFlagResponseObserver=this._setFlagRequest.addStatechartObserver("state",this)):(l.setPath("spinnerView.isVisible",YES),l.setPath("notJunkButton.isEnabled",NO),this._isShowingMovingToInbox=!0,this.invokeLater(function(){this.dispatch({sig:"setJunk"})},1e3)),CK.Statechart.handled();case"setUnread":var c=YES;return Message.messageListController.get("isUnread")&&(c=NO),Message.setMessageFlag(CoreMail.MESSAGE_FLAG_UNREAD,c),CK.Statechart.handled();case"setFlag":var h=YES;return Message.messageListController.get("isFlagged")&&(h=NO),Message.setMessageFlag(CoreMail.MESSAGE_FLAGGED,h),CK.Statechart.handled();case"reply":return this.switchToComposeMode(CoreMail.MESSAGE_MODE_REPLY),CK.Statechart.handled();case"replyAll":return this.switchToComposeMode(CoreMail.MESSAGE_MODE_REPLY_ALL),CK.Statechart.handled();case"forward":var p=ViewMessage.page.getPath("messageView.expandedHeader.longHeaderContainerView.isVisible");return this.switchToComposeMode(CoreMail.MESSAGE_MODE_FORWARD,p),CK.Statechart.handled();case"forwardAsAttachment":var d=n.get("size");return d<=CoreMail.MAX_IMAP_BASE64_ATTACHMENT_SIZE?this.switchToComposeMode(CoreMail.MESSAGE_MODE_FORWARD_AS_ATTACHMENT):CoreMail.errorHandler.handleError({keyString:"MessageView.ForwardAsAttachment.MessageTooLarge"}),CK.Statechart.handled();case"showContactPicker":var v=e.firstName,m=e.lastName;if(!e.firstName||!e.lastName)e.firstName||(v=""),e.lastName||(m="");var g={firstName:v,lastName:m,emailId:e.email,anchor:e.anchor};return Contacts.showContactsPicker(g),CK.Statechart.handled();case"showImportContactPicker":var y={anchor:
e.anchor,target:e.targetUrl,importFileName:e.fileName};return Contacts.showImportContactsPicker(y),CK.Statechart.handled();case"ctrl_p":return Global.printSelectedMessage(),CK.Statechart.handled();case"ignoreListUnsubscribe":return CoreMail.listUnsubscribe(e.listUnsubscribeKey,CoreMail.MESSAGE_LIST_UNSUBSCRIBE_STATUS_IGNORED),CK.Statechart.handled();case"acceptListUnsubscribe":var b=this._acceptListUnsubStatus=CoreMail.sendMessage(e.from,e.to,null,null,e.subject,e.textBody,e.htmlBody,null,null,null,null,null);return this._listUnsubscribeKey=e.listUnsubscribeKey,this._statusObserver=b.addStatechartObserver("state",this),CK.Statechart.handled();case"exit":return this._acceptListUnsubStatus&&this._statusObserver&&(this._acceptListUnsubStatus.removeStatechartObserver("state",this,this._statusObserver),this._acceptListUnsubStatus=null,this._statusObserver=null),this.get("isPreview")&&this.timerSchedule.invalidate(),CK.Statechart.handled();case"propertyChanged":if(this._deleteRequest&&e.target===this._deleteRequest&&e.key==="state"){switch(this._deleteRequest.get("state")){case this._deleteRequest.STATE_SUCCESS:this.invokeLater(function(){this.dispatch({sig:"noContent"})});break;case this._deleteRequest.STATE_ERROR:this._deleteRequest.errorCode===CoreMail.ERROR_MESSAGE_NOT_FOUND?this.invokeLater(function(){this.dispatch({sig:"noContent"})}):CoreMail.errorHandler.handleError({keyString:"MessageList.UnableToDeleteMessage.ServerError"})}return CK.Statechart.handled()}if(this._archiveRequest&&e.target===this._archiveRequest&&e.key==="state"){switch(this._archiveRequest.get("state")){case this
._archiveRequest.STATE_SUCCESS:this.invokeLater(function(){this.dispatch({sig:"noContent"})});break;case this._archiveRequest.STATE_ERROR:this._archiveRequest.errorCode===CoreMail.ERROR_MESSAGE_NOT_FOUND?this.invokeLater(function(){this.dispatch({sig:"noContent"})}):CoreMail.errorHandler.handleError({keyString:"MessageList.UnableToArchiveMessages.ServerError"})}return CK.Statechart.handled()}if(this._setFlagRequest&&e.target===this._setFlagRequest&&e.key==="state"){switch(this._setFlagRequest.get("state")){case this._setFlagRequest.STATE_SUCCESS:this.invokeLater(function(){this.dispatch({sig:"noContent"})});break;case this._setFlagRequest.STATE_ERROR:}return CK.Statechart.handled()}e.target===n&&e.key===CoreMail.MESSAGE_FLAG_JUNK&&this._prevJunkStatus!==n.get("junk")&&this.invokeLater(function(){this.dispatch({sig:"noContent"})});var w=this._acceptListUnsubStatus;if(w&&e.target===w&&e.key==="state")switch(w.get("state")){case w.STATE_SUCCESS:CoreMail.listUnsubscribe(this._listUnsubscribeKey,CoreMail.MESSAGE_LIST_UNSUBSCRIBE_STATUS_ACCEPTED);break;case w.STATE_ERROR:}return CK.Statechart.handled()}}.state("6.2.1 Loading"),loadMessage:function(){},reply:function(){},replyAll:function(){},forward:function(){},forwardAsAttachment:function(){},setUnread:function(){},setJunk:function(){},setFlag:function(){},markAsReadUnread:function(){},markAsFlaggedUnflagged:function(){},markAsJunkNotJunk:function(){}});require("core"),ViewMessage.bccController=SC.ArrayController.create({content:null}),require("core"),ViewMessage.ccController=SC.ArrayController.create({content:null}),require("core"
),ViewMessage.collapsedController=SC.ArrayController.create({content:null}),require("core"),ViewMessage.multiSelectionController=SC.ObjectController.create({titleForMarkAsReadUnread:null,titleForMarkAsFlaggedUnflagged:null,titleForMarkAsJunkNotJunk:null,segmentWidth:null,labelList:["_MessageView.MultiSelection.Button.Read".loc(),"_MessageView.MultiSelection.Button.Unread".loc(),"_MessageView.MultiSelection.Button.Unflagged".loc(),"_MessageView.MultiSelection.Button.Flagged".loc(),"_MessageView.MultiSelection.Button.NotJunk".loc(),"_MessageView.MultiSelection.Button.Junk".loc()],isUnreadDidChange:function(){var e,t=Message.messageListController.get("isUnread");t?e=this.labelList[0]:e=this.labelList[1],ViewMessage.multiSelectionController.set("titleForMarkAsReadUnread",e)}.observes("Message.messageListController.isUnread"),isFlaggedDidChange:function(){var e,t=Message.messageListController.get("isFlagged");t?e=this.labelList[2]:e=this.labelList[3],ViewMessage.multiSelectionController.set("titleForMarkAsFlaggedUnflagged",e)}.observes("Message.messageListController.isFlagged"),isJunkDidChange:function(){var e,t=Message.messageListController.get("isJunk");t?e=this.labelList[4]:e=this.labelList[5],ViewMessage.multiSelectionController.set("titleForMarkAsJunkNotJunk",e)}.observes("Message.messageListController.isJunk")}),ViewMessage.replyToController=SC.ArrayController.create({content:null}),require("core"),ViewMessage.toController=SC.ArrayController.create({content:null}),SC.mixin(ViewMessage,{UNDISCLOSED_RECIPIENTS:"undisclosed recipients: ;",configure:function(e,t){this.set("isPreview"
,t),t?this.set("page",ViewMessage.previewPage):(this.set("page",ViewMessage.page),this.set("serverPreferences",CoreMail.getServerPreferences())),this._appMainPane=e;var n=Message.messageController.get("content");n?ViewMessage.dispatch({sig:"loadMessage"}):!n&&t&&ViewMessage.dispatch({sig:"noContent"}),window.WHAT_TYPE.isMailChild()===YES&&SC.Event.add(window,"beforeunload",this,this._viewMesageChildWindowUnloadHandler)},serverPref:function(){return CoreMail.store.find(CoreMail.ServerPreferences,CoreMail.SERVER_PREFS_GUID)}.property(),replyAllCheck:function(e){var t,n,r,i,s,o=NO;if(e){r=e.getPath("to.length"),i=e.getPath("cc.length"),s=r+i,o=s>1?YES:NO;if(s===1){var u=CoreMail.get("userEmailAddresses");r&&(t=e.getPath("to.firstObject.emailId"),Global.validateEmail(t)?o=CoreMail.isEmailInUserAccount(t,u)?NO:YES:o=NO),i&&(n=e.getPath("cc.firstObject.emailId"),o=CoreMail.isEmailInUserAccount(n,u)?NO:YES)}}return o},getOriginalRecipientEmailAddress:function(e){var t,n,r,i,s,o,u;if(e){t=e.get("to"),n=e.get("to"),r=t.get("length"),i=n.get("length"),s=r+i;var a=CoreMail.get("userEmailAddresses");if(s===1){if(r){o=e.getPath("to.firstObject.emailId");if(Global.validateEmail(o)&&CoreMail.isEmailInUserAccount(o,a))return o}if(i){o=e.getPath("cc.firstObject.emailId");if(Global.validateEmail(o)&&CoreMail.isEmailInUserAccount(o,a))return o}}else{for(u=0;u<r;u++){o=t.objectAt(u).get("emailId");if(CoreMail.isEmailInUserAccount(o,a))return o}for(u=0;u<i;u++){o=n.objectAt(u).get("emailId");if(CoreMail.isEmailInUserAccount(o,a))return o}}}return o=CoreMail.getServerPreferences().get("sendMailFromAddress"
),o},listUnsubscribeHTMLEmailBody:function(e){var t="<div>",n="</div>";return t+e+n},showOrHideLongHeader:function(){var e=this.getPath("page.messageScrollView.contentView"),t=e.getPath("expandedHeader.longHeaderContainerView");t.get("isVisible")===NO?(this.replaceCollapsedHeaderWithExpandedHeaderView(),t.set("isVisible",YES),opener.CoreMail.saveImplicitPreference("longHeaderVisible",YES),CoreMail.errorHandler.recordStat("_STAT_LONG_HEADER_MENU_CLICKED",{option:"show"})):(t.set("isVisible",NO),opener.CoreMail.saveImplicitPreference("longHeaderVisible",NO),CoreMail.errorHandler.recordStat("_STAT_LONG_HEADER_MENU_CLICKED",{option:"hide"})),this.invokeAutoSizeMessageAfterSomeDelay()},setEmailAddressList:function(){var e=[],t=ViewMessage.toController,n=ViewMessage.ccController,r=ViewMessage.bccController,i=t.get("length"),s=n.get("length"),o=r.get("length"),u=Message.messageListController.getPath("selection.firstObject.folder.role"),a=t.getPath("content.firstObject.guid");if(i===1){var f=YES;CoreMail.UNDISCLOSED_RECIPIENTS_GUID===a&&u!==CoreMail.FOLDER_ROLE_SENT&&(f=NO),f&&e.pushObjects(t.get("arrangedObjects"))}i>1&&e.pushObjects(t.get("arrangedObjects")),s>0&&e.pushObjects(n.get("arrangedObjects")),o>0&&e.pushObjects(r.get("arrangedObjects")),ViewMessage.collapsedController.set("content",e)},switchToComposeMode:function(e,t){var n=this.getPath("page.messageScrollView.contentView.pane"),r=n.getPath("page.composeMainPane"),i=Message.get("messageController"),s=Compose,o=RichTextEditor;if(Message.getPath("appNamespace.mode")!==CoreMail.MESSAGE_MODE_VIEW){var u="ViewMessage.switchToComposeMode: Not in view mode."
;CoreMail.errorHandler.logErrorTrap(u);return}Compose.page=Compose.Page.design({}),s.set("mode",e),e!==CoreMail.MESSAGE_MODE_COMPOSE&&(SC.Event.remove(window,"beforeunload",this,this._viewMesageChildWindowUnloadHandler),s.set("content",i.get("content")),Message.setPath("appNamespace.mode",e)),s.configure(r.getPath("header.editorView"),null,this.get("serverPref"),CoreMail.getIdentityAccountEmail(),CoreMail.getSendFromEmailHashes()),o.set("editorContent",i.get("content")),o.set("editorMode",e),o.configure(r.getPath("composeSplitViewWrapper.composeSplitView.topLeftView.composeBody.editorView"),this.get("serverPref"),t,"",Compose.page.getPath("composeEditor.rteToolbar"));var a;if(e===CoreMail.MESSAGE_MODE_FORWARD||(e===CoreMail.MESSAGE_MODE_REPLY||e===CoreMail.MESSAGE_MODE_REPLY_ALL)&&this.getPath("serverPref.includeOriginalAttachmentsInReply")===YES)a=i.get("content");else if(e===CoreMail.MESSAGE_MODE_FORWARD_AS_ATTACHMENT){a=i.get("content");if(a){var f=a.toHash(),l=f?f.messageHash:{},c=a.get("mimeParts"),h=c.get("length"),p=CoreMail.store,d=a.get("size");p.unloadRecords(CoreMail.MessagePart,l.mimeParts),c.removeAt(0,h);var v=a.get("guid"),m=(a.get("subject")||"_ComposeMessage.ForwardAsAttachment.FileName".loc())+".eml";p.pushRetrieve(CoreMail.MessagePart,v,{guid:v,type:CoreMail.MessagePart,datatype:"message/rfc822",name:m,size:d}),l.mimeParts=[v],p.writeDataHash(a.get("storeKey"),l)}}Attachments.configure(MailMessage.mainPage.getPath("composeMainPane.composeSplitViewWrapper.composeSplitView.bottomRightView.attachments"),a),r.append(),n.remove()},getWebViewIframe:function(){var e=
ViewMessage.page.get("webViewOutlet"),t=e?e.$("iframe"):null;return t=t?t[0]:null,t},getPrintViewIframe:function(){var e=ViewMessage.page.get("messagePrintWebViewOutlet"),t=e?e.$("iframe"):null;return t=t?t[0]:null,t},maxButtonWidth:function(){var e=ViewMessage.page.get("multiSelectionActionsOutlet"),t,n=0;e.childViews[0]&&e.childViews[0].$("label")&&(t=e.childViews[0].$("label")[0]);if(t){var r=[];r.push("_MessageView.MultiSelection.Button.Read".loc(),"_MessageView.MultiSelection.Button.Unread".loc(),"_MessageView.MultiSelection.Button.Unflagged".loc(),"_MessageView.MultiSelection.Button.Flagged".loc(),"_MessageView.MultiSelection.Button.NotJunk".loc(),"_MessageView.MultiSelection.Button.Junk".loc()),SC.prepareStringMeasurement(t,"");for(var i=0,s=r.length;i<s;i++){var o=SC.measureString(r.objectAt(i)).width;o>n&&(n=o)}SC.teardownStringMeasurement()}else n=58;ViewMessage.multiSelectionController.set("segmentWidth",n+ViewMessage.metrics.MULTI_SELECTION_BUTTON_LABEL_OFFSET)}.property().cacheable(),icsStyle:function(){var e="url(%@)".fmt("/applications/mail/1808Project39/frameworks/core_mail/mail_theme/1808Project39/en-us/source/view_message/images/icon_ics.png"),t="url(%@)".fmt("/applications/mail/1808Project39/frameworks/core_mail/mail_theme/1808Project39/en-us/source/view_message/images/icon_ics@2x.png");return'<style class="icloud-inline-attachment-styles"> .ics-attachment-image{background:'+e+" no-repeat;"+"height:32px; width:24px;"+"}"+"@media (min-resolution: 192dpi),(-webkit-min-device-pixel-ratio: 1.01){"+".ics-attachment-image{"+"background:"+t+"no-repeat; "+"background-size:24px 32px;"+"}"+"}"+"</style>"
}.property().cacheable(),iWorkCouponStyle:function(){var e='url("%@")'.fmt("/applications/mail/1808Project39/frameworks/core_mail/mail_theme/1808Project39/en-us/source/view_message/images/iwork/keynote.png"),t='url("%@")'.fmt("/applications/mail/1808Project39/frameworks/core_mail/mail_theme/1808Project39/en-us/source/view_message/images/iwork/keynote@2x.png"),n='url("%@")'.fmt("/applications/mail/1808Project39/frameworks/core_mail/mail_theme/1808Project39/en-us/source/view_message/images/iwork/pages.png"),r='url("%@")'.fmt("/applications/mail/1808Project39/frameworks/core_mail/mail_theme/1808Project39/en-us/source/view_message/images/iwork/pages@2x.png"),i='url("%@")'.fmt("/applications/mail/1808Project39/frameworks/core_mail/mail_theme/1808Project39/en-us/source/view_message/images/iwork/numbers.png"),s='url("%@")'.fmt("/applications/mail/1808Project39/frameworks/core_mail/mail_theme/1808Project39/en-us/source/view_message/images/iwork/numbers@2x.png");return'<style class="icloud-inline-attachment-styles">.iwork-app-icon{height:78px; width:78px;}.iwork-app-icon.keynote{background:'+e+" no-repeat;"+"}"+".iwork-app-icon.pages{"+"background:"+n+" no-repeat;"+"}"+".iwork-app-icon.numbers{"+"background:"+i+" no-repeat;"+"}"+".download-iwork-doc:after{"+"background:#e5e5e5;"+"width:1px;"+"height:25px;"+'content:"";'+"display:inline-block;"+"vertical-align:middle;"+"margin:0 18px 0 18px;"+"}"+"@media screen and (min-resolution: 192dpi), (-webkit-min-device-pixel-ratio: 1.01){"+".iwork-app-icon.keynote{"+"background:"+t+" no-repeat;"+"background-size:72px 93px;"+"}"+".iwork-app-icon.pages{"+"background:"+
r+" no-repeat;"+"background-size:72px 93px;"+"}"+".iwork-app-icon.numbers{"+"background:"+s+" no-repeat;"+"background-size:72px 93px;"+"}"+"}"+"</style>\n"}.property().cacheable(),openIWorkDocument:function(e,t,n,r){if(!this._shouldProcessIWorkRequest(n,this._openInIWorkInterval))return;CloudOS.openIWorkDocument&&(n.indexOf("https://")!==0&&(n="https://%@%@".fmt(window.location.hostname,n)),SC.debug("openIWorkDocument: fileName: %@, downloadUrl: %@, app: %@".fmt(e,n,r)),CoreMail.errorHandler.recordStat("_STAT_IWORK_FILE_OPEN_IN_APP",{app:r,fileExtension:t}),CloudOS.openIWorkDocument(e,n,r))},downloadIWorkDocument:function(e,t){if(!this._shouldProcessIWorkRequest(e,this._downloadIWorkInterval))return;CoreMail.errorHandler.recordStat("_STAT_IWORK_FILE_DOWNLOAD",{app:t}),this.downloadAttachment(e)},downloadMailDropAttachment:function(e){this._shouldProcessDownloadRequest(e)===YES&&this.downloadAttachment(e)},downloadAttachment:function(e){SC.debug(e),SC.download(e)},loadMessageDetailToMainStore:function(e){var t=e.get("guid"),n=CoreMail.store.readDataHash(e.get("storeKey")),r=SC.json.encode(n);opener.Global.execFunctionInMailContext(opener.ViewMessage,ViewMessage.loadRecordFromStringifiedMessageDetail,r,e,t),this.loadMessageAddressDetailsToMainStore(e)},loadMessageAddressDetailsToMainStore:function(e){var t=CoreMail.store,n=e.get("from"),r=e.get("to"),i=e.get("cc"),s=e.get("bcc"),o=e.get("replyTo"),u,a=[],f,l,c;if(n){var h=t.readDataHash(n.get("storeKey"));a.push(h)}for(l=0,c=r.get("length");l<c;l++)f=t.readDataHash(r.objectAt(l).get("storeKey")),a.push(f);for(l=0,c=i.get("length"
);l<c;l++)f=t.readDataHash(i.objectAt(l).get("storeKey")),a.push(f);for(l=0,c=s.get("length");l<c;l++)f=t.readDataHash(s.objectAt(l).get("storeKey")),a.push(f);for(l=0,c=o.get("length");l<c;l++)f=t.readDataHash(o.objectAt(l).get("storeKey")),a.push(f);u=SC.json.encode(a),opener.Global.execFunctionInMailContext(opener.ViewMessage,ViewMessage.loadRecordFromstringifiedAddresses,u)},loadRecordFromStringifiedMessageDetail:function(e,t,n){var r=CoreMail.store,i=SC.json.decode(e);r.loadRecord(CoreMail.MessageDetail,i,n);var s=r.find(CoreMail.MessageDetail,n);s.set("loadIMG",t.get("loadIMG")),s.set("doctype",t.get("doctype")),s.set("messageStyles",t.get("messageStyles")),s.set("viewMessageSpecificStyles",t.get("viewMessageSpecificStyles")),s.set("isContentForCompose",t.get("isContentForCompose")),s.set("customStyles",t.get("customStyles")),s._isHTML=t.get("_isHTML"),s.set("didUserChangeLoadImgPref",t.get("didUserChangeLoadImgPref"))},loadRecordFromstringifiedAddresses:function(e){var t=SC.json.decode(e);CoreMail.store.loadRecords(CoreMail.EmailAddress,t)},_downloadIWorkInterval:1e3,_openInIWorkInterval:2e3,_shouldProcessIWorkRequest:function(e,t){var n=Date.now();return this._prevIWorkUrlTime&&this._prevIWorkUrl===e&&n-this._prevIWorkUrlTime<t?NO:(this._prevIWorkUrl=e,this._prevIWorkUrlTime=n,YES)},_downloadInterval:1e3,_shouldProcessDownloadRequest:function(e){var t=Date.now();return this._prevDownloadUrlTime&&this._prevDownloadUrl===e&&t-this._prevDownloadUrlTime<this._downloadInterval?NO:(this._prevDownloadUrl=e,this._prevDownloadUrlTime=t,YES)},replaceCollapsedHeaderWithExpandedHeaderView
:function(){var e=this.page,t=e.getPath("messageScrollView.contentView"),n=t.get("expandedHeader"),r=e.get("moreHideView"),i=r.get("classNames"),s;t.setPath("collapsedHeader.isVisible",NO),n.set("isVisible",YES),r.set("title","_MessageView.Expanded.Hide".loc()),i.pushObject("hide"),i.removeObject("more"),window.WHAT_TYPE.isMailChild()?s=opener.CoreMail.get("implicitPreferences"):s=CoreMail.get("implicitPreferences");if(s)ViewMessage.get("isPreview")===NO&&s.get("longHeaderVisible")===YES&&n.setPath("longHeaderContainerView.isVisible",YES);else{var o="ViewMessage.replaceCollapsedHeaderWithExpandedHeaderView : implicitPrefRecord is "+s;CoreMail.errorHandler.logErrorTrap(o)}},replaceExpandedHeaderWithCollapsedHeaderView:function(){var e=this.page,t=e.getPath("messageScrollView.contentView"),n=t.get("expandedHeader"),r=e.get("moreHideView"),i=r.get("classNames");n.set("isVisible",NO),n.setPath("longHeaderContainerView.isVisible",NO),t.setPath("collapsedHeader.isVisible",YES),r.set("title","_MessageView.Collapsed.More".loc()),i.pushObject("more"),i.removeObject("hide")},invokeAutoSizeMessageAfterSomeDelay:function(){this.invokeLast(function(){var e=ViewMessage.page.getPath("messageScrollView.contentView.messageBodyView.messageBodyWebView");e&&e.autoSizeMessage()})}}),SC.mixin(ViewMessage,{_msgDetail:null,_setMessageDetailVisibility:function(e){this.setPath("page.messageScrollView.isVisible",e),this.setPath("page.moreHideView.isVisible",e),e&&this.getPath("page.moreHideView").notifyPropertyChange("scrollViewVerticalScrollOffset")},_getCustomStyles:function(){var e=ViewMessage.page
.getPath("messageScrollView.contentView.messageBodyView.messageBodyWebView"),t=e.$("iframe")[0],n,r=[],i;if(!t||!t.contentDocument)return"";n=t.contentDocument;if(n){var s,o,u,a,f,l,c=Message.EXISTING_STYLES_CLASS,h=n.getElementsByClassName(c);if(h){var p=h.length;for(a=0;a<p;a++){s=h[a].sheet.cssRules;if(s){o=s.length;for(f=0;f<o;f++){var d=s[f];u=d.selectorText,u&&(u.substr(0,4).toLowerCase()==="body"?u="div.msg-quote "+u.substr(4):u=".msg-quote "+u,l=d.style,l&&r.push(u," {",l.cssText,"}\n"))}}}}var v=n.getElementsByTagName("body")[0];if(v){var m=v.getAttribute("bgcolor"),g=v.getAttribute("background");SC.empty(m)===NO&&r.push("div.msg-quote { background-color:",m,";}\n"),SC.empty(g)===NO&&r.push("div.msg-quote { background-image: url(",g,");}\n")}r.length>0&&(i='<style class="'+c+'" type="text/css">'+r.join("")+"</style>")}return i},_clearMessageBodySelection:function(){if(SC.browser.isMozilla)return;var e=this.page.get("webViewOutlet").$("iframe")[0],t;if(e){try{e.contentDocument&&(t=e.contentDocument)}catch(n){SC.warn("ViewMessage._clearMessageBodySelection: "+n);return}if(t&&t.getSelection){var r=t.getSelection();if(r&&r.toString()!==""){var i=SC.browser;if(!i.isIE&&!i.isEdge)r.removeAllRanges();else try{r.removeAllRanges()}catch(s){var o="ViewMessage: "+s;CoreMail.errorHandler.logErrorTrap(o)}}}}},_viewMesageChildWindowUnloadHandler:function(){this._destroyStatechartObservers(),MoveToFolder.destroyMoveMessagesStatusObserver()},_destroyStatechartObservers:function(){this._deleteRequest&&this._deleteResponseObserver&&(this._deleteRequest.removeStatechartObserver("state"
,this,this._deleteResponseObserver),this._deleteRequest=null,this._deleteResponseObserver=null),this._archiveRequest&&this._archiveResponseObserver&&(this._archiveRequest.removeStatechartObserver("state",this,this._archiveResponseObserver),this._archiveRequest=null,this._archiveResponseObserver=null),this._setFlagRequest&&this._setFlagResponseObserver&&(this._setFlagRequest.removeStatechartObserver("state",this,this._setFlagResponseObserver),this._setFlagRequest=null,this._setFlagResponseObserver=null),this._junkStatusObserver&&(Message.messageController.removeStatechartObserver("junk",this,this._junkStatusObserver),this._junkStatusObserver=null,this._prevJunkStatus=null)}});var msgBodyLineHeight;SC.browser.isMac?msgBodyLineHeight=1.5:msgBodyLineHeight=1.4,ViewMessage.MESSAGE_HEAD="<html>  <head>    <meta http-equiv=\"Content-type\" content=\"text/html; charset=utf-8\" />    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />    <base target=\"_blank\">    <style class=\"icloud-message-base-styles\">        @font-face {          font-family: 'SFNSText';          src: local(\".SFNSText-Light\"),               url('/fonts/SFNSText-Light.woff') format('woff');          font-weight: 300;        }        @font-face {          font-family: 'SFNSText';          src: local(\".SFNSText-Medium\"),               url('/fonts/SFNSText-Medium.woff') format('woff');          font-weight: 500;        }        body {          background-color: #ffffff;          padding: 13px 20px 0px 20px;          font: 15px 'SFNSText','Helvetica Neue', Helvetica, sans-serif;          font-weight: 300;          line-height: __bodyLineHeight__;          margin: 0px;          overflow: hidden;          word-wrap: break-word;        }        blockquote[type=cite].quoted-plain-text{        line-height:1.5;        padding-bottom: 0px;        white-space: normal;        }        blockquote[type=cite] {          border-left: 2px solid #003399;          margin:0;          padding: 0 12px 0 12px;          font-size: 15px;          color: #003399;        }        blockquote[type=cite] blockquote[type=cite] {          border-left: 2px solid #006600;          margin:0;          padding: 0 12px 0 12px;          font-size: 15px;          color: #006600        }        blockquote[type=cite] blockquote[type=cite] blockquote[type=cite] {          border-left : 2px solid #660000;          margin:0;          padding: 0 12px 0 12px;          font-size: 15px;          color: #660000        }        pre {          white-space: pre-wrap;          white-space: -moz-pre-wrap;          white-space: -pre-wrap;          white-space: -o-pre-wrap;          word-wrap: break-word;          white-space: pre-wrap !important;          word-wrap: normal !important;          font-size: 15px;        }        .__orientationPrefix__orientation-2{          transform:scaleX(-1);          -webkit-transform:scaleX(-1);          -ms-transform:scaleX(-1);        }        .__orientationPrefix__orientation-3{          transform:rotate(180deg);          -webkit-transform:rotate(180deg);          -ms-transform:rotate(180deg);        }        .__orientationPrefix__orientation-4{          transform:rotate(180deg) scaleX(-1);          -webkit-transform:rotate(180deg) scaleX(-1);          -ms-transform:rotate(180deg) scaleX(-1);        }        .__orientationPrefix__orientation-5{          transform:rotate(270deg) scaleX(-1);          -webkit-transform:rotate(270deg) scaleX(-1);          -ms-transform:rotate(270deg) scaleX(-1);        }        .__orientationPrefix__orientation-6{          transform:rotate(90deg);          -webkit-transform:rotate(90deg);          -ms-transform:rotate(90deg);        }        .__orientationPrefix__orientation-7{          transform:rotate(90deg) scaleX(-1);          -webkit-transform:rotate(90deg) scaleX(-1);          -ms-transform:rotate(90deg) scaleX(-1);        }        .__orientationPrefix__orientation-8{          transform:rotate(270deg);          -webkit-transform:rotate(270deg);          -ms-transform:rotate(270deg);        }        .x-apple-maildropbanner {          margin-top:-13px;        }        a.view-message-icloud-share,        a.view-message-icloud-share:visited {          cursor: pointer;          color: #0000EE;          text-decoration: underline;        }        a.view-message-icloud-share:hover{          text-decoration: underline;        }    </style>"
,ViewMessage.MESSAGE_HEAD=ViewMessage.MESSAGE_HEAD.replace(/__bodyLineHeight__/g,msgBodyLineHeight),ViewMessage.MESSAGE_HEAD=ViewMessage.MESSAGE_HEAD.replace(/__orientationPrefix__/g,CoreMail.IMAGE_ORIENTATION_CLASS_PREFIX),ViewMessage.MESSAGE_TAIL="</html>",ViewMessage.BannerMixin={messageScrollViewBinding:SC.Binding.oneWay(".page.messageScrollView"),scrollViewVerticalScrollOffsetBinding:SC.Binding.oneWay(".messageScrollView.verticalScrollOffset"),scrollViewVerticalScrollOffsetDidChange:function(){var e=this.get("scrollViewVerticalScrollOffset"),t=this.getPath("messageScrollView.contentView.bannerUnderlay.frame"),n=t.height;(e<=n||this._prevScrollViewVerticalScrollOffset<=this._prevBannerUnderlayHeight)&&this.adjust("top",-e),this._prevScrollViewVerticalScrollOffset=e,this._prevBannerUnderlayHeight=n}.observes("scrollViewVerticalScrollOffset"),mouseWheel:function(e){return this.get("pane").sendEvent("mouseWheel",e,this.getPath("messageScrollView.contentView.bannerUnderlay")),YES}},ViewMessage.metrics=SC.Object.create({LOAD_IMAGES_PANE_LOAD_IMAGES:110,JUNK_PANE_ONE_BUTTON_WIDTH:115,JUNK_PANE_TWO_BUTTONS_WIDTH:245,JUNK_PANE_MOVING_INBOX_WIDTH:155,JUNK_PANE_IMAGE_PANE_HEIGHT:44,MULTI_SELECTION_BUTTON_LABEL_OFFSET:20,SPINNER_VIEW_WIDTH:150,LOAD_IMAGES_BUTTON_TOP:5,JUNK_PANE_BUTTON_TOP:-2,SUSPICIOUS_MESSAGE_ENABLE_LINKS_BUTTON_TOP:6,SUSPICIOUS_MESSAGE_BANNER_HEIGHT:44,SUSPICIOUS_MESSAGE_BANNER_MIN_WIDTH:430,LIST_UNSUBSCRIBE_BANNER_HEIGHT:44,LIST_UNSUBSCRIBE_BANNER_MIN_WIDTH:430,LIST_UNSUBSCRIBE_BUTTON_TOP:-1,EXPANDED_HEADER_ATTACHMENT_ICON_VIEW_TOP:4,EXPANDED_HEADER_ATTACHMENT_LABEL_VIEW_TOP
:-11,init:function(){var e=SC.browser;return e.isWindows?e.isIE?(this.MULTI_SELECTION_BUTTON_LABEL_OFFSET=47,this.LOAD_IMAGES_BUTTON_TOP=6,this.SUSPICIOUS_MESSAGE_ENABLE_LINKS_BUTTON_TOP=7,this.LIST_UNSUBSCRIBE_BUTTON_TOP=0):e.isEdge&&(this.LOAD_IMAGES_BUTTON_TOP=6,this.JUNK_PANE_BUTTON_TOP=-1,this.SUSPICIOUS_MESSAGE_ENABLE_LINKS_BUTTON_TOP=7,this.LIST_UNSUBSCRIBE_BUTTON_TOP=0,this.MULTI_SELECTION_BUTTON_LABEL_OFFSET=40):e.isMac&&e.isMozilla&&(this.LOAD_IMAGES_BUTTON_TOP=7,this.JUNK_PANE_BUTTON_TOP=0,this.SUSPICIOUS_MESSAGE_ENABLE_LINKS_BUTTON_TOP=7,this.LIST_UNSUBSCRIBE_BUTTON_TOP=0),arguments.callee.base.apply(this,arguments)}}),ViewMessage.ToolbarView=SC.View.extend({classNames:"toolbar".w(),childViews:["viewMessageToolbar"],viewMessageToolbar:SC.View.design({layout:{left:4,right:4},childViews:["middle"],middle:SC.View.extend({layout:{centerX:0,centerY:0,height:40,width:270},content:null,contentBinding:"Message.messageDetailController",childViews:"reply flag trash archive moveToFolder actions".w(),reply:CW.PopupButtonView.design(Global.ToolbarButtonMixin,{classNames:["n-m-w"],layout:{left:0,top:0,width:40,height:40},themeName:"borderless",icon:"reply",layerId:"toolbar-reply-menu",titleMinWidth:0,toolTip:"_Toolbar.Message.ReplyAllAndForwardingOptions".loc(),contentBinding:"Message.messageDetailController.content",needsEllipsis:NO,contentDidChange:function(){var e=NO,t=this.get("content");t&&(e=ViewMessage.replyAllCheck(t));if(Global.get("isQuickReplyEnabled")===NO){var n=[];n.push({title:"_Menu.Reply".loc(),isEnabled:YES,action:function(){CoreMail.incrementUserStat(CoreMail
.STAT_REPLY_REPLY_ALL),ViewMessage.dispatch({sig:"reply"})}}),n.push({title:"_Menu.ReplyAll".loc(),isEnabled:e,action:function(){CoreMail.incrementUserStat(CoreMail.STAT_REPLY_REPLY_ALL),ViewMessage.dispatch({sig:"replyAll"})}}),n.push({title:"_Menu.Forward".loc(),isEnabled:YES,target:ViewMessage,action:"forward"}),n.push({title:"_Menu.ForwardAsAttachment".loc(),isEnabled:YES,target:ViewMessage,action:"forwardAsAttachment"}),this.setPath("menu.items",n)}else ReplyMenu.set("isReplyAllEnabled",e),ReplyMenu.set("isReplyEnabled",YES),ReplyMenu.set("isForwardEnabled",YES)}.observes("content"),menu:function(){var e;return Global.get("isQuickReplyEnabled")===NO?e=ViewMessage.page.get("replyMenu"):e=ReplyMenu.getReplyMenuPane(),e}.property().cacheable(),showMenu:function(){Global.get("isQuickReplyEnabled")===YES&&ReplyMenu.dispatch({sig:"showReplyMenu",isViewMessage:YES}),arguments.callee.base.apply(this,arguments)}}),flag:CW.PopupButtonView.design(Global.ToolbarButtonMixin,{classNames:["n-m-w"],layout:{left:57,top:0,width:42,height:42},themeName:"borderless",icon:"flag",layerId:"toolbar-flag",toolTip:"_Toolbar.Message.Flag".loc(),selectionBinding:SC.binding(".owner.owner.selection").oneWay(),menu:function(){return FlagMenu.getFlagMenuPane()}.property().cacheable(),showMenu:function(){CoreMail.errorHandler.recordStat("_STAT_FLAG_BUTTON_CLICKED_MESSAGE"),FlagMenu.statechart.sendEvent("openFlagMenu"),arguments.callee.base.apply(this,arguments)}}),trash:SC.ButtonView.design(Global.ToolbarButtonMixin,{classNames:["n-m-w"],layout:{left:114,top:0,width:35,height:40},themeName:"borderless"
,icon:"trash",layerId:"toolbar-trash",toolTip:"_Toolbar.Message.MoveToTrash".loc(),isVisibleBinding:SC.Binding.not("ViewMessage.serverPreferences.displayArchiveInseadOfTrash"),titleMinWidth:0,action:function(){ViewMessage.dispatch({sig:"delete"})}}),archive:SC.ButtonView.design(Global.ToolbarButtonMixin,{classNames:["n-m-w"],layout:{left:114,top:0,width:35,height:40},themeName:"borderless",icon:"archive",layerId:"toolbar-archive",toolTip:"_Toolbar.Message.Archive".loc(),titleMinWidth:0,isVisibleBinding:"ViewMessage.serverPreferences.displayArchiveInseadOfTrash",isEnabled:function(){return CoreMail.ARCHIVE_GUID===Message.messageController.getPath("folder.guid")?NO:YES}.property("Message.messageController.content").cacheable(),action:function(){ViewMessage.dispatch({sig:"archive"})}}),moveToFolder:CW.PopupButtonView.design(Global.ToolbarButtonMixin,{classNames:["n-m-w"],layout:{left:172,top:0,width:35,height:40},themeName:"borderless",icon:"move-to-folder",layerId:"toolbar-move-to-folder",toolTip:"_Toolbar.Message.MoveToFolder".loc(),titleMinWidth:0,menu:function(){return MoveToFolder.getMoveToFolderMenu()}.property().cacheable()}),actions:CW.PopupButtonView.design(Global.ToolbarButtonMixin,{classNames:["n-m-w"],layout:{left:230,top:0,width:40,height:40},themeName:"borderless",target:null,targetBinding:".owner.target",icon:"actions",layerId:"toolbar-actions-menu",toolTip:"_Toolbar.Message.Actions".loc(),titleMinWidth:0,menu:function(){return ActionMenu.getActionMenuPane()}.property().cacheable(),showMenu:function(){ActionMenu.dispatch({sig:"showActionMenu"}),arguments.callee.base
.apply(this,arguments)}})})})}),ViewMessage.LongHeadersListItemView=SC.View.extend(SC.StaticLayout,{useStaticLayout:YES,childViews:["headerKey","headerVal"],layout:{top:0,left:0,right:200,height:18},headerKey:SC.LabelView.design(SC.StaticLayout,{useStaticLayout:YES,tagName:"span",classNames:"header-long",layout:{top:3,left:0,width:200,height:17},textAlign:SC.ALIGN_RIGHT,controlSize:SC.SMALL_CONTROL_SIZE,value:""}),headerVal:SC.LabelView.design(SC.StaticLayout,{useStaticLayout:YES,tagName:"span",classNames:"header-long",layout:{top:3,width:212,height:17},textAlign:SC.ALIGN_LEFT,controlSize:SC.SMALL_CONTROL_SIZE,value:""})}),ViewMessage.TokenItemView=SC.LabelView.extend({useStaticLayout:YES,tagName:"span",isTextSelectable:YES,contactDataRefreshedBinding:"Contacts.contactDataRefreshed",content:null,contentKeys:{contentIsVipSender:"isVipSender"},contentIsVipSender:"isVipSender",classNames:["message-token-item","token-commit","token-accessory"],displayProperties:["isVipSender","contactDataRefreshed"],didLoseContactPicker:function(){this.set("isSelected",NO)},mouseDown:function(e){var t=this.get("content");if(t&&e.which!==3){var n=t.get("emailId");Global.validateEmail(n)===YES&&this.set("isSelected",YES)}},mouseUp:function(){if(this.get("isSelected")){var e=this.get("content");if(e){var t=e.get("emailId");Global.validateEmail(t)===YES&&ViewMessage.dispatch({sig:"showContactPicker",email:t,firstName:e.get("firstName"),lastName:e.get("lastName"),anchor:this})}}return YES},render:function(e){var t=this.get("value");if(t){var n=this.get("isVipSender"),r='<label class= "token-value">%@</label>'
,i='<img src="%@" />';e.push('<span class= "token-span">'),e.push(r.fmt(SC.RenderContext.escapeHTML(t))),e.push(i.fmt(SC.BLANK_IMAGE_URL)),e.push("</span>");if(n){e.addClass("vip-sender-name");var s,o;s="token-accessory-icon vip-email-star",o='<img class="%@ sc-view" src="%@" />',e.push(o.fmt(s,SC.BLANK_IMAGE_URL))}}},value:function(){var e=this.get("content");if(e){var t=e.get("fullName"),n=e.get("emailId"),r;if(Global.validateEmail(n)){var i;SC.empty(t)===NO&&(i=t.trim()),SC.empty(i)===NO?r=i:r=n}else n=e.get("email"),SC.empty(n)===NO&&n.toLowerCase()===ViewMessage.UNDISCLOSED_RECIPIENTS?r="_MessageView.To.Value.Undisclosed".loc():r=n;return r}}.property("content")}),ViewMessage.TokenItemViewUndisclosed=SC.LabelView.extend({useStaticLayout:YES,isTextSelectable:YES,tagName:"span",classNames:["undisclosed-recipients","header-view-field-value","message-token-item"],value:"_MessageView.To.Value.Undisclosed".loc()}),ViewMessage.StackedViewTo=SC.StackedView.extend({useStaticLayout:YES,isTextSelectable:YES,contentBinding:"ViewMessage.toController.arrangedObjects",exampleView:function(){return CoreMail.UNDISCLOSED_RECIPIENTS_GUID===ViewMessage.toController.getPath("content.firstObject.guid")?ViewMessage.TokenItemViewUndisclosed:ViewMessage.TokenItemView}.property(),mouseDown:function(){return NO}}),ViewMessage.StackedViewCc=SC.StackedView.extend({useStaticLayout:YES,isTextSelectable:YES,contentBinding:"ViewMessage.ccController.arrangedObjects",exampleView:ViewMessage.TokenItemView,mouseDown:function(){return NO}}),ViewMessage.StackedViewBcc=SC.StackedView.extend(SC.StaticLayout,{useStaticLayout
:YES,isTextSelectable:YES,contentBinding:"ViewMessage.bccController.arrangedObjects",exampleView:ViewMessage.TokenItemView,mouseDown:function(){return NO}}),ViewMessage.StackedViewReplyTo=SC.StackedView.extend({useStaticLayout:YES,isTextSelectable:YES,contentBinding:"ViewMessage.replyToController.arrangedObjects",exampleView:ViewMessage.TokenItemView,mouseDown:function(){return NO}}),ViewMessage.ExpandedHeaderView=SC.View.extend({useStaticLayout:YES,childViews:["fromNamesView","toNamesView","ccNamesView","bccNamesView","replyToNamesView","attachmentView","longHeaderContainerView"],classNames:"static-header-view-expanded",from:null,contentDidChange:function(){this.set("from",ViewMessage.page.getPath("content.from"));var e=ViewMessage.page.getPath("content.from.isVipSender");this.set("isVip",e);var t=ViewMessage.ccController.getPath("content.length"),n=t&&t>0?"YES":"NO";this.setPath("ccNamesView.isVisible",n);var r=ViewMessage.bccController.getPath("content.length");r&&r>0?this.setPath("bccNamesView.isVisible",YES):this.setPath("bccNamesView.isVisible",NO),this.getPath("toNamesView").set("layerNeedsUpdate",YES)}.observes("ViewMessage.page.content","ViewMessage.page.content.from.isVipSender","ViewMessage.page.content.from.fullName"),fromNamesView:SC.View.extend({useStaticLayout:YES,childViews:["labelViewFrom","labelViewFromDataWrapper"],classNames:["header-view-field","disclosure-header-names"],isTextSelectable:YES,labelViewFrom:SC.LabelView.design({useStaticLayout:YES,isTextSelectable:YES,classNames:["header-view-compact-info"],controlSize:SC.LARGE_CONTROL_SIZE,tagName:"span",
value:"_MessageView.Expanded.From".loc()}),labelViewFromData:SC.outlet("labelViewFromDataWrapper.labelViewFromData"),labelViewFromDataWrapper:SC.View.extend({useStaticLayout:YES,tagName:"span",classNames:["header-view-field-value"],childViews:["labelViewFromData"],labelViewFromData:ViewMessage.TokenItemView.extend({useStaticLayout:YES,contentBinding:SC.Binding.oneWay(".owner.owner.owner.from")})})}),toNamesView:SC.View.extend({useStaticLayout:YES,isTextSelectable:YES,classNames:["header-view-field"],childViews:["labelViewTo","labelViewToData"],toContent:null,toContentBinding:"ViewMessage.toController.content",isVisible:function(){var e=NO,t=this.get("toContent"),n=t?t.get("length"):null;return n>0&&(e=YES),e}.property("toContent"),labelViewTo:SC.LabelView.design({tagName:"span",useStaticLayout:YES,isTextSelectable:YES,controlSize:SC.LARGE_CONTROL_SIZE,classNames:["header-view-compact-info"],value:"_MessageView.To".loc(),textAlign:SC.ALIGN_LEFT}),labelViewToData:ViewMessage.StackedViewTo.extend({tagName:"span",useStaticLayout:YES,classNames:["header-view-field-value"],render:function(e){arguments.callee.base.apply(this,arguments),ViewMessage.get("isPreview")&&e.addClass("to-data")},updateHeight:function(){}})}),ccNamesView:SC.View.design({useStaticLayout:YES,isTextSelectable:YES,classNames:["header-view-field"],childViews:["labelViewCc","labelViewCcData"],ccContent:null,ccContentBinding:"ViewMessage.ccController.content",controlSize:SC.LARGE_CONTROL_SIZE,isVisible:function(){var e,t=this.get("ccContent"),n=t?t.get("length"):null;return n>0&&(e=YES),e}.property("ccContent"),labelViewCc
:SC.LabelView.design({tagName:"span",useStaticLayout:YES,isTextSelectable:YES,textAlign:SC.ALIGN_LEFT,controlSize:SC.LARGE_CONTROL_SIZE,classNames:["header-view-compact-info"],value:"_MessageView.Cc".loc()}),labelViewCcData:ViewMessage.StackedViewCc.extend({tagName:"span",useStaticLayout:YES,classNames:["header-view-field-value"],updateHeight:function(){}})}),bccNamesView:SC.View.extend({useStaticLayout:YES,isTextSelectable:YES,classNames:"header-view-field".w(),childViews:["labelViewBcc","labelViewBccData"],bccContent:null,bccContentBinding:"ViewMessage.bccController.content",isVisible:function(){var e=NO,t=this.get("bccContent"),n=t?t.get("length"):0;return n>0&&(e=YES),e}.property("bccContent").cacheable(),labelViewBcc:SC.LabelView.design({tagName:"span",useStaticLayout:YES,isTextSelectable:YES,textAlign:SC.ALIGN_LEFT,controlSize:SC.LARGE_CONTROL_SIZE,classNames:["header-view-compact-info"],value:"_MessageView.Bcc".loc()}),labelViewBccData:ViewMessage.StackedViewBcc.extend({tagName:"span",useStaticLayout:YES,classNames:["header-view-field-value"],updateHeight:function(){}})}),replyToNamesView:SC.View.extend({useStaticLayout:YES,isTextSelectable:YES,classNames:"header-view-field".w(),childViews:["labelViewReplyTo","replyToData"],replyToContent:null,replyToContentBinding:"ViewMessage.replyToController.content",isVisible:function(){var e=NO,t=this.get("replyToContent"),n=t?t.get("length"):0;return n>0&&(e=YES),e}.property("replyToContent").cacheable(),labelViewReplyTo:SC.LabelView.design({tagName:"span",useStaticLayout:YES,isTextSelectable:YES,textAlign:SC.ALIGN_LEFT,controlSize
:SC.LARGE_CONTROL_SIZE,classNames:["header-view-compact-info"],value:"_MessageView.ReplyTo".loc()}),replyToData:ViewMessage.StackedViewReplyTo.extend({tagName:"span",useStaticLayout:YES,classNames:["header-view-field-value"],updateHeight:function(){}})}),attachmentView:SC.View.design({useStaticLayout:YES,layout:{top:0,width:"auto",left:0,right:20},classNames:"attachments".w(),childViews:["labelViewAttachment","labelViewAttachmentData"],isSuspiciousAndNotTrustedBinding:SC.Binding.oneWay("Message.messageDetailController.isSuspiciousAndNotTrusted"),hasUnexpiredAttachmentsBinding:SC.Binding.oneWay("Message.messageController.hasUnexpiredAttachments"),isVisible:function(){var e=YES;if(this.get("hasUnexpiredAttachments")===NO||this.get("isSuspiciousAndNotTrusted")===YES)e=NO;return e}.property("isSuspiciousAndNotTrusted","hasUnexpiredAttachments"),labelViewAttachment:SC.LabelView.design({useStaticLayout:YES,isTextSelectable:YES,layout:{left:1,top:ViewMessage.metrics.EXPANDED_HEADER_ATTACHMENT_ICON_VIEW_TOP,height:"auto"},textAlign:SC.ALIGN_RIGHT,icon:"attachment-image"}),labelViewAttachmentData:SC.View.design({useStaticLayout:YES,isTextSelectable:YES,layout:{left:18,top:ViewMessage.metrics.EXPANDED_HEADER_ATTACHMENT_LABEL_VIEW_TOP,width:"auto",height:"auto"},content:null,contentBinding:"Message.messageController.content",contentDetail:null,contentDetailBinding:"Message.messageDetailController.content",displayProperties:["isFirstResponder","contentDetail"],contentDidChange:function(){this.set("layerNeedsUpdate",YES)}.observes("content"),mouseDown:function(e){return e.stopPropagation
(),this._isMouseDown=YES,this.set("isTextSelectable",NO),YES},mouseUp:function(e){if(this._isMouseDown){var t=e.target||e.srcElement,n=this.$(t),r={width:0,top:0,height:0,left:0},i;n&&(i=n.offset(),r.width=n.width(),r.height=n.height()),i&&(r.top=i.top,r.left=i.left);if(t&&t.id){var s=t.id,o,u=t.className,a={};if(u.indexOf("valid-vcf")>=0&&this.getPath("content.isMailDropMessage")===NO)return a.sig="showImportContactPicker",a.anchor=r,a.targetUrl=this._linkIdToURLMapping[s],a.fileName=t.name,ViewMessage.dispatch(a),YES;this._linkIdToURLMapping&&this._linkIdToURLMapping[s]&&(o=this._linkIdToURLMapping[s],ViewMessage.downloadAttachment(o))}}return this._isMouseDown=NO,this.set("isTextSelectable",YES),YES},render:function(e){var t,n,r,i,s,o,u="_url"+this.get("layerId"),a,f=this.get("content"),l,c,h=0,p=NO,d=NO,v=NO,m,g;f&&(c=f.get("mimeParts"),h=f.get("attachmentCount"));var y=",&nbsp;";if(h>0){o=c.get("length");for(m=0;m<o;m++){f=c.objectAt(m);if(f.get("isMailDrop")){p=YES,f.get("isExpired")&&(d=YES);break}}this._linkIdToURLMapping={};for(m=0;m<o;m++){f=c.objectAt(m);if(!f)continue;g=f.get("mailDropStreamingUrl");if(p&&!g&&!d||d&&g)continue;f.get("isAttachment")&&(r=f.get("attachmentName"),l="attachment-url",s=f.get("icon"),i=f.get("attachmentDetails"),n=f.get("attachmentUrl"),a=u+m,this._linkIdToURLMapping[a]=n,r=Global.escapeHTMLAndQuotes(r),t="_MessageView.Attachment.ToolTip".loc(r),f.get("isVCF")&&(l+=" valid-vcf",s+=" valid-vcf"),v===YES&&e.push(y+"</span>"),e.push('<span class = "attachment-icon"><img style="float:left" src=',SC.BLANK_IMAGE_URL,' class="icon ',s,'" name ="'
,r,'" id =',a,' title="'+t+'"><a class="'+l+'" name ="',r,'" id ="',a,'" ',' title="'+t+'">',Global.escapeHTMLAndQuotes(i),"</a>"),v=YES)}v===YES?e.push("</span>"):e.push("<span></span>")}else e.push("<span></span>")}})}),longHeaderContainerView:SC.View.design({useStaticLayout:YES,layout:{left:0,top:0,right:0,height:"auto"},classNames:"long-header-background long-header-font".w(),isVisible:NO,childViews:["longHeadersView"],longHeadersView:SC.View.design({isTextSelectable:YES,useStaticLayout:YES,layout:{left:0,top:5,right:0,height:"auto"},classNames:"long-header-data".w(),isVisibleBinding:".parentView.isVisible",contentBinding:"Message.messageDetailController.content",displayProperties:["content"],render:function(e){var t=arguments.callee.base.apply(this,arguments),n=this.get("content");if(n){var r=n.get("processedLongHeader");if(r){e.push('<div style="overflow:visible;margin-bottom:-9px;">');var i=r.get("length"),s;for(var o=0;o<i;o++)s=r.get(o),e.push('<div style="float:left; display:table-cell; font-weight:500;" class="header-long key">',SC.RenderContext.escapeHTML(s.get("key")),":","</div>",'<div style="padding-left:5px; display:table-cell; -moz-hyphens:auto; word-wrap:break-word; word-break:break-word;" class="header-long">',SC.RenderContext.escapeHTML(s.get("value")),"</div>");e.push('<div style="height:21px" class="header-long"></div></div>')}}return t}})})}),ViewMessage.JunkPaneView=SC.View.extend(ViewMessage.BannerMixin,{messageContent:null,messageContentBinding:"Message.messageController.content",isMessageJunkBinding:"Message.messageController.isMessageJunk",isVisible
:function(){var e=Message.messageController.getPath("content.folder.role");return e===CoreMail.FOLDER_ROLE_JUNK||this.get("isMessageJunk")?YES:NO}.property("isMessageJunk","messageContent"),classNames:["junk-background"],childViews:["junkShow"],junkShow:SC.View.extend({layout:{left:0,right:0,centerY:0,height:44},childViews:["junkLabel","rightView"],junkLabel:SC.LabelView.design({layout:function(){var e;return ViewMessage.getPath("page.junkView.junkShow.rightView.loadImagesButton.isVisible")?e={left:17,height:18,right:ViewMessage.metrics.JUNK_PANE_TWO_BUTTONS_WIDTH+7,centerY:0,bottom:13}:e={left:17,height:18,right:ViewMessage.metrics.JUNK_PANE_ONE_BUTTON_WIDTH+7,centerY:0,bottom:13},e}(),classNames:"message-pane-description",junkContext:null,junkContextBinding:"Message.messageDetailController.junkContext",localize:YES,value:function(){var e=this.get("junkContext");return e===CoreMail.JUNK_FLAG?"_MessageView.MarkedJunkMail":e===CoreMail.JUNK_SPAM?"_MessageView.JunkMail":"_MessageView.RulesJunkMail"}.property("junkContext")}),rightView:SC.View.extend({layout:{width:ViewMessage.metrics.JUNK_PANE_ONE_BUTTON_WIDTH,right:3,height:30,centerY:0},classNames:"text-align-right".w(),childViews:["spinnerView","loadImagesButton","notJunkButton"],spinnerView:SC.LabelView.design(SC.StaticLayout,{isVisible:NO,useStaticLayout:YES,layout:{right:27,width:"auto",height:"auto",top:5},titleMinWidth:CW.SQUARE_BUTTON_REGULAR_MIN_WIDTH,icon:"move-to-inbox-spinner",value:"_Toolbar.Message.MovingToInbox".loc(),classNames:"message-pane-description".w(),tagName:"span",isVisibleDidChange:function(){var e=this
.get("isVisible"),t=this.getPath("owner.loadImagesButton.isVisible"),n=this.get("owner"),r=ViewMessage.getPath("page.junkView.junkShow.junkLabel"),i=ViewMessage.metrics,s=i.JUNK_PANE_MOVING_INBOX_WIDTH,o=i.JUNK_PANE_ONE_BUTTON_WIDTH,u=i.JUNK_PANE_TWO_BUTTONS_WIDTH,a=s+o,f=s+u,l;e?l=t?f:a:l=t?u:o,l&&(n.adjust("width",l),r.adjust("right",l))}.observes("isVisible")}),loadImagesButton:SC.ButtonView.design({isVisible:NO,controlSize:SC.SMALL_CONTROL_SIZE,isVisibleBinding:"Message.messageDetailController.hasUnloadedIMG",useStaticLayout:YES,classNames:["junk-pane-button","button-in-between","bar-after"],layout:{right:0,width:"auto",height:SC.REGULAR_BUTTON_HEIGHT,top:ViewMessage.metrics.JUNK_PANE_BUTTON_TOP},title:"_MessageView.LoadImages".loc(),themeName:"borderless",tagName:"span",action:function(){var e=Message.messageDetailController.get("content");e.set("loadIMG",YES),ViewMessage.setPath("page.bodyMessage",e.get("body")),this.set("isVisible",NO),window.WHAT_TYPE.isMailChild()&&opener.CoreMail.store.find(opener.CoreMail.MessageDetail,e.get("guid")).set("loadIMG",YES)},isVisibleDidChange:function(){var e=ViewMessage.metrics,t=e.JUNK_PANE_TWO_BUTTONS_WIDTH,n=e.JUNK_PANE_ONE_BUTTON_WIDTH,r=this.get("isVisible"),i=this.get("owner"),s=ViewMessage.getPath("page.junkView.junkShow.junkLabel");r?(i.adjust("width",t),s.adjust("right",t)):(i.adjust("width",n),s.adjust("right",n))}.observes("isVisible")}),notJunkButton:SC.ButtonView.design({classNames:["junk-pane-button","button-aligned-right","junk-button-font"],controlSize:SC.SMALL_CONTROL_SIZE,useStaticLayout:YES,tagName:"span",themeName
:"borderless",layout:{right:0,width:"auto",height:SC.REGULAR_BUTTON_HEIGHT,top:ViewMessage.metrics.JUNK_PANE_BUTTON_TOP},title:"_MessageView.NotJunk".loc(),action:function(){ViewMessage.dispatch({sig:"setJunk"})}})})})}),ViewMessage.DisclosureView=SC.ButtonView.extend(SC.AutoResize,{_subjectEle:null,_dateEle:null,isVerticalScrollerVisible:null,isVerticalScrollerVisibleBinding:".page.messageScrollView.isVerticalScrollerVisible",scrollViewHorizontalScrollOffset:null,scrollViewHorizontalScrollOffsetBinding:".page.messageScrollView.horizontalScrollOffset",scrollViewVerticalScrollOffset:null,scrollViewVerticalScrollOffsetBinding:".page.messageScrollView.verticalScrollOffset",isJunkViewVisible:null,isJunkViewVisibleBinding:".page.junkView.isVisible",isLoadImagesViewVisible:null,isLoadImagesViewVisibleBinding:".page.loadImagesView.isVisible",isSuspiciousMessageBannerViewVisibleBinding:".page.suspiciousMessageBannerView.isVisible",isListUnsubscribeBannerViewVisibleBinding:".page.listUnsubscribeBannerView.isVisible",hasUnexpiredAttachmentsBinding:SC.Binding.oneWay("Message.messageController.hasUnexpiredAttachments"),layout:{top:-100,right:0,height:26},classNames:["header-view-text-button","right"],title:"_MessageView.Collapsed.More".loc(),theme:"borderless",textAlign:SC.ALIGN_RIGHT,viewPropertiesDidChange:function(){this.invokeLater(function(){var e=0,t=ViewMessage.get("msgSubject"),n=ViewMessage.get("date");if(SC.browser.isWindows||SC.browser.isMozilla)e=1;if(t||n)if(this._subjectEle||this._dateEle){this._subjectEle&&this._subjectEle.offsetHeight&&(e+=this._subjectEle.offsetHeight),
this._dateEle&&this._dateEle.offsetHeight&&(e+=this._dateEle.offsetHeight),ViewMessage.get("isPreview")===NO&&(e+=Global.metrics.DOCK_HEIGHT);if(this.get("isJunkViewVisible")===YES||this.get("isLoadImagesViewVisible")===YES)e+=ViewMessage.metrics.JUNK_PANE_IMAGE_PANE_HEIGHT;this.get("isSuspiciousMessageBannerViewVisible")===YES&&(e+=ViewMessage.metrics.SUSPICIOUS_MESSAGE_BANNER_HEIGHT),this.get("isListUnsubscribeBannerViewVisible")===YES&&(e+=ViewMessage.metrics.LIST_UNSUBSCRIBE_BANNER_HEIGHT),e-=this.get("scrollViewVerticalScrollOffset"),this.adjust("top",e)}},CoreMail.INTERVAL_MORE_HIDE_BUTTON_TOP_ADJUST)}.observes("scrollViewVerticalScrollOffset","isJunkViewVisible","isLoadImagesViewVisible","isSuspiciousMessageBannerViewVisible","isListUnsubscribeBannerViewVisible"),messageWindowDidResize:function(){ViewMessage.get("msgSubject")&&(this._timer&&this._timer.invalidate(),this._timer=this.invokeLater(function(){ViewMessage.getPath("page.moreHideView").notifyPropertyChange("scrollViewVerticalScrollOffset")},CoreMail.INTERVAL_MORE_HIDE_BUTTON_TOP_ADJUST))}.observes(".pane.rootResponder.currentWindowSize","ViewMessage.page.splitterPosition","MessageList.viewPreference"),didCreateLayer:function(){this.collapseOrExpandHeaderBasedOnAttachments();if(!this._subjectEle){var e=ViewMessage.getPath("page.messageScrollView.contentView.subjectView");e&&(this._subjectEle=e.$()[0])}if(!this._dateEle){var t=ViewMessage.getPath("page.messageScrollView.contentView.dateAndAttachmentsView");t&&(this._dateEle=t.$()[0])}},didUpdateLayer:function(){if(!this._subjectEle){var e=ViewMessage.getPath("page.messageScrollView.contentView.subjectView"
);e&&(this._subjectEle=e.$()[0])}if(!this._dateEle){var t=ViewMessage.getPath("page.messageScrollView.contentView.dateAndAttachmentsView");t&&(this._dateEle=t.$()[0])}},action:function(){var e=ViewMessage.get("isPreview"),t=this.getPath("page.messageScrollView.contentView.expandedHeader.isVisible"),n;e===YES?n=CoreMail:n=opener.CoreMail,t?(ViewMessage.replaceExpandedHeaderWithCollapsedHeaderView(),e===NO&&n.saveImplicitPreference("longHeaderVisible",NO)):ViewMessage.replaceCollapsedHeaderWithExpandedHeaderView(),n.saveImplicitPreference("headerExpanded",!t),ViewMessage.invokeAutoSizeMessageAfterSomeDelay()},messageContentDidChange:function(){this.collapseOrExpandHeaderBasedOnAttachments()}.observes("hasUnexpiredAttachments","Message.messageController.content"),collapseOrExpandHeaderBasedOnAttachments:function(){var e;window.WHAT_TYPE.isMailChild()?e=opener.CoreMail.get("implicitPreferences"):e=CoreMail.get("implicitPreferences"),e.get("headerExpanded")||this.get("hasUnexpiredAttachments")?ViewMessage.replaceCollapsedHeaderWithExpandedHeaderView():ViewMessage.replaceExpandedHeaderWithCollapsedHeaderView()}}),ViewMessage.CollapsedHeaderView=SC.View.extend({useStaticLayout:YES,classNames:"static-header-view-collapsed",childViews:"leftWrapperView".w(),setLayerNeedsUpdate:function(){this.set("layerNeedsUpdate",!0)},leftWrapperView:SC.View.design({useStaticLayout:YES,isTextSelectable:YES,classNames:["header-view-field","header-view-collapsed"],childViews:"_MessageView.Collapsed.Order".loc("fromOrToLabel","fromOrToEmailWrapper","toRecipients").split("."),value:null,valueBinding:"ViewMessage.page.content"
,fromOrToLabel:SC.LabelView.design({tagName:"span",useStaticLayout:YES,isTextSelectable:YES,classNames:["header-view-compact-info","disclosure-header-names"],controlSize:SC.LARGE_CONTROL_SIZE,textAlign:SC.ALIGN_LEFT,localize:YES,messageListSelection:null,messageListSelectionBinding:"Message.messageController.content",collapsedContent:null,collapsedContentBinding:"ViewMessage.collapsedController.content",isVisibleBinding:SC.Binding.transform(function(e){var t=YES;if(Message.isMessageInDraftsOrSentFolder()===YES){var n=e;n&&n.get("length")===0&&(t=NO)}return t}).from(".collapsedContent"),value:function(){return Message.isMessageInDraftsOrSentFolder()===YES?"_MessageView.Collapsed.Sent.To":"_MessageView.Collapsed.From"}.property("messageListSelection")}),fromOrToEmail:SC.outlet("fromOrToEmailWrapper.fromOrToEmail"),fromOrToEmailWrapper:SC.View.design({useStaticLayout:YES,tagName:"span",layout:{top:1},classNames:["header-view-field-value"],childViews:["fromOrToEmail"],fromOrToEmail:ViewMessage.TokenItemView.extend({messageListSelection:null,messageListSelectionBinding:"Message.messageController.content",collapsedContent:null,collapsedContentBinding:"ViewMessage.collapsedController.content",isVisibleBinding:SC.Binding.transform(function(e){var t=YES;return Message.isMessageInDraftsOrSentFolder()===YES&&e&&e.get("length")!==1&&(t=NO),t}).from(".collapsedContent"),content:function(){var e;if(Message.isMessageInDraftsOrSentFolder()===YES){e=this.getPath("collapsedContent.firstObject");var t=e?e.get("guid"):null;t===CoreMail.UNDISCLOSED_RECIPIENTS_GUID&&e.set("email",ViewMessage.UNDISCLOSED_RECIPIENTS
)}else e=this.getPath("owner.owner.value.from");return e}.property("owner.owner.value","collapsedContent","contactDataRefreshed").cacheable()})}),toRecipients:SC.LabelView.design({classNames:["header-view-compact-info","to-recipients"],useStaticLayout:YES,isTextSelectable:YES,tagName:"span",localize:NO,controlSize:SC.LARGE_CONTROL_SIZE,collapsedContent:null,collapsedContentBinding:"ViewMessage.collapsedController.content",isVisibleBinding:SC.Binding.transform(function(e){var t=NO;if(e){var n=e.get("length");n>1&&(t=YES)}return t}).from(".collapsedContent"),value:function(){var e,t=this.get("collapsedContent"),n=Message.isMessageInDraftsOrSentFolder()?"":"_MessageView.Collapsed.to".loc();if(t){var r=t.get("length"),i=r%10;switch(YES){case r===0||r===1:e="";break;case i===1:e="_MessageView.Collapsed.EndingIn1Recipients".loc(n,r);break;case r===2:e="_MessageView.Collapsed.2Recipients".loc(n);break;case i===2:e="_MessageView.Collapsed.EndingIn2Recipients".loc(n,r);break;case i===3||i===4:e="_MessageView.Collapsed.EndingIn3,4Recipients".loc(n,r);break;case i>=5&&i<=9||i===0:e="_MessageView.Collapsed.EndingIn5,6,7,8,9,0Recipients".loc(n,r)}}return e}.property("collapsedContent")})})}),ViewMessage.LoadImagesView=SC.View.extend(ViewMessage.BannerMixin,{classNames:["load-image-background"],childViews:["loadImages"],hasUnloadedIMG:null,hasUnloadedIMGBinding:"Message.messageDetailController.hasUnloadedIMG",isMessageJunk:null,isMessageJunkBinding:"Message.messageController.isMessageJunk",isVisible:function(){var e=this.get("isMessageJunk"),t=this.get("hasUnloadedIMG");return t&&!e?YES:NO
}.property("hasUnloadedIMG","isMessageJunk"),loadImages:SC.View.extend({childViews:["imageLabel","loadImagesButton"],layout:{left:0,right:0,centerY:0,height:44},imageLabel:SC.LabelView.design({layout:{left:17,height:18,right:ViewMessage.metrics.LOAD_IMAGES_PANE_LOAD_IMAGES+25,centerY:0},localize:YES,value:"_MessageView.UnloadedImgs",classNames:"load-images-label"}),loadImagesButton:SC.ButtonView.design({layout:{right:25,width:ViewMessage.metrics.LOAD_IMAGES_PANE_LOAD_IMAGES,height:SC.REGULAR_BUTTON_HEIGHT,top:ViewMessage.metrics.LOAD_IMAGES_BUTTON_TOP},title:"_MessageView.LoadImages".loc(),classNames:["load-images-button"],controlSize:SC.SMALL_CONTROL_SIZE,themeName:"borderless",action:function(){var e;Message.messageDetailController.setPath("content.loadIMG",YES),window.WHAT_TYPE.isMailChild()&&(e=opener.CoreMail.store.find(opener.CoreMail.MessageDetail,Message.messageDetailController.get("guid")),e.set("loadIMG",YES)),ViewMessage.setPath("page.bodyMessage",Message.messageDetailController.getPath("content.body"))}})})}),ViewMessage.MessageBodyWebView=SC.WebView.extend(CoreMail.ScrollOnDragSelect,{useStaticLayout:YES,displayProperties:["body","headStyle","messageContent"],shouldAutoResize:YES,acceptsFirstResponder:YES,messageWidth:null,messageWidthBinding:"ViewMessage.page.messageScrollView.messageWidth",messageHeight:null,messageHeightBinding:"ViewMessage.page.messageScrollView.messageHeight",messageContent:null,messageContentBinding:"Message.messageDetailController.content",body:"",contentWidth:null,contentHeight:null,_enteredTarget:null,render:function(e,t){if(t)e.push('<iframe src="'+
this._iframeSrc+'"',' style="position: absolute; ',"width: 100%;","height: 100%;","border: 0px;","margin: 0px;","padding: 0px;","min-width: ",Global.metrics.MIN_MESSAGEVIEW_WIDTH,"px;",'" ','frameborder=0 scrolling="no">',"</iframe>");else{var n=this.get("body");if(n){var r=this._getBodyInnerHtml();this._prevRenderedBody&&this._prevRenderedBody===n&&r!==""?this._changeStyleAndResizeIframe():this._populateIframe()===NO&&this._populateIframe.invokeLater(this),this._prevRenderedBody=n}}},_changeStyleAndResizeIframe:function(){var e=this.$("iframe")[0],t=e?e.contentDocument:null;if(t&&t.body){var n=this.get("headStyle");SC.$(t).find("."+Message.DYNAMIC_STYLES_CLASS).replaceWith(n),this.invokeLast("iframeDidLoad")}},_populateIframe:function(){var e=this.get("body");e=this._highlightSearchTextInBody(e);var t=this.$("iframe")[0],n;t&&t.contentDocument&&(n=t.contentDocument);if(n){var r=this.get("head")+e+ViewMessage.MESSAGE_TAIL;try{var i=this.get("messageContent");if(SC.browser.isSafari&&i.get("pdfHtml")&&i.get("isMailDropMessage")===NO)try{var s=n.createElement("html"),o=n.childNodes;s.innerHTML=r,o&&o.length>0?n.replaceChild(s,o[0]):n.appendChild(s),CoreMail.errorHandler.recordStat("_STAT_MESSAGE_BODY_REPLACE_IFRAME_CHILD")}catch(u){SC.warn("ViewMessage.MessageBodyWebView._populateIframe: Rendering the content using replaceChild/appendChild failed with an exception: "+u),CoreMail.errorHandler.recordStat("_STAT_MESSAGE_BODY_WRITE_TO_IFRAME_DOC"),this._writeContentInDoc(n,r)}else this._writeContentInDoc(n,r);var a=n.querySelector("body");a&&/%/.test(a.style.width)&&(a.style.paddingLeft=0
,a.style.paddingRight=0);var f=$(n).find("img"),l=f.length;if(l>0){var c=SC.Event,h=0,p=this,d=function(){h++,h===l&&(h=0,p.iframeDidLoad())};c.add(f,"load",d),c.add(f,"error",d)}var v=t.contentWindow;if(n.documentElement){var m=n.documentElement,g=m.scrollWidth,y=m.scrollHeight;SC.browser.isMozilla===YES?g=v.document.body.scrollWidth:SC.browser.isIE===YES&&(g=m.scrollWidth+12,y=m.scrollHeight+5),this.set("contentWidth",g),this.set("contentHeight",y)}this.invokeLast("iframeDidLoad")}catch(b){var w="ViewMessage.MessageBodyWebView.render: Opening iFrame content window for View Message failed with an exception: "+b;CoreMail.errorHandler.logErrorTrap(w)}}return n?YES:NO},_writeContentInDoc:function(e,t){e.open(),e.write(t),e.close()},_getBodyInnerHtml:function(){var e="",t=this.$("iframe")[0],n=t?t.contentDocument:null,r=n?n.body:null;return r&&(e=r.innerHTML),e},head:function(){var e=Message.messageDetailController,t=e.get("doctype"),n=t+ViewMessage.MESSAGE_HEAD,r=e.get("messageStyles")||"",i=e.get("viewMessageSpecificStyles")||"",s=r+i;s&&(n+=s);var o=this.get("headStyle");return o&&o.length>0&&(n+=o),n+"</head>"}.property("headStyle"),headStyle:function(){var e=this.get("messageWidth"),t="";if(e>0){var n=e-40,r=e-45,i=this.get("messageHeight")-40;t='<style class="'+Message.DYNAMIC_STYLES_CLASS+'"> '+"img._auto-scale, img._stretch {max-width: "+n+"px !important;"+"width: auto !important; height: auto !important; } "+"span.body-text-content {white-space:pre-wrap;} "+"iframe.attachment-pdf {width: "+r+"px; height:"+i+"px;}"+"._stretch {max-width: "+n+"px  ; } "+"._mail-body {width:"+
n+"px; }"+"</style>"}return t}.property("messageWidth","messageHeight"),_iframeSrc:"about:blank",_lastObservedBody:"",iframeDidLoad:function(){var e=this.$("iframe")[0];if(e){var t=this._element;if(!t||t.length===0)t=this._element=this.$();t.width(0),t.height(0),this._initialScrollHeight=null,this.autoSizeMessage(),SC.IFrameRootResponder.setupResponder(e,this)}},autoSizeMessage:function(){var e=this.$("iframe")[0],t;e&&e.contentDocument&&(t=e.contentDocument);if(t&&t.documentElement){var n=ViewMessage.page.get("messageScrollView"),r=t.documentElement,i=n.get("contentView"),s=r.scrollWidth,o=this.get("shouldAutoResize");this._setPaddingforRotatedImages(r);var u=n.getPath("frame.width"),a=this._element;if(!a||a.length===0)a=this._element=this.$();s<=u?(a[0].style.width="100%",i.adjust("width",u)):(a[0].style.width="",i.adjust("width",r.scrollWidth)),o===YES&&(a.width(u),a.height(r.scrollHeight)),this.invokeLater(function(){var e=this._initialScrollHeight;if(i){var r=i.get("messageBodyView").$()[0],s=n.getPath("frame.height"),u=t.documentElement,f;a.height(0),e||(e=u.scrollHeight,this._initialScrollHeight=e),f=r.offsetTop+e,this.runningCountOfPaddingAdded>0&&(f+=this.runningCountOfPaddingAdded),f<=s?(f=s,a[0].style.height="100%",i.adjust("height",s)):i.adjust("height",f+10);if(o===YES){var l=u.scrollWidth;l>0&&(a.width(l),i.adjust("width",l)),a.height(f)}}},150)}},mouseDown:function(e){this._enteredTarget=e.target,e.allowDefault(),this._mouseDownEvt=e,this.becomeFirstResponder()},selectStart:function(e){return e.allowDefault(),YES},mouseUp:function(e){this._mouseDownEvt=null,this
._dragInProgress=NO;var t=e.target;if(t&&this._enteredTarget===t){var n=SC.$(t).closest("a")[0];if(n)if("_self"===n.target)this.adjustForAnchorNavigation(n);else{var r=n.href;r&&(r=r.trim(),r.match(/^mailto:/i)&&Global.mailToUrl(r.substr(7)))}}return NO},adjustForAnchorNavigation:function(e){var t=this.$("iframe")[0];if(!t)return;var n=e.href;if(!n||!n.trim())return;var r=n.lastIndexOf("#");if(r<0)return;n=n.substr(r+1);var i=t.contentWindow,s=i.document,o;o=s.getElementById(n),o||(o=s.getElementsByName(n),o&&o.length>0&&(o=o[0]));if(!o)return;var u=this.get("parentView").frame();ViewMessage.page.get("messageScrollView").scrollTo(0,u.y+o.offsetTop)},_setPaddingforRotatedImages:function(e){var t=0,n=e.getElementsByTagName("img"),r,i;for(var s=0,o=n.length;s<o;s++){r=SC.$(n[s]);var u=r.attr("class")||"";u=u.split(" ");if(u.indexOf("_auto-scale")>-1)if(u.indexOf(CoreMail.IMAGE_ORIENTATION_CLASS_PREFIX+"orientation-5")>-1||u.indexOf(CoreMail.IMAGE_ORIENTATION_CLASS_PREFIX+"orientation-8")>-1)i=r.width()-r.height(),i>0&&(t+=i,r.css("padding-bottom",i+"px"));else if(u.indexOf(CoreMail.IMAGE_ORIENTATION_CLASS_PREFIX+"orientation-6")>-1||u.indexOf(CoreMail.IMAGE_ORIENTATION_CLASS_PREFIX+"orientation-7")>-1)i=r.width()-r.height(),i>0&&(t+=i,r.css("padding-top",i+"px"))}this.runningCountOfPaddingAdded=t},_highlightSearchTextInBody:function(e){var t=Message.searchController.get("searchFieldValue");if(e&&t&&MessageList.get("searchField")===CoreMail.SEARCH_ANYFIELD){t=RegexHelper.escapeSpecialCharacters(SC.RenderContext.escapeHTML(t));var n=new RegExp(">[^><]*"+t+"[^><]*<","gi"),r=new RegExp
(t,"gi");e=e.replace(n,function(e){return e.replace(r,'<mark style="background-color: #ffeda4">$&</mark>')})}return e}}),ViewMessage.MessageBodyView=SC.View.extend(SC.StaticLayout,{useStaticLayout:YES,classNames:"message-body".w(),childViews:"messageBodyWebView messagePrintWebView".w(),messageBodyWebView:ViewMessage.MessageBodyWebView.extend({bodyBinding:"Message.messageDetailController.body",isTextSelectable:YES}),messagePrintWebView:SC.WebView.extend({layout:{top:0,left:0,height:0,width:0},value:""})}),ViewMessage.SubjectView=SC.View.extend(SC.StaticLayout,{useStaticLayout:YES,isTextSelectable:YES,subject:null,classNames:"static-header-view-subject",childViews:"top".w(),top:SC.LabelView.extend(SC.StaticLayout,Global.RTLMixin,{useStaticLayout:YES,isTextSelectable:YES,controlSize:SC.LARGE_CONTROL_SIZE,classNames:"header-view-subject",valueBinding:"ViewMessage.msgSubject",textAlign:SC.ALIGN_LEFT,render:function(e){arguments.callee.base.apply(this,arguments),e=this.renderRTLAttr(e)}})}),ViewMessage.BorderView=SC.View.extend(SC.StaticLayout,{useStaticLayout:YES,classNames:"border".w()}),ViewMessage.MessageScrollView=SC.ScrollView.extend(CW.FadingCaplessScrollerViewSupport,{horizontalScrollerView:CW.FadingCaplessScrollerView,verticalScrollerView:CW.FadingCaplessScrollerView,verticalScrollerLayout:{right:0,top:1,bottom:1},layout:function(){var e=ViewMessage.get("isPreview"),t=0;return e||(t=Global.metrics.DOCK_HEIGHT),{top:t}}.property(),borderStyle:SC.BORDER_NONE,hasHorizontalScroller:YES,hasVerticalScroller:YES,autohidesVerticalScroller:YES,autohidesHorizontalScroller:YES,verticalScrollerBottom
:function(){return SC.browser.isMac&&NO===this.get("isHorizontalScrollerVisible")&&SC.browser.isWebkit&&NO===window.statusbar.visible?13:0}.property("isHorizontalScrollerVisible"),contentView:SC.View.extend({layout:{top:0,left:0,right:0,bottom:0},childViews:["bannerUnderlay","subjectView","dateAndAttachmentsView","collapsedHeader","expandedHeader","borderView","messageBodyView"],displayProperties:["messageWidth"],acceptsFirstResponder:YES,moveUp:function(){var e=ViewMessage.getPath("page.messageScrollView");return 0===e.get("verticalScrollOffset")?NO:(e.scrollUpPage(),YES)},moveDown:function(){var e=ViewMessage.getPath("page.messageScrollView");return e.get("verticalScrollOffset")===e.get("maximumVerticalScrollOffset")?NO:(e.scrollDownPage(),YES)},keyDown:function(e){var t=e.commandCodes(),n=t[0],r=t[1],i=NO;return"ctrl_p"===n?(ViewMessage.dispatch({sig:"ctrl_p"}),i=YES):n==="backspace"||n==="delete"?(window.WHAT_TYPE.isMailChild()?opener.CoreMail.incrementUserStat(opener.CoreMail.STAT_KS_DELETE):CoreMail.incrementUserStat(CoreMail.STAT_KS_DELETE),ViewMessage.dispatch({sig:"delete"}),i=YES):n==="ctrl_down"&&CoreMail.ARCHIVE_GUID!==Message.messageController.getPath("folder.guid")?ViewMessage.dispatch({sig:"archive"}):"up"===n?i=this.moveUp(null,e):"down"===n?i=this.moveDown(null,e):!n&&" "===r?e.shiftKey?i=this.moveUp(null,e):i=this.moveDown(null,e):n==="ctrl_shift_u"?(ViewMessage.dispatch({sig:"setUnread"}),i=YES):n==="ctrl_shift_l"?(ViewMessage.dispatch({sig:"setFlag"}),i=YES):n==="ctrl_shift_j"?(ViewMessage.dispatch({sig:"setJunk"}),i=YES):n==="ctrl_shift_r"?ViewMessage.get
("isPreview")||(CoreMail.incrementUserStat(CoreMail.STAT_KS_REPLY),ViewMessage.dispatch({sig:"reply"}),i=YES):"alt_shift_n"===n?ViewMessage.get("isPreview")||(i=YES):"alt_ctrl_shift_d"===n&&(Global.downloadMessage(),i=YES),i},bannerUnderlay:SC.View.extend({classNames:"banner-underlay".w(),useStaticLayout:YES,messageDetailBinding:SC.Binding.oneWay("Message.messageDetailController"),hasUnloadedIMGBinding:SC.Binding.oneWay(".messageDetail.hasUnloadedIMG"),isJunkBinding:SC.Binding.oneWay("Message.messageController.isMessageJunk"),isSuspiciousAndNotTrustedBinding:SC.Binding.oneWay(".messageDetail.isSuspiciousAndNotTrusted"),canBeUnsubscribedBinding:SC.Binding.oneWay(".messageDetail.canBeUnsubscribed"),layout:function(){var e=this.get("page"),t=0;return this.get("isJunk")?t+=e.getPath("junkView.frame.height")||0:this.get("hasUnloadedIMG")&&(t+=e.getPath("loadImagesView.frame.height")||0),this.get("isSuspiciousAndNotTrusted")&&(t+=e.getPath("suspiciousMessageBannerView.frame.height")||0),this.get("canBeUnsubscribed")&&(t+=e.getPath("listUnsubscribeBannerView.frame.height")||0),{height:t}}.property("hasUnloadedIMG","isJunk","isSuspiciousAndNotTrusted","canBeUnsubscribed")}),subjectView:ViewMessage.SubjectView.design({useStaticLayout:YES}),dateAndAttachmentsView:SC.View.extend(SC.StaticLayout,{useStaticLayout:YES,childViews:["labelViewDate","attachmentsView"],layout:{top:0,left:0,height:21},classNames:"header-view-date-field".w(),labelViewDate:SC.LabelView.extend(SC.StaticLayout,{useStaticLayout:YES,isTextSelectable:YES,controlSize:SC.LARGE_CONTROL_SIZE,classNames:["header-view-info-date"
],valueBinding:".dateFormatValue",dateFormatValue:function(){var e=Message.messageController.getFormattedDate(NO);return e}.property("ViewMessage.page.content").cacheable()}),attachmentsView:SC.LabelView.design(SC.StaticLayout,{useStaticLayout:YES,classNames:["header-view-attachment-style"],controlSize:SC.LARGE_CONTROL_SIZE,contentBinding:"Message.messageController.content",hasUnexpiredAttachmentsBinding:SC.Binding.oneWay("Message.messageController.hasUnexpiredAttachments"),icon:function(){var e="";return this.get("hasUnexpiredAttachments")&&(e="attachment-image"),e}.property("hasUnexpiredAttachments").cacheable(),mouseDown:function(){if(this.getPath("page.messageScrollView.contentView.expandedHeader.isVisible")===NO){var e;ViewMessage.get("isPreview")===YES?e=CoreMail:e=opener.CoreMail,ViewMessage.replaceCollapsedHeaderWithExpandedHeaderView(),e.saveImplicitPreference("headerExpanded",YES),ViewMessage.invokeAutoSizeMessageAfterSomeDelay()}return YES}})}),collapsedHeader:ViewMessage.CollapsedHeaderView.extend({useStaticLayout:YES,acceptsFirstResponder:YES,content:null,contentBinding:"Message.messageDetailController.content"}),expandedHeader:ViewMessage.ExpandedHeaderView.extend({useStaticLayout:YES,content:null,contentBinding:"Message.messageDetailController.content",isVisible:NO}),borderView:ViewMessage.BorderView.extend({layout:{top:0,left:20,bottom:0,right:20}}),messageBodyView:ViewMessage.MessageBodyView.extend({useStaticLayout:YES})}),messageWidth:function(){var e=this.get("frame").width;return e>Global.metrics.MIN_MESSAGEVIEW_WIDTH?e:Global.metrics.MIN_MESSAGEVIEW_WIDTH
}.property("frame"),messageHeight:function(){var e=this.get("frame").height;return e>150?e:150}.property("frame")}),ViewMessage.SuspiciousMessageBannerView=SC.View.extend(ViewMessage.BannerMixin,{childViews:["suspiciousMessageWrapper","enableDownloadLinksButton"],classNames:"suspicious-message-banner",layout:{left:0,right:0,height:ViewMessage.metrics.SUSPICIOUS_MESSAGE_BANNER_HEIGHT,minWidth:ViewMessage.metrics.SUSPICIOUS_MESSAGE_BANNER_MIN_WIDTH},isVisible:NO,isVisibleBinding:SC.Binding.oneWay("Message.messageDetailController.isSuspiciousAndNotTrusted"),suspiciousMessageWrapper:SC.View.extend({childViews:["suspiciousMessageWarning"],classNames:"suspicious-message-wrapper",layout:{left:17,height:44},adjustRight:function(){var e=this.getPath("parentView.enableDownloadLinksButton.frame.width");this._prevEnableLinksButtonWidth!==e&&(this.adjust("right",e+10),this._prevEnableLinksButtonWidth=e)}.observes("parentView.enableDownloadLinksButton.frame"),suspiciousMessageWarning:SC.LabelView.design({value:"_MessageView.SuspiciousMessageWarning",classNames:"suspicious-message-warning",localize:YES,escapeHTML:NO})}),enableDownloadLinksButton:SC.ButtonView.design(SC.AutoResize,{layout:{right:7,height:SC.REGULAR_BUTTON_HEIGHT,top:ViewMessage.metrics.SUSPICIOUS_MESSAGE_ENABLE_LINKS_BUTTON_TOP},classNames:"enable-download-links-button",title:"_MessageView.EnableDownloadLinks".loc(),controlSize:SC.SMALL_CONTROL_SIZE,themeName:"borderless",action:function(){CoreMail.errorHandler.recordStat("_enabled_links_in_message");var e=Message.messageDetailController;e.set("isTrusted",YES);if(window.WHAT_TYPE
.isMailChild()){var t=opener.CoreMail;t.store.find(t.MessageDetail,e.get("guid")).set("isTrusted",YES)}}})}),ViewMessage.ListUnsubscribeBannerView=SC.View.extend(ViewMessage.BannerMixin,{childViews:["listUnsubscribeWrapper","rightButtonsView"],classNames:"list-unsubscribe-banner",layout:function(){var e;return ViewMessage.getPath("page.loadImagesView.isVisible")?e={left:0,right:0,height:ViewMessage.metrics.LIST_UNSUBSCRIBE_STACKED_BANNER_HEIGHT,minWidth:ViewMessage.metrics.LIST_UNSUBSCRIBE_BANNER_MIN_WIDTH}:e={left:0,right:0,height:ViewMessage.metrics.LIST_UNSUBSCRIBE_BANNER_HEIGHT,minWidth:ViewMessage.metrics.LIST_UNSUBSCRIBE_BANNER_MIN_WIDTH},e}(),isVisible:NO,isVisibleBinding:SC.Binding.oneWay("Message.messageDetailController.canBeUnsubscribed"),listUnsubscribeWrapper:SC.View.extend({childViews:["listUnsubscribeMessage"],classNames:"list-unsubscribe-wrapper",layout:{left:17,height:44},rightButtonsViewBinding:SC.Binding.oneWay(".owner.rightButtonsView"),adjustRight:function(){var e=this.get("rightButtonsView"),t=e.getPath("unsubscribeButton.frame.width")+e.getPath("dismissBannerButton.frame.width");t&&this._prevRightButtonsViewWidth!==t&&(this.adjust("right",t+10),this._prevRightButtonsViewWidth=t)}.observes("rightButtonsView.unsubscribeButton.frame","rightButtonsView.dismissBannerButton.frame"),listUnsubscribeMessage:SC.LabelView.design({value:"_MessageView.ListUnsubscribe.Banner.Message",classNames:"list-unsubscribe-message",localize:YES,escapeHTML:NO})}),rightButtonsView:SC.View.extend({layout:{left:"auto",right:0,height:30,centerY:0},classNames:"text-align-right".w(),childViews
:["unsubscribeButton","dismissBannerButton"],unsubscribeButton:SC.ButtonView.design({layout:{right:0,width:"auto",height:SC.REGULAR_BUTTON_HEIGHT,top:ViewMessage.metrics.LIST_UNSUBSCRIBE_BUTTON_TOP},classNames:["unsubscribe-button","button-in-between","bar-after"],title:"_MessageView.ListUnsubscribe.Banner.Button.Unsubscribe".loc(),controlSize:SC.SMALL_CONTROL_SIZE,useStaticLayout:YES,tagName:"span",themeName:"borderless",action:function(){var e=Message.messageDetailController,t=ViewMessage.getOriginalRecipientEmailAddress(e.get("content")),n=SC.RenderContext.escapeHTML,r=e.get("listUnsubscribeMailTo"),i=r.emailAddress,s=Message.messageController.get("subject");s===null&&(s="");var o="_MessageView.ListUnsubscribe.Email.Body.Text".loc({messageSubject:s}),u='<div class="list-unsubscribe-preview"><div class="list-unsubscribe-preview-spacer"><div class="list-unsubscribe-preview-text">'+"_ComposeMessage.To".loc()+"&nbsp;"+n(i)+"<br><br>"+"_ComposeMessage.Subject".loc()+"&nbsp;"+n(s)+"<br><br>"+n(o)+"</div></div></div>";CoreMail.errorHandler.handleError({keyString:"_MessageView.ListUnsubscribe.Confirmation",descriptionLocParams:{toEmailAddress:n(t)},extraWide:YES,rightButton:{title:"_MessageView.ListUnsubscribe.Banner.Button.Unsubscribe".loc(),action:function(){CoreMail.errorHandler.removeErrorPane(this),CoreMail.errorHandler.recordStat("_list_unsubscribe_accepted");var e=Message.messageDetailController;e.set("listUnsubscribeStatus",CoreMail.MESSAGE_LIST_UNSUBSCRIBE_STATUS_ACCEPTED);if(window.WHAT_TYPE.isMailChild()){var n=opener.CoreMail;n.store.find(n.MessageDetail,e.get("guid")
).set("listUnsubscribeStatus",CoreMail.MESSAGE_LIST_UNSUBSCRIBE_STATUS_ACCEPTED)}var u=ViewMessage.listUnsubscribeHTMLEmailBody(o);r&&ViewMessage.dispatch({sig:"acceptListUnsubscribe",from:t,to:i,subject:s,textBody:o,htmlBody:u,listUnsubscribeKey:e.get("listUnsubscribeKey")})}},middleButton:{title:"_Common.Button.Cancel".loc(),action:function(){CoreMail.errorHandler.removeErrorPane(this)}},extraView:CW.ScrollView.extend(CW.FadingCaplessScrollerViewSupport,CW.Alert.ExtraViewAutoResizingSupport,{verticalScrollerView:CW.FadingCaplessScrollerView,hasHorizontalScroller:NO,hasVerticalScroller:YES,autohidesVerticalScroller:YES,layout:{right:25,height:154},classNames:["list-unsubscribe-preview-container"],contentView:SC.View.design({useStaticLayout:YES,render:function(e,t){return t&&e.push(u),arguments.callee.base.apply(this,arguments)}})}),extraViewPadding:{top:12,bottom:139}})}}),dismissBannerButton:SC.ButtonView.design({layout:{right:0,width:"auto",height:SC.REGULAR_BUTTON_HEIGHT,top:ViewMessage.metrics.LIST_UNSUBSCRIBE_BUTTON_TOP},classNames:["unsubscribe-dismiss-button","button-aligned-right"],title:"_MessageView.ListUnsubscribe.Banner.Button.Dismiss".loc(),controlSize:SC.SMALL_CONTROL_SIZE,useStaticLayout:YES,tagName:"span",themeName:"borderless",action:function(){CoreMail.errorHandler.recordStat("_list_unsubscribe_ignored");var e=Message.messageDetailController;e.set("listUnsubscribeStatus",CoreMail.MESSAGE_LIST_UNSUBSCRIBE_STATUS_IGNORED);if(window.WHAT_TYPE.isMailChild()){var t=opener.CoreMail;t.store.find(t.MessageDetail,e.get("guid")).set("listUnsubscribeStatus",CoreMail.
MESSAGE_LIST_UNSUBSCRIBE_STATUS_IGNORED)}ViewMessage.dispatch({sig:"ignoreListUnsubscribe",listUnsubscribeKey:e.get("listUnsubscribeKey")})}})})}),ViewMessage.page=SC.Page.design({webViewOutlet:SC.outlet("messageScrollView.contentView.messageBodyView.messageBodyWebView"),emailTokenOutlet:SC.outlet("messageScrollView.contentView"),messagePrintWebViewOutlet:SC.outlet("messageScrollView.contentView.messageBodyView.messagePrintWebView"),spinnerLoading:YES,fromName:"",bodyMessage:null,content:null,spinnerView:SC.View.extend({childViews:"showSpinner loadingLabel".w(),showSpinner:SC.View.extend({classNames:"spinner-32px-ffffff"}),loadingLabel:SC.LabelView.design(SC.StaticLayout,{classNames:"spinner-text",layout:{left:46},value:"_MessageView.LoadingMail".loc()})}),toolbar:ViewMessage.ToolbarView.extend({layout:{top:0,left:0,height:Global.metrics.DOCK_HEIGHT_WITH_SHADOW,right:0},content:null,useStaticLayout:YES,contentBinding:"Message.messageController.content"}),replyMenu:CW.AutoResizingMenuPane.extend({classNames:"reply-menu".w(),controlSize:SC.LARGE_CONTROL_SIZE,items:null,isEnabled:YES,contentView:SC.View.extend({layout:{top:0,left:0,bottom:0,right:0}})}),loadImagesView:ViewMessage.LoadImagesView.extend({useStaticLayout:YES,layout:{left:0,height:ViewMessage.metrics.JUNK_PANE_IMAGE_PANE_HEIGHT,right:0}}),junkView:ViewMessage.JunkPaneView.extend({useStaticLayout:YES,layout:{left:0,height:ViewMessage.metrics.JUNK_PANE_IMAGE_PANE_HEIGHT,right:0},content:null,contentBinding:"Message.messageController.content"}),suspiciousMessageBannerView:ViewMessage.SuspiciousMessageBannerView.extend
({useStaticLayout:YES}),listUnsubscribeBannerView:ViewMessage.ListUnsubscribeBannerView.design({useStaticLayout:YES}),moreHideView:ViewMessage.DisclosureView.extend({}),messageScrollView:ViewMessage.MessageScrollView.design({})}),ViewMessage.MultiSelectionActionsButtonView=SC.SegmentView.extend({renderDelegateName:"multiSelectionActionsButtonRenderDelegate"}),ViewMessage.MultiSelectionActionsView=SC.View.extend({layout:{centerY:0,height:310},selection:null,selectionBinding:"Message.messageListController.selection",childViews:["multiSelectionImageContainer","multiSelectionCaption","multiSelectionHorizontalSeparator","multiSelectionActionsButtons"],classNames:["multi-selection-actions-view"],multiSelectionImageContainer:SC.ContainerView.design({nowShowing:null,zeroMessagesSelectedImageView:SC.ImageView.create({value:" zero-messages-selected",layout:{centerX:0,height:157,width:155,top:32}}),twoMessagesSelectedImageView:SC.ImageView.create({value:"two-messages-selected",layout:{centerX:-31,height:157,width:212,top:32}}),multipleMessagesSelectedImageView:SC.ImageView.create({value:"multiple-messages-selected",layout:{centerX:-31,height:157,width:212,top:32}}),init:function(){arguments.callee.base.apply(this,arguments),this.set("nowShowing",this.zeroMessagesSelectedImageView)},selectionDidChange:function(){var e=Message.messageListController.getPath("selection.length");e!==1&&(e===0?this.set("nowShowing",this.zeroMessagesSelectedImageView):e===2?this.set("nowShowing",this.twoMessagesSelectedImageView):e>2&&this.set("nowShowing",this.multipleMessagesSelectedImageView))}.observes(".owner.selection"
)}),multiSelectionCaption:SC.LabelView.design({needsEllipsis:YES,localize:YES,textAlign:SC.ALIGN_CENTER,classNames:"multi-selection-caption".w(),layout:{height:25,top:203,centerX:0,left:0,right:0},value:"",valueBinding:SC.Binding.transform(function(e){var t,n=e.get("length"),r=n%10;if(n>=0)switch(YES){case n===0:t="_MessageView.MultiSelection.NoneSelected".loc();break;case n===1:t=" ";break;case n===2:t="_MessageView.MultiSelection.2Selected".loc({messagesSelected:n});break;case n===3||n===4:t="_MessageView.MultiSelection.3,4Selected".loc({messagesSelected:n});break;case n>=5&&n<=10:t="_MessageView.MultiSelection.5,6,7,8,9,10Selected".loc({messagesSelected:n});break;case r===1&&n>20:t="_MessageView.MultiSelection.EndingIn1GreaterThan20Selected".loc({messagesSelected:n});break;case r>=2&&r<=4&&n>20:t="_MessageView.MultiSelection.EndingIn2,3,4GreaterThan20Selected".loc({messagesSelected:n});break;default:t="_MessageView.MultiSelection.Default".loc({messagesSelected:n})}return t}).from(".owner.selection")}),multiSelectionHorizontalSeparator:SC.View.design({layout:{top:248,height:1,width:451,centerX:0},classNames:["horizontal-separator"],isVisibleBinding:".owner.multiSelectionActionsButtons.isVisible"}),multiSelectionActionsButtons:SC.SegmentedView.design({didCreateLayer:function(){ViewMessage.maxButtonWidth()},layout:{height:30,top:255},themeName:"borderless",classNames:"multi-selection-actions-button".w(),segmentViewClass:ViewMessage.MultiSelectionActionsButtonView,isVisibleBinding:SC.Binding.transform(function(e){var t=e.get("length"),n;return t>1?n=YES:n=NO,n}).from(".owner.selection"
),items:function(){return this._itemsArray=[],this._itemsArray.push(SC.Object.create({titleBinding:"ViewMessage.multiSelectionController.titleForMarkAsReadUnread",target:ViewMessage,action:"markAsReadUnread",widthBinding:"ViewMessage.multiSelectionController.segmentWidth"}),SC.Object.create({titleBinding:"ViewMessage.multiSelectionController.titleForMarkAsFlaggedUnflagged",target:ViewMessage,action:"markAsFlaggedUnflagged",widthBinding:"ViewMessage.multiSelectionController.segmentWidth"}),SC.Object.create({titleBinding:"ViewMessage.multiSelectionController.titleForMarkAsJunkNotJunk",target:ViewMessage,action:"markAsJunkNotJunk",widthBinding:"ViewMessage.multiSelectionController.segmentWidth",isEnabledBinding:"Message.messageListController.isJunkingEnabled"})),this._itemsArray}.property(),itemIsEnabledKey:"isEnabled",itemTitleKey:"title",itemValueKey:"title",itemWidthKey:"width",itemTargetKey:"target",itemActionKey:"action",allowsEmptySelection:YES,shouldHandleOverflow:NO,align:SC.ALIGN_CENTER,controlSize:SC.LARGE_CONTROL_SIZE})}),SC.BaseTheme.multiSelectionActionsButtonRenderDelegate=SC.BaseTheme.segmentRenderDelegate.create({className:"segment button segment-separator"}),ViewMessage.previewPage=SC.Page.create({webViewOutlet:SC.outlet("messageScrollView.contentView.messageBodyView.messageBodyWebView"),multiSelectionActionsOutlet:SC.outlet("multiSelectionActions.multiSelectionActionsButtons"),emailTokenOutlet:SC.outlet("messageScrollView.contentView"),messagePrintWebViewOutlet:SC.outlet("messageScrollView.contentView.messageBodyView.messagePrintWebView"),isQuickContactSpinnerView
:YES,isShowAddContactView:NO,isShowAddContactConfirmView:NO,spinnerLoading:YES,fromName:"",lastName:"",bodyMessage:null,content:null,msgSubject:null,splitterPosition:null,splitterPositionBinding:"MessageList.splitterPosition",gutterView:SC.View.design({useStaticLayout:NO,isVisible:NO,classNames:"message-preview-gutter",layout:{top:0,left:0,bottom:0,width:150},mouseDown:function(){return SC.browser.isWebkit||this.set("isVisible",NO),YES}}),spinnerView:SC.View.extend({layout:{centerY:0,centerX:0,width:ViewMessage.metrics.SPINNER_VIEW_WIDTH,height:50},childViews:"showSpinner loadingLabel".w(),showSpinner:SC.View.extend({classNames:"spinner-32px-ffffff"}),loadingLabel:SC.LabelView.design({classNames:"spinner-text",layout:{left:46,top:10},value:"_MessageView.LoadingMail".loc()})}),junkView:ViewMessage.JunkPaneView.extend(SC.StaticLayout,{useStaticLayout:YES,layout:{left:0,height:ViewMessage.metrics.JUNK_PANE_IMAGE_PANE_HEIGHT,right:0},content:null,contentBinding:"Message.messageController.content"}),loadImagesView:ViewMessage.LoadImagesView.extend({useStaticLayout:YES,layout:{left:0,height:ViewMessage.metrics.JUNK_PANE_IMAGE_PANE_HEIGHT,right:0}}),suspiciousMessageBannerView:ViewMessage.SuspiciousMessageBannerView.extend({useStaticLayout:YES}),listUnsubscribeBannerView:ViewMessage.ListUnsubscribeBannerView.design({useStaticLayout:YES}),moreHideView:ViewMessage.DisclosureView.extend({}),messageScrollView:ViewMessage.MessageScrollView.design({}),multiSelectionActions:ViewMessage.MultiSelectionActionsView.design({isVisibleBinding:SC.binding("Global.isVIPWelcomePageVisible").not()})}
),typeof MX=="undefined"&&(MX={}),typeof mx=="undefined"&&(mx={}),mx={build:"20101021.1100",uptimeBasis:null,uptime:function(){return((new Date).getTime()-this.uptimeBasis.getTime())/1e3},_:function(e){return typeof e=="String"?mx.ld[e]=0:e&&mx.performSelector("classDidFinishLoading",e),0},entry:function(e,t,n){var r;if(e._isa)r=e._isa;else{if(!e.prototype||!e.prototype._isa)return mx.console.error("mx.entry class has no _isa member to associate to selector: "+t),mx.console.error(e),null;r=e.prototype._isa}var i=r+"."+t+" ";return n||mx.console.debug(i),i},raise:function(e){return mx.console.error(e),0},exec:function(source){if(mx.ifstring(source)&&mx.ifval(source))try{return eval(source)}catch(e){mx.raise(e)}return 0},dereference:function(e){if(!e)return null;var t=e.split("."),n=t.length;if(!n)return null;var r=MX.Runtime.global[t[0]];if(!r)return null;switch(n){case 1:return t[0]!=="this"?r:null;case 2:return r[t[1]];case 3:return r[t[1]][t[2]];case 4:return r[t[1]][t[2]][t[3]]}return null},ifdef:function(e){return e===undefined||e==="undefined"?0:1},ifndef:function(e){return mx.ifdef(e)?0:1},ifval:function(e){return e?1:0},ifnval:function(e){return mx.ifval(e)?0:1},ifattr:function(e,t){return mx.ifnval(e)||mx.ifnval(t)?0:mx.ifdef(e[t])},ifarray:function(e){return e instanceof Array},ifstring:function(e){return mx.type(e)==="string"},iftype:function(e,t){var n=mx.type(e);return n===t?1:0},isattr:function(e,t){if(!mx.ifattr(e,t)){var n="mx.isattr object ["+e+"] has no attribute ["+t+"]";return mx.console.error(n),mx.raise(n),0}return 1},istype:function(e,t){if(!mx.iftype(e
,t)){var n="mx.istype incompatible argument type ["+mx.type(e)+"] supplied for expected type ["+t+"]";return mx.console.error(n),mx.raise(n),0}return 1},isnum:function(e){if(isNaN(e)){var t="mx.isnum incompatible argument type ["+typeof e+"] supplied for expected type Number";return mx.console.error(t),mx.raise(t),0}return 1},isarray:function(e){if(!mx.ifarray(e)){var t="mx.isarray incompatible argument type ["+typeof e+"] supplied for expected type Array";return mx.console.error(t),mx.raise(t),0}return 1},isval:function(e){if(mx.ifnval(e)){var t="mx.isval invalid value ["+e+"] supplied for expected non-NULL type";return mx.console.error(t),mx.raise(t),0}return 1},isSC:function(){return mx.isSC$?mx.isSC$:mx.isSC$=mx.ifdef(typeof SC)},ifSC:function(e,t){return mx.isSC()?e:t},type:function(e){if(mx.ifnval(e))return"NULL";if(mx.ifdef(typeof e._isa))return e._isa;if(mx.ifdef(typeof e._kvo_cache))return"SC";if(mx.ifdef(typeof e.nodeName))return e.nodeName.toUpperCase().replace("#","");var t=typeof e;return t==="object"?e+"":t},expando:function(e,t,n){var r=0;try{var i,s;for(i in e){if(r++===n)break;s=t.pop();if(!s)try{delete e.key}catch(o){}else e[i]=s}return e}catch(u){return mx.raise("mx.expando hash size is not consistent with array size"),null}},superCall:function(e,t){return t.callee.base.apply(e,t)},respondsToSelector:function(e,t){return t&&t[e]instanceof Function},performSelector:function(e,t){if(mx.respondsToSelector(e,t))switch(arguments.length){case 3:return t[e](arguments[2]);case 4:return t[e](arguments[2],arguments[3]);case 5:return t[e](arguments[2],arguments[3],arguments
[4]);case 6:return t[e](arguments[2],arguments[3],arguments[4],arguments[5]);default:return t[e]()}return 0},performSelectorOnWait:function(e,t,n,r){return MX.Runtime.setTimeout(t,e,r,n)},performSelectorHandled:function(e,t){try{if(mx.respondsToSelector(e,t))switch(arguments.length){case 3:return t[e](arguments[2]);case 4:return t[e](arguments[2],arguments[3]);case 5:return t[e](arguments[2],arguments[3],arguments[4]);case 6:return t[e](arguments[2],arguments[3],arguments[4],arguments[5]);default:return t[e]()}}catch(n){return 0}return 0},autoretain:function(e,t,n){return n&&mx.performSelector("retain",n),mx.performSelector("release",e[t]),e[t]=n},isMSIE:function(){return mx.isMSIE$?mx.isMSIE$:mx.isMSIE$=mx.ifdef(typeof ActiveXObject)},isSafari:function(){return mx.isSafari$?mx.isSafari$:mx.isSafari$=mx.ifdef(typeof WebKitPoint)||mx.ifdef(typeof MX.Runtime.navigator.vendor)&&!MX.Runtime.navigator.vendor.indexOf("Apple")},isSafari3:function(){return mx.isSafari3$?mx.isSafari3$:mx.isSafari3$=mx.isSafari()&&!mx.browserVersion().indexOf("3")},isChrome:function(){return mx.isChrome$?mx.isChrome$:mx.isChrome$=mx.ifdef(typeof chromium)?1:mx.ifdef(typeof MX.Runtime.navigator.vendor)&&!MX.Runtime.navigator.vendor.indexOf("Google")},isOpera:function(){return mx.isOpera$?mx.isOpera$:mx.isOpera$=mx.ifdef(typeof opera)},isMozilla:function(){return mx.isMozilla$?mx.isMozilla$:mx.isMozilla$=mx.ifdef(typeof netscape)},isXPC:function(){return mx.isXPC$?mx.isXPC$:mx.isXPC$=mx.ifdef(typeof quit)},browserVersion:function(){if(mx.browserVersion$)return mx.browserVersion$;var e=MX.Runtime.window.
navigator.userAgent,t=new RegExp("(?:Version/|MSIE |Firefox/|Chrome/)(\\d+\\.\\d+\\.?\\d*\\.?\\d*)","gi"),n=t.exec(e);return mx.browserVersion$=n?n[1]:0},generateUUID:function(){var e=new Array(36),t;for(t=0;t<36;t++)switch(t){case 8:case 13:case 18:case 23:e[t]="-";break;default:e[t]="ABCDEF0123456789".charAt(Math.floor(Math.random()*16))}return e.join("")},hasMessage:function(){return mx.hasMessage$?mx.hasMessage$:mx.hasMessage$=mx.ifdef(typeof postMessage)},hasBinary:function(){return mx.hasBinary$?mx.hasBinary$:mx.hasBinary$=MX.Runtime.xmlHttpRequest().sendAsBinary||mx.isSafari()&&!mx.isSafari3()||mx.isChrome()?1:0},hasSocket:function(){return mx.ifdef(typeof WebSocket)},isWorker:function(){return mx.isWorker$?mx.isWorker$:mx.isWorker$=mx.ifdef(typeof importScripts)},classDidFinishLoading:function(){return this.uptimeBasis=new Date,MX.SC=mx.isSC()?SC:{},mx.ld={},mx.include=function(e){return mx.isSC()||mx.ifndef(mx.ld[e])&&(mx.ld[e]=0,MX.Runtime.loadLibrary(e)),0},sc_require=mx.include,0}},mx.classDidFinishLoading(),MX.Runtime={_isa:"MX.Runtime",enabled:0,window:null,document:null,navigator:null,global:null,headAppend:function(e){var t=mx.entry(this,"headAppend",1),n=this.elementByTag("head");return n?this.elementAppend(n.item(0),e):null},documentAppend:function(e){var t=mx.entry(this,"documentAppend",1);return this.documument?this.elementAppend(this.document.body,e):null},elementAppend:function(e,t){var n=mx.entry(this,"elementAppend",1);if(!e)return mx.console.error(n+"element is NULL"),null;if(!t)return mx.console.error(n+"child is NULL"),null;try{return e.appendChild
(t)}catch(r){return mx.raise(n+"unable to append element due to error ["+r+"]"),null}},removeElement:function(e){var t=mx.entry(this,"removeElement",1);if(e&&mx.ifdef(typeof e.parentNode)){var n=e.parentNode;if(n)try{return n.removeChild(e)}catch(r){}}return e},elementCreate:function(e){var t=mx.entry(this,"elementCreate"),n=this.document;return n?this.elementCreateOnDocument(e,n):(mx.console.error(t+"unable to create element "+e),null)},elementCreateOnDocument:function(e,t){var n=mx.entry(this,"elementCreateOnDocument");if(!this.enabled)return null;try{return t.createElement(e)}catch(r){return mx.console.error(n+"unable to create element "+e+" due to error ["+r+"]"),null}},elementById:function(e){var t=mx.entry(this,"elementById",1);return this.documentElementById(this.document,e)},documentElementById:function(e,t){var n=mx.entry(this,"documentElementById",1);if(!this.enabled)return null;try{return mx.ifdef(typeof e.getElementById)?e.getElementById(t):e.all[t]}catch(r){return mx.console.error(n+"unable to lookup element ID "+t+" due to error ["+r+"]"),null}},elementByTag:function(e){var t=mx.entry(this,"elementByTag",1);if(!this.enabled)return null;var n=this.document;try{return mx.ifdef(typeof n.getElementsByTagName)?n.getElementsByTagName(e):n.all[e]}catch(r){return mx.console.error(t+"unable to lookup element tag "+e+" due to error ["+r+"]"),null}},elementBody:function(e){var t=mx.entry(this,"elementBody",1);return mx.ifdef(typeof e.document.body)&&mx.ifval(e.document.body)?e.document.body:e.document},iframeWindow:function(e){var t=mx.entry(this,"iframeWindow");if(!e)return mx
.raise(t+"undefined frame element"),null;if(mx.ifnval(e))return mx.raise(t+"null frame element"),null;try{return e.hasOwnProperty("contentWindow")?e.contentWindow:e}catch(n){return mx.raise(t+"accessing iframe window raised error ["+n+"]"),null}},iframeDocument:function(e){var t=mx.entry(this,"iframeDocument");if(!e)return mx.raise(t+"undefined frame element"),null;if(mx.ifnval(e))return mx.raise(t+"null frame element"),null;try{return mx.ifdef(typeof e.documentElement)?e.documentElement:mx.ifdef(typeof e.contentWindow)?e.contentWindow.document:(mx.console.error(t+"unable to locate iframe document"),e.document)}catch(n){return mx.raise(t+"accessing iframe document raised error ["+n+"]"),null}},frameDocument:function(e){var t=mx.entry(this,"frameDocument",1);try{return mx.ifdef(typeof e.contentDocument)?e.contentDocument:e.contentWindow.document}catch(n){return mx.console.error(t+"unable to lookup frame document due to error ["+n+"]"),null}},setInterval:function(e,t,n,r){var i=mx.entry(this,"setInterval",1),s=function(n){mx.performSelector(t,e,n)};return mx.ifdef(typeof setInterval)?setInterval(s,n,r):MX.XPC?MX.XPC.setInterval(s,n,r):null},setTimeout:function(e,t,n,r){var i=mx.entry(this,"setTimeout",1),s=function(n){mx.performSelector(t,e,n)};return mx.ifdef(typeof setTimeout)?setTimeout(s,n,r):MX.XPC?MX.XPC.setTimeout(s,n,r):null},xmlHttpRequest:function(){var e=mx.entry(this,"xmlHttpRequest",1);if(mx.ifdef(typeof XMLHttpRequest))return new XMLHttpRequest;if(mx.isMSIE())try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{return new ActiveXObject("Microsoft.XMLHTTP")
}catch(n){}}else if(MX.XPC)return new MX.XPC.xmlHttpRequest;return mx.console.error(e+"unable to obtain XHR object"),null},loadLibrary:function(e){if(typeof e=="undefined"||e==="undefined")return;var t="../../../";MX.Bootstrap&&(t=MX.Bootstrap.libroot);var n=e.lastIndexOf("/");e.substring(n);var r=t+"/"+e+".js";MX.Runtime.loadScript(r)},loadScript:function(urlString){var SEL=this._isa+".loadScript ";if(typeof navigator=="undefined")return load(urlString),0;if(typeof importScripts!="undefined")return importScripts(urlString),0;var xhr=this.xmlHttpRequest();xhr.open("GET",urlString,!1),xhr.send(null);if(xhr.status!==200){var msg="ERROR: "+SEL+"could not load resouce "+urlString;alert(msg),mx.raise(msg)}return eval(xhr.responseText)},eventListenerAdd:function(e,t,n){var r=mx.entry(this,"eventListenerAdd");mx.istype(e,"MX.Element");var i=e.element;try{if(mx.ifattr(i,"addEventListener"))mx.console.debug(r+"method: addEventListener "+t),i.addEventListener(t,n,!1);else if(mx.ifattr(i,"attachEvent"))mx.console.debug(r+"method: attachEvent "+t),i.attachEvent("on"+t,n);else{if(!mx.isMSIE())return mx.raise(r+"events not supported"),1;mx.console.debug(r+"method: on<event> "+t);try{i.setAttribute("on"+t,n)}catch(s){i["on"+t]=n}}}catch(o){return mx.raise(r+"event add raised error ["+o+"]"),1}return 0},eventListenerRemove:function(e,t,n){var r=mx.entry(this,"eventListenerRemove");mx.istype(e,"MX.Element");var i=e.element;try{if(mx.ifattr(i,"removeEventListener")&&!mx.isMSIE())mx.console.debug(r+"method: removeEventListener "+t),i.removeEventListener(t,n,!1);else if(mx.ifattr(i,"detachEvent"
))mx.console.debug(r+"method: detachEvent "+t),i.detachEvent("on"+t,n);else{if(!mx.isMSIE())return mx.raise(r+"events not supported"),1;mx.console.debug(r+"method: on<event> "+t);try{i.removeAttribute("on"+t)}catch(s){i["on"+t]=null}}}catch(o){return mx.raise(r+"event add raised error ["+o+"]"),1}return 0},eventHandler:function(e,t,n,r,i){var s=mx.entry(this,"eventHandler");!mx.ifattr(e,n)&&mx.ifattr(t,"srcElement")&&(e=t.srcElement);if(mx.ifattr(e,n)){var o=e[n];if(mx.ifattr(o,r))return mx.ifdef(typeof i)?mx.performSelector(r,o,t,i):mx.performSelector(r,o,t);mx.console.error(s+"selector reference not found ["+r+"]")}else mx.console.error(s+"receiver reference not found ["+n+"]");return 1},callbackOnceFunction:function(e,t,n,r,i){var s=mx.entry(this,"callbackOnceFunction"),o=t.hash();return e[o]=t,function(){mx.performSelector(n,this[o],r,i);try{this[o]=null,delete this[o]}catch(e){}}},classDidFinishLoading:function(){var e=mx.entry(this,"classDidFinishLoading",1);return mx.ifdef(typeof window)?(this.window=window,this.global=window):this.window=null,mx.ifdef(typeof navigator)?this.navigator=navigator:this.navigator={},mx.ifdef(typeof document)?(this.enabled=1,this.document=document):(this.enabled=0,this.document=null),this.global||(typeof importScripts!="undefined"?this.global=MX.global:this.global=window),MX.OrderedAscending=-1,MX.OrderedSame=0,MX.OrderedDescending=1,0}},mx._(MX.Runtime),typeof load!="undefined"&&(MX.Runtime.global=this),typeof mx=="undefined"&&(mx={}),typeof MX=="undefined"&&(MX={}),MX.Config={_isa:"MX.Config",enableLog:0,enableSounds:0,enableStatusBar:0,
enableGC:0,urlBlankImage:function(){return mx.isSC()?SC.BLANK_IMAGE_URL:"/favicon.ico"},disallowedFileTypes:function(){var e=mx.entry(this,"disallowedFileTypes"),t=mx.dereference("Attachments.INVALID_FILE_EXTS");return t},maxUploadSize:function(){var e=mx.entry(this,"maxUploadSize"),t=mx.dereference("Attachments.MAX_IMAP_UPLOAD_SIZE");if(t){var n=parseInt(t,10);return isNaN(n)?0:n}return 0}},mx._("mx/foundation/mx_log"),MX.Log={_isa:"MX.Log",LEVEL:["error","warn","info","debug","log"],output:{log:function(e){},debug:function(e){},info:function(e){},warn:function(e){},error:function(e){}},silent:{log:function(e){},debug:function(e){},info:function(e){},warn:function(e){},error:function(e){}},buffer:null,_enableOutput:function(e){if(this.buffer)return this.output[e]=this.bufferLog,0;if(mx.ifdef(typeof console)){var t="__"+e;mx.ifdef(typeof console[t])?console[e]=console[t]:mx.ifndef(typeof console[e])&&(console[e]=console.log),e==="debug"&&(mx.isMSIE()?console[e]=console.log:console.debug instanceof Function||(console[e]=console.log)),this.output[e]=console[e]}else mx.isOpera()?this.output[e]=opera.postError:mx.isXPC()?this.output[e]=print:MX.Log.write&&(this.output[e]=MX.Log.write);return e===this.LEVEL[0]&&(this.silent[e]=this.output[e]),0},_disableOutput:function(e){if(mx.ifdef(typeof console)){var t="__"+e;console[t]=console[e],console[e]=this.silent[e]}else this.output[e]=this.silent[e];return 0},setLevel:function(e){var t;for(t=0;t<this.LEVEL.length;t++)this._disableOutput(this.LEVEL[t]);e>this.LEVEL.length&&(e=this.LEVEL.length-1);for(t=0;t<=e;t++)this._enableOutput(this
.LEVEL[t]);return 0},off:function(){return mx.console=MX.Log.silent,0},on:function(e){var t=e||e===0?MX.Log.setLevel(e):MX.Log.setLevel(4);return mx.ifdef(typeof console)?mx.console=console:mx.console=MX.Log.output,0},popup:function(e){var t=e?MX.Log.setLevel(e):MX.Log.setLevel(4),n;for(n=0;n<this.LEVEL.length;n++)MX.Log.output[this.LEVEL[n]]=MX.LogWindow.log;return MX.Log.output[this.LEVEL[4]]=MX.LogWindow.error,mx.console=MX.Log.output,0},scDebug:function(e){var t=e||e===0?MX.Log.setLevel(e):MX.Log.setLevel(4);mx.console=SC.Logger},buffered:function(e){var t=e?MX.Log.setLevel(e):MX.Log.setLevel(4);return this.buffer=[],0},filter:function(e){return this.setLevel(4),mx.console=MX.Log.output,mx.console.error=function(e){if(e)var t=mx.ifdef(typeof console)?console.error(e):MX.Log.output.error(e);return 0},mx.console.log=function(t){if(t&&(t+"").indexOf(e)===0)var n=mx.ifdef(typeof console)?console.log(t):MX.Log.output.log(t);return 0},0},bufferLog:function(e){return this.buffer.push(e),0},bufferPrint:function(){var e=this.buffer;return!e||!e.length?(mx.alert(this._isa+"bufferPrint no log entries in buffer"),0):(MX.LogWindow.writeBuffer(e),MX.LogWindow.print())},line:"--------------------------------------------------------------------------------",lineDouble:"================================================================================",lineRight:">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>",lineLeft:"<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<",linePlus:"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++"
,dump:function(e){mx.console.debug(this.line),mx.console.debug("Hash Dump:");for(var t in e)mx.console.debug(t+" : "+e[t]);return mx.console.debug(this.line),0},tsv:function(){if(!MX.Config.enableLog)return"";var e=arguments.length,t="",n;for(n=0;n<e;n++)t+=arguments[n]+"	";return t+=(new Date).getTime(),mx.console.debug(t),t},alert:function(e){return alert(e),0},step:function(e){var t=prompt(e,"");return(!t||t.length)&&mx.raise(this._isa+".step cancelled"),0},classDidFinishLoading:function(){mx.alert=MX.Log.alert,mx.step=MX.Log.step,mx.log=MX.Log.on,mx.tsv=MX.Log.tsv,mx.console=MX.Log.output;switch(MX.Config.enableLog){case 0:MX.Log.off();break;case 1:MX.Log.buffered(4);break;case 2:MX.Log.on(4);break;case 3:MX.Log.scDebug(4);break;case 4:MX.Log.popup(4);break;default:MX.Log.off()}return 0}},mx._(MX.Log),mx._("mx/foundation/mx_object"),MX.Object={_isa:"MX.Object",_superClass:null,_hash:0,retainCount:0,className:function(){return mx.ifval(this._isa)?this._isa:mx.type(this)},classObject:function(){var e=this.className();return e.indexOf("MX.")===0?mx.exec(e):null},description:function(e){try{return JSON.stringify(e)}catch(t){}try{return e.toString()}catch(n){return mx.type(e)}},hash:function(){return mx.isSC()?SC.guidFor(this):"mx"+this._hash},init:function(){var e=mx.entry(this,"init",1);return mx.performSelector("register",MX.GarbageCollector,this),this},dealloc:function(){var e=mx.entry(this,"dealloc",1);mx.performSelector("collect",MX.GarbageCollector,this)},retain:function(){var e=mx.entry(this,"retain",1);return this.retainCount++,this},registerSingleton:function(){var e=
mx.entry(this,"registerSingleton",1);return mx.performSelector("registerSingleton",MX.GarbageCollector,this),this},release:function(e){var t=mx.entry(this,"release",1);if(!e){this.retainCount--,mx.tsv("release",this._hash,this._isa,this.retainCount);if(this.retainCount>0)return 0;this.dealloc()}else{var n,r=arguments.length,i;for(i=0;i<r;i++)n=this[arguments[i]],arguments[i]!=="delegate"&&mx.performSelector("release",n),this[arguments[i]]=null}return 0},synthesize:function(){var e=mx.entry(this,"synthesize",1),t,n=arguments,r,i=n.length;for(t=0;t<i;t++){r=n[t];if(!mx.ifattr(this,r)){mx.raise(e+"synthesized property '"+r+"' of "+this._isa+" must explicitly name an ivar");return}var s=r.charAt(0).toUpperCase()+r.substring(1),o="get"+s,u="set"+s;this[o]&&(o.charAt(0)==="_"&&mx.console.warn(e+"creating a double prefixed accessor for "+o),mx.console.debug(e+"synthesized accessor '"+o+"' of "+this._isa+" was created prefixed with '_"),o="_"+o),this[o]=this._getter(r),this[u]&&(u.charAt(0)==="_"&&mx.console.warn(e+"creating a double prefixed accessor for "+u),u="_"+u,mx.console.debug(e+"synthesized accessor '"+u+"' of "+this._isa+" was created prefixed with '_'")),this[u]=this._setter(r)}return 0},_getter:function(e){var t=mx.entry(this,"_getter",1),n=function(){return mx.entry(this,"get "+e),this.get(e)};return n},_setter:function(e){var t=mx.entry(this,"_setter",1),n=function(t){mx.entry(this,"set "+e),e!=="delegate"&&mx.autoretain(this,e,t),this.set(e,t)};return n}},mx.isSC()?MX.Object=SC.Object.extend(MX.Object):(MX.Object._mixin=function(e,t){mx.ifnval(t)&&mx.raise("MX.mixin NULL object"
);for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},MX.Object._mixin(MX.Object,{mixin:function(e){var t=arguments.length,n;for(n=0;n<t;n++)MX.Object._mixin(this,arguments[n]);return this},extend:function(e){var t={},n;for(n in this)t[n]=this[n];var r=arguments.length,i;for(i=0;i<r;i++){e=arguments[i];for(n in e)t[n]=e[n],this[n]instanceof Function&&(t[n].base=this[n])}return t._superClass=this._isa,t},create:function(e){var t=this;e&&(t=this.extend(e));var n={},r,i=t;for(r in i)n[r]=i[r];var s=++MX.Object._hash;return n._hash=s,mx.performSelector("init",n),n},propertyWillChange:function(e){return 0},propertyDidChange:function(e){return 0},get:function(e){return this[e]},set:function(e,t){return this[e]=t,0}})),mx._(MX.Object);var APS=APS||{};typeof APS=="undefined"&&(APS={}),mx._("aps/aps_request"),mx.include("mx/foundation/mx_object"),mx.include("mx/foundation/mx_log"),mx.include("mx/foundation/mx_string"),mx.include("mx/foundation/mx_url"),APS.Request=MX.Object.extend({_isa:"APS.Request",hostProvider:null,hostService:null,payload:null,init:function(){var e=mx.entry(this,"init");return mx.superCall(this,arguments),this.synthesize("hostProvider","hostService"),this.payload={svc:"/wm/aps",ssl:0,xid:"",rtt:0,syn:900,url:"/aps",tok:"",ttl:86400,op:"",dat:{}},this},dealloc:function(){var e=mx.entry(this,"dealloc");return this.release("hostProvider","hostService"),mx.superCall(this,arguments)},overlayDelta:function(e){var t=mx.entry(this,"overlayDelta");if(e){var n;for(n in e)this.payload[n]=e[n]}else mx.console.debug(t+"no aps data");return 0},setProviderHost:function(e)
{var t=mx.entry(this,"setProviderHost");return this.setHostProvider(MX.URL.URLWithString(e)),0},setServiceHost:function(e){var t=mx.entry(this,"setServiceHost");return this.setHostService(MX.URL.URLWithString(e)),0},apsToken:function(){var e=mx.entry(this,"apsToken",1);return this.payload.tok},setApsToken:function(e){var t=mx.entry(this,"setApsToken",1);return this.payload.tok=e,0},setApsOP:function(e){var t=mx.entry(this,"setApsOP",1);return this.payload.op=e,0},apsOP:function(){var e=mx.entry(this,"apsOP",1);return this.payload.op},apsTtl:function(){var e=mx.entry(this,"apsTtl",1);return this.payload.ttl},apsSync:function(){var e=mx.entry(this,"apsSync",1);return this.payload.syn},setApsData:function(e){var t=mx.entry(this,"setApsData",1);return mx.ifndef(typeof e)?this.payload.dat={}:typeof e=="object"?this.payload.dat=MX.String.stringByEncodingToJSON(e):this.payload.dat=e,0},providerURL:function(){var e=mx.entry(this,"providerURL"),t=MX.URL.URLWithString(this.payload.svc),n;for(n in this.payload)n!=="svc"&&t.setQueryValueForKey(this.payload[n],n);return this.hostProvider&&this.payload.svc[0]==="/"&&(t.setScheme(this.hostProvider.scheme),t.setHost(this.hostProvider.host),t.setPort(this.hostProvider.port)),t},serviceURL:function(){var e=mx.entry(this,"serviceURL"),t=MX.URL.URLWithString(this.payload.url);return t.setQueryValueForKey(this.payload.tok,"tok"),t.setQueryValueForKey(this.payload.ttl,"ttl"),t.setUncacheableFlag(1),this.hostService&&this.payload.url[0]==="/"&&(t.setScheme(this.hostService.scheme),t.setHost(this.hostService.host),t.setPort(this.hostService.port)),
t}}),mx._(APS.Request),mx._("aps/aps_provider"),mx.include("mx/foundation/mx_object"),mx.include("mx/foundation/mx_log"),mx.include("mx/foundation/mx_string"),mx.include("mx/foundation/mx_stack"),APS.Provider=MX.Object.extend({_isa:"APS.Provider",delegate:null,connection:null,synTimer:null,request:null,response:null,responseData:null,PROVISION:"P",NOTIF_START:"N",NOTIF_STOP:"U",SYNC:"S",TIMEOUT:"T",SEND:"W",initWithRequest:function(e){var t=mx.entry(this,"initWithRequest");return mx.istype(e,"APS.Request"),this.synthesize("delegate","connection","synTimer","request","response","responseData"),this.setSynTimer(MX.Timer.create()),this.setRequest(e),this},dealloc:function(){var e=mx.entry(this,"dealloc");this.release("delegate","connection","synTimer","request","response","responseData"),mx.superCall(this,arguments)},provisionClient:function(){var e=mx.entry(this,"provisionClient");return this.providerSend(this.PROVISION)},stopRemoteNotifications:function(){var e=mx.entry(this,"stopRemoteNotifications");return this.providerSend(this.NOTIF_STOP)},startRemoteNotifications:function(){var e=mx.entry(this,"startRemoteNotifications");return this.providerSend(this.NOTIF_START)},sendRemoteNotification:function(e){var t=mx.entry(this,"sendRemoteNotification");return this.providerSend(this.SEND,e)},syncClient:function(){var e=mx.entry(this,"syncClient");return this.providerSend(this.SYNC)},providerSend:function(e,t){var n=mx.entry(this,"providerSend");this.request.setApsOP(e);var r=e===this.SEND?t:{};this.request.setApsData(r);var i=MX.URLRequest.create();i.initWithURL(this.request.providerURL
(),MX.URLRequestUseProtocolCachePolicy,this.request.apsTtl());var s=MX.URLConnection.connectionWithRequest(i,this);return this.setConnection(s),0},connectionDidReceiveAuthenticationChallenge:function(e){var t=mx.entry(this,"connectionDidReceiveAuthenticationChallenge");return mx.istype(e,"MX.URLAuthenticationChallenge"),mx.performSelector("didReceiveAuthenticationChallenge",this.delegate,e)},connectionDidReceiveResponse:function(e){var t=mx.entry(this,"connectionDidReceiveResponse");return mx.istype(e,"MX.URLResponse"),this.setResponse(e),0},connectionDidReceiveData:function(e){var t=mx.entry(this,"connectionDidReceiveData");return e instanceof Object||(MX.Stack.pushEval(e),e=MX.Stack.pop()),this.setResponseData(e),0},connectionDidFinishLoading:function(){var e=mx.entry(this,"connectionDidFinishLoading");switch(this.response.statusCode){case 0:return mx.console.error(e+"status Request Timeout"),mx.performSelector("didReceiveTimeoutRequest",this.delegate);case 200:break;case 502:return mx.performSelector("didReceiveUnhandledError",this.delegate,502);default:return mx.console.error(e+"unhandled status code: "+this.response.statusCode),mx.performSelector("didReceiveUnhandledError",this.delegate,this.response.statusCode),1}var t=this.responseData;if(mx.ifnval(t))return mx.console.error(e+"no push data parsed"),1;var n=t.payload;if(!n)return mx.console.error(e+"no apc payload"),1;var r=t.payload.apc;this.synTimer&&this.request.apsSync()!=r["syn"]&&this.synTimeout(),this.request.overlayDelta(r);switch(this.request.apsOP()){case this.PROVISION:mx.performSelector("didRegisterForRemoteNotifications"
,this.delegate);break;case this.NOTIF_STOP:mx.performSelector("didStopRemoteNotifications",this.delegate);break;case this.NOTIF_START:mx.performSelector("didStartRemoteNotifications",this.delegate);break;case this.SEND:break;case this.SYNC:break;case this.TIMEOUT:mx.performSelector("didReceiveTimeoutRequest",this.delegate);break;default:mx.console.error(e+"unknown OP : "+this.request.apsOP())}return 0},connectionDidFailWithError:function(e){var t=mx.entry(this,"connectionDidFailWithError");return 0},synTimeout:function(){var e=mx.entry(this,"synTimeout");return this.synTimer&&this.synTimer.invalidate(),this.setSynTimer(MX.Timer.scheduledTimerWithTimeInterval(this.request.apsSync(),this,"syncClient",{},!1)),0}}),mx._(APS.Provider),mx._("aps/aps_service"),mx.include("mx/foundation/mx_object"),mx.include("mx/foundation/mx_log"),mx.include("mx/foundation/mx_url_connection_jsonp"),mx.include("mx/foundation/mx_url_response"),APS.Service=MX.Object.extend({_isa:"APS.Service",delegate:null,connection:null,request:null,response:null,responseData:null,_lastNOOP:0,OK:200,NOOP:204,INVALID_TOKEN:403,INVALID_REQUEST:400,TOKEN_IN_USE:409,initWithRequest:function(e){var t=mx.entry(this,"initWithRequest");return mx.istype(e,"APS.Request"),this.synthesize("delegate","connection","request","response","responseData"),this._lastNOOP=MX.Date.date(),this.setRequest(e),this},dealloc:function(){var e=mx.entry(this,"dealloc");return this.release("delegate","connection","request","response","responseData"),mx.superCall(this,arguments)},start:function(){var e=mx.entry(this,"start");return this.serviceSend
(),0},stop:function(){var e=mx.entry(this,"stop");return this.connection&&this.connection.cancel(),0},serviceSend:function(){var e=mx.entry(this,"serviceSend"),t=MX.URLRequest.create();t.initWithURL(this.request.serviceURL(),MX.URLRequestReloadIgnoringLocalAndRemoteCacheData,this.request.apsTtl());var n=MX.URLConnectionJSONP.connectionWithRequest(t,this);return this.setConnection(n),0},connectionDidReceiveResponse:function(e){var t=mx.entry(this,"connectionDidReceiveResponse");return mx.istype(e,"MX.URLResponse"),this.setResponse(e),0},connectionDidReceiveData:function(e){var t=mx.entry(this,"connectionDidReceiveData");if(e instanceof Array)e=this.expandData(e);else if(typeof e!="object"){mx.console.error(t+"bad data ["+e+"]");return}return this.setResponseData(e),0},expandData:function(e){var t=mx.entry(this,"expandData");e.reverse();var n={ver:null,topic:null,payload:{aps:null,app:null}};n=mx.expando(n,e,2);var r={badge:null,sound:null,alert:null};return r=mx.expando(r,e,3),n.payload.aps=r,n.payload.app=e,n},connectionDidFinishLoading:function(){var e=mx.entry(this,"connectionDidFinishLoading");switch(this.response.statusCode){case APS.ServiceOK:var t=this.responseData;if(!t){mx.console.error(e+"bad data"),this.start();return}this.request.overlayDelta(t.payload.aps),this.start(),mx.performSelector("didReceiveRemoteNotification",this.delegate,t);break;case APS.ServiceNoop:this.start();break;case APS.ServiceInvalidToken:mx.console.error(e+"status Invalid Token"),mx.performSelector("didReceiveInvalidToken",this.delegate);break;case APS.ServiceInvalidRequest:mx.console.error(e+"status Invalid Request"
),mx.performSelector("didReceiveInvalidRequest",this.delegate);break;case APS.ServiceTokenInUse:mx.console.error(e+"status Token In Use"),mx.performSelector("didReceiveTokenInUse",this.delegate);break;case APS.ServiceTimeout:case 502:mx.console.error(e+"request timed out, reconnect"),this.start();break;case 400:mx.console.error(e+"invalid URL from provider, wait for next sync");break;default:return mx.console.error(e+"unhandled status code: "+this.response.statusCode),mx.performSelector("didReceiveUnhandledError",this.delegate,this.response.statusCode),1}return mx.performSelector("didNetworkConnect",this.delegate,null),0},connectionDidFailWithError:function(e){var t=mx.entry(this,"connectionDidFailWithError");this.response||this.setResponse(MX.URLResponse.create());var n=this._lastNOOP;return this._lastNOOP=MX.Date.date(),this.response.statusCode=APS.ServiceNoop,n.timeIntervalSinceDate(this._lastNOOP)>-15e3?(MX.Timer.scheduledTimerWithTimeInterval(15,this,"connectionDidFinishLoading",null,!1),mx.performSelector("didNetworkDisconnect",this.delegate,null)):this.connectionDidFinishLoading(),0}}),APS.Service.mixin({classDidFinishLoading:function(){APS.ServiceTimeout=0,APS.ServiceOK=200,APS.ServiceNoop=204,APS.ServiceInvalidToken=403,APS.ServiceInvalidRequest=400,APS.ServiceTokenInUse=409}}),mx._(APS.Service),mx._("aps/aps_application"),mx.include("mx/foundation/mx_object"),mx.include("mx/foundation/mx_log"),APS.Application=MX.Object.extend({_isa:"APS.Application",delegate:null,request:null,provider:null,service:null,apsBadge:null,apsSound:null,handlers:null,init:function(){mx.entry
(this,"init"),mx.superCall(this,arguments),this.synthesize("delegate","request","provider","service","apsBadge","apsSound","handlers"),this.setHandlers(MX.Dictionary.dictionary());var e=APS.Request.create();this.setRequest(e);var t=APS.Provider.create();this.setProvider(t),t.initWithRequest(e),t.setDelegate(this);var n=APS.Service.create();return this.setService(n),n.initWithRequest(e),n.setDelegate(this),this},dealloc:function(){return mx.entry(this,"dealloc"),this.release("delegate","request","provider","service","apsBadge","apsSound","handlers"),mx.superCall(this,arguments)},registerForRemoteNotificationTypes:function(){return mx.entry(this,"registerForRemoteNotificationTypes"),0},setPathForResources:function(){return mx.entry(this,"setPathForResources"),0},setBadgeView:function(){return mx.entry(this,"setBadgeView"),0},setHandler:function(e,t){return mx.entry(this,"setHandler"),this.handlers.setObjectForKey(t,e),0},clientToken:function(){return mx.entry(this,"clientToken"),this.request?this.request.apsToken():null},registerForRemoteNotifications:function(){return mx.entry(this,"registerForRemoteNotifications"),this.provider.provisionClient()},unregisterForRemoteNotifications:function(){return mx.entry(this,"unregisterForRemoteNotifications"),this.stopRemoteNotifications()},startRemoteNotifications:function(){return mx.entry(this,"startRemoteNotifications"),this.provider.startRemoteNotifications()},stopRemoteNotifications:function(){return mx.entry(this,"stopRemoteNotifications"),this.didStopRemoteNotifications()},didReceiveRemoteNotification:function(e){var t=mx.entry(this
,"didReceiveRemoteNotification");if(e){var n=e.topic,r=e.payload;if(!n||!r)return mx.console.error(t+"invalid notification payload"),this.didReceiveUnhandledError();var i=r.aps;if(!i)return mx.console.error(t+"invalid APS payload"),this.didReceiveUnhandledError();var s=i.badge;s;var o=i.alert;o&&o.length;var u=i.sound;u&&u.length;var a=r.app;if(a){var f=this.handlers.objectForKey(n);mx.performSelector("didReceiveRemoteNotification",f,a,i)}}return mx.performSelector("didReceiveRemoteNotification",this.delegate,e)},didRegisterForRemoteNotifications:function(){return mx.entry(this,"didRegisterForRemoteNotifications"),mx.performSelector("didRegisterForRemoteNotifications",this.delegate),this.didStartRemoteNotifications()},didUnregisterForRemoteNotifications:function(){return mx.entry(this,"didUnregisterForRemoteNotifications"),0},didStartRemoteNotifications:function(){return mx.entry(this,"didStartRemoteNotifications"),this.service.start()},didStopRemoteNotifications:function(){return mx.entry(this,"didStopRemoteNotifications"),this.service.stop()},didReceiveAuthenticationChallenge:function(e){return mx.entry(this,"didReceiveAuthenticationChallenge"),mx.istype(e,"MX.URLAuthenticationChallenge"),mx.performSelector("didReceiveAuthenticationChallenge",this.delegate,e)},didReceiveTimeoutRequest:function(){mx.entry(this,"didReceiveTimeoutRequest"),CoreMail.errorHandler.recordStat("_count_PUSH_PROVISIONING_FAILED",{reason:"Timeout"})},didReceiveInvalidToken:function(){return mx.entry(this,"didReceiveInvalidToken"),mx.performSelector("didFailToRegisterForRemoteNotifications",this.delegate
,APS.ServiceInvalidToken)},didReceiveInvalidRequest:function(){return mx.entry(this,"didReceiveInvalidRequest"),mx.performSelector("didFailToRegisterForRemoteNotifications",this.delegate,APS.ServiceInvalidRequest)},didReceiveTokenInUse:function(){return mx.entry(this,"didReceiveTokenInUse"),mx.performSelector("didFailToRegisterForRemoteNotifications",this.delegate,APS.ServiceTokenInUse)},didReceiveUnhandledError:function(e){return mx.entry(this,"didReceiveUnhandledError"),SC.empty(e)&&(e=APS.ServiceInvalidRequest),mx.performSelector("didFailToRegisterForRemoteNotifications",this.delegate,e)},didNetworkDisconnect:function(){return mx.entry(this,"didNetworkDisconnect"),mx.performSelector("didNetworkDisconnect",this.delegate,null)},didNetworkConnect:function(){return mx.entry(this,"didNetworkConnect"),mx.performSelector("didNetworkConnect",this.delegate,null)}}),APS.Application.mixin({_sharedApplication:null,sharedApplication:function(){mx.entry(this,"sharedApplication");var e=APS.Application._sharedApplication;return e?e:(e=APS.Application.create(),e.registerSingleton(),APS.Application._sharedApplication=e,e)},classDidFinishLoading:function(){return APS.UIRemoteNotificationTypeNone=0,APS.UIRemoteNotificationTypeBadge=1,APS.UIRemoteNotificationTypeSound=2,APS.UIRemoteNotificationTypeAlert=3,0}}),mx._(APS.Application),mx._("aps/handlers/aps_aio"),mx.include("mx/foundation/mx_object"),mx.include("mx/foundation/mx_log"),mx.include("aps/aps_core"),APS.AIO=MX.Object.extend({_isa:"APS.AIO",didReceiveRemoteNotification:function(e,t){return 0}}),mx._(APS.AIO),mx._("aps/handlers/aps_echo"
),mx.include("mx/foundation/mx_object"),mx.include("mx/foundation/mx_log"),mx.include("aps/aps_core"),APS.Echo=MX.Object.extend({_isa:"APS.Echo",didReceiveRemoteNotification:function(e,t){var n=mx.entry(this,"didReceiveRemoteNotification");return mx.alert(e.say),0}}),mx._(APS.Echo),mx._("aps/handlers/aps_image"),mx.include("mx/foundation/mx_object"),mx.include("mx/foundation/mx_log"),APS.Image=MX.Object.extend({_isa:"APS.Image",didReceiveRemoteNotification:function(e,t){var n=mx.entry(this,"didReceiveRemoteNotification"),r=e;return 0}}),mx._(APS.Image),mx._("aps/handlers/aps_mail"),mx.include("mx/foundation/mx_object"),mx.include("mx/foundation/mx_log"),APS.Mail=MX.Object.extend({_isa:"APS.Mail",didReceiveRemoteNotification:function(e,t){var n=mx.entry(this,"didReceiveRemoteNotification");return e instanceof Array&&(e.push(t.badge),e=this.expandData(e)),this.performMailAction(e)},expandData:function(e){var t=mx.entry(this,"expandData"),n={inboxUnread:null,newslotnumber:null,operation:null,folderGuid:null,msgUid:null,index:null,totalMessages:null},r=mx.expando(n,e,7),i=parseInt(r.totalMessages,10);return r.totalMessages=isNaN(i)?0:i,i=parseInt(r.inboxUnread,10),r.inboxUnread=isNaN(i)?0:i,r},performMailAction:function(e){var t=mx.entry(this,"performMailAction");if(mx.ifdef(typeof CoreMail))var n=mx.performSelector("push",CoreMail,e);else mx.console.error(t+"delegate not defined");return 0}}),mx._(APS.Mail),mx._("aps/handlers/aps_support"),mx.include("mx/foundation/mx_object"),mx.include("mx/foundation/mx_log"),APS.Support=MX.Object.extend({_isa:"APS.Support",didReceiveRemoteNotification
:function(e,t){var n=mx.entry(this,"didReceiveRemoteNotification"),r=e;return 0}}),mx._(APS.Support),mx._("mx/foundation/mx_range"),MX.Range=MX.Object.extend({_isa:"MX.Range",location:0,length:0}),MX.Range.mixin({makeRange:function(e,t){var n=mx.entry(this,"makeRange",1);e=parseFloat(e),t=parseFloat(t);if(isNaN(e)||isNaN(t))return mx.console.error(n+"invalid conversion"),null;var r=MX.Range.create();return r.location=e,r.length=t,r}}),mx._(MX.Range),mx._("mx/foundation/mx_array"),MX.Array=MX.Object.extend(mx.ifSC(MX.SC.Array,{}),{_isa:"MX.Array",array:null,init:function(){var e=mx.entry(this,"init");return mx.superCall(this,arguments),this.array=[],this},initWithArray:function(e){var t=mx.entry(this,"initWithArray");return mx.isarray(e),mx.isSC()?this.set("array",e):this.array=e,this},dealloc:function(){var e=mx.entry(this,"dealloc");return this.removeAllObjects(),mx.superCall(this,arguments)},count:function(){var e=mx.entry(this,"count",1);return mx.isSC()?this.get("length")?this.get("length"):this.array.length:this.array.length},addObject:function(e){var t=mx.entry(this,"addObject",1);return mx.performSelector("retain",e),mx.isSC()?this.array.pushObject(e):this.array.push(e),0},removeObjectAtIndex:function(e){var t=mx.entry(this,"removeObjectAtIndex",1),n=parseInt(e,10);if(isNaN(n)||n<0)return null;var r=this.objectAtIndex(e);return mx.performSelector("release",r),mx.ifSC()?this.array.removeAt(e,1):this.array.splice(e,1),r},removeLastObject:function(){var e=mx.entry(this,"removeLastObject",1),t=this.array.pop();return mx.performSelector("release",t),t},removeAllObjects:function(
){var e=mx.entry(this,"removeAllObjects",1);while(this.removeLastObject());return 0},removeObject:function(e){var t=mx.entry(this,"removeObject",1),n=this.indexesOfObject(e),r=n.length,i;for(i=r;i>-1;i--)this.removeObjectAtIndex(n[i])},objectAtIndex:function(e){var t=mx.entry(this,"objectAtIndex",1),n=parseInt(e,10);return isNaN(n)||n<0?null:this.array[n]},objectAt:function(e){var t=mx.entry(this,"objectAt",1);return this.objectAtIndex(e)},replaceObjectAtIndex:function(e,t){var n=mx.entry(this,"replaceObjectAtIndex");return this.replaceObjectsInRangeWithObjectsFromArray(MX.Range.makeRange(e,1),[t])},replaceObjectsInRangeWithObjectsFromArray:function(e,t){var n=mx.entry(this,"replaceObjectsInRangeWithObjectsFromArray",1);mx.istype(e,"MX.Range");var r=t;mx.type(t)==="MX.Array"&&(r=t.array);var i=r.length,s;for(s=0;s<i;s++)mx.performSelector("retain",r[s]);var o=this.array.splice(e.location,e.length,t);i=o.length;for(s=0;s<i;s++)mx.performSelector("release",o[s]);return 0},replace:function(e,t,n){var r=mx.entry(this,"replace",1);return this.replaceObjectsInRangeWithObjectsFromArray(MX.Range.makeRange(e,t),n),this.enumerableContentDidChange(),0},indexOfObject:function(e){var t=mx.entry(this,"indexOfObject",1),n=this.count(),r;for(r=0;r<n;r++)if(this.objectAtIndex(r)===e)return r;return-1},indexesOfObject:function(e){var t=mx.entry(this,"indexesOfObject",1),n=[],r=this.count(),i;for(i=0;i<r;i++)this.objectAtIndex(i)===e&&n.push(i);return n},indexOfObjectWithAttribute:function(e,t){var n=mx.entry(this,"indexOfObjectWithAttribute",1),r=this.count(),i;for(i=0;i<r;i++)if(this.objectAtIndex
(i).get(t)===e)return i;return-1}}),MX.Array.mixin({array:function(){var e=mx.entry(this,"array");return MX.Array.create()}}),mx._(MX.Array),mx._("mx/foundation/mx_date"),MX.Date=MX.Object.extend({_isa:"MX.Date",_date:null,initWithTimeIntervalSinceNow:function(){var e=mx.entry(this,"initWithTimeIntervalSinceNow");return this._date=new Date,this},dealloc:function(){var e=mx.entry(this,"dealloc");this._date=null,mx.superCall(this,arguments)},compare:function(e){var t=mx.entry(this,"compare");mx.istype(e,"MX.Date");var n=this.timeIntervalSinceDate(e);return n<0?MX.OrderedDescending:n?MX.OrderedAscending:MX.OrderedSame},timeIntervalSinceDate:function(e){var t=mx.entry(this,"timeIntervalSinceDate");mx.istype(e,"MX.Date");var n=this._date.getTime()-e._date.getTime();return n},timeIntervalSinceNow:function(){var e=mx.entry(this,"timeIntervalSinceNow");return this.timeIntervalSinceDate(MX.Date.date())},timeIntervalSince1970:function(){var e=mx.entry(this,"timeIntervalSince1970"),t=this._date.getTime();return t/1e3},timeIntervalSinceToday:function(){var e=mx.entry(this,"timeIntervalSinceToday"),t=this._date.getUTCHours()*60*60+this._date.getUTCMinutes()*60+this._date.getUTCSeconds()+this._date.getUTCMilliseconds()/1e3;return t},timeIntervalSinceWeek:function(){var e=mx.entry(this,"timeIntervalSinceWeek"),t=this.timeIntervalSinceToday();return t+=this._date.getUTCDay()*24*60*60,t},timeIntervalSinceMonth:function(){var e=mx.entry(this,"timeIntervalSinceMonth"),t=this.timeIntervalSinceToday();return t+=this._date.getUTCDate()*24*60*60,t}}),MX.Date.mixin({date:function(){var e=mx.entry(this
,"date",1);return MX.Date.create().initWithTimeIntervalSinceNow()},timeIntervalSinceReferenceDate:function(){var e=mx.entry(this,"timeIntervalSinceReferenceDate",1);return MX.Date.date().timeIntervalSince1970()-978307200}}),mx._(MX.Date),mx._("mx/mobileme/mx_core_sc"),MX.CoreSC={_isa:"MX.CoreSC",viewPath:function(e){var t=mx.entry(this,"viewPath"),n=e.classNames,r=n[n.length-1];return r},viewUID:function(e){var t=mx.entry(this,"viewUID"),n=SC.guidFor(e);if(!n)return n;if(e.id)return e.id;for(var r in e)if(r.indexOf("_sc_guid_")===0)return e[r];return null},viewDomElement:function(e){var t=mx.entry(this,"viewDomElement"),n=e.layer();return n}},mx._(MX.CoreSC),mx._("mx/foundation/mx_dictionary"),MX.Dictionary=MX.Object.extend({_isa:"MX.Dictionary",_dictionary:null,_count:0,init:function(){var e=mx.entry(this,"init");return mx.superCall(this,arguments),this._dictionary={},this},dealloc:function(){var e=mx.entry(this,"dealloc");return this.removeAllObjects(),mx.superCall(this,arguments)},description:function(){var e=mx.entry(this,"description");return JSON.stringify(this._dictionary)},objectEnumerator:function(){var e=mx.entry(this,"objectEnumerator",1);return this._dictionary},allKeys:function(){var e=mx.entry(this,"allKeys",1),t=MX.Array.array(),n;for(n in this.objectEnumerator())t.addObject(n);return t},count:function(){var e=mx.entry(this,"count",1);return this._count},_keyToUID:function(e){var t=mx.entry(this,"_keyToUID",1),n=e;return typeof e=="object"&&(mx.ifattr(e,"hash")?n=e.hash():mx.isSC()&&MX.CoreSC?n=MX.CoreSC.viewUID(e):mx.raise(this._isa+"unknown key specifier "))
,n},removeAllObjects:function(){var e=mx.entry(this,"removeAllObjects",1),t;for(t in this.objectEnumerator())this.removeObjectForKey(t);return 0},removeObjectForKey:function(e){var t=mx.entry(this,"removeObjectForKey",1),n=this.objectForKey(e);if(!n)return n;this.propertyWillChange("dictionary"),mx.performSelector("release",n);var r=this._keyToUID(e);try{delete this._dictionary[r]}catch(i){}return this._count--,this.propertyDidChange("dictionary"),n},setObjectForKey:function(e,t){var n=mx.entry(this,"setObjectForKey",1);mx.performSelector("retain",e),this.propertyWillChange("dictionary");var r=this._keyToUID(t),i=this.objectForKey(r);return i?mx.performSelector("release",i):this._count++,this._dictionary[r]=e,this.propertyDidChange("dictionary"),0},objectForKey:function(e){var t=mx.entry(this,"objectForKey",1),n=this._dictionary[this._keyToUID(e)];return n?n:null}}),MX.Dictionary.mixin({dictionary:function(){var e=mx.entry(this,"dictionary");return MX.Dictionary.create()}}),mx._(MX.Dictionary),mx._("mx/foundation/mx_error"),MX.Error=MX.Object.extend({_isa:"MX.Error",code:-1,domain:null,userInfo:null,initWithDomain:function(e,t,n){var r=mx.entry(this,"initWithDomain");return this.code=t,this.domain=e,this.userInfo=n,this},initWithSCError:function(e){var t=mx.entry(this,"initWithSCError");return this.code=e.code,this.domain=e.label,this.userInfo={localizedDescription:e.description},this}}),MX.Error=MX.Error.mixin({errorWithDomain:function(e,t,n){var r=mx.entry(this,"errorWithDomain");return MX.Error.create().initWithDomain(e,t,n)}}),mx._(MX.Error),mx._("mx/uikit/mx_element"),MX
.Element=MX.Object.extend({_isa:"MX.Element",element:null,owner:null,created:0,init:function(){var e=mx.entry(this,"init");return mx.superCall(this,arguments),this},initWithType:function(e){var t=mx.entry(this,"initWithType");return this.element=MX.Runtime.elementCreate(e),!this.element||mx.type(this.element)==="[object HTMLGenericElement]"?(mx.console.error(t+"failed to create "+e+" element"),null):(this.setName(this.hash()),this.element.mxptr=this,this.created=1,this)},initWithRef:function(e){var t=mx.entry(this,"initWithRef");return e?mx.ifattr(e,"mxptr")?e.mxptr:(this.element=e,this.element.mxptr=this,this):(mx.console.error(t+"NULL element"),null)},initWithId:function(e){var t=mx.entry(this,"initWithId"),n=MX.Runtime.elementById(e);return mx.ifnval(n)?(mx.console.error("MX.Element.initWithId no element with ID "+e),null):this.initWithRef(n)},dealloc:function(){var e=mx.entry(this,"dealloc");this.owner=null;if(this.created)try{MX.Runtime.removeElement(this.element)}catch(t){}try{mx.ifattr(this.element,"mxptr")&&(this.element.mxptr=null,delete this.element.mxptr)}catch(n){}return this.element=null,mx.superCall(this,arguments)},getType:function(){var e=mx.entry(this,"getType");return mx.type(this.element)},setOwner:function(e){var t=mx.entry(this,"setOwner");return this.owner=e,0},setValueForAttribute:function(e,t){var n=mx.entry(this,"setValueForAttribute",1);return this.element.setAttribute(t,e)},removeValueForAttribute:function(e){var t=mx.entry(this,"removeValueForAttribute",1);return this.element.removeAttribute(e)},setName:function(e){var t=mx.entry(this,"setName",1)
;return this.element.name=e,this.element.id=e,0},name:function(){var e=mx.entry(this,"name",1);return this.element.name},setValue:function(e){var t=mx.entry(this,"setValue",1);return this.element.value=e,0},value:function(){var e=mx.entry(this,"value",1);return this.element.value},setToolTip:function(e){var t=mx.entry(this,"setToolTip");return this.setValueForAttribute(e,"title"),this.setValueForAttribute(e,"alt"),0}}),MX.Element.mixin({elementWithRef:function(e){var t=mx.entry(this,"elementWithRef");return MX.Element.create().initWithRef(e)},elementWithId:function(e){var t=mx.entry(this,"elementWithId");return MX.Element.create().initWithId(e)},elementWithType:function(e){var t=mx.entry(this,"elementWithType");return MX.Element.create().initWithType(e)},elementForWindow:function(){var e=mx.entry(this,"elementForWindow");return MX.Element.elementWithRef(MX.Runtime.window)}}),mx._(MX.Element),mx._("mx/foundation/mx_event"),MX.Event=MX.Object.extend({_isa:"MX.Event",object:null,enabled:1,noskip:1,eventName:null,eventFn:null,target:null,selector:null,userData:null,init:function(){var e=mx.entry(this,"init");return mx.superCall(this,arguments),this.synthesize("object","target","userData"),this},initWithEvent:function(e,t,n,r,i,s){var o=mx.entry(this,"initWithEvent");mx.istype(e,"MX.Element"),this.setObject(e),this.eventName=t,this.setTarget(n),this.selector=r,this.setUserData(i);var u=this.hash();switch(s){case MX.Event.GEARS:this.eventFn=function(e,t,n){MX.Runtime.eventHandler(this,n,u,"eventHandler",this)};break;case MX.Event.DOM:default:this.eventFn=function(e){MX.Runtime.eventHandler
(this,e,u,"eventHandler")}}return this},dealloc:function(){var e=mx.entry(this,"dealloc");return this.removeMonitor(),this.release("object","target","userData"),this.eventName=null,this.eventFn=null,this.selector=null,mx.superCall(this,arguments)},eventHandler:function(e){var t=mx.entry(this,"eventHandler");return mx.ifattr(e,"type")&&mx.console.debug(t+e.type),this.enabled&&this.noskip?mx.performSelector(this.selector,this.target,e,this.userData):(this.noskip=1,0)},addLocalMonitor:function(){var e=mx.entry(this,"addLocalMonitor"),t=this.hash();try{if(!mx.ifattr(this.object.element,t)||mx.ifnval(this.object.element[t]))this.object.element[t]=this,MX.Runtime.eventListenerAdd(this.object,this.eventName,this.eventFn)}catch(n){return mx.console.error(e+"unable to add event listener due to error ["+n+"]"),1}return 0},removeMonitor:function(){var e=mx.entry(this,"removeMonitor"),t=this.hash();if(mx.ifattr(this.object.element,t)){MX.Runtime.eventListenerRemove(this.object,this.eventName,this.eventFn);try{this.object.element[t]=null,delete this.object.element[t]}catch(n){mx.console.error(e+"unable to remove element self reference")}}return 0}}),MX.Event.mixin({DOM:0,GEARS:1,event:function(e,t,n,r,i,s){var o=mx.entry(this,"event");mx.istype(e,"MX.Element");var u=MX.Event.create();return u.initWithEvent(e,t,n,r,i,s),u.addLocalMonitor(),u},globalEvent:function(e,t,n,r){var i=mx.entry(this,"globalEvent");return MX.Event.event(MX.Element.elementForWindow(),e,t,n,r,MX.Event.DOM)}}),mx._(MX.Event),mx._("mx/foundation/mx_stack"),MX.Stack={_isa:"MX.Stack",stack:[],push:function(e){var t=mx.entry
(this,"push");return MX.Stack.stack.push(e),0},pushEval:function(e){var t=mx.entry(this,"pushEval");return mx.ifstring(e)&&e.indexOf("mx.push")===0?(mx.exec(e),1):0},pop:function(e){var t=mx.entry(this,"pop"),n=MX.Stack.stack.length;if(n===0)return mx.console.error(t+" no data on stack"),null;if(!e)return mx.console.debug(t+" simple"),MX.Stack.stack.pop();var r,i,s=e.length;mx.console.debug(t+" recursive of "+s+" attribs");for(r=0;r<n;r++){for(i=0;i<s;i++)if(mx.ifndef(MX.Stack.stack[r][e[i]])){i=0;break}if(i)return mx.console.debug(t+" recursion success"),MX.Stack.stack.splice(r,1)[0]}return mx.console.error(t+"failed to match"),null},classDidFinishLoading:function(){return mx.push=function(e){MX.Stack.push(e)},0}},mx._(MX.Stack),mx._("mx/foundation/mx_url"),MX.URL=MX.Object.extend({_isa:"MX.URL",scheme:null,host:null,port:80,user:null,password:null,path:null,queryValues:null,params:null,fragment:null,_nocache:null,init:function(){var e=mx.entry(this,"init");return mx.superCall(this,arguments),this.synthesize("queryValues","scheme","host","port","user","password","fragment"),this.setQueryValues(MX.Dictionary.dictionary()),this},initWithString:function(e){var t=mx.entry(this,"initWithString");if(mx.ifnval(e))return mx.raise(t+"invalid URL string ["+e+"]"),null;e+="";var n,r;if(e.indexOf("http")===0){var i=new RegExp("(http[s]?):\\/\\/(.[^/:]*)[:]?([0-9]{0,5})([/]?.*)","gi");n=i.exec(e);if(!(n.length>=3))return mx.console.error(t+"failed to parse URL string ["+e+"]"),this;this.scheme=n[1],this.host=n[2],this.port=n[3],this.setPathString(n[4])}else{var s=MX.Runtime.enabled?MX.Runtime
.window.location:{};this.scheme=s.protocol?s.protocol:"http",this.scheme=this.scheme.replace(":",""),this.host=s.host?s.host:s.pathname,this.port=s.port,this.setPathString(e)}if(!this.port)switch(this.scheme){case"http":this.port=80;break;case"https":this.port=443;break;default:this.port=80}return this},dealloc:function(){var e=mx.entry(this,"dealloc");return this.release("queryValues","scheme","host","port","user","password","fragment"),mx.superCall(this,arguments)},setUncacheableFlag:function(e){var t=mx.entry(this,"setUncacheableFlag");if(e){var n=MX.Date.date().timeIntervalSinceToday().toFixed(2);this._nocache=n}else this._nocache=null;return 0},setQueryString:function(e){var t=mx.entry(this,"setQueryString"),n,r,i=e.split("&"),s=i.length;for(n=0;n<s;n++)r=i[n].split("="),r.length===2?this.queryValues.setObjectForKey(r[1],r[0]):this.queryValues.setObjectForKey(null,r[0]);return 0},setQueryValueForKey:function(e,t){var n=mx.entry(this,"setQueryValueForKey",1);return this.queryValues.setObjectForKey(e,t)},query:function(){var e=mx.entry(this,"query"),t=[],n,r;for(n in this.queryValues.objectEnumerator())r=this.queryValues.objectForKey(n),r?mx.ifstring(r)?r=MX.String.stringByAddingPercentEscapes(r):typeof r=="object"&&(r=MX.String.stringByEncodingToJSON(r),r=MX.String.stringByAddingPercentEscapes(r)):r="",t.push(n+"="+r);return this._nocache&&t.push(this._nocache),t.length?t=t.join("&"):t=null,t},setPathString:function(e){var t=mx.entry(this,"setPathString"),n=e.indexOf(";"),r=e.indexOf("?",n),i=e.indexOf("#",r);n!==-1?this.path=e.substring(0,n):r!==-1?this.path=e.substring
(0,r):i!==-1?this.path=e.substring(0,i):this.path=e;if(this.path&&this.path.charAt(0)!=="/"){var s=MX.Runtime.enabled?MX.Runtime.window.location.pathname:"";s.charAt(s.length-1)==="/"?this.path=s+"/"+this.path:this.path=s+this.path}var o;return r!==-1&&(i!==-1?o=e.substring(r+1,i):o=e.substring(r+1),this.setQueryString(o)),i!==-1&&(this.fragment=e.substring(i+1)),0},absoluteString:function(){var e=mx.entry(this,"absoluteString"),t;switch(this.scheme){case"http":this.port===80&&(t=this.scheme+"://"+this.host+this.path);break;case"https":this.port===443&&(t=this.scheme+"://"+this.host+this.path);break;case"about":return this.scheme+":"+this.host}t||(t=this.scheme+"://"+this.host+":"+this.port+this.path);if(this.user&&!mx.isMSIE()){var n=this.user+":"+this.password+"@";t=t.replace("://","://"+n)}var r=this.query();return r&&(t=t+"?"+r),t},checkResourceIsRelative:function(){var e=mx.entry(this,"checkResourceIsRelative"),t=MX.Runtime.enabled?MX.Runtime.window.location:{},n=t.host,r=t.port?t.port:t.protocol==="http:"?80:443;return n===this.host&&r+""==this.port+""?1:0},relativeString:function(e){var t=mx.entry(this,"relativeString");if(this.checkResourceIsRelative()||e){var n=this.path,r=this.query();return r&&(n=n+"?"+r),n}return this.absoluteString()},baseString:function(){var e=mx.entry(this,"baseString"),t=this.absoluteString(),n=t.lastIndexOf("/");if(n===-1)return t;var r=t.substring(0,n+1);return r},domain:function(){var e=mx.entry(this,"domain"),t=this.host,n,r=t.lastIndexOf(".");return r===-1?n=t.toLowerCase():(r=t.lastIndexOf(".",r-1),r!==-1?n=t.substring(r+1).toLowerCase
():n=t.toLowerCase()),n},pathExtension:function(){var e=mx.entry(this,"pathExtension"),t=this.path.lastIndexOf(".");return t===-1?null:this.path.substring(t).toLowerCase()}}),MX.URL=MX.URL.mixin({URLWithString:function(e){var t=mx.entry(this,"URLWithString");return MX.URL.create().initWithString(e)}}),mx._(MX.URL),mx._("mx/foundation/mx_url_request"),MX.URLRequest=MX.Object.extend({_isa:"MX.URLRequest",URL:null,allHTTPHeaderFields:null,HTTPMethod:null,HTTPBody:null,credential:null,timeoutInterval:60,cachePolicy:0,async:!0,init:function(){var e=mx.entry(this,"init");return mx.superCall(this,arguments),this.synthesize("allHTTPHeaderFields"),this.setAllHTTPHeaderFields(MX.Dictionary.dictionary()),this.HTTPMethod="GET",this},initWithURL:function(e,t,n){var r=mx.entry(this,"initWithURL");return mx.istype(e,"MX.URL"),this.setURL(e),this.cachePolicy=t,this.timeoutInterval=n,this},dealloc:function(){var e=mx.entry(this,"dealloc");return this.release("URL","allHTTPHeaderFields"),mx.superCall(this,arguments)},dump:function(){var e=mx.entry(this,"dump");mx.console.debug(MX.Log.line),mx.console.debug("URL: "+this.getURL()),mx.console.debug("Method: "+this.HTTPMethod),mx.console.debug("Headers:");for(var t in this.allHTTPHeaderFields.objectEnumerator())mx.console.debug(t+": "+this.allHTTPHeaderFields[t]);return mx.console.debug("Body:\n"+this.HTTPBody),mx.console.debug(MX.Log.line),0},setHTTPMethod:function(e){var t=mx.entry(this,"setHTTPMethod");this.HTTPMethod=e.toUpperCase(),this.HTTPMethod==="POST"&&this.setValueForHTTPHeaderField("application/x-www-form-urlencoded","Content-Type");return}
,setHTTPBody:function(e){var t=mx.entry(this,"setHTTPBody");return this.HTTPBody=e,this.setHTTPMethod("POST"),0},setTimeoutInterval:function(e){var t=mx.entry(this,"setTimeoutInterval");mx.isnum(e);var n=parseInt(e,10);return this.timeoutInterval=n,0},getURL:function(){var e=mx.entry(this,"getURL");this.credential&&(this.URL.setUser(this.credential.user),this.URL.setPassword(this.credential.password));switch(this.cachePolicy){case MX.URLRequestUseProtocolCachePolicy:break;case MX.URLRequestReloadIgnoringLocalAndRemoteCacheData:this.URL.setUncacheableFlag(1)}return this.URL},setURL:function(e){var t=mx.entry(this,"setURL");return mx.istype(e,"MX.URL"),e.retain(),this.URL&&this.URL.release(),this.URL=e,0},addValueForHTTPHeaderField:function(e,t){var n=mx.entry(this,"addValueForHTTPHeaderField"),r=this.allHTTPHeaderFields.getObjectForKey(t);return r?this.allHTTPHeaderFields.setObjectForKey(r+", "+e,t):this.allHTTPHeaderFields.setObjectForKey(e,t),0},setValueForHTTPHeaderField:function(e,t){var n=mx.entry(this,"setValueForHTTPHeaderField");return this.allHTTPHeaderFields.setObjectForKey(e,t)},queryStringForHTTPHeaderFields:function(){var e=[],t=this.allHTTPHeaderFields,n;for(n in t.objectEnumerator())e.push(n+"="+t.objectForKey(n));return e.join("&")},setBasicAuthWithCreds:function(e,t){var n=mx.entry(this,"setBasicAuthWithCreds");this.credential={},this.credential.user=e,this.credential.password=t;var r=e+":"+t,i=this.base64encode(r);return this.setValueForHTTPHeaderField("Basic "+i,"Authorization"),0},base64encode:function(e){var t=mx.entry(this,"base64encode"),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="
,r=[],i,s,o="",u,a,f,l="",c=0,h=e.length;do i=e.charCodeAt(c++),s=e.charCodeAt(c++),o=e.charCodeAt(c++),u=i>>2,a=(i&3)<<4|s>>4,f=(s&15)<<2|o>>6,l=o&63,isNaN(s)?f=l=64:isNaN(o)&&(l=64),r.push(n.charAt(u)+n.charAt(a)+n.charAt(f)+n.charAt(l)),i=s=o="",u=a=f=l="";while(c<h);return r.join("")}}),MX.URLRequest.mixin({classDidFinishLoading:function(){return MX.URLRequestUseProtocolCachePolicy=0,MX.URLRequestReloadIgnoringLocalCacheData=1,MX.URLRequestReloadIgnoringLocalAndRemoteCacheData=4,MX.URLRequestReloadIgnoringCacheData=MX.URLRequestReloadIgnoringLocalCacheData,MX.URLRequestReturnCacheDataElseLoad=2,MX.URLRequestReturnCacheDataDontLoad=3,MX.URLRequestReloadRevalidatingCacheData=5,0}}),mx._(MX.URLRequest),mx._("mx/foundation/mx_timer"),MX.Timer=MX.Object.extend({_isa:"MX.Timer",timer:null,repeats:0,initWithFireDate:function(e,t,n,r,i){var s=mx.entry(this,"initWithFireDate");mx.ifval(this.timer)&&(this.invalidate(),this.timer=null);var o=e*1e3;return i?(this.repeats=1,this.timer=MX.Runtime.setInterval(t,n,o,r)):(this.repeats=0,this.timer=MX.Runtime.setTimeout(t,n,o,r)),this},invalidate:function(){var e=mx.entry(this,"invalidate");return mx.ifval(this.timer)&&(mx.ifndef(typeof clearInterval)?this.timer.cancel():this.repeats?clearInterval(this.timer):clearTimeout(this.timer),this.timer=null),0}}),MX.Timer.mixin({scheduledTimerWithTimeInterval:function(e,t,n,r,i){var s=mx.entry(this,"scheduledTimerWithTimeInterval");return MX.Timer.create().initWithFireDate(e,t,n,r,i)}}),mx._(MX.Timer),mx._("mx/foundation/mx_url_authentication_challenge"),MX.URLAuthenticationChallenge=MX.Object.extend
({_isa:"MX.URLAuthenticationChallenge",sender:null}),mx._(MX.URLAuthenticationChallenge),mx._("mx/foundation/mx_url_connection_script"),MX.URLConnectionScript=MX.Object.extend({_isa:"MX.URLConnectionScript",delegate:null,domElement:null,eventReadystatechange:null,eventLoad:null,eventError:null,init:function(){var e=mx.entry(this,"init");return mx.superCall(this,arguments),this.synthesize("delegate","domElement","eventReadystatechange","eventLoad","eventError"),this},initWithRequest:function(e,t){var n=mx.entry(this,"initWithRequest");mx.istype(e,"MX.URLRequest"),this.setDelegate(t);var r=MX.Element.elementWithType("script");if(!r)return mx.console.error(n+"unable to create script element"),this;this.setDomElement(r),r.setValueForAttribute("true","defer"),this.setEventReadystatechange(MX.Event.event(r,"readystatechange",this,"scriptDidFinishLoading")),this.setEventLoad(MX.Event.event(r,"load",this,"scriptDidFinishLoading")),this.setEventError(MX.Event.event(r,"error",this,"scriptDidFinishLoading"));var i=e.getURL(),s;for(s in e.allHTTPHeaderFields.objectEnumerator())i.setQueryValueForKey(e.allHTTPHeaderFields.objectForKey(s),s);return r.element.type="text/javascript",r.element.src=i.relativeString(),mx.isMSIE()&&(this.eventReadystatechange.noskip=0),MX.Runtime.headAppend(r.element),this},dealloc:function(){var e=mx.entry(this,"dealloc");return this.release("delegate"),this.cancel(),mx.superCall(this,arguments)},cancel:function(){var e=mx.entry(this,"cancel");return this._detachEvents(),this.release("domElement"),0},_detachEvents:function(){var e=mx.entry(this,"_detachEvents")
;return this.release("eventReadystatechange","eventLoad","eventError"),0},scriptDidFinishLoading:function(e){var t=mx.entry(this,"scriptDidFinishLoading"),n=MX.Runtime.document.readyState;if(mx.ifndef(typeof n)||n==="complete"||n==="loaded")return this._detachEvents(),mx.performSelector("scriptDidFinishLoading",this.delegate,e)}}),mx._(MX.URLConnectionScript),mx._("mx/foundation/mx_url_response"),MX.URLResponse=MX.Object.extend({_isa:"MX.URLResponse",allHeaderFields:null,statusCode:0,localizedStringForStatusCode:null,init:function(){var e=mx.entry(this,"init");return mx.superCall(this,arguments),this.synthesize("allHeaderFields"),this._setAllHeaderFields(MX.Dictionary.dictionary()),this.localizedStringForStatusCode="",this},dealloc:function(){var e=mx.entry(this,"dealloc");return this.release("allHeaderFields"),mx.superCall(this,arguments)},setAllHeaderFields:function(e){var t=mx.entry(this,"setAllHeaderFields");mx.istype(e,"MX.Element");try{var n=e.element.getAllResponseHeaders(),r=n.split("\n"),i=r.length,s,o;for(var u=0;u<i;u++)s=r[u],o=s.split(":",1),this.allHeaderFields.setObjectForKey(o[1],o[0])}catch(a){}return 0}}),mx._(MX.URLResponse),mx._("mx/foundation/mx_url_connection_jsonp"),MX.URLConnectionJSONP=MX.Object.extend({_isa:"MX.URLConnectionJSONP",delegate:null,ttlTimer:null,script:null,timeoutInterval:60,init:function(){var e=mx.entry(this,"init");return mx.superCall(this,arguments),MX.Runtime.enabled?(this.synthesize("delegate","ttlTimer","script"),this):(mx.console.error(e+"DOM functionality not available"),null)},initWithRequest:function(e,t){var n=mx.entry(this
,"initWithRequest");mx.istype(e,"MX.URLRequest"),this.timeoutInterval=e.timeoutInterval,this.setDelegate(t),this.setTtlTimer(MX.Timer.scheduledTimerWithTimeInterval(this.timeoutInterval,this,"cancel",{},!1));var r;return r=MX.URLConnectionScript.create(),this.setScript(r),r.setDelegate(this),r.initWithRequest(e,this),this},dealloc:function(){var e=mx.entry(this,"dealloc");return this.release("delegate","ttlTimer","script"),mx.superCall(this,arguments)},status:function(){var e=mx.entry(this,"status"),t=this.script.domElement;return mx.ifndef(typeof t)||mx.ifnval(t)?(mx.console.debug(e+": no connection"),-1):mx.ifnval(t.src)?(mx.console.debug(e+": not initialized"),0):mx.ifval(t.src)?(mx.console.debug(e+": connection established"),1):-1},scriptDidFinishLoading:function(e){var t=mx.entry(this,"scriptDidFinishLoading");return this.connectionDidFinishLoading(e)},scriptDidFailWithError:function(e){var t=mx.entry(this,"scriptDidFinishLoading");return this.connectionDidFailWithError(e)},connectionDidReceiveData:function(e){var t=mx.entry(this,"connectionDidReceiveData");return mx.performSelector("connectionDidReceiveData",this.delegate,e)},connectionDidFinishLoading:function(e){var t=mx.entry(this,"connectionDidFinishLoading");this._ttlCancel();var n=MX.Stack.pop();return mx.ifval(n)?(this.connectionDidReceiveResponse(),this.connectionDidReceiveData(n),mx.performSelector("connectionDidFinishLoading",this.delegate,n)):this.connectionDidFailWithError(e)},connectionDidFailWithError:function(e){var t=mx.entry(this,"connectionDidFailWithError");return mx.performSelector("connectionDidFailWithError"
,this.delegate,e)},connectionDidReceiveResponse:function(){var e=mx.entry(this,"connectionDidReceiveResponse"),t=MX.URLResponse.create();return t.statusCode=200,mx.performSelector("connectionDidReceiveResponse",this.delegate,t),0},setTimeoutInterval:function(e){var t=mx.entry(this,"setTimeoutInterval");mx.isnum(e);var n=parseInt(e,10);return this.timeoutInterval=n,0},_ttlCancel:function(){var e=mx.entry(this,"_ttlCancel"),t=this.ttlTimer;return mx.ifval(t)&&t.invalidate(),0},cancel:function(){var e=mx.entry(this,"cancel"),t=this.script;t&&t.cancel&&t.cancel(),this._ttlCancel();var n=MX.Error.errorWithDomain(e,-1003,{localizedDescription:"Connection timed out"});return this.connectionDidFailWithError(n)}}),MX.URLConnectionJSONP.mixin({connectionWithRequest:function(e,t){var n=mx.entry(this,"connectionWithRequest");return MX.URLConnectionJSONP.create().initWithRequest(e,t)}}),mx._(MX.URLConnectionJSONP),mx._("mx/foundation/mx_url_connection"),MX.URLConnection=MX.Object.extend({_isa:"MX.URLConnection",delegate:null,xhr:null,ttlTimer:null,request:null,eventOnprogress:null,eventOnerror:null,eventOntimeout:null,eventOnload:null,eventOnreadystatechange:null,XHR_UNSENT:0,XHR_OPENED:1,XHR_HEADERS_RECEIVED:2,XHR_LOADING:3,XHR_DONE:4,init:function(){return mx.entry(this,"init"),mx.superCall(this,arguments),this.synthesize("delegate","xhr","ttlTimer","request","eventOnprogress","eventOnerror","eventOntimeout","eventOnload","eventOnreadystatechange"),this.setTtlTimer(MX.Timer.create()),this},initWithRequest:function(e,t){var n=mx.entry(this,"initWithRequest");mx.istype(e,"MX.URLRequest")
,this.xhr||this.setXhr(MX.Element.elementWithRef(MX.Runtime.xmlHttpRequest())),this.setDelegate(t);if(e.URL.path==="/wm/aps")return e=CoreMail.MailRequest.getUrl(e.getURL().relativeString()),e.notify(this,"connectionDidReceiveResponse"),e.send(),this;var r=e.getURL();if(!r.checkResourceIsRelative())return mx.console.error(n+"access to a non-relative resource requires MX.URLConnectionJSONP"),null;this.setRequest(e),e.timeoutInterval&&this._ttlTimeout(e.timeoutInterval),e.async&&(this.setEventOnprogress(MX.Event.event(this.xhr,"progress",this,"connectionDidReceiveProgress")),this.setEventOnerror(MX.Event.event(this.xhr,"error",this,"connectionDidFailWithError")),this.setEventOnreadystatechange(MX.Event.event(this.xhr,"readystatechange",this,"connectionDidReceiveResponse"))),e.credential?this.xhr.element.open(e.HTTPMethod,e.getURL().relativeString(),e.async,e.credential.user,e.credential.password):this.xhr.element.open(e.HTTPMethod,e.getURL().relativeString(),e.async);var i,s=e.allHTTPHeaderFields.objectEnumerator(),o=s.get("length");for(i=0;i<o;i++)this.xhr.element.setRequestHeader(i,e.allHTTPHeaderFields.objectForKey(i));switch(e.HTTPMethod){case"GET":try{this.xhr.element.send(null)}catch(u){return mx.console.error(n+"GET send failed due to "+u),this}break;case"POST":mx.hasBinary()&&this.xhr.element.sendAsBinary?this.xhr.element.sendAsBinary(e.HTTPBody):this.xhr.element.send(e.HTTPBody);break;default:return mx.console.error(n+"unsupport method "+e.HTTPMethod),this}return e.async||this._handleSyncronousRequest(this.xhr,t),this},dealloc:function(){return mx.entry(this,"dealloc"
),this.release("delegate","ttlTimer","request"),this.releaseEvents(),this.release("xhr"),mx.superCall(this,arguments)},status:function(){var e=mx.entry(this,"status");if(!this.xhr)return mx.console.debug(e+"no connection"),-1;var t=this.xhr.element.readyState;switch(t){case this.XHR_UNSENT:mx.console.debug(e+"not initialized");break;case this.XHR_OPENED:mx.console.debug(e+"connection established");break;case this.XHR_HEADERS_RECEIVED:mx.console.debug(e+"request received");break;case this.XHR_LOADING:mx.console.debug(e+"answer in process");break;case this.XHR_DONE:mx.console.debug(e+"finished")}return t},releaseEvents:function(){return mx.entry(this,"releaseEvents"),this.eventOnprogress&&this.release("eventOnprogress","eventOnerror","eventOntimeout","eventOnload","eventOnreadystatechange"),0},_handleSyncronousRequest:function(e,t){mx.entry(this,"_handleSyncronousRequest");var n=MX.URLResponse;return n.setAllHeaderFields(e),n.statusCode=e.element.status,n.localizedStringForStatusCode=e.element.statusText,t.response=n,t.data=e.element.responseText,0},connectionDidReceiveAuthenticationChallenge:function(){mx.entry(this,"connectionDidReceiveAuthenticationChallenge");var e=MX.URLAuthenticationChallenge.create();return e.sender=this,mx.performSelector("connectionDidReceiveAuthenticationChallenge",this.delegate,e)},useCredentialForAuthenticationChallenge:function(e){var t=mx.entry(this,"useCredentialForAuthenticationChallenge");if(mx.ifnval(e))return mx.console.error(t+"null credential"),0;var n=this.request;return n.credential=e,this.initWithRequest(n,this.delegate)},continueWithoutCredentialForAuthenticationChallenge
:function(){return mx.entry(this,"continueWithoutCredentialForAuthenticationChallenge"),0},cancelAuthenticationChallenge:function(){return mx.entry(this,"cancelAuthenticationChallenge"),0},connectionDidReceiveResponse:function(e){var t=mx.entry(this,"connectionDidReceiveResponse");if(e&&e.get&&e.get("request")&&e.getPath("request.address")&&e.getPath("request.address").indexOf("/wm/aps?")===0&&this.xhr)this.xhr.element=e.get("rawRequest");else{if(!this.xhr){mx.console.error(t+"no connection");var n=MX.Error.errorWithDomain(t,-1e3,{localizedDescription:"connection is invalid"});return this.connectionDidFailWithError(n)}if(this.xhr.element){if(this.xhr.element.readyState!==this.XHR_DONE)return mx.console.debug(t+"XHR state: "+this.xhr.element.readyState+", waiting for state XHR_DONE"),0;var r=this.xhr.element.status;if(r===401||r===421)return mx.console.debug(t+"basic auth request"),this.connectionDidReceiveAuthenticationChallenge()}else SC.warn("push provisioning failed. this.xhr.element is null");this._ttlCancel(),this.releaseEvents()}var i=MX.URLResponse.create();return this.xhr?(this.xhr.element?(i.statusCode=this.xhr.element.status,i.localizedStringForStatusCode=this.xhr.element.statusText):SC.warn("push provisioning failed. this.xhr.element is null"),i.setAllHeaderFields(this.xhr)):(i.statusCode=204,i.localizedStringForStatusCode="No Response"),mx.performSelector("connectionDidReceiveResponse",this.delegate,i),this.connectionDidReceiveData(),0},connectionDidFailWithError:function(e){return mx.entry(this,"connectionDidFailWithError"),this._ttlCancel(),this.releaseEvents()
,mx.performSelector("connectionDidFailWithError",this.delegate,e)},connectionDidReceiveData:function(){var e=mx.entry(this,"connectionDidReceiveData");if(!this.xhr)return mx.console.debug(e+"no connection"),-1;var t;return this.xhr.element?t=this.xhr.element.responseText:SC.warn("push provisioning failed. this.xhr.element is null"),mx.performSelector("connectionDidReceiveData",this.delegate,t),this.connectionDidFinishLoading()},connectionDidReceiveProgress:function(e){mx.entry(this,"connectionDidReceiveProgress");var t=e.loaded,n=e.total;if(n<=0||n>1e9)n=0+e.total;t<=0&&(t=0+e.loaded);var r=t/n*100;return mx.performSelector("connectionDidReceiveProgress",this.delegate,r)},connectionDidFinishLoading:function(){return mx.entry(this,"connectionDidFinishLoading"),this._ttlCancel(),this.releaseEvents(),mx.performSelector("connectionDidFinishLoading",this.delegate)},_ttlTimeout:function(e){return mx.entry(this,"_ttlTimeout"),this.setTtlTimer(MX.Timer.scheduledTimerWithTimeInterval(e,this,"cancel",{},!1)),0},_ttlCancel:function(){return mx.entry(this,"_ttlCancel"),this.ttlTimer&&this.ttlTimer.invalidate(),0},cancel:function(){var e=mx.entry(this,"cancel");this._ttlCancel(),this.xhr&&this.xhr.element.abort(),this.releaseEvents();var t=MX.Error.errorWithDomain(e,-1003,{localizedDescription:"Connection timed out"});return mx.performSelector("connectionDidFailWithError",this.delegate,t)}}),MX.URLConnection.mixin({connectionWithRequest:function(e,t){return mx.entry(this,"connectionWithRequest"),MX.URLConnection.create().initWithRequest(e,t)},sendSynchronousRequest:function(e){mx.entry(this
,"sendSynchronousRequest");var t={response:null,data:null};return e.async=!1,MX.URLConnection.connectionWithRequest(e,t),t.data}}),mx._(MX.URLConnection),mx._("mx/foundation/mx_string"),MX.String={_isa:"MX.String",caseInsensitiveCompare:function(e,t){var n=mx.entry(this,"caseInsensitiveCompare");return e||(e=""),t||(t=""),e=e.toLowerCase(),t=t.toLowerCase(),e===t?0:e<t?-1:1},pathExtension:function(e){var t=mx.entry(this,"pathExtension");mx.istype(e,"string");var n=e.lastIndexOf("."),r="";return n!==-1&&(r=e.substring(n+1)),r},stringWithContentsOfURL:function(e){var t=mx.entry(this,"stringWithContentsOfURL");mx.istype(e,"MX.URL");var n=MX.URLRequest.create();n.initWithURL(e,MX.URLRequestUseProtocolCachePolicy,60);var r=MX.URLConnection.sendSynchronousRequest(n);return r},stringBeginsWith:function(e,t){var n=mx.entry(this,"stringBeginsWith");return e.indexOf(t)===0?1:0},stringByTrimmingCharactersInSet:function(e,t){var n=mx.entry(this,"stringByTrimmingCharactersInSet");return e.trim instanceof Function?e.trim():e.replace(/^\s+|\s+$/gm,"")},stringByAddingPercentEscapes:function(e){var t=mx.entry(this,"stringByAddingPercentEscapes"),n=encodeURIComponent(e);return n=n.replace(/%2F/gi,"/"),n},stringByReplacingPercentEscapes:function(e){var t=mx.entry(this,"stringByReplacingPercentEscapes"),n=decodeURIComponent(e);return n},stringByEncodingToJSON:function(e){var t=mx.entry(this,"stringByEncodingToJSON");return e||mx.raise(t+"NULL object"),MX.XPC?MX.XPC.JSON().encode(e):mx.ifdef(typeof JSON)?JSON.stringify(e):MX.String._JSONstringify(e)},_JSONstringify:function(e){var t=mx.entry(this
,"_JSONencode");if(!e)return null;var n=e instanceof Array,r=[],i,s;for(i in e){s=n?"":'"'+i+'":';switch(typeof e[i]){case"object":s+=this._JSONstringify(e[i]);break;case"number":case"boolean":s+=e[i];break;default:s+='"'+e[i]+'"'}r.push(s)}return n?"["+r.join(",")+"]":"{"+r.join(",")+"}"},objectFromJSONString:function(e){var t=mx.entry(this,"objectFromJSONString");try{return mx.ifdef(typeof JSON)?JSON.parse(e):MX.XPC?MX.XPC.JSON().decode(e):mx.exec("var fn = function() { return "+e+" ; } ; fn() ;")}catch(n){return mx.console.warn(t+" "+n+" parsing ["+e+"]"),null}},rangeOfString:function(e,t,n){var r=mx.entry(this,"rangeOfString");if(mx.ifnval(e))return mx.console.error(r+"empty string"),-1;if(n===MX.BackwardsSearch){if(e.lastIndexOf instanceof Function)return e.lastIndexOf(t);var i=e.indexOf(t),s=i,o=t.length;do i=s,s=e.indexOf(t,i+o);while(s!==-1);return i}return-1},classDidFinishLoading:function(){MX.CaseInsensitiveSearch=1,MX.LiteralSearch=2,MX.BackwardsSearch=4,MX.AnchoredSearch=8,MX.NumericSearch=64,MX.DiacriticInsensitiveSearch=128,MX.WidthInsensitiveSearch=256,MX.ForcedOrderingSearch=512,MX.WhitespaceAndNewlineCharacterSet=1e3}},mx._(MX.String),PushService=SC.Object.create({_isa:"push_service_bundle",aps:null,task:null,timer:null,retryInterval:60,me_trace:NO,initial:"Push Service starting"}),SC.mixin(PushService,{configure:function(){var e=mx.entry(this,"configure");return this.aps=APS.Application.sharedApplication(),this.aps.setDelegate(this),CoreMail&&CoreMail.TOKEN?this.aps.request.setApsToken(CoreMail.TOKEN):this.aps.request.setApsToken(mx.generateUUID()),this.aps
.request.setServiceHost("https://webcourier.sandbox.push.apple.com/aps"),this.aps.setHandler("mail",APS.Mail.create()),this.aps.setHandler("support",APS.Support.create()),mx.autoretain(this,"timer",MX.Timer.scheduledTimerWithTimeInterval(5,this,"startNotifications",null,!1)),0},start:function(){var e=mx.entry(this,"start");return this.startNotifications()},token:function(){var e=mx.entry(this,"token");return this.aps?this.aps.clientToken():null},playSound:function(e){var t=mx.entry(this,"playSound");return this.aps.apsSound.playResource(e)},status:function(){var e=mx.entry(this,"status"),t=this.aps;return mx.ifnval(t)?mx.console.debug(e+"not started"):(mx.console.debug(e+"initialized"),mx.console.debug(e+"Provider:"),this.aps.service.connection?this.aps.provider.connection.status():mx.console.debug(e+"not connected"),mx.console.debug(e+"Service"),this.aps.service.connection?this.aps.service.connection.status():mx.console.debug(e+"not connected")),0},stop:function(){var e=mx.entry(this,"stop");return this.stopNotifications()},startNotifications:function(){var e=mx.entry(this,"startNotifications");return Global.get("isAppReady")?(this.aps.registerForRemoteNotifications(),0):(mx.autoretain(this,"timer",MX.Timer.scheduledTimerWithTimeInterval(5,this,"startNotifications",null,!1)),1)},stopNotifications:function(){var e=mx.entry(this,"stopNotifications");return mx.performSelector("invalidate",this.timer),this.aps.unregisterForRemoteNotifications(),0},didReceiveAuthenticationChallenge:function(){var e=mx.entry(this,"didReceiveAuthenticationChallenge");return 0},didRegisterForRemoteNotifications
:function(){var e=mx.entry(this,"didRegisterForRemoteNotifications");return this.retryInterval=60,0},didReceiveRemoteNotification:function(){var e=mx.entry(this,"didReceiveRemoteNotification");return 0},didFailToRegisterForRemoteNotifications:function(e){var t=mx.entry(this,"didFailToRegisterForRemoteNotifications");return CoreMail.errorHandler.recordStat("_count_PUSH_PROVISIONING_FAILED",{reason:e}),mx.autoretain(this,"timer",MX.Timer.scheduledTimerWithTimeInterval(this.retryInterval,this,"startNotifications",null,!1)),this.retryInterval*=2,0},didNetworkDisconnect:function(){var e=mx.entry(this,"didNetworkDisconnect");return 0},didNetworkConnect:function(){var e=mx.entry(this,"didNetworkConnect");return 0},networkReachabiityChangeNotification:function(e){var t=mx.entry(this,"networkReachabiityChangeNotification");return mx.console.debug(t+e),0}}),VipSender=SC.Object.create({currentStates:function(e,t){var n=VipSender.statechart.currentStates(),r=[];return n?(n.forEach(function(e){r.push(e.get("name"))}),r):"startupState"}.property()}),VipSender.mixin({isVipSendersListLoaded:NO,vipDataRefreshed:Math.random(),openVIPDisclosure:NO,prevVips:null,configure:function(){VipSender.statechart.initStatechart()},notifyVipRefresh:function(){this.set("vipDataRefreshed",Math.random())},isRefreshEnabled:YES,vipRefreshDisableTimer:null,enableRefresh:function(){this.stopTheDisableVipRefreshTimer(),this.set("isRefreshEnabled",YES)},disableRefresh:function(){this.set("isRefreshEnabled",NO)},startTheDisableVipRefreshTimer:function(){if(!this.get("vipRefreshDisableTimer")){var e=SC.Timer.schedule
({target:"VipSender",action:"disableRefresh",repeats:NO,interval:CoreMail.INTERVAL_VIP_POLL});this.set("vipRefreshDisableTimer",e)}},stopTheDisableVipRefreshTimer:function(){var e=this.get("vipRefreshDisableTimer");e!==null&&(e.invalidate(),this.set("vipRefreshDisableTimer",null))},vips:null,isVip:function(e){if(SC.empty(e)===YES)return NO;var t=this.vips;if(!t)return NO;var n=NO,r;e=e.toLowerCase();for(var i=0,s=t.get("length");i<s;i++){r=t.objectAt(i);if(r.get("status")===SC.Record.READY_CLEAN){var o=r.get("addresses");for(var u=0,a=o.get("length");u<a;u++)if(o[u].toLowerCase()===e){n=r;break}if(n)break}}return n},addVip:function(e){this.statechart.sendAction("addVip",e)},updateVipAddresses:function(e,t){if(!t||t.length===0||!e)return;var n=e.get("addresses"),r=NO;n?n=n.slice(0):n=[];for(var i=0,s=t.length;i<s;i++)n.indexOf(t[i])===-1&&(n.push(t[i]),r=YES);r===YES&&this.statechart.sendAction("updateVipAddresses",{vipRecord:e,addresses:n})},updateVipName:function(e,t,n){this.statechart.sendAction("updateVipName",{vipRecord:e,name:t,folderListRequestStatus:n})},deleteVip:function(e){this.statechart.sendAction("deleteVip",e)},updateMainWindowUI:function(){var e,t;if(window.WHAT_TYPE.isMail()===YES)e=FolderList,t=VipSender;else{if(window.WHAT_TYPE.isMailChild()!==YES||!opener)return;e=opener.FolderList,t=opener.VipSender}e.dispatch({sig:"clickOnRefreshButton"}),t.notifyVipRefresh()},updateVipSendersInMainWindow:function(){if(window.WHAT_TYPE.isMailChild()===YES&&opener){var e=opener.CoreMail.store,t,n;if(opener.VipSender.get("isVipSendersListLoaded")===YES){var r=opener.CoreMail
.getVipSenders(),i,s;n=r.get("length");for(t=0;t<n;t++)i=r.objectAt(t),s=i.get("guid"),e.pushDestroy(opener.CoreMail.VipSender,s)||SC.warn("VipSender.updateMainWindowStore could not clear: "+s)}var o=CoreMail.getVipSenders(),u=[];for(t=0,n=o.get("length");t<n;t++)u.push(o.objectAt(t).toHash());for(var a=0,f=u.length;a<f;a++){var l,c=[];l=u[a].addresses;if(l.length>0){for(var h=0,p=l.length;h<p;h++)c.push(l[h]);u[a].addresses=c}}var d=SC.json.encode(u);opener.Global.execFunctionInMailContext(opener.VipSender,VipSender.loadRecordsFromStringifiedVipSenders,d)}VipSender.updateMainWindowUI()},loadRecordsFromStringifiedVipSenders:function(e){var t=SC.json.decode(e);CoreMail.store.loadRecords(CoreMail.VipSender,t)}}),VipSender.mixin({_currentState:function(e,t){VipSender.statechart.currentStates().forEach(function(e){SC.Logger.warn(e.get("name"))})}.property()}),VipSender.SyncManager=SC.State.extend({initialSubstate:"fetchVips",fetchVips:SC.State.plugin("VipSender.SyncManager.FetchVips"),vipsFetched:SC.State.plugin("VipSender.SyncManager.VipsFetched"),vipsNotFetched:SC.State.plugin("VipSender.SyncManager.VipsNotFetched"),scheduleVipRefresh:SC.State.plugin("VipSender.SyncManager.ScheduleVipRefresh"),refreshVips:SC.State.plugin("VipSender.SyncManager.RefreshVips"),refreshSuccessful:SC.State.plugin("VipSender.SyncManager.RefreshSuccessful"),refreshFailed:SC.State.plugin("VipSender.SyncManager.RefreshFailed")}),VipSender.SyncManager.FetchVips=SC.State.extend({enterState:function(){this.vips=CoreMail.getVipSenders(),window.WHAT_TYPE.isMailChild()===YES&&(VipSender.set("vips",this.vips),
this.vips=null)},fetchVipRequestStatusDidChange:function(e){this.vips=null;switch(e.get("status")){case SC.Record.READY_CLEAN:VipSender.set("vips",e),VipSender.set("prevVips",e.toArray()),this.gotoState("vipsFetched"),CoreMail.feedbackWSStats();break;case SC.Record.ERROR:this.gotoState("vipsNotFetched")}}.stateObserves(".vips.status")}),VipSender.SyncManager.RefreshFailed=SC.State.extend({enterState:function(){this.gotoState("scheduleVipRefresh")}}),VipSender.SyncManager.RefreshSuccessful=SC.State.extend({enterState:function(){VipSender.setIfChanged("isVipSendersListLoaded",YES);var e=VipSender.get("prevVips"),t=VipSender.get("vips"),n=e.get("length"),r=t.get("length"),i=NO;if(n!==r)i=YES;else for(var s=0;s<r;s++)if(e.objectAt(s).get("name")!==t.objectAt(s).get("name")){i=YES;break}i===YES&&(VipSender.set("prevVips",t.toArray()),VipSender.updateMainWindowUI()),VipSender.notifyVipRefresh(),this.gotoState("scheduleVipRefresh")}}),VipSender.SyncManager.RefreshVips=SC.State.extend({enterState:function(){VipSender.getPath("vips.status")&SC.Record.READY&&VipSender.get("isRefreshEnabled")?this.vips=CoreMail.getVipSenders(YES):this.gotoState("scheduleVipRefresh")},refreshVipRequestStatusDidChange:function(e){this.vips=null;switch(e.get("status")){case SC.Record.READY_CLEAN:VipSender.set("vips",e),this.gotoState("refreshSuccessful");break;case SC.Record.ERROR:this.gotoState("refreshFailed")}}.stateObserves(".vips.status")}),VipSender.SyncManager.ScheduleVipRefresh=SC.State.extend({enterState:function(e){var t=this;this.invokeLater(function(){t.gotoState("refreshVips")},CoreMail.INTERVAL_VIP_POLL
)}}),VipSender.SyncManager.VipsFetched=SC.State.extend({enterState:function(){VipSender.set("isVipSendersListLoaded",YES),VipSender.notifyVipRefresh(),this.gotoState("scheduleVipRefresh")}}),VipSender.SyncManager.VipsNotFetched=SC.State.extend({enterState:function(e){this.gotoState("scheduleVipRefresh")}}),VipSender.VipCrudManager=SC.State.extend({initialSubstate:"standby",standby:SC.State.design({addVip:function(e){this.gotoState("addVipState",e)},deleteVip:function(e){this.gotoState("deleteVipState",e)},updateVipAddresses:function(e){this.gotoState("updateVipAddressesState",e)},updateVipName:function(e){this.gotoState("updateVipNameState",e)}}),addVipState:SC.State.plugin("VipSender.VipCrudManager.AddVip"),deleteVipState:SC.State.plugin("VipSender.VipCrudManager.DeleteVip"),updateVipAddressesState:SC.State.plugin("VipSender.VipCrudManager.UpdateVipAddresses"),updateVipNameState:SC.State.plugin("VipSender.VipCrudManager.UpdateVipName")}),VipSender.VipCrudManager.AddVip=SC.State.extend({enterState:function(e){VipSender.vips.get("status")&SC.Record.READY&&(SC.Benchmark.start("perfAddVIP"),this._add(e))},_add:function(e){this._addStatus=CoreMail.createVipSender(e)},_addStatusDidChange:function(e){var t=e;switch(t.get("state")){case t.STATE_SUCCESS:this._addStatus=null,this.gotoState("addSuccess",e);break;case t.STATE_PENDING:break;case t.STATE_ERROR:this._addStatus=null,this.gotoState("addFailed")}}.stateObserves("._addStatus.state"),addSuccess:SC.State.design({enterState:function(){var e=window.WHAT_TYPE.isMail();e===NO?(VipSender.updateVipSendersInMainWindow(),VipSender.notifyVipRefresh
()):e===YES&&VipSender.updateMainWindowUI(),CoreMail.getVipSenders().length()===1&&VipSender.set("openVIPDisclosure",YES),SC.Benchmark.end("perfAddVIP"),this.gotoState("standby")}}),addFailed:SC.State.design({enterState:function(){CoreMail.errorHandler.handleError({keyString:"VipSender.AddFailed.ServerError"}),this.gotoState("standby")}})}),VipSender.VipCrudManager.DeleteVip=SC.State.extend({guidOfVipToDelete:null,enterState:function(e){VipSender.vips.get("status")&SC.Record.READY&&(this.set("guidOfVipToDelete",e.get("guid")),this._delete(e))},_delete:function(e){this._deleteStatus=CoreMail.deleteVipSender(e)},_deleteStatusDidChange:function(e){var t=e;switch(t.get("state")){case t.STATE_SUCCESS:this._deleteStatus=null,this.gotoState("deleteSuccess");break;case t.STATE_PENDING:break;case t.STATE_ERROR:this._deleteStatus=null,this.gotoState("deleteFailed")}}.stateObserves("._deleteStatus.state"),deleteSuccess:SC.State.design({enterState:function(){window.WHAT_TYPE.isMail()===NO&&VipSender.notifyVipRefresh();if(window.WHAT_TYPE.isMailChild()===YES&&opener){var e=this.getPath("parentState.guidOfVipToDelete");opener.CoreMail.store.pushDestroy(opener.CoreMail.VipSender,e)||SC.warn("VipSender.VipCrudManager.DeleteVip.deleteSuccess.enterState could not destroy: "+e)}VipSender.updateMainWindowUI(),this.gotoState("standby")}}),deleteFailed:SC.State.design({enterState:function(){CoreMail.errorHandler.handleError({keyString:"VipSender.DeleteFailed.ServerError"}),this.gotoState("standby")}})}),VipSender.VipCrudManager.UpdateVipAddresses=SC.State.extend({guidOfVipToUpdate:null,enterState
:function(e){VipSender.vips.get("status")&SC.Record.READY&&(this.set("guidOfVipToUpdate",e.vipRecord.get("guid")),this._update(e))},_update:function(e){this._updateStatus=CoreMail.updateVipSenderAddresses(e.vipRecord,e.addresses)},_updateStatusDidChange:function(e){var t=e;switch(t.get("state")){case t.STATE_SUCCESS:this._updateStatus=null,this.gotoState("updateSuccess");break;case t.STATE_PENDING:break;case t.STATE_ERROR:this._updateStatus=null,this.gotoState("updateFailed")}}.stateObserves("._updateStatus.state"),updateSuccess:SC.State.design({enterState:function(e){if(window.WHAT_TYPE.isMailChild()===YES&&opener){var t=this.getPath("parentState.guidOfVipToUpdate"),n=CoreMail.store.find(CoreMail.VipSender,t).toHash();opener.CoreMail.store.loadRecord(opener.CoreMail.VipSender,n,t)}VipSender.updateMainWindowUI(),this.gotoState("standby")}}),updateFailed:SC.State.design({enterState:function(e){this.gotoState("standby")}})}),VipSender.VipCrudManager.UpdateVipName=SC.State.extend({vipToRename:null,enterState:function(e){VipSender.vips.get("status")&SC.Record.READY&&(this.set("folderListRequestStatus",e.folderListRequestStatus),this.set("vipToRename",e.vipRecord),this._update(e))},_update:function(e){this._updateStatus=CoreMail.updateVipSenderName(e.vipRecord,e.name)},_updateStatusDidChange:function(e){var t=e;switch(t.get("state")){case t.STATE_SUCCESS:this._updateStatus=null,this.gotoState("updateSuccess");break;case t.STATE_PENDING:break;case t.STATE_ERROR:this._updateStatus=null,this.gotoState("updateFailed")}}.stateObserves("._updateStatus.state"),updateSuccess:SC.State.design
({enterState:function(e){this.getPath("parentState.folderListRequestStatus").setSuccess(),this.gotoState("standby")}}),updateFailed:SC.State.design({enterState:function(e){this.getPath("parentState.folderListRequestStatus").setError({});var t=this.getPath("parentState.vipToRename");CoreMail.errorHandler.handleError({keyString:"VipSender.RenameFailed.ServerError",messageLocParams:{vipSender:t.get("name")}}),this.gotoState("standby")}})}),VipSender.statechart=SC.Statechart.create({trace:YES,autoInitStatechart:NO,initialState:"startupState",startupState:SC.State.design({substatesAreConcurrent:YES,enterState:function(e){},syncManager:SC.State.plugin("VipSender.SyncManager"),vipCrudManager:SC.State.plugin("VipSender.VipCrudManager"),exitState:function(e){}})}),function(){var e="preferences";if(!SC.MODULE_INFO)throw"SC.MODULE_INFO is not defined!";if(SC.MODULE_INFO[e])return;SC.MODULE_INFO[e]=SC.Object.create({dependencies:[],styles:[],styles2x:[],scriptURL:"/applications/mail/1808Project39/frameworks/preferences/1808Project39/en-us/javascript.js",stringURL:"/applications/mail/1808Project39/frameworks/preferences/1808Project39/en-us/javascript-strings.js"})}(),function(){var e="mailfilters";if(!SC.MODULE_INFO)throw"SC.MODULE_INFO is not defined!";if(SC.MODULE_INFO[e])return;SC.MODULE_INFO[e]=SC.Object.create({dependencies:[],styles:[],styles2x:[],scriptURL:"/applications/mail/1808Project39/frameworks/mailfilters/1808Project39/en-us/javascript.js",stringURL:"/applications/mail/1808Project39/frameworks/mailfilters/1808Project39/en-us/javascript-strings.js"})}(),function(){var e="blacklist"
;if(!SC.MODULE_INFO)throw"SC.MODULE_INFO is not defined!";if(SC.MODULE_INFO[e])return;SC.MODULE_INFO[e]=SC.Object.create({dependencies:[],styles:[],styles2x:[],scriptURL:"/applications/mail/1808Project39/frameworks/blacklist/1808Project39/en-us/javascript.js",stringURL:"/applications/mail/1808Project39/frameworks/blacklist/1808Project39/en-us/javascript-strings.js"})}(),function(){var e="contacts";if(!SC.MODULE_INFO)throw"SC.MODULE_INFO is not defined!";if(SC.MODULE_INFO[e])return;SC.MODULE_INFO[e]=SC.Object.create({dependencies:[],styles:[],styles2x:[],scriptURL:"/applications/mail/1808Project39/frameworks/contacts/1808Project39/en-us/javascript.js",stringURL:"/applications/mail/1808Project39/frameworks/contacts/1808Project39/en-us/javascript-strings.js"})}(),function(){var e="cloudkit/core_types";if(!SC.MODULE_INFO)throw"SC.MODULE_INFO is not defined!";if(SC.MODULE_INFO[e])return;SC.MODULE_INFO[e]=SC.Object.create({dependencies:[],styles:[],styles2x:[],scriptURL:"/applications/mail/1808Project39/frameworks/cloudkit/core_types/1808Project39/en-us/javascript.js",stringURL:"/applications/mail/1808Project39/frameworks/cloudkit/core_types/1808Project39/en-us/javascript-strings.js"})}(),window.Mail=CK.Application.create(Global.PostMessageHandlerMixin,{name:"mail",version:"1.0"}),Mail.mainSplitController=SC.Controller.create({isShowingFolderList:function(e,t){t!==undefined&&(this._isShowingFolderList=t);if(this._isShowingFolderList!==undefined)return this._isShowingFolderList;var n=CoreMail.getPath("implicitPreferences.view");return n!==MessageList.ORIENTATION_TWO_COL}.property()
,viewPreferenceDidChange:function(){var e=MessageList.get("viewPreference"),t=this.getPath("splitView.pane.dockView");MessageList.ORIENTATION_TWO_COL===e?(Mail.mainSplitController.hideFolderList(),t&&t.setAppSwitchViewWidth(Mail.metrics.DEFAULT_MIN_APP_SWITCHER_WIDTH)):Mail.mainSplitController.showFolderList()}.observes("MessageList.viewPreference"),hideFolderList:function(e){this.set("isShowingFolderList",NO);var t=this.get("splitView"),n=t.get("bottomRightView"),r=n.get("position");e?this.animate(r,0):t.adjustPositionForChild(n,1)},showFolderList:function(e){this.set("isShowingFolderList",YES);var t=this.get("splitView"),n=CoreMail.getPath("implicitPreferences.folderListWidth");e?this.animate(0,n):(t.adjustPositionForChild(t.bottomRightView,n+1),SC.browser.isIE?this.invokeLast(function(){FolderList.getPath("page.folderList").scrollTo(0,0),FolderList.showSelectedFolder()}):(FolderList.getPath("page.folderList").scrollBy(0,-1),FolderList.invokeLast(FolderList.showSelectedFolder)))},animate:function(e,t){this.set("isAnimating",YES);var n=this,r=350,i=this.getPath("splitView.pane.dockView"),s=this.get("splitView"),o=s.childViews[0],u=s.childViews[1],a=s.childViews[2],f=o.get("size"),l,c=u.get("position"),h,p=a.get("position"),d,v=o.get("sizeOffset"),m=u.get("positionOffset"),g=a.get("positionOffset"),y=u.$(),b=a.$(),w=o.get("childViews")[0],E=NO,S;w&&(S=w.$(),S&&S.length>0&&(S.removeClass("stack-order"),E=YES)),s.adjustPositionForChild(s.bottomRightView,t+1),a.adjust("width",a.get("size")),this.invokeLast(function(){l=o.get("size"),h=u.get("position"),d=a.get("position"),CW.Animation
.create({name:"main-split-animation",freevars:"leftViewWidth dividerViewLeft rightViewLeft".w(),leftViewWidth:{from:f,to:l,duration:r,discreteness:1},dividerViewLeft:{from:c,to:h,duration:r,discreteness:1},rightViewLeft:{from:p,to:d,duration:r,discreteness:1},onStart:function(){this.leftViewWidth.to>this.leftViewWidth.from&&o.adjust("width",this.leftViewWidth.to+v)},update:function(){y.css("left",this.dividerViewLeft.current+m),b.css("left",this.rightViewLeft.current+g);var e=this.leftViewWidth.current,t=Math.max(e,Mail.metrics.DEFAULT_MIN_APP_SWITCHER_WIDTH),n;i.setAppSwitchViewWidth(t),this.leftViewWidth.to<this.leftViewWidth.from?(n=Mail.metrics.DEFAULT_MIN_APP_SWITCHER_WIDTH,n-=t-e,Mail.rightSplitController.updateDockView(n)):(n=-Mail.metrics.DEFAULT_MIN_APP_SWITCHER_WIDTH,n+=Math.min(e,Mail.metrics.DEFAULT_MIN_APP_SWITCHER_WIDTH),Mail.rightSplitController.updateDockView(n))},onFinish:function(){n.set("isAnimating",NO),o.splitChildLayoutDidChange(),u.splitChildLayoutDidChange(),a.splitChildLayoutDidChange(),E===YES&&S.addClass("stack-order")}}).start()})},splitViewSetSizeForChild:function(e,t,n){t.set("size",n);if(t===e.topLeftView){var r=e.getPath("pane.dockView");r&&r.setAppSwitchViewWidth&&r.setAppSwitchViewWidth(Math.max(Mail.metrics.DEFAULT_MIN_APP_SWITCHER_WIDTH,n)),n>=Mail.metrics.MIN_SOURCELIST_WIDTH&&(FolderList.set("folderListWidth",n),CoreMail.saveImplicitPreference("folderListWidth",n))}},splitViewConstrainSizeForChild:function(e,t,n){return t===e.topLeftView&&!this.get("isShowingFolderList")?0:e.splitViewConstrainSizeForChild(e,t,n)}}),Mail.rightSplitController=
SC.Controller.create({viewPreferenceDidChange:function(){this.updateDockView()}.observes("MessageList.viewPreference"),updateDockView:function(e){var t=this.get("splitView"),n=t.topLeftView.get("size");e===undefined&&(e=0);var r=t.getPath("pane.dockView");if(r&&r.setSearchViewWidth){var i=CoreMail.getPath("implicitPreferences.view");MessageList.ORIENTATION_TWO_COL===i?r.setSearchViewWidth(n-Mail.metrics.DEFAULT_MIN_APP_SWITCHER_WIDTH+e):r.setSearchViewWidth(n+e),MessageList.set("splitterPosition",n)}},splitViewSetSizeForChild:function(e,t,n){e.splitViewSetSizeForChild(e,t,n),t===e.bottomRightView&&this.updateDockView()}}),SC.mixin(Mail,{removeInvalidChildRef:function(){if(!this._childWindows){this._childWindowsRefChecker=null;return}for(var e=this._childWindows.length-1;e>=0;e--)this._childWindows[e]&&this._childWindows[e].closed&&this._childWindows.removeAt(e)}}),SC.mixin(Mail,{loadGlobal:function(){Mail.global=Global,Global.configure(Mail)},loadFolderList:function(){Mail.folderList=FolderList;var e=Mail.folderList;e.configure(Mail.mainPage.getPath("mainPane.appView.folderList")),Mail.messageList&&Mail.messageList.set("folderController",e.folderController)},loadMessageList:function(){Mail.messageList=MessageList;var e=Mail.messageList,t=Mail.mainPage.getPath("mainPane.appView.messages.topLeftView.containerView.contentView"),n=Mail.mainPage.getPath("mainPane.appView.searchPaneView");Mail.folderList&&e.set("folderController",Mail.folderList.folderController),e.page.set("owner",e),e.configure(t,n)},loadViewMessage:function(){Mail.viewMessage=ViewMessage,ViewMessage.page.set("owner"
,ViewMessage);var e=Mail.viewMessage,t=Mail.getPath("mainPage.mainPane.appView.messages.bottomRightView");e.configure(t,YES)},loadActionMenu:function(){Mail.actionMenu=ActionMenu;var e=Mail.actionMenu;Mail.messageList&&e.configure(Message.get("messageListController"),NO)},loadMainToolbar:function(){Mail.mainToolbar=MainToolbar;var e=Mail.mainToolbar;Mail.global&&e.set("global",Mail.global),Mail.actionMenu&&e.set("actionMenu",Mail.actionMenu),e.configure(Mail.mainPage.getPath("mainPane.dockView.toolbarView")),e.setPath("page.owner",e)},loadMoveToFolder:function(){if(CoreMail.get("werePreferencesFetched")===NO){this.loadMoveToFolder.invokeLater(this,CoreMail.INTERVAL_FOLDER_LIST_FETCH);return}MoveToFolder.configure(CoreMail.getFolders())},loadPreferencesContent:function(){SC.Benchmark.start(CoreMail.BENCH_MAIL_STARTUP),CoreMail.fetchServerPreferences()},loadPushService:function(){Mail.pushService=PushService;var e=Mail.pushService,t=Mail.getPath("mainPage.mainPane.dockView");e.configure(t,YES)},handleLoadingState:function(){if(CoreMail.get("werePreferencesFetched")===NO){this.handleLoadingState.invokeLater(this,CoreMail.INTERVAL_FOLDER_LIST_FETCH);return}this.folderObserver=function(){if(!Mail._isLoadingRemoved){var e=Mail._folderArray.get("status");e===SC.Record.READY_CLEAN?(Mail.getPath("mainPage.loadingMainPane").remove(),Mail.setPath("mainPage.mainPane.isVisible",YES),Mail._isLoadingRemoved=YES,Mail._folderArray.removeObserver("status",this,this.folderObserver),Mail._folderArray=null):e===SC.Record.ERROR&&(Mail._folderArray.removeObserver("status",this,this.folderObserver)
,Mail._folderArray=null)}},Mail._folderArray=CoreMail.getFolders(),Mail._folderArray.get("status")===SC.Record.READY_CLEAN?(Mail.getPath("mainPage.loadingMainPane").remove(),Mail.setPath("mainPage.mainPane.isVisible",YES),Mail._isLoadingRemoved=YES,Mail._folderArray=null):Mail._folderArray.addObserver("status",this,this.folderObserver)},loadCoreMessageModule:function(){Message.configure(Mail)},loadContacts:function(){if(CoreMail.get("werePreferencesFetched")===YES){this._loadContacts();return}CoreMail.addObserver("werePreferencesFetched",this,this._loadContacts)},_loadContacts:function(){CoreMail.get("werePreferencesFetched")===YES&&(SC.Module.loadModule("contacts","Contacts","configure"),CoreMail.removeObserver("werePreferencesFetched",this,this._loadContacts))},loadVipSenderModule:function(){VipSender.configure()},loadFlagMenuModule:function(){FlagMenu.configure()}}),SC.mixin(Mail,{applicationDidBecomeActive:function(e){SC.warn("APPLICATION: Received applicationDidBecomeActive"),CoreMail.set("cloudOSBenchmarks",e),window.VipSender&&VipSender.enableRefresh(),CoreMail.incrementUserStat(CoreMail.STAT_LOGIN),CoreMail.sendCollectedStats()},applicationDidSuspend:function(){SC.warn("APPLICATION: Received applicationDidSuspend"),window.VipSender&&VipSender.disableRefresh()},applicationShouldRefresh:function(e){e&&FolderList.dispatch({sig:"clickOnRefreshButton"})},accountPreferencesDidChange:function(){CloudOS.reload()},didLaunchWithNotification:function(e){SC.debug("APPLICATION: Received didLaunchWithNotification"),CoreMail.errorHandler.recordStat("_STAT_didLaunchWithNotification"
);if(!e){SC.warn("Mail.didLaunchWithNotification: payload is null");return}var t=e.mail;if(!t){SC.warn("Mail.didLaunchWithNotification: payload.mail is null");return}var n=t.folder;if(!n){SC.warn("Mail.didLaunchWithNotification: payload.mail.folder is null");return}var r=t.uid;if(!r){SC.warn("Mail.didLaunchWithNotification: payload.mail.uid is null");return}var i="folder:"+n,s="message:"+n+"/"+r,o=MessageList.get("shouldSelectCloudOSPushNotifiedMessage");if(o===YES)SC.info("didLaunchWithNotification: Message List is visible, firing showMessageInFolder call rightaway"),FolderList.showMessageInFolder(i,s);else{var u=function(){this.get("shouldSelectCloudOSPushNotifiedMessage")===YES&&(SC.info("didLaunchWithNotification: Message list is now visible, triggering showMessageInFolder call"),FolderList.showMessageInFolder(i,s),MessageList.removeObserver("shouldSelectCloudOSPushNotifiedMessage",u),MessageList.set("shouldSelectCloudOSPushNotifiedMessage",null))};SC.info("didLaunchWithNotification: Message List is not yet visible, delaying showMessageInFolder call"),MessageList.addObserver("shouldSelectCloudOSPushNotifiedMessage",MessageList,u)}},showHelp:function(){CloudOS.showHelp(CoreMail.HELP_TOPIC_ID)}}),SC.mixin(Mail,{}),SC.mixin(Mail,{loadRoutes:function(){SC.routes.add("prefs-general",Mail,"showPrefsGeneralTab"),SC.routes.add("prefs-accounts",Mail,"showPrefsAccountsTab"),SC.routes.add("prefs-addresses",Mail,"showPrefsAccountsTab"),SC.routes.add("prefs-composing",Mail,"showPrefsComposingTab"),SC.routes.add("prefs-rules",Mail,"showPrefsRulesTab"),SC.routes.add("prefs-vacation",Mail
,"showPrefsVacationTab"),SC.routes.add("prefs-blacklist",Mail,"showPrefsBlacklistTab"),SC.routes.add("debug",Mail,"enableDebugLogging"),SC.routes.add("trace",Mail,"enableStatechartTracing"),SC.routes.add("r",Mail,"enableVipDemoMode")},showPrefsGeneralTab:function(){this._showPrefsTab("showGeneral")},showPrefsAccountsTab:function(){this._showPrefsTab("showAccounts")},showPrefsComposingTab:function(){this._showPrefsTab("showComposing")},showPrefsRulesTab:function(){this._showPrefsTab("showRules")},showPrefsVacationTab:function(){this._showPrefsTab("showVacation")},showPrefsBlacklistTab:function(){this._showPrefsTab("showBlacklist")},_showPrefsTab:function(e){var t=CoreMail.get("werePreferencesFetched");this._timer&&this._timer.invalidate(),t?window.Preferences?Preferences.configure(e):SC.Module.loadModule("preferences","Preferences","configureWrapper",e):this._timer=Mail._showPrefsTab.invokeLater(this,200,e)},enableDebugLogging:function(){SC.Logger.set("logOutputLevel",SC.LOGGER_LEVEL_DEBUG)},enableStatechartTracing:function(){this.enableDebugLogging(),CK.Statechart.STATE_CHART_TRACE_ENABLED=YES},enableVipDemoMode:function(){CoreMail.INTERVAL_VIP_POLL=5e3}}),Mail.SearchView=SC.View.extend({layout:function(){return{centerY:0,height:42,left:3,right:0}}.property("viewPreference").cacheable(),viewPreference:null,viewPreferenceBinding:"MessageList.viewPreference",themeName:"message-list-search",classNames:"search-view".w(),childViews:["searchLeftView","searchTextView"],searchLeftView:SC.View.design({classNames:"search-left".w(),layout:{left:0,width:42,height:42},mouseDown:function(
){var e=this.getPath("parentView.searchTextView");e&&e.becomeFirstResponder()}}),searchTextView:SC.TextFieldView.design({classNames:"search-text".w(),layout:{left:35,top:-1,right:0,height:42},layerId:"search-key-field",textAlign:SC.ALIGN_LEFT,spellCheckEnabled:NO,hintBinding:SC.Binding.transform(function(e){if(e)return"_Toolbar.Message.Search.Hint".loc(SC.RenderContext.escapeHTML(e))}).from("FolderList.folderController.displayName"),valueBinding:"Message.searchController.searchFieldValue",fieldDidFocus:function(){arguments.callee.base.apply(this,arguments),Message.searchController.set("searchPaneVisible",YES)},fieldDidBlur:function(){arguments.callee.base.apply(this,arguments),MessageList.getPath("page.searchPaneView.searchTab.hasFirstResponder")===YES?this.becomeFirstResponder():this.get("value")===""&&Message.searchController.set("searchPaneVisible",NO)},keyDown:function(e){var t=e.commandCodes(),n=t[0],r;if("tab"===n){var i=Message.messageListController.get("selection");if(i&&i.firstObject()){r=ViewMessage.getPath("page.messageScrollView.contentView");if(r)return r.becomeFirstResponder(),YES}else{if(MessageList.ORIENTATION_THREE_COL!==MessageList.get("viewPreference"))return MessageList.takeFirstResponder(),YES;r=FolderList.getPath("page.folderList.contentView");if(r)return r.becomeFirstResponder(),YES}}else{if("shift_tab"===n)return MessageList.takeFirstResponder(),YES;if(n==="shift_escape")return NO;if(n==="escape")SC.browser.isMozilla===YES&&this.resignFirstResponder(),Message.searchController.invokeLater("clearSearchField",1);else if(n==="ctrl_shift_m")return NO}return arguments
.callee.base.apply(this,arguments),e.keyCode===SC.Event.KEY_RETURN&&Message.searchController.performSearch(e),YES},rightAccessoryView:SC.ImageButtonView.create({layout:{right:14,top:14,height:15,width:15},classNames:["clear-search"],isVisibleBinding:"Message.searchController.shouldShowClearSearch",mouseDown:function(){return this.selectAll(),YES},mouseUp:function(){return Message.searchController.clearSearchField(),Message.searchController.set("searchPaneVisible",NO),YES},selectAll:function(){var e=this.getPath("parentView.value").length;e>0&&this.setPath("parentView.selection",SC.TextSelection.create({start:0,end:e}))}})})}),Mail.messageListSearchTheme=SC.BaseTheme.create({name:"message-list-search"}),SC.Theme.addTheme(Mail.messageListSearchTheme),Mail.AppSwitcherView=CK.AppSwitcherView.extend({init:function(){arguments.callee.base.apply(this,arguments),this.setPath("buttonView.title","AppTitle.mail".loc())}}),Mail.DockView=SC.View.extend({classNames:["dock"],ariaRole:"toolbar",layout:{top:0,left:0,right:0,height:44},childViews:["appSwitcherView","searchContainerView","toolbarContainerView"],toolbarView:SC.outlet("toolbarContainerView.toolbarView"),appSwitcherView:SC.View.design({classNames:["app-switcher-container"],childViews:["appSwitcher","toolbarSeparator"],appSwitcher:Mail.AppSwitcherView.design(),toolbarSeparator:SC.View.design({classNames:["toolbar-separator-left"],layout:{right:0,height:Global.metrics.DOCK_TOOLBAR_SEPARATOR_HEIGHT,width:1,top:0}})}),searchContainerView:SC.View.design({classNames:["search-container"],childViews:["searchWrapper"],searchWrapper:SC.View
.design(CW.Animatability,{classNames:["search-wrapper"],isVisible:NO,isVIPWelcomePageVisibleBinding:"Global.isVIPWelcomePageVisible",displayProperties:["isVIPWelcomePageVisible"],init:function(){arguments.callee.base.apply(this,arguments),MessageList.addObserver("viewPreference",this,"show"),this.addObserver("isVIPWelcomePageVisible",this,"show")},render:function(e){var t=this.get("isVIPWelcomePageVisible");t===YES&&e.addClass("vip-welcome-page"),this._prevIsVIPWelcomePageVisible=t,arguments.callee.base.apply(this,arguments)},update:function(e){var t=this.get("isVIPWelcomePageVisible"),n=this._prevIsVIPWelcomePageVisible;n!==t&&(t===YES?e.addClass("vip-welcome-page"):e.removeClass("vip-welcome-page")),this._prevIsVIPWelcomePageVisible=t},show:function(e,t){if(t==="isVIPWelcomePageVisible"&&this.get("isVIPWelcomePageVisible")===NO)return;MessageList.removeObserver("viewPreference",this,"show"),this.removeObserver("isVIPWelcomePageVisible",this,"show"),this.set("isVisible",YES),t==="viewPreference"&&this.animate({opacity:{from:0,to:1}})},childViews:["searchView","toolbarSeparator"],searchView:Mail.SearchView.design({isVisibleBinding:SC.binding("Global.isVIPWelcomePageVisible").not()}),toolbarSeparator:SC.View.design({classNames:["toolbar-separator-right"],layout:{right:0,height:Global.metrics.DOCK_TOOLBAR_SEPARATOR_HEIGHT,width:1,top:0},isVisibleBinding:SC.binding("Global.isVIPWelcomePageVisible").not()})})}),toolbarContainerView:SC.View.design({classNames:["toolbar-container"],childViews:["toolbarView"],toolbarView:SC.View.design({})}),setAppSwitchViewWidth:function(e){this.getPath
("appSwitcherView").adjust("width",e),this.getPath("searchContainerView").adjust("left",e)},setSearchViewWidth:function(e){var t=this.get("searchContainerView");t.adjust("width",e),this.get("toolbarContainerView").adjust("left",e+t.get("layout").left)}}),Mail.metrics=SC.Object.create({MAX_SEARCHFIELD_WIDTH:500,MAX_SOURCELIST_WIDTH:350,MIN_SOURCELIST_WIDTH:200,DEFAULT_SOURCELIST_WIDTH:250,DEFAULT_MIN_APP_SWITCHER_WIDTH:145,MIN_MAIN_PANE_WIDTH:1050}),Mail.LoadingMainPane=SC.MainPane.extend({classNames:["mail"],childViews:["appView","dockView"],dockView:SC.View.extend({classNames:["dock"],layout:{top:0,left:0,right:0,height:Global.metrics.DOCK_HEIGHT_WITH_SHADOW},childViews:["appSwitcher"],appSwitcher:Mail.AppSwitcherView.design()}),appView:SC.View.extend({layout:{top:Global.metrics.DOCK_HEIGHT},childViews:["loadingBoxView"],loadingBoxView:SC.View.design({layout:{top:.45,bottom:0,centerX:0,width:32},childViews:["loadingSpinner"],loadingSpinner:SC.ImageView.design({classNames:["spinner-32px-ffffff"],layout:{top:0,left:0,width:32,height:32}})})})}),Mail.VIPWelcomeView=SC.View.extend({childViews:"vipWelcomeOverlay".w(),vipWelcomeOverlay:SC.View.extend({classNames:"vip-welcome-overlay",layout:{left:0,right:0,top:1,centerY:0,centerX:0},childViews:["vipWelcomeTitle"],vipWelcomeTitle:SC.View.design({childViews:["vipHeroShot","vipTitle","vipText","vipSubText"],layout:{centerY:13,height:370,left:0,right:0},vipHeroShot:SC.View.design({layout:{centerX:0,top:0,height:176,width:188},classNames:["vip-middle"]}),vipTitle:SC.LabelView.design({classNames:["vip-title"],layout:{top:200},value:"_Vip.Welcome.Title.Text"
.loc(),textAlign:SC.ALIGN_CENTER}),vipText:SC.LabelView.design({classNames:["vip-text"],layout:{top:287},value:"_Vip.Welcome.QuicklyAccess.Text".loc(),textAlign:SC.ALIGN_CENTER}),vipSubText:SC.LabelView.design({classNames:["vip-text"],layout:{top:314},value:"_Vip.Welcome.ToGetStarted.Text".loc(),textAlign:SC.ALIGN_CENTER})})})}),Mail.RightPaneContainer=SC.View.extend(SC.SplitChild,{childViews:"messages vipWelcomeView".w(),classNames:"right-pane-container".w(),positionOffset:-1,sizeOffset:1,splitChildLayoutDidChange:function(e){if(!Mail.mainSplitController.get("isAnimating"))return e()}.enhance(),messages:SC.SplitView.design({delegate:Mail.rightSplitController,init:function(){arguments.callee.base.apply(this,arguments),this.delegate.splitView=this},classNames:"messages".w(),searchTextValue:null,searchTextValueBinding:"Message.searchController.searchFieldValue",layout:{top:0,left:0,bottom:0,right:0},isSearchPaneVisible:null,isSearchPaneVisibleBinding:"Message.searchController.searchPaneVisible",isSearchPaneVisibleDidChange:function(){var e=0,t=0,n,r,i=MessageList.get("page");n=CoreMail.get("implicitPreferences"),r=n.get("lastSelectedSearch"),this.get("isSearchPaneVisible")===YES&&(e=45,t=-1),this.topLeftView.containerView.adjust("top",e),i.get("messageListContainerView").adjust("top",t),i.getPath("searchPaneView.searchTab").setIndex(r)}.observes("isSearchPaneVisible"),layoutDirection:SC.LAYOUT_HORIZONTAL,splitDividerView:SC.SplitDividerView.design({positionOffset:-3,sizeOffset:4}),topLeftView:SC.View.design(SC.SplitChild,{ariaRole:"group",ariaLabel:"_AX.Messages".loc(),childViews
:["searchPaneView","containerView"],searchPaneView:SC.View,maximumSize:Mail.metrics.MAX_SEARCHFIELD_WIDTH,minimumSize:MessageList.metrics.MIN_MESSAGE_LIST_WIDTH,size:function(e,t){t!==undefined&&(this._setSize=t);if(this._setSize!==undefined)return this._setSize;var n=this.get("minimumSize"),r=CoreMail.get("implicitPreferences"),i=r.get("messageSplitterPosition");return i<n&&CoreMail.saveImplicitPreference("messageSplitterPosition",n),this._setSize=i,i}.property(),preferenceDidChange:function(){this.notifyPropertyChange("minimumSize");var e=this.get("splitView");e.adjustPositionForChild(this,this.get("position"))}.observes("MessageList.viewPreference"),containerView:SC.ContainerView.design({contentView:SC.View}),render:function(e){return e.attr("aria-label",this.get("ariaLabel")),arguments.callee.base.apply(this,arguments)}}),bottomRightView:SC.View.design(SC.SplitChild,{classNames:"message view".w(),positionOffset:-1,sizeOffset:1}),_splitterPositionDidChange:function(){this.invokeLast(this._saveSplitterPosition)}.observes("MessageList.splitterPosition"),_saveSplitterPosition:function(){var e=MessageList.get("viewPreference"),t=MessageList.get("splitterPosition");MessageList._saveSplitterPosition(e,t)}}),vipWelcomeView:Mail.VIPWelcomeView.design({isVisibleBinding:"Global.isVIPWelcomePageVisible"})}),Mail.MainPane=SC.MainPane.extend({layout:{minWidth:Mail.metrics.MIN_MAIN_PANE_WIDTH,minHeight:500},childViews:["appView","dockView"],dockView:Mail.DockView,appView:SC.View.extend({})}),Mail.mainPage=SC.Page.design({loadingMainPane:Mail.LoadingMainPane.design({}),searchTextViewOutlet
:SC.outlet("mainPane.dockView.searchContainerView.searchWrapper.searchView.searchTextView"),vipWelcomeViewOutlet:SC.outlet("mainPane.appView.bottomRightView"),mainPane:Mail.MainPane.design(CW.DropTarget,{classNames:"mail".w(),isVisible:NO,isVisibleBinding:SC.Binding.transform(function(e){return e>0?(!SC.browser.isIE&&document.body.clientWidth<Mail.mainPage.getPath("mainPane.layout.minWidth")&&Mail.mainPage.getPath("mainPane.appView").viewDidResize(),!0):!1}).from(".owner.isVisible"),mouseMoved:function(){window.VipSender&&(VipSender.enableRefresh(),VipSender.startTheDisableVipRefreshTimer())},isDropTarget:NO,acceptsFileDrags:YES,keyDown:function(e){var t=SC.InlineTextFieldView.editor;return t&&t.get("isEditing")?NO:Global.tryToPerform("keyDown",e)?YES:NO},performKeyEquivalent:function(e,t){return Global.tryToPerform("keyDown",t)},appView:SC.SplitView.design({layout:{left:0,right:0,bottom:0,top:Global.metrics.DOCK_HEIGHT},viewDidResize:function(){arguments.callee.base.apply(this,arguments),this.invokeOnce(this._adjustSplitViewLayout)},_adjustSplitViewLayout:function(){var e=this.getPath("frame.width"),t=this.get("messages"),n=MainToolbar.page.get("toolbar"),r=n.getPath("frame.width")-n.getPath("leftWrapper.layout.width"),i=n.getPath("accountMenu.smallestNonTruncatedWidth"),s=MessageList.get("viewPreference"),o=this.get("topLeftView"),u;if(!o)return;u=o.get("minimumSize");if(s===MessageList.ORIENTATION_THREE_COL&&e<this._prevWidth&&r<i+10){var a=this._prevWidth-e,f=o.getPath("frame.width");if(f>u)this.adjustPositionForChild(this.get("bottomRightView"),f-a);else{var l=t.get("topLeftView"
);if(l){var c=l.getPath("frame.width"),h=l.get("minimumSize");c>h?t.adjustPositionForChild(t.get("bottomRightView"),c-a):Global.get("isVIPWelcomePageVisible")===NO&&(MessageList.switchToTwoColumnView(),Global.set("isFolderListAutoHidden",YES))}}}else s===MessageList.ORIENTATION_TWO_COL&&e>this._prevWidth&&Global.get("isFolderListAutoHidden")===YES&&r>=u+i&&MessageList.switchToThreeColumnView();this._prevWidth=e},delegate:Mail.mainSplitController,init:function(){arguments.callee.base.apply(this,arguments),this.delegate.splitView=this},folderList:SC.outlet("topLeftView.contentList"),searchPaneView:SC.outlet("bottomRightView.messages.topLeftView.searchPaneView"),messages:SC.outlet("bottomRightView.messages"),splitDividerView:SC.SplitDividerView.design({positionOffset:-3,sizeOffset:4,classNames:["folder-list-divider"],splitChildLayoutDidChange:function(e){if(!Mail.mainSplitController.get("isAnimating"))return e()}.enhance()}),topLeftView:SC.View.design(SC.SplitChild,{classNames:["top-left-view"],ariaRole:"group",splitChildLayoutDidChange:function(e){if(!Mail.mainSplitController.get("isAnimating"))return e()}.enhance(),size:function(e,t){t!==undefined&&(this._setSize=t);if(this._setSize!==undefined)return this._setSize;var n=CoreMail.get("implicitPreferences"),r=n.get("view");if(r!==MessageList.ORIENTATION_TWO_COL){var i=n.get("folderListWidth");return i===null?Mail.metrics.DEFAULT_SOURCELIST_WIDTH:i<Mail.metrics.MIN_SOURCELIST_WIDTH?Mail.metrics.MIN_SOURCELIST_WIDTH:i}return 0}.property(),minimumSize:function(){return Mail.metrics.MIN_SOURCELIST_WIDTH}.property().cacheable(),maximumSize
:function(){return Mail.metrics.MAX_SOURCELIST_WIDTH}.property().cacheable(),render:function(e){return e.attr("aria-label","_AX.MailBoxes".loc()),arguments.callee.base.apply(this,arguments)},childViews:["contentList","refreshButtonContainer"],contentList:SC.View.design({}),refreshButtonContainer:SC.View.design({layout:{left:0,right:0,bottom:0,height:44},childViews:["actions","refreshButton","refreshButtonSpinner"],classNames:"refresh-button-container".w(),actions:CW.PopupButtonView.design(Global.ToolbarButtonMixin,{classNames:["n-m-w"],layout:{left:9,top:7,width:30,height:30},themeName:"borderless",icon:"actions",layerId:"toolbar-actions-menu",toolTip:"_Toolbar.Message.Actions".loc(),isEnabledBinding:"Global.isAppReady",acceptsFirstResponder:NO,menu:function(){return ActionMenu.getActionMenuPane()}.property().cacheable(),showMenu:function(){ActionMenu.dispatch({sig:"showActionMenu"}),arguments.callee.base.apply(this,arguments)}}),refreshButton:SC.ImageButtonView.design({classNames:["n-m-w refresh-button"],layout:{right:1,width:42,height:42,top:0},needsEllipsis:NO,image:"refresh-icon",toolTip:"_FolderList.GetMail".loc(),isVisibleBinding:SC.binding("FolderList.isFolderListResyncInProgress").not(),action:function(){CoreMail.errorHandler.recordStat("_count_FOLDER_LIST_REFRESH_BUTTON_CLICKED"),FolderList.dispatch({sig:"clickOnRefreshButton"})}}),refreshButtonSpinner:CW.SpinnerView.extend({layout:{right:10,top:10},size:24,innerClassNames:["refresh-spinner-image"],isVisibleBinding:"FolderList.isFolderListResyncInProgress"})})}),bottomRightView:Mail.RightPaneContainer.design({}),didEndLiveResize
:function(){this.invokeOnce(this._saveFolderListWidth)},_saveFolderListWidth:function(){CoreMail.saveImplicitPreference("folderListWidth",FolderList.get("folderListWidth"))}})})});
