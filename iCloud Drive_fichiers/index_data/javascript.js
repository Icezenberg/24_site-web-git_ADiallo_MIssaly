window.Contacts=SC.Object.create({me_trace:NO,content:null,serverError:null,toArray:[],ccArray:[],bccArray:[],emailList:[],currentState:function(){var e=Contacts.statechart.currentStates();return e?e.firstObject().name:"AddressesPanel/ContactPicker Closed"}.property()}),Contacts.ContactsAutocompleteController=CK.ContactsAutocompleteController.extend({init:function(){arguments.callee.base.apply(this,arguments);var e=this.get("dataSource");e&&e.isClass&&(e=e.create()),window.WHAT_TYPE.isMail()===YES&&this.set("initial","CA Necessary Data Not Loaded"),e.set("delegate",this),e.set("syncInterval",10),this.set("dataSource",e)},contactDataDidChange:function(){var e=this.get("dataSource");e&&e.contactsDataIsLoaded===YES&&Contacts.set("contactDataRefreshed",Math.random())}.observes(".dataSource.contactsDataIsLoaded")}),require("core"),Contacts.AddressesController=SC.ArrayController.extend(SC.CollectionRowDelegate,{contentBinding:"Contacts.content",addresses:null,searchClosed:YES,searchFieldValue:"",searchResult:[],resultMessageValue:"_Contacts.EmptyContact".loc(),isNoAddress:NO,addressBook:null,autocompleteController:null,contactNameOrder:CK.CONTACTS_AUTOCOMPLETE_NAME_DISPLAY_ORDER_FIRST_LAST,GUID_COUNTER:1,init:function(){arguments.callee.base.apply(this,arguments),this.set("autocompleteController",Contacts.contactsAutocompleteController);var e=this.get("autocompleteController");if(window.WHAT_TYPE.isMailChild()===YES&&!SC.browser.isIE)try{var t=opener.Contacts.addressesController.get("autocompleteController");if(t&&t.dataSource){SC.debug("Using existing autocomplete dataCache from opener"
);var n=t.dataSource._dataCache;e.dataSource._dataCache=n,e.dataSource._lastPrefToken=t.dataSource._lastPrefToken,e.dataSource._lastSyncToken=t.dataSource._lastSyncToken,e.dataSource.contactsDataIsLoaded=t.dataSource.contactsDataIsLoaded}else SC.debug("No opener autocomplete data found")}catch(r){SC.debug("Exception trying to access Autocomplete opener: %@".fmt(r))}},getAddressBook:function(){var e=this.get("autocompleteController"),t=e.dataSource.get("_dataCache"),n=e.dataSource.get("contactsDataIsLoaded");if(t&&n===YES){var r=this.buildAddressBookFromAC();return this.set("addressBook",r),r}return null},buildAddressBookFromAC:function(){var e=this.get("autocompleteController"),t=e.dataSource.get("_dataCache");if(t&&t.guidToRecordMapping){var n=t.guidToRecordMapping,r=this.recordsToAddressBook(n),i=SC.browser;if(window.WHAT_TYPE.isMailChild()===YES&&!i.isIE&&!i.isEdge){var s=opener.Contacts.addressesController.get("autocompleteController"),o=e.dataSource._dataCache,u=e.dataSource.get("contactsDataIsLoaded"),a=e.dataSource.get("contactsDataIsLoadedForQuery"),f=e.get("state");s.dataSource._dataCache=o,s.dataSource.set("contactsDataIsLoaded",u),s.dataSource.set("contactsDataIsLoadedForQuery",a),s.set("state",f)}return r}return SC.debug("Could not find any email records or data"),NO},recordsToAddressBook:function(e){var t=this.get("autocompleteController"),n=t.get("nameDisplayOrder");this.set("contactNameOrder",n);var r=[],i=0,s=!0,o=0,u=[],a=[],f={},l=" ",c=NO,h,p,d,v,m,g,y,b,w;SC.Benchmark.start("Contacts.ContactRequest recordsToAddressEntries");for(h in e)if(e.hasOwnProperty(
h)){p=e[h],u=[],a=p.emailAddresses;if(a){s=!0,d="",v=a.length;for(var E=0;E<v;E++)m="",g="",f={guid:"recipient-"+this.GUID_COUNTER++},s===!0&&(m=p.firstName?p.firstName:"",g=p.lastName?p.lastName:"",CW.stringIsCJK(g)&&CW.stringIsCJK(m)&&(l="",c=YES),n===CK.CONTACTS_AUTOCOMPLETE_NAME_DISPLAY_ORDER_FIRST_LAST?(d=m+l+g,b=[SC.RenderContext.escapeHTML(m),l,"<strong>",SC.RenderContext.escapeHTML(g),"</strong>"].join("")):(d=g+l+m,b=["<strong>",SC.RenderContext.escapeHTML(g),"</strong>",l,SC.RenderContext.escapeHTML(m)].join("")),s=!1),f.index=o++,f.firstName=m,f.lastName=g,f.fullName=d=d.trim(),f.htmlName=b,f.emailType=a[E].label,f.email=a[E].field,y=f.fullName+" "+f.email+"'",d||(w=p.companyName,w&&w.trim()!==""&&(d=f.fullName=w,y+=" "+w),b=d?d:f.email,f.htmlName=["<strong>",SC.RenderContext.escapeHTML(b),"</strong>"].join("")),f.searchField=y.toLowerCase(),r.push(f);i++}}return SC.Benchmark.end("Contacts.ContactRequest recordsToAddressEntries"),r},addressBookList:function(){var e=[],t=this.get("content");return t?(this.get("addresses")===null&&this.set("addresses",t),t):e}.property("content").cacheable(),searchFieldValueDidChange:function(){var e=this.get("searchFieldValue");this.set("shouldShowClearSearch",e&&e.length>0),e.length>0?(this.set("searchClosed",NO),this.search(e),this.set("resultMessageValue","_Contacts.Search.NoResult".loc())):(this.set("searchClosed",YES),this.set("resultMessageValue","_Contacts.EmptyContact".loc()),Contacts.setIsNoAddressFlag())}.observes("searchFieldValue"),shouldShowClearSearch:NO,search:function(e){var t=RegexHelper.escapeSpecialCharacters(e),
n=t.toLowerCase(),r=[],i=Contacts.get("content");if(i){var s=i.length;for(var o=0;o<s;o++)i[o].searchField.search(n)!==-1&&r.push(i[o])}this.set("searchResult",r),r.length===0?this.set("isNoAddress",YES):this.set("isNoAddress",NO)},clearSearchField:function(){var e=Contacts.getPath("page.pane.contentView.searchFieldView.searchTextView");Global.clearSearchField(this,e),this.set("searchClosed",YES),Contacts.setIsNoAddressFlag()}}),require("core"),Contacts.contactPickerController=SC.ObjectController.create({content:null,emailId:null,firstName:null,lastName:null,anchor:null,companyName:"",displayName:"",isVip:NO,vipRecord:null,isVipValueChanged:NO,emailType:"_Contacts.ContactPicker.emailType.Work".loc(),hasPhotoUrl:NO,photoUrl:"",photoCrop:"",emailTypeWidth:0,emailIdWidth:0,widthForContactPickerWithoutPhoto:0,vipDataRefreshed:null,vipDataRefreshedBinding:"VipSender.vipDataRefreshed",delegate:null,setPhotoUrl:function(){var e=this.get("content");if(e&&e.photo){this.set("hasPhotoUrl",YES);var t=e.photo.url;this.set("photoUrl",t)}else this.set("hasPhotoUrl",NO),this.set("photoUrl","")},setPhotoCrop:function(){var e=this.get("content");if(e&&e.photo){var t=e.photo.crop;this.set("photoCrop",t)}else this.set("photoCrop","")},contactNameLayout:function(){return this.get("hasPhotoUrl")?{left:119,top:35,right:10}:{left:15,top:13,right:10}}.property("Contacts.contactPickerController.hasPhotoUrl").cacheable(),vipCheckboxlayout:function(){return this.get("hasPhotoUrl")?{left:115,top:60,width:150}:{left:11,top:41,width:150}}.property("Contacts.contactPickerController.hasPhotoUrl").cacheable(
),emailAddresslayout:function(){return this.get("hasPhotoUrl")?{left:20,top:114,right:5,bottom:0}:{left:15,top:69,right:5,bottom:0}}.property("Contacts.contactPickerController.hasPhotoUrl").cacheable(),vipDataDidChange:function(){var e=Contacts.page.getIfConfigured("contactPicker"),t,n,r;if(!e||e.get("isVisibleInWindow")===NO)return;t=this.get("emailId"),SC.empty(t)===NO&&(n=VipSender.isVip(t),r=this.get("isVip"),n===NO&&r===YES?(this.set("isVip",NO),this.set("vipRecord",null)):n!==NO&&r===NO&&(this.set("isVip",YES),this.set("vipRecord",n)))}.observes("vipDataRefreshed"),anchorDidChange:function(){var e=this.get("anchor"),t=this._prevAnchor;t&&t!==e&&t.tryToPerform("didLoseContactPicker"),this._prevAnchor=e}.observes("anchor")}),require("core"),Contacts.importContactPickerController=SC.ObjectController.create({anchor:null,target:null,importFileName:null}),SC.mixin(Contacts,{contactDataRefreshed:Math.random(),MAX_EMAIL_ADDRESS_ROWS:4,configure:function(){Contacts.contactsAutocompleteController?SC.warn("attempt to re initialize contacts, ignoring configure call."):(Contacts.contactsAutocompleteController=Contacts.ContactsAutocompleteController.create(),Contacts.addressesController=Contacts.AddressesController.create())},configureAddressPanel:function(){this.invokeStatechart(),this.page.get("pane").append()},configureContactsPicker:function(){this.invokeStatechart()},configureImportContactsPicker:function(){this.invokeStatechart()},invokeStatechart:function(){Contacts.statechart.statechartIsInitialized?Contacts.statechart.gotoState(Contacts.statechart.initialState):Contacts.statechart
.initStatechart()},openAddresses:function(){this.configureAddressPanel();var e=this.page.getPath("pane.contentView.addressList");e.scrollTo(0,0),Contacts.statechart.sendAction("openAddresses")},serverPref:function(){return CoreMail.store.find(CoreMail.ServerPreferences,CoreMail.SERVER_PREFS_GUID)}.property().cacheable(),getGroups:function(){var e=SC.Query.local(CoreMail.Contact,"addressType = 'Group'"),t=CoreMail.store.find(e);return t},showAddressesInGroup:function(e){var t=SC.Array;if(e===undefined||e.get("groupName")==="All")return t=CoreMail.store.find(CoreMail.Contact),t;var n=CoreMail.store.find(CoreMail.Contact),r,i=n.length();for(var s=0;s<i;s++){var o=n.objectAt(s);o.get("guid")===e.get("guid")&&(r=o)}return r&&(t=r.get("members")),t},setIsNoAddressFlag:function(){var e=Contacts.get("addressesController"),t=this.get("content");!t||t.get("length")===0?e.set("isNoAddress",YES):e.set("isNoAddress",NO)},showContactsPicker:function(e){if(e){var t=Contacts.get("contactPickerController");t.set("emailId",e.emailId),t.set("anchor",e.anchor),t.set("delegate",e.delegate),Global.get("isLastNameFirstLanguage")===YES?(t.set("firstName",e.lastName),t.set("lastName",e.firstName)):(t.set("firstName",e.firstName),t.set("lastName",e.lastName)),this.configureContactsPicker(),Contacts.statechart.sendAction("openContactsPicker")}else SC.warn("contactHash is not provided")},showImportContactsPicker:function(e){if(e){var t=Contacts.get("importContactPickerController");t.set("anchor",e.anchor),t.set("target",e.target),t.set("importFileName",e.importFileName),this.configureImportContactsPicker
(),Contacts.statechart.sendAction("openImportContactsPicker")}else SC.warn("vcfHash is not provided")},getEmailArrayFromContactRecord:function(){var e=[],t=[],n,r=Contacts.get("contactPickerController");if(r.get("content")){e=r.get("content").emailAddresses;if(e)for(var i=0,s=e.length;i<s;i++)n=e[i].field,t.push(n)}else n=r.get("emailId"),t.push(n);return t},getContactName:function(){var e=this.contactPickerController,t=e.get("content"),n=t.companyName,r=this.getFullName(e.get("emailId"));return SC.empty(r)?SC.empty(n)?"":n:r},saveVipContact:function(){var e=Contacts.get("contactPickerController"),t=e.get("isVip"),n;if(e.get("isVipValueChanged")===NO&&t===YES){n=e.get("vipRecord");var r=this.getEmailArrayFromContactRecord();VipSender.updateVipAddresses(n,r)}else if(e.get("isVipValueChanged")!==NO||t!==NO)if(t===NO){if(!!SC.empty(e.get("vipRecord")))return;n=e.get("vipRecord"),VipSender.deleteVip(n)}else if(t===YES&&SC.empty(e.get("vipRecord"))){var i,s,o,u,a;i=this.getEmailArrayFromContactRecord();var f=Contacts.page.get("contactPicker").getPath("contentView.nowShowing");f==="addContactView"?(o=e.get("firstName"),u=e.get("lastName"),a=CK.displayNameFor(o,u)):f==="existingContactView"?a=Contacts.contactPickerController.get("displayName"):SC.debug("View is not defined for contact Picker"),SC.empty(a)&&(a=i[0]),s={name:a,addresses:i},VipSender.addVip(s)}else SC.warn("VIP flag is not handled properly")},setEmailIdAndEmailTypeWidths:function(){var e=0,t=0,n=[],r=[],i,s,o,u,a,f,l,c,h,p=Contacts.contactPickerController;u=p.get("content").emailAddresses;for(var d=0,v=u.get("length")
;d<v;d++)o=u[d].field,r.push(o),s=u[d].label,i=CK.Autocomplete.localizedCategory(s),n.push(i);for(var m=0,g=n.length;m<g;m++)c=SC.metricsForString(n.objectAt(m),"",""),c?h=c.width:(l="Contacts : Error in setEmailIdAndEmailTypeWidths()",l+="\n Value of emailTypeStringDimension is "+c,l+="\n Value of emailTypeList.objectAt(jdx) is "+n.objectAt(m),CoreMail.errorHandler.logErrorTrap(l)),h>e&&(e=h);e+=10;for(var y=0,b=r.length;y<b;y++)a=SC.metricsForString(r.objectAt(y),"",""),a?f=a.width:(l="Contacts : Error in setEmailIdAndEmailTypeWidths()",l+="\n Value of emailIdStringDimension is "+a,l+="\n Value of emailTypeList.objectAt(jdx) is "+n.objectAt(m),CoreMail.errorHandler.logErrorTrap(l)),f>t&&(t=f);if(p.get("hasPhotoUrl")===NO){var w=Contacts.metrics,E=w.MIN_WIDTH_AVAILABLE_FOR_EMAIL_ID,S=w.MIN_WIDTH_AVAILABLE_FOR_EMAIL_TYPE,x=t+e+w.CONTACT_PICKER_WIDTH_BUFFER,T;p.set("widthForContactPickerWithoutPhoto",x),x>=w.EXISTING_CONTACT_PICKER_MAX_WIDTH&&(e>S?t>E?(e=S,t=E):(T=E-t,e=S+T):(T=S-e,t=E+T))}p.set("emailTypeWidth",e),p.set("emailIdWidth",t)},clearContactDataFromController:function(){var e=Contacts.get("contactPickerController");e.set("content",null),e.set("firstName",null),e.set("lastName",null),e.set("companyName",null),e.set("emailId",null),e.set("anchor",null),e.set("isVip",NO),e.set("vipRecord",null),e.set("displayName",null),e.set("isVipValueChanged",NO),Contacts.page.get("contactPicker").setPath("contentView.nowShowing",null)},getFullName:function(e){SC.Benchmark.start("perfFetchPrettyNameFromContactsRecord");var t;if(window.Contacts){var n=Contacts.get("addressesController"
);if(n){var r=n.getAddressBook();if(r)for(var i=0,s=r.length;i<s;i++){t=r[i].fullName.trim();if(r[i].email===e&&t!=="")break;t=""}}else{var o="CoreMail.Contacts.getFullName: Value of Contacts.addressesController :"+n;CoreMail.errorHandler.logErrorTrap(o)}}return SC.Benchmark.end("perfFetchPrettyNameFromContactsRecord"),t},clearImportContactDataFromController:function(){var e=Contacts.get("importContactPickerController");e.set("anchor",null),e.set("target",null),e.set("importFileName",null),Contacts.page.get("importContactPicker").setPath("contentView.nowShowing",null)},showContactNotAddedError:function(){CoreMail.errorHandler.handleError({keyString:"MessageView.ContactNotAdded.ServerError"})},showContactNotImportedError:function(e){var t=Contacts.importContactPickerController.get("importFileName");e===400?CoreMail.errorHandler.handleError({keyString:"MessageView.ContactNotImported.InvalidFileError",descriptionLocParams:{fileName:t}}):CoreMail.errorHandler.handleError({keyString:"MessageView.ContactNotImported.ServerError",descriptionLocParams:{fileName:t}})},getEmailAddress:function(e){var t=Contacts.contactPickerController,n=t.get("firstName"),r=t.get("lastName"),i=t.get("displayName"),s="",o;return n||r?s=n+" "+r:i&&(s=i),o=s+" "+"<"+e.target.innerHTML+">,",CK.tokensParser.parseEmailAddress(o).get("parsedValue")}}),SC.mixin(Contacts,{_contentObserver:null,_addressList:null,_getSelectedAddresses:function(){function e(e){var t=[],n;return e.forEach(function(e){if(SC.empty(e)===NO){n=/([^,<>]*[,<>].*)( <[^<]*)$/,e=e.replace(n,'"$1"$2');var r=e.match(/"/g);r&&r.get("length")>2&&
(e=e.replace(/"/g,'\\"'),e=e.replace('\\"','"'),e=e.replace(/\\"([^\\"]*)$/,'"$1')),t[t.length]=e}}),t.length>0?t.join(", "):null}var t={to:e(this.toArray),cc:e(this.ccArray),bcc:e(this.bccArray)};return t},_clearSelection:function(){this.toArray.set("length",0),this.ccArray.set("length",0),this.bccArray.set("length",0)}}),Contacts.metrics=SC.Object.create({CHECKBOX_COLUMNS_LEFT:613,TO_LABEL_WIDTH:40,CC_LABEL_LEFT:41,CC_LABEL_WIDTH:40,CC_BORDER_LEFT:81,BCC_LABEL_LEFT:81,BCC_LABEL_WIDTH:40,EMAIL_ITEM_LABEL_WIDTH:425,TO_CHECKBOX_LEFT:9,CC_CHECKBOX_LEFT:50,BCC_CHECKBOX_LEFT:89,SEARCH_TEXT_VIEW_WIDTH:144,SEARCH_RIGHT_VIEW_WIDTH:34,SHEET_PANE_WIDTH:773,ADDRESS_HEADER_WIDTH:733,ADDRESS_LIST_WIDTH:733,SEARCH_RESULTS_LIST_WIDTH:733,SEPARATOR_WIDTH:743,ADD_CONTACT_FIRSTNAME_TOP:16,ADD_CONTACT_LASTNAME_TOP:53,ADD_CONTACT_EMAILID_LEFT:77,IMPORT_CONTACT_LABEL_TOP:12,LOADING_CONTACT_SPINNER_LEFT:53,LOADING_CONTACT_SPINNER_LABEL_LEFT:89,LOADING_CONTACT_SPINNER_LABEL_HEIGHT:25,IMPORT_CONTACT_PICKER_HEIGHT:116,IMPORT_CONTACT_PICKER_WIDTH:325,EXISTING_CONTACT_PICKER_MAX_WIDTH:370,MIN_WIDTH_AVAILABLE_FOR_EMAIL_TYPE:50,MIN_WIDTH_AVAILABLE_FOR_EMAIL_ID:276,CONTACT_PICKER_WIDTH_BUFFER:50,CONTACT_PICKER_HEIGHT_BUFFER:23,CONTACT_PICKER_EMAIL_ADDRESS_ROW_HEIGHT:27,CONTACT_PICKER_HEIGHT_WITHOUT_PHOTO:108}),Contacts.AddressListHeaderView=SC.View.extend({classNames:"column-header".w(),childViews:"name nameBorder email checkboxColumns".w(),name:SC.LabelView.design({classNames:"label name".w(),layout:{left:0,width:170},value:"_Contacts.Header.Name".loc()}),nameBorder:SC.View.design({classNames:"border".
w(),layout:{left:170,width:1}}),email:SC.LabelView.design({classNames:"label email".w(),layout:{left:171,width:348},value:"_Contacts.Header.Email".loc()}),checkboxColumns:SC.View.design({layout:function(){return{left:Contacts.metrics.CHECKBOX_COLUMNS_LEFT}}.property(),childViews:"emailBorder toLabel toBorder ccLabel ccBorder bccLabel".w(),emailBorder:SC.View.design({classNames:"border".w(),layoutBinding:SC.Binding.transform(function(){return Compose.get("isBccEnabled")?{left:0,width:1}:{left:0+Contacts.metrics.BCC_LABEL_WIDTH,width:1}}).from("Compose.isBccEnabled")}),toLabel:SC.LabelView.design({classNames:"label to".w(),textAlign:SC.ALIGN_CENTER,value:"_Contacts.Header.To".loc(),layoutBinding:SC.Binding.transform(function(){if(Compose.get("isBccEnabled"))return{left:1,width:Contacts.metrics.TO_LABEL_WIDTH};var e=Contacts.metrics;return{left:1+e.BCC_LABEL_WIDTH,width:e.TO_LABEL_WIDTH}}).from("Compose.isBccEnabled")}),toBorder:SC.View.design({classNames:"border".w(),layoutBinding:SC.Binding.transform(function(){if(Compose.get("isBccEnabled"))return{left:Contacts.metrics.TO_LABEL_WIDTH+1,width:1};var e=Contacts.metrics;return{left:e.TO_LABEL_WIDTH+e.BCC_LABEL_WIDTH+1,width:1}}).from("Compose.isBccEnabled")}),ccLabel:SC.LabelView.design({classNames:"label cc".w(),textAlign:SC.ALIGN_CENTER,value:"_Contacts.Header.Cc".loc(),layoutBinding:SC.Binding.transform(function(){var e=Contacts.metrics;return Compose.get("isBccEnabled")?{left:e.CC_LABEL_LEFT,width:e.CC_LABEL_WIDTH}:{left:e.CC_LABEL_LEFT+e.BCC_LABEL_WIDTH,width:e.CC_LABEL_WIDTH}}).from("Compose.isBccEnabled")}),ccBorder:SC.View
.design({classNames:"border".w(),layout:{left:Contacts.metrics.CC_BORDER_LEFT,width:1},isVisibleBinding:"Compose.isBccEnabled"}),bccLabel:SC.LabelView.design({classNames:"label bcc".w(),textAlign:SC.ALIGN_CENTER,value:"_Contacts.Header.Bcc".loc(),layout:{left:Contacts.metrics.BCC_LABEL_LEFT,width:Contacts.metrics.BCC_LABEL_WIDTH},isVisibleBinding:"Compose.isBccEnabled"})})}),Contacts.CheckboxView=SC.CheckboxView.extend({isSelected:function(e,t){var n=this.getPath("owner.owner.content").index,r=this.get("addresses");return t===YES||t===undefined&&this.get("isAllChecked")?r[n]=this.getPath("owner.owner.content").fullName.trim()+" <"+SC.RenderContext.escapeHTML(this.getPath("owner.owner.content").email)+">":t===NO&&delete r[n],r!==undefined&&r[n]!==undefined?YES:NO}.property()}),Contacts.AddressItemView=SC.View.extend({bundle:Contacts,childViews:"name emailItem checkboxes".w(),layout:{left:10},render:function(e){var t=arguments.callee.base.apply(this,arguments);return this.getPath("contentIndex")%2!==0&&e.addClass("stripe"),t},name:SC.LabelView.design({layout:{left:0,top:5,width:164},classNames:"address-name".w(),contentBinding:".owner.content",contactNameOrder:null,contactNameOrderBinding:"Contacts.addressesController.contactNameOrder",escapeHTML:NO,render:function(e){arguments.callee.base.apply(this,arguments);var t=this.getPath("owner.content");t&&e.push(t.htmlName)}}),emailItem:SC.LabelView.design({layout:{left:171,top:5,width:Contacts.metrics.EMAIL_ITEM_LABEL_WIDTH},classNames:"address-email".w(),escapeHTML:NO,render:function(e){arguments.callee.base.apply(this,arguments);
var t=this.getPath("owner.content"),n=t.emailType,r=CK.Autocomplete.localizedCategory(n);t&&e.push(SC.RenderContext.escapeHTML(t.email),' <span class="me-list-zebra-meta" >(',r,")</span>")}}),checkboxes:SC.View.design({childViews:"toCheckbox ccCheckbox bccCheckbox".w(),layout:{left:Contacts.metrics.CHECKBOX_COLUMNS_LEFT},toCheckbox:Contacts.CheckboxView.design({contentBinding:".owner.content",layoutBinding:SC.Binding.transform(function(){if(Compose.get("isBccEnabled"))return{left:Contacts.metrics.TO_CHECKBOX_LEFT,top:6};var e=Contacts.metrics;return{left:e.TO_CHECKBOX_LEFT+e.BCC_LABEL_WIDTH,top:6}}).from("Compose.isBccEnabled"),addresses:null,addressesBinding:"Contacts.toArray"}),ccCheckbox:Contacts.CheckboxView.design({contentBinding:".owner.content",layoutBinding:SC.Binding.transform(function(){if(Compose.get("isBccEnabled"))return{left:Contacts.metrics.CC_CHECKBOX_LEFT,top:6};var e=Contacts.metrics;return{left:e.CC_CHECKBOX_LEFT+e.BCC_LABEL_WIDTH,top:6}}).from("Compose.isBccEnabled"),addresses:null,addressesBinding:"Contacts.ccArray"}),bccCheckbox:Contacts.CheckboxView.extend({contentBinding:".owner.content",isEnabledBinding:"Compose.isBccEnabled",layout:{left:Contacts.metrics.BCC_CHECKBOX_LEFT,top:6},addresses:null,addressesBinding:"Contacts.bccArray",isVisibleBinding:"Compose.isBccEnabled"})})}),Contacts.AddressListView=SC.ListView.design(SC.CollectionRowDelegate,{contentBinding:"Contacts.addressesController.content",target:"Contacts.addressesController",classNames:"me-list-zebra".w(),rowHeight:28,exampleView:Contacts.AddressItemView}),Contacts.AddressesContainerView=SC
.View.extend({classNames:"contacts".w(),childViews:["paneTitle","addressListHeader","searchFieldView","searchResultsList","addressList","emptyContactView","spinnerView","buttonView"],spinnerView:SC.View.extend({layout:{centerX:0,centerY:0,width:200,height:60},childViews:"showSpinner loadingLabel".w(),showSpinner:SC.View.extend({layout:{centerX:0,top:0,width:32,height:32},classNames:"spinner-32px-ffffff"}),loadingLabel:SC.LabelView.design({textAlign:SC.ALIGN_CENTER,classNames:"me-table-loading",layout:{top:42},value:"_Contacts.Loading".loc()})}),paneTitle:SC.LabelView.design({controlSize:SC.HUGE_CONTROL_SIZE,layout:{left:20,top:18,width:150,height:30},classNames:"contacts-title",value:"_Contacts.Main.Title".loc()}),searchFieldView:SC.View.design({layout:{top:18,height:19,right:20,width:173},classNames:"search-view".w(),themeName:"mini-address-book-search",childViews:"searchLeftView searchRightView  searchTextView".w(),searchLeftView:SC.View.design({classNames:"left".w(),layout:{left:0,width:18}}),searchTextView:SC.TextFieldView.design({classNames:"search-text middle".w(),layout:{left:17,width:Contacts.metrics.SEARCH_TEXT_VIEW_WIDTH},textAlign:SC.ALIGN_LEFT,hint:"_Contacts.Main.SearchContacts".loc(),valueBinding:"Contacts.addressesController.searchFieldValue",spellCheckEnabled:NO,keyDown:function(e){var t,n;t=e.commandCodes(),n=t[0];if(n==="return")return Contacts.addressesController.notifyPropertyChange("searchFieldValue"),YES;if(n!=="escape")return arguments.callee.base.apply(this,arguments);SC.browser.isMozilla===YES&&this.resignFirstResponder(),Contacts.addressesController
.invokeLater("clearSearchField",1)},rightAccessoryView:SC.ImageButtonView.create({layout:{top:3,height:13,width:13,right:-7},classNames:["clear-search"],isVisibleBinding:"Contacts.addressesController.shouldShowClearSearch",mouseDown:function(){return this.selectAll(),arguments.callee.base.apply(this,arguments)},mouseUp:function(){return Contacts.addressesController.clearSearchField(),arguments.callee.base.apply(this,arguments)},selectAll:function(){var e=this.getPath("parentView.value").length;e>0&&this.setPath("parentView.selection",SC.TextSelection.create({start:0,end:e}))}})}),searchRightView:SC.View.design({layout:{right:0,width:18},classNames:"right".w()})}),addressListHeader:Contacts.AddressListHeaderView.design({layout:{centerX:0,top:49,width:Contacts.metrics.ADDRESS_HEADER_WIDTH,height:22}}),addressList:SC.ScrollView.design(CW.FadingCaplessScrollerViewSupport,{content:null,contentBinding:"Contacts.addressesController",classNames:"address-list".w(),hasHorizontalScroller:NO,verticalScrollerView:CW.FadingCaplessScrollerView,verticalScrollerLayout:{right:0,top:1,bottom:1},borderStyle:SC.BORDER_NONE,layout:{centerX:0,top:73,width:Contacts.metrics.ADDRESS_LIST_WIDTH,height:363},isVisibleBinding:"Contacts.addressesController.searchClosed",contentView:Contacts.AddressListView.extend({})}),searchResultsList:SC.ScrollView.design(CW.FadingCaplessScrollerViewSupport,{content:null,contentBinding:"Contacts.addressesController",classNames:"address-list".w(),hasHorizontalScroller:NO,verticalScrollerView:CW.FadingCaplessScrollerView,verticalScrollerLayout:{right:1,top:1,bottom:1},borderStyle
:SC.BORDER_NONE,isVisibleBinding:"Contacts.addressesController.searchFieldValue",layout:{centerX:0,top:73,width:Contacts.metrics.SEARCH_RESULTS_LIST_WIDTH,height:363},contentView:Contacts.AddressListView.extend({content:null,contentBinding:"Contacts.addressesController.searchResult"})}),buttonView:SC.View.extend({layout:{bottom:4,height:44,left:0,right:0},childViews:["cancelButton","okButton"],classNames:["text-align-right"],cancelButton:SC.ButtonView.extend({useStaticLayout:YES,localize:YES,classNames:["button-in-between","bar-after"],layout:{width:"auto"},themeName:"borderless",title:"_Common.Button.Cancel".loc(),target:"Contacts",isCancel:YES,action:function(){Contacts.statechart.sendEvent("Cancel")}}),okButton:SC.ButtonView.extend({useStaticLayout:YES,localize:YES,layout:{width:"auto"},classNames:["button-aligned-right"],themeName:"borderless",title:"_Common.Button.OK".loc(),isDefault:YES,action:function(){Contacts.statechart.sendEvent("OK")}})}),emptyContactView:SC.LabelView.design({layout:{centerX:0,centerY:0,width:330,height:26},textAlign:SC.ALIGN_CENTER,classNames:["empty"],valueBinding:"Contacts.addressesController.resultMessageValue",isVisibleBinding:"Contacts.addressesController.isNoAddress"})}),Contacts.miniAddressBookSearchTheme=SC.BaseTheme.create({name:"mini-address-book-search"}),SC.Theme.addTheme(Contacts.miniAddressBookSearchTheme),SC.BaseTheme.AddPickerSelectMenuRenderDelegate=SC.BaseTheme.cwSelectMenuRenderDelegate.create({menuLeftOffset:25}),Contacts.AddPickerSelectViewMenuPane=CW.SelectViewMenuPane.extend({renderDelegateName:"AddPickerSelectMenuRenderDelegate"
}),Contacts.AddContactView=SC.View.extend({classNames:"add-contact".w(),childViews:function(){return Global.get("isLastNameFirstLanguage")===NO?"firstNameText lastNameText companyNameText vipCheckbox emailType emailId buttonsView".w():"lastNameText firstNameText companyNameText vipCheckbox emailType emailId buttonsView".w()}(),firstNameText:SC.TextFieldView.design({layout:{left:15,right:15,top:Contacts.metrics.ADD_CONTACT_FIRSTNAME_TOP,height:CW.TEXT_FIELD_LARGE_HEIGHT},textAlign:SC.ALIGN_LEFT,controlSize:SC.LARGE_CONTROL_SIZE,localize:YES,valueBinding:"Contacts.contactPickerController.firstName",hint:"_Contacts.ContactPicker.FirstName".loc()}),lastNameText:SC.TextFieldView.design({layout:{left:15,right:15,top:Contacts.metrics.ADD_CONTACT_LASTNAME_TOP,height:CW.TEXT_FIELD_LARGE_HEIGHT},textAlign:SC.ALIGN_LEFT,controlSize:SC.LARGE_CONTROL_SIZE,localize:YES,valueBinding:"Contacts.contactPickerController.lastName",hint:"_Contacts.ContactPicker.LastName".loc()}),companyNameText:SC.TextFieldView.design({layout:{left:15,right:15,top:90,height:CW.TEXT_FIELD_LARGE_HEIGHT},textAlign:SC.ALIGN_LEFT,controlSize:SC.LARGE_CONTROL_SIZE,localize:YES,valueBinding:"Contacts.contactPickerController.companyName",hint:"_Contacts.ContactPicker.CompanyName".loc()}),vipCheckbox:SC.CheckboxView.design({layout:{left:12,top:127,width:150,height:20},controlSize:SC.LARGE_CONTROL_SIZE,title:"_Contacts.Picker.Vip".loc(),textAlign:SC.ALIGN_CENTER,classNames:"vip-checkbox-view".w(),valueBinding:"Contacts.contactPickerController.isVip",mouseUp:function(){return Contacts.contactPickerController.set("isVipValueChanged"
,YES),arguments.callee.base.apply(this,arguments)}}),emailType:CW.SelectView.design(SC.AutoResize,{layout:{left:7,top:151,height:10},classNames:"add-contact-email-type".w(),supportFocusRing:NO,localize:YES,controlSize:SC.REGULAR_CONTROL_SIZE,needsEllipsis:NO,valueBinding:"Contacts.contactPickerController.emailType",items:["_Contacts.ContactPicker.emailType.Work".loc(),"_Contacts.ContactPicker.emailType.Home".loc(),"_Contacts.ContactPicker.emailType.Other".loc()],menu:Contacts.AddPickerSelectViewMenuPane}),emailId:SC.View.design({layout:{left:Contacts.metrics.ADD_CONTACT_EMAILID_LEFT,top:155,height:26,right:20},classNames:"add-contact-email-id-wrapper",controlSize:SC.LARGE_CONTROL_SIZE,escapeHTML:YES,valueBinding:SC.Binding.oneWay("Contacts.contactPickerController.emailId"),useStaticLayout:YES,isTextSelectable:YES,displayProperties:["value"],_prevValue:null,render:function(e,t){var n=this.get("value"),r="mailto:"+n;if(t)this._prevValue=n,e.push('<a class="add-contact-email-id" href="'+r+'">',n,"</a>");else if(this._prevValue!==n){var i=this.$(".add-contact-email-id");i.attr("href",r),i.html(n),this._prevValue=n}},click:function(e){if(e.which===3)return NO;if((!document.getSelection||document.getSelection().toString()==="")&&e.target&&SC.$(e.target).hasClass("add-contact-email-id"))return Contacts.statechart.sendAction("openCompose",Contacts.getEmailAddress(e)),YES}}),buttonsView:SC.View.extend({layout:{height:44,top:180,right:0,left:0},classNames:["text-align-right"],childViews:["buttonCancel","buttonSave"],buttonCancel:SC.ButtonView.extend({isCancel:YES,localize:YES,classNames
:["button-in-between","bar-after"],themeName:"borderless",title:"_Common.Button.Cancel",useStaticLayout:YES,layout:{left:0,top:0,width:"auto",bottom:0},isDefault:NO,action:function(){Contacts.statechart.sendEvent("cancel")}}),buttonSave:SC.ButtonView.extend({isDefault:YES,localize:YES,themeName:"borderless",useStaticLayout:YES,classNames:["button-aligned-right"],layout:{left:0,top:0,width:"auto",bottom:0},title:"Button.Save",action:function(){Contacts.statechart.sendEvent("save")}})})}),Contacts.ExistingContactView=SC.View.extend({childViews:"contactPhotoView contactName vipCheckbox emailAddressScrollView".w(),contactPhotoView:CK.Photo.PhotoIconCanvasView.extend({dimensions:{width:80,height:80},layout:{left:17,top:17},isVisibleBinding:"Contacts.contactPickerController.hasPhotoUrl",valueBinding:"Contacts.contactPickerController.photoUrl",photoCropBinding:"Contacts.contactPickerController.photoCrop"}),contactName:SC.LabelView.design({tagName:"label",classNames:"existing-contact-name".w(),valueBinding:"Contacts.contactPickerController.displayName",layoutBinding:"Contacts.contactPickerController.contactNameLayout",escapeHTML:YES}),vipCheckbox:SC.CheckboxView.design({layoutBinding:"Contacts.contactPickerController.vipCheckboxlayout",controlSize:SC.LARGE_CONTROL_SIZE,title:"_Contacts.Picker.Vip".loc(),textAlign:SC.ALIGN_CENTER,classNames:"vip-checkbox-view".w(),valueBinding:"Contacts.contactPickerController.isVip",mouseUp:function(){return Contacts.contactPickerController.set("isVipValueChanged",YES),arguments.callee.base.apply(this,arguments)}}),emailAddressScrollView:SC.ScrollView
.design(CW.FadingCaplessScrollerViewSupport,{layoutBinding:"Contacts.contactPickerController.emailAddresslayout",verticalScrollerView:CW.FadingCaplessScrollerView,verticalScrollerLayout:{right:1,top:1,bottom:10},isScrollable:YES,contentView:SC.LabelView.design({escapeHTML:YES,contentBinding:"Contacts.contactPickerController.content",isTextSelectable:YES,displayProperties:["content"],adjustHeight:function(){var e=this.get("content");e&&this.adjust({height:e.emailAddresses.get("length")*Contacts.metrics.CONTACT_PICKER_EMAIL_ADDRESS_ROW_HEIGHT}).updateLayout()}.observes("content"),render:function(e){var t=arguments.callee.base.apply(this,arguments),n=Contacts.contactPickerController,r=n.getPath("content.emailAddresses");if(r){var i,s,o="",u=r.get("length"),a=n.get("hasPhotoUrl");if(a===NO){var f=n.get("emailTypeWidth");s=n.get("emailIdWidth"),i=f+16,o="style = 'width:"+f+"px;'"}else o="style = 'width: 75px; text-align: right;'";if(u){var l,c,h,p,d,v,m,g=CK.Autocomplete,y=SC.RenderContext,b;for(var w=0;w<u;w++)b=r[w],l=b.label,v=g.localizedCategory(l),a?(c="style = 'padding-left: 100px;'",p="242px;"):(c="style = 'padding-left:"+i+"px;'",p=s+"px;"),m=b.field,m===n.get("emailId")?h="color:#0A8DE9;":h="color:#000;",m=y.escapeHTML(m),d="style ='"+h+"max-width:"+p+"'",e.push('<div class= "existing-contact-email-ids" >','<label class="existing-contact-email-type" '+o+">",y.escapeHTML(v),"</label>","<div "+c+'><a href="mailto:'+m+'" class="existing-contact-id"'+d+">",m,"</a></div>","</div>")}}return t},click:function(e){if(e.which===3)return NO;if(!document.getSelection||!document.getSelection
().toString())if(e.target&&SC.$(e.target).hasClass("existing-contact-id"))return Contacts.statechart.sendAction("openCompose",Contacts.getEmailAddress(e)),YES}})})}),Contacts.ContactPicker=CW.PickerPane.extend({classNames:"contact-picker".w(),modalPane:SC.ModalPane.extend({classNames:["for-sc-panel","mail-modal-pane"]}),contentView:SC.ContainerView.design({nowShowing:null}),createLayouts:function(){var e=arguments.callee.base.apply(this,arguments),t=Contacts.get("contactPickerController"),n,r,i,s;if(t.get("content")){Contacts.setEmailIdAndEmailTypeWidths();if(t.hasPhotoUrl===YES){i=156;var o=t.get("emailIdWidth");r=130+o+10}else i=Contacts.metrics.CONTACT_PICKER_HEIGHT_WITHOUT_PHOTO,r=t.get("widthForContactPickerWithoutPhoto");n=t.getPath("content.emailAddresses");if(n){var u=n.get("length"),a=Contacts.MAX_EMAIL_ADDRESS_ROWS;u>a&&(u=a),i+=(u-1)*Contacts.metrics.CONTACT_PICKER_HEIGHT_BUFFER;var f=Contacts.metrics.EXISTING_CONTACT_PICKER_MAX_WIDTH;r>f?r=f:r<=290&&(r=290),s={width:r,height:i},this.set("desiredSize",s)}}else s={width:328,height:228},this.set("desiredSize",s);return e},dismiss:function(){var e=arguments.callee.base.apply(this,arguments);return Contacts.statechart.sendAction("removePicker"),e}}),Contacts.ImportContactPicker=CW.PickerPane.extend({classNames:"import-contact-picker".w(),modalPane:SC.ModalPane.extend({classNames:["for-sc-panel","mail-modal-pane"]}),contentView:SC.ContainerView.design({nowShowing:null}),desiredSize:{width:Contacts.metrics.IMPORT_CONTACT_PICKER_WIDTH,height:Contacts.metrics.IMPORT_CONTACT_PICKER_HEIGHT},dismiss:function(){var e=arguments
.callee.base.apply(this,arguments);return Contacts.statechart.sendAction("dismiss"),e}}),Contacts.ImportContactView=SC.View.extend({layout:{top:2,left:1,right:1},childViews:["message","buttonsView"],message:SC.LabelView.extend({layout:{top:Contacts.metrics.IMPORT_CONTACT_LABEL_TOP,left:17,right:8,height:46},classNames:["contact-message"],value:"_MessageView.ContactImportPicker.ContactMessage".loc()}),buttonsView:SC.View.extend({layout:{height:44,top:67,right:0,left:0},classNames:["text-align-right"],childViews:["downloadBtn","importBtn"],downloadBtn:SC.ButtonView.extend({classNames:["button-in-between","bar-after"],themeName:"borderless",useStaticLayout:YES,layout:{left:0,top:0,width:"auto",bottom:0},title:"_MessageView.ContactImportPicker.Download.ButtonTitle".loc(),action:function(){CoreMail.errorHandler.recordStat("_STAT_DOWNLOAD_VCF"),Contacts.statechart.sendEvent("downloadVcard")}}),importBtn:SC.ButtonView.extend({useStaticLayout:YES,layout:{left:0,top:0,width:"auto",bottom:0},title:"_MessageView.ContactImportPicker.Import.ButtonTitle".loc(),isDefault:YES,classNames:["button-aligned-right"],themeName:"borderless",action:function(){CoreMail.incrementUserStat(CoreMail.STAT_IMPORT_VCF),Contacts.statechart.sendEvent("importVcard")}})})}),Contacts.ImportContactConfirmView=SC.View.extend({layout:{left:12,right:8},childViews:["messageView"],messageView:SC.LabelView.extend({layout:{left:3,right:6},classNames:["import-confirmation"],controlSize:SC.LARGE_CONTROL_SIZE,valueBinding:"Contacts.importContactPickerController.importFileName",displayProperties:"value".w(),_domElement:null
,render:function(e){var t=arguments.callee.base.apply(this,arguments);return e.push("_MessageView.ImportContactSuccessful".loc('<label style="font-weight:500;">'+SC.RenderContext.escapeHTML(this.get("value"))+"</label>")),t},didUpdateLayer:function(){var e,t,n;this._domElement||(this._domElement=this.$()),e=this._domElement.attr("class").w();var r=Contacts.metrics.IMPORT_CONTACT_PICKER_WIDTH-29;t=SC.heightForString(this._domElement.text(),r,"",e,NO),n=(Contacts.metrics.IMPORT_CONTACT_PICKER_HEIGHT-t)/2,Contacts.page.importContactsConfirmView.adjust("top",n)}})}),Contacts.ImportContactLoadingView=SC.View.extend({childViews:["spinner","spinnerLabel"],classNames:["contact-loading"],spinner:SC.LabelView.extend({layout:{top:45,left:Contacts.metrics.LOADING_CONTACT_SPINNER_LEFT,height:32,width:32},isVisible:YES,icon:"spinner-32px-f3f5f5"}),spinnerLabel:SC.LabelView.design(SC.AutoResize,{layout:{top:51,left:Contacts.metrics.LOADING_CONTACT_SPINNER_LABEL_LEFT,height:Contacts.metrics.LOADING_CONTACT_SPINNER_LABEL_HEIGHT},classNames:["spinner-label"],controlSize:SC.LARGE_CONTROL_SIZE,value:"_MessageView.AddingContact".loc()})}),Contacts.page=SC.Page.design({content:null,contentBinding:"Contacts.addressesController",pane:SC.SheetPane.design({layout:{centerX:0,top:74,width:Contacts.metrics.SHEET_PANE_WIDTH,height:489},contentView:Contacts.AddressesContainerView.extend({})}),contactPicker:Contacts.ContactPicker.design(),existingContactView:Contacts.ExistingContactView.design(),addContactView:Contacts.AddContactView.design(),importContactPicker:Contacts.ImportContactPicker.design(),importContactsView
:Contacts.ImportContactView.design(),importContactsConfirmView:Contacts.ImportContactConfirmView.design(),importContactsLoadingView:Contacts.ImportContactLoadingView.design()}),Contacts.AddressPanel=SC.State.extend({initialSubstate:"openAddressesPanel",openAddressesPanel:SC.State.design({enterState:function(){SC.Benchmark.start("perfLoadAddressBook"),CoreMail.incrementUserStat(CoreMail.STAT_MINI_AB),Contacts.setPath("page.pane.isVisible",YES),Contacts.setPath("page.pane.contentView.spinnerView.isVisible",YES);var e=Contacts.get("addressesController"),t=e.getAddressBook();t!==null?(Contacts.set("content",t),this.gotoState("loadAddressesPanel")):CoreMail.errorHandler.handleError({keyString:"Contacts.ServerErrorMessage",rightButton:{title:"_Contacts.Button.TryAgain".loc(),action:function(){CoreMail.errorHandler.removeErrorPane(this),Contacts.statechart.sendEvent("tryAgain")}},middleButton:{title:"_Common.Button.Cancel".loc(),action:function(){CoreMail.errorHandler.removeErrorPane(this),Contacts.statechart.sendEvent("closeContactPanelState")}}}),SC.Benchmark.end("perfLoadAddressBook")},tryAgain:function(){Contacts.getPath("page.pane.contentView.searchFieldView.searchTextView").resignFirstResponder();var e=Contacts.getPath("addressesController.autocompleteController");e.dataSource.clearLoadedData(),Contacts.statechart.sendEvent("closeContactPanelState")},closeContactPanelState:function(){Contacts.page.pane.remove(),this.gotoState("startupState")}}),loadAddressesPanel:SC.State.design({enterState:function(){return Contacts.setPath("page.pane.contentView.spinnerView.isVisible",NO),Contacts
.setIsNoAddressFlag(),arguments.callee.base.apply(this,arguments)},OK:function(){var e,t=Compose.get("lastFocusedView"),n=Contacts._getSelectedAddresses(),r=Compose.page.getPath("composeEditor.composeHeader"),i=NO;if(n.to){var s=r.getPath("to.input"),o=n.to,u=CK.tokensParser.parseEmailAddressList(o);s.get("tokensController").pushObjects(u),i=YES}if(n.cc){var a=r.getPath("cc.input"),f=n.cc,l=CK.tokensParser.parseEmailAddressList(f);a.get("tokensController").pushObjects(l),i=YES}if(n.bcc){var c=r.getPath("bcc.input"),h=n.bcc,p=CK.tokensParser.parseEmailAddressList(h);c.get("tokensController").pushObjects(p),i=YES}YES===i&&(Compose.enableSend(),Compose.registerComposeUnloadListener()),e=Contacts.getPath("page.pane"),Contacts.addressesController.clearSearchField(),Contacts.getPath("page.pane.contentView.searchFieldView.searchTextView").resignFirstResponder(),e.remove();if(t){var d=t.get("tokensController");d&&d.set("nextIndex",d.get("length")),t.set("shouldSelectAllTokens",NO),t.becomeFirstResponder()}else RichTextEditor.setFocusOnEditor();Contacts.page.pane.contentView.addressList.contentView.reload(),Contacts._clearSelection(),this.gotoState("startupState")},Cancel:function(){var e=Contacts.getPath("page.pane");Contacts.addressesController.clearSearchField(),Contacts.getPath("page.pane.contentView.searchFieldView.searchTextView").resignFirstResponder(),e.remove(),Compose.lastFocusedView?Compose.lastFocusedView.becomeFirstResponder():RichTextEditor.setFocusOnEditor(),Contacts.page.pane.contentView.addressList.contentView.reload(),Contacts._clearSelection(),this.gotoState("startupState"
)}})}),Contacts.ContactPicker=SC.State.extend({initialSubstate:"openContactPicker",openContactPicker:SC.State.design({enterState:function(){SC.Benchmark.start("perfOpenContactPicker");var e=Contacts.get("contactPickerController"),t=e.get("emailId");if(t){var n=VipSender.isVip(t);n&&(e.set("isVip",YES),e.set("vipRecord",n))}var r=Contacts.addressesController.get("autocompleteController"),i=r.get("dataSource");this._contactsDataSource=i,this._contactsDataSource.sendContactsRequest()},_contactsDataIsLoadedStatusDidChange:function(){var e=this._contactsDataSource.get("contactsDataIsLoaded"),t=Contacts.get("contactPickerController"),n=this._contactsDataSource.get("_dataCache");if(e&&n.guidToRecordMapping){var r=n.contacts.guidToRecordMapping,i=[],s,o;for(o in r)if(r.hasOwnProperty(o)){s=r[o],i=s.emailAddresses;if(i)for(var u=0,a=i.get("length");u<a;u++){var f=t.get("emailId");if(f===i[u].field){t.set("content",s);var l=Contacts.getContactName();t.setPhotoUrl(),t.setPhotoCrop(),t.set("displayName",l),this.gotoState("existingContactView");return}}}this.gotoState("addContactView")}else this.gotoState("addContactView")}.stateObserves("._contactsDataSource.contactsDataIsLoaded")}),existingContactView:SC.State.design({enterState:function(){var e=Contacts.page.get("contactPicker");e.setPath("contentView.nowShowing","existingContactView"),this.invokeLater(function(){e.popup(Contacts.contactPickerController.get("anchor"))}),e.createLayouts(),SC.Benchmark.end("perfOpenContactPicker")},removePicker:function(){Contacts.saveVipContact(),Contacts.clearContactDataFromController(),this.gotoState
("startupState")},openCompose:function(e){CoreMail.incrementUserStat(CoreMail.STAT_COMPOSE),Global.mailTo(e),Contacts.saveVipContact(),Contacts.clearContactDataFromController(),Contacts.page.get("contactPicker").remove(),this.gotoState("startupState")}}),addContactView:SC.State.design({enterState:function(){var e=Contacts.page.get("contactPicker");e.setPath("contentView.nowShowing","addContactView"),this.invokeLater(function(){e.popup(Contacts.contactPickerController.get("anchor"))}),e.createLayouts(),SC.Benchmark.end("perfOpenContactPicker")},removePicker:function(){Contacts.clearContactDataFromController(),this.gotoState("startupState")},cancel:function(){Contacts.clearContactDataFromController(),Contacts.page.get("contactPicker").remove(),this.gotoState("startupState")},openCompose:function(e){CoreMail.incrementUserStat(CoreMail.STAT_COMPOSE),Global.mailTo(e),Contacts.clearContactDataFromController(),Contacts.page.get("contactPicker").remove(),this.gotoState("startupState")},save:function(){var e=Contacts.addressesController.get("autocompleteController"),t=e.get("dataSource"),n=Contacts.get("contactPickerController"),r=n.get("emailId"),i=n.get("firstName"),s=n.get("lastName"),o=n.get("companyName"),u=n.get("emailType"),a={firstName:i,lastName:s,companyName:o,emailAddresses:[{field:r,label:u}]};this._contactsDataSource=t,this._contactsDataSource.addContactRequest(a)},_addContactStatusDidChange:function(){var e=this._contactsDataSource.get("addContactDidError");if(!e){var t=Contacts.contactPickerController,n=t.get("delegate");if(n){var r=t.get("firstName"),i=t.get("lastName"
),s=CK.displayNameFor(r,i);n.tryToPerform("contactSaved",t.get("anchor"),s)}if(window&&window.opener&&window.WHAT_TYPE.isMailChild()){var o=opener.Contacts.addressesController.get("autocompleteController");o&&o.dataSource&&o.dataSource.sendContactsRequest()}Contacts.saveVipContact()}else this._contactsDataSource.get("addContactRequestHasCompleted")&&this.invokeLast(Contacts.showContactNotAddedError);Contacts.clearContactDataFromController(),Contacts.page.get("contactPicker").remove(),this.gotoState("startupState")}.stateObserves("._contactsDataSource.addContactRequestHasCompleted")})}),Contacts.ImportContactPicker=SC.State.extend({initialSubstate:"openImportContactPicker",openImportContactPicker:SC.State.design({enterState:function(){var e=Contacts.addressesController.get("autocompleteController"),t=e.get("dataSource");this._importContactsDataSource=t;var n=Contacts.page.get("importContactPicker");n.setPath("contentView.nowShowing","importContactsView"),n.popup(Contacts.importContactPickerController.get("anchor"))},downloadVcard:function(){this.gotoState("downloadVcardView")},importVcard:function(){this.gotoState("importVcardView")},dismiss:function(){Contacts.clearImportContactDataFromController(),Contacts.page.get("importContactPicker").remove(),this.gotoState("startupState")}}),downloadVcardView:SC.State.design({enterState:function(){ViewMessage.downloadAttachment(Contacts.importContactPickerController.get("target")),Contacts.page.get("importContactPicker").remove(),this.gotoState("startupState")}}),importVcardView:SC.State.design({enterState:function(){var e=Contacts.addressesController
.get("autocompleteController"),t=e.get("dataSource");this._importContactsDataSource=t;var n=Message.messageController.get("mimeParts").toArray(),r=n.indexOf(n.findProperty("isVCF",!0)&&n.findProperty("name",Contacts.importContactPickerController.get("importFileName")));if(r>=0){var i=Contacts.page.get("importContactPicker");i.setPath("contentView.nowShowing","importContactsLoadingView");var s=n[r].get("content");this._importContactsDataSource.uploadVCard(s),this._vCard=s}},MAX_RETRY_COUNT:2,_retryCount:0,_uploadVCardRequestStatusDidChange:function(){var e=Contacts.addressesController.get("autocompleteController"),t=e.get("dataSource");this._importContactsDataSource=t;var n=t.get("uploadVCardRequestHasCompleted");if(n){var r=t.get("uploadVCardDidError");if(r){var i=this._retryCount;if(t.get("uploadVCardFailureErrorCode")===420&&i<this.MAX_RETRY_COUNT){i++,t.sendContactsRequest();var s=function(){t.get("contactsRequestHasCompleted")&&(t.uploadVCard(this._vCard),t.removeObserver("contactsRequestHasCompleted",this,s))};t.addObserver("contactsRequestHasCompleted",this,s)}else this.invokeLast(function(){Contacts.showContactNotImportedError(this._importContactsDataSource.get("uploadVCardFailureErrorCode"))}),Contacts.page.get("importContactPicker").remove(),this.gotoState("startupState")}else{var o=Contacts.page.get("importContactPicker");o.setPath("contentView.nowShowing","importContactsConfirmView")}}}.stateObserves("._importContactsDataSource.uploadVCardRequestHasCompleted")})}),Contacts.statechart=SC.Statechart.create({trace:YES,monitorIsActive:NO,initialState:"startupState",startupState
:SC.State.design({openAddresses:function(){this.gotoState("addressPaneVisibleState")},openContactsPicker:function(){this.gotoState("contactPickerVisibleState")},openImportContactsPicker:function(){this.gotoState("importContactPickerVisibleState")}}),addressPaneVisibleState:SC.State.plugin("Contacts.AddressPanel"),contactPickerVisibleState:SC.State.plugin("Contacts.ContactPicker"),importContactPickerVisibleState:SC.State.plugin("Contacts.ImportContactPicker")});